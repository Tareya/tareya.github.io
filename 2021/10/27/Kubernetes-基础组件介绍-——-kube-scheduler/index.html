

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.png">
  <link rel="icon" href="/img/icon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduleråœ¨ K8S çš„ç»„ä»¶ä¸­ï¼Œkube-scheduler æ˜¯ä¸“é—¨ç”¨äºå¤„ç†è°ƒåº¦çš„è¿›ç¨‹ã€‚å…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯æŒç»­ç›‘å¬ API Server æ¥è·å–PodSpec.NodeName ä¸ºç©ºçš„ Podï¼Œå¹¶å¯¹æ¯ä¸ª Pod åˆ›å»º bindingï¼Œç„¶åæ ¹æ®ç‰¹å®šçš„è°ƒåº¦ç®—æ³•å’Œè°ƒåº¦ç­–ç•¥å°† Pod è°ƒåº¦åˆ°åˆé€‚çš„ Node èŠ‚ç‚¹ä¸Šå»ï¼Œå†å°†è°ƒåº¦ç»“æœå›å†™ API Serv">
  <meta name="author" content="Tareya">
  <meta name="keywords" content="">
  
  <title>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduler - ä¹±åºæ—¶ç©º</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"tareya.github.io","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ä¹±åºæ—¶ç©º</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/background/lomo5.jpeg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduler">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-10-27 09:53" pubdate>
        2021å¹´10æœˆ27æ—¥ ä¸Šåˆ
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5.2k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      64
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduler</h1>
            
            <div class="markdown-body">
              <h1 id="Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-scheduler"><a href="#Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-scheduler" class="headerlink" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduler"></a>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduler</h1><p>åœ¨ K8S çš„ç»„ä»¶ä¸­ï¼Œ<code>kube-scheduler</code> æ˜¯ä¸“é—¨ç”¨äºå¤„ç†è°ƒåº¦çš„è¿›ç¨‹ã€‚å…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯æŒç»­ç›‘å¬ <code>API Server</code> æ¥è·å–<code>PodSpec.NodeName</code> ä¸ºç©ºçš„ Podï¼Œå¹¶å¯¹æ¯ä¸ª Pod åˆ›å»º bindingï¼Œç„¶åæ ¹æ®ç‰¹å®šçš„è°ƒåº¦ç®—æ³•å’Œè°ƒåº¦ç­–ç•¥å°† Pod è°ƒåº¦åˆ°åˆé€‚çš„ Node èŠ‚ç‚¹ä¸Šå»ï¼Œå†å°†è°ƒåº¦ç»“æœå›å†™ <code>API Server</code>ã€‚</p>
<span id="more"></span>

<h2 id="ä¸€ã€K8S-è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥"><a href="#ä¸€ã€K8S-è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥" class="headerlink" title="ä¸€ã€K8S è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥"></a>ä¸€ã€K8S è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥</h2><blockquote>
<p>ğŸš© Kube-scheduler æ˜¯ Kubernetes çš„é»˜è®¤è°ƒåº¦å™¨ï¼Œæ˜¯é›†ç¾¤æ•´ä½“æ§åˆ¶é¢çš„ä¸€éƒ¨åˆ†ã€‚kube-scheduler åœ¨è®¾è®¡ä¸Šå…è®¸è‡ªå®šä¹‰ä¸€ä¸ªè°ƒåº¦ç»„ä»¶æ¥æ›¿æ¢å®ƒï¼Œæ‰€ä»¥åªè¦æ¸…æ¥šçš„äº†è§£äº† K8S ä¸­è°ƒåº¦çš„åŸç†ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªè°ƒåº¦å™¨ã€‚</p>
</blockquote>
<h3 id="1ã€Kube-Scheduler-çš„å·¥ä½œåŸç†"><a href="#1ã€Kube-Scheduler-çš„å·¥ä½œåŸç†" class="headerlink" title="1ã€Kube-Scheduler çš„å·¥ä½œåŸç†"></a>1ã€Kube-Scheduler çš„å·¥ä½œåŸç†</h3><h4 id="1ï¼‰è°ƒåº¦æµç¨‹"><a href="#1ï¼‰è°ƒåº¦æµç¨‹" class="headerlink" title="1ï¼‰è°ƒåº¦æµç¨‹"></a>1ï¼‰è°ƒåº¦æµç¨‹</h4><h5 id="1-æµç¨‹æ¦‚è¿°"><a href="#1-æµç¨‹æ¦‚è¿°" class="headerlink" title="1. æµç¨‹æ¦‚è¿°"></a>1. æµç¨‹æ¦‚è¿°</h5><ul>
<li>é¦–å…ˆï¼Œç”¨æˆ·é€šè¿‡ Kubernetes å®¢æˆ·ç«¯é€šè¿‡æˆ– kubectl å·¥å…·é€šè¿‡ yaml çš„å½¢å¼å‘ç³»ç»Ÿå‘èµ·èµ„æºè¯·æ±‚</li>
<li>API Server æ”¶åˆ°ç”¨æˆ·çš„ POST è¯·æ±‚åï¼Œåˆ›å»º Pod ï¼Œå¹¶å°†ç›¸å…³ä¿¡æ¯å­˜å‚¨åˆ° etcd ä¸­</li>
<li>è°ƒåº¦å™¨ä¼šå®šæ—¶ç›‘å¬ API Server ï¼ˆwatch æœºåˆ¶ï¼‰ï¼Œä¸€æ—¦ etcd å­˜å‚¨ Pod çš„ä¿¡æ¯æˆåŠŸå°±ä¼šç«‹å³é€šçŸ¥ API Server</li>
<li>API Server æ”¶åˆ°é€šçŸ¥åä¼šå°† Pod åˆ›å»ºçš„æ¶ˆæ¯é€šçŸ¥åˆ° Schedulerï¼ŒSchedulerï¼ˆlist æœºåˆ¶ï¼‰ä¼šå»è·å– Pod åˆ—è¡¨å¹¶éå†å®ƒä»¬ï¼Œä¸€æ—¦å‘ç° Pod å±æ€§ä¸­å­˜åœ¨ <code>Dest Node=&quot;&quot;</code> ï¼Œä¾¿ä¼šè§¦å‘è°ƒåº¦æµç¨‹ã€‚</li>
<li>Pod åœ¨è°ƒåº¦çš„è¿‡ç¨‹ä¸­éœ€è¦ç»è¿‡èŠ‚ç‚¹é¢„é€‰ï¼ŒèŠ‚ç‚¹ä¼˜é€‰ï¼ŒèŠ‚ç‚¹é€‰ä¼˜3ä¸ªé˜¶æ®µï¼Œé€šè¿‡è¿‡æ»¤ï¼ˆFilteringï¼‰å’Œæ‰“åˆ†ï¼ˆScoringï¼‰ä¸¤è¿‡ç¨‹æŒ‘é€‰å‡ºæœ€ç»ˆè°ƒåº¦çš„èŠ‚ç‚¹<ul>
<li>èŠ‚ç‚¹é¢„é€‰ï¼ˆPredicate)ï¼š è¯¥è¿‡ç¨‹çš„ä¸»è¦å·¥ä½œæ˜¯è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„ Nodeï¼Œæ¡ä»¶å¦‚å†…å­˜å¤§å°ã€ç«¯å£ç­‰</li>
<li>èŠ‚ç‚¹ä¼˜é€‰ï¼ˆPriorityï¼‰ï¼šè¯¥è¿‡ç¨‹çš„ä¸»è¦å·¥ä½œæ˜¯å°†é€‰å‡ºçš„ Node æŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡Œæ’åº</li>
<li>èŠ‚ç‚¹æ‹©ä¼˜ï¼ˆSelectï¼‰ï¼šæ ¹æ®ä¼˜å…ˆçº§é€‰å®šèŠ‚ç‚¹</li>
</ul>
</li>
<li>ç»è¿‡ä¸Šé˜¶æ®µé€‰æ‹©å¾—åˆ†æœ€é«˜çš„ Node èŠ‚ç‚¹ä¸Pod è¿›æ­¥ bindingï¼Œå¹¶é€šçŸ¥ API Server å°†ç»“æœå›å†™ etcd</li>
<li>æœ€åç”±è¢«é€‰æ‹©å‡ºæ¥çš„ Node èŠ‚ç‚¹ä¸Šçš„ kubelet å»æ‰§è¡Œåˆ›å»º Pod çš„ç›¸å…³æ“ä½œï¼Œåˆ›å»ºå’Œå¯åŠ¨å®¹å™¨</li>
</ul>
<h5 id="2-å…·ä½“è¿‡ç¨‹å›¾"><a href="#2-å…·ä½“è¿‡ç¨‹å›¾" class="headerlink" title="2. å…·ä½“è¿‡ç¨‹å›¾"></a>2. å…·ä½“è¿‡ç¨‹å›¾</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211026100220906.png" srcset="/img/loading.gif" lazyload alt="image-20211026100220906"></p>
<h3 id="2ã€è°ƒåº¦ç­–ç•¥"><a href="#2ã€è°ƒåº¦ç­–ç•¥" class="headerlink" title="2ã€è°ƒåº¦ç­–ç•¥"></a>2ã€è°ƒåº¦ç­–ç•¥</h3><h4 id="1ï¼‰æ–­è¨€-â€”â€”-Predicates"><a href="#1ï¼‰æ–­è¨€-â€”â€”-Predicates" class="headerlink" title="1ï¼‰æ–­è¨€ â€”â€” Predicates"></a>1ï¼‰æ–­è¨€ â€”â€” <em>Predicates</em></h4><blockquote>
<p>ğŸš© è°ƒåº¦å™¨é€šè¿‡æ–­è¨€çš„æ–¹å¼å®ç°äº†è¿‡æ»¤æ¥å£ï¼Œä»¥æ­¤å®ç°èŠ‚ç‚¹çš„é¢„é€‰é˜¶æ®µã€‚</p>
</blockquote>
<h5 id="1-å…·ä½“å·¥ä½œæµ"><a href="#1-å…·ä½“å·¥ä½œæµ" class="headerlink" title="1. å…·ä½“å·¥ä½œæµ"></a>1. å…·ä½“å·¥ä½œæµ</h5><ul>
<li>é¦–å…ˆï¼Œéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œè¯¥è¿‡ç¨‹å±äºå¼ºåˆ¶æ€§è§„åˆ™</li>
<li>è¾“å‡ºä¸Šä¸€é˜¶æ®µæ‰€æœ‰æ»¡è¶³è¦æ±‚çš„ Node å¹¶å°†å…¶è®°å½•ä½œä¸º <code>Priorities</code> çš„è¾“å…¥</li>
<li>å¦‚æœä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹éƒ½æ²¡æœ‰ï¼ŒPod å°±ä¼šä¸€ç›´å¤„äº Pending çŠ¶æ€ï¼Œè°ƒåº¦å™¨å›ä¸€ç›´é‡è¯•ï¼Œç›´åˆ°æœ‰æ»¡è¶³æ¡ä»¶çš„ Node è¢«é€‰å‡º</li>
</ul>
<h5 id="2-å¸¸ç”¨-Predicates-ç­–ç•¥"><a href="#2-å¸¸ç”¨-Predicates-ç­–ç•¥" class="headerlink" title="2. å¸¸ç”¨ Predicates ç­–ç•¥:"></a>2. å¸¸ç”¨ Predicates ç­–ç•¥:</h5><table>
<thead>
<tr>
<th>é¢„é€‰ç­–ç•¥</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>PodFitsHostPorts</td>
<td>æ£€æŸ¥ Pod è¯·æ±‚çš„ç«¯å£ï¼ˆç½‘ç»œåè®®ç±»å‹ï¼‰åœ¨èŠ‚ç‚¹ä¸Šæ˜¯å¦å¯ç”¨ï¼Œæ˜¯å¦å­˜åœ¨ç«¯å£å†²çª</td>
</tr>
<tr>
<td>PodFitsHost</td>
<td>å¦‚æœ Pod æŒ‡å®šäº† NodeNameï¼Œæ£€æŸ¥èŠ‚ç‚¹åç§°æ˜¯å¦å’Œ NodeName åŒ¹é…</td>
</tr>
<tr>
<td>PodFitsResources</td>
<td>æ£€æŸ¥èŠ‚ç‚¹çš„ç©ºé—²èµ„æºï¼ˆä¾‹å¦‚ï¼ŒCPUå’Œå†…å­˜ï¼‰æ˜¯å¦æ»¡è¶³ Pod çš„ request èµ„æºè¦æ±‚</td>
</tr>
<tr>
<td>MatchNodeSelector</td>
<td>æ£€æŸ¥ Pod çš„æ ‡ç­¾é€‰æ‹©å’ŒèŠ‚ç‚¹çš„æ ‡ç­¾æ˜¯å¦åŒ¹é…</td>
</tr>
<tr>
<td>NoVolumeZoneConflict</td>
<td>æŒ‡å®šè¯¥å­˜å‚¨çš„æ•…éšœåŒºåŸŸé™åˆ¶ï¼Œè¯„ä¼° Pod è¯·æ±‚çš„ volume åœ¨èŠ‚ç‚¹ä¸Šæ˜¯å¦å¯ç”¨</td>
</tr>
<tr>
<td>NoDiskConflict</td>
<td>æ ¹æ® Pod è¯·æ±‚çš„å·æ˜¯å¦åœ¨èŠ‚ç‚¹ä¸Šå·²æŒ‚è½½æ¥è¯„ä¼° Pod å’ŒèŠ‚ç‚¹æ˜¯å¦åŒ¹é…ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</td>
</tr>
<tr>
<td>MaxCSIVolumeCount</td>
<td>å†³å®šé™„åŠ  CSI å·çš„æ•°é‡ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é…ç½®çš„é™åˆ¶</td>
</tr>
<tr>
<td>CheckNodeMemoryPressure</td>
<td>æ£€æŸ¥èŠ‚ç‚¹å†…å­˜æ˜¯å¦å¤Ÿç”¨</td>
</tr>
<tr>
<td>CheckNodePIDPressure</td>
<td>å¦‚æœèŠ‚ç‚¹æ­£ä¸ŠæŠ¥è¿›ç¨‹IDç¨€ç¼ºï¼Œå¹¶ä¸”æ²¡æœ‰å¼‚å¸¸é…ç½®ï¼Œåˆ™ä¸ä¼šæŠŠ Pod è°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹ä¸Š</td>
</tr>
<tr>
<td>CheckNodeDiskPressure</td>
<td>å¦‚æœèŠ‚ç‚¹æ­£ä¸ŠæŠ¥å­˜å‚¨å‹åŠ›ï¼ˆæ–‡ä»¶ç³»ç»Ÿå·²æ»¡æˆ–å‡ ä¹å·²æ»¡ï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰å¼‚å¸¸é…ç½®ï¼Œåˆ™ä¸ä¼šæŠŠ Pod è°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹ä¸Š</td>
</tr>
<tr>
<td>CheckNodeCondition</td>
<td>èŠ‚ç‚¹ä¸ŠæŠ¥è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿå·²æ»¡ï¼Œç½‘ç»œä¸å¯ç”¨æˆ–è€… kubelet å°šæœªå‡†å¤‡å¥½è¿è¡Œ Podï¼Œå¦‚æœèŠ‚ç‚¹ä¸Šè®¾ç½®äº†è¿™æ ·çš„çŠ¶å†µï¼Œå¹¶ä¸”æ²¡æœ‰å¼‚å¸¸é…ç½®ï¼Œåˆ™ä¸ä¼šæŠŠ Pod è°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹ä¸Š</td>
</tr>
<tr>
<td>PodToleratesNodeTaints</td>
<td>æ£€æŸ¥ Pod çš„å®¹å¿åº¦æ˜¯å¦èƒ½å®¹å¿èŠ‚ç‚¹çš„æ±¡ç‚¹</td>
</tr>
<tr>
<td>CheckVolumeBinding</td>
<td>åŸºäº Pod çš„å·è¯·æ±‚ï¼Œè¯„ä¼° Pod æ˜¯å¦é€‚åˆèŠ‚ç‚¹ï¼Œè¿™é‡Œçš„ volume é€‚ç”¨äºæ‰€æœ‰ç»‘å®šçš„å’Œä¸ºç»‘å®šçš„ PVC</td>
</tr>
</tbody></table>
<h4 id="2ï¼‰ä¼˜å…ˆçº§-â€”â€”-Priorities"><a href="#2ï¼‰ä¼˜å…ˆçº§-â€”â€”-Priorities" class="headerlink" title="2ï¼‰ä¼˜å…ˆçº§ â€”â€” Priorities"></a>2ï¼‰ä¼˜å…ˆçº§ â€”â€” Priorities</h4><blockquote>
<p>ğŸš© <strong>Priorities</strong> ä¼˜å…ˆçº§æ˜¯ä¸€ç³»åˆ—é”®å€¼å¯¹ç»„æˆçš„ï¼Œé”®æ˜¯è¯¥ä¼˜å…ˆçº§çš„åç§°ï¼Œå€¼åˆ™æ˜¯å®ƒçš„æƒé‡å€¼ã€‚è°ƒåº¦å™¨é€šè¿‡ä¼˜å…ˆçº§å‡½æ•°æ¥å®ç°èŠ‚ç‚¹æ‰“åˆ†ï¼Œä»¥æ­¤å®Œæˆä¼˜é€‰é˜¶æ®µã€‚</p>
</blockquote>
<h5 id="1-Priorities-å¸¸ç”¨å‡½æ•°"><a href="#1-Priorities-å¸¸ç”¨å‡½æ•°" class="headerlink" title="1. Priorities å¸¸ç”¨å‡½æ•°"></a>1. Priorities å¸¸ç”¨å‡½æ•°</h5><table>
<thead>
<tr>
<th>ä¼˜å…ˆçº§å‡½æ•°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>LeastRequestedPriority</td>
<td>åå‘æœ€å°‘ request èµ„æºçš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„ä¼˜å…ˆçº§å°±ç”±èŠ‚ç‚¹ç©ºé—²èµ„æºä¸èŠ‚ç‚¹æ€»å®¹é‡çš„æ¯”å€¼ï¼Œå³ç”±ï¼ˆæ€»å®¹é‡-èŠ‚ç‚¹ä¸ŠPodçš„å®¹é‡æ€»å’Œ-æ–°Podçš„å®¹é‡ï¼‰/æ€»å®¹é‡ï¼‰æ¥å†³å®šã€‚ CPUå’Œå†…å­˜å…·æœ‰ç›¸åŒæƒé‡ï¼Œèµ„æºç©ºé—²æ¯”è¶Šé«˜çš„èŠ‚ç‚¹å¾—åˆ†è¶Šé«˜ã€‚ è®¡ç®—å…¬å¼: <code>cpu((capacity â€“ sum(requested)) * 10 / capacity) + memory((capacity â€“ sum(requested)) * 10 / capacity) / 2</code></td>
</tr>
<tr>
<td>BalancedResourceAllocation</td>
<td>åå‘èµ„æºä½¿ç”¨å¹³è¡¡çš„èŠ‚ç‚¹ï¼ŒCPUå’Œå†…å­˜ä½¿ç”¨ç‡è¶Šæ¥è¿‘çš„èŠ‚ç‚¹æƒé‡è¶Šé«˜ï¼Œ<strong>è¯¥ç­–ç•¥ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»å’Œ LeastRequestedPriorityç»„åˆä½¿ç”¨</strong>ï¼Œå°½é‡é€‰æ‹©åœ¨éƒ¨ç½² Pod åå„é¡¹èµ„æºæ›´å‡è¡¡çš„æœºå™¨ã€‚ å¦‚æœè¯·æ±‚çš„èµ„æºï¼ˆCPUæˆ–è€…å†…å­˜ï¼‰éœ€æ±‚å¤§äºèŠ‚ç‚¹çš„ capacityï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹æ°¸è¿œä¸ä¼šè¢«è°ƒåº¦åˆ°ã€‚</td>
</tr>
<tr>
<td>InterPodAffinityPriority</td>
<td>ä¾æ® Pod é—´äº²å’Œæ€§å’Œåäº²å’Œæ€§çš„ä¼˜å…ˆçº§ï¼Œé€šè¿‡è¿­ä»£ weightedPodAffinityTerm çš„å…ƒç´ è®¡ç®—å’Œï¼Œå¹¶ä¸”å¦‚æœå¯¹è¯¥èŠ‚ç‚¹æ»¡è¶³ç›¸åº”çš„ PodAffinityTermï¼Œåˆ™å°† â€œweightâ€ åŠ åˆ°å’Œä¸­ï¼Œå…·æœ‰æœ€é«˜å’Œçš„èŠ‚ç‚¹æ˜¯æœ€ä¼˜é€‰çš„ã€‚</td>
</tr>
<tr>
<td>SelectorSpreadPriority</td>
<td>ä¸ºäº†æ›´å¥½çš„é«˜å¯ç”¨ï¼Œå¯¹åŒå±äºä¸€ä¸ª Serviceã€RC æˆ– RS ä¸‹é¢çš„ Podï¼Œå°½é‡è°ƒåº¦åˆ°å¤šä¸ªä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå½“ä¸€ä¸ª Pod è¢«è°ƒåº¦çš„æ—¶å€™ï¼Œå…ˆæŸ¥æ‰¾Podå¯¹äºçš„serviceæˆ–è€…replication controllerï¼Œ ç„¶åæŸ¥æ‰¾serviceæˆ–replication controllerä¸­å·²å­˜åœ¨çš„Podï¼Œè¿è¡ŒPodè¶Šå°‘çš„èŠ‚ç‚¹çš„å¾—åˆ†è¶Šé«˜ã€‚</td>
</tr>
<tr>
<td>NodeAffinityPriority</td>
<td>æ ¹æ®èŠ‚ç‚¹çš„äº²å’Œæ€§æœºåˆ¶æ¥è®¡ç®—ä¸€ä¸ªæƒé‡å€¼ï¼Œæ”¯æŒå¤šç§æ“ä½œç¬¦ï¼ˆInã€NotInã€Existsã€DoesNotExistã€Gtã€Ltï¼‰ï¼Œè€Œä¸é™äºå¯¹èŠ‚ç‚¹labelsçš„ç²¾ç¡®åŒ¹é…ã€‚æ”¯æŒä¸¤ç§ç±»å‹çš„é€‰æ‹©å™¨ï¼Œä¸€æ˜¯ â€œhardï¼ˆrequiredDuringSchedulingIgnoredDuringExecutionï¼‰â€ é€‰æ‹©å™¨ï¼Œ å®ƒä¿è¯æ‰€é€‰çš„ä¸»æœºå¿…é¡»æ»¡è¶³æ‰€æœ‰Podå¯¹ä¸»æœºçš„è§„åˆ™è¦æ±‚ã€‚ è¿™ç§é€‰æ‹©å™¨æ›´åƒæ˜¯ä¹‹å‰çš„ NodeSelectorï¼Œåœ¨NodeSelector çš„åŸºç¡€ä¸Šå¢åŠ äº†æ›´åˆé€‚çš„è¡¨ç°è¯­æ³•ã€‚ å¦ä¸€ç§æ˜¯ â€œsoftï¼ˆpreferresDuringSchedulingIgnoredDuringExecutionï¼‰â€ é€‰æ‹©å™¨ï¼Œ å®ƒä½œä¸ºå¯¹è°ƒåº¦å™¨çš„æç¤ºï¼Œè°ƒåº¦å™¨ä¼šå°½é‡ä½†ä¸ä¿è¯æ»¡è¶³ NodeSelector çš„æ‰€æœ‰è¦æ±‚ã€‚</td>
</tr>
<tr>
<td>NodePreferAvoidPodsPriority</td>
<td>æ ¹æ®èŠ‚ç‚¹çš„æ³¨è§£ <code>scheduler.alpha.kubernetes.io/preferAvoidPods</code> å¯¹èŠ‚ç‚¹è¿›è¡Œä¼˜å…ˆçº§æ’åºã€‚å¦‚æœæ²¡æœ‰è®¾ç½® Annotationï¼ˆæ³¨é‡Šä¿¡æ¯ï¼‰ï¼ŒèŠ‚ç‚¹å¯¹äºè¯¥ Policy çš„å¾—åˆ†å°±æ˜¯10åˆ†ï¼›å¦‚æœ Node è®¾ç½®äº† Annotationï¼Œå¦‚æœæ”¹ Pod å¯¹åº”çš„ Controller æ˜¯ RC æˆ– RSï¼Œåˆ™è¯¥ node å¯¹è¯¥ policy çš„å¾—åˆ†ä¸º 0åˆ†ã€‚</td>
</tr>
<tr>
<td>MostRequestedPriority</td>
<td>æ”¯æŒæœ€å¤š request èµ„æºçš„èŠ‚ç‚¹ï¼Œè¯¥ç­–ç•¥ä¼šå°† Pod è°ƒåº¦åˆ°æ•´ä½“å·¥ä½œè´Ÿè½½æ‰€éœ€çš„æœ€å°‘çš„ä¸€ç»„èŠ‚ç‚¹ä¸Šã€‚è®¡ç®—å…¬å¼: <code>(cpu(10 sum(requested) / capacity) + memory(10 sum(requested) / capacity)) / 2</code>ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</td>
</tr>
<tr>
<td>RequestedToCapacityRatioPriority</td>
<td>ä½¿ç”¨é»˜è®¤çš„æ‰“åˆ†æ–¹æ³•æ¨¡å‹ï¼Œåˆ›å»ºåŸºäº ResourceAlloctionPriority çš„ requestedToCapacity</td>
</tr>
<tr>
<td>TaintTolerationPriority</td>
<td>ä½¿ç”¨ Pod ä¸­ tolerationList ä¸èŠ‚ç‚¹ Taint åˆ—è¡¨é¡¹è¿›è¡ŒåŒ¹é…ï¼Œé…å¯¹æˆåŠŸçš„é¡¹è¶Šå¤šï¼Œå¾—åˆ†åˆ™è¶Šä½ã€‚æ±¡ç‚¹è¶ŠåŒ¹é…ï¼Œå¾—åˆ†è¶Šä½ã€‚</td>
</tr>
<tr>
<td>ImageLocalityPriority</td>
<td>æ ¹æ® Node ä¸Šæ˜¯å¦å­˜åœ¨ Pod çš„å®¹å™¨è¿è¡Œæ‰€éœ€çš„é•œåƒï¼Œå¹¶ä¸”åˆ¤æ–­é•œåƒå¤§å°æ¥è¿›è¡Œæ‰“åˆ†ï¼Œåˆ†å€¼ä¸º 0 - 10ã€‚è¯¥è¿‡ç¨‹ä¼šéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¦‚æœæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸å­˜åœ¨é•œåƒï¼Œåˆ†å€¼å°±ä¸º0ï¼Œå¦‚æœå­˜åœ¨é•œåƒåˆ™æ ¹æ®é•œåƒå¤§å°æ¥å†³å®šåˆ†å€¼ï¼Œé•œåƒè¶Šå¤§åˆ†å€¼è¶Šé«˜ï¼Œå¦‚æœèŠ‚ç‚¹å­˜åœ¨æ‰€æœ‰æ‰€éœ€é•œåƒï¼Œåˆ†å€¼ä¸º 10ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</td>
</tr>
<tr>
<td>ServiceSpreadingPriority</td>
<td>å¯¹äºç»™å®šçš„ Serviceï¼Œæ­¤ç­–ç•¥æ—¨åœ¨ç¡®ä¿è¯¥ Service å…³è”çš„ Pod åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ å®ƒåå‘æŠŠ Pod è°ƒåº¦åˆ°æ²¡æœ‰è¯¥æœåŠ¡çš„èŠ‚ç‚¹ã€‚ æ•´ä½“æ¥çœ‹ï¼ŒService å¯¹äºå•ä¸ªèŠ‚ç‚¹æ•…éšœå˜å¾—æ›´å…·å¼¹æ€§ã€‚</td>
</tr>
<tr>
<td>EqualPriority</td>
<td>æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å‡½æ•°ï¼Œå®ƒç»™äºˆæ‰€æœ‰èŠ‚ç‚¹ç›¸ç­‰æƒé‡ã€‚</td>
</tr>
<tr>
<td>EvenPodsSpreadPriority</td>
<td>å®ç°äº† <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-topology-spread-constraints/">Pod æ‹“æ‰‘æ‰©å±•çº¦æŸ</a>çš„ä¼˜å…ˆçº§æ’åºã€‚</td>
</tr>
</tbody></table>
<h3 id="3ã€è°ƒåº¦å™¨é…ç½®"><a href="#3ã€è°ƒåº¦å™¨é…ç½®" class="headerlink" title="3ã€è°ƒåº¦å™¨é…ç½®"></a>3ã€è°ƒåº¦å™¨é…ç½®</h3><blockquote>
<p>ğŸš© å’Œ K8S çš„å…¶ä»–ç»„ä»¶ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å…¶è·¯å¾„ä¼ ç»™ <code>kube-scheduler</code> çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œæ¥æŒ‡å®šå…¶è¡Œä¸ºã€‚è¿™ç§é…ç½®æ–‡ä»¶ç§°ä¸ºè°ƒåº¦çš„æ¨¡ç‰ˆï¼ˆprofileï¼‰ï¼Œå…¶ä¸­å…è®¸é…ç½® kube-scheduler ä¸­ä¸åŒè°ƒåº¦é˜¶æ®µã€‚K8S å°†æ¯ä¸€ä¸ªé˜¶æ®µéƒ½æš´éœ²åœ¨äº†æŸä¸ªæ‰©å±•ç‚¹ä¸­ï¼Œå¹¶é€šè¿‡æ’ä»¶çš„å½¢å¼æ¥å¯¹è¿™äº›æ‰©å±•ç‚¹è¿›è¡Œç®¡ç†ã€‚</p>
</blockquote>
<h4 id="1ï¼‰åŸºç¡€é…ç½®"><a href="#1ï¼‰åŸºç¡€é…ç½®" class="headerlink" title="1ï¼‰åŸºç¡€é…ç½®"></a>1ï¼‰åŸºç¡€é…ç½®</h4><p>é€šè¿‡è¿è¡Œ <code>kube-scheduler --config &lt;filename&gt;</code> æ¥è®¾ç½®è°ƒåº¦æ¨¡ç‰ˆï¼Œè¯¥æ¨¡ç‰ˆä½¿ç”¨çš„ä¸º <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/config-api/kube-scheduler-config.v1beta1/">KubeSchedulerConfiguration (v1beta1)</a> ç»“æ„ä½“ã€‚åŸºç¡€é…ç½®å¦‚ä¸‹:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubescheduler.config.k8s.io/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">KubeSchedulerConfiguration</span><br><span class="hljs-attr">clientConnection:</span><br>  <span class="hljs-attr">kubeconfig:</span> <span class="hljs-string">/etc/srv/kubernetes/kube-scheduler/kubeconfig</span><br></code></pre></td></tr></table></figure>



<h4 id="2ï¼‰è°ƒåº¦å™¨æ‰©å±•ç‚¹"><a href="#2ï¼‰è°ƒåº¦å™¨æ‰©å±•ç‚¹" class="headerlink" title="2ï¼‰è°ƒåº¦å™¨æ‰©å±•ç‚¹"></a>2ï¼‰è°ƒåº¦å™¨æ‰©å±•ç‚¹</h4><p><code>kube-scheduler</code> æ”¯æŒæ ¹æ®ä¸åŒçš„è°ƒåº¦é…ç½®æ–‡ä»¶æ¥æŒ‡å®šæ–­è¨€ï¼ˆPredicatesï¼‰å’Œä¼˜å…ˆçº§ï¼ˆPrioritiesï¼‰ï¼Œä»¥æ­¤æ¥åˆ†åˆ«å¯¹ Node èŠ‚ç‚¹è¿›è¡Œè¿‡æ»¤å’Œæ‰“åˆ†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">```<br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">## 4ã€è‡ªå®šä¹‰è°ƒåº¦å™¨</span></span><br><br>è‡ªå®šä¹‰è°ƒåº¦å™¨ä¸»è¦çš„åŠŸèƒ½å³æŸ¥è¯¢ä¸ºè°ƒåº¦çš„ Podï¼ŒæŒ‰ç…§è‡ªå®šä¹‰çš„è°ƒåº¦ç­–ç•¥é€‰æ‹©æ–°çš„ Nodeï¼Œå¹¶å°†å…¶æ›´æ–°åˆ° Pod çš„ NodeBinding ä¸Šã€‚æˆ‘ä»¬å¯ä»¥ç”¨ shell æ¥ç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„è°ƒåº¦å™¨ã€‚<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">### 1ï¼‰è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹</span></span><br><br>```shell<br><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>SERVER=&#x27;localhost:8080&#x27;<br>while true;<br>do<br>    for PODNAME in $(kubectl --server $SERVER get pods -o json | jq &#x27;.items[] | select(.spec.schedulerName ==&quot;my-scheduler&quot;) | select(.spec.nodeName == null) | .metadata.name&#x27; | tr -d &#x27;&quot;&#x27;)<br>;<br>    do<br>        NODES=($(kubectl --server $SERVER get nodes -o json | jq &#x27;.items[].metadata.name&#x27; | tr -d &#x27;&quot;&#x27;))<br>        NUMNODES=$&#123;#NODES[@]&#125;<br>        CHOSEN=$&#123;NODES[$[ $RANDOM % $NUMNODES]]&#125;<br>        curl --header &quot;Content-Type:application/json&quot; --request POST --data &#x27;&#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Binding&quot;,&quot;metadata&quot;: &#123;&quot;name&quot;:&quot;&#x27;$PODNAME&#x27;&quot;&#125;,&quot;target&quot;: &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;<br>: &quot;Node&quot;, &quot;name&quot;: &quot;&#x27;$CHOSEN&#x27;&quot;&#125;&#125;&#x27; http://$SERVER/api/v1/namespaces/default/pods/$PODNAME/binding/<br>        echo &quot;Assigned $PODNAME to $CHOSEN&quot;<br>    done<br>    sleep 1<br>done<br></code></pre></td></tr></table></figure>

<h4 id="2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹"><a href="#2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹" class="headerlink" title="2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹"></a>2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">schedulerName:</span> <span class="hljs-string">my-scheduler</span>		 <span class="hljs-comment"># é€‰æ‹©ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ my-scheduler</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.10</span><br><br></code></pre></td></tr></table></figure>



<h3 id="5ã€èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦"><a href="#5ã€èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦" class="headerlink" title="5ã€èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦"></a>5ã€èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦</h3><h4 id="1ï¼‰èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™"><a href="#1ï¼‰èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™" class="headerlink" title="1ï¼‰èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™"></a>1ï¼‰èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™</h4><ul>
<li><strong>ç¡¬äº²å’Œæ€§:</strong> å½“ç¡¬äº²å’Œæ€§ä¸æ»¡è¶³æ—¶ï¼ŒPod ä¼šç½®äº Pending çŠ¶æ€ï¼›</li>
<li><strong>è½¯äº²å’Œæ€§:</strong> å½“è§„åˆ™ä¸æ»¡è¶³æ—¶ï¼Œèƒ½å¤Ÿæ¥å—è¢«ç¼–æ’åœ¨å…¶ä»–ä¸ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä»¥ weight å®šä¹‰ä¼˜å…ˆçº§çš„æƒé‡ï¼Œ1-100 å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼›</li>
<li>å½“èŠ‚ç‚¹æ ‡ç­¾æ”¹å˜è€Œä¸å†ç¬¦åˆæ­¤èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™æ—¶ï¼Œä»…ä¼šå¯¹æ–°å»ºçš„ Pod å¯¹è±¡ç”Ÿæ•ˆï¼Œä½†å·²åœ¨èŠ‚ç‚¹ä¸Šçš„ Pod å¹¶ä¸ä¼šè¢«ç§»é™¤ã€‚</li>
</ul>
<h4 id="2ï¼‰èŠ‚ç‚¹ç¡¬äº²å’Œæ€§-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution"><a href="#2ï¼‰èŠ‚ç‚¹ç¡¬äº²å’Œæ€§-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="2ï¼‰èŠ‚ç‚¹ç¡¬äº²å’Œæ€§ â€”â€” requiredDuringSchedulingIgnoredDuringExecution"></a>2ï¼‰èŠ‚ç‚¹ç¡¬äº²å’Œæ€§ â€”â€” requiredDuringSchedulingIgnoredDuringExecution</h4><p>æ–¹å¼ä¸€: Pod ä½¿ç”¨ <code>spec.nodeSelector</code> (åŸºäºå¯¹ç­‰å€¼å…³ç³»åŒ¹é…)</p>
<p>æ–¹å¼äºŒ: Pod ä½¿ç”¨ <code>spec.affinity</code> æ”¯æŒ <code>matchExpressions</code> å±æ€§ï¼ˆæ›´å¤æ‚çš„æ ‡ç­¾é€‰æ‹©æœºåˆ¶ï¼‰</p>
<h5 id="1-ç¤ºä¾‹-è°ƒåº¦è‡³-zone-foo-çš„èŠ‚ç‚¹"><a href="#1-ç¤ºä¾‹-è°ƒåº¦è‡³-zone-foo-çš„èŠ‚ç‚¹" class="headerlink" title="1. ç¤ºä¾‹: è°ƒåº¦è‡³ zone = foo çš„èŠ‚ç‚¹"></a>1. ç¤ºä¾‹: è°ƒåº¦è‡³ zone = foo çš„èŠ‚ç‚¹</h5><h6 id="1âƒ£ï¸-èŠ‚ç‚¹æ‰“æ ‡ç­¾"><a href="#1âƒ£ï¸-èŠ‚ç‚¹æ‰“æ ‡ç­¾" class="headerlink" title="1âƒ£ï¸ èŠ‚ç‚¹æ‰“æ ‡ç­¾"></a>1âƒ£ï¸ èŠ‚ç‚¹æ‰“æ ‡ç­¾</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl label nodes kube-node1 zone=foo<br></code></pre></td></tr></table></figure>

<h6 id="2âƒ£ï¸-yaml-æ–‡ä»¶ç¤ºä¾‹"><a href="#2âƒ£ï¸-yaml-æ–‡ä»¶ç¤ºä¾‹" class="headerlink" title="2âƒ£ï¸ yaml æ–‡ä»¶ç¤ºä¾‹"></a>2âƒ£ï¸ yaml æ–‡ä»¶ç¤ºä¾‹</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">with-required-nodeaffinity</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">affinity:</span><br>    <span class="hljs-attr">nodeAffinity:</span><br>      <span class="hljs-attr">requiredDuringSchedulingIgnoredDuringExecution:</span>  <span class="hljs-comment"># å®šä¹‰ç¡¬äº²å’Œæ€§</span><br>        <span class="hljs-attr">nodeSelectorTerms:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">matchExpressions:</span>   <span class="hljs-comment">#é›†åˆé€‰æ‹©å™¨</span><br>          <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">zone</span>,<span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>,<span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;foo&quot;</span>]&#125;<br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br></code></pre></td></tr></table></figure>



<h4 id="3ï¼‰èŠ‚ç‚¹è½¯äº²å’Œæ€§-â€”â€”-preferredDuringSchedulingIgnoredDuringExecution"><a href="#3ï¼‰èŠ‚ç‚¹è½¯äº²å’Œæ€§-â€”â€”-preferredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="3ï¼‰èŠ‚ç‚¹è½¯äº²å’Œæ€§ â€”â€” preferredDuringSchedulingIgnoredDuringExecution"></a>3ï¼‰èŠ‚ç‚¹è½¯äº²å’Œæ€§ â€”â€” preferredDuringSchedulingIgnoredDuringExecution</h4><h5 id="1-ç¤ºä¾‹"><a href="#1-ç¤ºä¾‹" class="headerlink" title="1. ç¤ºä¾‹"></a>1. ç¤ºä¾‹</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">myapp-deploy-with-node-affinity</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">myapp-pod</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">affinity:</span><br>        <span class="hljs-attr">nodeAffinity:</span><br>          <span class="hljs-attr">preferredDuringSchedulingIgnoredDuringExecution:</span>   <span class="hljs-comment">#èŠ‚ç‚¹è½¯äº²å’Œæ€§</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">60</span><br>            <span class="hljs-attr">preference:</span><br>              <span class="hljs-attr">matchExpressions:</span><br>              <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">zone</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;foo&quot;</span>]&#125;<br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">30</span><br>            <span class="hljs-attr">preference:</span><br>              <span class="hljs-attr">matchExpressions:</span><br>              <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">ssd</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span>, <span class="hljs-attr">values:</span> []&#125;<br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br></code></pre></td></tr></table></figure>



<h5 id="2-ä¼˜å…ˆçº§è°ƒåº¦åŸç†"><a href="#2-ä¼˜å…ˆçº§è°ƒåº¦åŸç†" class="headerlink" title="2. ä¼˜å…ˆçº§è°ƒåº¦åŸç†:"></a>2. ä¼˜å…ˆçº§è°ƒåº¦åŸç†:</h5><p><img src="https://img2018.cnblogs.com/blog/1293010/201910/1293010-20191025180831602-2108008874.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="6ã€Pod-èµ„æºäº²å’Œæ€§è°ƒåº¦"><a href="#6ã€Pod-èµ„æºäº²å’Œæ€§è°ƒåº¦" class="headerlink" title="6ã€Pod èµ„æºäº²å’Œæ€§è°ƒåº¦"></a>6ã€Pod èµ„æºäº²å’Œæ€§è°ƒåº¦</h3><h4 id="1ï¼‰Pod-äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„åˆ™"><a href="#1ï¼‰Pod-äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„åˆ™" class="headerlink" title="1ï¼‰Pod äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„åˆ™"></a>1ï¼‰Pod äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„åˆ™</h4><ul>
<li><code>äº²å’Œæ€§</code>ï¼šæ—¨åœ¨å°†ä¸€äº› Pod å¯¹è±¡ç»„ç»‡åœ¨ç›¸è¿‘çš„ä½ç½®ï¼ˆåŒä¸€èŠ‚ç‚¹ã€æœºæ¶ã€åŒºåŸŸã€åœ°åŒºï¼‰ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ä¸ª Pod ä¸å…·æœ‰æŸç‰¹å¾çš„ç°å­˜Pod è¿è¡Œä½ç½®çš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦æœ‰äº‹å…ˆå­˜åœ¨è¢«ä¾èµ–çš„ Pod å¯¹è±¡ã€‚</li>
<li><code>åäº²å’Œæ€§</code>ï¼šæ—¨åœ¨å°†ä¸€äº› Pod å¯¹è±¡åœ¨è¿è¡Œä½ç½®ä¸Šéš”ç¦»å¼€ï¼Œå¸¸ç”¨äºåˆ†æ•£åŒä¸€ç±»åº”ç”¨ï¼Œè°ƒåº¦å€¼ä¸åŒçš„åŒºåŸŸã€æœºæ¶æˆ–èŠ‚ç‚¹ç­‰</li>
<li>è°ƒåº¦å™¨ä¼šå°†ç¬¬ä¸€ä¸ª Pod æ”¾ç½®äºä»»ä½•ä½ç½®ï¼Œç„¶åä¸å…¶æœ‰äº²å’Œæˆ–åäº²å’Œå…³ç³»çš„Podä¼šæ ¹æ®è§„åˆ™å®ŒæˆåŠ¨æ€ç¼–æ’</li>
<li>åŸºäº <code>MatchInterPodAffinity</code>  é¢„é€‰ç­–ç•¥å®ŒæˆèŠ‚ç‚¹é¢„é€‰ï¼ŒåŸºäº <code>InterPodAffinityPriority</code> ä¼˜å…ˆçº§å‡½æ•°å®ŒæˆèŠ‚ç‚¹æ‰“åˆ†</li>
</ul>
<h4 id="2ï¼‰Pod-ç¡¬äº²å’Œè°ƒåº¦-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution"><a href="#2ï¼‰Pod-ç¡¬äº²å’Œè°ƒåº¦-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="2ï¼‰Pod ç¡¬äº²å’Œè°ƒåº¦ â€”â€” requiredDuringSchedulingIgnoredDuringExecution"></a>2ï¼‰Pod ç¡¬äº²å’Œè°ƒåº¦ â€”â€” requiredDuringSchedulingIgnoredDuringExecution</h4><h5 id="1-ç¤ºä¾‹-1"><a href="#1-ç¤ºä¾‹-1" class="headerlink" title="1. ç¤ºä¾‹"></a>1. ç¤ºä¾‹</h5><h6 id="1âƒ£ï¸-åˆ›å»ºè¢«ä¾èµ–çš„èŠ‚ç‚¹"><a href="#1âƒ£ï¸-åˆ›å»ºè¢«ä¾èµ–çš„èŠ‚ç‚¹" class="headerlink" title="1âƒ£ï¸ åˆ›å»ºè¢«ä¾èµ–çš„èŠ‚ç‚¹"></a>1âƒ£ï¸ åˆ›å»ºè¢«ä¾èµ–çš„èŠ‚ç‚¹</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl run tomcat -l app=tomcat --image tomcat:alpine<br></code></pre></td></tr></table></figure>

<h6 id="2âƒ£ï¸-yaml-æ–‡ä»¶ç¤ºä¾‹-1"><a href="#2âƒ£ï¸-yaml-æ–‡ä»¶ç¤ºä¾‹-1" class="headerlink" title="2âƒ£ï¸ yaml æ–‡ä»¶ç¤ºä¾‹"></a>2âƒ£ï¸ yaml æ–‡ä»¶ç¤ºä¾‹</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">with-pod-affinity</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">affinity:</span><br>    <span class="hljs-attr">podAffinity:</span>	<span class="hljs-comment"># äº²å’Œæ€§è°ƒåº¦</span><br>      <span class="hljs-attr">requiredDuringSchedulingIgnoredDuringExecution:</span>  <span class="hljs-comment"># ç¡¬äº²å’Œè°ƒåº¦</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">labelSelector:</span><br>          <span class="hljs-attr">matchExpressions:</span>    <span class="hljs-comment">#é›†åˆé€‰æ‹©å™¨</span><br>          <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">app</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;tomcat&quot;</span>]&#125;  <span class="hljs-comment"># é€‰æ‹©è¢«ä¾èµ–Pod</span><br>          <span class="hljs-comment"># ä¸Šé¢æ„æ€æ˜¯ï¼Œå½“å‰ pod è¦è·Ÿæ ‡ç­¾ä¸º app å€¼ä¸º tomcat çš„ pod åœ¨ä¸€èµ·</span><br>        <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">kubernetes.io/hostname</span>  <span class="hljs-comment"># æ ¹æ®æŒ‘é€‰å‡ºçš„Podæ‰€æœ‰èŠ‚ç‚¹çš„hostnameä½œä¸ºåŒä¸€ä½ç½®çš„åˆ¤å®š</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br></code></pre></td></tr></table></figure>



<h4 id="3ï¼‰Pod-è½¯äº²å’Œè°ƒåº¦-â€”â€”-preferredDuringSchedulingIgnoredDuringExecution"><a href="#3ï¼‰Pod-è½¯äº²å’Œè°ƒåº¦-â€”â€”-preferredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="3ï¼‰Pod è½¯äº²å’Œè°ƒåº¦ â€”â€” preferredDuringSchedulingIgnoredDuringExecution"></a>3ï¼‰Pod è½¯äº²å’Œè°ƒåº¦ â€”â€” preferredDuringSchedulingIgnoredDuringExecution</h4><h5 id="1-ç¤ºä¾‹-2"><a href="#1-ç¤ºä¾‹-2" class="headerlink" title="1. ç¤ºä¾‹"></a>1. ç¤ºä¾‹</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">myapp-with-preferred-pod-affinity</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">affinity:</span><br>        <span class="hljs-attr">podAffinity:</span><br>          <span class="hljs-attr">preferredDuringSchedulingIgnoredDuringExecution:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">80</span><br>            <span class="hljs-attr">podAffinityTerm:</span><br>              <span class="hljs-attr">labelSelector:</span><br>                <span class="hljs-attr">matchExpressions:</span><br>                <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">app</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;cache&quot;</span>]&#125;<br>              <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">zone</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">20</span><br>            <span class="hljs-attr">podAffinityTerm:</span><br>              <span class="hljs-attr">labelSelector:</span><br>                <span class="hljs-attr">matchExpressions:</span><br>                <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">app</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;db&quot;</span>]&#125;<br>              <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">zone</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br></code></pre></td></tr></table></figure>



<h4 id="4ï¼‰Pod-åäº²å’Œè°ƒåº¦-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution"><a href="#4ï¼‰Pod-åäº²å’Œè°ƒåº¦-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="4ï¼‰Pod åäº²å’Œè°ƒåº¦ â€”â€” requiredDuringSchedulingIgnoredDuringExecution"></a>4ï¼‰Pod åäº²å’Œè°ƒåº¦ â€”â€” requiredDuringSchedulingIgnoredDuringExecution</h4><p>å°† <code>spec.affinity.podAffinity</code> æ›¿æ¢ä¸º <code>spec.affinity.podAntiAffinity</code> å°±å¯ä»¥åè½¬è°ƒåº¦è§„åˆ™ï¼Œåäº²å’Œè°ƒåº¦ä¹Ÿåˆ†ä¸ºç¡¬è°ƒåº¦å’Œè½¯è°ƒåº¦ï¼Œä½¿ç”¨æ–¹æ³•å’Œäº²å’Œè§„åˆ™ä¸€æ ·ã€‚</p>
<h5 id="1-ç¤ºä¾‹-3"><a href="#1-ç¤ºä¾‹-3" class="headerlink" title="1. ç¤ºä¾‹"></a>1. ç¤ºä¾‹</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># åˆ›å»ºä¾èµ– pod</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-first</span><br>    <span class="hljs-attr">labels:</span> <br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>        <span class="hljs-attr">tier:</span> <span class="hljs-string">fronted</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span>      <br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-second</span><br>    <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">backend</span><br>        <span class="hljs-attr">tier:</span> <span class="hljs-string">db</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">busybox</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">busybox:latest</span><br>      <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>      <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;sleep 3600&quot;</span>]<br>    <span class="hljs-attr">affinity:</span><br>      <span class="hljs-attr">podAntiAffinity:</span>	<span class="hljs-comment"># åäº²å’Œæ€§è°ƒåº¦</span><br>        <span class="hljs-attr">requiredDuringSchedulingIgnoredDuringExecution:</span> <span class="hljs-comment"># ç¡¬äº²å’Œè°ƒåº¦</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">labelSelector:</span><br>            <span class="hljs-attr">matchExpressions:</span>			<span class="hljs-comment">#é›†åˆé€‰æ‹©å™¨</span><br>            <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">app</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;myapp&quot;</span>]&#125;		<span class="hljs-comment"># é€‰æ‹©è¢«ä¾èµ–Pod</span><br>            <span class="hljs-comment"># ä¸Šé¢æ„æ€æ˜¯ï¼Œå½“å‰ pod è¦è·Ÿæ ‡ç­¾ä¸º app å€¼ä¸º myapp çš„ pod ç›¸æ–¥</span><br>          <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">zone</span>	 <span class="hljs-comment"># æ ¹æ®æŒ‘é€‰å‡ºçš„Podæ‰€æœ‰èŠ‚ç‚¹çš„zoneä½œä¸ºåŒä¸€ä½ç½®çš„åˆ¤å®š</span><br><br></code></pre></td></tr></table></figure>



<h3 id="7ã€æ±¡ç‚¹å’Œå®¹å¿åº¦"><a href="#7ã€æ±¡ç‚¹å’Œå®¹å¿åº¦" class="headerlink" title="7ã€æ±¡ç‚¹å’Œå®¹å¿åº¦"></a>7ã€æ±¡ç‚¹å’Œå®¹å¿åº¦</h3><h4 id="1ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦è§„åˆ™"><a href="#1ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦è§„åˆ™" class="headerlink" title="1ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦è§„åˆ™"></a>1ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦è§„åˆ™</h4><ul>
<li><p><code>æ±¡ç‚¹ â€”â€” taints</code>:  æ±¡ç‚¹æ˜¯å®šä¹‰åœ¨èŠ‚ç‚¹ä¸Šçš„é”®å€¼å‹å±æ€§æ•°æ®ï¼Œç”¨äºè®©èŠ‚ç‚¹æ‹’ç»å°† Pod è°ƒåº¦è¿è¡Œäºå…¶ä¸Šï¼Œé™¤é Pod æœ‰æ¥çº³èŠ‚ç‚¹æ±¡ç‚¹çš„å®¹å¿åº¦</p>
</li>
<li><p><code>å®¹å¿åº¦ â€”â€” tolerations</code>: å®¹å¿åº¦æ˜¯å®šä¹‰åœ¨ Pod ä¸Šçš„é”®å€¼å‹å±æ€§æ•°æ®ï¼Œç”¨äºé…ç½®å¯å®¹å¿çš„æ±¡ç‚¹ï¼Œè°ƒåº¦å™¨åœ¨è°ƒåº¦æ—¶ä¼šå°† Pod è°ƒåº¦å­˜åœ¨å¯å®¹å¿æ±¡ç‚¹æˆ–è€…æ²¡æœ‰æ±¡ç‚¹çš„ Node ä¸Š</p>
</li>
<li><p>ä½¿ç”¨ <code>PodToleratesNodeTaints</code> é¢„é€‰ç­–ç•¥å’Œ <code>TaintTolerationPriority</code> ä¼˜é€‰å‡½æ•°å®Œæˆè¯¥æœºåˆ¶</p>
</li>
<li><p>èŠ‚ç‚¹äº²å’Œæ€§ä½¿ Pod å¯¹è±¡å¯ä»¥è¢«å¸å¼•åˆ°ä¸€ç»„ç‰¹å®šçš„èŠ‚ç‚¹ä¸Šï¼ˆnodeSelector å’Œ affinityï¼‰</p>
</li>
</ul>
<h4 id="2ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦çš„å®šä¹‰"><a href="#2ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦çš„å®šä¹‰" class="headerlink" title="2ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦çš„å®šä¹‰"></a>2ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦çš„å®šä¹‰</h4><h5 id="1-å®šä¹‰è§„åˆ™"><a href="#1-å®šä¹‰è§„åˆ™" class="headerlink" title="1. å®šä¹‰è§„åˆ™"></a>1. å®šä¹‰è§„åˆ™</h5><ul>
<li><p>ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é…ç½®å¤šä¸ªæ±¡ç‚¹ï¼Œä¸€ä¸ª Pod ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªå®¹å¿åº¦</p>
</li>
<li><p>æ±¡ç‚¹å®šä¹‰äº <code>node.spec.taints</code> ï¼Œå®¹å¿åº¦å®šä¹‰äº <code>pods.spec.tolerations</code></p>
</li>
<li><p>è¯­æ³•ï¼š<code>key=value:effect</code></p>
</li>
<li><p>åŒä¸€ä¸ªé”®å€¼æ•°æ®ï¼Œeffect ä¸åŒï¼Œä¹Ÿå±äºä¸åŒçš„æ±¡ç‚¹</p>
</li>
</ul>
<h5 id="2-effect-å®šä¹‰æ’æ–¥ç­‰çº§"><a href="#2-effect-å®šä¹‰æ’æ–¥ç­‰çº§" class="headerlink" title="2. effect å®šä¹‰æ’æ–¥ç­‰çº§:"></a>2. effect å®šä¹‰æ’æ–¥ç­‰çº§:</h5><ul>
<li><p><code>NoSchedule</code>: é›¶å®¹å¿ï¼Œä½†å€¼å½±å“è°ƒåº¦è¿‡ç¨‹ï¼Œå·²ç»è°ƒåº¦ä¸Šå»çš„ Pod ä¸ä¼šå—å½±å“ï¼Œä¸”ä»…ä¼šå¯¹æ–°å¢çš„ pod ç”Ÿæ•ˆï¼ˆç»ä¸è°ƒåº¦ï¼‰</p>
</li>
<li><p><code>PreferNoSchedule</code>: è½¯çº¦æŸï¼ŒèŠ‚ç‚¹ç°å­˜çš„ Pod ä¸ä¼šå—å½±å“ï¼Œå¦‚æœå®åœ¨æ²¡æœ‰ç¬¦åˆçš„èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥è°ƒåº¦ä¸Šäº†ï¼ˆå°½é‡ä¸è°ƒåº¦ï¼‰</p>
</li>
<li><p><code>NoExecute</code>: é›¶å®¹å¿ï¼Œä¸ä½†ä¸èƒ½è°ƒåº¦ï¼Œä¸”è¿åŸæœ‰ Pod å¯¹è±¡ä¹Ÿä¼šè¢«é©±é€ï¼Œä¼šå½±å“å·²ç»åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ Pod</p>
</li>
</ul>
<h4 id="3ï¼‰ç®¡ç†èŠ‚ç‚¹çš„æ±¡ç‚¹"><a href="#3ï¼‰ç®¡ç†èŠ‚ç‚¹çš„æ±¡ç‚¹" class="headerlink" title="3ï¼‰ç®¡ç†èŠ‚ç‚¹çš„æ±¡ç‚¹"></a>3ï¼‰ç®¡ç†èŠ‚ç‚¹çš„æ±¡ç‚¹</h4><h5 id="1-ç»™èŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹"><a href="#1-ç»™èŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹" class="headerlink" title="1. ç»™èŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹"></a>1. ç»™èŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹</h5><h6 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•:"></a>è¯­æ³•:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl taint node &lt;node-name&gt; &lt;key&gt;=&lt;value&gt;:&lt;effect&gt;<br></code></pre></td></tr></table></figure>

<h6 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹:"></a>ç¤ºä¾‹:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl taint node node2 node-type=production:NoShedule<br></code></pre></td></tr></table></figure>

<h5 id="2-æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹"><a href="#2-æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹" class="headerlink" title="2. æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹"></a>2. æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹</h5><h6 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•:"></a>è¯­æ³•:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get nodes &lt;nodename&gt; -o go-template=&#123;&#123;.spec.taints&#125;&#125;<br></code></pre></td></tr></table></figure>

<h6 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹:"></a>ç¤ºä¾‹:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get nodes node2 -o go-template=&#123;&#123;.spec.taints&#125;&#125;<br></code></pre></td></tr></table></figure>

<h5 id="3-åˆ é™¤èŠ‚ç‚¹æ±¡ç‚¹"><a href="#3-åˆ é™¤èŠ‚ç‚¹æ±¡ç‚¹" class="headerlink" title="3. åˆ é™¤èŠ‚ç‚¹æ±¡ç‚¹"></a>3. åˆ é™¤èŠ‚ç‚¹æ±¡ç‚¹</h5><h6 id="è¯­æ³•-2"><a href="#è¯­æ³•-2" class="headerlink" title="è¯­æ³•:"></a>è¯­æ³•:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl taint node &lt;node-name&gt; &lt;key&gt;[:&lt;effect&gt;]-		# åé¢çš„ - å°±æ˜¯åˆ é™¤çš„æ„æ€<br></code></pre></td></tr></table></figure>

<h6 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹:"></a>ç¤ºä¾‹:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤ key ä¸º node-type, effect ä¸º NoSchedule çš„æ±¡ç‚¹</span><br>kubectl taint node node1 node-type:NoSchedule-<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤ key ä¸º node-type çš„æ‰€æœ‰æ±¡ç‚¹</span><br>kubectl taint node node1 node-type-<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤èŠ‚ç‚¹çš„æ‰€æœ‰æ±¡ç‚¹</span><br>kubectl patch nodes node1 -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;taints&quot;:[]&#125;&#125;&#x27;<br></code></pre></td></tr></table></figure>



<h4 id="4ï¼‰åœ¨-Pod-ä¸Šå®šä¹‰å®¹å¿åº¦"><a href="#4ï¼‰åœ¨-Pod-ä¸Šå®šä¹‰å®¹å¿åº¦" class="headerlink" title="4ï¼‰åœ¨ Pod ä¸Šå®šä¹‰å®¹å¿åº¦"></a>4ï¼‰åœ¨ Pod ä¸Šå®šä¹‰å®¹å¿åº¦</h4><ul>
<li>åœ¨ <code>spec.tolerations</code> å®šä¹‰ Pod çš„å®¹å¿åº¦</li>
<li><code>tolerationSeconds</code> åˆ™ç”¨äºå®šä¹‰å»¶è¿Ÿé©±é€ Pod çš„æ—¶é•¿ï¼Œå•ä½ä¸ºç§’ </li>
<li><code>operator</code> çš„é»˜è®¤å€¼ä¸º Equal</li>
</ul>
<h5 id="1-ç­‰å€¼åˆ¤æ–­è¯­æ³•"><a href="#1-ç­‰å€¼åˆ¤æ–­è¯­æ³•" class="headerlink" title="1. ç­‰å€¼åˆ¤æ–­è¯­æ³•:"></a>1. ç­‰å€¼åˆ¤æ–­è¯­æ³•:</h5><p>å®¹å¿åº¦ä¸æ±¡ç‚¹åœ¨ keyã€valueã€effect ä¸Šä¸‰è€…å®Œå…¨åŒ¹é…</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tolerations:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;key1&quot;</span><br>  <span class="hljs-attr">operator:</span> <span class="hljs-string">&quot;Equal&quot;</span>		<span class="hljs-comment"># åˆ¤æ–­æ¡ä»¶ä¸º Equal</span><br>  <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;value1&quot;</span><br>  <span class="hljs-attr">effect:</span> <span class="hljs-string">&quot;NoExecute&quot;</span><br>  <span class="hljs-attr">tolerationSeconds:</span> <span class="hljs-number">3600</span>	 <br>  <span class="hljs-comment"># é€šå¸¸è€Œè¨€è®¾ç½®èŠ‚ç‚¹æ±¡ç‚¹ä¸º NoExecute æ—¶ï¼Œä¼šç«‹å³é©±é€èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ä¸èƒ½å®¹å¿è¯¥æ±¡ç‚¹çš„ Podï¼ŒæŒ‡å®š tolerationSeconds åˆ™å¯ä»¥å»¶è¿Ÿä¸€æ®µæ—¶é—´å†é©±é€è¿™äº› Pod</span><br></code></pre></td></tr></table></figure>

<h5 id="2-å­˜åœ¨æ€§åˆ¤æ–­ç¤ºä¾‹"><a href="#2-å­˜åœ¨æ€§åˆ¤æ–­ç¤ºä¾‹" class="headerlink" title="2. å­˜åœ¨æ€§åˆ¤æ–­ç¤ºä¾‹:"></a>2. å­˜åœ¨æ€§åˆ¤æ–­ç¤ºä¾‹:</h5><p>keyã€effect ä¸Šå®Œå…¨åŒ¹é…ï¼Œvalue ä½¿ç”¨ç©ºå€¼</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tolerations:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;key1&quot;</span><br>  <span class="hljs-attr">operator:</span> <span class="hljs-string">&quot;Exists&quot;</span>	<span class="hljs-comment"># åˆ¤æ–­æ¡ä»¶ä¸º Existsï¼Œå³åªè¦æ±¡ç‚¹æ˜¯å­˜åœ¨çš„ï¼Œå°±å¯ä»¥åŒ¹é…</span><br>  <span class="hljs-attr">effect:</span> <span class="hljs-string">&quot;NoSchedule&quot;</span><br></code></pre></td></tr></table></figure>

<h5 id="3-yaml-ç¤ºä¾‹"><a href="#3-yaml-ç¤ºä¾‹" class="headerlink" title="3. yaml ç¤ºä¾‹:"></a>3. yaml ç¤ºä¾‹:</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">myapp-deploy</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br>    <span class="hljs-attr">selector:</span><br>        <span class="hljs-attr">matchLabels:</span><br>            <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>            <span class="hljs-attr">release:</span> <span class="hljs-string">canary</span><br>    <span class="hljs-attr">template:</span><br>        <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">labels:</span><br>                <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>                <span class="hljs-attr">release:</span> <span class="hljs-string">canary</span><br>        <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">containers:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>            <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br>            <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br>            <span class="hljs-attr">tolerations:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;node-type&quot;</span><br>              <span class="hljs-attr">operator:</span> <span class="hljs-string">&quot;Equal&quot;</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-attr">&quot;production&quot;:</span><br>              <span class="hljs-attr">effect:</span> <span class="hljs-string">&quot;NoExecute&quot;</span><br>              <span class="hljs-attr">tolerationSeconds:</span> <span class="hljs-number">3600</span><br></code></pre></td></tr></table></figure>



<h4 id="5ï¼‰åŸºäºæ±¡ç‚¹çš„é©±é€æœºåˆ¶"><a href="#5ï¼‰åŸºäºæ±¡ç‚¹çš„é©±é€æœºåˆ¶" class="headerlink" title="5ï¼‰åŸºäºæ±¡ç‚¹çš„é©±é€æœºåˆ¶"></a>5ï¼‰åŸºäºæ±¡ç‚¹çš„é©±é€æœºåˆ¶</h4><p>ä¸Šé¢å·²ç»æåˆ°æ±¡ç‚¹çš„ <code>effect</code> å€¼ä¸º <code>NoExecute</code> æ—¶ä¼šå½±å“è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ Podï¼Œå¦‚åŒå¦‚ä¸‹å½¢å¼:</p>
<ul>
<li>å¦‚æœ Pod ä¸èƒ½å®¹å¿ effect ä¸º NoExecute çš„æ±¡ç‚¹ï¼Œé‚£ä¹ˆ Pod ä¼šé©¬ä¸Šè¢«é©±é€</li>
<li>å¦‚æœ Pod å¯ä»¥å®¹å¿ effect ä¸º NoExecute çš„æ±¡ç‚¹ï¼Œä½†æ˜¯åœ¨å®¹å¿åº¦è®¾ç½®ä¸­æ²¡æœ‰æŒ‡å®š <code>tolerationSeconds</code>ï¼Œåˆ™ Pod ä¼šä¸€ç›´åœ¨è¯¥èŠ‚ç‚¹è¿è¡Œ</li>
<li>å¦‚æœ Pod å¯ä»¥å®¹å¿ effect ä¸º NoExecute çš„æ±¡ç‚¹ï¼Œå¹¶ä¸”æŒ‡å®šäº† <code>tolerationSeconds</code>ï¼Œåˆ™ Pod ä¼šåœ¨è¯¥èŠ‚ç‚¹è¿è¡ŒæŒ‡å®šçš„æ—¶é•¿ï¼Œç„¶åè¢«é©±é€</li>
</ul>
<p>K8S æœ¬èº«ä¹Ÿä¼šåŸºäºæŸäº›å¼‚å¸¸çŠ¶æ€ï¼ŒèŠ‚ç‚¹æ§åˆ¶å™¨æˆ– kubelet ä¼šè‡ªåŠ¨ç»™èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªå†…ç½®æ±¡ç‚¹ï¼Œå¹¶è®¾ç½® effect ä¸º <code>NoExecute</code> ï¼Œè¿›è¡Œ Pod é©±é€ã€‚å½“å¼‚å¸¸çŠ¶æ€æ¢å¤æ­£å¸¸åï¼Œå°±ä¼šç§»é™¤ç›¸å…³çš„æ±¡ç‚¹ã€‚</p>
<h5 id="1-å†…ç½®æ±¡ç‚¹"><a href="#1-å†…ç½®æ±¡ç‚¹" class="headerlink" title="1. å†…ç½®æ±¡ç‚¹"></a>1. å†…ç½®æ±¡ç‚¹</h5><table>
<thead>
<tr>
<th>å†…ç½®æ±¡ç‚¹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>node.kubernetes.io/not-ready</td>
<td>èŠ‚ç‚¹æœªå°±ç»ªï¼Œç›¸å½“äºèŠ‚ç‚¹çŠ¶æ€ <code>Ready</code> çš„å€¼ä¸º <code>False</code>ï¼Œé»˜è®¤ <code>tolerationSeconds=300</code>ï¼ˆDaemonSet ä¸ä¼šè®¾ç½®<code>tolerationSeconds</code>ï¼‰</td>
</tr>
<tr>
<td>node.kubernetes.io/unreachable</td>
<td>èŠ‚ç‚¹æ§åˆ¶å™¨è®¿é—®ä¸åˆ°è¯¥èŠ‚ç‚¹ï¼Œç›¸å½“äºèŠ‚ç‚¹çŠ¶æ€ <code>Ready</code> çš„å€¼ä¸º <code>Unknown</code>ï¼Œé»˜è®¤ <code>tolerationSeconds=300</code>ï¼ˆDaemonSet ä¸ä¼šè®¾ç½®<code>tolerationSeconds</code>ï¼‰</td>
</tr>
<tr>
<td>node.kubernetes.io/memory-pressure</td>
<td>èŠ‚ç‚¹å­˜åœ¨å†…å­˜å‹åŠ›</td>
</tr>
<tr>
<td>node.kubernetes.io/disk-pressure</td>
<td>èŠ‚ç‚¹å­˜åœ¨ç£ç›˜å‹åŠ›</td>
</tr>
<tr>
<td>node.kubernetes.io/pid-pressure</td>
<td>èŠ‚ç‚¹å­˜åœ¨ pid å‹åŠ›</td>
</tr>
<tr>
<td>node.kubernetes.io/network-unavailable</td>
<td>èŠ‚ç‚¹ç½‘ç»œä¸å¯ç”¨</td>
</tr>
<tr>
<td>node.kubernetes.io/unschedulable</td>
<td>èŠ‚ç‚¹ä¸å¯è°ƒåº¦</td>
</tr>
<tr>
<td>node.cloudprovider.kubernetes.io/uninitialized</td>
<td>å¦‚æœ kubelet å¯åŠ¨æ—¶æŒ‡å®šäº†ä¸€ä¸ª â€œå¤–éƒ¨â€ äº‘å¹³å°é©±åŠ¨ï¼Œå®ƒå°†ä¼šç»™å½“å‰èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ±¡ç‚¹ï¼Œå°†å…¶æ ‡å¿—ä¸ºä¸å¯ç”¨ã€‚ç„¶ååœ¨ cloud-controller-manager çš„ä¸€ä¸ªæ§åˆ¶å™¨åˆå§‹åŒ–è¯¥èŠ‚ç‚¹åï¼Œkubelet ä¼šå°†è¿™ä¸ªæ±¡ç‚¹åˆ é™¤ã€‚</td>
</tr>
</tbody></table>
<blockquote>
<p>ğŸš© äº‹å®ä¸Šï¼ŒK8S ä¼šä»¥é™å®šé€Ÿç‡çš„æ–¹å¼å»æ·»åŠ å†…ç½®æ±¡ç‚¹ï¼Œè¿™æ ·å¯ä»¥é¿å… Pod è¢«å¤§é‡é©±é€ï¼Œç»™å…¶ä»–ç»„ä»¶é€ æˆå‹åŠ›ã€‚æ¯”å¦‚ï¼Œmaster èŠ‚ç‚¹å’Œ node é€šä¿¡ä¸­æ–­çš„åœºæ™¯ã€‚</p>
<p>ç»“åˆè¿™ç§ç‰¹æ€§ï¼Œé…åˆ <code>tolerationSeconds</code> çš„ä½¿ç”¨ï¼Œå°±å¯ä»¥æŒ‡å®š Pod åœ¨èŠ‚ç‚¹å‡ºç°ä¸Šè¿°é—®é¢˜æ—¶è¿˜ä¼šåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œå¤šä¹…ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªä½¿ç”¨äº†è®¸å¤šæœ¬åœ°çŠ¶æ€çš„åº”ç”¨åœ¨ç½‘ç»œæ–­å¼€æ—¶ï¼Œä»ç„¶å¸Œæœ›åœç•™åœ¨å½“å‰èŠ‚ç‚¹ä¸Šè¿è¡Œè¾ƒé•¿çš„æ—¶é—´ï¼Œæ„¿æ„ç­‰å¾…ç½‘ç»œæ¢å¤ï¼Œä¸æ„¿æ„è¢«é©±é€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPod çš„å®¹å¿åº¦å¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·çš„:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tolerations:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;node.kubernetes.io/unreachable&quot;</span><br>  <span class="hljs-attr">operator:</span> <span class="hljs-string">&quot;Exists&quot;</span><br>  <span class="hljs-attr">effect:</span> <span class="hljs-string">&quot;NoExecute&quot;</span><br>  <span class="hljs-attr">tolerationSeconds:</span> <span class="hljs-number">6000</span><br></code></pre></td></tr></table></figure>
</blockquote>
<h3 id="8ã€Pod-ä¼˜å…ˆçº§è°ƒåº¦-äº†è§£"><a href="#8ã€Pod-ä¼˜å…ˆçº§è°ƒåº¦-äº†è§£" class="headerlink" title="8ã€Pod ä¼˜å…ˆçº§è°ƒåº¦ (äº†è§£)"></a>8ã€Pod ä¼˜å…ˆçº§è°ƒåº¦ (äº†è§£)</h3><p>Pod çš„ä¼˜å…ˆçº§ã€æŠ¢å åŠŸèƒ½æ˜¯ä» K8S v1.8 å¼€å§‹å¼•ç”¨çš„åŠŸèƒ½ï¼Œåœ¨ v1.11 è¿›å…¥ beta çŠ¶æ€ï¼Œåˆ°äº† v1.14 åæ­£å¼è¿›å…¥ GA é˜¶æ®µï¼Œå·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿç¨³å®šçš„ç‰¹æ€§äº†ã€‚ä» v1.14 èµ·ï¼Œè¯¥åŠŸèƒ½ï¼ˆfeature <code>PodPriority</code>ï¼‰ é»˜è®¤æ˜¯å¼€å¯çš„ã€‚ä¹‹å‰çš„ç‰ˆæœ¬å¦‚è¦ä½¿ç”¨åˆ™éœ€è¦åŒæ—¶ä¸º kube-apiserverã€kube-schedulerã€kubelet çš„ <code>--feature-gates</code> å‚æ•°æ·»åŠ  <code>PodPriority=true</code>ã€‚</p>
<p>Pod çš„ä¼˜å…ˆçº§ï¼Œæ•…åæ€ä¹‰å°±æ˜¯å°† Pod åŒºåˆ†é‡è¦ç¨‹åº¦ï¼Œå°†èµ„æºä¼˜å…ˆæä¾›ç»™ä¸ªé‡è¦ç¨‹åº¦æ›´é«˜çš„ Podï¼Œä»¥æ­¤æ¥æä¾›èµ„æºçš„å¯ç”¨ç‡ï¼Œå¹¶ä¿éšœé‡è¦æœåŠ¡çš„æœåŠ¡è´¨é‡ã€‚</p>
<h4 id="1ï¼‰ç³»ç»Ÿé»˜è®¤ä¼˜å…ˆçº§"><a href="#1ï¼‰ç³»ç»Ÿé»˜è®¤ä¼˜å…ˆçº§" class="headerlink" title="1ï¼‰ç³»ç»Ÿé»˜è®¤ä¼˜å…ˆçº§"></a>1ï¼‰ç³»ç»Ÿé»˜è®¤ä¼˜å…ˆçº§</h4><p>æŸ¥çœ‹:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get priorityclasses.scheduling.k8s.io<br></code></pre></td></tr></table></figure>

<p>è¿”å›å¦‚ä¸‹:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME                      VALUE        GLOBAL-DEFAULT   AGE<br>system-cluster-critical   2000000000   false            7d<br>system-node-critical      2000001000   false            7d<br></code></pre></td></tr></table></figure>



<h4 id="2ï¼‰ä½¿ç”¨-Pod-ä¼˜å…ˆçº§å’ŒæŠ¢å "><a href="#2ï¼‰ä½¿ç”¨-Pod-ä¼˜å…ˆçº§å’ŒæŠ¢å " class="headerlink" title="2ï¼‰ä½¿ç”¨ Pod ä¼˜å…ˆçº§å’ŒæŠ¢å "></a>2ï¼‰ä½¿ç”¨ Pod ä¼˜å…ˆçº§å’ŒæŠ¢å </h4><p>é¦–å…ˆï¼Œæ–°å¢ä¸€ä¸ªæˆ–å¤šä¸ª <code>PriorityClass</code> ï¼Œç¤ºä¾‹å¦‚ä¸‹:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">apiVersion: v1<br>kind: PriorityClass<br>metadata:<br>  name: high-priority<br>value: 1000000					# value ä¸º 32 ä½æ•´æ•°ï¼Œç”¨äºè¡¨ç¤ºæƒé‡ï¼Œæƒé‡è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜<br>globalDefault: false		# ç”¨äºæœªé…ç½® PriorityClassName çš„ Podï¼Œå½“æ•´ä¸ªé›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª PriorityClass æ—¶ï¼Œå¯å°†å…¶è®¾ç½®ä¸º true<br>description: &quot;This priority class should be used for xxx service pods only.&quot;<br></code></pre></td></tr></table></figure>

<p>ç„¶ååœ¨åˆ›å»º Pod æ—¶ï¼Œåœ¨ PodSpec ä¸­å°† PriorityClassName è®¾ç½®ä¸ºæ–°å¢çš„ PriorityClassï¼Œç¤ºä¾‹å¦‚ä¸‹:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">env:</span> <span class="hljs-string">test</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>  <span class="hljs-attr">priorityClassName:</span> <span class="hljs-string">high-priority</span><br></code></pre></td></tr></table></figure>




            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Kubernetes/">Kubernetes</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Kubernetes-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C/">Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/21/%E6%B7%B1%E5%85%A5-Kubernetes-%E2%80%94%E2%80%94-informer-%E6%A8%A1%E5%9D%97/">
                        <span class="hidden-mobile">æ·±å…¥ Kubernetes â€”â€” informer æ¨¡å—</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


</body>
</html>
