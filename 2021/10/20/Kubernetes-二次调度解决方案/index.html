

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.png">
  <link rel="icon" href="/img/icon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="Kubernetes äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ">
  <meta name="author" content="Tareya">
  <meta name="keywords" content="">
  
  <title>Kubernetes äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ - ä¹±åºæ—¶ç©º</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"tareya.github.io","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ä¹±åºæ—¶ç©º</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/background/lomo5.jpeg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Kubernetes äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-10-20 13:13" pubdate>
        2021å¹´10æœˆ20æ—¥ ä¸‹åˆ
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.8k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      45
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Kubernetes äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ</h1>
            
            <div class="markdown-body">
              <h1 id="Kubernetes-äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ"><a href="#Kubernetes-äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Kubernetes äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ"></a>Kubernetes äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ</h1><span id="more"></span>





<h2 id="ä¸€ã€é—®é¢˜æè¿°"><a href="#ä¸€ã€é—®é¢˜æè¿°" class="headerlink" title="ä¸€ã€é—®é¢˜æè¿°"></a>ä¸€ã€é—®é¢˜æè¿°</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>kube-scheduler</code> åœ¨ Kubernetes é›†ç¾¤ä¸­è´Ÿè´£è°ƒåº¦çš„ç»„ä»¶ã€‚ä½†æ˜¯é»˜è®¤çš„è°ƒåº¦æœºåˆ¶å´å¹¶ä¸é‚£ä¹ˆå‹å–„ï¼Œå³ä½¿æˆ‘ä»¬ä¸º Node é…ç½®äº†äº²å’Œæˆ–åäº²å’Œï¼Œä»ç„¶ä¼šå‡ºç°æŸäº›èŠ‚ç‚¹è´Ÿè½½é«˜ï¼ŒæŸäº›èŠ‚ç‚¹åˆ™å‡ ä¹ç©ºé—²çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸ºæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ pod åˆ›å»ºè¿è¡Œåï¼Œ<code>scheduler</code> å¹¶ä¸ä¼šå†æ¬¡å°è¯•é‡æ–°è°ƒåº¦å®ƒï¼Œé™¤éè§¦å‘é©±é€ï¼Œæ‰æœ‰å¯èƒ½æ˜¯è¿™äº› Pod å†æ¬¡è°ƒåº¦v ã€‚</p>
<p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­å›½ï¼Œæˆ‘ä»¬çš„ K8S åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°±ç¢°åˆ°äº†è¿™ç§æƒ…å†µã€‚pod çš„è°ƒåº¦ç»å¸¸ä¼šå‡ºç°å€¾æ–œçš„æƒ…å†µï¼Œå¤§é‡å‰¯æœ¬ç§¯å‹åœ¨ä¸ªåˆ« node èŠ‚ç‚¹ä¸Šï¼Œå°†èŠ‚ç‚¹èµ„æºå ç”¨å®Œï¼ˆè¿™é‡Œä¸»è¦ä½“ç°åœ¨å†…å­˜æ–¹é¢ï¼‰ï¼Œå¦‚ä¸‹å›¾çš„æƒ…å†µï¼š</p>
<p>Node15ã€Node16 å†…å­˜èµ„æºä½¿ç”¨ç‡ä»¥100%äº†ï¼Œä½†æ˜¯ç©ºé—²çš„èŠ‚ç‚¹å†…å­˜ä½¿ç”¨ç‡å¯èƒ½æœªè¶…è¿‡ 50%ï¼Œè¿™ç§åˆ†å¸ƒçš„å€¾æ–œäº‹å®ä¸Šæ˜¯ä¸å¥åº·çš„ã€‚</p>
<p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211020161447795.png" srcset="/img/loading.gif" lazyload alt="image-20211020161447795"></p>
<p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211020161535235.png" srcset="/img/loading.gif" lazyload alt="image-20211020161535235"></p>
<p>ç”±äºæˆ‘ä»¬åœ¨ kubelet ä¸­è®¾ç½®äº† evictionï¼Œä¹Ÿå°±æ˜¯é©±é€æœºåˆ¶ï¼Œåœ¨èŠ‚ç‚¹èµ„æºç´§å¼ æ—¶ï¼Œé©±é€æœºåˆ¶å°±ä¼šå¼€å¯ï¼Œä»¥æ­¤æ¥å°è¯•å›æ”¶èŠ‚ç‚¹èµ„æºã€‚</p>
<p>ä½†æ˜¯è¿™ç§é€šè¿‡ kubelet é©±é€çš„æ–¹å¼æ˜¯ååˆ†è¢«åŠ¨çš„ï¼Œå¹¶ä¸èƒ½åŠæ—¶çš„è§£å†³èµ„æºé€‚åº”å€¾æ–œçš„é—®é¢˜ã€‚è™½ç„¶ K8S åŸå§‹çš„è°ƒåº¦æä¾›äº†ä¸€äº›ä¼˜å…ˆçº§è°ƒåº¦å’Œè‡ªå®šä¹‰è°ƒåº¦çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¹¶ä¸çµæ´»ï¼Œæœ‰äº›ä¹Ÿç¼ºä¹åˆç†æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¦ä¸€ç§æ–¹æ¡ˆå»è§£å†³è¿™ç±»é—®é¢˜ã€‚</p>
<p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å† Pod åˆæ¬¡è°ƒåº¦æ—¶ï¼Œå°±è§£å†³èµ„æºå€¾æ–œçš„é—®é¢˜ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥åœ¨èµ„æºå‘ç”Ÿä¸å¹³è¡¡æ—¶è§¦å‘ Pod çš„å†ä¸€æ¬¡çš„è°ƒåº¦ï¼Œä»è€Œå›æ”¶èµ„æºï¼Œè¿™ä¹Ÿèƒ½å¤Ÿè§£å†³å€¾æ–œé—®é¢˜ã€‚è¿™ä¹ŸåŠæ—¶æœ¬æ–¹æ¡ˆæ‰€æ¶‰åŠçš„æ¦‚å¿µ â€”â€” äºŒæ¬¡è°ƒåº¦ã€‚</p>
<h2 id="äºŒã€Kubernetes-çš„é©±é€ã€è°ƒåº¦åŸç†"><a href="#äºŒã€Kubernetes-çš„é©±é€ã€è°ƒåº¦åŸç†" class="headerlink" title="äºŒã€Kubernetes çš„é©±é€ã€è°ƒåº¦åŸç†"></a>äºŒã€Kubernetes çš„é©±é€ã€è°ƒåº¦åŸç†</h2><h3 id="1ã€Kubernetes-é»˜è®¤è°ƒåº¦æœºåˆ¶-â€”â€”-kube-scheduler"><a href="#1ã€Kubernetes-é»˜è®¤è°ƒåº¦æœºåˆ¶-â€”â€”-kube-scheduler" class="headerlink" title="1ã€Kubernetes é»˜è®¤è°ƒåº¦æœºåˆ¶ â€”â€” kube-scheduler"></a>1ã€Kubernetes é»˜è®¤è°ƒåº¦æœºåˆ¶ â€”â€” kube-scheduler</h3><p>è°ƒåº¦å™¨æ˜¯ä¸€ä¸ªæ§åˆ¶é¢çš„è¿›ç¨‹ï¼Œå®ƒè´Ÿè´£å°† Pod æŒ‡æ´¾åˆ° Node èŠ‚ç‚¹ä¸Šã€‚è°ƒåº¦åŸºäºçº¦æŸå’Œå¯ç”¨èµ„æºä¸ºè°ƒåº¦é˜Ÿåˆ—ä¸­æ¯ä¸ª Pod ç¡®å®šå…¶åˆé€‚çš„è¿è¡Œä½ç½®ã€‚ä¹‹åï¼Œè°ƒåº¦å™¨ä¼šå¯¹æ‰€æœ‰åˆé€‚çš„èŠ‚ç‚¹è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œå¹¶å°† Pod ç»‘å®šåˆ°å¾—åˆ†æœ€é«˜çš„èŠ‚ç‚¹å»ã€‚</p>
<p>é€šè¿‡å¯¹äºå…¶åŸç†çš„å­¦ä¹ ï¼Œå¯ä»¥è¿›ä¸€æ­¥äº†è§£ K8S ä¸­çš„è°ƒåº¦åˆ°åº•æ˜¯åœ¨åšä»€ä¹ˆã€‚ç›¸å…³å…·ä½“å†…å®¹å¯ä»¥çœ‹ä¹‹å‰çš„åšæ–‡: <a href="https://tareya.github.io/2021/10/27/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-scheduler/#%E4%B8%80%E3%80%81K8S-%E8%B0%83%E5%BA%A6%E5%8E%9F%E7%90%86%E5%92%8C%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5">K8S è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥</a></p>
<h3 id="2ã€Kubernetes-èŠ‚ç‚¹å‹åŠ›é©±é€-â€”â€”-kubelet-çš„é©±é€æœºåˆ¶"><a href="#2ã€Kubernetes-èŠ‚ç‚¹å‹åŠ›é©±é€-â€”â€”-kubelet-çš„é©±é€æœºåˆ¶" class="headerlink" title="2ã€Kubernetes èŠ‚ç‚¹å‹åŠ›é©±é€ â€”â€” kubelet çš„é©±é€æœºåˆ¶"></a>2ã€Kubernetes èŠ‚ç‚¹å‹åŠ›é©±é€ â€”â€” kubelet çš„é©±é€æœºåˆ¶</h3><p>é™¤äº†é€šè¿‡è°ƒåº¦çš„æ–¹å¼é©±é€ Pod å¤–ï¼ŒK8S è¿˜å­˜åœ¨ä¸€ç§å…œåº•çš„é©±é€æœºåˆ¶ï¼Œå°±æ˜¯èŠ‚ç‚¹å‹åŠ›é©±é€ï¼Œè¿™ä¸ªæœºåˆ¶ç”¨äºåœ¨èŠ‚ç‚¹èµ„æºè€—å°½å‰ç´§æ€¥å›æ”¶ç³»ç»Ÿèµ„æºï¼Œä»¥é¿å…èŠ‚ç‚¹æ‰€åœ¨ç³»ç»Ÿç”±äºèµ„æºè€—å°½å®•æœºã€‚ç›¸å…³å…·ä½“å†…å®¹å¯ä»¥çœ‹ä¹‹å‰çš„åšæ–‡: </p>
<h2 id="ä¸‰ã€Descheduler-äºŒæ¬¡è°ƒåº¦æ–¹æ¡ˆ"><a href="#ä¸‰ã€Descheduler-äºŒæ¬¡è°ƒåº¦æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€Descheduler äºŒæ¬¡è°ƒåº¦æ–¹æ¡ˆ"></a>ä¸‰ã€Descheduler äºŒæ¬¡è°ƒåº¦æ–¹æ¡ˆ</h2><h3 id="1ã€Descheduler-ç®€ä»‹"><a href="#1ã€Descheduler-ç®€ä»‹" class="headerlink" title="1ã€Descheduler ç®€ä»‹"></a>1ã€Descheduler ç®€ä»‹</h3><h4 id="1ï¼‰ä»€ä¹ˆæ˜¯-Descheduler-ï¼Ÿ"><a href="#1ï¼‰ä»€ä¹ˆæ˜¯-Descheduler-ï¼Ÿ" class="headerlink" title="1ï¼‰ä»€ä¹ˆæ˜¯ Descheduler ï¼Ÿ"></a>1ï¼‰ä»€ä¹ˆæ˜¯ Descheduler ï¼Ÿ</h4><p>ä¸Šæ–‡ä¸­æˆ‘ä»¬ä»‹ç»äº†Kubernetes ä¸­çš„è°ƒåº¦æœºåˆ¶ï¼Œç®€å•çš„è¯´è°ƒåº¦å°±æ˜¯å°† Pending çŠ¶æ€çš„ Pod ç»‘å®šåˆ° Node èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªå·¥ä½œé»˜è®¤æ˜¯ç”± kube-scheduler è¿™ä¸ªç»„ä»¶æ¥å®Œæˆçš„ï¼Œå®ƒå®Œæˆäº† Pod çš„åˆæ¬¡è°ƒåº¦ã€‚å¹¶ä¸” Kubernetes ä¹Ÿå…è®¸åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­ä½¿ç”¨å¤šä¸ªè°ƒåº¦å™¨ã€‚</p>
<p>ç”±äº Kubernetes æ•´ä½“æ¥è¯´æ˜¯éå¸¸åŠ¨æ€çš„ï¼Œé›†ç¾¤çš„çŠ¶æ€éšç€æ—¶é—´çš„æ¨ç§»ä¼šä¸æ–­çš„å˜åŒ–ã€‚æˆ‘ä»¬ç»å¸¸ä¼šå› ä¸ºå„ç§åŸå› ï¼ŒæœŸæœ›å°†å·²è¿è¡Œçš„ Pod å¯ä»¥ç§»åŠ¨åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚æˆ‘ä»¬å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºäºŒæ¬¡è°ƒåº¦ã€‚</p>
<p>è€Œ Descheduler å°±æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†äºŒæ¬¡è°ƒåº¦è¿‡ç¨‹çš„è°ƒåº¦å™¨ã€‚å®ƒä¼šæ ¹æ®è°ƒåº¦ç­–ç•¥ï¼Œæ‰¾åˆ°å¯ä»¥ç§»åŠ¨ Pod å¹¶è¿›è¡Œé©±é€ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDescheduler å¹¶ä¸æ˜¯ç”¨æ¥ä»£æ›¿ kube-scheduler çš„ï¼Œè€Œæ˜¯ä¾èµ–äº K8S åŸå§‹çš„è°ƒåº¦æœºåˆ¶æ¥å®Œæˆå·¥ä½œã€‚</p>
<h4 id="2ï¼‰ç‰ˆæœ¬å…¼å®¹æ€§"><a href="#2ï¼‰ç‰ˆæœ¬å…¼å®¹æ€§" class="headerlink" title="2ï¼‰ç‰ˆæœ¬å…¼å®¹æ€§"></a>2ï¼‰ç‰ˆæœ¬å…¼å®¹æ€§</h4><p>è™½ç„¶ <code>Descheduler</code> å¯¹äº K8S çš„ç‰ˆæœ¬æ²¡æœ‰ç¡¬æ€§ä»¥æ¥ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ K8S æä¾›çš„å®¢æˆ·ç«¯åŒ…ï¼ˆclient-goã€apimachinery ç­‰ï¼‰ä¼šå‘ä¸‹å…¼å®¹ä¸‰ä¸ªç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼Œè°ƒåº¦ç¨‹åº v0.18 åº”ä¸ k8s v1.18ã€v1.17 å’Œ v1.16 é…åˆä½¿ç”¨ã€‚</p>
<p>ä¸‹é¢çš„å…¼å®¹æ€§çŸ©é˜µæ˜¾ç¤ºäº†ç”¨äºç¼–è¯‘ descheduler çš„ k8s å®¢æˆ·ç«¯åŒ…ç‰ˆæœ¬ã€‚ ä» descheduler ç‰ˆæœ¬ v0.18 å¼€å§‹ï¼Œdescheduler çš„æ¬¡è¦ç‰ˆæœ¬ä¸ç¼–è¯‘å®ƒçš„ k8s å®¢æˆ·ç«¯è½¯ä»¶åŒ…çš„æ¬¡è¦ç‰ˆæœ¬ç›¸åŒ¹é…ã€‚</p>
<table>
<thead>
<tr>
<th>Descheduler</th>
<th>supported Kubernetes version</th>
</tr>
</thead>
<tbody><tr>
<td>v0.22</td>
<td>v1.22</td>
</tr>
<tr>
<td>v0.21</td>
<td>v1.21</td>
</tr>
<tr>
<td>v0.20</td>
<td>v1.20</td>
</tr>
<tr>
<td>v0.19</td>
<td>v1.19</td>
</tr>
<tr>
<td>v0.18</td>
<td>v1.18</td>
</tr>
<tr>
<td>v0.10</td>
<td>v1.17</td>
</tr>
<tr>
<td>v0.4 - v0.9</td>
<td>v1.9 +</td>
</tr>
<tr>
<td>v0.1 - v0.3</td>
<td>v1.7 - v1.8</td>
</tr>
</tbody></table>
<blockquote>
<p>ğŸš© ç”±äºäº§çº¿ç¯å¢ƒçš„ K8S ç‰ˆæœ¬ä¸€èˆ¬éƒ½ä½äº v1.17ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€‰ç”¨ v0.9 ç‰ˆæœ¬ã€‚</p>
</blockquote>
<h4 id="3ï¼‰Descheduler-çš„äºŒæ¬¡è°ƒåº¦ç­–ç•¥"><a href="#3ï¼‰Descheduler-çš„äºŒæ¬¡è°ƒåº¦ç­–ç•¥" class="headerlink" title="3ï¼‰Descheduler çš„äºŒæ¬¡è°ƒåº¦ç­–ç•¥"></a>3ï¼‰Descheduler çš„äºŒæ¬¡è°ƒåº¦ç­–ç•¥</h4><h5 id="1-RemoveDuplicates-ç­–ç•¥"><a href="#1-RemoveDuplicates-ç­–ç•¥" class="headerlink" title="1. RemoveDuplicates ç­–ç•¥"></a>1. RemoveDuplicates ç­–ç•¥</h5><p>å»é‡ç­–ç•¥ï¼Œè¯¥ç­–ç•¥ç¡®ä¿åªæœ‰ä¸€ä¸ª Pod ä¸åœ¨åŒèŠ‚ç‚¹ä¸Šçš„è¿è¡Œçš„<code>ReplicSet</code>ã€<code>ReplicationController</code>ã€<code>StatefulSet</code> æˆ– <code>Job</code> ç›¸å…³è”ã€‚å¦‚æœå­˜åœ¨å¤æ•°ä¸ªï¼Œå°±ä¼šå°†é‡å¤çš„å®¹å™¨è¿›è¡Œé©±é€ï¼Œä»¥æ­¤è®©å®¹å™¨å¯ä»¥æ›´å¥½çš„åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­ã€‚ï¼ˆäº‹å®ä¸Šé€šè¿‡ Pod çš„åäº²å’Œä¹Ÿå¯ä»¥å®ç°ï¼‰</p>
<p>å½“æœ‰æŸäº›èŠ‚ç‚¹ç”±äºæŸç§åŸå› å®•æœºæ—¶ï¼Œå®ƒä¸Šé¢çš„ Pod å°±ä¼šè¿ç§»è‡³å…¶ä»–èŠ‚ç‚¹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯èƒ½å‡ºç°å¤šä¸ªä¸ RS æˆ– RC å…³è”çš„ Pod è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹ä¸Šã€‚å½“æ•…éšœèŠ‚ç‚¹æ¢å¤åï¼Œå°±å¯ä»¥é€šè¿‡è¯¥ç­–ç•¥æ¥é©±é€è¿™äº›é‡å¤çš„ Podã€‚</p>
<p>è¯¥ç­–ç•¥æä¾›äº†ä¸€ä¸ª <code>excludeOwnerKinds</code>çš„å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«æ§åˆ¶å™¨ç±»å‹çš„åˆ—è¡¨ã€‚å¦‚æœ Pod å°†è¯¥åˆ—è¡¨å†…çš„ä»»ä½•ä¸€ç§åšä¸ºæ§åˆ¶å™¨ï¼Œåˆ™ä¸ä¼šè€ƒè™‘é©±é€è¯¥ Podã€‚æ¯”å¦‚ä»¥ Deployment åˆ›å»ºçš„ Pod ä¼šè¢«è¯¥ç­–ç•¥é©±é€ï¼Œä¸ºäº†é¿å…è¢«é©±é€ï¼Œåˆ™éœ€è¦åœ¨åˆ—è¡¨ä¸­åŠ å…¥ <code>ReplicaSet</code>ã€‚</p>
<h6 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemoveDuplicates&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">removeDuplicates:</span><br>         <span class="hljs-attr">excludeOwnerKinds:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;ReplicaSet&quot;</span><br></code></pre></td></tr></table></figure>

<h6 id="ç¦ç”¨ç¤ºä¾‹"><a href="#ç¦ç”¨ç¤ºä¾‹" class="headerlink" title="ç¦ç”¨ç¤ºä¾‹:"></a>ç¦ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemoveDuplicates&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>



<h5 id="2-LowNodeUtilization-ç­–ç•¥"><a href="#2-LowNodeUtilization-ç­–ç•¥" class="headerlink" title="2. LowNodeUtilization ç­–ç•¥"></a>2. LowNodeUtilization ç­–ç•¥</h5><p>ä½èŠ‚ç‚¹ä½¿ç”¨ç‡ç­–ç•¥ï¼Œè¯¥ç­–ç•¥ä¼šæ‰¾åˆ°ä½¿ç”¨ç‡è¾ƒä½çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œä»å…¶ä»–èŠ‚ç‚¹é©±é€ Podï¼Œå¹¶é©±é€åˆ°è¿™äº›ä½¿ç”¨ç‡è¾ƒä½çš„èŠ‚ç‚¹ä¸Šã€‚æ­¤ç­–ç•¥çš„é…ç½®å‚æ•°ä¸º <code>nodeResourceUtilizationThresholds</code>ã€‚</p>
<h6 id="ç­–ç•¥ç›¸å…³å‚æ•°"><a href="#ç­–ç•¥ç›¸å…³å‚æ•°" class="headerlink" title="ç­–ç•¥ç›¸å…³å‚æ•°:"></a>ç­–ç•¥ç›¸å…³å‚æ•°:</h6><ul>
<li><p><code>thresholds</code> : èŠ‚ç‚¹åˆ©ç”¨ç‡ä¸è¶³çš„é˜ˆå€¼ï¼Œå¯ä»¥æŒ‰ç…§ cpuã€å†…å­˜ã€pod æ•°é‡å’Œæ‰©å±•èµ„æºçš„ç™¾åˆ†æ¯”æ¥é…ç½®ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„ä½¿ç”¨ç‡ä½äºæ‰€æœ‰é˜ˆå€¼ï¼ˆcpuã€å†…å­˜ã€pod æ•°é‡ï¼‰ï¼ŒèŠ‚ç‚¹å°±ä¼šè¢«è®¤å®šä¸ºæœªå……åˆ†åˆ©ç”¨ã€‚ç›®å‰ï¼Œè®¡ç®—èŠ‚ç‚¹èµ„æºåˆ©ç”¨ç‡ä¹Ÿè€ƒè™‘äº† pod çš„ request èµ„æºéœ€æ±‚ã€‚</p>
</li>
<li><p><code>targetThresholds</code>: èŠ‚ç‚¹åˆ©ç”¨ç‡ä¸è¶³çš„é˜ˆå€¼ï¼Œå¯ä»¥æŒ‰ç…§ cpuã€å†…å­˜ã€pod æ•°é‡å’Œæ‰©å±•èµ„æºçš„ç™¾åˆ†æ¯”æ¥é…ç½®ã€‚ç”¨äºè®¡ç®—å¯ä»¥é©±é€ Pod çš„æ½œåœ¨èŠ‚ç‚¹ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹çš„ä½¿ç”¨ç‡é«˜äºä»»ä½•ä¸€ä¸ª <code>targetThresholds</code> çš„é˜ˆå€¼ï¼ˆcpuã€å†…å­˜ã€pod æ•°é‡æˆ–æ‰©å±•èµ„æºï¼‰ï¼Œè¯¥ç›®æ ‡èŠ‚ç‚¹å°±ä¼šè¢«è®¤å®šä¸ºè¿‡åº¦ä½¿ç”¨ã€‚</p>
</li>
</ul>
<p>ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„èµ„æºä½¿ç”¨ç‡åœ¨ <code>thresholds </code> å’Œ <code>targetThresholds</code> çš„é˜ˆå€¼ä¹‹é—´ï¼Œå°±ä¼šè¢«è®¤å®šä¸ºé€‚å½“ä½¿ç”¨ï¼Œåˆ™ä¸ä¼šè€ƒè™‘é©±é€ä¸Šé¢çš„ Podã€‚<code>thresholds</code> å’Œ <code>targetThresholds</code> çš„é˜ˆå€¼å¯ä»¥æ ¹æ®é›†ç¾¤çš„è¦æ±‚è¿›è¡Œè°ƒæ•´ã€‚</p>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªç­–ç•¥æ˜¯å°† Pod ä»è¿‡åº¦ä½¿ç”¨çš„èŠ‚ç‚¹ï¼ˆä½¿ç”¨ç‡é«˜äº <code>targetThresholds</code> é˜ˆå€¼çš„èŠ‚ç‚¹ï¼‰é©±é€åˆ°ä½¿ç”¨ç‡ä¸è¶³çš„èŠ‚ç‚¹ï¼ˆä½¿ç”¨ç‡ä½äº <code>thresholds</code> é˜ˆå€¼çš„èŠ‚ç‚¹ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è¿™ç±»èŠ‚ç‚¹ï¼Œåˆ™ç­–ç•¥ä¼šç»ˆæ­¢ã€‚</p>
<h6 id="ä½¿ç”¨ç¤ºä¾‹-1"><a href="#ä½¿ç”¨ç¤ºä¾‹-1" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;LowNodeUtilization&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">nodeResourceUtilizationThresholds:</span><br>         <span class="hljs-attr">thresholds:</span><br>           <span class="hljs-string">&quot;cpu&quot;</span> <span class="hljs-string">:</span> <span class="hljs-number">20</span><br>           <span class="hljs-attr">&quot;memory&quot;:</span> <span class="hljs-number">20</span><br>           <span class="hljs-attr">&quot;pods&quot;:</span> <span class="hljs-number">20</span><br>         <span class="hljs-attr">targetThresholds:</span><br>           <span class="hljs-string">&quot;cpu&quot;</span> <span class="hljs-string">:</span> <span class="hljs-number">50</span><br>           <span class="hljs-attr">&quot;memory&quot;:</span> <span class="hljs-number">50</span><br>           <span class="hljs-attr">&quot;pods&quot;:</span> <span class="hljs-number">50</span><br></code></pre></td></tr></table></figure>

<p>ä¸è¯¥ <code>LowNodeUtilization</code> ç­–ç•¥ç›¸å…³çš„å¦ä¸€ä¸ªå‚æ•°ç§°ä¸º <code>numberOfNodes</code>ã€‚ä»…å½“æœªå……åˆ†åˆ©ç”¨çš„èŠ‚ç‚¹æ•°å¤§äºé…ç½®çš„å€¼æ—¶ï¼Œæ‰å¯ä»¥é…ç½®æ­¤å‚æ•°ä»¥æ¿€æ´»ç­–ç•¥ã€‚è¿™åœ¨å¤§å‹ç¾¤é›†ä¸­å¾ˆæœ‰ç”¨ï¼Œå…¶ä¸­ä¸€äº›èŠ‚ç‚¹å¯èƒ½ä¼šé¢‘ç¹ä½¿ç”¨æˆ–çŸ­æœŸä½¿ç”¨ä¸è¶³ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>numberOfNodes</code>è®¾ç½®ä¸º0ã€‚</p>
<h5 id="3-RemovePodsViolatingInterPodAntiAffinity-ç­–ç•¥"><a href="#3-RemovePodsViolatingInterPodAntiAffinity-ç­–ç•¥" class="headerlink" title="3. RemovePodsViolatingInterPodAntiAffinity ç­–ç•¥"></a>3. RemovePodsViolatingInterPodAntiAffinity ç­–ç•¥</h5><p>ç§»é™¤è¿æ³• Pod åäº²å’Œæ€§ Pods ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥ç¡®ä¿ä»èŠ‚ç‚¹ä¸­åˆ é™¤è¿åäº† Interpod åäº²å’Œæ€§çš„ Podã€‚ä¾‹å¦‚è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹çš„ podAã€podBã€podC è®¾ç½®äº†åäº²å’Œæ€§è§„åˆ™ï¼Œç¦æ­¢ä»–ä»¬è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹ä¸Šã€‚åˆ™ podA å°±ä¼šè¢«é©±é€å‡ºèŠ‚ç‚¹ï¼Œä»¥ä¾¿è®© podB å’Œ podC å¯ä»¥æ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯å½“ podBã€podC å·²ç»è¿è¡Œåœ¨èŠ‚ç‚¹ä¸Šäº†ï¼Œç„¶åå†å¢åŠ äº†åäº²å’Œè§„åˆ™ï¼Œkube-scheduler å¹¶ä¸ä¼šå†è°ƒåº¦å·²ç»åœ¨è¿è¡Œçš„ Pod ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡è¯¥ç­–ç•¥è§¦å‘äºŒæ¬¡é©±é€ã€‚ç›®å‰è¯¥ç­–ç•¥æ²¡æœ‰ç›¸å…³çš„å‚æ•°ã€‚</p>
<h6 id="ä½¿ç”¨ç¤ºä¾‹-2"><a href="#ä½¿ç”¨ç¤ºä¾‹-2" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsViolatingInterPodAntiAffinity&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<h6 id="ç¦ç”¨ç¤ºä¾‹-1"><a href="#ç¦ç”¨ç¤ºä¾‹-1" class="headerlink" title="ç¦ç”¨ç¤ºä¾‹:"></a>ç¦ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsViolatingInterPodAntiAffinity&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>



<h5 id="4-RemovePodsViolatingNodeAffinity-ç­–ç•¥"><a href="#4-RemovePodsViolatingNodeAffinity-ç­–ç•¥" class="headerlink" title="4. RemovePodsViolatingNodeAffinity ç­–ç•¥"></a>4. RemovePodsViolatingNodeAffinity ç­–ç•¥</h5><p>ç§»é™¤è¿å Node äº²å’Œæ€§ Pods ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥ç¡®ä¿æ‰€æœ‰è¿åäº†èŠ‚ç‚¹äº²å’Œæ€§çš„ Pod éƒ½ä¼šè¢«é©±é€ã€‚Pod å¯ä»¥é€šè¿‡æŒ‡å®š <code>requiredDuringSchedulingIgnoredDuringExecution</code>ç±»å‹æ¥å‘ŠçŸ¥è°ƒåº¦å™¨åœ¨è°ƒåº¦æ—¶è¦éµå¾ªçš„èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨åˆæ¬¡è°ƒåº¦æ—¶å®Œæˆï¼Œåœ¨ Pod æ­£å¼è¿è¡Œåï¼Œkubelet ä¸ºäº†é¿å…èŠ‚ç‚¹éšæ—¶å‘ç”Ÿå˜åŒ–ï¼Œä¼šå¿½ç•¥äº²å’Œæ€§çš„é…ç½®ã€‚</p>
<p>å¯ç”¨è¯¥ç­–ç•¥åï¼Œå¦‚æœèŠ‚ç‚¹åœ¨åç»­è¿‡ç¨‹ä¸­ä¸åœ¨æ»¡è¶³ Pod çš„èŠ‚ç‚¹äº²å’Œï¼Œå°±ä¼šè§¦å‘é©±é€ã€‚ä¾‹å¦‚ï¼ŒnodeA ä¸Šè¿è¡Œäº† podAï¼ŒpodA åœ¨åˆæ¬¡è°ƒåº¦æ—¶æ»¡è¶³èŠ‚ç‚¹ç®¡ç†æ–°è§„åˆ™ <code>requiredDuringSchedulingIgnoredDuringExecution</code>ï¼Œä½†æ˜¯éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒnodeA ä¸å†æ»¡è¶³è¯¥è§„åˆ™ï¼ˆå¦‚èŠ‚ç‚¹çš„ namespace label å˜æ›´ï¼‰ï¼Œè€Œ nodeB å¯ç”¨ä¸”æ»¡è¶³ podA çš„èŠ‚ç‚¹å…³è”æ€§ï¼Œé‚£ä¹ˆ podA å°±ä¼šè¢«é©±é€åˆ° nodeBã€‚</p>
<h6 id="ä½¿ç”¨ç¤ºä¾‹-3"><a href="#ä½¿ç”¨ç¤ºä¾‹-3" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsViolatingNodeAffinity&quot;:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">params:</span><br>      <span class="hljs-attr">nodeAffinityType:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;requiredDuringSchedulingIgnoredDuringExecution&quot;</span><br></code></pre></td></tr></table></figure>



<h5 id="5-RemovePodsViolatingNodeTaints-ç­–ç•¥"><a href="#5-RemovePodsViolatingNodeTaints-ç­–ç•¥" class="headerlink" title="5. RemovePodsViolatingNodeTaints ç­–ç•¥"></a>5. RemovePodsViolatingNodeTaints ç­–ç•¥</h5><p>ç§»é™¤è¿å Node æ±¡ç‚¹ Pods ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥ç¡®ä¿è¿åäº†èŠ‚ç‚¹ä¸Š <code>NoSchedule</code> æ±¡ç‚¹è§„åˆ™çš„ Podä¼šè¢«é©±é€ã€‚ä¾‹å¦‚ï¼ŒpodA è®¾ç½®äº†å¯¹äºæ±¡ç‚¹ <code>key=value:NoSchedule</code> çš„å®¹å¿ï¼Œå¹¶è¢«è°ƒåº¦åˆ°æœ‰å¯¹åº”æ±¡ç‚¹çš„ nodeA ä¸Šè¿è¡Œã€‚å¦‚æœåæ¥ nodeA çš„æ±¡ç‚¹è¢«æ›´æ”¹æˆ–åˆ é™¤ï¼ŒpodA çš„å®¹å¿å°±ä¸å†é€‚ç”¨ï¼Œä½†æ˜¯é™¤éæ˜¯è®¾ç½®äº† NoExcuteï¼Œå¦åˆ™æ­£å¸¸è¿è¡Œçš„ podA å¹¶ä¸ä¼šè¢«é©±é€ã€‚è€Œå¯ç”¨è¯¥ç­–ç•¥åï¼Œå°±ä¼šå†æ­¤è§¦å‘æ±¡ç‚¹å®¹å¿åˆ¤æ–­ï¼Œè¿›è€Œé©±é€ podAã€‚</p>
<h6 id="ä½¿ç”¨ç¤ºä¾‹-4"><a href="#ä½¿ç”¨ç¤ºä¾‹-4" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsViolatingNodeTaints&quot;:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>



<h5 id="6-RemovePodsHavingTooManyRestarts-ç­–ç•¥"><a href="#6-RemovePodsHavingTooManyRestarts-ç­–ç•¥" class="headerlink" title="6. RemovePodsHavingTooManyRestarts ç­–ç•¥"></a>6. RemovePodsHavingTooManyRestarts ç­–ç•¥</h5><p>ç§»é™¤é‡å¯è¿‡å¤š Pods ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥ç¡®ä¿èŠ‚ç‚¹ä¸Šé‡å¯æ¬¡æ•°è¿‡å¤šçš„ Pod ä¼šè¢«é©±é€ã€‚ä¾‹å¦‚ï¼ŒæŒ‚è½½ volume æˆ–ç£ç›˜å¤±è´¥ï¼Œè¿™ç§ pod åº”è¯¥è¢«äºŒæ¬¡è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p>
<h6 id="ç­–ç•¥ç›¸å…³å‚æ•°-1"><a href="#ç­–ç•¥ç›¸å…³å‚æ•°-1" class="headerlink" title="ç­–ç•¥ç›¸å…³å‚æ•°:"></a>ç­–ç•¥ç›¸å…³å‚æ•°:</h6><ul>
<li><code>podRestartThreshold</code>: ç”¨äºè®¾ç½®é‡å¯æ¬¡æ•°çš„é˜ˆå€¼ï¼Œå½“ä¸€ä¸ª Pod çš„é‡å¯æ¬¡æ•°è¶…è¿‡è¯¥é˜ˆå€¼ï¼Œå°±ä¼šè¢«é©±é€</li>
<li><code>includingInitContainers</code>: ç¡®è®¤ init å®¹å™¨é˜¶æ®µçš„ Pod æ˜¯å¦ä¹ŸåŒ…æ‹¬åœ¨å†…</li>
</ul>
<h6 id="ä½¿ç”¨ç¤ºä¾‹-5"><a href="#ä½¿ç”¨ç¤ºä¾‹-5" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsHavingTooManyRestarts&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">podsHavingTooManyRestarts:</span><br>         <span class="hljs-attr">podRestartThreshold:</span> <span class="hljs-number">100</span><br>         <span class="hljs-attr">includingInitContainers:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>



<h5 id="7-PodLifeTime-ç­–ç•¥"><a href="#7-PodLifeTime-ç­–ç•¥" class="headerlink" title="7. PodLifeTime ç­–ç•¥"></a>7. PodLifeTime ç­–ç•¥</h5><p>Pod å­˜æ´»å‘¨æœŸç®¡ç†ç­–ç•¥ï¼Œè¯¥ç­–ç•¥ä¼šå¯ä»¥æ ¹æ®è¿è¡Œæ—¶é—´å’Œ Pod çŠ¶æ€ä¸ºä¾æ®æ¥è§¦å‘ Pod äºŒæ¬¡è°ƒåº¦ã€‚</p>
<h6 id="ç­–ç•¥ç›¸å…³å‚æ•°-2"><a href="#ç­–ç•¥ç›¸å…³å‚æ•°-2" class="headerlink" title="ç­–ç•¥ç›¸å…³å‚æ•°:"></a>ç­–ç•¥ç›¸å…³å‚æ•°:</h6><ul>
<li><code>maxPodLifeTimeSeconds</code>: é¢„è®¾è¿è¡Œæ—¶é•¿é˜ˆå€¼ï¼Œè¶…è¿‡é˜ˆå€¼çš„ Pod å°±ä¼šè¢«é©±é€ã€‚</li>
<li><code>podStatusPhases</code>: é¢„è®¾ Pod è¿è¡ŒçŠ¶æ€ï¼ˆrunning æˆ– pendingï¼‰ï¼Œå¦‚æœ Pod ä¸ºè¯¥é¢„è®¾çŠ¶æ€å°±ä¼šè¢«é©±é€ã€‚</li>
</ul>
<h6 id="ä½¿ç”¨ç¤ºä¾‹-6"><a href="#ä½¿ç”¨ç¤ºä¾‹-6" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;PodLifeTime&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">podLifeTime:</span><br>         <span class="hljs-attr">maxPodLifeTimeSeconds:</span> <span class="hljs-number">86400</span>	 <br>         <span class="hljs-attr">podStatusPhases:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;Pending&quot;</span><br></code></pre></td></tr></table></figure>



<h5 id="8-RemoveFailedPods-ç­–ç•¥"><a href="#8-RemoveFailedPods-ç­–ç•¥" class="headerlink" title="8. RemoveFailedPods ç­–ç•¥"></a>8. RemoveFailedPods ç­–ç•¥</h5><p>è¯¥ç­–ç•¥ä¼šç§»é™¤çŠ¶æ€ä¸º failed çš„ Podã€‚</p>
<h6 id="ç­–ç•¥ç›¸å…³å‚æ•°-3"><a href="#ç­–ç•¥ç›¸å…³å‚æ•°-3" class="headerlink" title="ç­–ç•¥ç›¸å…³å‚æ•°:"></a>ç­–ç•¥ç›¸å…³å‚æ•°:</h6><ul>
<li><code>reasons</code>: å¤±è´¥åŸå› åˆ—è¡¨ï¼Œå¯ä»¥æ ¹æ®åˆ—è¡¨ä¸­çš„åŸå› è¿›è¡Œè¿‡æ»¤ï¼Œä»¥è§¦å‘é©±é€</li>
<li><code>includingInitContainers</code>: ç¡®è®¤ init å®¹å™¨é˜¶æ®µçš„ Pod æ˜¯å¦ä¹ŸåŒ…æ‹¬åœ¨å†…</li>
<li><code>excludeOwnerKinds</code>: æ§åˆ¶å™¨åˆ—è¡¨ï¼Œå¯ä»¥æ ¹æ®åˆ—è¡¨ä¸­çš„æ§åˆ¶å™¨ç±»å‹è¿›è¡Œè¿‡æ»¤ï¼Œä»¥è§¦å‘é©±é€</li>
<li><code>minPodLifeTimeSeconds</code>: æŒ‡å®š Pod æœ€å°å­˜æ´»æ´»æ—¶é—´ï¼Œå¦‚æœæ¯”é¢„è®¾çš„æœ€å°å€¼å¤§ï¼Œåˆ™è§¦å‘é©±é€</li>
</ul>
<h6 id="ä½¿ç”¨ç¤ºä¾‹-7"><a href="#ä½¿ç”¨ç¤ºä¾‹-7" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemoveFailedPods&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">failedPods:</span><br>         <span class="hljs-attr">reasons:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;NodeAffinity&quot;</span><br>         <span class="hljs-attr">includingInitContainers:</span> <span class="hljs-literal">true</span><br>         <span class="hljs-attr">excludeOwnerKinds:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;Job&quot;</span><br>         <span class="hljs-attr">minPodLifeTimeSeconds:</span> <span class="hljs-number">3600</span><br></code></pre></td></tr></table></figure>



<h4 id="4ï¼‰Pod-çš„é©±é€æœºåˆ¶"><a href="#4ï¼‰Pod-çš„é©±é€æœºåˆ¶" class="headerlink" title="4ï¼‰Pod çš„é©±é€æœºåˆ¶"></a>4ï¼‰Pod çš„é©±é€æœºåˆ¶</h4><p>å½“ <code>Descheduler</code> å†³å®šä»èŠ‚ç‚¹é©±é€ Pod æ—¶ï¼Œä¼šé‡‡ç”¨ä»¥ä¸‹å¸¸è§„æœºåˆ¶:</p>
<ul>
<li>é«˜ä¼˜å…ˆåº¦ Podï¼ˆPriorityClassName ä¸º <code>system-cluster-critical</code> å’Œ <code>system-node-critical</code>ï¼‰ä¸ä¼šè¢«é©±é€ï¼ˆé™¤éè®¾ç½®äº† <code>evictSystemCriticalPods: true</code>ï¼‰</li>
<li>ä¸å±äº RCã€RSã€Deploymentã€Job çš„ Podï¼ˆé™æ€æˆ–é•œåƒ Pod æˆ–ç‹¬ç«‹ Podï¼‰ä¸ä¼šè¢«é©±é€ï¼Œå› ä¸ºä»–ä»¬ä¸ä¼šè‡ªåŠ¨é‡æ–°åˆ›å»ºã€‚</li>
<li>ä¸ DeamonSets ç›¸å…³çš„ Pod ä¸ä¼šè¢«é©±é€</li>
<li>æœ‰æœ¬åœ°å­˜å‚¨çš„ Pod ä¸ä¼šè¢«é©±é€ï¼ˆé™¤éè®¾ç½®äº† <code>evictLocalStoragePods: true</code>ï¼‰</li>
<li>æœ‰ PVC çš„ Pod ä¼šè¢«é©±é€ï¼ˆé™¤éè®¾ç½®äº† <code>ignorePvcPods: true</code>ï¼‰</li>
<li>ä½¿ç”¨äº† <code>LowNodeUtilization</code> å’Œ <code>RemovePodsViolatingInterPodAntiAffinity</code> ç­–ç•¥ï¼Œä¼šæ ¹æ®ä»–ä»¬çš„ä¼˜å…ˆçº§ä»ä½åˆ°é«˜è¿›è¡Œé©±é€ï¼Œå¦‚æœä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™ä¼šä¾æ® QoS åˆ¤æ–­ï¼Œé¦–å…ˆé©±é€ <code>Best-Effort</code> ä¼˜å…ˆçº§çš„ podï¼Œå†é©±é€ <code>Burstable</code> ä¼˜å…ˆçº§çš„ Podï¼Œæœ€åé©±é€ <code>Guaranteed</code> ä¼˜å…ˆçº§çš„ Podã€‚</li>
<li>å¸¦æœ‰æ³¨é‡Š <code>descheduler.alpha.kubernetes.io/evict</code> çš„æ‰€æœ‰ç±»å‹çš„ Pod éƒ½ä¼šè¢«é©±é€ã€‚è¯¥æ³¨é‡Šç”¨äºè¦†ç›–é˜²æ­¢é©±é€çš„æ£€æŸ¥ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©é©±é€å“ªä¸ª Podã€‚ç”¨æˆ·åº”è¯¥çŸ¥é“å¦‚ä½•ä»¥åŠæ˜¯å¦å¯ä»¥é‡æ–°åˆ›å»ºå®¹å™¨ã€‚</li>
<li>è®¾ç½® â€“v=4 æˆ–è€…æ›´å¤§ï¼ŒDescheduler ä¼šåœ¨æ—¥å¿—ä¸­è®°å½•æ‰€æœ‰ pod æ²¡æœ‰è¢«é©±é€çš„åŸå› </li>
</ul>
<blockquote>
<p>âš ï¸ <strong>æ³¨æ„:</strong> PDB ä¸ä¼šå— Descheduler æ§åˆ¶ã€‚</p>
</blockquote>
<h3 id="2ã€æ–¹æ¡ˆå®æ–½"><a href="#2ã€æ–¹æ¡ˆå®æ–½" class="headerlink" title="2ã€æ–¹æ¡ˆå®æ–½"></a>2ã€æ–¹æ¡ˆå®æ–½</h3><p><code>Descheduler</code> å¯ä»¥åœ¨ K8S é›†ç¾¤ä¸­ä½œä¸º <code>Job</code>ã€<code>CronJob</code> æˆ– <code>Deployment</code>ï¼ˆ0.21åï¼‰ è¿è¡Œã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äºå¯ä»¥å¤šæ¬¡è¿è¡Œè€Œæ— éœ€ç”¨æˆ·è¿›è¡Œå¹²é¢„ã€‚å®ƒçš„ Pod ä¼šåœ¨ <code>kube-system</code> å‘½åç©ºé—´ä¸­ä½œä¸ºå…³é”®å®¹å™¨è¿è¡Œï¼Œä»¥é¿å…è¢«è‡ªèº«æˆ–kubeleté€å‡ºã€‚</p>
<p>æˆ‘è¿™é‡Œå·²ç»æ‰“å¥½äº†é•œåƒï¼Œåœ°å€ä¸º <code>tareya/descheduler:0.9.0</code>ï¼Œåœ¨ä¸‹æ–‡çš„ yaml ä¸­ä¼šä½¿ç”¨ï¼Œå½“ç„¶ç”±äº <code>Descheduler</code> æ›´æ–°æ˜¯é€Ÿåº¦å¾ˆå¿«ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è‡ªè¡Œå‡†å¤‡é•œåƒã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/kubernetes-sigs/descheduler.git &amp;&amp; \<br>cd descheduler &amp;&amp; make image <br></code></pre></td></tr></table></figure>



<h4 id="1ï¼‰åˆ›å»º-RBAC-æˆæƒ"><a href="#1ï¼‰åˆ›å»º-RBAC-æˆæƒ" class="headerlink" title="1ï¼‰åˆ›å»º RBAC æˆæƒ"></a>1ï¼‰åˆ›å»º RBAC æˆæƒ</h4><p>æ–‡ä»¶è·¯å¾„: <code>~/descheduler/rbac.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-cluster-role</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">rules:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;nodes&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;pods&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;pods/eviction&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>]<br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-sa</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descehduler-cluster-role-binding</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-cluster-role</span><br><span class="hljs-attr">subjects:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-sa</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br></code></pre></td></tr></table></figure>



<h4 id="2ï¼‰åˆ›å»º-configmap"><a href="#2ï¼‰åˆ›å»º-configmap" class="headerlink" title="2ï¼‰åˆ›å»º configmap"></a>2ï¼‰åˆ›å»º configmap</h4><p>æ–‡ä»¶è·¯å¾„: <code>~/descheduler/configmap.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-policy-configmap</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">policy.yaml:</span> <span class="hljs-string">|-  </span><br><span class="hljs-string">    apiVersion: descheduler/v1alpha1</span><br><span class="hljs-string">    kind: DeschedulerPolicy</span><br><span class="hljs-string">    strategies:</span><br><span class="hljs-string">      RemoveDuplicates:</span><br><span class="hljs-string">         enabled: false</span><br><span class="hljs-string">      LowNodeUtilization:</span><br><span class="hljs-string">         enabled: true</span><br><span class="hljs-string">         params:</span><br><span class="hljs-string">           nodeResourceUtilizationThresholds:</span><br><span class="hljs-string">             thresholds:</span><br><span class="hljs-string">               memory: 50</span><br><span class="hljs-string">             targetThresholds:</span><br><span class="hljs-string">               memory: 85</span><br><span class="hljs-string">      RemovePodsViolatingInterPodAntiAffinity:</span><br><span class="hljs-string">        enabled: true</span><br><span class="hljs-string">      RemovePodsViolatingNodeAffinity:</span><br><span class="hljs-string">        enabled: true</span><br><span class="hljs-string">        params:</span><br><span class="hljs-string">          nodeAffinityType:</span><br><span class="hljs-string">          - requiredDuringSchedulingIgnoredDuringExecution</span><br></code></pre></td></tr></table></figure>



<h4 id="3ï¼‰åˆ›å»ºè®¡åˆ’ä»»åŠ¡å¯¹è±¡"><a href="#3ï¼‰åˆ›å»ºè®¡åˆ’ä»»åŠ¡å¯¹è±¡" class="headerlink" title="3ï¼‰åˆ›å»ºè®¡åˆ’ä»»åŠ¡å¯¹è±¡"></a>3ï¼‰åˆ›å»ºè®¡åˆ’ä»»åŠ¡å¯¹è±¡</h4><p>æ–‡ä»¶è·¯å¾„: <code>~/descheduler/cronjob.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CronJob</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">schedule:</span> <span class="hljs-string">&quot;*/30 * * * *&quot;</span><br>  <span class="hljs-attr">jobTemplate:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler</span><br>      <span class="hljs-attr">annotations:</span><br>        <span class="hljs-attr">scheduler.alpha.kubernetes.io/critical-pod:</span> <span class="hljs-string">&quot;true&quot;</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">template:</span><br>        <span class="hljs-attr">spec:</span><br>          <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">descheduler-sa</span><br>          <span class="hljs-attr">containers:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler</span><br>            <span class="hljs-attr">image:</span> <span class="hljs-string">tareya/descheduler:v0.9.0</span><br>            <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/policy-dir</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">policy-volume</span><br>            <span class="hljs-attr">command:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/descheduler</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">--v=4</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">--max-pods-to-evict-per-node=10</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">--policy-config-file=/policy-dir/policy.yaml</span>		<span class="hljs-comment">#æ­¤å¤„ä¸º&lt;path-to-policy-dir/policy.yaml&gt;æ–‡ä»¶</span><br>          <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">&quot;OnFailure&quot;</span><br>          <span class="hljs-attr">volumes:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">policy-volume</span><br>            <span class="hljs-attr">configMap:</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-policy-configmap</span><br></code></pre></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Kubernetes/">Kubernetes</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">é—®é¢˜è§£å†³æ–¹æ¡ˆ</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-etcd/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” etcd</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/14/%E7%AC%AC6%E7%AB%A0%E3%80%81Golang-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/">
                        <span class="hidden-mobile">ç¬¬6ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸‹ï¼‰</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


</body>
</html>
