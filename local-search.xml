<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kubelet</title>
    <link href="/2021/11/03/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kubelet/"/>
    <url>/2021/11/03/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kubelet/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kubelet"><a href="#Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kubelet" class="headerlink" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kubelet"></a>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kubelet</h1><p>åœ¨ K8S çš„ç»„ä»¶ä¸­ï¼Œ<code>kubelet</code> æ˜¯åœ¨æ¯ä¸ª Node èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ â€œèŠ‚ç‚¹ä»£ç†â€ã€‚å®ƒé»˜è®¤ç›‘å¬ 10250 ç«¯å£ï¼Œæ¥æ”¶å¹¶æ‰§è¡Œ Master èŠ‚ç‚¹å‘æ¥çš„æŒ‡ä»¤ï¼Œå¹¶å®é™…ç®¡ç† Pod ä»¥åŠ Pod ä¸­çš„å®¹å™¨ã€‚æ¯ä¸ª <code>kubelet</code> è¿›ç¨‹éƒ½ä¼šåœ¨ API Server æ³¨å†Œæ‰€åœ¨ Node èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå…¶æ³¨å†Œçš„è¡¨ç¤ºä¸€èˆ¬ä¸ºä¸»æœºå(hostname)ã€è¦†ç›–ä¸»æœºåçš„å‚æ•°æˆ–å…¬æœ‰äº‘é©±åŠ¨çš„ç‰¹å®šé€»è¾‘ã€‚<code>kubelet</code> ä¼šé€šè¿‡ cAdvisor æ¥ç›‘æ§èŠ‚ç‚¹å’Œå®¹å™¨çš„èµ„æºï¼Œå¹¶å®šæœŸå‘ Master èŠ‚ç‚¹æ±‡æŠ¥è¯¥èŠ‚ç‚¹çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚</p><span id="more"></span><h2 id="ä¸€ã€Kubelet-çš„å·¥ä½œåŸç†"><a href="#ä¸€ã€Kubelet-çš„å·¥ä½œåŸç†" class="headerlink" title="ä¸€ã€Kubelet çš„å·¥ä½œåŸç†"></a>ä¸€ã€Kubelet çš„å·¥ä½œåŸç†</h2><h2 id="äºŒã€Kubernetes-çš„èµ„æºä½“ç³»"><a href="#äºŒã€Kubernetes-çš„èµ„æºä½“ç³»" class="headerlink" title="äºŒã€Kubernetes çš„èµ„æºä½“ç³»"></a>äºŒã€Kubernetes çš„èµ„æºä½“ç³»</h2><h3 id="1ã€èµ„æºéœ€æ±‚å’Œèµ„æºé™åˆ¶"><a href="#1ã€èµ„æºéœ€æ±‚å’Œèµ„æºé™åˆ¶" class="headerlink" title="1ã€èµ„æºéœ€æ±‚å’Œèµ„æºé™åˆ¶"></a>1ã€èµ„æºéœ€æ±‚å’Œèµ„æºé™åˆ¶</h3><p>åœ¨ K8S çš„èµ„æºä½“ç³»ä¸­å­˜åœ¨ä¸¤ä¸ªæ¦‚å¿µ <code>requests</code> å’Œ <code>limits</code>ï¼Œç”¨äºä¸ºå®¹å™¨åˆ†é… cpu å’Œ memory èµ„æºï¼Œå®šä¹‰åœ¨ <code>.spec.containers.resources</code> ä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<code>limits</code> ä¼šå¤§äº <code>requests</code>ã€‚</p><ul><li><code>requests</code>: å³èµ„æºéœ€æ±‚ï¼Œç”¨äºä¿éšœå®¹å™¨å¯æ­£å¸¸è¿è¡Œçš„æœ€ä½ä¿éšœï¼Œæ˜¯å®¹å™¨è°ƒåº¦çš„åˆ¤æ–­ä¾æ®ä¹‹ä¸€</li><li><code>limits</code>: å³èµ„æºé™åˆ¶ï¼Œå®¹å™¨å¯ä»¥åˆ†é…åˆ°çš„æœ€å¤§èµ„æºé…é¢ï¼Œé€šè¿‡è¿™ç§ç¡¬æ€§é™åˆ¶æ¥æ§åˆ¶å®¹å™¨èµ„æºçš„ä½¿ç”¨</li></ul><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211103163945438.png" alt="image-20211103163945438"></p><h5 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-demo</span><br>    <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/stress-ng</span>   <span class="hljs-comment">#å‹æµ‹çš„é•œåƒ</span><br>      <span class="hljs-attr">resources:</span>         <span class="hljs-comment">#å®šä¹‰èµ„æºé™é¢ç­‰</span><br>        <span class="hljs-attr">requests:</span><br>          <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;200m&quot;</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">&quot;128Mi&quot;</span><br>        <span class="hljs-attr">limits:</span><br>          <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;500m&quot;</span>        <span class="hljs-comment">#1é¢— cpu=1000m </span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">&quot;200Mi&quot;</span><br>      <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/usr/bin/stress-ng&quot;</span>, <span class="hljs-string">&quot;-m 1&quot;</span>, <span class="hljs-string">&quot;-c 1&quot;</span>, <span class="hljs-string">&quot;--metrics-brief&quot;</span>]<br></code></pre></td></tr></table></figure><p>åˆ›å»º Pod èµ„æºåï¼ŒæŸ¥çœ‹å®é™…å†…å­˜å’Œ cpu ä½¿ç”¨ç‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl exec pod-demo -- top<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211103164618371.png" alt="image-20211103164618371"></p><p>æµ‹è¯•èŠ‚ç‚¹çš„CPUä¸º 4æ ¸, åˆ†é…ç»™å®¹å™¨500mçš„CPU, ä¹Ÿå°±æ˜¯0.125ä¸ªCPU, æ‰€ä»¥çœ‹åˆ°çš„è¿›ç¨‹CPUå ç”¨ç‡çº¦ä¸º<code>13%</code>ã€‚</p><p>å½“æŒç»­å‹æµ‹ï¼Œå†…å­˜ä½¿ç”¨è¶…è¿‡ <code>limits</code> é¢„è®¾çš„ 200Mi æ—¶ï¼Œå®¹å™¨å°±ä¼šè¢« OOM kill æ‰ï¼Œè¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME            READY     STATUS      RESTARTS   AGE<br>pod-demo   0/1       OOMKilled   1          37s<br></code></pre></td></tr></table></figure><h3 id="2ã€QoS-Classes-åˆ†ç±»"><a href="#2ã€QoS-Classes-åˆ†ç±»" class="headerlink" title="2ã€QoS Classes åˆ†ç±»"></a>2ã€QoS Classes åˆ†ç±»</h3><p>Kubernetes åœ¨åˆ›å»º Pod æ—¶ä¼šä¸ºå…¶æŒ‡å®š QoS ç±»ï¼Œå®ƒä¼šå½±å“åˆ° Pod çš„è°ƒåº¦å’Œé©±é€ç­–ç•¥ã€‚</p><h4 id="1ï¼‰Guaranteed"><a href="#1ï¼‰Guaranteed" class="headerlink" title="1ï¼‰Guaranteed"></a>1ï¼‰Guaranteed</h4><p>ç¡®ä¿ç±»å‹ï¼Œæ­¤ç±» Pod å…·å¤‡æœ€é«˜çš„ä¼˜å…ˆçº§ã€‚å¦‚æœ Pod ä¸­æ‰€æœ‰å®¹å™¨çš„ <code>.spec.containers.resources</code> ä¸­çš„ <code>limits</code> å’Œ <code>requests</code> éƒ½ç›¸ç­‰ä¸”ä¸ä¸º0ï¼Œåˆ™è¿™ä¸ª Pod çš„ Qos ç±»å°±æ˜¯ Guaranteedã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å¦‚æœä¸€ä¸ªå®¹å™¨åªæŒ‡æ˜äº†limitï¼Œè€ŒæœªæŒ‡æ˜ requestï¼Œåˆ™è¡¨æ˜ request çš„å€¼ç­‰äº limit çš„å€¼ï¼Œä¹Ÿå°±ç¬¦åˆ Guaranteed çš„è¦æ±‚ã€‚</strong></p><h5 id="ä½¿ç”¨ç¤ºä¾‹-1"><a href="#ä½¿ç”¨ç¤ºä¾‹-1" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-demo</span><br>    <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>      <span class="hljs-attr">resources:</span>        <span class="hljs-comment">#å®šä¹‰èµ„æºé™é¢ç­‰</span><br>        <span class="hljs-attr">requests:</span><br>          <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;200m&quot;</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">&quot;200Mi&quot;</span><br>        <span class="hljs-attr">limits:</span><br>          <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;200m&quot;</span>       <span class="hljs-comment">#1é¢—cpu=1000m</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">&quot;200Mi&quot;</span><br></code></pre></td></tr></table></figure><p>åˆ›å»º Pod èµ„æºåï¼Œdescribe è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">Name:         pod-demo<br>Namespace:    default<br>Priority:     0<br>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>QoS Class:       Guaranteed   #æ­¤æ—¶å·²ç»æ˜¯ Guaranteed<br>Node-Selectors:  &lt;none&gt;<br>Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s<br>                 node.kubernetes.io/unreachable:NoExecute for 300s<br>Events:<br>  Type    Reason     Age   From               Message<br>  ----    ------     ----  ----               -------<br>  Normal  Scheduled  11s   default-scheduler  Successfully assigned default/pod-demo to node3<br>  Normal  Pulled     9s    kubelet, node3     Container image &quot;nginx&quot; already present on machine<br>  Normal  Created    8s    kubelet, node3     Created container myapp<br>  Normal  Started    8s    kubelet, node3     Started container myapp<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰Burstable"><a href="#2ï¼‰Burstable" class="headerlink" title="2ï¼‰Burstable"></a>2ï¼‰Burstable</h4><p>ä¸ç¬¦åˆ <code>Guaranteed</code> QoS Class æ ‡å‡†ï¼Œä½†æ˜¯<strong>è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨è®¾ç½®äº† cpu æˆ– å†…å­˜ çš„ request å±æ€§</strong>ï¼Œå…¶ QoS ç±»å³ <code>Burstable</code>ï¼Œå…¶å…·å¤‡ä¸­ç­‰çš„ä¼˜å…ˆçº§ã€‚</p><h5 id="ä½¿ç”¨ç¤ºä¾‹-2"><a href="#ä½¿ç”¨ç¤ºä¾‹-2" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-demo</span><br>    <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>      <span class="hljs-attr">resources:</span>       <br>        <span class="hljs-attr">requests:</span><br>          <span class="hljs-attr">cpu:</span> <span class="hljs-string">&quot;200m&quot;</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">&quot;200Mi&quot;</span><br></code></pre></td></tr></table></figure><p>åˆ›å»º Pod èµ„æºåï¼Œdescribe è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">Name:         pod-demo<br>Namespace:    default<br>Priority:     0<br>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>QoS Class:       Burstable   #æ­¤æ—¶å·²ç»æ˜¯ Burstable<br>Node-Selectors:  &lt;none&gt;<br>Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s<br>                 node.kubernetes.io/unreachable:NoExecute for 300s<br>Events:<br>  Type    Reason     Age   From               Message<br>  ----    ------     ----  ----               -------<br>  Normal  Scheduled  11s   default-scheduler  Successfully assigned default/pod-demo to node3<br>  Normal  Pulled     9s    kubelet, node3     Container image &quot;nginx&quot; already present on machine<br>  Normal  Created    8s    kubelet, node3     Created container myapp<br>  Normal  Started    8s    kubelet, node3     Started container myapp<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰Best-Effort"><a href="#3ï¼‰Best-Effort" class="headerlink" title="3ï¼‰Best-Effort"></a>3ï¼‰Best-Effort</h4><p>å¦‚æœä¸€ä¸ª Pod ä¸­æ‰€æœ‰å®¹å™¨çš„ <code>.spec.containers.resources</code> ä¸­çš„ <code>limit</code> å’Œ <code>request</code> éƒ½æ²¡æœ‰èµ‹å€¼ï¼Œé‚£ä¹ˆå…¶ QoS Class å°±æ˜¯ <code>Best-Effort</code>ï¼Œå…¶ä¼˜å…ˆçº§æœ€ä½ã€‚</p><h5 id="ä½¿ç”¨ç¤ºä¾‹-3"><a href="#ä½¿ç”¨ç¤ºä¾‹-3" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-demo</span><br>    <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br></code></pre></td></tr></table></figure><p>åˆ›å»º Pod èµ„æºåï¼Œdescribe è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">Name:         pod-demo<br>Namespace:    default<br>Priority:     0<br>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>QoS Class:       BestEffort   #æ­¤æ—¶å·²ç»æ˜¯ BestEffort<br>Node-Selectors:  &lt;none&gt;<br>Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s<br>                 node.kubernetes.io/unreachable:NoExecute for 300s<br>Events:<br>  Type    Reason     Age   From               Message<br>  ----    ------     ----  ----               -------<br>  Normal  Scheduled  11s   default-scheduler  Successfully assigned default/pod-demo to node3<br>  Normal  Pulled     9s    kubelet, node3     Container image &quot;nginx&quot; already present on machine<br>  Normal  Created    8s    kubelet, node3     Created container myapp<br>  Normal  Started    8s    kubelet, node3     Started container myapp<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰QoS-Classes-ä¼˜å…ˆçº§æ’å"><a href="#4ï¼‰QoS-Classes-ä¼˜å…ˆçº§æ’å" class="headerlink" title="4ï¼‰QoS Classes ä¼˜å…ˆçº§æ’å"></a>4ï¼‰QoS Classes ä¼˜å…ˆçº§æ’å</h4><blockquote><p>ğŸš© QoS ç±»çš„ä¼˜å…ˆçº§ä¸º: <strong>Guaranteed &gt; Burstable &gt; Best-Effort</strong></p></blockquote><p>å½“èŠ‚ç‚¹å‡ºç°èµ„æºç´§ç¼ºæ—¶ï¼Œkubelet ä¼šæ ¹æ® QoS çš„ä¼˜å…ˆçº§é©±é€ Podï¼Œæœ€å…ˆè¢«é©±é€çš„å°±æ˜¯ <code>BestEffort</code>ã€‚åœ¨ Burstableç±»å‹ä¸‹ï¼Œå·²å ç”¨é‡ä¸éœ€æ±‚é‡æ¯”å€¼å¤§çš„å…ˆè¢«é©±é€ï¼ˆå¦‚ï¼Œpod1 request å†…å­˜ä¸º 512Miï¼Œå·²å ç”¨å†…å­˜ 500Miï¼› Pod2 request å†…å­˜ä¸º 1024Miï¼Œå·²å ç”¨ 512Mi å†…å­˜ï¼Œé‚£ä¹ˆä¼šå…ˆé©±é€ pod1ï¼‰</p><h3 id="3ã€å¯å‹ç¼©èµ„æºå’Œä¸å¯å‹ç¼©èµ„æº"><a href="#3ã€å¯å‹ç¼©èµ„æºå’Œä¸å¯å‹ç¼©èµ„æº" class="headerlink" title="3ã€å¯å‹ç¼©èµ„æºå’Œä¸å¯å‹ç¼©èµ„æº"></a>3ã€å¯å‹ç¼©èµ„æºå’Œä¸å¯å‹ç¼©èµ„æº</h3><p>K8S ä¸­å¯¹äºç³»ç»Ÿèµ„æºå¯ä»¥åˆ†ä¸ºä¸¤ç§å±æ€§ï¼š</p><ul><li><strong>å¯å‹ç¼©èµ„æº</strong>: ä¾‹å¦‚ CPU å¾ªç¯ã€Disk I/Oã€ç½‘ç»œå¸¦å®½ï¼Œéƒ½æ˜¯å¯ä»¥è¢«é™åˆ¶å’Œè¢«å›æ”¶çš„ï¼Œå¯¹äºä¸€ä¸ª Pod æ¥è¯´ï¼Œå¯ä»¥é™ä½è¿™äº›èµ„æºçš„ä½¿ç”¨é‡è€Œä¸éœ€è¦å»é©±é€ Pod </li><li><strong>ä¸å¯å‹ç¼©èµ„æº</strong>: ä¾‹å¦‚å†…å­˜ã€ç£ç›˜ç©ºé—´ï¼Œå¯¹äºä¸å¯å‹ç¼©èµ„æºæ¥è¯´ï¼Œå¦‚æœèµ„æºä¸è¶³ï¼Œå°±æ— æ³•ç»§ç»­ç”³è¯·èµ„æºï¼Œéœ€è¦é€šè¿‡é©±é€èŠ‚ç‚¹çš„ Pod æ¥è¿›è¡Œèµ„æºå›æ”¶</li></ul><p>kubelet å›æ”¶çš„èµ„æºä¸»è¦æ˜¯å†…å­˜å’Œç£ç›˜ä¸¤ç§ï¼Œå›æ”¶çš„åŸºæœ¬æ–¹å¼å¦‚ä¸‹:</p><ul><li>ç£ç›˜å›æ”¶: ä¸»è¦é€šè¿‡åˆ é™¤å·²ç»ˆæ­¢çš„å®¹å™¨å’Œæœªä½¿ç”¨çš„é•œåƒ</li><li>å†…å­˜å›æ”¶: ä¸»è¦é€šè¿‡ç»ˆæ­¢æ­£åœ¨è¿è¡Œçš„ pod</li></ul><h2 id="ä¸‰ã€Kubernetes-èŠ‚ç‚¹å‹åŠ›é©±é€"><a href="#ä¸‰ã€Kubernetes-èŠ‚ç‚¹å‹åŠ›é©±é€" class="headerlink" title="ä¸‰ã€Kubernetes èŠ‚ç‚¹å‹åŠ›é©±é€"></a>ä¸‰ã€Kubernetes èŠ‚ç‚¹å‹åŠ›é©±é€</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯èŠ‚ç‚¹å‹åŠ›é©±é€ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯èŠ‚ç‚¹å‹åŠ›é©±é€ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯èŠ‚ç‚¹å‹åŠ›é©±é€ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯èŠ‚ç‚¹å‹åŠ›é©±é€ï¼Ÿ</h3><p>èŠ‚ç‚¹å‹åŠ›é©±é€äº‹å®ä¸Šå°±æ˜¯ kubelet ä¸»åŠ¨ç»ˆæ­¢ Pod ä»¥å›æ”¶èŠ‚ç‚¹èµ„æºçš„è¿‡ç¨‹ã€‚kubelet ä¼šç›‘æ§é›†ç¾¤èŠ‚ç‚¹çš„ CPUã€å†…å­˜ã€ç£ç›˜ç©ºé—´å’Œæ–‡ä»¶ç³»ç»Ÿçš„ inode ç­‰èµ„æºã€‚ å½“è¿™äº›èµ„æºä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¾¾åˆ°ç‰¹å®šçš„æ¶ˆè€—æ°´å¹³ï¼Œ kubelet å¯ä»¥ä¸»åŠ¨åœ°ä½¿èŠ‚ç‚¹ä¸Šä¸€ä¸ªæˆ–è€…å¤šä¸ª Pod å¤±æ•ˆï¼Œä»¥å›æ”¶èµ„æºé˜²æ­¢æ¯ç«­ã€‚</p><p>åœ¨èŠ‚ç‚¹å‹åŠ›é©±é€æœŸé—´ï¼Œkubelet ä¼šå°†æ‰€é€‰çš„ Pod çš„ <code>PodPhase</code> è®¾ç½®ä¸º <code>Failed</code>ï¼Œè¿™å›ç»ˆæ­¢ Podã€‚Pod çš„ä¿¡æ¯æ®‹ç•™åé¦ˆä¸º <code>Evicted</code> çŠ¶æ€ï¼Œå¦‚ä¸‹å›¾:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211027181000655.png" alt="image-20211027181000655"></p><h3 id="2ã€èŠ‚ç‚¹å‹åŠ›é©±é€çš„æœºåˆ¶"><a href="#2ã€èŠ‚ç‚¹å‹åŠ›é©±é€çš„æœºåˆ¶" class="headerlink" title="2ã€èŠ‚ç‚¹å‹åŠ›é©±é€çš„æœºåˆ¶"></a>2ã€èŠ‚ç‚¹å‹åŠ›é©±é€çš„æœºåˆ¶</h3><p>kubelet ä¼šæ ¹æ® <code>é©±é€ä¿¡å·</code>ï¼Œ<code>é©±é€æ¡ä»¶</code>ã€<code>ç›‘æ§é—´éš”</code> æ¥ä½œå‡ºé©±é€å†³å®šã€‚</p><h4 id="1ï¼‰é©±é€ä¿¡å·"><a href="#1ï¼‰é©±é€ä¿¡å·" class="headerlink" title="1ï¼‰é©±é€ä¿¡å·"></a>1ï¼‰é©±é€ä¿¡å·</h4><p>é©±é€ä¿¡å·æ˜¯ç‰¹å®šèµ„æºåœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„å½“å‰çŠ¶æ€ã€‚kubelet ä½¿ç”¨é©±é€ä¿¡å·ï¼Œé€šè¿‡å°†ä¿¡å·å’Œé©±é€æ¡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œæ¥åšå‡ºé©±é€å†³å®šï¼Œé©±é€æ¡ä»¶å°±æ˜¯èŠ‚ç‚¹ä¸Šåº”è¯¥å¯ç”¨èµ„æºçš„æœ€å°é‡ã€‚kubelet å¯ä½¿ç”¨çš„é©±é€ä¿¡å·å¦‚ä¸‹:</p><table><thead><tr><th>é©±é€ä¿¡å·</th><th>å–å€¼æ–¹å¼</th></tr></thead><tbody><tr><td>memory.available</td><td>memory.available<code>:=</code>node.status.capacity[memory]<code>-</code>node.stats.memory.workingSet</td></tr><tr><td>nodefs.available</td><td>nodefs.available<code>:=</code>node.stats.fs.available</td></tr><tr><td>nodefs.inodesFree</td><td>nodefs.inodesFree<code>:=</code>node.stats.fs.inodesFree</td></tr><tr><td>imagefs.available</td><td>imagefs.available<code>:=</code>node.stats.runtime.imagefs.available</td></tr><tr><td>imagefs.inodesFree</td><td>imagefs.inodesFree<code>:=</code>node.stats.runtime.imagefs.inodesFree</td></tr><tr><td>pid.available</td><td>pid.available<code>:=</code>node.stats.rlimit.maxpid<code>-</code>node.stats.rlimit.curproc</td></tr></tbody></table><p>æ¯ä¸ªé©±é€ä¿¡å·éƒ½æ”¯æŒç™¾åˆ†æ¯”æˆ–æ˜¯å­—é¢å€¼ï¼Œkubelet é‡‡ç”¨çš„æ˜¯ä¿¡å·æœ‰å…³çš„æ€»é‡çš„ç™¾åˆ†æ¯”çš„æ–¹å¼æ¥è¿›è¡Œåˆ¤æ–­ã€‚</p><h5 id="1-memory-available"><a href="#1-memory-available" class="headerlink" title="1. memory.available"></a>1. memory.available</h5><p><code>memory.available</code> çš„å€¼æ¥è‡ª cgroupfsï¼Œè€Œä¸æ˜¯åƒ <code>free -m</code> è¿™æ ·çš„ç³»ç»Ÿå·¥å…·ï¼Œè¿™é‡Œç³»ç»Ÿå·¥å…·åœ¨å®¹å™¨å†…å®é™…ä¸Šæ˜¯èµ·ä¸åˆ°æ•ˆæœçš„ï¼ˆå› ä¸ºå®¹å™¨æ ¹æœ¬ä¸Šåœ¨åº•å±‚æ˜¯å…¬ç”¨çš„ç³»ç»Ÿèµ„æºï¼‰ã€‚è€Œ CGroup åˆ™æ˜¯å°†å®¹å™¨è¿›è¡Œäº†åˆ†å±‚æ¬¡åŒºåˆ†ï¼Œæ¯ä¸ªå®¹å™¨éƒ½ä¼šæœ‰å…¶å”¯ä¸€çš„ CGroup æ ¹èŠ‚ç‚¹ï¼Œkubelet ä¼šåˆ¤æ–­è¯¥æ ¹èŠ‚ç‚¹çš„å¯ç”¨èµ„æºæ¥è®¡ç®— <code>memory.available</code>ã€‚</p><p>å…·ä½“çš„è®¡ç®—æ–¹æ³•å¦‚æ­¤è„šæœ¬<a href="https://kubernetes.io/zh/examples/admin/resource/memory-available.sh">memory-available.sh</a>ã€‚kubelet åœ¨å…¶è®¡ç®—ä¼šæ’é™¤äº† inactive_fileï¼ˆå³éæ´»åŠ¨ LRU åˆ—è¡¨ä¸ŠåŸºäºæ–‡ä»¶æ¥è™šæ‹Ÿçš„å†…å­˜çš„å­—èŠ‚æ•°ï¼‰ï¼Œ å› ä¸ºå®ƒå‡å®šåœ¨å‹åŠ›ä¸‹å†…å­˜æ˜¯å¯å›æ”¶çš„ã€‚</p><h5 id="2-nodefs"><a href="#2-nodefs" class="headerlink" title="2. nodefs"></a>2. nodefs</h5><p><code>nodefs</code> è¡¨ç¤ºèŠ‚ç‚¹çš„ä¸»æ–‡ä»¶ç³»ç»Ÿï¼Œé€‚ç”¨äºæœ¬åœ°ç£ç›˜ã€emptyDirã€æ—¥å¿—å­˜å‚¨ç­‰ï¼Œå®ƒå…³æ³¨çš„æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´ <code>nodefs.available</code> å’Œ inode æ•° <code>nodefs.inodesFree</code>ã€‚</p><h5 id="3-imagefs"><a href="#3-imagefs" class="headerlink" title="3. imagefs"></a>3. imagefs</h5><p><code>imagefs</code> è¡¨ç¤ºçš„æ˜¯å®¹å™¨è¿è¡Œæ—¶ï¼Œå­˜å‚¨å®¹å™¨é•œåƒå’Œå®¹å™¨å¯å†™å±‚ï¼Œæ˜¯å°†æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ ¹æ® CGroup åˆ†å±‚åçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå…³æ³¨çš„æ˜¯è¯¥å±‚æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´ <code>imagefs.available</code> å’Œ inode æ•° <code>imagefs.inodesFree</code>ã€‚</p><h4 id="2ï¼‰é©±é€æ¡ä»¶"><a href="#2ï¼‰é©±é€æ¡ä»¶" class="headerlink" title="2ï¼‰é©±é€æ¡ä»¶"></a>2ï¼‰é©±é€æ¡ä»¶</h4><p>kubelet çš„é©±é€æ¡ä»¶å½¢å¼ä¸º <code>[eviction-signal][operator][quantity]</code>ï¼Œå…¶ä¸­:</p><ul><li><code>eviction-signal</code>: å³ä¸Šè¿°çš„é©±é€ä¿¡å·</li><li><code>operator</code>: è¡¨ç¤ºå…³ç³»è¿ç®—ç¬¦ï¼Œæ¯”å¦‚å¤§äºå°äºç­‰</li><li><code>quantity</code>: è¡¨ç¤ºè§¦å‘é©±é€æ¡ä»¶çš„æŒ‡æ ‡ï¼Œæ¯”å¦‚ 1Giã€‚å…¶è¡¨ç¤ºå½¢å¼è¦ä¸ Kubernetes çš„å½¢å¼åŒ¹é…ï¼Œæ”¯æŒæ•°å€¼å½¢å¼æˆ–ç™¾åˆ†æ¯”ï¼ˆ10%ï¼‰</li></ul><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼Œä»¥èŠ‚ç‚¹çš„æ€»å†…å­˜ä¸º 10Gi ä¸ºä¾‹ï¼Œæˆ‘ä»¬æƒ³å°†è§¦å‘æ¡ä»¶è®¾ç½®ä¸º1 Giï¼Œåˆ™å¯ä»¥å°†é©±é€æ¡ä»¶å®šä¹‰ä¸ºä»¥ä¸‹ä¸¤ç§å½¢å¼ä¸­çš„ä¸€ç§:</p><ul><li><code>memory.available&lt;10%</code> </li><li> <code>memory.available&lt; 1G</code></li></ul><h5 id="1-è½¯é©±é€æ¡ä»¶"><a href="#1-è½¯é©±é€æ¡ä»¶" class="headerlink" title="1. è½¯é©±é€æ¡ä»¶"></a>1. è½¯é©±é€æ¡ä»¶</h5><p>åœ¨è®¾ç½®è½¯é©±é€æ¡ä»¶æ—¶ï¼Œå¿…é¡»æŒ‡å®šä¸€ä¸ªå®½é™æœŸï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚åœ¨è¶…è¿‡å®½é™æœŸä¹‹å‰ï¼Œkubelet ä¸ä¼šç«‹åˆ»é©±é€ Pod</p><p>åœ¨è®¾ç½®å®½é™æœŸçš„åŒæ—¶è¿˜å¯ä»¥æŒ‡å®š Pod ç»ˆæ­¢çš„å®½é™æœŸä¸Šé™ï¼Œç”¨äºåœ¨è§¦å‘è½¯é©±é€æ—¶ä¼˜é›…çš„ç»ˆæ­¢ Podã€‚å½“ä¸¤è€…åŒæ—¶è¢«è®¾ç½®ï¼Œå¹¶ä¸”æ»¡è¶³è½¯é©±é€é˜ˆå€¼æ—¶ï¼Œkubelet ä¼šä½¿ç”¨ä¸¤è€…é—´è¾ƒå°çš„é‚£ä¸ª</p><p><strong>è½¯é©±é€çš„é…ç½®å‚æ•°:</strong></p><ul><li><code>eviction-soft</code>: é©±é€æ¡ä»¶åˆ—è¡¨ï¼Œé©±é€æ¡ä»¶å¦‚ <code>memory.available&lt;1.5Gi</code>ï¼Œå¦‚æœé©±é€æ¡ä»¶æŒç»­è¾ƒé•¿æ—¶é—´è¶…è¿‡æŒ‡å®šçš„å®½é™æœŸï¼Œå°±ä¼šè§¦å‘ Pod é©±é€</li><li><code>eviction-soft-grace-period</code>: é©±é€å®½é™æœŸåˆ—è¡¨ï¼Œå¦‚ <code>memory.available=1m30s</code>ï¼Œç”¨äºå®šä¹‰è½¯é©±é€åœ¨æ­£å¼é©±é€ Pod å‰å¿…é¡»ä¿å­˜å¤šä¹…ï¼Œä¸é©±é€æ¡ä»¶ç»‘å®š</li><li><code>eviction-max-pod-grace-period</code>: åœ¨æ»¡è¶³è½¯é©±é€æ¡ä»¶è€Œç»ˆæ­¢ Pod æ—¶ï¼Œä½¿ç”¨çš„æœ€å¤§å…è®¸å®½é™æœŸï¼ˆå•ä½ä¸ºç§’ï¼‰</li></ul><h5 id="2-ç¡¬é©±é€æ¡ä»¶"><a href="#2-ç¡¬é©±é€æ¡ä»¶" class="headerlink" title="2. ç¡¬é©±é€æ¡ä»¶"></a>2. ç¡¬é©±é€æ¡ä»¶</h5><p>ç¡¬é©±é€æ¡ä»¶æ²¡æœ‰å®½é™æœŸï¼Œå½“è¾¾åˆ°ç¡¬é©±é€çš„é˜ˆå€¼æ—¶ï¼Œkubelet ä¼šç«‹å³æ€æ­» Pod ä»¥å›æ”¶èµ„æºï¼ˆå¦‚å†…å­˜ï¼‰ï¼Œé¿å…èµ„æºè€—å°½</p><p><strong>ç¡¬é©±é€çš„é…ç½®å‚æ•°:</strong></p><ul><li><code>eviction-hard</code>: é©±é€æ¡ä»¶åˆ—è¡¨ï¼Œé©±é€æ¡ä»¶å¦‚: ``memory.available&lt;1Gi`</li></ul><p><strong>kubelet é»˜è®¤çš„ç¡¬é©±é€æ¡ä»¶:</strong></p><ul><li><code>memory.available&lt;100Mi</code></li><li><code>nodefs.available&lt;10%</code></li><li><code>imagefs.available&lt;15%</code></li><li><code>nodefs.inodesFree&lt;5%</code>ï¼ˆLinux èŠ‚ç‚¹ï¼‰</li></ul><h4 id="3ï¼‰é©±é€ç›‘æ§é—´éš”"><a href="#3ï¼‰é©±é€ç›‘æ§é—´éš”" class="headerlink" title="3ï¼‰é©±é€ç›‘æ§é—´éš”"></a>3ï¼‰é©±é€ç›‘æ§é—´éš”</h4><p>kubelet æ ¹æ®å…¶é…ç½®çš„ <code>housekeeping-interval</code>ï¼ˆé»˜è®¤ä¸º <code>10s</code>ï¼‰é—´éš”æ¥è¯„ä¼°é©±é€æ¡ä»¶</p><h3 id="3ã€èŠ‚ç‚¹å‹åŠ›çŠ¶å†µ"><a href="#3ã€èŠ‚ç‚¹å‹åŠ›çŠ¶å†µ" class="headerlink" title="3ã€èŠ‚ç‚¹å‹åŠ›çŠ¶å†µ"></a>3ã€èŠ‚ç‚¹å‹åŠ›çŠ¶å†µ</h3><p>kubelet ä¼šæŠ¥å‘ŠèŠ‚ç‚¹çŠ¶å†µä»¥åæ˜ èŠ‚ç‚¹å¤„äºå‹åŠ›ä¹‹ä¸‹ï¼Œå…¶ä¸é©±é€ä¿¡å·çš„å¯¹åº”å…³ç³»å¦‚ä¸‹:</p><table><thead><tr><th>èŠ‚ç‚¹å‹åŠ›è¡¨ç°</th><th><strong>é©±é€ä¿¡å·</strong></th><th>æè¿°</th></tr></thead><tbody><tr><td>MemoryPressure</td><td>memory.available</td><td>èŠ‚ç‚¹ä¸Šçš„å¯ç”¨å†…å­˜å·²æ»¡è¶³é©±é€æ¡ä»¶</td></tr><tr><td>DiskPressure</td><td>nodefs.available<code>ã€</code>nodefs.inodesFree<code>ã€</code>imagefs.available<code>æˆ–</code>imagefs.inodesFree</td><td>èŠ‚ç‚¹çš„æ ¹æ–‡ä»¶ç³»ç»Ÿæˆ–é•œåƒæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´æˆ– inode å·²æ»¡è¶³é©±é€æ¡ä»¶</td></tr><tr><td>PIDPressure</td><td>pid.available</td><td>(Linux) èŠ‚ç‚¹ä¸Šçš„å¯ç”¨è¿›ç¨‹æ ‡è¯†ç¬¦å·²ä½äºé©±é€æ¡ä»¶</td></tr></tbody></table><p>é€šè¿‡é…ç½® kubelet çš„å‚æ•° <code>nodeStatusUpdateFrequency</code> å¯ä»¥è°ƒæ•´èŠ‚ç‚¹å‹åŠ›æ¡ä»¶çš„æ›´æ–°é—´éš”ï¼Œé»˜è®¤ä¸º 10s</p><h3 id="4ã€èŠ‚ç‚¹å­˜å‚¨èµ„æºä¸è¶³"><a href="#4ã€èŠ‚ç‚¹å­˜å‚¨èµ„æºä¸è¶³" class="headerlink" title="4ã€èŠ‚ç‚¹å­˜å‚¨èµ„æºä¸è¶³"></a>4ã€èŠ‚ç‚¹å­˜å‚¨èµ„æºä¸è¶³</h3><p>å…³äºèŠ‚ç‚¹å­˜å‚¨èµ„æºé»˜è®¤çš„é©±é€è§¦å‘æ¡ä»¶ä¸º:</p><ul><li><code>nodefs.available&lt;10%</code></li><li><code>imagefs.available&lt;15%</code></li></ul><h4 id="1ï¼‰é©±é€æœºåˆ¶"><a href="#1ï¼‰é©±é€æœºåˆ¶" class="headerlink" title="1ï¼‰é©±é€æœºåˆ¶"></a>1ï¼‰é©±é€æœºåˆ¶</h4><ul><li><p>å½“ <code>imagefs</code> è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œkubelet ä¼šåˆ é™¤èŠ‚ç‚¹ä¸Šæ‰€æœ‰æœªä½¿ç”¨çš„å®¹å™¨é•œåƒæ¥æ¸…ç†ç£ç›˜ç©ºé—´ï¼Œä»¥æ­¤å›æ”¶å­˜å‚¨èµ„æº</p></li><li><p>å½“ <code>nodefs</code> è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œkubelet ä¼šæ‹’ç»æ–°è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹çš„ Pod è¿è¡Œï¼Œå¹¶å‘ APIServer é€šçŸ¥ <code>DiskPressure condition</code>ã€‚ç„¶åä¼šå°è¯•åˆ é™¤å·²æ­»äº¡çš„ Pod å’Œå®¹å™¨æ¥å›æ”¶ç£ç›˜ç©ºé—´ï¼Œå¦‚æœç»è¿‡æ¸…ç†åä»ä½äºé˜ˆå€¼ï¼Œkubelet å°±ä¼šå¼€å§‹é©±é€ Podï¼ˆä¸ä¼šè€ƒè™‘QoSä¼˜å…ˆçº§ï¼Œè€Œæ˜¯æ ¹æ® nodefs çš„å®é™…ä½¿ç”¨é‡å¤§å°è¿›è¡Œé©±é€æ’åºï¼Œå¦‚æœé©±é€çš„äº‹ DaemonSetï¼Œkubelet ä¼šé˜»æ­¢å…¶é‡å¯ï¼Œç›´åˆ° nodefs çš„å¯ç”¨é‡å¤§äºé˜ˆå€¼ï¼‰</p></li></ul><h4 id="2ï¼‰ä¸¾ä¾‹è¯´æ˜"><a href="#2ï¼‰ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="2ï¼‰ä¸¾ä¾‹è¯´æ˜"></a>2ï¼‰ä¸¾ä¾‹è¯´æ˜</h4><p>æœ‰å¦‚ä¸‹ Podï¼Œå…¶å­˜å‚¨èµ„æºä½¿ç”¨æƒ…å†µå¦‚ä¸‹:</p><table><thead><tr><th align="left">Pod Name</th><th align="left">Pod QoS</th><th align="left">nodefs usage</th></tr></thead><tbody><tr><td align="left">A</td><td align="left">Best Effort</td><td align="left">800M</td></tr><tr><td align="left">B</td><td align="left">Guaranteed</td><td align="left">1.3G</td></tr><tr><td align="left">C</td><td align="left">Burstable</td><td align="left">1.2G</td></tr><tr><td align="left">D</td><td align="left">Burstable</td><td align="left">700M</td></tr><tr><td align="left">E</td><td align="left">Best Effort</td><td align="left">500M</td></tr><tr><td align="left">F</td><td align="left">Guaranteed</td><td align="left">1G</td></tr></tbody></table><p>å½“ nodefs çš„ä½¿ç”¨é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œkubelet ä¼šæ ¹æ® Pod çš„ nodefs ä½¿ç”¨é‡æ¥å¯¹ Pod è¿›è¡Œæ’åï¼Œé¦–å…ˆé©±é€ç£ç›˜ä½¿ç”¨é‡æœ€å¤šçš„ Podã€‚é©±é€é¡ºåºæ’åå¦‚ä¸‹ï¼š</p><table><thead><tr><th align="left">Pod Name</th><th align="left">Pod QoS</th><th align="left">nodefs usage</th></tr></thead><tbody><tr><td align="left">B</td><td align="left">Guaranteed</td><td align="left">1.3G</td></tr><tr><td align="left">C</td><td align="left">Burstable</td><td align="left">1.2G</td></tr><tr><td align="left">F</td><td align="left">Guaranteed</td><td align="left">1G</td></tr><tr><td align="left">A</td><td align="left">Best Effort</td><td align="left">800M</td></tr><tr><td align="left">D</td><td align="left">Burstable</td><td align="left">700M</td></tr><tr><td align="left">E</td><td align="left">Best Effort</td><td align="left">500M</td></tr></tbody></table><h3 id="5ã€èŠ‚ç‚¹å†…å­˜èµ„æºä¸è¶³"><a href="#5ã€èŠ‚ç‚¹å†…å­˜èµ„æºä¸è¶³" class="headerlink" title="5ã€èŠ‚ç‚¹å†…å­˜èµ„æºä¸è¶³"></a>5ã€èŠ‚ç‚¹å†…å­˜èµ„æºä¸è¶³</h3><p>å…³äºèŠ‚ç‚¹å†…å­˜èµ„æºé»˜è®¤çš„é©±é€è§¦å‘æ¡ä»¶ä¸º:</p><ul><li><code>memory.available&lt;100Mi</code></li></ul><h4 id="1ï¼‰é©±é€æœºåˆ¶-1"><a href="#1ï¼‰é©±é€æœºåˆ¶-1" class="headerlink" title="1ï¼‰é©±é€æœºåˆ¶"></a>1ï¼‰é©±é€æœºåˆ¶</h4><p>å½“è§¦å‘é˜ˆå€¼æ—¶ï¼Œkubelet ä¼šå‘ APIServer é€šçŸ¥ <code>MemoryPressure condition</code>ï¼Œæ­¤æ—¶ kubelet å°†ä¸å†æ¥å—æ–°çš„ QoS ä¸º <code>BestEffort</code> çš„ Pod åœ¨èŠ‚ç‚¹è¿è¡Œï¼Œå¹¶ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ¥é©±é€ Pod:</p><ul><li>Pod çš„å†…å­˜ä½¿ç”¨é‡æ˜¯å¦è¶…è¿‡äº† <code>request</code> æŒ‡å®šçš„å€¼</li><li>æ ¹æ® priority æ’åºï¼Œä¼˜å…ˆçº§ä½çš„ Pod æœ€å…ˆè¢«é©±é€ï¼ˆä¿è¯ <code>Guaranteed</code> ä¸ä¼šæœ€å…ˆè¢«é©±é€ï¼‰</li><li>æ¯”è¾ƒå®ƒä»¬çš„å†…å­˜ä½¿ç”¨é‡ä¸ <code>request</code> æŒ‡å®šçš„å€¼ä¹‹å·®ï¼ˆ<code>container_memory_usage_bytes</code> æŒ‡æ ‡å€¼ä¸ <code>container_resource_requests_memory_bytes</code> æŒ‡æ ‡å€¼çš„å·®ï¼Œå¦‚æœæœ‰å¤šä¸ªå®¹å™¨ï¼Œåˆ™ä¸ºæ‰€æœ‰å·®å€¼çš„æ€»å’Œï¼‰</li></ul><h4 id="2ï¼‰ä¸¾ä¾‹è¯´æ˜-1"><a href="#2ï¼‰ä¸¾ä¾‹è¯´æ˜-1" class="headerlink" title="2ï¼‰ä¸¾ä¾‹è¯´æ˜"></a>2ï¼‰ä¸¾ä¾‹è¯´æ˜</h4><p>æœ‰å¦‚ä¸‹ Podï¼Œå…¶å†…å­˜èµ„æºä½¿ç”¨æƒ…å†µå¦‚ä¸‹:</p><table><thead><tr><th align="left">Pod Name</th><th align="left">Pod QoS</th><th align="left">Memory requested</th><th align="left">Memory limits</th><th align="left">Memory usage</th></tr></thead><tbody><tr><td align="left">A</td><td align="left">Best Effort</td><td align="left">0</td><td align="left">0</td><td align="left">700M</td></tr><tr><td align="left">B</td><td align="left">Guaranteed</td><td align="left">2Gi</td><td align="left">2Gi</td><td align="left">1.9G</td></tr><tr><td align="left">C</td><td align="left">Burstable</td><td align="left">1Gi</td><td align="left">2Gi</td><td align="left">1.8G</td></tr><tr><td align="left">D</td><td align="left">Burstable</td><td align="left">1Gi</td><td align="left">2Gi</td><td align="left">800M</td></tr><tr><td align="left">E</td><td align="left">Best Effort</td><td align="left">0</td><td align="left">0</td><td align="left">300M</td></tr><tr><td align="left">F</td><td align="left">Guaranteed</td><td align="left">2Gi</td><td align="left">2Gi</td><td align="left">1G</td></tr></tbody></table><p>å½“å†…å­˜çš„ä½¿ç”¨é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œkubelet ä¼šæ ¹æ® Pod ç›¸å¯¹äº <code>request</code> çš„å†…å­˜ä½¿ç”¨é‡æ¥å¯¹ Pod è¿›è¡Œæ’åï¼Œé¦–å…ˆé©±é€ç›¸å¯¹ä½¿ç”¨é‡æœ€å¤šçš„ Podã€‚é©±é€é¡ºåºæ’åå¦‚ä¸‹ï¼š</p><table><thead><tr><th align="left">Pod Name</th><th align="left">Pod QoS</th><th align="left">Memory requested</th><th align="left">Memory limits</th><th align="left">Memory usage</th><th align="left">å†…å­˜ç›¸å¯¹ä½¿ç”¨é‡</th></tr></thead><tbody><tr><td align="left">C</td><td align="left">Burstable</td><td align="left">1Gi</td><td align="left">2Gi</td><td align="left">1.8G</td><td align="left">800M</td></tr><tr><td align="left">A</td><td align="left">Best Effort</td><td align="left">0</td><td align="left">0</td><td align="left">700M</td><td align="left">700M</td></tr><tr><td align="left">E</td><td align="left">Best Effort</td><td align="left">0</td><td align="left">0</td><td align="left">300M</td><td align="left">300M</td></tr><tr><td align="left">B</td><td align="left">Guaranteed</td><td align="left">2Gi</td><td align="left">2Gi</td><td align="left">1.9G</td><td align="left">-100M</td></tr><tr><td align="left">D</td><td align="left">Burstable</td><td align="left">1Gi</td><td align="left">2Gi</td><td align="left">800M</td><td align="left">-200M</td></tr><tr><td align="left">F</td><td align="left">Guaranteed</td><td align="left">2Gi</td><td align="left">2Gi</td><td align="left">1G</td><td align="left">-1G</td></tr></tbody></table><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong> å½“å†…å­˜èµ„æºä¸è¶³æ—¶ï¼Œkubelet åœ¨é©±é€ Pod æ—¶ï¼Œåªä¼šè€ƒè™‘ requests å’Œ Pod çš„å†…å­˜ä½¿ç”¨é‡ï¼Œå¹¶ä¸ä¼šè€ƒè™‘ limitsã€‚</p></blockquote><h3 id="6ã€èŠ‚ç‚¹-OOM-æ—¶"><a href="#6ã€èŠ‚ç‚¹-OOM-æ—¶" class="headerlink" title="6ã€èŠ‚ç‚¹ OOM æ—¶"></a>6ã€èŠ‚ç‚¹ OOM æ—¶</h3><h4 id="1ï¼‰é©±é€æœºåˆ¶-2"><a href="#1ï¼‰é©±é€æœºåˆ¶-2" class="headerlink" title="1ï¼‰é©±é€æœºåˆ¶"></a>1ï¼‰é©±é€æœºåˆ¶</h4><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œkubelet ä¼šé€šè¿‡é©±é€æ¡ä»¶æ€æ­» Pod æ¥å›æ”¶å†…å­˜èµ„æºï¼Œä½†æ˜¯ç”±äº kubelet æ˜¯é»˜è®¤ 10s æŠ“å–ä¸€æ¬¡ cAdvisor çš„ç›‘æ§æ•°æ®ï¼Œæ‰€ä»¥æ˜¯æœ‰å¯èƒ½åœ¨é©±é€å›æ”¶ä¹‹å‰å‡ºç° OOM æƒ…å†µçš„ã€‚è¿™ä¸ªæ—¶å€™ Node èŠ‚ç‚¹å°±ä¼šä¾èµ–å†…æ ¸çš„ oom_killer æ¥å“åº”ã€‚</p><p>kubelet æ ¹æ® Pod çš„ QoS ä¼šä¸ºæ¯ä¸ªå®¹å™¨è®¾ç½®ä¸€ä¸ª <code>oom_score_adj</code> å€¼ï¼Œå¦‚ä¸‹:</p><table><thead><tr><th>QoS</th><th>oom_score_adj</th></tr></thead><tbody><tr><td>Guaranteed</td><td>-997</td></tr><tr><td>BestEffort</td><td>1000</td></tr><tr><td>Burstable</td><td>min(max(2, 1000 - (1000 * memoryRequestBytes) / machineMemoryCapacityBytes), 999)</td></tr></tbody></table><p>OOM killer ä¼šæ€æ‰ <code>oom_score_adj</code> å€¼æœ€é«˜çš„å®¹å™¨ï¼Œå¦‚æœæœ‰å¤šä¸ªå®¹å™¨çš„ <code>oom_score_adj</code> å€¼ç›¸åŒï¼Œå°±ä¼šæ€æ‰å†…å­˜ä½¿ç”¨é‡æœ€å¤šçš„å®¹å™¨ï¼ˆå…¶å®æ˜¯å› ä¸ºå†…å­˜ä½¿ç”¨é‡æœ€å¤šçš„å®¹å™¨çš„ oom_score å€¼æœ€é«˜ï¼‰ï¼Œä»¥æ­¤æ¥é™ä½ç³»ç»Ÿå‹åŠ›ã€‚ä½†æ˜¯ä¸ Pod é©±é€ä¸åŒçš„æ˜¯ï¼ŒOOM æ€æ­»çš„å®¹å™¨ï¼Œkubelet æ˜¯å¯ä»¥æ ¹æ®å…¶ <code>RestartPolicy</code> é‡å¯å®ƒçš„ã€‚</p><p><code>omm_score</code> çš„è®¡ç®—å…¬å¼å¦‚ä¸‹:</p><blockquote><p>oom_score = å®¹å™¨ä½¿ç”¨çš„å†…å­˜å ç³»ç»Ÿå†…å­˜çš„ç™¾åˆ†æ¯” + oom_score_adj </p></blockquote><h4 id="2ï¼‰ä¸¾ä¾‹è¯´æ˜-2"><a href="#2ï¼‰ä¸¾ä¾‹è¯´æ˜-2" class="headerlink" title="2ï¼‰ä¸¾ä¾‹è¯´æ˜"></a>2ï¼‰ä¸¾ä¾‹è¯´æ˜</h4><p>å‡è®¾æŸèŠ‚ç‚¹è¿è¡Œç€ 4 ä¸ª Podï¼Œä¸”æ¯ä¸ª Pod ä¸­åªæœ‰ä¸€ä¸ªå®¹å™¨ã€‚æ¯ä¸ª QoS ç±»å‹ä¸º <code>Burstable</code> çš„ Pod é…ç½®çš„å†…å­˜ requests æ˜¯ <code>4Gi</code>ï¼ŒèŠ‚ç‚¹çš„å†…å­˜å¤§å°ä¸º <code>30Gi</code>ã€‚æ¯ä¸ª Pod çš„ <code>oom_score_adj</code> å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th align="left">Pod Name</th><th align="left">Pod QoS</th><th align="left">oom_score_adj</th></tr></thead><tbody><tr><td align="left">A</td><td align="left">Best Effort</td><td align="left">1000</td></tr><tr><td align="left">B</td><td align="left">Guaranteed</td><td align="left">-998</td></tr><tr><td align="left">C</td><td align="left">Burstable</td><td align="left">867ï¼ˆæ ¹æ®ä¸Šé¢çš„å…¬å¼è®¡ç®—ï¼‰</td></tr><tr><td align="left">D</td><td align="left">Best Effort</td><td align="left">1000</td></tr></tbody></table><p>å½“è°ƒç”¨ OOM killer æ—¶ï¼Œå®ƒé¦–å…ˆé€‰æ‹© <code>oom_score_adj</code> å€¼æœ€é«˜çš„ <code>BestEffort</code> å®¹å™¨ï¼ˆ1000ï¼‰ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå®¹å™¨çš„ <code>oom_score_adj</code> å€¼éƒ½æ˜¯ 1000ï¼ŒOOM killer æœ€ç»ˆä¼šé€‰æ‹©å†…å­˜ä½¿ç”¨é‡æœ€å¤šçš„å®¹å™¨ï¼Œç„¶åå¦‚æœè¿˜éœ€è¦ç»§ç»­å›æ”¶å†…å­˜èµ„æºï¼Œå°±ä¼šé©±é€ <code>Burstable</code> å®¹å™¨ã€‚</p><h3 id="7ã€æœ€å°é©±é€å›æ”¶"><a href="#7ã€æœ€å°é©±é€å›æ”¶" class="headerlink" title="7ã€æœ€å°é©±é€å›æ”¶"></a>7ã€æœ€å°é©±é€å›æ”¶</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé©±é€ Pod åªä¼šå›æ”¶å°‘é‡çš„ç´§ä¿èµ„æºã€‚ è¿™å¯èƒ½å¯¼è‡´ kubelet åå¤è¾¾åˆ°é…ç½®çš„é©±é€æ¡ä»¶å¹¶è§¦å‘å¤šæ¬¡é©±é€ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ <code>--eviction-minimum-reclaim</code> æ ‡å¿—æˆ– <a href="https://kubernetes.io/zh/docs/tasks/administer-cluster/kubelet-config-file/">kubelet é…ç½®æ–‡ä»¶</a> ä¸ºæ¯ä¸ªèµ„æºé…ç½®æœ€å°å›æ”¶é‡ã€‚ å½“ kubelet æ³¨æ„åˆ°æŸä¸ªèµ„æºè€—å°½æ—¶ï¼Œå®ƒä¼šç»§ç»­å›æ”¶è¯¥èµ„æºï¼Œç›´åˆ°å›æ”¶åˆ°ä½ æ‰€æŒ‡å®šçš„æ•°é‡ä¸ºæ­¢ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®è®¾ç½®æœ€å°å›æ”¶é‡ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubelet.config.k8s.io/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">KubeletConfiguration</span><br><span class="hljs-attr">evictionHard:</span><br>  <span class="hljs-attr">memory.available:</span> <span class="hljs-string">&quot;500Mi&quot;</span><br>  <span class="hljs-attr">nodefs.available:</span> <span class="hljs-string">&quot;1Gi&quot;</span><br>  <span class="hljs-attr">imagefs.available:</span> <span class="hljs-string">&quot;100Gi&quot;</span><br><span class="hljs-attr">evictionMinimumReclaim:</span><br>  <span class="hljs-attr">memory.available:</span> <span class="hljs-string">&quot;0Mi&quot;</span><br>  <span class="hljs-attr">nodefs.available:</span> <span class="hljs-string">&quot;500Mi&quot;</span><br>  <span class="hljs-attr">imagefs.available:</span> <span class="hljs-string">&quot;2Gi&quot;</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ <code>nodefs.available</code> ä¿¡å·æ»¡è¶³é©±é€æ¡ä»¶ï¼Œ kubelet ä¼šå›æ”¶èµ„æºï¼Œç›´åˆ°ä¿¡å·è¾¾åˆ° <code>1Gi</code> çš„æ¡ä»¶ï¼Œ ç„¶åç»§ç»­å›æ”¶è‡³å°‘ <code>500Mi</code> ç›´åˆ°ä¿¡å·è¾¾åˆ° <code>1.5Gi</code>ã€‚</p><p>ç±»ä¼¼åœ°ï¼Œkubelet ä¼šå›æ”¶ <code>imagefs</code> èµ„æºï¼Œç›´åˆ° <code>imagefs.available</code> ä¿¡å·è¾¾åˆ° <code>102Gi</code>ã€‚</p><p>å¯¹äºæ‰€æœ‰èµ„æºï¼Œé»˜è®¤çš„ <code>eviction-minimum-reclaim</code> ä¸º <code>0</code>ã€‚</p><h3 id="8ã€é¢„åˆ†é…èµ„æº"><a href="#8ã€é¢„åˆ†é…èµ„æº" class="headerlink" title="8ã€é¢„åˆ†é…èµ„æº"></a>8ã€é¢„åˆ†é…èµ„æº</h3><p>å’Œå®¹å™¨ä¸€æ ·ï¼Œåœ¨æ²¡æœ‰åšä»»ä½•é™åˆ¶çš„æƒ…å†µä¸‹ï¼ŒK8S çš„ Pod èƒ½å¤Ÿä½¿ç”¨æ‰€åœ¨ Node èŠ‚ç‚¹çš„æ‰€æœ‰å¯ç”¨èµ„æºã€‚è¿™äº‹å®ä¸Šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨èŠ‚ç‚¹ä¸Šè¿äº†è®¸å¤šç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ï¼ˆç³»ç»Ÿå†…æ ¸ã€é©±åŠ¨ã€kubelet ç­‰ï¼‰ï¼Œå®ƒä»¬ä¹Ÿæ˜¯è¦æ¶ˆè€—èµ„æºçš„ï¼Œé™¤éæˆ‘ä»¬ä¸ºè¿™äº›å®ˆæŠ¤è¿›ç¨‹é¢„ç•™å‡ºä¸€å®šçš„èµ„æºï¼Œå¦åˆ™å®ƒä»¬å°±ä¼šä¸ Pod ä¸€èµ·åŠ å…¥åˆ°èµ„æºäº‰å¤ºçš„è¡Œåˆ—ï¼Œå¾ˆå¯èƒ½ä¼šç›´é¢èŠ‚ç‚¹èµ„æºçŸ­ç¼ºçš„é—®é¢˜ï¼Œæœ€ä¸¥é‡çš„æƒ…å†µå°†æ— æ³•ç»´æŒç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚</p><h4 id="1ï¼‰èŠ‚ç‚¹å¯ç”¨è®¡ç®—èµ„æºé‡"><a href="#1ï¼‰èŠ‚ç‚¹å¯ç”¨è®¡ç®—èµ„æºé‡" class="headerlink" title="1ï¼‰èŠ‚ç‚¹å¯ç”¨è®¡ç®—èµ„æºé‡"></a>1ï¼‰èŠ‚ç‚¹å¯ç”¨è®¡ç®—èµ„æºé‡</h4><p>Kubernetes èŠ‚ç‚¹ä¸Šçš„ <code>Allocatable</code> è¢«å®šä¹‰ä¸º Pod çš„å¯ç”¨è®¡ç®—èµ„æºé‡ã€‚è°ƒåº¦å™¨åœ¨è°ƒåº¦ Pod æ—¶æ—¶ä¸ä¼šè¶…é¢ç”³è¯· <code>Allocatable</code> çš„ï¼Œç›®å‰å¯æ”¯æŒçš„èµ„æºä¸º <code>cpu</code>ã€<code>memory</code>ã€<code>ephemeral-storage</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªèŠ‚ç‚¹çš„èµ„æºæ€»å’Œå®šä¹‰ä¸ºå¦‚ä¸‹å½¢å¼:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211104144209729.png" alt="image-20211104144209729"></p><h4 id="2ï¼‰é¢„ç•™èµ„æº"><a href="#2ï¼‰é¢„ç•™èµ„æº" class="headerlink" title="2ï¼‰é¢„ç•™èµ„æº"></a>2ï¼‰é¢„ç•™èµ„æº</h4><p>åœ¨ <code>kubelet</code> ä¸­ï¼Œå¯ä»¥ä¸ºä¸¤ç±»ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹é¢„ç•™èµ„æºï¼Œä¸€ä¸ªæ˜¯æ“ä½œç³»ç»Ÿé¢„ç•™èµ„æº <code>system-reserved</code>ï¼Œå¦ä¸€ä¸ªä¸º K8S ç³»ç»Ÿé¢„ç•™èµ„æº <code>kube-reserved</code>ã€‚</p><h5 id="1-system-reserved"><a href="#1-system-reserved" class="headerlink" title="1. system-reserved"></a>1. system-reserved</h5><p><code>system-reserved</code> ç”¨äºä¸ºè¯¸å¦‚ <code>sshd</code>ã€<code>udev</code> ç­‰ç³»ç»Ÿçº§å®ˆæŠ¤è¿›ç¨‹é¢„ç•™èµ„æºï¼ˆcpuã€å†…å­˜ã€ç£ç›˜ï¼‰ï¼›å¹¶ä¸”ä¸ºç³»ç»Ÿå†…æ ¸é¢„ç•™å†…å­˜èµ„æºï¼ˆkernel æ‰€ä½¿ç”¨çš„å†…å­˜å¹¶ä¸åŒ…æ‹¬åœ¨ Pod ä¸­ï¼‰ï¼›ä»¥åŠä¸ºç”¨æˆ·ç™»é™†ä¼šè¯é¢„ç•™èµ„æºï¼ˆsystemd ä½“ç³»ä¸­çš„ user.sliceï¼‰</p><p>é™¤äº† <code>Allocatable</code> ç›¸å…³çš„ <code>cpu</code>ã€<code>memory</code> ã€<code>ephemeral-storage</code> å‚æ•°å¤–ï¼Œ<code>pid</code>  å‚æ•°å¯ç”¨äºä¸ºOSç³»ç»Ÿè¿›ç¨‹é¢„ç•™æŒ‡å®šçš„ è¿›ç¨‹ IDã€‚</p><p><code>system-reserved</code> çš„é…ç½®æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§ä¸º <code>kubelet</code> å‘½ä»¤è¡Œå‚æ•° <code>--system-reserved</code>ï¼Œå¦ä¸€ç§ä¸º <code>kubelet</code> çš„ yaml é…ç½®æ–‡ä»¶å‚æ•° <code>systemReserved</code>ã€‚</p><h6 id="1âƒ£ï¸-å‘½ä»¤è¡Œå‚æ•°é…ç½®ç¤ºä¾‹"><a href="#1âƒ£ï¸-å‘½ä»¤è¡Œå‚æ•°é…ç½®ç¤ºä¾‹" class="headerlink" title="1âƒ£ï¸ å‘½ä»¤è¡Œå‚æ•°é…ç½®ç¤ºä¾‹"></a>1âƒ£ï¸ å‘½ä»¤è¡Œå‚æ•°é…ç½®ç¤ºä¾‹</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">--system-reserved=[cpu=100m][,][memory=100Mi][,][ephemeral-storage=1Gi][,][pid=1000]<br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-é…ç½®æ–‡ä»¶å‚æ•°é…ç½®ç¤ºä¾‹"><a href="#2âƒ£ï¸-é…ç½®æ–‡ä»¶å‚æ•°é…ç½®ç¤ºä¾‹" class="headerlink" title="2âƒ£ï¸ é…ç½®æ–‡ä»¶å‚æ•°é…ç½®ç¤ºä¾‹"></a>2âƒ£ï¸ é…ç½®æ–‡ä»¶å‚æ•°é…ç½®ç¤ºä¾‹</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">systemReserved:</span><br>  <span class="hljs-attr">cpu:</span> <span class="hljs-string">512m</span><br>  <span class="hljs-attr">memory:</span> <span class="hljs-string">2048Mi</span><br>  <span class="hljs-attr">ephemeral-storage:</span> <span class="hljs-string">10Gi</span><br>  <span class="hljs-attr">pid:</span> <span class="hljs-number">1000</span><br></code></pre></td></tr></table></figure><h5 id="2-kube-reserved"><a href="#2-kube-reserved" class="headerlink" title="2. kube-reserved"></a>2. kube-reserved</h5><p><code>kube-reserved</code> ç”¨äºä¸ºè¯¸å¦‚ <code>kubelet</code>ã€å®¹å™¨è¿è¡Œæ—¶ã€èŠ‚ç‚¹é—®é¢˜ç›‘æµ‹å™¨ç­‰ Kubernetes ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹é¢„ç•™èµ„æºï¼ˆcpuã€å†…å­˜ã€ç£ç›˜ï¼‰ï¼Œè€Œå¹¶éä¸º Pod ä¿ç•™èµ„æºã€‚<code>kube-reserved</code> åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥å½±å“ä¸€ä¸ªèŠ‚ç‚¹ä¸Š Pod çš„å¤šå°‘ã€‚</p><p>é™¤äº† <code>Allocatable</code> ç›¸å…³çš„ <code>cpu</code>ã€<code>memory</code> ã€<code>ephemeral-storage</code> å‚æ•°å¤–ï¼Œ<code>pid</code>  å‚æ•°å¯ç”¨äºä¸º K8S ç³»ç»Ÿè¿›ç¨‹é¢„ç•™æŒ‡å®šçš„ è¿›ç¨‹ IDã€‚</p><p><code>kube-reserved</code> çš„é…ç½®æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§ä¸º <code>kubelet</code> å‘½ä»¤è¡Œå‚æ•° <code>--kube-reserved</code>ï¼Œå¦ä¸€ç§ä¸º <code>kubelet</code> çš„ yaml é…ç½®æ–‡ä»¶å‚æ•° <code>kubeReserved</code>ã€‚</p><h6 id="1âƒ£ï¸-å‘½ä»¤è¡Œå‚æ•°é…ç½®ç¤ºä¾‹-1"><a href="#1âƒ£ï¸-å‘½ä»¤è¡Œå‚æ•°é…ç½®ç¤ºä¾‹-1" class="headerlink" title="1âƒ£ï¸ å‘½ä»¤è¡Œå‚æ•°é…ç½®ç¤ºä¾‹"></a>1âƒ£ï¸ å‘½ä»¤è¡Œå‚æ•°é…ç½®ç¤ºä¾‹</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">--kube-reserved=[cpu=100m][,][memory=100Mi][,][ephemeral-storage=1Gi][,][pid=1000]<br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-é…ç½®æ–‡ä»¶å‚æ•°é…ç½®ç¤ºä¾‹-1"><a href="#2âƒ£ï¸-é…ç½®æ–‡ä»¶å‚æ•°é…ç½®ç¤ºä¾‹-1" class="headerlink" title="2âƒ£ï¸ é…ç½®æ–‡ä»¶å‚æ•°é…ç½®ç¤ºä¾‹"></a>2âƒ£ï¸ é…ç½®æ–‡ä»¶å‚æ•°é…ç½®ç¤ºä¾‹</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kubeReserved:</span><br>  <span class="hljs-attr">cpu:</span> <span class="hljs-string">512m</span><br>  <span class="hljs-attr">memory:</span> <span class="hljs-string">2048Mi</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduler</title>
    <link href="/2021/10/27/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-scheduler/"/>
    <url>/2021/10/27/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-scheduler/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-scheduler"><a href="#Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-scheduler" class="headerlink" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduler"></a>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduler</h1><p>åœ¨ K8S çš„ç»„ä»¶ä¸­ï¼Œ<code>kube-scheduler</code> æ˜¯ä¸“é—¨ç”¨äºå¤„ç†è°ƒåº¦çš„è¿›ç¨‹ã€‚å…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯æŒç»­ç›‘å¬ <code>API Server</code> æ¥è·å–<code>PodSpec.NodeName</code> ä¸ºç©ºçš„ Podï¼Œå¹¶å¯¹æ¯ä¸ª Pod åˆ›å»º bindingï¼Œç„¶åæ ¹æ®ç‰¹å®šçš„è°ƒåº¦ç®—æ³•å’Œè°ƒåº¦ç­–ç•¥å°† Pod è°ƒåº¦åˆ°åˆé€‚çš„ Node èŠ‚ç‚¹ä¸Šå»ï¼Œå†å°†è°ƒåº¦ç»“æœå›å†™ <code>API Server</code>ã€‚</p><span id="more"></span><h2 id="ä¸€ã€K8S-è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥"><a href="#ä¸€ã€K8S-è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥" class="headerlink" title="ä¸€ã€K8S è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥"></a>ä¸€ã€K8S è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥</h2><blockquote><p>ğŸš© Kube-scheduler æ˜¯ Kubernetes çš„é»˜è®¤è°ƒåº¦å™¨ï¼Œæ˜¯é›†ç¾¤æ•´ä½“æ§åˆ¶é¢çš„ä¸€éƒ¨åˆ†ã€‚kube-scheduler åœ¨è®¾è®¡ä¸Šå…è®¸è‡ªå®šä¹‰ä¸€ä¸ªè°ƒåº¦ç»„ä»¶æ¥æ›¿æ¢å®ƒï¼Œæ‰€ä»¥åªè¦æ¸…æ¥šçš„äº†è§£äº† K8S ä¸­è°ƒåº¦çš„åŸç†ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªè°ƒåº¦å™¨ã€‚</p></blockquote><h3 id="1ã€Kube-Scheduler-çš„å·¥ä½œåŸç†"><a href="#1ã€Kube-Scheduler-çš„å·¥ä½œåŸç†" class="headerlink" title="1ã€Kube-Scheduler çš„å·¥ä½œåŸç†"></a>1ã€Kube-Scheduler çš„å·¥ä½œåŸç†</h3><h4 id="1ï¼‰è°ƒåº¦æµç¨‹"><a href="#1ï¼‰è°ƒåº¦æµç¨‹" class="headerlink" title="1ï¼‰è°ƒåº¦æµç¨‹"></a>1ï¼‰è°ƒåº¦æµç¨‹</h4><h5 id="1-æµç¨‹æ¦‚è¿°"><a href="#1-æµç¨‹æ¦‚è¿°" class="headerlink" title="1. æµç¨‹æ¦‚è¿°"></a>1. æµç¨‹æ¦‚è¿°</h5><ul><li>é¦–å…ˆï¼Œç”¨æˆ·é€šè¿‡ Kubernetes å®¢æˆ·ç«¯é€šè¿‡æˆ– kubectl å·¥å…·é€šè¿‡ yaml çš„å½¢å¼å‘ç³»ç»Ÿå‘èµ·èµ„æºè¯·æ±‚</li><li>API Server æ”¶åˆ°ç”¨æˆ·çš„ POST è¯·æ±‚åï¼Œåˆ›å»º Pod ï¼Œå¹¶å°†ç›¸å…³ä¿¡æ¯å­˜å‚¨åˆ° etcd ä¸­</li><li>è°ƒåº¦å™¨ä¼šå®šæ—¶ç›‘å¬ API Server ï¼ˆwatch æœºåˆ¶ï¼‰ï¼Œä¸€æ—¦ etcd å­˜å‚¨ Pod çš„ä¿¡æ¯æˆåŠŸå°±ä¼šç«‹å³é€šçŸ¥ API Server</li><li>API Server æ”¶åˆ°é€šçŸ¥åä¼šå°† Pod åˆ›å»ºçš„æ¶ˆæ¯é€šçŸ¥åˆ° Schedulerï¼ŒSchedulerï¼ˆlist æœºåˆ¶ï¼‰ä¼šå»è·å– Pod åˆ—è¡¨å¹¶éå†å®ƒä»¬ï¼Œä¸€æ—¦å‘ç° Pod å±æ€§ä¸­å­˜åœ¨ <code>Dest Node=&quot;&quot;</code> ï¼Œä¾¿ä¼šè§¦å‘è°ƒåº¦æµç¨‹ã€‚</li><li>Pod åœ¨è°ƒåº¦çš„è¿‡ç¨‹ä¸­éœ€è¦ç»è¿‡èŠ‚ç‚¹é¢„é€‰ï¼ŒèŠ‚ç‚¹ä¼˜é€‰ï¼ŒèŠ‚ç‚¹é€‰ä¼˜3ä¸ªé˜¶æ®µï¼Œé€šè¿‡è¿‡æ»¤ï¼ˆFilteringï¼‰å’Œæ‰“åˆ†ï¼ˆScoringï¼‰ä¸¤è¿‡ç¨‹æŒ‘é€‰å‡ºæœ€ç»ˆè°ƒåº¦çš„èŠ‚ç‚¹<ul><li>èŠ‚ç‚¹é¢„é€‰ï¼ˆPredicate)ï¼š è¯¥è¿‡ç¨‹çš„ä¸»è¦å·¥ä½œæ˜¯è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„ Nodeï¼Œæ¡ä»¶å¦‚å†…å­˜å¤§å°ã€ç«¯å£ç­‰</li><li>èŠ‚ç‚¹ä¼˜é€‰ï¼ˆPriorityï¼‰ï¼šè¯¥è¿‡ç¨‹çš„ä¸»è¦å·¥ä½œæ˜¯å°†é€‰å‡ºçš„ Node æŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡Œæ’åº</li><li>èŠ‚ç‚¹æ‹©ä¼˜ï¼ˆSelectï¼‰ï¼šæ ¹æ®ä¼˜å…ˆçº§é€‰å®šèŠ‚ç‚¹</li></ul></li><li>ç»è¿‡ä¸Šé˜¶æ®µé€‰æ‹©å¾—åˆ†æœ€é«˜çš„ Node èŠ‚ç‚¹ä¸Pod è¿›æ­¥ bindingï¼Œå¹¶é€šçŸ¥ API Server å°†ç»“æœå›å†™ etcd</li><li>æœ€åç”±è¢«é€‰æ‹©å‡ºæ¥çš„ Node èŠ‚ç‚¹ä¸Šçš„ kubelet å»æ‰§è¡Œåˆ›å»º Pod çš„ç›¸å…³æ“ä½œï¼Œåˆ›å»ºå’Œå¯åŠ¨å®¹å™¨</li></ul><h5 id="2-å…·ä½“è¿‡ç¨‹å›¾"><a href="#2-å…·ä½“è¿‡ç¨‹å›¾" class="headerlink" title="2. å…·ä½“è¿‡ç¨‹å›¾"></a>2. å…·ä½“è¿‡ç¨‹å›¾</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211026100220906.png" alt="image-20211026100220906"></p><h3 id="2ã€è°ƒåº¦ç­–ç•¥"><a href="#2ã€è°ƒåº¦ç­–ç•¥" class="headerlink" title="2ã€è°ƒåº¦ç­–ç•¥"></a>2ã€è°ƒåº¦ç­–ç•¥</h3><h4 id="1ï¼‰æ–­è¨€-â€”â€”-Predicates"><a href="#1ï¼‰æ–­è¨€-â€”â€”-Predicates" class="headerlink" title="1ï¼‰æ–­è¨€ â€”â€” Predicates"></a>1ï¼‰æ–­è¨€ â€”â€” <em>Predicates</em></h4><blockquote><p>ğŸš© è°ƒåº¦å™¨é€šè¿‡æ–­è¨€çš„æ–¹å¼å®ç°äº†è¿‡æ»¤æ¥å£ï¼Œä»¥æ­¤å®ç°èŠ‚ç‚¹çš„é¢„é€‰é˜¶æ®µã€‚</p></blockquote><h5 id="1-å…·ä½“å·¥ä½œæµ"><a href="#1-å…·ä½“å·¥ä½œæµ" class="headerlink" title="1. å…·ä½“å·¥ä½œæµ"></a>1. å…·ä½“å·¥ä½œæµ</h5><ul><li>é¦–å…ˆï¼Œéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œè¯¥è¿‡ç¨‹å±äºå¼ºåˆ¶æ€§è§„åˆ™</li><li>è¾“å‡ºä¸Šä¸€é˜¶æ®µæ‰€æœ‰æ»¡è¶³è¦æ±‚çš„ Node å¹¶å°†å…¶è®°å½•ä½œä¸º <code>Priorities</code> çš„è¾“å…¥</li><li>å¦‚æœä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹éƒ½æ²¡æœ‰ï¼ŒPod å°±ä¼šä¸€ç›´å¤„äº Pending çŠ¶æ€ï¼Œè°ƒåº¦å™¨å›ä¸€ç›´é‡è¯•ï¼Œç›´åˆ°æœ‰æ»¡è¶³æ¡ä»¶çš„ Node è¢«é€‰å‡º</li></ul><h5 id="2-å¸¸ç”¨-Predicates-ç­–ç•¥"><a href="#2-å¸¸ç”¨-Predicates-ç­–ç•¥" class="headerlink" title="2. å¸¸ç”¨ Predicates ç­–ç•¥:"></a>2. å¸¸ç”¨ Predicates ç­–ç•¥:</h5><table><thead><tr><th>é¢„é€‰ç­–ç•¥</th><th>æè¿°</th></tr></thead><tbody><tr><td>PodFitsHostPorts</td><td>æ£€æŸ¥ Pod è¯·æ±‚çš„ç«¯å£ï¼ˆç½‘ç»œåè®®ç±»å‹ï¼‰åœ¨èŠ‚ç‚¹ä¸Šæ˜¯å¦å¯ç”¨ï¼Œæ˜¯å¦å­˜åœ¨ç«¯å£å†²çª</td></tr><tr><td>PodFitsHost</td><td>å¦‚æœ Pod æŒ‡å®šäº† NodeNameï¼Œæ£€æŸ¥èŠ‚ç‚¹åç§°æ˜¯å¦å’Œ NodeName åŒ¹é…</td></tr><tr><td>PodFitsResources</td><td>æ£€æŸ¥èŠ‚ç‚¹çš„ç©ºé—²èµ„æºï¼ˆä¾‹å¦‚ï¼ŒCPUå’Œå†…å­˜ï¼‰æ˜¯å¦æ»¡è¶³ Pod çš„ request èµ„æºè¦æ±‚</td></tr><tr><td>MatchNodeSelector</td><td>æ£€æŸ¥ Pod çš„æ ‡ç­¾é€‰æ‹©å’ŒèŠ‚ç‚¹çš„æ ‡ç­¾æ˜¯å¦åŒ¹é…</td></tr><tr><td>NoVolumeZoneConflict</td><td>æŒ‡å®šè¯¥å­˜å‚¨çš„æ•…éšœåŒºåŸŸé™åˆ¶ï¼Œè¯„ä¼° Pod è¯·æ±‚çš„ volume åœ¨èŠ‚ç‚¹ä¸Šæ˜¯å¦å¯ç”¨</td></tr><tr><td>NoDiskConflict</td><td>æ ¹æ® Pod è¯·æ±‚çš„å·æ˜¯å¦åœ¨èŠ‚ç‚¹ä¸Šå·²æŒ‚è½½æ¥è¯„ä¼° Pod å’ŒèŠ‚ç‚¹æ˜¯å¦åŒ¹é…ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</td></tr><tr><td>MaxCSIVolumeCount</td><td>å†³å®šé™„åŠ  CSI å·çš„æ•°é‡ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é…ç½®çš„é™åˆ¶</td></tr><tr><td>CheckNodeMemoryPressure</td><td>æ£€æŸ¥èŠ‚ç‚¹å†…å­˜æ˜¯å¦å¤Ÿç”¨</td></tr><tr><td>CheckNodePIDPressure</td><td>å¦‚æœèŠ‚ç‚¹æ­£ä¸ŠæŠ¥è¿›ç¨‹IDç¨€ç¼ºï¼Œå¹¶ä¸”æ²¡æœ‰å¼‚å¸¸é…ç½®ï¼Œåˆ™ä¸ä¼šæŠŠ Pod è°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹ä¸Š</td></tr><tr><td>CheckNodeDiskPressure</td><td>å¦‚æœèŠ‚ç‚¹æ­£ä¸ŠæŠ¥å­˜å‚¨å‹åŠ›ï¼ˆæ–‡ä»¶ç³»ç»Ÿå·²æ»¡æˆ–å‡ ä¹å·²æ»¡ï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰å¼‚å¸¸é…ç½®ï¼Œåˆ™ä¸ä¼šæŠŠ Pod è°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹ä¸Š</td></tr><tr><td>CheckNodeCondition</td><td>èŠ‚ç‚¹ä¸ŠæŠ¥è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿå·²æ»¡ï¼Œç½‘ç»œä¸å¯ç”¨æˆ–è€… kubelet å°šæœªå‡†å¤‡å¥½è¿è¡Œ Podï¼Œå¦‚æœèŠ‚ç‚¹ä¸Šè®¾ç½®äº†è¿™æ ·çš„çŠ¶å†µï¼Œå¹¶ä¸”æ²¡æœ‰å¼‚å¸¸é…ç½®ï¼Œåˆ™ä¸ä¼šæŠŠ Pod è°ƒåº¦åˆ°æ­¤èŠ‚ç‚¹ä¸Š</td></tr><tr><td>PodToleratesNodeTaints</td><td>æ£€æŸ¥ Pod çš„å®¹å¿åº¦æ˜¯å¦èƒ½å®¹å¿èŠ‚ç‚¹çš„æ±¡ç‚¹</td></tr><tr><td>CheckVolumeBinding</td><td>åŸºäº Pod çš„å·è¯·æ±‚ï¼Œè¯„ä¼° Pod æ˜¯å¦é€‚åˆèŠ‚ç‚¹ï¼Œè¿™é‡Œçš„ volume é€‚ç”¨äºæ‰€æœ‰ç»‘å®šçš„å’Œä¸ºç»‘å®šçš„ PVC</td></tr></tbody></table><h4 id="2ï¼‰ä¼˜å…ˆçº§-â€”â€”-Priorities"><a href="#2ï¼‰ä¼˜å…ˆçº§-â€”â€”-Priorities" class="headerlink" title="2ï¼‰ä¼˜å…ˆçº§ â€”â€” Priorities"></a>2ï¼‰ä¼˜å…ˆçº§ â€”â€” Priorities</h4><blockquote><p>ğŸš© <strong>Priorities</strong> ä¼˜å…ˆçº§æ˜¯ä¸€ç³»åˆ—é”®å€¼å¯¹ç»„æˆçš„ï¼Œé”®æ˜¯è¯¥ä¼˜å…ˆçº§çš„åç§°ï¼Œå€¼åˆ™æ˜¯å®ƒçš„æƒé‡å€¼ã€‚è°ƒåº¦å™¨é€šè¿‡ä¼˜å…ˆçº§å‡½æ•°æ¥å®ç°èŠ‚ç‚¹æ‰“åˆ†ï¼Œä»¥æ­¤å®Œæˆä¼˜é€‰é˜¶æ®µã€‚</p></blockquote><h5 id="1-Priorities-å¸¸ç”¨å‡½æ•°"><a href="#1-Priorities-å¸¸ç”¨å‡½æ•°" class="headerlink" title="1. Priorities å¸¸ç”¨å‡½æ•°"></a>1. Priorities å¸¸ç”¨å‡½æ•°</h5><table><thead><tr><th>ä¼˜å…ˆçº§å‡½æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>LeastRequestedPriority</td><td>åå‘æœ€å°‘ request èµ„æºçš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„ä¼˜å…ˆçº§å°±ç”±èŠ‚ç‚¹ç©ºé—²èµ„æºä¸èŠ‚ç‚¹æ€»å®¹é‡çš„æ¯”å€¼ï¼Œå³ç”±ï¼ˆæ€»å®¹é‡-èŠ‚ç‚¹ä¸ŠPodçš„å®¹é‡æ€»å’Œ-æ–°Podçš„å®¹é‡ï¼‰/æ€»å®¹é‡ï¼‰æ¥å†³å®šã€‚ CPUå’Œå†…å­˜å…·æœ‰ç›¸åŒæƒé‡ï¼Œèµ„æºç©ºé—²æ¯”è¶Šé«˜çš„èŠ‚ç‚¹å¾—åˆ†è¶Šé«˜ã€‚ è®¡ç®—å…¬å¼: <code>cpu((capacity â€“ sum(requested)) * 10 / capacity) + memory((capacity â€“ sum(requested)) * 10 / capacity) / 2</code></td></tr><tr><td>BalancedResourceAllocation</td><td>åå‘èµ„æºä½¿ç”¨å¹³è¡¡çš„èŠ‚ç‚¹ï¼ŒCPUå’Œå†…å­˜ä½¿ç”¨ç‡è¶Šæ¥è¿‘çš„èŠ‚ç‚¹æƒé‡è¶Šé«˜ï¼Œ<strong>è¯¥ç­–ç•¥ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œå¿…é¡»å’Œ LeastRequestedPriorityç»„åˆä½¿ç”¨</strong>ï¼Œå°½é‡é€‰æ‹©åœ¨éƒ¨ç½² Pod åå„é¡¹èµ„æºæ›´å‡è¡¡çš„æœºå™¨ã€‚ å¦‚æœè¯·æ±‚çš„èµ„æºï¼ˆCPUæˆ–è€…å†…å­˜ï¼‰éœ€æ±‚å¤§äºèŠ‚ç‚¹çš„ capacityï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹æ°¸è¿œä¸ä¼šè¢«è°ƒåº¦åˆ°ã€‚</td></tr><tr><td>InterPodAffinityPriority</td><td>ä¾æ® Pod é—´äº²å’Œæ€§å’Œåäº²å’Œæ€§çš„ä¼˜å…ˆçº§ï¼Œé€šè¿‡è¿­ä»£ weightedPodAffinityTerm çš„å…ƒç´ è®¡ç®—å’Œï¼Œå¹¶ä¸”å¦‚æœå¯¹è¯¥èŠ‚ç‚¹æ»¡è¶³ç›¸åº”çš„ PodAffinityTermï¼Œåˆ™å°† â€œweightâ€ åŠ åˆ°å’Œä¸­ï¼Œå…·æœ‰æœ€é«˜å’Œçš„èŠ‚ç‚¹æ˜¯æœ€ä¼˜é€‰çš„ã€‚</td></tr><tr><td>SelectorSpreadPriority</td><td>ä¸ºäº†æ›´å¥½çš„é«˜å¯ç”¨ï¼Œå¯¹åŒå±äºä¸€ä¸ª Serviceã€RC æˆ– RS ä¸‹é¢çš„ Podï¼Œå°½é‡è°ƒåº¦åˆ°å¤šä¸ªä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå½“ä¸€ä¸ª Pod è¢«è°ƒåº¦çš„æ—¶å€™ï¼Œå…ˆæŸ¥æ‰¾Podå¯¹äºçš„serviceæˆ–è€…replication controllerï¼Œ ç„¶åæŸ¥æ‰¾serviceæˆ–replication controllerä¸­å·²å­˜åœ¨çš„Podï¼Œè¿è¡ŒPodè¶Šå°‘çš„èŠ‚ç‚¹çš„å¾—åˆ†è¶Šé«˜ã€‚</td></tr><tr><td>NodeAffinityPriority</td><td>æ ¹æ®èŠ‚ç‚¹çš„äº²å’Œæ€§æœºåˆ¶æ¥è®¡ç®—ä¸€ä¸ªæƒé‡å€¼ï¼Œæ”¯æŒå¤šç§æ“ä½œç¬¦ï¼ˆInã€NotInã€Existsã€DoesNotExistã€Gtã€Ltï¼‰ï¼Œè€Œä¸é™äºå¯¹èŠ‚ç‚¹labelsçš„ç²¾ç¡®åŒ¹é…ã€‚æ”¯æŒä¸¤ç§ç±»å‹çš„é€‰æ‹©å™¨ï¼Œä¸€æ˜¯ â€œhardï¼ˆrequiredDuringSchedulingIgnoredDuringExecutionï¼‰â€ é€‰æ‹©å™¨ï¼Œ å®ƒä¿è¯æ‰€é€‰çš„ä¸»æœºå¿…é¡»æ»¡è¶³æ‰€æœ‰Podå¯¹ä¸»æœºçš„è§„åˆ™è¦æ±‚ã€‚ è¿™ç§é€‰æ‹©å™¨æ›´åƒæ˜¯ä¹‹å‰çš„ NodeSelectorï¼Œåœ¨NodeSelector çš„åŸºç¡€ä¸Šå¢åŠ äº†æ›´åˆé€‚çš„è¡¨ç°è¯­æ³•ã€‚ å¦ä¸€ç§æ˜¯ â€œsoftï¼ˆpreferresDuringSchedulingIgnoredDuringExecutionï¼‰â€ é€‰æ‹©å™¨ï¼Œ å®ƒä½œä¸ºå¯¹è°ƒåº¦å™¨çš„æç¤ºï¼Œè°ƒåº¦å™¨ä¼šå°½é‡ä½†ä¸ä¿è¯æ»¡è¶³ NodeSelector çš„æ‰€æœ‰è¦æ±‚ã€‚</td></tr><tr><td>NodePreferAvoidPodsPriority</td><td>æ ¹æ®èŠ‚ç‚¹çš„æ³¨è§£ <code>scheduler.alpha.kubernetes.io/preferAvoidPods</code> å¯¹èŠ‚ç‚¹è¿›è¡Œä¼˜å…ˆçº§æ’åºã€‚å¦‚æœæ²¡æœ‰è®¾ç½® Annotationï¼ˆæ³¨é‡Šä¿¡æ¯ï¼‰ï¼ŒèŠ‚ç‚¹å¯¹äºè¯¥ Policy çš„å¾—åˆ†å°±æ˜¯10åˆ†ï¼›å¦‚æœ Node è®¾ç½®äº† Annotationï¼Œå¦‚æœæ”¹ Pod å¯¹åº”çš„ Controller æ˜¯ RC æˆ– RSï¼Œåˆ™è¯¥ node å¯¹è¯¥ policy çš„å¾—åˆ†ä¸º 0åˆ†ã€‚</td></tr><tr><td>MostRequestedPriority</td><td>æ”¯æŒæœ€å¤š request èµ„æºçš„èŠ‚ç‚¹ï¼Œè¯¥ç­–ç•¥ä¼šå°† Pod è°ƒåº¦åˆ°æ•´ä½“å·¥ä½œè´Ÿè½½æ‰€éœ€çš„æœ€å°‘çš„ä¸€ç»„èŠ‚ç‚¹ä¸Šã€‚è®¡ç®—å…¬å¼: <code>(cpu(10 sum(requested) / capacity) + memory(10 sum(requested) / capacity)) / 2</code>ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</td></tr><tr><td>RequestedToCapacityRatioPriority</td><td>ä½¿ç”¨é»˜è®¤çš„æ‰“åˆ†æ–¹æ³•æ¨¡å‹ï¼Œåˆ›å»ºåŸºäº ResourceAlloctionPriority çš„ requestedToCapacity</td></tr><tr><td>TaintTolerationPriority</td><td>ä½¿ç”¨ Pod ä¸­ tolerationList ä¸èŠ‚ç‚¹ Taint åˆ—è¡¨é¡¹è¿›è¡ŒåŒ¹é…ï¼Œé…å¯¹æˆåŠŸçš„é¡¹è¶Šå¤šï¼Œå¾—åˆ†åˆ™è¶Šä½ã€‚æ±¡ç‚¹è¶ŠåŒ¹é…ï¼Œå¾—åˆ†è¶Šä½ã€‚</td></tr><tr><td>ImageLocalityPriority</td><td>æ ¹æ® Node ä¸Šæ˜¯å¦å­˜åœ¨ Pod çš„å®¹å™¨è¿è¡Œæ‰€éœ€çš„é•œåƒï¼Œå¹¶ä¸”åˆ¤æ–­é•œåƒå¤§å°æ¥è¿›è¡Œæ‰“åˆ†ï¼Œåˆ†å€¼ä¸º 0 - 10ã€‚è¯¥è¿‡ç¨‹ä¼šéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¦‚æœæ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸å­˜åœ¨é•œåƒï¼Œåˆ†å€¼å°±ä¸º0ï¼Œå¦‚æœå­˜åœ¨é•œåƒåˆ™æ ¹æ®é•œåƒå¤§å°æ¥å†³å®šåˆ†å€¼ï¼Œé•œåƒè¶Šå¤§åˆ†å€¼è¶Šé«˜ï¼Œå¦‚æœèŠ‚ç‚¹å­˜åœ¨æ‰€æœ‰æ‰€éœ€é•œåƒï¼Œåˆ†å€¼ä¸º 10ã€‚ï¼ˆé»˜è®¤æœªå¯ç”¨ï¼‰</td></tr><tr><td>ServiceSpreadingPriority</td><td>å¯¹äºç»™å®šçš„ Serviceï¼Œæ­¤ç­–ç•¥æ—¨åœ¨ç¡®ä¿è¯¥ Service å…³è”çš„ Pod åˆ†å¸ƒåœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ å®ƒåå‘æŠŠ Pod è°ƒåº¦åˆ°æ²¡æœ‰è¯¥æœåŠ¡çš„èŠ‚ç‚¹ã€‚ æ•´ä½“æ¥çœ‹ï¼ŒService å¯¹äºå•ä¸ªèŠ‚ç‚¹æ•…éšœå˜å¾—æ›´å…·å¼¹æ€§ã€‚</td></tr><tr><td>EqualPriority</td><td>æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å‡½æ•°ï¼Œå®ƒç»™äºˆæ‰€æœ‰èŠ‚ç‚¹ç›¸ç­‰æƒé‡ã€‚</td></tr><tr><td>EvenPodsSpreadPriority</td><td>å®ç°äº† <a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-topology-spread-constraints/">Pod æ‹“æ‰‘æ‰©å±•çº¦æŸ</a>çš„ä¼˜å…ˆçº§æ’åºã€‚</td></tr></tbody></table><h3 id="3ã€è°ƒåº¦å™¨é…ç½®ï¼ˆäº†è§£ï¼‰"><a href="#3ã€è°ƒåº¦å™¨é…ç½®ï¼ˆäº†è§£ï¼‰" class="headerlink" title="3ã€è°ƒåº¦å™¨é…ç½®ï¼ˆäº†è§£ï¼‰"></a>3ã€è°ƒåº¦å™¨é…ç½®ï¼ˆäº†è§£ï¼‰</h3><blockquote><p>ğŸš© å’Œ K8S çš„å…¶ä»–ç»„ä»¶ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å…¶è·¯å¾„ä¼ ç»™ <code>kube-scheduler</code> çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œæ¥æŒ‡å®šå…¶è¡Œä¸ºã€‚è¿™ç§é…ç½®æ–‡ä»¶ç§°ä¸ºè°ƒåº¦çš„æ¨¡ç‰ˆï¼ˆprofileï¼‰ï¼Œå…¶ä¸­å…è®¸é…ç½® kube-scheduler ä¸­ä¸åŒè°ƒåº¦é˜¶æ®µã€‚K8S å°†æ¯ä¸€ä¸ªé˜¶æ®µéƒ½æš´éœ²åœ¨äº†æŸä¸ªæ‰©å±•ç‚¹ä¸­ï¼Œå¹¶é€šè¿‡æ’ä»¶çš„å½¢å¼æ¥å¯¹è¿™äº›æ‰©å±•ç‚¹è¿›è¡Œç®¡ç†ã€‚</p></blockquote><h4 id="1ï¼‰åŸºç¡€é…ç½®"><a href="#1ï¼‰åŸºç¡€é…ç½®" class="headerlink" title="1ï¼‰åŸºç¡€é…ç½®"></a>1ï¼‰åŸºç¡€é…ç½®</h4><p>é€šè¿‡è¿è¡Œ <code>kube-scheduler --config &lt;filename&gt;</code> æ¥è®¾ç½®è°ƒåº¦æ¨¡ç‰ˆï¼Œè¯¥æ¨¡ç‰ˆä½¿ç”¨çš„ä¸º <a href="https://kubernetes.io/docs/reference/config-api/kube-scheduler-config.v1beta1/">KubeSchedulerConfiguration (v1beta1)</a> ç»“æ„ä½“ã€‚åŸºç¡€é…ç½®å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubescheduler.config.k8s.io/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">KubeSchedulerConfiguration</span><br><span class="hljs-attr">clientConnection:</span><br>  <span class="hljs-attr">kubeconfig:</span> <span class="hljs-string">/etc/srv/kubernetes/kube-scheduler/kubeconfig</span><br></code></pre></td></tr></table></figure><h4 id="2ï¼‰è°ƒåº¦å™¨æ‰©å±•"><a href="#2ï¼‰è°ƒåº¦å™¨æ‰©å±•" class="headerlink" title="2ï¼‰è°ƒåº¦å™¨æ‰©å±•"></a>2ï¼‰è°ƒåº¦å™¨æ‰©å±•</h4><p><code>kube-scheduler</code> æ”¯æŒæ ¹æ®ä¸åŒçš„è°ƒåº¦é…ç½®æ–‡ä»¶æ¥æŒ‡å®šæ–­è¨€ï¼ˆPredicatesï¼‰å’Œä¼˜å…ˆçº§ï¼ˆPrioritiesï¼‰ï¼Œä»¥æ­¤æ¥åˆ†åˆ«å¯¹ Node èŠ‚ç‚¹è¿›è¡Œè¿‡æ»¤å’Œæ‰“åˆ†ã€‚æˆ‘ä»¬åœ¨ä¸Šé¢è¯´è¿‡ï¼Œè°ƒåº¦é˜¶æ®µçš„æ‰©å±•ç‚¹æ˜¯é€šè¿‡è°ƒåº¦æ’ä»¶æ¥ç®¡ç†çš„ï¼Œå› æ­¤é€šè¿‡åœ¨è°ƒåº¦é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç¦ç”¨è°ƒåº¦æ’ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå†³å®š <code>kube-scheduler</code> åœ¨ä¸åŒé˜¶æ®µçš„è°ƒåº¦è¡Œä¸ºã€‚</p><h5 id="1-æ‰©å±•ç‚¹"><a href="#1-æ‰©å±•ç‚¹" class="headerlink" title="1. æ‰©å±•ç‚¹"></a>1. æ‰©å±•ç‚¹</h5><p><code>kube-scheduler</code> æä¾›çš„æ‰©å±•ç‚¹å¦‚ä¸‹:</p><table><thead><tr><th>æ‰©å±•ç‚¹</th><th>æè¿°</th></tr></thead><tbody><tr><td>QueueSort</td><td>è¿™äº›æ’ä»¶ç”¨äºå°†è°ƒåº¦é˜Ÿåˆ—ä¸­å¤„äº pending çŠ¶æ€çš„ Pods è¿›è¡Œæ’åºã€‚æ¯æ¬¡åªèƒ½ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ’åºæ’ä»¶</td></tr><tr><td>PreFilter</td><td>è¿™äº›æ’ä»¶ç”¨äºåœ¨è¿›è¡Œè¿‡æ»¤å‰å¯¹ Pod æˆ–é›†ç¾¤çš„ä¿¡æ¯è¿›ç¨‹æ£€æŸ¥ã€‚å®ƒä»¬å¯èƒ½ä¼šå°†ä¸€ä¸ª pod æ ‡è®°ä¸ºä¸å¯è°ƒåº¦</td></tr><tr><td>Filter</td><td>è¿™äº›æ’ä»¶ç›¸å½“äºè°ƒåº¦ç­–ç•¥ä¸­çš„æ–­è¨€ï¼ˆPredicatesï¼‰ï¼Œç”¨äºè¿‡æ»¤ä¸èƒ½è¿è¡Œ Pod çš„èŠ‚ç‚¹ã€‚è¿‡æ»¤å™¨çš„è°ƒç”¨é¡ºåºæ˜¯å¯é…ç½®çš„ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªèŠ‚ç‚¹é€šè¿‡æ‰€æœ‰çš„è¿‡æ»¤ç­›é€‰ï¼ŒPod å°±ä¼šè¢«æ ‡è®°ä¸ºä¸å¯è°ƒåº¦</td></tr><tr><td>PostFilter</td><td>å½“æ²¡æœ‰ä¸º pod æ‰¾åˆ°å¯è¡Œçš„èŠ‚ç‚¹æ—¶ï¼Œè¿™äº›æ’ä»¶å°±ä¼šæŒ‰ç…§å®ƒä»¬çš„é…ç½®é¡ºåºè°ƒç”¨ã€‚å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ª postFilter æ’ä»¶å°† Pod æ ‡è®°ä¸ºå¯è°ƒåº¦ï¼Œå°±ä¸ä¼šå†ç»§ç»­è°ƒç”¨å…¶ä½™æ’ä»¶äº†</td></tr><tr><td>PreScore</td><td>è¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯æ‰©å±•ç‚¹ï¼Œå¯ç”¨äºé¢„æ‰“åˆ†å·¥ä½œ</td></tr><tr><td>Score</td><td>è¿™äº›æ’ä»¶ç”¨äºç»™é€šè¿‡è¿‡æ»¤ç­›é€‰çš„èŠ‚ç‚¹è¿›è¡Œæ‰“åˆ†ï¼Œè°ƒåº¦å™¨ä¼šé€‰æ‹©å¾—åˆ†æœ€é«˜çš„èŠ‚ç‚¹</td></tr><tr><td>Reserve</td><td>è¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯æ‰©å±•ç‚¹ï¼Œå½“èµ„æºå·²ç»é¢„ç•™ç»™ Pod æ˜¯ï¼Œå°±ä¼šå°†æ¶ˆæ¯é€šçŸ¥æ’ä»¶ã€‚è¿™äº›æ’ä»¶è¿˜å®ç°äº† <code>UnReserve</code> æ¥å£ï¼Œå½“åœ¨ <code>Reserve</code> æœŸé—´æˆ–ä¹‹åå‡ºç°æ•…éšœæ—¶ä¼šè¢«è°ƒç”¨ã€‚</td></tr><tr><td>UnReserve</td><td>è¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯æ‰©å±•ç‚¹ï¼Œå¦‚æœä¸€ä¸ª Pod åœ¨ <code>Reserve</code> åè¢«æ‹’ç»ï¼Œå¹¶è¢« <code>Permit</code> æç½®ï¼Œå°±ä¼šè¢«è°ƒç”¨</td></tr><tr><td>Permit</td><td>è¿™äº›æ’ä»¶å¯ä»¥é˜»æ­¢æˆ–å»¶è¿Ÿ Pod çš„ç»‘å®š</td></tr><tr><td>PreBind</td><td>è¿™äº›æ’ä»¶ä¼šè¢«åœ¨ Pod ç»‘å®šèŠ‚ç‚¹å‰è¢«è¿è¡Œ</td></tr><tr><td>Bind</td><td>è¿™ä¸ªæ’ä»¶å°†ä¸€ä¸ª Pod ç»‘å®šåˆ°èŠ‚ç‚¹ã€‚ç»‘å®šæ’ä»¶ä¼šæŒ‰ç…§é¡ºåºè°ƒç”¨ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªæ’ä»¶å®Œæˆäº†ç»‘å®šå·¥ä½œï¼Œå…¶ä½™çš„æ’ä»¶çš„å°±ä¼šå‘—è·³è¿‡ã€‚<strong>è‡³å°‘éœ€è¦æœ‰ä¸€ä¸ªç»‘å®šæ’ä»¶</strong>ã€‚</td></tr><tr><td>PostBind</td><td>è¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯æ‰©å±•ç‚¹ï¼Œåœ¨ Pod ç»‘å®šèŠ‚ç‚¹åä¼šè¢«è°ƒç”¨</td></tr></tbody></table><p>å¯¹äºæ¯ä¸ªæ‰©å±•ç‚¹æ¥è¯´ï¼Œä½ å¯ä»¥ç¦ç”¨é»˜è®¤æ’ä»¶æˆ–å¯ç”¨ä½ è‡ªå·±çš„æ’ä»¶ï¼Œè¯­æ³•å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubescheduler.config.k8s.io/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">KubeSchedulerConfiguration</span><br><span class="hljs-attr">profiles:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">plugins:</span><br>      <span class="hljs-attr">score:</span><br>        <span class="hljs-attr">disabled:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NodeResourcesLeastAllocated</span><br>        <span class="hljs-attr">enabled:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MyCustomPluginA</span><br>          <span class="hljs-attr">weight:</span> <span class="hljs-number">2</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MyCustomPluginB</span><br>          <span class="hljs-attr">weight:</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥åœ¨ <code>disabled</code> æ•°ç»„ä¸­ä½¿ç”¨ <code>*</code> ç¦ç”¨è¯¥æ‰©å±•ç‚¹çš„æ‰€æœ‰é»˜è®¤æ’ä»¶ã€‚ å¦‚æœéœ€è¦ï¼Œè¿™ä¸ªå­—æ®µä¹Ÿå¯ä»¥ç”¨æ¥å¯¹æ’ä»¶é‡æ–°é¡ºåºã€‚</p><h5 id="2-è°ƒåº¦æ’ä»¶"><a href="#2-è°ƒåº¦æ’ä»¶" class="headerlink" title="2. è°ƒåº¦æ’ä»¶"></a>2. è°ƒåº¦æ’ä»¶</h5><p><code>kube-scheduler</code> é»˜è®¤å¯ç”¨çš„æ‰©å±•ç‚¹å¦‚ä¸‹ï¼Œå®ƒä»¬å®ç°äº†ä¸€ä¸ªæˆ–å¤šä¸ªæ‰©å±•ç‚¹ã€‚</p><table><thead><tr><th>æ’ä»¶</th><th>ä½œç”¨</th><th>å®ç°çš„æ‰©å±•ç‚¹</th></tr></thead><tbody><tr><td>ImageLocality</td><td>é€‰æ‹©å·²ç»å­˜åœ¨è¿è¡Œ Pod æ‰€éœ€å®¹å™¨é•œåƒçš„èŠ‚ç‚¹</td><td>Score</td></tr><tr><td>TaintToleration</td><td>å®ç°äº†æ±¡ç‚¹ï¼ˆtaintï¼‰å’Œå®¹å¿ï¼ˆtolerationï¼‰</td><td>Filterã€Prescoreã€Score</td></tr><tr><td>NodeName</td><td>æ£€æŸ¥ Pod æŒ‡å®šçš„èŠ‚ç‚¹åç§°ä¸å½“å‰èŠ‚ç‚¹æ˜¯å¦åŒ¹é…</td><td>Filter</td></tr><tr><td>NodePorts</td><td>æ£€æŸ¥ Pod æŒ‡å®šçš„ç«¯å£åœ¨èŠ‚ç‚¹ä¸Šæ˜¯å¦å¯ç”¨</td><td>preFilterã€Filter</td></tr><tr><td>NodeAffinity</td><td>å®ç°äº†èŠ‚ç‚¹é€‰æ‹©å™¨ï¼ˆ <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector">node selectors</a>ï¼‰ å’ŒèŠ‚ç‚¹äº²å’Œæ€§ï¼ˆ <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity">node affinity</a>ï¼‰</td><td>Filterã€Score</td></tr><tr><td>PodTopologySpread</td><td>å®ç°äº† Pod æ‹“æ‰‘åˆ†å¸ƒ</td><td>preFilterã€Filterã€preScoreã€Score</td></tr><tr><td>NodeUnschedulable</td><td>è¿‡æ»¤å‡ºå­˜åœ¨ <code>.spec.unschedulable</code> ï¼Œå¹¶ä¸”å€¼ä¸º true çš„èŠ‚ç‚¹</td><td>Filter</td></tr><tr><td>NodeResourcesFit</td><td>æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æ‹¥æœ‰æ‰€æœ‰ Pod è¯·æ±‚çš„èµ„æºã€‚æ‰“åˆ†æ—¶æ ¹æ®ä¸‰ç§ç­–ç•¥ä¸­çš„ä¸€ç§:  <code>LeastAllocated</code> (é»˜è®¤), <code>MostAllocated</code> and <code>RequestedToCapacityRatio</code></td><td>preFilterã€Filterã€Score</td></tr><tr><td>NodeResourcesBalancedAllocation</td><td>è°ƒåº¦ Pod æ—¶ï¼Œé€‰æ‹©èµ„æºæ›´æ›´åŠ å¹³è¡¡çš„èŠ‚ç‚¹</td><td>Score</td></tr><tr><td>VolumeBinding</td><td>æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨æˆ–æ˜¯å¦å¯ä»¥ç»‘å®šè¯·æ±‚çš„å·</td><td>preFilterã€Filterã€Reserveã€preBindã€Score</td></tr><tr><td>VolumeRestrictions</td><td>æ£€æŸ¥æŒ‚è½½åˆ°èŠ‚ç‚¹ä¸Šçš„æ˜¯å·æ˜¯å¦æ»¡è¶³å·æä¾›ç¨‹åºçš„é™åˆ¶</td><td>Filter</td></tr><tr><td>VolumeZone</td><td>æ£€æŸ¥è¯·æ±‚çš„å·æ˜¯å¦åœ¨ä»»ä½•åŒºåŸŸ éƒ½æ»¡è¶³</td><td>Filter</td></tr><tr><td>NodeVolumeLimits</td><td>æ£€æŸ¥è¯¥èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³ CSI å·é™åˆ¶</td><td>Filter</td></tr><tr><td>EBSLimits</td><td>æ£€æŸ¥è¯¥èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³ AWS EBS å·é™åˆ¶</td><td>Filter</td></tr><tr><td>GCEPDLimits</td><td>æ£€æŸ¥è¯¥èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³ GCP-PD å·é™åˆ¶</td><td>Filter</td></tr><tr><td>AzureDiskLimits</td><td>æ£€æŸ¥è¯¥èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³ Azure ç£ç›˜å·é™åˆ¶</td><td>Filter</td></tr><tr><td>InterPodAffinity</td><td>å®ç°äº† <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#inter-pod-affinity-and-anti-affinity">Pod çš„äº²å’Œå’Œåäº²å’Œç‰¹æ€§</a></td><td>preFilterã€Filterã€preScoreã€Score</td></tr><tr><td>PrioritySort</td><td>æä¾›åŸºäºé»˜è®¤ä¼˜å…ˆçº§ç­–ç•¥çš„æ’åº0</td><td>queueSort</td></tr><tr><td>DefaultBinder</td><td>æä¾›äº†é»˜è®¤çš„ç»‘å®šæœºåˆ¶</td><td>bind</td></tr><tr><td>DefaultPreemption</td><td>æä¾›äº†é»˜è®¤çš„æŠ¢å æœºåˆ¶</td><td>postFilter</td></tr></tbody></table><p>ä»¥ä¸‹ç­–ç•¥é»˜è®¤ä¸ä¸å¯ç”¨ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ API çš„æ–¹å¼é…ç½®å¼€å¯:</p><table><thead><tr><th>æ’ä»¶</th><th>ä½œç”¨</th><th>å®ç°çš„æ‰©å±•ç‚¹</th></tr></thead><tbody><tr><td>SelectorSpread</td><td>å¯¹äºå±äº <a href="https://kubernetes.io/zh/docs/concepts/services-networking/service/">Services</a>ã€ <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/replicaset/">ReplicaSets</a> å’Œ <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/statefulset/">StatefulSets</a> çš„ Pod è¿›è¡Œè·¨å¤šä¸ªèŠ‚ç‚¹éƒ¨ç½²</td><td>PreScoreã€Score</td></tr><tr><td>CinderLimits</td><td>æ£€æŸ¥è¯¥èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³ openstack Cinder å·é™åˆ¶</td><td>Filter</td></tr><tr><td>NodeResourcesLeastAllocated</td><td>é€‰æ‹©å·²åˆ†é…èµ„æºå°‘çš„èŠ‚ç‚¹</td><td>Score</td></tr><tr><td>NodeResourcesMostAllocated</td><td>é€‰æ‹©å·²åˆ†é…èµ„æºå¤šçš„èŠ‚ç‚¹</td><td>Score</td></tr><tr><td>RequestedToCapacityRatio</td><td>æ ¹æ®é…ç½®çš„æŸä¸ªå‡½æ•°è®¾ç½®æ¥è¿›è¡ŒèŠ‚ç‚¹é€‰æ‹©</td><td>Score</td></tr><tr><td>NodeLabel</td><td>æ ¹æ®é…ç½®çš„æ ‡ç­¾æ¥è¿‡æ»¤èŠ‚ç‚¹æˆ–ç»™èŠ‚ç‚¹è¿›è¡Œæ‰“åˆ†</td><td>Filterã€Score</td></tr><tr><td>ServiceAffinity</td><td>æ£€æŸ¥å±äºæŸä¸ª Service çš„ Pods ä¸é…ç½®çš„æ ‡ç­¾æ‰€å®šä¹‰çš„èŠ‚ç‚¹é›†åˆæ˜¯å¦ç¬¦åˆã€‚è¿™ä¸ªæ’ä»¶è¿˜æ”¯æŒå°†å±äºæŸä¸ª Service çš„ Pods åˆ†æ•£åˆ°å„èŠ‚ç‚¹</td><td>preFilterã€Filterã€Score</td></tr><tr><td>NodePreferAvoidPods</td><td>åŸºäºèŠ‚ç‚¹æ³¨é‡Š <code>scheduler.alpha.kubernetes.io/preferAvoidPods</code> è¿›è¡Œæ‰“åˆ†</td><td>Score</td></tr></tbody></table><h4 id="3ï¼‰å¤šé…ç½®æ–‡ä»¶ä½¿ç”¨"><a href="#3ï¼‰å¤šé…ç½®æ–‡ä»¶ä½¿ç”¨" class="headerlink" title="3ï¼‰å¤šé…ç½®æ–‡ä»¶ä½¿ç”¨"></a>3ï¼‰å¤šé…ç½®æ–‡ä»¶ä½¿ç”¨</h4><p>æˆ‘ä»¬å¯ä»¥é…ç½® <code>kube-scheduler</code> è¿è¡Œå¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªé…ç½®æ–‡ä»¶å…³è”ä¸€ä¸ªè°ƒåº¦å™¨åç§°ï¼Œå¹¶å¯ä»¥åœ¨å…¶æ‰©å±•ç‚¹ä¸­é…ç½®ä¸åŒçš„æ’ä»¶é›†åˆã€‚</p><h5 id="1-ä½¿ç”¨ç¤ºä¾‹"><a href="#1-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="1. ä½¿ç”¨ç¤ºä¾‹"></a>1. ä½¿ç”¨ç¤ºä¾‹</h5><p>ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨2ä¸ªé…ç½®ï¼Œä¸€ä¸ªä½¿ç”¨é»˜è®¤çš„æ’ä»¶ï¼Œå¦ä¸€ä¸ªç¦ç”¨æ‰€æœ‰æ‰“åˆ†ç›¸å…³çš„æ’ä»¶ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubescheduler.config.k8s.io/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">KubeSchedulerConfiguration</span><br><span class="hljs-attr">profiles:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">schedulerName:</span> <span class="hljs-string">default-scheduler</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">schedulerName:</span> <span class="hljs-literal">no</span><span class="hljs-string">-scoring-scheduler</span><br>    <span class="hljs-attr">plugins:</span><br>      <span class="hljs-attr">preScore:</span><br>        <span class="hljs-attr">disabled:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;*&#x27;</span><br>      <span class="hljs-attr">score:</span><br>        <span class="hljs-attr">disabled:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;*&#x27;</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šåˆ›å»ºä¸€ä¸ªè°ƒåº¦å™¨åç§°ä¸º <code>default-scheduler</code> çš„é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ä¼šåŒ…æ‹¬ä¸Šè¿°æ‰€æœ‰æè¿°é»˜è®¤å¯ç”¨çš„æ’ä»¶ã€‚å¦‚æœ P</p><p>å¯¹äºé‚£äº›å¸Œæœ›æ ¹æ®ç‰¹å®šé…ç½®æ–‡ä»¶æ¥è¿›è¡Œè°ƒåº¦çš„ Podï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>.spec.schedulerName</code> å­—æ®µæŒ‡å®šå¯¹åº”çš„è°ƒåº¦å™¨åç§°ã€‚å¯¹äºæ²¡æœ‰åˆ¶å®šè°ƒåº¦å™¨åç§°çš„ Podï¼Œ<code>kube-apiserver</code> ä¼šå°†å…¶è°ƒåº¦å™¨åç§°è®¾ç½®ä¸º <code>default-scheduler</code>ã€‚</p><p>å¦‚æœ Pod å°† <code>.spec.schedulerName</code> å­—æ®µå€¼æŒ‡å®šä¸º <code>ReportingController</code>. leader é€‰ä¸¾æ—¶ä¼šä½¿ç”¨é…ç½®æ–‡ä»¶åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªè°ƒåº¦å™¨åç§°ã€‚</p><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><ul><li>å£°æ˜å¤šä¸ªé…ç½®æ–‡ä»¶æ—¶ï¼Œé…ç½®æ–‡ä»¶å¯¹åº”çš„è°ƒåº¦å™¨åç§°å¿…é¡»å”¯ä¸€ã€‚</li><li>ç”±äºè°ƒåº¦å™¨åªæœ‰ä¸€ä¸ªä¿å­˜ pending çŠ¶æ€ Pod çš„é˜Ÿåˆ—ï¼Œæ‰€ä»¥æ‰€æœ‰é…ç½®æ–‡ä»¶å¿…é¡»åœ¨ <code>QueueSort</code> æ‰©å±•ç‚¹ä¸­ä½¿ç”¨ç›¸åŒçš„æ’ä»¶ï¼Œé…ç½®ç›¸åŒçš„å‚æ•°å·²é¿å…å†²çªã€‚ </li></ul></blockquote><h3 id="4ã€è‡ªå®šä¹‰è°ƒåº¦å™¨"><a href="#4ã€è‡ªå®šä¹‰è°ƒåº¦å™¨" class="headerlink" title="4ã€è‡ªå®šä¹‰è°ƒåº¦å™¨"></a>4ã€è‡ªå®šä¹‰è°ƒåº¦å™¨</h3><p>è‡ªå®šä¹‰è°ƒåº¦å™¨ä¸»è¦çš„åŠŸèƒ½å³æŸ¥è¯¢ä¸ºè°ƒåº¦çš„ Podï¼ŒæŒ‰ç…§è‡ªå®šä¹‰çš„è°ƒåº¦ç­–ç•¥é€‰æ‹©æ–°çš„ Nodeï¼Œå¹¶å°†å…¶æ›´æ–°åˆ° Pod çš„ NodeBinding ä¸Šã€‚æˆ‘ä»¬å¯ä»¥ç”¨ shell æ¥ç¼–å†™ä¸€ä¸ªæœ€ç®€å•çš„è°ƒåº¦å™¨ã€‚</p><h4 id="1ï¼‰è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹"><a href="#1ï¼‰è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹" class="headerlink" title="1ï¼‰è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹"></a>1ï¼‰è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>SERVER=&#x27;localhost:8080&#x27;<br>while true;<br>do<br>    for PODNAME in $(kubectl --server $SERVER get pods -o json | jq &#x27;.items[] | select(.spec.schedulerName ==&quot;my-scheduler&quot;) | select(.spec.nodeName == null) | .metadata.name&#x27; | tr -d &#x27;&quot;&#x27;)<br>;<br>    do<br>        NODES=($(kubectl --server $SERVER get nodes -o json | jq &#x27;.items[].metadata.name&#x27; | tr -d &#x27;&quot;&#x27;))<br>        NUMNODES=$&#123;#NODES[@]&#125;<br>        CHOSEN=$&#123;NODES[$[ $RANDOM % $NUMNODES]]&#125;<br>        curl --header &quot;Content-Type:application/json&quot; --request POST --data &#x27;&#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Binding&quot;,&quot;metadata&quot;: &#123;&quot;name&quot;:&quot;&#x27;$PODNAME&#x27;&quot;&#125;,&quot;target&quot;: &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;<br>: &quot;Node&quot;, &quot;name&quot;: &quot;&#x27;$CHOSEN&#x27;&quot;&#125;&#125;&#x27; http://$SERVER/api/v1/namespaces/default/pods/$PODNAME/binding/<br>        echo &quot;Assigned $PODNAME to $CHOSEN&quot;<br>    done<br>    sleep 1<br>done<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹"><a href="#2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹" class="headerlink" title="2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹"></a>2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ç¤ºä¾‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">schedulerName:</span> <span class="hljs-string">my-scheduler</span> <span class="hljs-comment"># é€‰æ‹©ä½¿ç”¨è‡ªå®šä¹‰è°ƒåº¦å™¨ my-scheduler</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.10</span><br><br></code></pre></td></tr></table></figure><h3 id="5ã€èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦"><a href="#5ã€èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦" class="headerlink" title="5ã€èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦"></a>5ã€èŠ‚ç‚¹äº²å’Œæ€§è°ƒåº¦</h3><h4 id="1ï¼‰èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™"><a href="#1ï¼‰èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™" class="headerlink" title="1ï¼‰èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™"></a>1ï¼‰èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™</h4><ul><li><strong>ç¡¬äº²å’Œæ€§:</strong> å½“ç¡¬äº²å’Œæ€§ä¸æ»¡è¶³æ—¶ï¼ŒPod ä¼šç½®äº Pending çŠ¶æ€ï¼›</li><li><strong>è½¯äº²å’Œæ€§:</strong> å½“è§„åˆ™ä¸æ»¡è¶³æ—¶ï¼Œèƒ½å¤Ÿæ¥å—è¢«ç¼–æ’åœ¨å…¶ä»–ä¸ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä»¥ weight å®šä¹‰ä¼˜å…ˆçº§çš„æƒé‡ï¼Œ1-100 å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼›</li><li>å½“èŠ‚ç‚¹æ ‡ç­¾æ”¹å˜è€Œä¸å†ç¬¦åˆæ­¤èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™æ—¶ï¼Œä»…ä¼šå¯¹æ–°å»ºçš„ Pod å¯¹è±¡ç”Ÿæ•ˆï¼Œä½†å·²åœ¨èŠ‚ç‚¹ä¸Šçš„ Pod å¹¶ä¸ä¼šè¢«ç§»é™¤ã€‚</li></ul><h4 id="2ï¼‰èŠ‚ç‚¹ç¡¬äº²å’Œæ€§-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution"><a href="#2ï¼‰èŠ‚ç‚¹ç¡¬äº²å’Œæ€§-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="2ï¼‰èŠ‚ç‚¹ç¡¬äº²å’Œæ€§ â€”â€” requiredDuringSchedulingIgnoredDuringExecution"></a>2ï¼‰èŠ‚ç‚¹ç¡¬äº²å’Œæ€§ â€”â€” requiredDuringSchedulingIgnoredDuringExecution</h4><p>æ–¹å¼ä¸€: Pod ä½¿ç”¨ <code>spec.nodeSelector</code> (åŸºäºå¯¹ç­‰å€¼å…³ç³»åŒ¹é…)</p><p>æ–¹å¼äºŒ: Pod ä½¿ç”¨ <code>spec.affinity</code> æ”¯æŒ <code>matchExpressions</code> å±æ€§ï¼ˆæ›´å¤æ‚çš„æ ‡ç­¾é€‰æ‹©æœºåˆ¶ï¼‰</p><h5 id="1-ç¤ºä¾‹-è°ƒåº¦è‡³-zone-foo-çš„èŠ‚ç‚¹"><a href="#1-ç¤ºä¾‹-è°ƒåº¦è‡³-zone-foo-çš„èŠ‚ç‚¹" class="headerlink" title="1. ç¤ºä¾‹: è°ƒåº¦è‡³ zone = foo çš„èŠ‚ç‚¹"></a>1. ç¤ºä¾‹: è°ƒåº¦è‡³ zone = foo çš„èŠ‚ç‚¹</h5><h6 id="1âƒ£ï¸-èŠ‚ç‚¹æ‰“æ ‡ç­¾"><a href="#1âƒ£ï¸-èŠ‚ç‚¹æ‰“æ ‡ç­¾" class="headerlink" title="1âƒ£ï¸ èŠ‚ç‚¹æ‰“æ ‡ç­¾"></a>1âƒ£ï¸ èŠ‚ç‚¹æ‰“æ ‡ç­¾</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl label nodes kube-node1 zone=foo<br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-yaml-æ–‡ä»¶ç¤ºä¾‹"><a href="#2âƒ£ï¸-yaml-æ–‡ä»¶ç¤ºä¾‹" class="headerlink" title="2âƒ£ï¸ yaml æ–‡ä»¶ç¤ºä¾‹"></a>2âƒ£ï¸ yaml æ–‡ä»¶ç¤ºä¾‹</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">with-required-nodeaffinity</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">affinity:</span><br>    <span class="hljs-attr">nodeAffinity:</span><br>      <span class="hljs-attr">requiredDuringSchedulingIgnoredDuringExecution:</span>  <span class="hljs-comment"># å®šä¹‰ç¡¬äº²å’Œæ€§</span><br>        <span class="hljs-attr">nodeSelectorTerms:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">matchExpressions:</span>   <span class="hljs-comment">#é›†åˆé€‰æ‹©å™¨</span><br>          <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">zone</span>,<span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>,<span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;foo&quot;</span>]&#125;<br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰èŠ‚ç‚¹è½¯äº²å’Œæ€§-â€”â€”-preferredDuringSchedulingIgnoredDuringExecution"><a href="#3ï¼‰èŠ‚ç‚¹è½¯äº²å’Œæ€§-â€”â€”-preferredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="3ï¼‰èŠ‚ç‚¹è½¯äº²å’Œæ€§ â€”â€” preferredDuringSchedulingIgnoredDuringExecution"></a>3ï¼‰èŠ‚ç‚¹è½¯äº²å’Œæ€§ â€”â€” preferredDuringSchedulingIgnoredDuringExecution</h4><h5 id="1-ç¤ºä¾‹"><a href="#1-ç¤ºä¾‹" class="headerlink" title="1. ç¤ºä¾‹"></a>1. ç¤ºä¾‹</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">myapp-deploy-with-node-affinity</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">myapp-pod</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">affinity:</span><br>        <span class="hljs-attr">nodeAffinity:</span><br>          <span class="hljs-attr">preferredDuringSchedulingIgnoredDuringExecution:</span>   <span class="hljs-comment">#èŠ‚ç‚¹è½¯äº²å’Œæ€§</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">60</span><br>            <span class="hljs-attr">preference:</span><br>              <span class="hljs-attr">matchExpressions:</span><br>              <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">zone</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;foo&quot;</span>]&#125;<br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">30</span><br>            <span class="hljs-attr">preference:</span><br>              <span class="hljs-attr">matchExpressions:</span><br>              <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">ssd</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span>, <span class="hljs-attr">values:</span> []&#125;<br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br></code></pre></td></tr></table></figure><h5 id="2-ä¼˜å…ˆçº§è°ƒåº¦åŸç†"><a href="#2-ä¼˜å…ˆçº§è°ƒåº¦åŸç†" class="headerlink" title="2. ä¼˜å…ˆçº§è°ƒåº¦åŸç†:"></a>2. ä¼˜å…ˆçº§è°ƒåº¦åŸç†:</h5><p><img src="https://img2018.cnblogs.com/blog/1293010/201910/1293010-20191025180831602-2108008874.png" alt="img"></p><h3 id="6ã€Pod-èµ„æºäº²å’Œæ€§è°ƒåº¦"><a href="#6ã€Pod-èµ„æºäº²å’Œæ€§è°ƒåº¦" class="headerlink" title="6ã€Pod èµ„æºäº²å’Œæ€§è°ƒåº¦"></a>6ã€Pod èµ„æºäº²å’Œæ€§è°ƒåº¦</h3><h4 id="1ï¼‰Pod-äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„åˆ™"><a href="#1ï¼‰Pod-äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„åˆ™" class="headerlink" title="1ï¼‰Pod äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„åˆ™"></a>1ï¼‰Pod äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„åˆ™</h4><ul><li><code>äº²å’Œæ€§</code>ï¼šæ—¨åœ¨å°†ä¸€äº› Pod å¯¹è±¡ç»„ç»‡åœ¨ç›¸è¿‘çš„ä½ç½®ï¼ˆåŒä¸€èŠ‚ç‚¹ã€æœºæ¶ã€åŒºåŸŸã€åœ°åŒºï¼‰ï¼Œå®ƒæè¿°çš„æ˜¯ä¸€ä¸ª Pod ä¸å…·æœ‰æŸç‰¹å¾çš„ç°å­˜Pod è¿è¡Œä½ç½®çš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦æœ‰äº‹å…ˆå­˜åœ¨è¢«ä¾èµ–çš„ Pod å¯¹è±¡ã€‚</li><li><code>åäº²å’Œæ€§</code>ï¼šæ—¨åœ¨å°†ä¸€äº› Pod å¯¹è±¡åœ¨è¿è¡Œä½ç½®ä¸Šéš”ç¦»å¼€ï¼Œå¸¸ç”¨äºåˆ†æ•£åŒä¸€ç±»åº”ç”¨ï¼Œè°ƒåº¦å€¼ä¸åŒçš„åŒºåŸŸã€æœºæ¶æˆ–èŠ‚ç‚¹ç­‰</li><li>è°ƒåº¦å™¨ä¼šå°†ç¬¬ä¸€ä¸ª Pod æ”¾ç½®äºä»»ä½•ä½ç½®ï¼Œç„¶åä¸å…¶æœ‰äº²å’Œæˆ–åäº²å’Œå…³ç³»çš„Podä¼šæ ¹æ®è§„åˆ™å®ŒæˆåŠ¨æ€ç¼–æ’</li><li>åŸºäº <code>MatchInterPodAffinity</code>  é¢„é€‰ç­–ç•¥å®ŒæˆèŠ‚ç‚¹é¢„é€‰ï¼ŒåŸºäº <code>InterPodAffinityPriority</code> ä¼˜å…ˆçº§å‡½æ•°å®ŒæˆèŠ‚ç‚¹æ‰“åˆ†</li></ul><h4 id="2ï¼‰Pod-ç¡¬äº²å’Œè°ƒåº¦-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution"><a href="#2ï¼‰Pod-ç¡¬äº²å’Œè°ƒåº¦-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="2ï¼‰Pod ç¡¬äº²å’Œè°ƒåº¦ â€”â€” requiredDuringSchedulingIgnoredDuringExecution"></a>2ï¼‰Pod ç¡¬äº²å’Œè°ƒåº¦ â€”â€” requiredDuringSchedulingIgnoredDuringExecution</h4><h5 id="1-ç¤ºä¾‹-1"><a href="#1-ç¤ºä¾‹-1" class="headerlink" title="1. ç¤ºä¾‹"></a>1. ç¤ºä¾‹</h5><h6 id="1âƒ£ï¸-åˆ›å»ºè¢«ä¾èµ–çš„èŠ‚ç‚¹"><a href="#1âƒ£ï¸-åˆ›å»ºè¢«ä¾èµ–çš„èŠ‚ç‚¹" class="headerlink" title="1âƒ£ï¸ åˆ›å»ºè¢«ä¾èµ–çš„èŠ‚ç‚¹"></a>1âƒ£ï¸ åˆ›å»ºè¢«ä¾èµ–çš„èŠ‚ç‚¹</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl run tomcat -l app=tomcat --image tomcat:alpine<br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-yaml-æ–‡ä»¶ç¤ºä¾‹-1"><a href="#2âƒ£ï¸-yaml-æ–‡ä»¶ç¤ºä¾‹-1" class="headerlink" title="2âƒ£ï¸ yaml æ–‡ä»¶ç¤ºä¾‹"></a>2âƒ£ï¸ yaml æ–‡ä»¶ç¤ºä¾‹</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">with-pod-affinity</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">affinity:</span><br>    <span class="hljs-attr">podAffinity:</span><span class="hljs-comment"># äº²å’Œæ€§è°ƒåº¦</span><br>      <span class="hljs-attr">requiredDuringSchedulingIgnoredDuringExecution:</span>  <span class="hljs-comment"># ç¡¬äº²å’Œè°ƒåº¦</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">labelSelector:</span><br>          <span class="hljs-attr">matchExpressions:</span>    <span class="hljs-comment">#é›†åˆé€‰æ‹©å™¨</span><br>          <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">app</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;tomcat&quot;</span>]&#125;  <span class="hljs-comment"># é€‰æ‹©è¢«ä¾èµ–Pod</span><br>          <span class="hljs-comment"># ä¸Šé¢æ„æ€æ˜¯ï¼Œå½“å‰ pod è¦è·Ÿæ ‡ç­¾ä¸º app å€¼ä¸º tomcat çš„ pod åœ¨ä¸€èµ·</span><br>        <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">kubernetes.io/hostname</span>  <span class="hljs-comment"># æ ¹æ®æŒ‘é€‰å‡ºçš„Podæ‰€æœ‰èŠ‚ç‚¹çš„hostnameä½œä¸ºåŒä¸€ä½ç½®çš„åˆ¤å®š</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰Pod-è½¯äº²å’Œè°ƒåº¦-â€”â€”-preferredDuringSchedulingIgnoredDuringExecution"><a href="#3ï¼‰Pod-è½¯äº²å’Œè°ƒåº¦-â€”â€”-preferredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="3ï¼‰Pod è½¯äº²å’Œè°ƒåº¦ â€”â€” preferredDuringSchedulingIgnoredDuringExecution"></a>3ï¼‰Pod è½¯äº²å’Œè°ƒåº¦ â€”â€” preferredDuringSchedulingIgnoredDuringExecution</h4><h5 id="1-ç¤ºä¾‹-2"><a href="#1-ç¤ºä¾‹-2" class="headerlink" title="1. ç¤ºä¾‹"></a>1. ç¤ºä¾‹</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">myapp-with-preferred-pod-affinity</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">affinity:</span><br>        <span class="hljs-attr">podAffinity:</span><br>          <span class="hljs-attr">preferredDuringSchedulingIgnoredDuringExecution:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">80</span><br>            <span class="hljs-attr">podAffinityTerm:</span><br>              <span class="hljs-attr">labelSelector:</span><br>                <span class="hljs-attr">matchExpressions:</span><br>                <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">app</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;cache&quot;</span>]&#125;<br>              <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">zone</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">20</span><br>            <span class="hljs-attr">podAffinityTerm:</span><br>              <span class="hljs-attr">labelSelector:</span><br>                <span class="hljs-attr">matchExpressions:</span><br>                <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">app</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;db&quot;</span>]&#125;<br>              <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">zone</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br></code></pre></td></tr></table></figure><h4 id="4ï¼‰Pod-åäº²å’Œè°ƒåº¦-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution"><a href="#4ï¼‰Pod-åäº²å’Œè°ƒåº¦-â€”â€”-requiredDuringSchedulingIgnoredDuringExecution" class="headerlink" title="4ï¼‰Pod åäº²å’Œè°ƒåº¦ â€”â€” requiredDuringSchedulingIgnoredDuringExecution"></a>4ï¼‰Pod åäº²å’Œè°ƒåº¦ â€”â€” requiredDuringSchedulingIgnoredDuringExecution</h4><p>å°† <code>spec.affinity.podAffinity</code> æ›¿æ¢ä¸º <code>spec.affinity.podAntiAffinity</code> å°±å¯ä»¥åè½¬è°ƒåº¦è§„åˆ™ï¼Œåäº²å’Œè°ƒåº¦ä¹Ÿåˆ†ä¸ºç¡¬è°ƒåº¦å’Œè½¯è°ƒåº¦ï¼Œä½¿ç”¨æ–¹æ³•å’Œäº²å’Œè§„åˆ™ä¸€æ ·ã€‚</p><h5 id="1-ç¤ºä¾‹-3"><a href="#1-ç¤ºä¾‹-3" class="headerlink" title="1. ç¤ºä¾‹"></a>1. ç¤ºä¾‹</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># åˆ›å»ºä¾èµ– pod</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-first</span><br>    <span class="hljs-attr">labels:</span> <br>        <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>        <span class="hljs-attr">tier:</span> <span class="hljs-string">fronted</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span>      <br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">pod-second</span><br>    <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">backend</span><br>        <span class="hljs-attr">tier:</span> <span class="hljs-string">db</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">busybox</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">busybox:latest</span><br>      <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>      <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, <span class="hljs-string">&quot;sleep 3600&quot;</span>]<br>    <span class="hljs-attr">affinity:</span><br>      <span class="hljs-attr">podAntiAffinity:</span><span class="hljs-comment"># åäº²å’Œæ€§è°ƒåº¦</span><br>        <span class="hljs-attr">requiredDuringSchedulingIgnoredDuringExecution:</span> <span class="hljs-comment"># ç¡¬äº²å’Œè°ƒåº¦</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">labelSelector:</span><br>            <span class="hljs-attr">matchExpressions:</span><span class="hljs-comment">#é›†åˆé€‰æ‹©å™¨</span><br>            <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">key:</span> <span class="hljs-string">app</span>, <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span>, <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;myapp&quot;</span>]&#125;<span class="hljs-comment"># é€‰æ‹©è¢«ä¾èµ–Pod</span><br>            <span class="hljs-comment"># ä¸Šé¢æ„æ€æ˜¯ï¼Œå½“å‰ pod è¦è·Ÿæ ‡ç­¾ä¸º app å€¼ä¸º myapp çš„ pod ç›¸æ–¥</span><br>          <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">zone</span> <span class="hljs-comment"># æ ¹æ®æŒ‘é€‰å‡ºçš„Podæ‰€æœ‰èŠ‚ç‚¹çš„zoneä½œä¸ºåŒä¸€ä½ç½®çš„åˆ¤å®š</span><br><br></code></pre></td></tr></table></figure><h3 id="7ã€æ±¡ç‚¹å’Œå®¹å¿åº¦"><a href="#7ã€æ±¡ç‚¹å’Œå®¹å¿åº¦" class="headerlink" title="7ã€æ±¡ç‚¹å’Œå®¹å¿åº¦"></a>7ã€æ±¡ç‚¹å’Œå®¹å¿åº¦</h3><h4 id="1ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦è§„åˆ™"><a href="#1ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦è§„åˆ™" class="headerlink" title="1ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦è§„åˆ™"></a>1ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦è§„åˆ™</h4><ul><li><p><code>æ±¡ç‚¹ â€”â€” taints</code>:  æ±¡ç‚¹æ˜¯å®šä¹‰åœ¨èŠ‚ç‚¹ä¸Šçš„é”®å€¼å‹å±æ€§æ•°æ®ï¼Œç”¨äºè®©èŠ‚ç‚¹æ‹’ç»å°† Pod è°ƒåº¦è¿è¡Œäºå…¶ä¸Šï¼Œé™¤é Pod æœ‰æ¥çº³èŠ‚ç‚¹æ±¡ç‚¹çš„å®¹å¿åº¦</p></li><li><p><code>å®¹å¿åº¦ â€”â€” tolerations</code>: å®¹å¿åº¦æ˜¯å®šä¹‰åœ¨ Pod ä¸Šçš„é”®å€¼å‹å±æ€§æ•°æ®ï¼Œç”¨äºé…ç½®å¯å®¹å¿çš„æ±¡ç‚¹ï¼Œè°ƒåº¦å™¨åœ¨è°ƒåº¦æ—¶ä¼šå°† Pod è°ƒåº¦å­˜åœ¨å¯å®¹å¿æ±¡ç‚¹æˆ–è€…æ²¡æœ‰æ±¡ç‚¹çš„ Node ä¸Š</p></li><li><p>ä½¿ç”¨ <code>PodToleratesNodeTaints</code> é¢„é€‰ç­–ç•¥å’Œ <code>TaintTolerationPriority</code> ä¼˜é€‰å‡½æ•°å®Œæˆè¯¥æœºåˆ¶</p></li><li><p>èŠ‚ç‚¹äº²å’Œæ€§ä½¿ Pod å¯¹è±¡å¯ä»¥è¢«å¸å¼•åˆ°ä¸€ç»„ç‰¹å®šçš„èŠ‚ç‚¹ä¸Šï¼ˆnodeSelector å’Œ affinityï¼‰</p></li></ul><h4 id="2ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦çš„å®šä¹‰"><a href="#2ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦çš„å®šä¹‰" class="headerlink" title="2ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦çš„å®šä¹‰"></a>2ï¼‰æ±¡ç‚¹å’Œå®¹å¿åº¦çš„å®šä¹‰</h4><h5 id="1-å®šä¹‰è§„åˆ™"><a href="#1-å®šä¹‰è§„åˆ™" class="headerlink" title="1. å®šä¹‰è§„åˆ™"></a>1. å®šä¹‰è§„åˆ™</h5><ul><li><p>ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é…ç½®å¤šä¸ªæ±¡ç‚¹ï¼Œä¸€ä¸ª Pod ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªå®¹å¿åº¦</p></li><li><p>æ±¡ç‚¹å®šä¹‰äº <code>node.spec.taints</code> ï¼Œå®¹å¿åº¦å®šä¹‰äº <code>pods.spec.tolerations</code></p></li><li><p>è¯­æ³•ï¼š<code>key=value:effect</code></p></li><li><p>åŒä¸€ä¸ªé”®å€¼æ•°æ®ï¼Œeffect ä¸åŒï¼Œä¹Ÿå±äºä¸åŒçš„æ±¡ç‚¹</p></li></ul><h5 id="2-effect-å®šä¹‰æ’æ–¥ç­‰çº§"><a href="#2-effect-å®šä¹‰æ’æ–¥ç­‰çº§" class="headerlink" title="2. effect å®šä¹‰æ’æ–¥ç­‰çº§:"></a>2. effect å®šä¹‰æ’æ–¥ç­‰çº§:</h5><ul><li><p><code>NoSchedule</code>: é›¶å®¹å¿ï¼Œä½†å€¼å½±å“è°ƒåº¦è¿‡ç¨‹ï¼Œå·²ç»è°ƒåº¦ä¸Šå»çš„ Pod ä¸ä¼šå—å½±å“ï¼Œä¸”ä»…ä¼šå¯¹æ–°å¢çš„ pod ç”Ÿæ•ˆï¼ˆç»ä¸è°ƒåº¦ï¼‰</p></li><li><p><code>PreferNoSchedule</code>: è½¯çº¦æŸï¼ŒèŠ‚ç‚¹ç°å­˜çš„ Pod ä¸ä¼šå—å½±å“ï¼Œå¦‚æœå®åœ¨æ²¡æœ‰ç¬¦åˆçš„èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥è°ƒåº¦ä¸Šäº†ï¼ˆå°½é‡ä¸è°ƒåº¦ï¼‰</p></li><li><p><code>NoExecute</code>: é›¶å®¹å¿ï¼Œä¸ä½†ä¸èƒ½è°ƒåº¦ï¼Œä¸”è¿åŸæœ‰ Pod å¯¹è±¡ä¹Ÿä¼šè¢«é©±é€ï¼Œä¼šå½±å“å·²ç»åœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ Pod</p></li></ul><h4 id="3ï¼‰ç®¡ç†èŠ‚ç‚¹çš„æ±¡ç‚¹"><a href="#3ï¼‰ç®¡ç†èŠ‚ç‚¹çš„æ±¡ç‚¹" class="headerlink" title="3ï¼‰ç®¡ç†èŠ‚ç‚¹çš„æ±¡ç‚¹"></a>3ï¼‰ç®¡ç†èŠ‚ç‚¹çš„æ±¡ç‚¹</h4><h5 id="1-ç»™èŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹"><a href="#1-ç»™èŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹" class="headerlink" title="1. ç»™èŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹"></a>1. ç»™èŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹</h5><h6 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•:"></a>è¯­æ³•:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl taint node &lt;node-name&gt; &lt;key&gt;=&lt;value&gt;:&lt;effect&gt;<br></code></pre></td></tr></table></figure><h6 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹:"></a>ç¤ºä¾‹:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl taint node node2 node-type=production:NoShedule<br></code></pre></td></tr></table></figure><h5 id="2-æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹"><a href="#2-æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹" class="headerlink" title="2. æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹"></a>2. æŸ¥çœ‹èŠ‚ç‚¹æ±¡ç‚¹</h5><h6 id="è¯­æ³•-1"><a href="#è¯­æ³•-1" class="headerlink" title="è¯­æ³•:"></a>è¯­æ³•:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get nodes &lt;nodename&gt; -o go-template=&#123;&#123;.spec.taints&#125;&#125;<br></code></pre></td></tr></table></figure><h6 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹:"></a>ç¤ºä¾‹:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get nodes node2 -o go-template=&#123;&#123;.spec.taints&#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="3-åˆ é™¤èŠ‚ç‚¹æ±¡ç‚¹"><a href="#3-åˆ é™¤èŠ‚ç‚¹æ±¡ç‚¹" class="headerlink" title="3. åˆ é™¤èŠ‚ç‚¹æ±¡ç‚¹"></a>3. åˆ é™¤èŠ‚ç‚¹æ±¡ç‚¹</h5><h6 id="è¯­æ³•-2"><a href="#è¯­æ³•-2" class="headerlink" title="è¯­æ³•:"></a>è¯­æ³•:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl taint node &lt;node-name&gt; &lt;key&gt;[:&lt;effect&gt;]-# åé¢çš„ - å°±æ˜¯åˆ é™¤çš„æ„æ€<br></code></pre></td></tr></table></figure><h6 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹:"></a>ç¤ºä¾‹:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤ key ä¸º node-type, effect ä¸º NoSchedule çš„æ±¡ç‚¹</span><br>kubectl taint node node1 node-type:NoSchedule-<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤ key ä¸º node-type çš„æ‰€æœ‰æ±¡ç‚¹</span><br>kubectl taint node node1 node-type-<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤èŠ‚ç‚¹çš„æ‰€æœ‰æ±¡ç‚¹</span><br>kubectl patch nodes node1 -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;taints&quot;:[]&#125;&#125;&#x27;<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰åœ¨-Pod-ä¸Šå®šä¹‰å®¹å¿åº¦"><a href="#4ï¼‰åœ¨-Pod-ä¸Šå®šä¹‰å®¹å¿åº¦" class="headerlink" title="4ï¼‰åœ¨ Pod ä¸Šå®šä¹‰å®¹å¿åº¦"></a>4ï¼‰åœ¨ Pod ä¸Šå®šä¹‰å®¹å¿åº¦</h4><ul><li>åœ¨ <code>spec.tolerations</code> å®šä¹‰ Pod çš„å®¹å¿åº¦</li><li><code>tolerationSeconds</code> åˆ™ç”¨äºå®šä¹‰å»¶è¿Ÿé©±é€ Pod çš„æ—¶é•¿ï¼Œå•ä½ä¸ºç§’ </li><li><code>operator</code> çš„é»˜è®¤å€¼ä¸º Equal</li></ul><h5 id="1-ç­‰å€¼åˆ¤æ–­è¯­æ³•"><a href="#1-ç­‰å€¼åˆ¤æ–­è¯­æ³•" class="headerlink" title="1. ç­‰å€¼åˆ¤æ–­è¯­æ³•:"></a>1. ç­‰å€¼åˆ¤æ–­è¯­æ³•:</h5><p>å®¹å¿åº¦ä¸æ±¡ç‚¹åœ¨ keyã€valueã€effect ä¸Šä¸‰è€…å®Œå…¨åŒ¹é…</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tolerations:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;key1&quot;</span><br>  <span class="hljs-attr">operator:</span> <span class="hljs-string">&quot;Equal&quot;</span><span class="hljs-comment"># åˆ¤æ–­æ¡ä»¶ä¸º Equal</span><br>  <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;value1&quot;</span><br>  <span class="hljs-attr">effect:</span> <span class="hljs-string">&quot;NoExecute&quot;</span><br>  <span class="hljs-attr">tolerationSeconds:</span> <span class="hljs-number">3600</span> <br>  <span class="hljs-comment"># é€šå¸¸è€Œè¨€è®¾ç½®èŠ‚ç‚¹æ±¡ç‚¹ä¸º NoExecute æ—¶ï¼Œä¼šç«‹å³é©±é€èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ä¸èƒ½å®¹å¿è¯¥æ±¡ç‚¹çš„ Podï¼ŒæŒ‡å®š tolerationSeconds åˆ™å¯ä»¥å»¶è¿Ÿä¸€æ®µæ—¶é—´å†é©±é€è¿™äº› Pod</span><br></code></pre></td></tr></table></figure><h5 id="2-å­˜åœ¨æ€§åˆ¤æ–­ç¤ºä¾‹"><a href="#2-å­˜åœ¨æ€§åˆ¤æ–­ç¤ºä¾‹" class="headerlink" title="2. å­˜åœ¨æ€§åˆ¤æ–­ç¤ºä¾‹:"></a>2. å­˜åœ¨æ€§åˆ¤æ–­ç¤ºä¾‹:</h5><p>keyã€effect ä¸Šå®Œå…¨åŒ¹é…ï¼Œvalue ä½¿ç”¨ç©ºå€¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tolerations:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;key1&quot;</span><br>  <span class="hljs-attr">operator:</span> <span class="hljs-string">&quot;Exists&quot;</span><span class="hljs-comment"># åˆ¤æ–­æ¡ä»¶ä¸º Existsï¼Œå³åªè¦æ±¡ç‚¹æ˜¯å­˜åœ¨çš„ï¼Œå°±å¯ä»¥åŒ¹é…</span><br>  <span class="hljs-attr">effect:</span> <span class="hljs-string">&quot;NoSchedule&quot;</span><br></code></pre></td></tr></table></figure><h5 id="3-yaml-ç¤ºä¾‹"><a href="#3-yaml-ç¤ºä¾‹" class="headerlink" title="3. yaml ç¤ºä¾‹:"></a>3. yaml ç¤ºä¾‹:</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">myapp-deploy</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">spec:</span><br>    <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span><br>    <span class="hljs-attr">selector:</span><br>        <span class="hljs-attr">matchLabels:</span><br>            <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>            <span class="hljs-attr">release:</span> <span class="hljs-string">canary</span><br>    <span class="hljs-attr">template:</span><br>        <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">labels:</span><br>                <span class="hljs-attr">app:</span> <span class="hljs-string">myapp</span><br>                <span class="hljs-attr">release:</span> <span class="hljs-string">canary</span><br>        <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">containers:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">myapp</span><br>            <span class="hljs-attr">image:</span> <span class="hljs-string">ikubernetes/myapp:v1</span><br>            <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br>            <span class="hljs-attr">tolerations:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;node-type&quot;</span><br>              <span class="hljs-attr">operator:</span> <span class="hljs-string">&quot;Equal&quot;</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-attr">&quot;production&quot;:</span><br>              <span class="hljs-attr">effect:</span> <span class="hljs-string">&quot;NoExecute&quot;</span><br>              <span class="hljs-attr">tolerationSeconds:</span> <span class="hljs-number">3600</span><br></code></pre></td></tr></table></figure><h4 id="5ï¼‰åŸºäºæ±¡ç‚¹çš„é©±é€æœºåˆ¶"><a href="#5ï¼‰åŸºäºæ±¡ç‚¹çš„é©±é€æœºåˆ¶" class="headerlink" title="5ï¼‰åŸºäºæ±¡ç‚¹çš„é©±é€æœºåˆ¶"></a>5ï¼‰åŸºäºæ±¡ç‚¹çš„é©±é€æœºåˆ¶</h4><p>ä¸Šé¢å·²ç»æåˆ°æ±¡ç‚¹çš„ <code>effect</code> å€¼ä¸º <code>NoExecute</code> æ—¶ä¼šå½±å“è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ Podï¼Œå¦‚åŒå¦‚ä¸‹å½¢å¼:</p><ul><li>å¦‚æœ Pod ä¸èƒ½å®¹å¿ effect ä¸º NoExecute çš„æ±¡ç‚¹ï¼Œé‚£ä¹ˆ Pod ä¼šé©¬ä¸Šè¢«é©±é€</li><li>å¦‚æœ Pod å¯ä»¥å®¹å¿ effect ä¸º NoExecute çš„æ±¡ç‚¹ï¼Œä½†æ˜¯åœ¨å®¹å¿åº¦è®¾ç½®ä¸­æ²¡æœ‰æŒ‡å®š <code>tolerationSeconds</code>ï¼Œåˆ™ Pod ä¼šä¸€ç›´åœ¨è¯¥èŠ‚ç‚¹è¿è¡Œ</li><li>å¦‚æœ Pod å¯ä»¥å®¹å¿ effect ä¸º NoExecute çš„æ±¡ç‚¹ï¼Œå¹¶ä¸”æŒ‡å®šäº† <code>tolerationSeconds</code>ï¼Œåˆ™ Pod ä¼šåœ¨è¯¥èŠ‚ç‚¹è¿è¡ŒæŒ‡å®šçš„æ—¶é•¿ï¼Œç„¶åè¢«é©±é€</li></ul><p>K8S æœ¬èº«ä¹Ÿä¼šåŸºäºæŸäº›å¼‚å¸¸çŠ¶æ€ï¼ŒèŠ‚ç‚¹æ§åˆ¶å™¨æˆ– kubelet ä¼šè‡ªåŠ¨ç»™èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªå†…ç½®æ±¡ç‚¹ï¼Œå¹¶è®¾ç½® effect ä¸º <code>NoExecute</code> ï¼Œè¿›è¡Œ Pod é©±é€ã€‚å½“å¼‚å¸¸çŠ¶æ€æ¢å¤æ­£å¸¸åï¼Œå°±ä¼šç§»é™¤ç›¸å…³çš„æ±¡ç‚¹ã€‚</p><h5 id="1-å†…ç½®æ±¡ç‚¹"><a href="#1-å†…ç½®æ±¡ç‚¹" class="headerlink" title="1. å†…ç½®æ±¡ç‚¹"></a>1. å†…ç½®æ±¡ç‚¹</h5><table><thead><tr><th>å†…ç½®æ±¡ç‚¹</th><th>æè¿°</th></tr></thead><tbody><tr><td>node.kubernetes.io/not-ready</td><td>èŠ‚ç‚¹æœªå°±ç»ªï¼Œç›¸å½“äºèŠ‚ç‚¹çŠ¶æ€ <code>Ready</code> çš„å€¼ä¸º <code>False</code>ï¼Œé»˜è®¤ <code>tolerationSeconds=300</code>ï¼ˆDaemonSet ä¸ä¼šè®¾ç½®<code>tolerationSeconds</code>ï¼‰</td></tr><tr><td>node.kubernetes.io/unreachable</td><td>èŠ‚ç‚¹æ§åˆ¶å™¨è®¿é—®ä¸åˆ°è¯¥èŠ‚ç‚¹ï¼Œç›¸å½“äºèŠ‚ç‚¹çŠ¶æ€ <code>Ready</code> çš„å€¼ä¸º <code>Unknown</code>ï¼Œé»˜è®¤ <code>tolerationSeconds=300</code>ï¼ˆDaemonSet ä¸ä¼šè®¾ç½®<code>tolerationSeconds</code>ï¼‰</td></tr><tr><td>node.kubernetes.io/memory-pressure</td><td>èŠ‚ç‚¹å­˜åœ¨å†…å­˜å‹åŠ›</td></tr><tr><td>node.kubernetes.io/disk-pressure</td><td>èŠ‚ç‚¹å­˜åœ¨ç£ç›˜å‹åŠ›</td></tr><tr><td>node.kubernetes.io/pid-pressure</td><td>èŠ‚ç‚¹å­˜åœ¨ pid å‹åŠ›</td></tr><tr><td>node.kubernetes.io/network-unavailable</td><td>èŠ‚ç‚¹ç½‘ç»œä¸å¯ç”¨</td></tr><tr><td>node.kubernetes.io/unschedulable</td><td>èŠ‚ç‚¹ä¸å¯è°ƒåº¦</td></tr><tr><td>node.cloudprovider.kubernetes.io/uninitialized</td><td>å¦‚æœ kubelet å¯åŠ¨æ—¶æŒ‡å®šäº†ä¸€ä¸ª â€œå¤–éƒ¨â€ äº‘å¹³å°é©±åŠ¨ï¼Œå®ƒå°†ä¼šç»™å½“å‰èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ±¡ç‚¹ï¼Œå°†å…¶æ ‡å¿—ä¸ºä¸å¯ç”¨ã€‚ç„¶ååœ¨ cloud-controller-manager çš„ä¸€ä¸ªæ§åˆ¶å™¨åˆå§‹åŒ–è¯¥èŠ‚ç‚¹åï¼Œkubelet ä¼šå°†è¿™ä¸ªæ±¡ç‚¹åˆ é™¤ã€‚</td></tr></tbody></table><blockquote><p>ğŸš© äº‹å®ä¸Šï¼ŒK8S ä¼šä»¥é™å®šé€Ÿç‡çš„æ–¹å¼å»æ·»åŠ å†…ç½®æ±¡ç‚¹ï¼Œè¿™æ ·å¯ä»¥é¿å… Pod è¢«å¤§é‡é©±é€ï¼Œç»™å…¶ä»–ç»„ä»¶é€ æˆå‹åŠ›ã€‚æ¯”å¦‚ï¼Œmaster èŠ‚ç‚¹å’Œ node é€šä¿¡ä¸­æ–­çš„åœºæ™¯ã€‚</p><p>ç»“åˆè¿™ç§ç‰¹æ€§ï¼Œé…åˆ <code>tolerationSeconds</code> çš„ä½¿ç”¨ï¼Œå°±å¯ä»¥æŒ‡å®š Pod åœ¨èŠ‚ç‚¹å‡ºç°ä¸Šè¿°é—®é¢˜æ—¶è¿˜ä¼šåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œå¤šä¹…ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªä½¿ç”¨äº†è®¸å¤šæœ¬åœ°çŠ¶æ€çš„åº”ç”¨åœ¨ç½‘ç»œæ–­å¼€æ—¶ï¼Œä»ç„¶å¸Œæœ›åœç•™åœ¨å½“å‰èŠ‚ç‚¹ä¸Šè¿è¡Œè¾ƒé•¿çš„æ—¶é—´ï¼Œæ„¿æ„ç­‰å¾…ç½‘ç»œæ¢å¤ï¼Œä¸æ„¿æ„è¢«é©±é€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPod çš„å®¹å¿åº¦å¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·çš„:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tolerations:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;node.kubernetes.io/unreachable&quot;</span><br>  <span class="hljs-attr">operator:</span> <span class="hljs-string">&quot;Exists&quot;</span><br>  <span class="hljs-attr">effect:</span> <span class="hljs-string">&quot;NoExecute&quot;</span><br>  <span class="hljs-attr">tolerationSeconds:</span> <span class="hljs-number">6000</span><br></code></pre></td></tr></table></figure></blockquote><h3 id="8ã€Pod-ä¼˜å…ˆçº§è°ƒåº¦-äº†è§£"><a href="#8ã€Pod-ä¼˜å…ˆçº§è°ƒåº¦-äº†è§£" class="headerlink" title="8ã€Pod ä¼˜å…ˆçº§è°ƒåº¦ (äº†è§£)"></a>8ã€Pod ä¼˜å…ˆçº§è°ƒåº¦ (äº†è§£)</h3><p>Pod çš„ä¼˜å…ˆçº§ã€æŠ¢å åŠŸèƒ½æ˜¯ä» K8S v1.8 å¼€å§‹å¼•ç”¨çš„åŠŸèƒ½ï¼Œåœ¨ v1.11 è¿›å…¥ beta çŠ¶æ€ï¼Œåˆ°äº† v1.14 åæ­£å¼è¿›å…¥ GA é˜¶æ®µï¼Œå·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿç¨³å®šçš„ç‰¹æ€§äº†ã€‚ä» v1.14 èµ·ï¼Œè¯¥åŠŸèƒ½ï¼ˆfeature <code>PodPriority</code>ï¼‰ é»˜è®¤æ˜¯å¼€å¯çš„ã€‚ä¹‹å‰çš„ç‰ˆæœ¬å¦‚è¦ä½¿ç”¨åˆ™éœ€è¦åŒæ—¶ä¸º kube-apiserverã€kube-schedulerã€kubelet çš„ <code>--feature-gates</code> å‚æ•°æ·»åŠ  <code>PodPriority=true</code>ã€‚</p><p>Pod çš„ä¼˜å…ˆçº§ï¼Œæ•…åæ€ä¹‰å°±æ˜¯å°† Pod åŒºåˆ†é‡è¦ç¨‹åº¦ï¼Œå°†èµ„æºä¼˜å…ˆæä¾›ç»™ä¸ªé‡è¦ç¨‹åº¦æ›´é«˜çš„ Podï¼Œä»¥æ­¤æ¥æä¾›èµ„æºçš„å¯ç”¨ç‡ï¼Œå¹¶ä¿éšœé‡è¦æœåŠ¡çš„æœåŠ¡è´¨é‡ã€‚</p><h4 id="1ï¼‰ç³»ç»Ÿé»˜è®¤ä¼˜å…ˆçº§"><a href="#1ï¼‰ç³»ç»Ÿé»˜è®¤ä¼˜å…ˆçº§" class="headerlink" title="1ï¼‰ç³»ç»Ÿé»˜è®¤ä¼˜å…ˆçº§"></a>1ï¼‰ç³»ç»Ÿé»˜è®¤ä¼˜å…ˆçº§</h4><p>æŸ¥çœ‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get priorityclasses.scheduling.k8s.io<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME                      VALUE        GLOBAL-DEFAULT   AGE<br>system-cluster-critical   2000000000   false            7d<br>system-node-critical      2000001000   false            7d<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ä½¿ç”¨-Pod-ä¼˜å…ˆçº§å’ŒæŠ¢å "><a href="#2ï¼‰ä½¿ç”¨-Pod-ä¼˜å…ˆçº§å’ŒæŠ¢å " class="headerlink" title="2ï¼‰ä½¿ç”¨ Pod ä¼˜å…ˆçº§å’ŒæŠ¢å "></a>2ï¼‰ä½¿ç”¨ Pod ä¼˜å…ˆçº§å’ŒæŠ¢å </h4><p>é¦–å…ˆï¼Œæ–°å¢ä¸€ä¸ªæˆ–å¤šä¸ª <code>PriorityClass</code> ï¼Œç¤ºä¾‹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">apiVersion: v1<br>kind: PriorityClass<br>metadata:<br>  name: high-priority<br>value: 1000000# value ä¸º 32 ä½æ•´æ•°ï¼Œç”¨äºè¡¨ç¤ºæƒé‡ï¼Œæƒé‡è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜<br>globalDefault: false# ç”¨äºæœªé…ç½® PriorityClassName çš„ Podï¼Œå½“æ•´ä¸ªé›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª PriorityClass æ—¶ï¼Œå¯å°†å…¶è®¾ç½®ä¸º true<br>description: &quot;This priority class should be used for xxx service pods only.&quot;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨åˆ›å»º Pod æ—¶ï¼Œåœ¨ PodSpec ä¸­å°† PriorityClassName è®¾ç½®ä¸ºæ–°å¢çš„ PriorityClassï¼Œç¤ºä¾‹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">env:</span> <span class="hljs-string">test</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>  <span class="hljs-attr">priorityClassName:</span> <span class="hljs-string">high-priority</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥ Kubernetes â€”â€” informer æ¨¡å—</title>
    <link href="/2021/10/21/%E6%B7%B1%E5%85%A5-Kubernetes-%E2%80%94%E2%80%94-informer-%E6%A8%A1%E5%9D%97/"/>
    <url>/2021/10/21/%E6%B7%B1%E5%85%A5-Kubernetes-%E2%80%94%E2%80%94-informer-%E6%A8%A1%E5%9D%97/</url>
    
    <content type="html"><![CDATA[<h1 id="æ·±å…¥-Kubernetes-â€”â€”-informer-æ¨¡å—"><a href="#æ·±å…¥-Kubernetes-â€”â€”-informer-æ¨¡å—" class="headerlink" title="æ·±å…¥ Kubernetes â€”â€” informer æ¨¡å—"></a>æ·±å…¥ Kubernetes â€”â€” informer æ¨¡å—</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes æºç åˆ†æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±å…¥ Kubernetes â€”â€” List-Watch æœºåˆ¶</title>
    <link href="/2021/10/21/%E6%B7%B1%E5%85%A5-Kubernetes-%E2%80%94%E2%80%94-List-Watch-%E6%9C%BA%E5%88%B6/"/>
    <url>/2021/10/21/%E6%B7%B1%E5%85%A5-Kubernetes-%E2%80%94%E2%80%94-List-Watch-%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="æ·±å…¥-Kubernetes-â€”â€”-List-Watch-æœºåˆ¶"><a href="#æ·±å…¥-Kubernetes-â€”â€”-List-Watch-æœºåˆ¶" class="headerlink" title="æ·±å…¥ Kubernetes â€”â€” List-Watch æœºåˆ¶"></a>æ·±å…¥ Kubernetes â€”â€” List-Watch æœºåˆ¶</h1><span id="more"></span><h2 id="ä¸€ã€æ¦‚å¿µä»‹ç»"><a href="#ä¸€ã€æ¦‚å¿µä»‹ç»" class="headerlink" title="ä¸€ã€æ¦‚å¿µä»‹ç»"></a>ä¸€ã€æ¦‚å¿µä»‹ç»</h2><h3 id="1ã€list-watch-ç®€ä»‹"><a href="#1ã€list-watch-ç®€ä»‹" class="headerlink" title="1ã€list-watch ç®€ä»‹"></a>1ã€list-watch ç®€ä»‹</h3><p>åœ¨ Kubernetes ä¸­ï¼Œå¯¹äºå¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†å¹¶æ²¡æœ‰ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„å½¢å¼ï¼Œè€Œæ˜¯ä½¿ç”¨äº†ä¸€ç§ç§°ä¸º <code>List-Watch</code> çš„å¼‚æ­¥æ¶ˆæ¯å¤„ç†æœºåˆ¶ï¼Œå®ƒæ˜¯ K8S æ•´ä½“æ¶æ„çš„ç²¾é«“æ‰€åœ¨ï¼Œä¿éšœäº† K8S ä¸­æ¶ˆæ¯çš„å®æ—¶æ€§ã€å¯é æ€§ã€é¡ºåºæ€§å’Œæ€§èƒ½ç­‰ï¼Œä¸ºå£°æ˜å¼é£æ ¼çš„ API å¥ å®šäº†è‰¯å¥½çš„åŸºç¡€ã€‚ã€</p><p><code>List-Watch</code> é¡¾åæ€ä¹‰æ˜¯ç”± <code>list</code> å’Œ <code>watch</code> ä¸¤ä¸ªåŠŸèƒ½ç»„æˆï¼Œåœ¨ K8S ä¸­ä»¥ Restful API çš„æ–¹å¼å‘ˆç°ã€‚</p><ul><li><p><code>List</code>: ä»è¡¨é¢ç†è§£æ˜¯åˆ—å‡ºæ˜ç»†ï¼Œäº‹å®ä¸Šæ­£å¦‚å…¶å®ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è°ƒç”¨èµ„æºçš„ <code>List API</code> ç½—åˆ—å‡ºèµ„æºä¿¡æ¯ï¼Œè¿™æ˜¯ä¸€çŸ­æœŸè¿‡ç¨‹ï¼Œæ‰€ä»¥æ˜¯åŸºäº HTTP çŸ­é“¾æ¥å®ç°ï¼›</p></li><li><p><code>Watch</code>: ä»è¡¨é¢ç†è§£æ˜¯è§‚å¯Ÿï¼Œæˆ–è€…è¯´æ˜¯ç›‘è§†ç›‘æ§ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è°ƒç”¨èµ„æºçš„ <code>Watch API</code> ç›‘å¬èµ„æºçš„å˜æ›´ï¼ˆå¢åˆ æ”¹ï¼‰äº‹ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒç»­æ€§è¿‡ç¨‹ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ HTTP é•¿é“¾æ¥å®ç°ã€‚</p></li></ul><p>æˆ‘ä»¬çŸ¥é“åœ¨ K8S çš„æ•´ä½“æ¶æ„ä¸­ï¼Œ<code>ETCD</code> ä½œä¸ºæ•°æ®åº“å­˜å‚¨é›†ç¾¤çš„æ•°æ®ï¼Œ<code>apiserver</code> ä½œä¸ºå¯¹ ETCD æ“ä½œçš„ç»Ÿä¸€å…¥å£ï¼Œä¸ºå…¶ä»–ç»„ä»¶æä¾›å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥èƒ½åŠ›ã€‚å®¢æˆ·ç«¯ç»„ä»¶ï¼ˆkubeletã€schedulerã€controller-managerï¼‰ä¼šé€šè¿‡ <code>List-Watch</code> ç›‘å¬ <code>apiserver</code> ä¸­å„èµ„æºï¼ˆå¦‚ï¼Œpodã€rcã€rs ç­‰ï¼‰çš„ createã€updateã€delete äº‹ä»¶ï¼Œå¹¶é’ˆå¯¹ <code>äº‹ä»¶ç±»å‹</code> å»è§¦å‘å¯¹åº”çš„ <code>äº‹ä»¶å¤„ç†å‡½æ•°</code>ã€‚</p><h3 id="2ã€ç¤ºä¾‹è¯´æ˜"><a href="#2ã€ç¤ºä¾‹è¯´æ˜" class="headerlink" title="2ã€ç¤ºä¾‹è¯´æ˜"></a>2ã€ç¤ºä¾‹è¯´æ˜</h3><p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#list-all-namespaces-pod-v1-core">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#list-all-namespaces-pod-v1-core</a></p><p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#watch-pod-v1-core">https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#watch-pod-v1-core</a></p><h2 id="äºŒã€è®¾è®¡ç†å¿µ"><a href="#äºŒã€è®¾è®¡ç†å¿µ" class="headerlink" title="äºŒã€è®¾è®¡ç†å¿µ"></a>äºŒã€è®¾è®¡ç†å¿µ</h2><h2 id="ä¸‰ã€ç›¸å…³æºç "><a href="#ä¸‰ã€ç›¸å…³æºç " class="headerlink" title="ä¸‰ã€ç›¸å…³æºç "></a>ä¸‰ã€ç›¸å…³æºç </h2>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes æºç åˆ†æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” ç›‘æ§ç»„ä»¶</title>
    <link href="/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6/"/>
    <url>/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-%E7%9B%91%E6%8E%A7%E7%BB%84%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-ç›‘æ§ç»„ä»¶"><a href="#Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-ç›‘æ§ç»„ä»¶" class="headerlink" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” ç›‘æ§ç»„ä»¶"></a>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” ç›‘æ§ç»„ä»¶</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes æ’ä»¶ä»‹ç» â€”â€” kube-state-metrics</title>
    <link href="/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-state-metrics/"/>
    <url>/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-state-metrics/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-æ’ä»¶ä»‹ç»-â€”â€”-kube-state-metrics"><a href="#Kubernetes-æ’ä»¶ä»‹ç»-â€”â€”-kube-state-metrics" class="headerlink" title="Kubernetes æ’ä»¶ä»‹ç» â€”â€” kube-state-metrics"></a>Kubernetes æ’ä»¶ä»‹ç» â€”â€” kube-state-metrics</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes æ’ä»¶ä»‹ç» â€”â€” metrics-server</title>
    <link href="/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-metrics-server/"/>
    <url>/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-metrics-server/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-æ’ä»¶ä»‹ç»-â€”â€”-metrics-server"><a href="#Kubernetes-æ’ä»¶ä»‹ç»-â€”â€”-metrics-server" class="headerlink" title="Kubernetes æ’ä»¶ä»‹ç» â€”â€” metrics-server"></a>Kubernetes æ’ä»¶ä»‹ç» â€”â€” metrics-server</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes æ’ä»¶ä»‹ç» â€”â€” Dashboard</title>
    <link href="/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-Dashboard/"/>
    <url>/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-Dashboard/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-æ’ä»¶ä»‹ç»-â€”â€”-Dashboard"><a href="#Kubernetes-æ’ä»¶ä»‹ç»-â€”â€”-Dashboard" class="headerlink" title="Kubernetes æ’ä»¶ä»‹ç» â€”â€” Dashboard"></a>Kubernetes æ’ä»¶ä»‹ç» â€”â€” Dashboard</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes æ’ä»¶ä»‹ç» â€”â€” CoreDNS</title>
    <link href="/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-CoreDNS/"/>
    <url>/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-CoreDNS/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-æ’ä»¶ä»‹ç»-â€”â€”-CoreDNS"><a href="#Kubernetes-æ’ä»¶ä»‹ç»-â€”â€”-CoreDNS" class="headerlink" title="Kubernetes æ’ä»¶ä»‹ç» â€”â€” CoreDNS"></a>Kubernetes æ’ä»¶ä»‹ç» â€”â€” CoreDNS</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” ç½‘ç»œç»„ä»¶</title>
    <link href="/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6/"/>
    <url>/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-ç½‘ç»œç»„ä»¶"><a href="#Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-ç½‘ç»œç»„ä»¶" class="headerlink" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” ç½‘ç»œç»„ä»¶"></a>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” ç½‘ç»œç»„ä»¶</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-proxy</title>
    <link href="/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-proxy/"/>
    <url>/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-proxy/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-proxy"><a href="#Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-proxy" class="headerlink" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-proxy"></a>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-proxy</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-controller-manager</title>
    <link href="/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-controller-manager/"/>
    <url>/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-controller-manager/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-controller-manager"><a href="#Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-controller-manager" class="headerlink" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-controller-manager"></a>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-controller-manager</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-apiserver</title>
    <link href="/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-apiserver/"/>
    <url>/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-apiserver/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-apiserver"><a href="#Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-kube-apiserver" class="headerlink" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-apiserver"></a>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-apiserver</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” etcd</title>
    <link href="/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-etcd/"/>
    <url>/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-etcd/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-etcd"><a href="#Kubernetes-åŸºç¡€ç»„ä»¶ä»‹ç»-â€”â€”-etcd" class="headerlink" title="Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” etcd"></a>Kubernetes åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” etcd</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2021/10/20/Kubernetes-%E4%BA%8C%E6%AC%A1%E8%B0%83%E5%BA%A6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2021/10/20/Kubernetes-%E4%BA%8C%E6%AC%A1%E8%B0%83%E5%BA%A6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ"><a href="#Kubernetes-äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Kubernetes äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ"></a>Kubernetes äºŒæ¬¡è°ƒåº¦è§£å†³æ–¹æ¡ˆ</h1><span id="more"></span><h2 id="ä¸€ã€é—®é¢˜æè¿°"><a href="#ä¸€ã€é—®é¢˜æè¿°" class="headerlink" title="ä¸€ã€é—®é¢˜æè¿°"></a>ä¸€ã€é—®é¢˜æè¿°</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>kube-scheduler</code> åœ¨ Kubernetes é›†ç¾¤ä¸­è´Ÿè´£è°ƒåº¦çš„ç»„ä»¶ã€‚ä½†æ˜¯é»˜è®¤çš„è°ƒåº¦æœºåˆ¶å´å¹¶ä¸é‚£ä¹ˆå‹å–„ï¼Œå³ä½¿æˆ‘ä»¬ä¸º Node é…ç½®äº†äº²å’Œæˆ–åäº²å’Œï¼Œä»ç„¶ä¼šå‡ºç°æŸäº›èŠ‚ç‚¹è´Ÿè½½é«˜ï¼ŒæŸäº›èŠ‚ç‚¹åˆ™å‡ ä¹ç©ºé—²çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸ºæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ pod åˆ›å»ºè¿è¡Œåï¼Œ<code>scheduler</code> å¹¶ä¸ä¼šå†æ¬¡å°è¯•é‡æ–°è°ƒåº¦å®ƒï¼Œé™¤éè§¦å‘é©±é€ï¼Œæ‰æœ‰å¯èƒ½æ˜¯è¿™äº› Pod å†æ¬¡è°ƒåº¦v ã€‚</p><p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­å›½ï¼Œæˆ‘ä»¬çš„ K8S åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°±ç¢°åˆ°äº†è¿™ç§æƒ…å†µã€‚pod çš„è°ƒåº¦ç»å¸¸ä¼šå‡ºç°å€¾æ–œçš„æƒ…å†µï¼Œå¤§é‡å‰¯æœ¬ç§¯å‹åœ¨ä¸ªåˆ« node èŠ‚ç‚¹ä¸Šï¼Œå°†èŠ‚ç‚¹èµ„æºå ç”¨å®Œï¼ˆè¿™é‡Œä¸»è¦ä½“ç°åœ¨å†…å­˜æ–¹é¢ï¼‰ï¼Œå¦‚ä¸‹å›¾çš„æƒ…å†µï¼š</p><p>Node15ã€Node16 å†…å­˜èµ„æºä½¿ç”¨ç‡ä»¥100%äº†ï¼Œä½†æ˜¯ç©ºé—²çš„èŠ‚ç‚¹å†…å­˜ä½¿ç”¨ç‡å¯èƒ½æœªè¶…è¿‡ 50%ï¼Œè¿™ç§åˆ†å¸ƒçš„å€¾æ–œäº‹å®ä¸Šæ˜¯ä¸å¥åº·çš„ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211020161447795.png" alt="image-20211020161447795"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211020161535235.png" alt="image-20211020161535235"></p><p>ç”±äºæˆ‘ä»¬åœ¨ kubelet ä¸­è®¾ç½®äº† evictionï¼Œä¹Ÿå°±æ˜¯é©±é€æœºåˆ¶ï¼Œåœ¨èŠ‚ç‚¹èµ„æºç´§å¼ æ—¶ï¼Œé©±é€æœºåˆ¶å°±ä¼šå¼€å¯ï¼Œä»¥æ­¤æ¥å°è¯•å›æ”¶èŠ‚ç‚¹èµ„æºã€‚</p><p>ä½†æ˜¯è¿™ç§é€šè¿‡ kubelet é©±é€çš„æ–¹å¼æ˜¯ååˆ†è¢«åŠ¨çš„ï¼Œå¹¶ä¸èƒ½åŠæ—¶çš„è§£å†³èµ„æºé€‚åº”å€¾æ–œçš„é—®é¢˜ã€‚è™½ç„¶ K8S åŸå§‹çš„è°ƒåº¦æä¾›äº†ä¸€äº›ä¼˜å…ˆçº§è°ƒåº¦å’Œè‡ªå®šä¹‰è°ƒåº¦çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¹¶ä¸çµæ´»ï¼Œæœ‰äº›ä¹Ÿç¼ºä¹åˆç†æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¦ä¸€ç§æ–¹æ¡ˆå»è§£å†³è¿™ç±»é—®é¢˜ã€‚</p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å† Pod åˆæ¬¡è°ƒåº¦æ—¶ï¼Œå°±è§£å†³èµ„æºå€¾æ–œçš„é—®é¢˜ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥åœ¨èµ„æºå‘ç”Ÿä¸å¹³è¡¡æ—¶è§¦å‘ Pod çš„å†ä¸€æ¬¡çš„è°ƒåº¦ï¼Œä»è€Œå›æ”¶èµ„æºï¼Œè¿™ä¹Ÿèƒ½å¤Ÿè§£å†³å€¾æ–œé—®é¢˜ã€‚è¿™ä¹ŸåŠæ—¶æœ¬æ–¹æ¡ˆæ‰€æ¶‰åŠçš„æ¦‚å¿µ â€”â€” äºŒæ¬¡è°ƒåº¦ã€‚</p><h2 id="äºŒã€Kubernetes-çš„é©±é€ã€è°ƒåº¦åŸç†"><a href="#äºŒã€Kubernetes-çš„é©±é€ã€è°ƒåº¦åŸç†" class="headerlink" title="äºŒã€Kubernetes çš„é©±é€ã€è°ƒåº¦åŸç†"></a>äºŒã€Kubernetes çš„é©±é€ã€è°ƒåº¦åŸç†</h2><h3 id="1ã€Kubernetes-é»˜è®¤è°ƒåº¦æœºåˆ¶-â€”â€”-kube-scheduler"><a href="#1ã€Kubernetes-é»˜è®¤è°ƒåº¦æœºåˆ¶-â€”â€”-kube-scheduler" class="headerlink" title="1ã€Kubernetes é»˜è®¤è°ƒåº¦æœºåˆ¶ â€”â€” kube-scheduler"></a>1ã€Kubernetes é»˜è®¤è°ƒåº¦æœºåˆ¶ â€”â€” kube-scheduler</h3><p>è°ƒåº¦å™¨æ˜¯ä¸€ä¸ªæ§åˆ¶é¢çš„è¿›ç¨‹ï¼Œå®ƒè´Ÿè´£å°† Pod æŒ‡æ´¾åˆ° Node èŠ‚ç‚¹ä¸Šã€‚è°ƒåº¦åŸºäºçº¦æŸå’Œå¯ç”¨èµ„æºä¸ºè°ƒåº¦é˜Ÿåˆ—ä¸­æ¯ä¸ª Pod ç¡®å®šå…¶åˆé€‚çš„è¿è¡Œä½ç½®ã€‚ä¹‹åï¼Œè°ƒåº¦å™¨ä¼šå¯¹æ‰€æœ‰åˆé€‚çš„èŠ‚ç‚¹è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œå¹¶å°† Pod ç»‘å®šåˆ°å¾—åˆ†æœ€é«˜çš„èŠ‚ç‚¹å»ã€‚</p><p>é€šè¿‡å¯¹äºå…¶åŸç†çš„å­¦ä¹ ï¼Œå¯ä»¥è¿›ä¸€æ­¥äº†è§£ K8S ä¸­çš„è°ƒåº¦åˆ°åº•æ˜¯åœ¨åšä»€ä¹ˆã€‚ç›¸å…³å…·ä½“å†…å®¹å¯ä»¥çœ‹ä¹‹å‰çš„åšæ–‡: <a href="https://tareya.github.io/2021/10/27/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-scheduler/#%E4%B8%80%E3%80%81K8S-%E8%B0%83%E5%BA%A6%E5%8E%9F%E7%90%86%E5%92%8C%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5">K8S è°ƒåº¦åŸç†å’Œè°ƒåº¦ç­–ç•¥</a></p><h3 id="2ã€Kubernetes-èŠ‚ç‚¹å‹åŠ›é©±é€-â€”â€”-kubelet-çš„é©±é€æœºåˆ¶"><a href="#2ã€Kubernetes-èŠ‚ç‚¹å‹åŠ›é©±é€-â€”â€”-kubelet-çš„é©±é€æœºåˆ¶" class="headerlink" title="2ã€Kubernetes èŠ‚ç‚¹å‹åŠ›é©±é€ â€”â€” kubelet çš„é©±é€æœºåˆ¶"></a>2ã€Kubernetes èŠ‚ç‚¹å‹åŠ›é©±é€ â€”â€” kubelet çš„é©±é€æœºåˆ¶</h3><p>é™¤äº†é€šè¿‡è°ƒåº¦çš„æ–¹å¼é©±é€ Pod å¤–ï¼ŒK8S è¿˜å­˜åœ¨ä¸€ç§å…œåº•çš„é©±é€æœºåˆ¶ï¼Œå°±æ˜¯èŠ‚ç‚¹å‹åŠ›é©±é€ï¼Œè¿™ä¸ªæœºåˆ¶ç”¨äºåœ¨èŠ‚ç‚¹èµ„æºè€—å°½å‰ç´§æ€¥å›æ”¶ç³»ç»Ÿèµ„æºï¼Œä»¥é¿å…èŠ‚ç‚¹æ‰€åœ¨ç³»ç»Ÿç”±äºèµ„æºè€—å°½å®•æœºã€‚ç›¸å…³å…·ä½“å†…å®¹å¯ä»¥çœ‹ä¹‹å‰çš„åšæ–‡: <a href="https://tareya.github.io/2021/11/03/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kubelet/#%E4%B8%89%E3%80%81Kubernetes-%E8%8A%82%E7%82%B9%E5%8E%8B%E5%8A%9B%E9%A9%B1%E9%80%90">K8S èŠ‚ç‚¹å‹åŠ›é©±é€</a></p><h2 id="ä¸‰ã€Descheduler-äºŒæ¬¡è°ƒåº¦æ–¹æ¡ˆ"><a href="#ä¸‰ã€Descheduler-äºŒæ¬¡è°ƒåº¦æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€Descheduler äºŒæ¬¡è°ƒåº¦æ–¹æ¡ˆ"></a>ä¸‰ã€Descheduler äºŒæ¬¡è°ƒåº¦æ–¹æ¡ˆ</h2><h3 id="1ã€Descheduler-ç®€ä»‹"><a href="#1ã€Descheduler-ç®€ä»‹" class="headerlink" title="1ã€Descheduler ç®€ä»‹"></a>1ã€Descheduler ç®€ä»‹</h3><h4 id="1ï¼‰ä»€ä¹ˆæ˜¯-Descheduler-ï¼Ÿ"><a href="#1ï¼‰ä»€ä¹ˆæ˜¯-Descheduler-ï¼Ÿ" class="headerlink" title="1ï¼‰ä»€ä¹ˆæ˜¯ Descheduler ï¼Ÿ"></a>1ï¼‰ä»€ä¹ˆæ˜¯ Descheduler ï¼Ÿ</h4><p>ä¸Šæ–‡ä¸­æˆ‘ä»¬ä»‹ç»äº†Kubernetes ä¸­çš„è°ƒåº¦æœºåˆ¶ï¼Œç®€å•çš„è¯´è°ƒåº¦å°±æ˜¯å°† Pending çŠ¶æ€çš„ Pod ç»‘å®šåˆ° Node èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªå·¥ä½œé»˜è®¤æ˜¯ç”± kube-scheduler è¿™ä¸ªç»„ä»¶æ¥å®Œæˆçš„ï¼Œå®ƒå®Œæˆäº† Pod çš„åˆæ¬¡è°ƒåº¦ã€‚å¹¶ä¸” Kubernetes ä¹Ÿå…è®¸åœ¨åŒä¸€ä¸ªé›†ç¾¤ä¸­ä½¿ç”¨å¤šä¸ªè°ƒåº¦å™¨ã€‚</p><p>ç”±äº Kubernetes æ•´ä½“æ¥è¯´æ˜¯éå¸¸åŠ¨æ€çš„ï¼Œé›†ç¾¤çš„çŠ¶æ€éšç€æ—¶é—´çš„æ¨ç§»ä¼šä¸æ–­çš„å˜åŒ–ã€‚æˆ‘ä»¬ç»å¸¸ä¼šå› ä¸ºå„ç§åŸå› ï¼ŒæœŸæœ›å°†å·²è¿è¡Œçš„ Pod å¯ä»¥ç§»åŠ¨åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚æˆ‘ä»¬å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºäºŒæ¬¡è°ƒåº¦ã€‚</p><p>è€Œ Descheduler å°±æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†äºŒæ¬¡è°ƒåº¦è¿‡ç¨‹çš„è°ƒåº¦å™¨ã€‚å®ƒä¼šæ ¹æ®è°ƒåº¦ç­–ç•¥ï¼Œæ‰¾åˆ°å¯ä»¥ç§»åŠ¨ Pod å¹¶è¿›è¡Œé©±é€ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒDescheduler å¹¶ä¸æ˜¯ç”¨æ¥ä»£æ›¿ kube-scheduler çš„ï¼Œè€Œæ˜¯ä¾èµ–äº K8S åŸå§‹çš„è°ƒåº¦æœºåˆ¶æ¥å®Œæˆå·¥ä½œã€‚</p><h4 id="2ï¼‰ç‰ˆæœ¬å…¼å®¹æ€§"><a href="#2ï¼‰ç‰ˆæœ¬å…¼å®¹æ€§" class="headerlink" title="2ï¼‰ç‰ˆæœ¬å…¼å®¹æ€§"></a>2ï¼‰ç‰ˆæœ¬å…¼å®¹æ€§</h4><p>è™½ç„¶ <code>Descheduler</code> å¯¹äº K8S çš„ç‰ˆæœ¬æ²¡æœ‰ç¡¬æ€§ä»¥æ¥ï¼Œä½†æ˜¯ä¸€èˆ¬æ¥è¯´ K8S æä¾›çš„å®¢æˆ·ç«¯åŒ…ï¼ˆclient-goã€apimachinery ç­‰ï¼‰ä¼šå‘ä¸‹å…¼å®¹ä¸‰ä¸ªç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼Œè°ƒåº¦ç¨‹åº v0.18 åº”ä¸ k8s v1.18ã€v1.17 å’Œ v1.16 é…åˆä½¿ç”¨ã€‚</p><p>ä¸‹é¢çš„å…¼å®¹æ€§çŸ©é˜µæ˜¾ç¤ºäº†ç”¨äºç¼–è¯‘ descheduler çš„ k8s å®¢æˆ·ç«¯åŒ…ç‰ˆæœ¬ã€‚ ä» descheduler ç‰ˆæœ¬ v0.18 å¼€å§‹ï¼Œdescheduler çš„æ¬¡è¦ç‰ˆæœ¬ä¸ç¼–è¯‘å®ƒçš„ k8s å®¢æˆ·ç«¯è½¯ä»¶åŒ…çš„æ¬¡è¦ç‰ˆæœ¬ç›¸åŒ¹é…ã€‚</p><table><thead><tr><th>Descheduler</th><th>supported Kubernetes version</th></tr></thead><tbody><tr><td>v0.22</td><td>v1.22</td></tr><tr><td>v0.21</td><td>v1.21</td></tr><tr><td>v0.20</td><td>v1.20</td></tr><tr><td>v0.19</td><td>v1.19</td></tr><tr><td>v0.18</td><td>v1.18</td></tr><tr><td>v0.10</td><td>v1.17</td></tr><tr><td>v0.4 - v0.9</td><td>v1.9 +</td></tr><tr><td>v0.1 - v0.3</td><td>v1.7 - v1.8</td></tr></tbody></table><blockquote><p>ğŸš© ç”±äºäº§çº¿ç¯å¢ƒçš„ K8S ç‰ˆæœ¬ä¸€èˆ¬éƒ½ä½äº v1.17ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€‰ç”¨ v0.9 ç‰ˆæœ¬ã€‚</p></blockquote><h4 id="3ï¼‰Descheduler-çš„äºŒæ¬¡è°ƒåº¦ç­–ç•¥"><a href="#3ï¼‰Descheduler-çš„äºŒæ¬¡è°ƒåº¦ç­–ç•¥" class="headerlink" title="3ï¼‰Descheduler çš„äºŒæ¬¡è°ƒåº¦ç­–ç•¥"></a>3ï¼‰Descheduler çš„äºŒæ¬¡è°ƒåº¦ç­–ç•¥</h4><h5 id="1-RemoveDuplicates-ç­–ç•¥"><a href="#1-RemoveDuplicates-ç­–ç•¥" class="headerlink" title="1. RemoveDuplicates ç­–ç•¥"></a>1. RemoveDuplicates ç­–ç•¥</h5><p>å»é‡ç­–ç•¥ï¼Œè¯¥ç­–ç•¥ç¡®ä¿åªæœ‰ä¸€ä¸ª Pod ä¸åœ¨åŒèŠ‚ç‚¹ä¸Šçš„è¿è¡Œçš„<code>ReplicSet</code>ã€<code>ReplicationController</code>ã€<code>StatefulSet</code> æˆ– <code>Job</code> ç›¸å…³è”ã€‚å¦‚æœå­˜åœ¨å¤æ•°ä¸ªï¼Œå°±ä¼šå°†é‡å¤çš„å®¹å™¨è¿›è¡Œé©±é€ï¼Œä»¥æ­¤è®©å®¹å™¨å¯ä»¥æ›´å¥½çš„åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­ã€‚ï¼ˆäº‹å®ä¸Šé€šè¿‡ Pod çš„åäº²å’Œä¹Ÿå¯ä»¥å®ç°ï¼‰</p><p>å½“æœ‰æŸäº›èŠ‚ç‚¹ç”±äºæŸç§åŸå› å®•æœºæ—¶ï¼Œå®ƒä¸Šé¢çš„ Pod å°±ä¼šè¿ç§»è‡³å…¶ä»–èŠ‚ç‚¹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå°±å¯èƒ½å‡ºç°å¤šä¸ªä¸ RS æˆ– RC å…³è”çš„ Pod è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹ä¸Šã€‚å½“æ•…éšœèŠ‚ç‚¹æ¢å¤åï¼Œå°±å¯ä»¥é€šè¿‡è¯¥ç­–ç•¥æ¥é©±é€è¿™äº›é‡å¤çš„ Podã€‚</p><p>è¯¥ç­–ç•¥æä¾›äº†ä¸€ä¸ª <code>excludeOwnerKinds</code>çš„å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«æ§åˆ¶å™¨ç±»å‹çš„åˆ—è¡¨ã€‚å¦‚æœ Pod å°†è¯¥åˆ—è¡¨å†…çš„ä»»ä½•ä¸€ç§åšä¸ºæ§åˆ¶å™¨ï¼Œåˆ™ä¸ä¼šè€ƒè™‘é©±é€è¯¥ Podã€‚æ¯”å¦‚ä»¥ Deployment åˆ›å»ºçš„ Pod ä¼šè¢«è¯¥ç­–ç•¥é©±é€ï¼Œä¸ºäº†é¿å…è¢«é©±é€ï¼Œåˆ™éœ€è¦åœ¨åˆ—è¡¨ä¸­åŠ å…¥ <code>ReplicaSet</code>ã€‚</p><h6 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemoveDuplicates&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">removeDuplicates:</span><br>         <span class="hljs-attr">excludeOwnerKinds:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;ReplicaSet&quot;</span><br></code></pre></td></tr></table></figure><h6 id="ç¦ç”¨ç¤ºä¾‹"><a href="#ç¦ç”¨ç¤ºä¾‹" class="headerlink" title="ç¦ç”¨ç¤ºä¾‹:"></a>ç¦ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemoveDuplicates&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h5 id="2-LowNodeUtilization-ç­–ç•¥"><a href="#2-LowNodeUtilization-ç­–ç•¥" class="headerlink" title="2. LowNodeUtilization ç­–ç•¥"></a>2. LowNodeUtilization ç­–ç•¥</h5><p>ä½èŠ‚ç‚¹ä½¿ç”¨ç‡ç­–ç•¥ï¼Œè¯¥ç­–ç•¥ä¼šæ‰¾åˆ°ä½¿ç”¨ç‡è¾ƒä½çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œä»å…¶ä»–èŠ‚ç‚¹é©±é€ Podï¼Œå¹¶é©±é€åˆ°è¿™äº›ä½¿ç”¨ç‡è¾ƒä½çš„èŠ‚ç‚¹ä¸Šã€‚æ­¤ç­–ç•¥çš„é…ç½®å‚æ•°ä¸º <code>nodeResourceUtilizationThresholds</code>ã€‚</p><h6 id="ç­–ç•¥ç›¸å…³å‚æ•°"><a href="#ç­–ç•¥ç›¸å…³å‚æ•°" class="headerlink" title="ç­–ç•¥ç›¸å…³å‚æ•°:"></a>ç­–ç•¥ç›¸å…³å‚æ•°:</h6><ul><li><p><code>thresholds</code> : èŠ‚ç‚¹åˆ©ç”¨ç‡ä¸è¶³çš„é˜ˆå€¼ï¼Œå¯ä»¥æŒ‰ç…§ cpuã€å†…å­˜ã€pod æ•°é‡å’Œæ‰©å±•èµ„æºçš„ç™¾åˆ†æ¯”æ¥é…ç½®ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„ä½¿ç”¨ç‡ä½äºæ‰€æœ‰é˜ˆå€¼ï¼ˆcpuã€å†…å­˜ã€pod æ•°é‡ï¼‰ï¼ŒèŠ‚ç‚¹å°±ä¼šè¢«è®¤å®šä¸ºæœªå……åˆ†åˆ©ç”¨ã€‚ç›®å‰ï¼Œè®¡ç®—èŠ‚ç‚¹èµ„æºåˆ©ç”¨ç‡ä¹Ÿè€ƒè™‘äº† pod çš„ request èµ„æºéœ€æ±‚ã€‚</p></li><li><p><code>targetThresholds</code>: èŠ‚ç‚¹åˆ©ç”¨ç‡ä¸è¶³çš„é˜ˆå€¼ï¼Œå¯ä»¥æŒ‰ç…§ cpuã€å†…å­˜ã€pod æ•°é‡å’Œæ‰©å±•èµ„æºçš„ç™¾åˆ†æ¯”æ¥é…ç½®ã€‚ç”¨äºè®¡ç®—å¯ä»¥é©±é€ Pod çš„æ½œåœ¨èŠ‚ç‚¹ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹çš„ä½¿ç”¨ç‡é«˜äºä»»ä½•ä¸€ä¸ª <code>targetThresholds</code> çš„é˜ˆå€¼ï¼ˆcpuã€å†…å­˜ã€pod æ•°é‡æˆ–æ‰©å±•èµ„æºï¼‰ï¼Œè¯¥ç›®æ ‡èŠ‚ç‚¹å°±ä¼šè¢«è®¤å®šä¸ºè¿‡åº¦ä½¿ç”¨ã€‚</p></li></ul><p>ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„èµ„æºä½¿ç”¨ç‡åœ¨ <code>thresholds </code> å’Œ <code>targetThresholds</code> çš„é˜ˆå€¼ä¹‹é—´ï¼Œå°±ä¼šè¢«è®¤å®šä¸ºé€‚å½“ä½¿ç”¨ï¼Œåˆ™ä¸ä¼šè€ƒè™‘é©±é€ä¸Šé¢çš„ Podã€‚<code>thresholds</code> å’Œ <code>targetThresholds</code> çš„é˜ˆå€¼å¯ä»¥æ ¹æ®é›†ç¾¤çš„è¦æ±‚è¿›è¡Œè°ƒæ•´ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªç­–ç•¥æ˜¯å°† Pod ä»è¿‡åº¦ä½¿ç”¨çš„èŠ‚ç‚¹ï¼ˆä½¿ç”¨ç‡é«˜äº <code>targetThresholds</code> é˜ˆå€¼çš„èŠ‚ç‚¹ï¼‰é©±é€åˆ°ä½¿ç”¨ç‡ä¸è¶³çš„èŠ‚ç‚¹ï¼ˆä½¿ç”¨ç‡ä½äº <code>thresholds</code> é˜ˆå€¼çš„èŠ‚ç‚¹ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è¿™ç±»èŠ‚ç‚¹ï¼Œåˆ™ç­–ç•¥ä¼šç»ˆæ­¢ã€‚</p><h6 id="ä½¿ç”¨ç¤ºä¾‹-1"><a href="#ä½¿ç”¨ç¤ºä¾‹-1" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;LowNodeUtilization&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">nodeResourceUtilizationThresholds:</span><br>         <span class="hljs-attr">thresholds:</span><br>           <span class="hljs-string">&quot;cpu&quot;</span> <span class="hljs-string">:</span> <span class="hljs-number">20</span><br>           <span class="hljs-attr">&quot;memory&quot;:</span> <span class="hljs-number">20</span><br>           <span class="hljs-attr">&quot;pods&quot;:</span> <span class="hljs-number">20</span><br>         <span class="hljs-attr">targetThresholds:</span><br>           <span class="hljs-string">&quot;cpu&quot;</span> <span class="hljs-string">:</span> <span class="hljs-number">50</span><br>           <span class="hljs-attr">&quot;memory&quot;:</span> <span class="hljs-number">50</span><br>           <span class="hljs-attr">&quot;pods&quot;:</span> <span class="hljs-number">50</span><br></code></pre></td></tr></table></figure><p>ä¸è¯¥ <code>LowNodeUtilization</code> ç­–ç•¥ç›¸å…³çš„å¦ä¸€ä¸ªå‚æ•°ç§°ä¸º <code>numberOfNodes</code>ã€‚ä»…å½“æœªå……åˆ†åˆ©ç”¨çš„èŠ‚ç‚¹æ•°å¤§äºé…ç½®çš„å€¼æ—¶ï¼Œæ‰å¯ä»¥é…ç½®æ­¤å‚æ•°ä»¥æ¿€æ´»ç­–ç•¥ã€‚è¿™åœ¨å¤§å‹ç¾¤é›†ä¸­å¾ˆæœ‰ç”¨ï¼Œå…¶ä¸­ä¸€äº›èŠ‚ç‚¹å¯èƒ½ä¼šé¢‘ç¹ä½¿ç”¨æˆ–çŸ­æœŸä½¿ç”¨ä¸è¶³ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>numberOfNodes</code>è®¾ç½®ä¸º0ã€‚</p><h5 id="3-RemovePodsViolatingInterPodAntiAffinity-ç­–ç•¥"><a href="#3-RemovePodsViolatingInterPodAntiAffinity-ç­–ç•¥" class="headerlink" title="3. RemovePodsViolatingInterPodAntiAffinity ç­–ç•¥"></a>3. RemovePodsViolatingInterPodAntiAffinity ç­–ç•¥</h5><p>ç§»é™¤è¿æ³• Pod åäº²å’Œæ€§ Pods ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥ç¡®ä¿ä»èŠ‚ç‚¹ä¸­åˆ é™¤è¿åäº† Interpod åäº²å’Œæ€§çš„ Podã€‚ä¾‹å¦‚è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹çš„ podAã€podBã€podC è®¾ç½®äº†åäº²å’Œæ€§è§„åˆ™ï¼Œç¦æ­¢ä»–ä»¬è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹ä¸Šã€‚åˆ™ podA å°±ä¼šè¢«é©±é€å‡ºèŠ‚ç‚¹ï¼Œä»¥ä¾¿è®© podB å’Œ podC å¯ä»¥æ­£å¸¸è¿è¡Œã€‚ä½†æ˜¯å½“ podBã€podC å·²ç»è¿è¡Œåœ¨èŠ‚ç‚¹ä¸Šäº†ï¼Œç„¶åå†å¢åŠ äº†åäº²å’Œè§„åˆ™ï¼Œkube-scheduler å¹¶ä¸ä¼šå†è°ƒåº¦å·²ç»åœ¨è¿è¡Œçš„ Pod ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡è¯¥ç­–ç•¥è§¦å‘äºŒæ¬¡é©±é€ã€‚ç›®å‰è¯¥ç­–ç•¥æ²¡æœ‰ç›¸å…³çš„å‚æ•°ã€‚</p><h6 id="ä½¿ç”¨ç¤ºä¾‹-2"><a href="#ä½¿ç”¨ç¤ºä¾‹-2" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsViolatingInterPodAntiAffinity&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h6 id="ç¦ç”¨ç¤ºä¾‹-1"><a href="#ç¦ç”¨ç¤ºä¾‹-1" class="headerlink" title="ç¦ç”¨ç¤ºä¾‹:"></a>ç¦ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsViolatingInterPodAntiAffinity&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h5 id="4-RemovePodsViolatingNodeAffinity-ç­–ç•¥"><a href="#4-RemovePodsViolatingNodeAffinity-ç­–ç•¥" class="headerlink" title="4. RemovePodsViolatingNodeAffinity ç­–ç•¥"></a>4. RemovePodsViolatingNodeAffinity ç­–ç•¥</h5><p>ç§»é™¤è¿å Node äº²å’Œæ€§ Pods ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥ç¡®ä¿æ‰€æœ‰è¿åäº†èŠ‚ç‚¹äº²å’Œæ€§çš„ Pod éƒ½ä¼šè¢«é©±é€ã€‚Pod å¯ä»¥é€šè¿‡æŒ‡å®š <code>requiredDuringSchedulingIgnoredDuringExecution</code>ç±»å‹æ¥å‘ŠçŸ¥è°ƒåº¦å™¨åœ¨è°ƒåº¦æ—¶è¦éµå¾ªçš„èŠ‚ç‚¹äº²å’Œæ€§è§„åˆ™ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨åˆæ¬¡è°ƒåº¦æ—¶å®Œæˆï¼Œåœ¨ Pod æ­£å¼è¿è¡Œåï¼Œkubelet ä¸ºäº†é¿å…èŠ‚ç‚¹éšæ—¶å‘ç”Ÿå˜åŒ–ï¼Œä¼šå¿½ç•¥äº²å’Œæ€§çš„é…ç½®ã€‚</p><p>å¯ç”¨è¯¥ç­–ç•¥åï¼Œå¦‚æœèŠ‚ç‚¹åœ¨åç»­è¿‡ç¨‹ä¸­ä¸åœ¨æ»¡è¶³ Pod çš„èŠ‚ç‚¹äº²å’Œï¼Œå°±ä¼šè§¦å‘é©±é€ã€‚ä¾‹å¦‚ï¼ŒnodeA ä¸Šè¿è¡Œäº† podAï¼ŒpodA åœ¨åˆæ¬¡è°ƒåº¦æ—¶æ»¡è¶³èŠ‚ç‚¹ç®¡ç†æ–°è§„åˆ™ <code>requiredDuringSchedulingIgnoredDuringExecution</code>ï¼Œä½†æ˜¯éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒnodeA ä¸å†æ»¡è¶³è¯¥è§„åˆ™ï¼ˆå¦‚èŠ‚ç‚¹çš„ namespace label å˜æ›´ï¼‰ï¼Œè€Œ nodeB å¯ç”¨ä¸”æ»¡è¶³ podA çš„èŠ‚ç‚¹å…³è”æ€§ï¼Œé‚£ä¹ˆ podA å°±ä¼šè¢«é©±é€åˆ° nodeBã€‚</p><h6 id="ä½¿ç”¨ç¤ºä¾‹-3"><a href="#ä½¿ç”¨ç¤ºä¾‹-3" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsViolatingNodeAffinity&quot;:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">params:</span><br>      <span class="hljs-attr">nodeAffinityType:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;requiredDuringSchedulingIgnoredDuringExecution&quot;</span><br></code></pre></td></tr></table></figure><h5 id="5-RemovePodsViolatingNodeTaints-ç­–ç•¥"><a href="#5-RemovePodsViolatingNodeTaints-ç­–ç•¥" class="headerlink" title="5. RemovePodsViolatingNodeTaints ç­–ç•¥"></a>5. RemovePodsViolatingNodeTaints ç­–ç•¥</h5><p>ç§»é™¤è¿å Node æ±¡ç‚¹ Pods ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥ç¡®ä¿è¿åäº†èŠ‚ç‚¹ä¸Š <code>NoSchedule</code> æ±¡ç‚¹è§„åˆ™çš„ Podä¼šè¢«é©±é€ã€‚ä¾‹å¦‚ï¼ŒpodA è®¾ç½®äº†å¯¹äºæ±¡ç‚¹ <code>key=value:NoSchedule</code> çš„å®¹å¿ï¼Œå¹¶è¢«è°ƒåº¦åˆ°æœ‰å¯¹åº”æ±¡ç‚¹çš„ nodeA ä¸Šè¿è¡Œã€‚å¦‚æœåæ¥ nodeA çš„æ±¡ç‚¹è¢«æ›´æ”¹æˆ–åˆ é™¤ï¼ŒpodA çš„å®¹å¿å°±ä¸å†é€‚ç”¨ï¼Œä½†æ˜¯é™¤éæ˜¯è®¾ç½®äº† NoExcuteï¼Œå¦åˆ™æ­£å¸¸è¿è¡Œçš„ podA å¹¶ä¸ä¼šè¢«é©±é€ã€‚è€Œå¯ç”¨è¯¥ç­–ç•¥åï¼Œå°±ä¼šå†æ­¤è§¦å‘æ±¡ç‚¹å®¹å¿åˆ¤æ–­ï¼Œè¿›è€Œé©±é€ podAã€‚</p><h6 id="ä½¿ç”¨ç¤ºä¾‹-4"><a href="#ä½¿ç”¨ç¤ºä¾‹-4" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsViolatingNodeTaints&quot;:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h5 id="6-RemovePodsHavingTooManyRestarts-ç­–ç•¥"><a href="#6-RemovePodsHavingTooManyRestarts-ç­–ç•¥" class="headerlink" title="6. RemovePodsHavingTooManyRestarts ç­–ç•¥"></a>6. RemovePodsHavingTooManyRestarts ç­–ç•¥</h5><p>ç§»é™¤é‡å¯è¿‡å¤š Pods ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å¯ä»¥ç¡®ä¿èŠ‚ç‚¹ä¸Šé‡å¯æ¬¡æ•°è¿‡å¤šçš„ Pod ä¼šè¢«é©±é€ã€‚ä¾‹å¦‚ï¼ŒæŒ‚è½½ volume æˆ–ç£ç›˜å¤±è´¥ï¼Œè¿™ç§ pod åº”è¯¥è¢«äºŒæ¬¡è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p><h6 id="ç­–ç•¥ç›¸å…³å‚æ•°-1"><a href="#ç­–ç•¥ç›¸å…³å‚æ•°-1" class="headerlink" title="ç­–ç•¥ç›¸å…³å‚æ•°:"></a>ç­–ç•¥ç›¸å…³å‚æ•°:</h6><ul><li><code>podRestartThreshold</code>: ç”¨äºè®¾ç½®é‡å¯æ¬¡æ•°çš„é˜ˆå€¼ï¼Œå½“ä¸€ä¸ª Pod çš„é‡å¯æ¬¡æ•°è¶…è¿‡è¯¥é˜ˆå€¼ï¼Œå°±ä¼šè¢«é©±é€</li><li><code>includingInitContainers</code>: ç¡®è®¤ init å®¹å™¨é˜¶æ®µçš„ Pod æ˜¯å¦ä¹ŸåŒ…æ‹¬åœ¨å†…</li></ul><h6 id="ä½¿ç”¨ç¤ºä¾‹-5"><a href="#ä½¿ç”¨ç¤ºä¾‹-5" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemovePodsHavingTooManyRestarts&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">podsHavingTooManyRestarts:</span><br>         <span class="hljs-attr">podRestartThreshold:</span> <span class="hljs-number">100</span><br>         <span class="hljs-attr">includingInitContainers:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h5 id="7-PodLifeTime-ç­–ç•¥"><a href="#7-PodLifeTime-ç­–ç•¥" class="headerlink" title="7. PodLifeTime ç­–ç•¥"></a>7. PodLifeTime ç­–ç•¥</h5><p>Pod å­˜æ´»å‘¨æœŸç®¡ç†ç­–ç•¥ï¼Œè¯¥ç­–ç•¥ä¼šå¯ä»¥æ ¹æ®è¿è¡Œæ—¶é—´å’Œ Pod çŠ¶æ€ä¸ºä¾æ®æ¥è§¦å‘ Pod äºŒæ¬¡è°ƒåº¦ã€‚</p><h6 id="ç­–ç•¥ç›¸å…³å‚æ•°-2"><a href="#ç­–ç•¥ç›¸å…³å‚æ•°-2" class="headerlink" title="ç­–ç•¥ç›¸å…³å‚æ•°:"></a>ç­–ç•¥ç›¸å…³å‚æ•°:</h6><ul><li><code>maxPodLifeTimeSeconds</code>: é¢„è®¾è¿è¡Œæ—¶é•¿é˜ˆå€¼ï¼Œè¶…è¿‡é˜ˆå€¼çš„ Pod å°±ä¼šè¢«é©±é€ã€‚</li><li><code>podStatusPhases</code>: é¢„è®¾ Pod è¿è¡ŒçŠ¶æ€ï¼ˆrunning æˆ– pendingï¼‰ï¼Œå¦‚æœ Pod ä¸ºè¯¥é¢„è®¾çŠ¶æ€å°±ä¼šè¢«é©±é€ã€‚</li></ul><h6 id="ä½¿ç”¨ç¤ºä¾‹-6"><a href="#ä½¿ç”¨ç¤ºä¾‹-6" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;PodLifeTime&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">podLifeTime:</span><br>         <span class="hljs-attr">maxPodLifeTimeSeconds:</span> <span class="hljs-number">86400</span> <br>         <span class="hljs-attr">podStatusPhases:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;Pending&quot;</span><br></code></pre></td></tr></table></figure><h5 id="8-RemoveFailedPods-ç­–ç•¥"><a href="#8-RemoveFailedPods-ç­–ç•¥" class="headerlink" title="8. RemoveFailedPods ç­–ç•¥"></a>8. RemoveFailedPods ç­–ç•¥</h5><p>è¯¥ç­–ç•¥ä¼šç§»é™¤çŠ¶æ€ä¸º failed çš„ Podã€‚</p><h6 id="ç­–ç•¥ç›¸å…³å‚æ•°-3"><a href="#ç­–ç•¥ç›¸å…³å‚æ•°-3" class="headerlink" title="ç­–ç•¥ç›¸å…³å‚æ•°:"></a>ç­–ç•¥ç›¸å…³å‚æ•°:</h6><ul><li><code>reasons</code>: å¤±è´¥åŸå› åˆ—è¡¨ï¼Œå¯ä»¥æ ¹æ®åˆ—è¡¨ä¸­çš„åŸå› è¿›è¡Œè¿‡æ»¤ï¼Œä»¥è§¦å‘é©±é€</li><li><code>includingInitContainers</code>: ç¡®è®¤ init å®¹å™¨é˜¶æ®µçš„ Pod æ˜¯å¦ä¹ŸåŒ…æ‹¬åœ¨å†…</li><li><code>excludeOwnerKinds</code>: æ§åˆ¶å™¨åˆ—è¡¨ï¼Œå¯ä»¥æ ¹æ®åˆ—è¡¨ä¸­çš„æ§åˆ¶å™¨ç±»å‹è¿›è¡Œè¿‡æ»¤ï¼Œä»¥è§¦å‘é©±é€</li><li><code>minPodLifeTimeSeconds</code>: æŒ‡å®š Pod æœ€å°å­˜æ´»æ´»æ—¶é—´ï¼Œå¦‚æœæ¯”é¢„è®¾çš„æœ€å°å€¼å¤§ï¼Œåˆ™è§¦å‘é©±é€</li></ul><h6 id="ä½¿ç”¨ç¤ºä¾‹-7"><a href="#ä½¿ç”¨ç¤ºä¾‹-7" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹:"></a>ä½¿ç”¨ç¤ºä¾‹:</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">&quot;descheduler/v1alpha1&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;DeschedulerPolicy&quot;</span><br><span class="hljs-attr">strategies:</span><br>  <span class="hljs-attr">&quot;RemoveFailedPods&quot;:</span><br>     <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>     <span class="hljs-attr">params:</span><br>       <span class="hljs-attr">failedPods:</span><br>         <span class="hljs-attr">reasons:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;NodeAffinity&quot;</span><br>         <span class="hljs-attr">includingInitContainers:</span> <span class="hljs-literal">true</span><br>         <span class="hljs-attr">excludeOwnerKinds:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;Job&quot;</span><br>         <span class="hljs-attr">minPodLifeTimeSeconds:</span> <span class="hljs-number">3600</span><br></code></pre></td></tr></table></figure><h4 id="4ï¼‰Pod-çš„é©±é€æœºåˆ¶"><a href="#4ï¼‰Pod-çš„é©±é€æœºåˆ¶" class="headerlink" title="4ï¼‰Pod çš„é©±é€æœºåˆ¶"></a>4ï¼‰Pod çš„é©±é€æœºåˆ¶</h4><p>å½“ <code>Descheduler</code> å†³å®šä»èŠ‚ç‚¹é©±é€ Pod æ—¶ï¼Œä¼šé‡‡ç”¨ä»¥ä¸‹å¸¸è§„æœºåˆ¶:</p><ul><li>é«˜ä¼˜å…ˆåº¦ Podï¼ˆPriorityClassName ä¸º <code>system-cluster-critical</code> å’Œ <code>system-node-critical</code>ï¼‰ä¸ä¼šè¢«é©±é€ï¼ˆé™¤éè®¾ç½®äº† <code>evictSystemCriticalPods: true</code>ï¼‰</li><li>ä¸å±äº RCã€RSã€Deploymentã€Job çš„ Podï¼ˆé™æ€æˆ–é•œåƒ Pod æˆ–ç‹¬ç«‹ Podï¼‰ä¸ä¼šè¢«é©±é€ï¼Œå› ä¸ºä»–ä»¬ä¸ä¼šè‡ªåŠ¨é‡æ–°åˆ›å»ºã€‚</li><li>ä¸ DeamonSets ç›¸å…³çš„ Pod ä¸ä¼šè¢«é©±é€</li><li>æœ‰æœ¬åœ°å­˜å‚¨çš„ Pod ä¸ä¼šè¢«é©±é€ï¼ˆé™¤éè®¾ç½®äº† <code>evictLocalStoragePods: true</code>ï¼‰</li><li>æœ‰ PVC çš„ Pod ä¼šè¢«é©±é€ï¼ˆé™¤éè®¾ç½®äº† <code>ignorePvcPods: true</code>ï¼‰</li><li>ä½¿ç”¨äº† <code>LowNodeUtilization</code> å’Œ <code>RemovePodsViolatingInterPodAntiAffinity</code> ç­–ç•¥ï¼Œä¼šæ ¹æ®ä»–ä»¬çš„ä¼˜å…ˆçº§ä»ä½åˆ°é«˜è¿›è¡Œé©±é€ï¼Œå¦‚æœä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™ä¼šä¾æ® QoS åˆ¤æ–­ï¼Œé¦–å…ˆé©±é€ <code>Best-Effort</code> ä¼˜å…ˆçº§çš„ podï¼Œå†é©±é€ <code>Burstable</code> ä¼˜å…ˆçº§çš„ Podï¼Œæœ€åé©±é€ <code>Guaranteed</code> ä¼˜å…ˆçº§çš„ Podã€‚</li><li>å¸¦æœ‰æ³¨é‡Š <code>descheduler.alpha.kubernetes.io/evict</code> çš„æ‰€æœ‰ç±»å‹çš„ Pod éƒ½ä¼šè¢«é©±é€ã€‚è¯¥æ³¨é‡Šç”¨äºè¦†ç›–é˜²æ­¢é©±é€çš„æ£€æŸ¥ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©é©±é€å“ªä¸ª Podã€‚ç”¨æˆ·åº”è¯¥çŸ¥é“å¦‚ä½•ä»¥åŠæ˜¯å¦å¯ä»¥é‡æ–°åˆ›å»ºå®¹å™¨ã€‚</li><li>è®¾ç½® â€“v=4 æˆ–è€…æ›´å¤§ï¼ŒDescheduler ä¼šåœ¨æ—¥å¿—ä¸­è®°å½•æ‰€æœ‰ pod æ²¡æœ‰è¢«é©±é€çš„åŸå› </li></ul><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong> PDB ä¸ä¼šå— Descheduler æ§åˆ¶ã€‚</p></blockquote><h3 id="2ã€æ–¹æ¡ˆå®æ–½"><a href="#2ã€æ–¹æ¡ˆå®æ–½" class="headerlink" title="2ã€æ–¹æ¡ˆå®æ–½"></a>2ã€æ–¹æ¡ˆå®æ–½</h3><p><code>Descheduler</code> å¯ä»¥åœ¨ K8S é›†ç¾¤ä¸­ä½œä¸º <code>Job</code>ã€<code>CronJob</code> æˆ– <code>Deployment</code>ï¼ˆ0.21åï¼‰ è¿è¡Œã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äºå¯ä»¥å¤šæ¬¡è¿è¡Œè€Œæ— éœ€ç”¨æˆ·è¿›è¡Œå¹²é¢„ã€‚å®ƒçš„ Pod ä¼šåœ¨ <code>kube-system</code> å‘½åç©ºé—´ä¸­ä½œä¸ºå…³é”®å®¹å™¨è¿è¡Œï¼Œä»¥é¿å…è¢«è‡ªèº«æˆ–kubeleté€å‡ºã€‚</p><p>æˆ‘è¿™é‡Œå·²ç»æ‰“å¥½äº†é•œåƒï¼Œåœ°å€ä¸º <code>tareya/descheduler:0.9.0</code>ï¼Œåœ¨ä¸‹æ–‡çš„ yaml ä¸­ä¼šä½¿ç”¨ï¼Œå½“ç„¶ç”±äº <code>Descheduler</code> æ›´æ–°æ˜¯é€Ÿåº¦å¾ˆå¿«ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è‡ªè¡Œå‡†å¤‡é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/kubernetes-sigs/descheduler.git &amp;&amp; \<br>cd descheduler &amp;&amp; make image <br></code></pre></td></tr></table></figure><h4 id="1ï¼‰åˆ›å»º-RBAC-æˆæƒ"><a href="#1ï¼‰åˆ›å»º-RBAC-æˆæƒ" class="headerlink" title="1ï¼‰åˆ›å»º RBAC æˆæƒ"></a>1ï¼‰åˆ›å»º RBAC æˆæƒ</h4><p>æ–‡ä»¶è·¯å¾„: <code>~/descheduler/rbac.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-cluster-role</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">rules:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;nodes&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;pods&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;pods/eviction&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>]<br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-sa</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descehduler-cluster-role-binding</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-cluster-role</span><br><span class="hljs-attr">subjects:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-sa</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ›å»º-configmap"><a href="#2ï¼‰åˆ›å»º-configmap" class="headerlink" title="2ï¼‰åˆ›å»º configmap"></a>2ï¼‰åˆ›å»º configmap</h4><p>æ–‡ä»¶è·¯å¾„: <code>~/descheduler/configmap.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-policy-configmap</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">policy.yaml:</span> <span class="hljs-string">|-  </span><br><span class="hljs-string">    apiVersion: descheduler/v1alpha1</span><br><span class="hljs-string">    kind: DeschedulerPolicy</span><br><span class="hljs-string">    strategies:</span><br><span class="hljs-string">      RemoveDuplicates:</span><br><span class="hljs-string">         enabled: false</span><br><span class="hljs-string">      LowNodeUtilization:</span><br><span class="hljs-string">         enabled: true</span><br><span class="hljs-string">         params:</span><br><span class="hljs-string">           nodeResourceUtilizationThresholds:</span><br><span class="hljs-string">             thresholds:</span><br><span class="hljs-string">               memory: 50</span><br><span class="hljs-string">             targetThresholds:</span><br><span class="hljs-string">               memory: 85</span><br><span class="hljs-string">      RemovePodsViolatingInterPodAntiAffinity:</span><br><span class="hljs-string">        enabled: true</span><br><span class="hljs-string">      RemovePodsViolatingNodeAffinity:</span><br><span class="hljs-string">        enabled: true</span><br><span class="hljs-string">        params:</span><br><span class="hljs-string">          nodeAffinityType:</span><br><span class="hljs-string">          - requiredDuringSchedulingIgnoredDuringExecution</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰åˆ›å»ºè®¡åˆ’ä»»åŠ¡å¯¹è±¡"><a href="#3ï¼‰åˆ›å»ºè®¡åˆ’ä»»åŠ¡å¯¹è±¡" class="headerlink" title="3ï¼‰åˆ›å»ºè®¡åˆ’ä»»åŠ¡å¯¹è±¡"></a>3ï¼‰åˆ›å»ºè®¡åˆ’ä»»åŠ¡å¯¹è±¡</h4><p>æ–‡ä»¶è·¯å¾„: <code>~/descheduler/cronjob.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch/v1beta1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CronJob</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">schedule:</span> <span class="hljs-string">&quot;*/30 * * * *&quot;</span><br>  <span class="hljs-attr">jobTemplate:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler</span><br>      <span class="hljs-attr">annotations:</span><br>        <span class="hljs-attr">scheduler.alpha.kubernetes.io/critical-pod:</span> <span class="hljs-string">&quot;true&quot;</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">template:</span><br>        <span class="hljs-attr">spec:</span><br>          <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">descheduler-sa</span><br>          <span class="hljs-attr">containers:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler</span><br>            <span class="hljs-attr">image:</span> <span class="hljs-string">tareya/descheduler:v0.9.0</span><br>            <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/policy-dir</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">policy-volume</span><br>            <span class="hljs-attr">command:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/descheduler</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">--v=4</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">--max-pods-to-evict-per-node=10</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">--policy-config-file=/policy-dir/policy.yaml</span><span class="hljs-comment">#æ­¤å¤„ä¸º&lt;path-to-policy-dir/policy.yaml&gt;æ–‡ä»¶</span><br>          <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">&quot;OnFailure&quot;</span><br>          <span class="hljs-attr">volumes:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">policy-volume</span><br>            <span class="hljs-attr">configMap:</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">descheduler-policy-configmap</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é—®é¢˜è§£å†³æ–¹æ¡ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬6ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸‹ï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC6%E7%AB%A0%E3%80%81Golang-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC6%E7%AB%A0%E3%80%81Golang-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬6ç« ã€Golang-ç½‘ç»œç¼–ç¨‹ï¼ˆä¸‹ï¼‰"><a href="#ç¬¬6ç« ã€Golang-ç½‘ç»œç¼–ç¨‹ï¼ˆä¸‹ï¼‰" class="headerlink" title="ç¬¬6ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸‹ï¼‰"></a>ç¬¬6ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸‹ï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹è¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬5ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸­ï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC5%E7%AB%A0%E3%80%81Golang-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%AD%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC5%E7%AB%A0%E3%80%81Golang-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%AD%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬5ç« ã€Golang-ç½‘ç»œç¼–ç¨‹ï¼ˆä¸­ï¼‰"><a href="#ç¬¬5ç« ã€Golang-ç½‘ç»œç¼–ç¨‹ï¼ˆä¸­ï¼‰" class="headerlink" title="ç¬¬5ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸­ï¼‰"></a>ç¬¬5ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸­ï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹è¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬4ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸Šï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC4%E7%AB%A0%E3%80%81Golang-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC4%E7%AB%A0%E3%80%81Golang-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬4ç« ã€Golang-ç½‘ç»œç¼–ç¨‹ï¼ˆä¸Šï¼‰"><a href="#ç¬¬4ç« ã€Golang-ç½‘ç»œç¼–ç¨‹ï¼ˆä¸Šï¼‰" class="headerlink" title="ç¬¬4ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸Šï¼‰"></a>ç¬¬4ç« ã€Golang ç½‘ç»œç¼–ç¨‹ï¼ˆä¸Šï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹è¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬3ç« ã€Golang å¹¶å‘ç¼–ç¨‹ï¼ˆä¸‹ï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC3%E7%AB%A0%E3%80%81Golang-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC3%E7%AB%A0%E3%80%81Golang-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬3ç« ã€Golang-å¹¶å‘ç¼–ç¨‹ï¼ˆä¸‹ï¼‰"><a href="#ç¬¬3ç« ã€Golang-å¹¶å‘ç¼–ç¨‹ï¼ˆä¸‹ï¼‰" class="headerlink" title="ç¬¬3ç« ã€Golang å¹¶å‘ç¼–ç¨‹ï¼ˆä¸‹ï¼‰"></a>ç¬¬3ç« ã€Golang å¹¶å‘ç¼–ç¨‹ï¼ˆä¸‹ï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹è¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬2ç« ã€Golang å¹¶å‘ç¼–ç¨‹ï¼ˆä¸­ï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC2%E7%AB%A0%E3%80%81Golang-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%AD%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC2%E7%AB%A0%E3%80%81Golang-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%AD%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2ç« ã€Golang-å¹¶å‘ç¼–ç¨‹ï¼ˆä¸­ï¼‰"><a href="#ç¬¬2ç« ã€Golang-å¹¶å‘ç¼–ç¨‹ï¼ˆä¸­ï¼‰" class="headerlink" title="ç¬¬2ç« ã€Golang å¹¶å‘ç¼–ç¨‹ï¼ˆä¸­ï¼‰"></a>ç¬¬2ç« ã€Golang å¹¶å‘ç¼–ç¨‹ï¼ˆä¸­ï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹è¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬1ç« ã€Golang å¹¶å‘ç¼–ç¨‹ï¼ˆä¸Šï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC1%E7%AB%A0%E3%80%81Golang-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC1%E7%AB%A0%E3%80%81Golang-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€Golang-å¹¶å‘ç¼–ç¨‹ï¼ˆä¸Šï¼‰"><a href="#ç¬¬1ç« ã€Golang-å¹¶å‘ç¼–ç¨‹ï¼ˆä¸Šï¼‰" class="headerlink" title="ç¬¬1ç« ã€Golang å¹¶å‘ç¼–ç¨‹ï¼ˆä¸Šï¼‰"></a>ç¬¬1ç« ã€Golang å¹¶å‘ç¼–ç¨‹ï¼ˆä¸Šï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹è¿›é˜¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬10ç« ã€Golang åå°„</title>
    <link href="/2021/10/14/%E7%AC%AC10%E7%AB%A0%E3%80%81Golang-%E5%8F%8D%E5%B0%84/"/>
    <url>/2021/10/14/%E7%AC%AC10%E7%AB%A0%E3%80%81Golang-%E5%8F%8D%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬10ç« ã€Golang-åå°„"><a href="#ç¬¬10ç« ã€Golang-åå°„" class="headerlink" title="ç¬¬10ç« ã€Golang åå°„"></a>ç¬¬10ç« ã€Golang åå°„</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬8ç« ã€Golang æ–‡ä»¶æ“ä½œï¼ˆåŸºç¡€ï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC8%E7%AB%A0%E3%80%81Golang-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC8%E7%AB%A0%E3%80%81Golang-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬8ç« ã€Golang-æ–‡ä»¶æ“ä½œï¼ˆåŸºç¡€ï¼‰"><a href="#ç¬¬8ç« ã€Golang-æ–‡ä»¶æ“ä½œï¼ˆåŸºç¡€ï¼‰" class="headerlink" title="ç¬¬8ç« ã€Golang æ–‡ä»¶æ“ä½œï¼ˆåŸºç¡€ï¼‰"></a>ç¬¬8ç« ã€Golang æ–‡ä»¶æ“ä½œï¼ˆåŸºç¡€ï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬9ç« ã€Golang æ–‡ä»¶æ“ä½œï¼ˆè¿›é˜¶ï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC9%E7%AB%A0%E3%80%81Golang-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%88%E8%BF%9B%E9%98%B6%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC9%E7%AB%A0%E3%80%81Golang-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%88%E8%BF%9B%E9%98%B6%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬9ç« ã€Golang-æ–‡ä»¶æ“ä½œï¼ˆè¿›é˜¶ï¼‰"><a href="#ç¬¬9ç« ã€Golang-æ–‡ä»¶æ“ä½œï¼ˆè¿›é˜¶ï¼‰" class="headerlink" title="ç¬¬9ç« ã€Golang æ–‡ä»¶æ“ä½œï¼ˆè¿›é˜¶ï¼‰"></a>ç¬¬9ç« ã€Golang æ–‡ä»¶æ“ä½œï¼ˆè¿›é˜¶ï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬7ç« ã€Golang æ¥å£</title>
    <link href="/2021/10/14/%E7%AC%AC7%E7%AB%A0%E3%80%81Golang-%E6%8E%A5%E5%8F%A3/"/>
    <url>/2021/10/14/%E7%AC%AC7%E7%AB%A0%E3%80%81Golang-%E6%8E%A5%E5%8F%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬7ç« ã€Golang-æ¥å£"><a href="#ç¬¬7ç« ã€Golang-æ¥å£" class="headerlink" title="ç¬¬7ç« ã€Golang æ¥å£"></a>ç¬¬7ç« ã€Golang æ¥å£</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬6ç« ã€Golang ç»“æ„ä½“</title>
    <link href="/2021/10/14/%E7%AC%AC6%E7%AB%A0%E3%80%81Golang-%E7%BB%93%E6%9E%84%E4%BD%93/"/>
    <url>/2021/10/14/%E7%AC%AC6%E7%AB%A0%E3%80%81Golang-%E7%BB%93%E6%9E%84%E4%BD%93/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬6ç« ã€Golang-ç»“æ„ä½“"><a href="#ç¬¬6ç« ã€Golang-ç»“æ„ä½“" class="headerlink" title="ç¬¬6ç« ã€Golang ç»“æ„ä½“"></a>ç¬¬6ç« ã€Golang ç»“æ„ä½“</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬5ç« ã€Golang å‡½æ•°</title>
    <link href="/2021/10/14/%E7%AC%AC5%E7%AB%A0%E3%80%81Golang-%E5%87%BD%E6%95%B0/"/>
    <url>/2021/10/14/%E7%AC%AC5%E7%AB%A0%E3%80%81Golang-%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬5ç« ã€Golang-å‡½æ•°"><a href="#ç¬¬5ç« ã€Golang-å‡½æ•°" class="headerlink" title="ç¬¬5ç« ã€Golang å‡½æ•°"></a>ç¬¬5ç« ã€Golang å‡½æ•°</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬4ç« ã€Golang æ•°æ®ç±»å‹ï¼ˆè¿›é˜¶ï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC4%E7%AB%A0%E3%80%81Golang-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%88%E8%BF%9B%E9%98%B6%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC4%E7%AB%A0%E3%80%81Golang-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%88%E8%BF%9B%E9%98%B6%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬4ç« ã€Golang-æ•°æ®ç±»å‹ï¼ˆè¿›é˜¶ï¼‰"><a href="#ç¬¬4ç« ã€Golang-æ•°æ®ç±»å‹ï¼ˆè¿›é˜¶ï¼‰" class="headerlink" title="ç¬¬4ç« ã€Golang æ•°æ®ç±»å‹ï¼ˆè¿›é˜¶ï¼‰"></a>ç¬¬4ç« ã€Golang æ•°æ®ç±»å‹ï¼ˆè¿›é˜¶ï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬3ç« ã€Golang æ•°æ®ç±»å‹ï¼ˆåŸºç¡€ï¼‰</title>
    <link href="/2021/10/14/%E7%AC%AC3%E7%AB%A0%E3%80%81Golang-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89/"/>
    <url>/2021/10/14/%E7%AC%AC3%E7%AB%A0%E3%80%81Golang-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬3ç« ã€Golang-æ•°æ®ç±»å‹ï¼ˆåŸºç¡€ï¼‰"><a href="#ç¬¬3ç« ã€Golang-æ•°æ®ç±»å‹ï¼ˆåŸºç¡€ï¼‰" class="headerlink" title="ç¬¬3ç« ã€Golang æ•°æ®ç±»å‹ï¼ˆåŸºç¡€ï¼‰"></a>ç¬¬3ç« ã€Golang æ•°æ®ç±»å‹ï¼ˆåŸºç¡€ï¼‰</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬2ç« ã€Golang åŒ…ç®¡ç†</title>
    <link href="/2021/10/14/%E7%AC%AC2%E7%AB%A0%E3%80%81Golang-%E5%8C%85%E7%AE%A1%E7%90%86/"/>
    <url>/2021/10/14/%E7%AC%AC2%E7%AB%A0%E3%80%81Golang-%E5%8C%85%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2ç« ã€Golang-åŒ…ç®¡ç†"><a href="#ç¬¬2ç« ã€Golang-åŒ…ç®¡ç†" class="headerlink" title="ç¬¬2ç« ã€Golang åŒ…ç®¡ç†"></a>ç¬¬2ç« ã€Golang åŒ…ç®¡ç†</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬4ç« ã€Python è£…é¥°å™¨</title>
    <link href="/2021/10/13/%E7%AC%AC4%E7%AB%A0%E3%80%81Python-%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
    <url>/2021/10/13/%E7%AC%AC4%E7%AB%A0%E3%80%81Python-%E8%A3%85%E9%A5%B0%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬4ç« ã€Python-è£…é¥°å™¨"><a href="#ç¬¬4ç« ã€Python-è£…é¥°å™¨" class="headerlink" title="ç¬¬4ç« ã€Python è£…é¥°å™¨"></a>ç¬¬4ç« ã€Python è£…é¥°å™¨</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python å‡½æ•°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬3ç« ã€Python å†…ç½®å‡½æ•°ã€åŒ¿åå‡½æ•°</title>
    <link href="/2021/10/13/%E7%AC%AC3%E7%AB%A0%E3%80%81Python-%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E3%80%81%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0/"/>
    <url>/2021/10/13/%E7%AC%AC3%E7%AB%A0%E3%80%81Python-%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E3%80%81%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬3ç« ã€Python-å†…ç½®å‡½æ•°ã€åŒ¿åå‡½æ•°"><a href="#ç¬¬3ç« ã€Python-å†…ç½®å‡½æ•°ã€åŒ¿åå‡½æ•°" class="headerlink" title="ç¬¬3ç« ã€Python å†…ç½®å‡½æ•°ã€åŒ¿åå‡½æ•°"></a>ç¬¬3ç« ã€Python å†…ç½®å‡½æ•°ã€åŒ¿åå‡½æ•°</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python å‡½æ•°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬2ç« ã€Python è¿­ä»£å™¨ã€ç”Ÿæˆå™¨</title>
    <link href="/2021/10/13/%E7%AC%AC2%E7%AB%A0%E3%80%81Python-%E8%BF%AD%E4%BB%A3%E5%99%A8%E3%80%81%E7%94%9F%E6%88%90%E5%99%A8/"/>
    <url>/2021/10/13/%E7%AC%AC2%E7%AB%A0%E3%80%81Python-%E8%BF%AD%E4%BB%A3%E5%99%A8%E3%80%81%E7%94%9F%E6%88%90%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2ç« ã€Python-è¿­ä»£å™¨ã€ç”Ÿæˆå™¨"><a href="#ç¬¬2ç« ã€Python-è¿­ä»£å™¨ã€ç”Ÿæˆå™¨" class="headerlink" title="ç¬¬2ç« ã€Python è¿­ä»£å™¨ã€ç”Ÿæˆå™¨"></a>ç¬¬2ç« ã€Python è¿­ä»£å™¨ã€ç”Ÿæˆå™¨</h1><span id="more"></span><h2 id="ä¸€ã€è¿­ä»£å™¨-â€”â€”-Iterator"><a href="#ä¸€ã€è¿­ä»£å™¨-â€”â€”-Iterator" class="headerlink" title="ä¸€ã€è¿­ä»£å™¨ â€”â€” Iterator"></a>ä¸€ã€è¿­ä»£å™¨ â€”â€” Iterator</h2><h3 id="1ã€å…³äºå¯è¿­ä»£çš„å¯¹è±¡"><a href="#1ã€å…³äºå¯è¿­ä»£çš„å¯¹è±¡" class="headerlink" title="1ã€å…³äºå¯è¿­ä»£çš„å¯¹è±¡"></a>1ã€å…³äºå¯è¿­ä»£çš„å¯¹è±¡</h3><h4 id="1ï¼‰ä»€ä¹ˆæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Ÿ"><a href="#1ï¼‰ä»€ä¹ˆæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Ÿ" class="headerlink" title="1ï¼‰ä»€ä¹ˆæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Ÿ"></a>1ï¼‰ä»€ä¹ˆæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Ÿ</h4><p>æˆ‘ä»¬çŸ¥é“ï¼ŒPython ä¸­ä¸€åˆ‡çš†å¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡å°±æ˜¯ä¸€ä¸ªå®ä¾‹ï¼›è€Œå…³äºè¿­ä»£ï¼Œæ„åœ¨å¯é‡å¤æ€§ï¼Œæˆ‘ä»¬å¹³æ—¶æœ€å¸¸è¯´å°±æ˜¯ç‰ˆæœ¬è¿­ä»£ï¼Œè¿™æ˜¯ä¸€ä¸ªåå¤çš„è¿‡ç¨‹ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡çš„é‡å¤åˆä¼šè·å¾—ä¸å°½ç›¸åŒçš„ç»“æœã€‚é‚£ä¹ˆå°±å­—é¢æ„æ€æ¥è¯´ï¼Œå¯è¿­ä»£å¯¹è±¡å°±æ˜¯ä¸ªåå¤è·å–ç»“æœçš„å¯¹è±¡ï¼Œä¹Ÿå°±å¯åå¤å–å€¼çš„å¯¹è±¡ã€‚</p><p><strong>é€šä¿—çš„è¯´ï¼Œåœ¨ Python ä¸­ï¼Œå‡¡æ˜¯å†…éƒ¨å«æœ‰ _<em>iter</em>_ æ–¹æ³•çš„å¯¹è±¡éƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚</strong> å¦‚ï¼Œstrã€listã€tupleã€dicã€setã€rangeã€æ–‡ä»¶å¥æŸ„ç­‰ã€‚</p><h4 id="2ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå¯è¿­ä»£å¯¹è±¡"><a href="#2ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå¯è¿­ä»£å¯¹è±¡" class="headerlink" title="2ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå¯è¿­ä»£å¯¹è±¡"></a>2ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå¯è¿­ä»£å¯¹è±¡</h4><h5 id="1-æŸ¥çœ‹å¯¹è±¡å†…éƒ¨æ–¹æ³•"><a href="#1-æŸ¥çœ‹å¯¹è±¡å†…éƒ¨æ–¹æ³•" class="headerlink" title="1. æŸ¥çœ‹å¯¹è±¡å†…éƒ¨æ–¹æ³•"></a>1. æŸ¥çœ‹å¯¹è±¡å†…éƒ¨æ–¹æ³•</h5><blockquote><p>ğŸš© é™¤äº†æŸ¥çœ‹æºç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ dir() æ–¹æ³•å»åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„å…·ä½“æ–¹æ³•</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">str1 = <span class="hljs-string">&quot;Tareya&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">dir</span>(str1))<br></code></pre></td></tr></table></figure><p>è¿”å›å€¼ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­å«æœ‰è¯¥å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•åï¼Œå¯ä»¥çœ‹å‡º str å¯¹è±¡æ˜¯æœ‰ <code>__iter__</code> æ–¹æ³•çš„:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">[<span class="hljs-string">&#x27;__add__&#x27;</span>, <span class="hljs-string">&#x27;__class__&#x27;</span>, <span class="hljs-string">&#x27;__contains__&#x27;</span>, <span class="hljs-string">&#x27;__delattr__&#x27;</span>, <span class="hljs-string">&#x27;__dir__&#x27;</span>, <span class="hljs-string">&#x27;__doc__&#x27;</span>, <span class="hljs-string">&#x27;__eq__&#x27;</span>, <span class="hljs-string">&#x27;__format__&#x27;</span>, <span class="hljs-string">&#x27;__ge__&#x27;</span>, <span class="hljs-string">&#x27;__getattribute__&#x27;</span>, <span class="hljs-string">&#x27;__getitem__&#x27;</span>, <span class="hljs-string">&#x27;__getnewargs__&#x27;</span>, <span class="hljs-string">&#x27;__gt__&#x27;</span>, <span class="hljs-string">&#x27;__hash__&#x27;</span>, <span class="hljs-string">&#x27;__init__&#x27;</span>, <span class="hljs-string">&#x27;__init_subclass__&#x27;</span>, <span class="hljs-string">&#x27;__iter__&#x27;</span>, <span class="hljs-string">&#x27;__le__&#x27;</span>, <span class="hljs-string">&#x27;__len__&#x27;</span>, <span class="hljs-string">&#x27;__lt__&#x27;</span>, <span class="hljs-string">&#x27;__mod__&#x27;</span>, <span class="hljs-string">&#x27;__mul__&#x27;</span>, <span class="hljs-string">&#x27;__ne__&#x27;</span>, <span class="hljs-string">&#x27;__new__&#x27;</span>, <span class="hljs-string">&#x27;__reduce__&#x27;</span>, <span class="hljs-string">&#x27;__reduce_ex__&#x27;</span>, <span class="hljs-string">&#x27;__repr__&#x27;</span>, <span class="hljs-string">&#x27;__rmod__&#x27;</span>, <span class="hljs-string">&#x27;__rmul__&#x27;</span>, <span class="hljs-string">&#x27;__setattr__&#x27;</span>, <span class="hljs-string">&#x27;__sizeof__&#x27;</span>, <span class="hljs-string">&#x27;__str__&#x27;</span>, <span class="hljs-string">&#x27;__subclasshook__&#x27;</span>, <span class="hljs-string">&#x27;capitalize&#x27;</span>, <span class="hljs-string">&#x27;casefold&#x27;</span>, <span class="hljs-string">&#x27;center&#x27;</span>, <span class="hljs-string">&#x27;count&#x27;</span>, <span class="hljs-string">&#x27;encode&#x27;</span>, <span class="hljs-string">&#x27;endswith&#x27;</span>, <span class="hljs-string">&#x27;expandtabs&#x27;</span>, <span class="hljs-string">&#x27;find&#x27;</span>, <span class="hljs-string">&#x27;format&#x27;</span>, <span class="hljs-string">&#x27;format_map&#x27;</span>, <span class="hljs-string">&#x27;index&#x27;</span>, <span class="hljs-string">&#x27;isalnum&#x27;</span>, <span class="hljs-string">&#x27;isalpha&#x27;</span>, <span class="hljs-string">&#x27;isascii&#x27;</span>, <span class="hljs-string">&#x27;isdecimal&#x27;</span>, <span class="hljs-string">&#x27;isdigit&#x27;</span>, <span class="hljs-string">&#x27;isidentifier&#x27;</span>, <span class="hljs-string">&#x27;islower&#x27;</span>, <span class="hljs-string">&#x27;isnumeric&#x27;</span>, <span class="hljs-string">&#x27;isprintable&#x27;</span>, <span class="hljs-string">&#x27;isspace&#x27;</span>, <span class="hljs-string">&#x27;istitle&#x27;</span>, <span class="hljs-string">&#x27;isupper&#x27;</span>, <span class="hljs-string">&#x27;join&#x27;</span>, <span class="hljs-string">&#x27;ljust&#x27;</span>, <span class="hljs-string">&#x27;lower&#x27;</span>, <span class="hljs-string">&#x27;lstrip&#x27;</span>, <span class="hljs-string">&#x27;maketrans&#x27;</span>, <span class="hljs-string">&#x27;partition&#x27;</span>, <span class="hljs-string">&#x27;replace&#x27;</span>, <span class="hljs-string">&#x27;rfind&#x27;</span>, <span class="hljs-string">&#x27;rindex&#x27;</span>, <span class="hljs-string">&#x27;rjust&#x27;</span>, <span class="hljs-string">&#x27;rpartition&#x27;</span>, <span class="hljs-string">&#x27;rsplit&#x27;</span>, <span class="hljs-string">&#x27;rstrip&#x27;</span>, <span class="hljs-string">&#x27;split&#x27;</span>, <span class="hljs-string">&#x27;splitlines&#x27;</span>, <span class="hljs-string">&#x27;startswith&#x27;</span>, <span class="hljs-string">&#x27;strip&#x27;</span>, <span class="hljs-string">&#x27;swapcase&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;translate&#x27;</span>, <span class="hljs-string">&#x27;upper&#x27;</span>, <span class="hljs-string">&#x27;zfill&#x27;</span>]<br></code></pre></td></tr></table></figure><h5 id="2-åˆ¤æ–­å¯è¿­ä»£å¯¹è±¡çš„æ–¹æ³•"><a href="#2-åˆ¤æ–­å¯è¿­ä»£å¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="2. åˆ¤æ–­å¯è¿­ä»£å¯¹è±¡çš„æ–¹æ³•"></a>2. åˆ¤æ–­å¯è¿­ä»£å¯¹è±¡çš„æ–¹æ³•</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">str1 = <span class="hljs-string">&quot;Tareya&quot;</span><br>num1 = <span class="hljs-number">20</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__iter__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(num1))<span class="hljs-comment"># è¿”å› Falseï¼Œæ–¹æ³•åˆ—è¡¨ä¸­æ²¡æœ‰ __iter__</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__iter__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(str1))<span class="hljs-comment"># è¿”å› True,æ–¹æ³•åˆ—è¡¨ä¸­æœ‰ __iter__</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰å¯è¿­ä»£å¯¹è±¡çš„ä¼˜ç¼ºç‚¹"><a href="#3ï¼‰å¯è¿­ä»£å¯¹è±¡çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="3ï¼‰å¯è¿­ä»£å¯¹è±¡çš„ä¼˜ç¼ºç‚¹"></a>3ï¼‰å¯è¿­ä»£å¯¹è±¡çš„ä¼˜ç¼ºç‚¹</h4><h5 id="1-ä¼˜ç‚¹"><a href="#1-ä¼˜ç‚¹" class="headerlink" title="1. ä¼˜ç‚¹"></a>1. ä¼˜ç‚¹</h5><ul><li>å¯ä»¥ç›´è§‚çš„æŸ¥çœ‹é‡Œé¢çš„æ•°æ®</li></ul><h5 id="2-ç¼ºç‚¹"><a href="#2-ç¼ºç‚¹" class="headerlink" title="2. ç¼ºç‚¹"></a>2. ç¼ºç‚¹</h5><ul><li>å ç”¨å†…å­˜</li><li>ä¸èƒ½è¿­ä»£å–å€¼ï¼ˆé™¤å»ç´¢å¼•ã€key ä»¥å¤–ï¼‰</li></ul><h3 id="2ã€å…³äºè¿­ä»£å™¨"><a href="#2ã€å…³äºè¿­ä»£å™¨" class="headerlink" title="2ã€å…³äºè¿­ä»£å™¨"></a>2ã€å…³äºè¿­ä»£å™¨</h3><h4 id="1ï¼‰ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ"><a href="#1ï¼‰ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ" class="headerlink" title="1ï¼‰ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ"></a>1ï¼‰ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ</h4><p>è¿­ä»£å™¨æ˜¯ç”¨äºè®¿é—®å¯è¿­ä»£å¯¹è±¡çš„å·¥å…·ï¼Œå®ƒå®ç°äº†æ— å‚æ•°çš„ _<em>next</em>_ æ–¹æ³•ï¼Œç”¨äºè¿”å›åºåˆ—ä¸­ä¸‹ä¸€å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ äº†å°±ä¼šæŠ›å‡º <code>StopIteration</code> å¼‚å¸¸ã€‚Python ä¸­çš„è¿­ä»£å™¨è¿˜å®ç°äº† __iter__ æ–¹æ³•ï¼Œå¯ä»¥ä»å¯è¿­ä»£å¯¹è±¡ä¸­è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚</p><p><strong>é€šä¿—çš„è¯´ï¼Œåœ¨ python ä¸­ï¼Œå†…éƒ¨å«æœ‰ __Iter__ æ–¹æ³•å¹¶ä¸”å«æœ‰ __next__ æ–¹æ³•çš„å¯¹è±¡å°±æ˜¯è¿­ä»£å™¨ã€‚</strong></p><h4 id="2ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºè¿­ä»£å™¨"><a href="#2ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºè¿­ä»£å™¨" class="headerlink" title="2ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºè¿­ä»£å™¨"></a>2ï¼‰åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºè¿­ä»£å™¨</h4><h5 id="1-åˆ¤æ–­-str-list-tuple-dict-set-range-æ–‡ä»¶å¥æŸ„-ä¸­å“ªäº›æ˜¯è¿­ä»£å™¨"><a href="#1-åˆ¤æ–­-str-list-tuple-dict-set-range-æ–‡ä»¶å¥æŸ„-ä¸­å“ªäº›æ˜¯è¿­ä»£å™¨" class="headerlink" title="1. åˆ¤æ–­ str list tuple dict set range æ–‡ä»¶å¥æŸ„ ä¸­å“ªäº›æ˜¯è¿­ä»£å™¨"></a>1. åˆ¤æ–­ str list tuple dict set range æ–‡ä»¶å¥æŸ„ ä¸­å“ªäº›æ˜¯è¿­ä»£å™¨</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">obj1 = <span class="hljs-string">&#x27;Tareya&#x27;</span><br>obj2 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]<br>obj3 = (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)<br>obj4 = &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;Tareya&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">18</span>&#125;<br>obj5 = &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>&#125;<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;file&#x27;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>,mode=<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__iter__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj1))  <span class="hljs-comment"># True</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__iter__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj2))<span class="hljs-comment"># True</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__iter__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj3))<span class="hljs-comment"># True</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__iter__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj4))<span class="hljs-comment"># True</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__iter__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj5))<span class="hljs-comment"># True</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__iter__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(f))<span class="hljs-comment"># True</span><br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__next__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj1))<span class="hljs-comment"># False</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__next__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj2))<span class="hljs-comment"># False</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__next__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj3))<span class="hljs-comment"># False</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__next__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj4))<span class="hljs-comment"># False</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__next__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(obj5))<span class="hljs-comment"># False</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;__next__&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>(f))<span class="hljs-comment"># True</span><br>f.close()<br></code></pre></td></tr></table></figure><blockquote><p>ğŸš© ç»åˆ¤æ–­ï¼Œåªæœ‰æ–‡ä»¶å¥æŸ„æ˜¯è¿­ä»£å™¨ï¼Œå‰©ä¸‹çš„æ•°æ®ç±»å‹éƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚</p></blockquote><h5 id="2-å¯è¿­ä»£å¯¹è±¡è½¬åŒ–è¿­ä»£å™¨çš„æ–¹æ³•"><a href="#2-å¯è¿­ä»£å¯¹è±¡è½¬åŒ–è¿­ä»£å™¨çš„æ–¹æ³•" class="headerlink" title="2. å¯è¿­ä»£å¯¹è±¡è½¬åŒ–è¿­ä»£å™¨çš„æ–¹æ³•"></a>2. å¯è¿­ä»£å¯¹è±¡è½¬åŒ–è¿­ä»£å™¨çš„æ–¹æ³•</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">list1 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]<br>obj   = list1.__iter__()<br><span class="hljs-built_in">print</span>(obj)<span class="hljs-comment"># &lt;list_iterator object at 0x7fc8456d1100&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">print(iter(list1))# &lt;list_iterator object at 0x7fc84491bfd0&gt;<br></code></pre></td></tr></table></figure><h5 id="3-è¿­ä»£å™¨å–å€¼"><a href="#3-è¿­ä»£å™¨å–å€¼" class="headerlink" title="3. è¿­ä»£å™¨å–å€¼"></a>3. è¿­ä»£å™¨å–å€¼</h5><blockquote><p>ğŸš© è¿­ä»£å™¨ä½¿ç”¨ _<em>next</em>_() æ–¹æ³•å–å€¼ï¼Œä¸€ä¸ª next å¯¹åº”ä¸€ä¸ªå–å‡ºçš„å€¼ï¼Œå¦‚æœè¿­ä»£å™¨é‡Œé¢çš„å€¼å–å®Œäº†ï¼Œåˆ™ä¼šæŠ›å‡º <code>StopIteration</code> å¼‚å¸¸ï¼Œä»è€Œåœæ­¢ç»§ç»­è¿­ä»£å–å€¼ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">list1 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]<br>obj   = <span class="hljs-built_in">iter</span>(list1)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(obj))<span class="hljs-comment"># 1</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(obj))<span class="hljs-comment"># 2</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(obj))<span class="hljs-comment"># 3</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(obj))<span class="hljs-comment"># 4</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(obj))<span class="hljs-comment"># StopIteration</span><br></code></pre></td></tr></table></figure><h5 id="4-æ¨¡æ‹Ÿ-for-çš„å†…éƒ¨å¾ªç¯æœºåˆ¶"><a href="#4-æ¨¡æ‹Ÿ-for-çš„å†…éƒ¨å¾ªç¯æœºåˆ¶" class="headerlink" title="4. æ¨¡æ‹Ÿ for çš„å†…éƒ¨å¾ªç¯æœºåˆ¶"></a>4. æ¨¡æ‹Ÿ for çš„å†…éƒ¨å¾ªç¯æœºåˆ¶</h5><blockquote><p>ğŸŒˆ <strong>ä¸ºä»€ä¹ˆå¯ä»¥é€šè¿‡ for å¾ªç¯æ–¹å¼å¯¹å¯è¿­ä»£å¯¹è±¡è¿›è¡Œå–å€¼ï¼Ÿ</strong></p><p>for å¾ªç¯çš„å†…éƒ¨æœºåˆ¶æ˜¯å°†å¯è¿­ä»£å¯¹è±¡è½¬åŒ–æˆè¿­ä»£å™¨ï¼Œç„¶åå†åˆ©ç”¨ next è¿›è¡Œå–å€¼ï¼Œæœ€åå†åˆ©ç”¨å¼‚å¸¸å¤„ç†å¤„ç† StopIterationæŠ›å‡ºçš„å¼‚å¸¸ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">set1 = &#123;<span class="hljs-string">&#x27;å¸ˆå‚…&#x27;</span>,<span class="hljs-string">&#x27;æ‚Ÿç©º&#x27;</span>,<span class="hljs-string">&#x27;å…«æˆ’&#x27;</span>,<span class="hljs-string">&#x27;æ²™åƒ§&#x27;</span>&#125;<br><span class="hljs-comment"># 1. å°†å¯è¿­ä»£å¯¹è±¡è½¬åŒ–æˆè¿­ä»£å™¨</span><br>obj  = <span class="hljs-built_in">iter</span>(set1)<br><br><span class="hljs-comment"># 2. åˆ©ç”¨ while å¾ªç¯ï¼Œnext è¿›è¡Œå–å€¼</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br><span class="hljs-comment"># 3. åˆ©ç”¨å¼‚å¸¸å¤„ç†ç»ˆæ­¢å¾ªç¯</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(obj))<br>    <span class="hljs-keyword">except</span> StopIteration:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æŸ¥è¯¢å®Œæ¯•.&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰è¿­ä»£å™¨çš„ä¼˜ç¼ºç‚¹"><a href="#3ï¼‰è¿­ä»£å™¨çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="3ï¼‰è¿­ä»£å™¨çš„ä¼˜ç¼ºç‚¹"></a>3ï¼‰è¿­ä»£å™¨çš„ä¼˜ç¼ºç‚¹</h4><h5 id="1-ä¼˜ç‚¹-1"><a href="#1-ä¼˜ç‚¹-1" class="headerlink" title="1. ä¼˜ç‚¹"></a>1. ä¼˜ç‚¹</h5><ul><li>èŠ‚çœå†…å­˜<ul><li><strong>è¿­ä»£å™¨åœ¨å†…å­˜ä¸­ç›¸å½“äºåªå ä¸€ä¸ªæ•°æ®çš„ç©ºé—´ã€‚æ¯æ¬¡å–å€¼éƒ½ä¸Šä¸€æ¡æ•°æ®ä¼šåœ¨å†…å­˜é‡Šæ”¾ï¼ŒåŠ è½½å½“å‰çš„æ­¤æ¡æ•°æ®ã€‚</strong></li></ul></li><li>æƒ°æ€§æœºåˆ¶<ul><li>next ä¸€æ¬¡åªå–ä¸€ä¸ªå€¼ï¼Œç»ä¸å¤šå–</li></ul></li></ul><h5 id="2-ç¼ºç‚¹-1"><a href="#2-ç¼ºç‚¹-1" class="headerlink" title="2. ç¼ºç‚¹"></a>2. ç¼ºç‚¹</h5><ul><li>ä¸èƒ½ç›´è§‚çš„æŸ¥çœ‹é‡Œé¢çš„æ•°æ®</li><li>å–å€¼çš„æ—¶å€™ä¸èƒ½èµ°å›å¤´è·¯ï¼Œåªèƒ½ä¸€è·¯å‘ä¸‹ï¼ˆå–1é‡Šæ”¾1ï¼‰<ul><li><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211013163304251.png" alt="image-20211013163304251"></li></ul></li></ul><h3 id="3ã€å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨çš„å¯¹æ¯”"><a href="#3ã€å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨çš„å¯¹æ¯”" class="headerlink" title="3ã€å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨çš„å¯¹æ¯”"></a>3ã€å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨çš„å¯¹æ¯”</h3><table><thead><tr><th></th><th>å¯è¿­ä»£å¯¹è±¡</th><th>è¿­ä»£å™¨</th></tr></thead><tbody><tr><td><strong>ä¼˜ç‚¹</strong></td><td>ç§æœ‰çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œæ“ä½œçµæ´»ï¼›æ¯”è¾ƒç›´è§‚ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹å†…éƒ¨æ•°æ®</td><td>èŠ‚çœå†…å­˜ï¼›å¯ä»¥è®°å½•å–å€¼ä½ç½®ï¼›å¯ä»¥ç›´æ¥é€šè¿‡å¾ªç¯ + next() è¿›è¡Œå–å€¼</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>å ç”¨å†…å­˜ï¼›ä¸”ä¸èƒ½ç›´æ¥é€šè¿‡å¾ªç¯è¿­ä»£å–å€¼</td><td>ä¸ç›´è§‚ï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹å†…éƒ¨æ•°æ®ï¼›æ“ä½œæ–¹æ³•å°±æ˜¯å–å€¼ï¼Œæ¯”è¾ƒå•ä¸€</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>ä¾§é‡äºæ•°æ®çš„çµæ´»å¤„ç†ï¼Œå¹¶ä¸”å†…å­˜ç©ºé—´å……è¶³ï¼Œå¯ä»¥å°†æ•°æ®é›†è®¾ç½®ä¸ºå¯è¿­ä»£å¯¹è±¡ã€‚ï¼ˆæ¯”å¦‚åˆ—è¡¨ï¼Œå­—å…¸çš„å¢åˆ æ”¹æŸ¥ï¼Œå­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œæ–¹æ³•ç­‰ï¼‰</td><td>æ•°æ®é‡è¿‡å¤§ï¼Œå¯èƒ½ä¼šæ’‘çˆ†å†…å­˜æˆ–è€…ä¸€èŠ‚çœå†…å­˜ä¸ºéœ€æ±‚ï¼Œå¯ä»¥å°†æ•°æ®é›†è®¾ç½®ä¸ºè¿­ä»£å™¨ã€‚ï¼ˆæ¯”å¦‚ Python å°†æ–‡ä»¶å¥æŸ„è®¾ç½®ä¸ºè¿­ä»£å™¨å°±æ˜¯ä¸ºäº†é¿å…æ–‡ä»¶è¿‡å¤§æ‰“çˆ†å†…å­˜ï¼‰</td></tr></tbody></table><h2 id="äºŒã€ç”Ÿæˆå™¨-â€”â€”-Generator"><a href="#äºŒã€ç”Ÿæˆå™¨-â€”â€”-Generator" class="headerlink" title="äºŒã€ç”Ÿæˆå™¨ â€”â€” Generator"></a>äºŒã€ç”Ÿæˆå™¨ â€”â€” Generator</h2><h3 id="1ã€å…³äºç”Ÿæˆå™¨"><a href="#1ã€å…³äºç”Ÿæˆå™¨" class="headerlink" title="1ã€å…³äºç”Ÿæˆå™¨"></a>1ã€å…³äºç”Ÿæˆå™¨</h3><h4 id="1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ"><a href="#1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ" class="headerlink" title="1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ"></a>1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ</h4><p>ç”Ÿæˆå™¨æ˜¯æŒ‡èƒ½å¤ŸåŠ¨æ€æä¾›æ•°æ®çš„å¯¹è±¡ï¼Œå¹¶ä¸”ç”Ÿæˆå™¨å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚ä½†æ˜¯ä¸è¿­ä»£å™¨ä¸åŒçš„æ˜¯ï¼Œè¿­ä»£å™¨æ˜¯Pythonå·²ç»äº‹å…ˆå®ç°å¥½çš„åŠŸèƒ½ï¼Œç”¨å°±å®Œäº†ï¼ˆæ¯”å¦‚æ–‡ä»¶å¥æŸ„é¢„è®¾ä¸ºè¿­ä»£å™¨ï¼Œiter([1,2,3]) è½¬åŒ–æˆè¿­ä»£å™¨ï¼‰ã€‚è€Œç”Ÿæˆå™¨åˆ™éœ€è¦è‡ªå·±é€šè¿‡ç”Ÿæˆå™¨å‡½æ•°æˆ–ç”Ÿæˆå™¨è¡¨è¾¾å¼è¿›è¡Œæ„å»ºã€‚</p><h4 id="2ï¼‰ç”Ÿæˆå™¨çš„æ„å»ºæ–¹å¼"><a href="#2ï¼‰ç”Ÿæˆå™¨çš„æ„å»ºæ–¹å¼" class="headerlink" title="2ï¼‰ç”Ÿæˆå™¨çš„æ„å»ºæ–¹å¼"></a>2ï¼‰ç”Ÿæˆå™¨çš„æ„å»ºæ–¹å¼</h4><p>Python ä¸­æä¾›äº†ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ¥æ„å»ºç”Ÿæˆå™¨</p><ul><li>é€šè¿‡ç”Ÿæˆå™¨å‡½æ•°æ„å»ºï¼ˆè‡ªå®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼‰</li><li>é€šè¿‡ç”Ÿæˆå™¨è¡¨è¾¾å¼æ„å»º</li><li>é€šè¿‡ Python å†…ç½®å‡½æ•°æˆ–æ¨¡å—æä¾›ï¼ˆPython æä¾›çš„ç”Ÿæˆå™¨å‡½æ•°ï¼‰</li></ul><h3 id="2ã€ç”Ÿæˆå™¨å‡½æ•°"><a href="#2ã€ç”Ÿæˆå™¨å‡½æ•°" class="headerlink" title="2ã€ç”Ÿæˆå™¨å‡½æ•°"></a>2ã€ç”Ÿæˆå™¨å‡½æ•°</h3><h4 id="1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨å‡½æ•°ï¼Ÿ"><a href="#1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨å‡½æ•°ï¼Ÿ" class="headerlink" title="1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨å‡½æ•°ï¼Ÿ"></a>1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨å‡½æ•°ï¼Ÿ</h4><p><strong>é€šä¿—çš„è¯´ï¼Œå«æœ‰ yield è¯­å¥çš„å‡½æ•°å³ç”Ÿæˆå™¨å‡½æ•°ï¼Œæ­¤å‡½æ•°è¢«è°ƒç”¨æ—¶ä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚</strong> </p><h5 id="1-åˆ›å»ºä¸€ä¸ªç®€å•çš„ç”Ÿæˆå™¨å‡½æ•°"><a href="#1-åˆ›å»ºä¸€ä¸ªç®€å•çš„ç”Ÿæˆå™¨å‡½æ•°" class="headerlink" title="1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ç”Ÿæˆå™¨å‡½æ•°"></a>1. åˆ›å»ºä¸€ä¸ªç®€å•çš„ç”Ÿæˆå™¨å‡½æ•°</h5><p>å¦‚ä¸‹åˆ›å»ºä¸€ä¸ªç®€å•çš„ç”Ÿæˆå™¨å‡½æ•°ï¼ˆå®é™…ä¸Šå°±æ˜¯å°†ä¸€ä¸ªæ™®é€šå‡½æ•°çš„ return æ”¹ä¸º yieldï¼‰ï¼Œè°ƒç”¨è¯¥ç”Ÿæˆå™¨å‡½æ•°åˆ™ä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œä¸”è¯¥ç”Ÿæˆå™¨å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ next å¯¹å…¶å¾ªç¯å–å€¼ï¼Œä¸€ä¸ª yield å¯¹åº”ä¸€ä¸ª nextï¼Œå¦‚æœ next æ•°é‡è¶…è¿‡ yield çš„æ•°é‡ï¼Œå°±ä¼šè¿”å› StopIterationã€‚ ï¼ˆå¦‚ä¸‹ä¾‹ï¼Œç”±äº 11 æ˜¯å‡½æ•° print çš„è¾“å‡ºï¼Œè€Œéç”Ÿæˆå™¨å™¨å‡½æ•°æœ¬èº«è¿”å›çš„å€¼ï¼Œæ‰€ä»¥å¾ªç¯æ‰§è¡Œ2æ¬¡ next è¶…è¿‡äº† yield çš„æ•°é‡äº†ï¼Œè¿”å›äº† StopIterationï¼‰</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211013180116144.png" alt="image-20211013180116144"></p><h4 id="2ï¼‰yield-å’Œ-return-çš„åŒºåˆ«"><a href="#2ï¼‰yield-å’Œ-return-çš„åŒºåˆ«" class="headerlink" title="2ï¼‰yield å’Œ return çš„åŒºåˆ«:"></a>2ï¼‰yield å’Œ return çš„åŒºåˆ«:</h4><ul><li><code>return</code>: ä¸€èˆ¬åœ¨å‡½æ•°ä¸­åªä¼šè®¾ç½®ä¸€ä¸ªï¼Œå®ƒçš„ä½œç”¨æ˜¯ç»ˆæ­¢å‡½æ•°å¹¶è¿”å›å‡½æ•°æ‰§è¡Œç»“æœï¼Œç”±äºç»“æœä¼šä¸€æ¬¡æ€§ç”Ÿæˆï¼Œæ‰€ä»¥ä¼šå ç”¨è¾ƒå¤šçš„å†…å­˜ã€‚</li><li><code>yield</code>: å¯ä»¥åœ¨å‡½æ•°ä¸­è®¾ç½®å¤šä¸ªï¼Œå¹¶ä¸ä¼šç»ˆæ­¢å‡½æ•°ã€‚ä½¿ç”¨ next å–å€¼æ—¶ï¼Œä¼šå–å¯¹åº”çš„ yield ç”Ÿæˆçš„ç»“æœã€‚next åœ¨è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°å–å€¼ yield æ—¶ä¼šè®°å½•ä½ç½®ï¼Œå†æ¬¡è°ƒç”¨æ—¶ä¼šè¿”å› yield çš„ä½ç½®ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œå’Œè¿­ä»£å™¨ä¸€æ ·ï¼Œç”Ÿæˆå™¨å‡½æ•°ä¹Ÿåªéœ€å ç”¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”å–1é‡Šæ”¾ 1ï¼Œä»¥æ­¤æ¥èŠ‚çœå†…å­˜èµ„æºã€‚</li></ul><h5 id="ä»¥åƒä¸œè¥¿ä¸¾ä¾‹"><a href="#ä»¥åƒä¸œè¥¿ä¸¾ä¾‹" class="headerlink" title="ä»¥åƒä¸œè¥¿ä¸¾ä¾‹:"></a>ä»¥åƒä¸œè¥¿ä¸¾ä¾‹:</h5><p>ä¸Šé¢è¯´äº†ï¼Œreturn çš„ä½œç”¨æ˜¯å°†å‡½æ•°æ‰§è¡Œçš„ç»“æœè¿”å›ï¼Œå®é™…ä¸Šä»–ä»¬éƒ½è¢«ä¿å­˜åœ¨è¯¥å‡½æ•°çš„å†…å­˜ç©ºé—´å†…äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å‡½æ•°ç”Ÿæˆçš„ç»“æœè¶Šå¤šï¼Œå ç”¨çš„å†…å­˜ç©ºé—´ä¹Ÿå°±è¶Šå¤§ï¼Œå¦‚ä¸‹ï¼Œ30ä¸²ç¾Šè‚‰ä¸²ä¸€ä¸‹å…¨åšå‡ºæ¥æ”¾ç€ï¼Œä½ å¦‚æœåƒä¸å®Œï¼Œå‰©ä¸‹çš„å°±ä¼šç»§ç»­å ç€å†…å­˜ç©ºé—´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">eat</span>():</span><br>    <br>    <span class="hljs-built_in">list</span> = []<br>    <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">31</span>):<br>    <br>        <span class="hljs-built_in">list</span>.append(<span class="hljs-string">&quot;ç¾Šè‚‰ä¸²&quot;</span>+<span class="hljs-built_in">str</span>(i))<br>        <br>        <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span><br><br><br>e = eat()<br><span class="hljs-built_in">print</span>(e)<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211014100235168.png" alt="image-20211014100235168"></p><p>è€Œä½¿ç”¨ yieldï¼Œåªæœ‰å½“ next è°ƒç”¨æ—¶æ‰ä¼šç”Ÿæˆç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯åƒä¸€ä¸ªåŒ…å­ï¼ˆè°ƒ eatï¼‰ï¼Œåšä¸€ä¸ªåŒ…å­ï¼ˆyieldï¼‰ï¼Œå¹¶ä¸”è¿˜ä¼šè®°å½•ä¸Šæ¬¡åƒåˆ°ç¬¬å‡ ä¸ªäº†ï¼ˆnextï¼‰ï¼Œè¿™æ ·å°±æ¯”è¾ƒèŠ‚çœå†…å­˜ç©ºé—´äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">eat</span>():</span><br>    <br>    <span class="hljs-built_in">list</span> = []<br>    <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">31</span>):<br>    <br>        <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;åŒ…å­&quot;</span>+<span class="hljs-built_in">str</span>(i)<br>        <br><br>e = eat()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(e))<br>    <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ—©ä¸Šå…ˆåƒ10ä¸ªï¼Œå‰©ä¸‹çš„ç•™ç€ä¸‹æ¬¡åƒ&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(e))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸­åˆå†åƒ10ä¸ªï¼Œå‰©ä¸‹çš„ç•™ç€ä¸‹æ¬¡åƒ&#x27;</span>)<br><br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(e))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ™šä¸ŠæŠŠå‰©ä¸‹çš„éƒ½åƒäº†&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211014101240667.png" alt="image-20211014101240667"></p><h4 id="3ï¼‰send-æ–¹æ³•"><a href="#3ï¼‰send-æ–¹æ³•" class="headerlink" title="3ï¼‰send æ–¹æ³•"></a>3ï¼‰send æ–¹æ³•</h4><p>æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œnext çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒå•ä¸€ï¼Œå®ƒåªèƒ½ç”¨æ¥è·å– yield ç”Ÿæˆçš„å€¼ï¼Œå¹¶ä¸èƒ½ä¼ é€’å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211014102937726.png" alt="image-20211014102937726"></p><p>å¦‚æœæˆ‘ä»¬èƒ½è¦è¿›è¡Œä¼ å‚ï¼Œå°±éœ€è¦ç”¨åˆ° sendï¼Œå®ƒåŒæ ·ä¹Ÿå¯åƒ next ä¸€æ ·è·å–åˆ° yield çš„å€¼ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å°†å€¼ä¼ ç»™ yieldï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211014103739335.png" alt="image-20211014103739335"></p><blockquote><p>âš ï¸ æ³¨æ„å…ˆè¦ next()ï¼Œè®©æŒ‡é’ˆæŒ‡å‘ yieldï¼Œæ‰èƒ½å®ç°ä¼ å‚ã€‚</p></blockquote><h4 id="4ï¼‰yield-from-æ–¹æ³•"><a href="#4ï¼‰yield-from-æ–¹æ³•" class="headerlink" title="4ï¼‰yield from æ–¹æ³•"></a>4ï¼‰yield from æ–¹æ³•</h4><h3 id="3ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#3ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="3ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>3ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼</h3><h4 id="1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Ÿ"><a href="#1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Ÿ" class="headerlink" title="1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Ÿ"></a>1ï¼‰ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Ÿ</h4>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python å‡½æ•°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬1ç« ã€åˆè¯† Python å‡½æ•°</title>
    <link href="/2021/10/13/%E7%AC%AC1%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Python-%E5%87%BD%E6%95%B0/"/>
    <url>/2021/10/13/%E7%AC%AC1%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Python-%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€åˆè¯†-Python-å‡½æ•°"><a href="#ç¬¬1ç« ã€åˆè¯†-Python-å‡½æ•°" class="headerlink" title="ç¬¬1ç« ã€åˆè¯† Python å‡½æ•°"></a>ç¬¬1ç« ã€åˆè¯† Python å‡½æ•°</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python å‡½æ•°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®åŒ…ä»ç½‘å¡åˆ°åº”ç”¨å±‚è¿‡ç¨‹ç ”ç©¶</title>
    <link href="/2021/10/13/%E6%95%B0%E6%8D%AE%E5%8C%85%E4%BB%8E%E7%BD%91%E5%8D%A1%E5%88%B0%E5%BA%94%E7%94%A8%E5%B1%82%E8%BF%87%E7%A8%8B%E7%A0%94%E7%A9%B6/"/>
    <url>/2021/10/13/%E6%95%B0%E6%8D%AE%E5%8C%85%E4%BB%8E%E7%BD%91%E5%8D%A1%E5%88%B0%E5%BA%94%E7%94%A8%E5%B1%82%E8%BF%87%E7%A8%8B%E7%A0%94%E7%A9%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®åŒ…ä»ç½‘å¡åˆ°åº”ç”¨å±‚è¿‡ç¨‹ç ”ç©¶"><a href="#æ•°æ®åŒ…ä»ç½‘å¡åˆ°åº”ç”¨å±‚è¿‡ç¨‹ç ”ç©¶" class="headerlink" title="æ•°æ®åŒ…ä»ç½‘å¡åˆ°åº”ç”¨å±‚è¿‡ç¨‹ç ”ç©¶"></a>æ•°æ®åŒ…ä»ç½‘å¡åˆ°åº”ç”¨å±‚è¿‡ç¨‹ç ”ç©¶</h1><span id="more"></span><h2 id="1ã€æ•°æ®åŒ…ä»ç½‘å¡åˆ°å†…å­˜"><a href="#1ã€æ•°æ®åŒ…ä»ç½‘å¡åˆ°å†…å­˜" class="headerlink" title="1ã€æ•°æ®åŒ…ä»ç½‘å¡åˆ°å†…å­˜"></a>1ã€æ•°æ®åŒ…ä»ç½‘å¡åˆ°å†…å­˜</h2><h2 id="2ã€å†…å­˜-ç½‘ç»œæ¨¡å—-åè®®æ ˆ"><a href="#2ã€å†…å­˜-ç½‘ç»œæ¨¡å—-åè®®æ ˆ" class="headerlink" title="2ã€å†…å­˜-ç½‘ç»œæ¨¡å—-åè®®æ ˆ"></a>2ã€å†…å­˜-ç½‘ç»œæ¨¡å—-åè®®æ ˆ</h2><h2 id="3ã€è¿›å…¥ä¼ è¾“å±‚"><a href="#3ã€è¿›å…¥ä¼ è¾“å±‚" class="headerlink" title="3ã€è¿›å…¥ä¼ è¾“å±‚"></a>3ã€è¿›å…¥ä¼ è¾“å±‚</h2><h2 id="4ã€è¿›å…¥åº”ç”¨å±‚"><a href="#4ã€è¿›å…¥åº”ç”¨å±‚" class="headerlink" title="4ã€è¿›å…¥åº”ç”¨å±‚"></a>4ã€è¿›å…¥åº”ç”¨å±‚</h2>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux å†…æ ¸åè®®æ ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬13ç« ã€ä¿¡æ¯ç³»ç»Ÿæµ‹è¯•çŸ¥è¯†</title>
    <link href="/2021/09/28/%E7%AC%AC13%E7%AB%A0%E3%80%81%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E6%B5%8B%E8%AF%95%E7%9F%A5%E8%AF%86/"/>
    <url>/2021/09/28/%E7%AC%AC13%E7%AB%A0%E3%80%81%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E6%B5%8B%E8%AF%95%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬13ç« ã€ä¿¡æ¯ç³»ç»Ÿæµ‹è¯•çŸ¥è¯†"><a href="#ç¬¬13ç« ã€ä¿¡æ¯ç³»ç»Ÿæµ‹è¯•çŸ¥è¯†" class="headerlink" title="ç¬¬13ç« ã€ä¿¡æ¯ç³»ç»Ÿæµ‹è¯•çŸ¥è¯†"></a>ç¬¬13ç« ã€ä¿¡æ¯ç³»ç»Ÿæµ‹è¯•çŸ¥è¯†</h1><span id="more"></span><h2 id="ä¸€ã€çŸ¥è¯†ç®¡ç†"><a href="#ä¸€ã€çŸ¥è¯†ç®¡ç†" class="headerlink" title="ä¸€ã€çŸ¥è¯†ç®¡ç†"></a>ä¸€ã€çŸ¥è¯†ç®¡ç†</h2><h3 id="1ã€è½¯ä»¶æµ‹è¯•åˆ†ç±»"><a href="#1ã€è½¯ä»¶æµ‹è¯•åˆ†ç±»" class="headerlink" title="1ã€è½¯ä»¶æµ‹è¯•åˆ†ç±»"></a>1ã€è½¯ä»¶æµ‹è¯•åˆ†ç±»</h3><h4 id="1ï¼‰å•å…ƒæµ‹è¯•ï¼ˆæ¨¡å—æµ‹è¯•ï¼‰"><a href="#1ï¼‰å•å…ƒæµ‹è¯•ï¼ˆæ¨¡å—æµ‹è¯•ï¼‰" class="headerlink" title="1ï¼‰å•å…ƒæµ‹è¯•ï¼ˆæ¨¡å—æµ‹è¯•ï¼‰"></a>1ï¼‰å•å…ƒæµ‹è¯•ï¼ˆæ¨¡å—æµ‹è¯•ï¼‰</h4><h5 id="1-æµ‹è¯•å¯¹è±¡"><a href="#1-æµ‹è¯•å¯¹è±¡" class="headerlink" title="1. æµ‹è¯•å¯¹è±¡"></a>1. æµ‹è¯•å¯¹è±¡</h5><ul><li>ç¨‹åºæ¨¡å—</li><li>è½¯ä»¶æ„ä»¶</li><li>è½¯ä»¶ä¸­çš„ç±»</li></ul><h5 id="2-æµ‹è¯•ç›®çš„"><a href="#2-æµ‹è¯•ç›®çš„" class="headerlink" title="2. æµ‹è¯•ç›®çš„"></a>2. æµ‹è¯•ç›®çš„</h5><ul><li>æ£€æŸ¥æ˜¯å¦æ­£ç¡®åœ°æŒ‰è®¾è®¡è¯´æ˜ä¸­çš„åŠŸèƒ½ã€æ€§èƒ½ã€æ¥å£å’Œå…¶ä»–è®¾è®¡çº¦æŸå®ç°ï¼Œé¢„å…ˆæ£€æŸ¥å¯èƒ½å­˜åœ¨çš„bug</li></ul><p>3.</p><h4 id="2ï¼‰é›†æˆæµ‹è¯•"><a href="#2ï¼‰é›†æˆæµ‹è¯•" class="headerlink" title="2ï¼‰é›†æˆæµ‹è¯•"></a>2ï¼‰é›†æˆæµ‹è¯•</h4><h4 id="3ï¼‰ç¡®è®¤æµ‹è¯•"><a href="#3ï¼‰ç¡®è®¤æµ‹è¯•" class="headerlink" title="3ï¼‰ç¡®è®¤æµ‹è¯•"></a>3ï¼‰ç¡®è®¤æµ‹è¯•</h4><h4 id="4ï¼‰ç³»ç»Ÿæµ‹è¯•"><a href="#4ï¼‰ç³»ç»Ÿæµ‹è¯•" class="headerlink" title="4ï¼‰ç³»ç»Ÿæµ‹è¯•"></a>4ï¼‰ç³»ç»Ÿæµ‹è¯•</h4><h4 id="5ï¼‰é…ç½®é¡¹æµ‹è¯•"><a href="#5ï¼‰é…ç½®é¡¹æµ‹è¯•" class="headerlink" title="5ï¼‰é…ç½®é¡¹æµ‹è¯•"></a>5ï¼‰é…ç½®é¡¹æµ‹è¯•</h4><h4 id="6ï¼‰å›å½’æµ‹è¯•"><a href="#6ï¼‰å›å½’æµ‹è¯•" class="headerlink" title="6ï¼‰å›å½’æµ‹è¯•"></a>6ï¼‰å›å½’æµ‹è¯•</h4><p>ä½œä¸šï¼š</p><p>1ã€è½¯ä»¶æµ‹è¯•å¯åˆ†ä¸ºå“ªäº›ç±»å‹ï¼Ÿ</p><p>2ã€V æ¨¡å‹çš„ç‰¹ç‚¹</p><p>3ã€W æ¨¡å‹çš„ç‰¹ç‚¹</p><p>4ã€åŒºåˆ†ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•å’ŒéªŒæ”¶æµ‹è¯•</p><p>5ã€åŒºåˆ†ä»€ä¹ˆæ˜¯é»‘ç›’æµ‹è¯•ã€ç™½ç›’æµ‹è¯•å’Œç°ç›’æµ‹è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create secret docker-registry regcred \<br>    --docker-server=registry.cn-hangzhou.aliyuncs.com\<br>    --docker-username=turbomedia@qq.com \<br>    --docker-password=PassWord@123 \<br>    --namespace=testing-java<br>    <br>          nodeSelector:<br>        namespaces: &#123;&#123; .Values.image.namespace &#125;&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes kmem å†…å­˜æ³„æ¼é—®é¢˜è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2021/09/27/Kubernetes-kmem-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2021/09/27/Kubernetes-kmem-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-kmem-å†…å­˜æ³„æ¼é—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#Kubernetes-kmem-å†…å­˜æ³„æ¼é—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Kubernetes kmem å†…å­˜æ³„æ¼é—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>Kubernetes kmem å†…å­˜æ³„æ¼é—®é¢˜è§£å†³æ–¹æ¡ˆ</h1><span id="more"></span> <h2 id="ä¸€ã€é—®é¢˜æè¿°"><a href="#ä¸€ã€é—®é¢˜æè¿°" class="headerlink" title="ä¸€ã€é—®é¢˜æè¿°"></a>ä¸€ã€é—®é¢˜æè¿°</h2><p>å½“æˆ‘ä»¬çš„ Kubernetes é›†ç¾¤è¿è¡Œæ—¥ä¹…åï¼Œæœ‰çš„ node ä¼šå‡ºç°æ— æ³•å†æ–°å»º pod çš„æƒ…å†µï¼Œé‡å¯æœåŠ¡å™¨åæ‰å¯ä»¥æ¢å¤æ­£å¸¸ä½¿ç”¨ï¼Œæ¯”è¾ƒå…¸å‹çš„æœ‰å¦‚ä¸‹æƒ…å†µï¼š</p><p>åœ¨ æŸ¥çœ‹ pod çš„æ—¶å€™å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">applying cgroup â€¦ caused: mkdir ...no space left on device<br></code></pre></td></tr></table></figure><p>æˆ–å¦‚ä¸‹æŠ¥é”™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">unable to ensure pod container exists: ...cannot allocate memory<br></code></pre></td></tr></table></figure><p>æˆ– node å†…æ ¸æ—¥å¿—å‡ºç°å¦‚ä¸‹æŠ¥é”™:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SLUB: Unable to allocate memory on node -1<br></code></pre></td></tr></table></figure><p>å½“å‡ºç°å¦‚ä¸Šè¿™ç§æƒ…å†µçš„æ—¶å€™ï¼ŒK8S é›†ç¾¤å¯èƒ½å°±å­˜åœ¨å†…å­˜æ³„éœ²é—®é¢˜äº†ï¼Œå½“åˆ›å»ºçš„ pod è¶Šå¤šçš„æ—¶å€™ï¼Œå†…å­˜æ³„éœ²çš„è¶Šå¤šã€è¶Šå¿«ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥æŸ¥çœ‹é›†ç¾¤æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /sys/fs/cgroup/memory/kubepods/memory.kmem.slabinfo<br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰å†…å­˜æ³„æ¼é—®é¢˜ï¼Œè¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat: /sys/fs/cgroup/memory/kubepods/memory.kmem.slabinfo: Input/output error<br></code></pre></td></tr></table></figure><p>å¦‚æœå­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ï¼Œè¿”å›åˆ™å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">slabinfo - version: 2.1<br><span class="hljs-meta">#</span><span class="bash"> name            &lt;active_objs&gt; &lt;num_objs&gt; &lt;objsize&gt; &lt;objperslab&gt; &lt;pagesperslab&gt; : tunables &lt;<span class="hljs-built_in">limit</span>&gt; &lt;batchcount&gt; &lt;sharedfactor&gt; : slabdata &lt;active_slabs&gt; &lt;num_slabs&gt; &lt;sharedavail&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>ğŸŒˆ äº‹å®ä¸Šï¼Œç»å¤§å¤šæ•°çš„ Kubernetes éƒ½ä¼šå­˜åœ¨è¯¥éšæ‚£ï¼Œåªä¸è¿‡åœ¨ä¸€èˆ¬æƒ…å†µä¸‹å†…å­˜æ³„æ¼å‘ç”Ÿçš„æ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥éš¾ä»¥å¯Ÿè§‰ã€‚ä¸€èˆ¬æ€§æ¥è¯´ï¼Œå³ä½¿ pod ç™¾åˆ†ç™¾å‘ç”Ÿæ³„æ¼ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªèŠ‚ç‚¹é”€æ¯è¿‡ 3w + çš„podï¼Œæ‰ä¼šå¯¼è‡´ pod æ— æ³•ç»§ç»­åˆ›å»ºï¼Œè¿™ç§æƒ…å†µå¦‚æœå‡ºç°äº†ï¼Œé™¤äº†é‡å¯èŠ‚ç‚¹ï¼Œå°±æ²¡æœ‰è§£å†³çš„æ–¹æ³•äº†ã€‚è™½è¯´ï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡ä¸å¤§ï¼Œä½†æ˜¯å½“å†…å­˜æ³„æ¼å‘ç”Ÿæ—¶ï¼Œä¸€ä¸ª pod å¯èƒ½ä¼šæ³„æ¼ 2ä¸ª memory cgroup çš„æ•°é‡é…é¢ï¼Œè¿™æ˜¯éå¸¸å¯æ€•çš„ã€‚å¹¶ä¸”ç”±äºæŸäº›æœåŠ¡æœ¬èº«çš„ç‰¹æ€§ï¼Œé«˜é¢‘ç‡çš„ gcï¼Œå¾€å¾€ä¹Ÿæ˜¯æœ‰å¯èƒ½è¯±å‘å†…å­˜æ³„æ¼äº§ç”Ÿçš„ã€‚</p></blockquote><h2 id="äºŒã€æ ¹å› è¿½æº¯"><a href="#äºŒã€æ ¹å› è¿½æº¯" class="headerlink" title="äºŒã€æ ¹å› è¿½æº¯"></a>äºŒã€æ ¹å› è¿½æº¯</h2><p>å…¶å®è¿™ä¸ªé—®é¢˜åœ¨ pingcap çš„ <a href="https://en.pingcap.com/blog/try-to-fix-two-linux-kernel-bugs-while-testing-tidb-operator-in-k8s">æ–‡ç« </a> å’Œè…¾è®¯äº‘çš„ <a href="https://tencentcloudcontainerteam.github.io/2018/12/29/cgroup-leaking/">å®˜æ–¹ä¿®å¤</a> éƒ½å·²ç»é˜è¿°è¿‡è¯¥é—®é¢˜ã€‚å…¶ä¸»è¦äº§ç”Ÿçš„åŸå› æ˜¯ï¼Œåœ¨ Linux 3.10.x çš„å†…æ ¸ç‰ˆæœ¬ä¸­ï¼Œå…¶ cgroup çš„ kmem account ç‰¹æ€§ï¼ˆCONFIG_MEMCG_KMEMï¼‰å­˜åœ¨å†…å­˜æ³„éœ²çš„ bugã€‚å¦‚æœå¼€å¯äº†è¯¥ç‰¹æ€§ï¼Œå°±ä¼šå¯¼è‡´å¯åˆ†é…çš„å†…å­˜é€æ­¥å‡å°‘ï¼Œç›´åˆ°æ— æ³•åˆ›å»ºæ–°çš„ pod æˆ–èŠ‚ç‚¹å‡ºç°å¼‚å¸¸ã€‚è¯¥é—®é¢˜åœ¨ 4.x çš„å†…æ ¸ç‰ˆæœ¬ä¸­å·²ä¿®å¤ã€‚</p><p>å®˜æ–¹ç»™å‡ºäº†è¯¥å†…æ ¸é—®é¢˜çš„è§£é‡Š:</p><ul><li><a href="https://github.com/torvalds/linux/commit/d6e0b7fa11862433773d986b5f995ffdf47ce672">https://github.com/torvalds/linux/commit/d6e0b7fa11862433773d986b5f995ffdf47ce672</a></li><li><a href="https://support.d2iq.com/s/article/Critical-Issue-KMEM-MSPH-2018-0006">https://support.d2iq.com/s/article/Critical-Issue-KMEM-MSPH-2018-0006</a></li></ul><p>äº‹å®ä¸Šï¼Œ3.10 å†…æ ¸å·²æ˜ç¡®å£°æ˜è¿‡ kmem åªæ˜¯å®éªŒç‰¹æ€§ï¼Œä½†ç”±äºå®ƒæ˜¯ cgroup è‡ªå¸¦çš„æ‰©å±•èƒ½åŠ›ï¼Œæ‰€ä»¥ runcã€dockerã€k8s å±‚é¢éƒ½è¿›è¡Œäº†è¯¥åŠŸèƒ½çš„æ”¯æŒï¼Œä¹Ÿå°±é»˜è®¤æ‰“å¼€äº† kmem å±æ€§ï¼Œä½†æ˜¯åœ¨å…¼å®¹ä¸Šé¢å´å¹¶æ²¡æœ‰åšå¥½ï¼Œæ‰€ä»¥å½“èŠ‚ç‚¹å‹åŠ›å¤§ï¼Œå¦‚é¢‘ç¹å¯åŠ¨å’Œåœæ­¢å®¹å™¨æ—¶å°±ä¼šå¯¼è‡´ cgroup memory leakã€‚</p><p>è¯¥é—®é¢˜ä¹Ÿè¢«è®°å½•åœ¨äº† docker å’Œ kubernetes çš„å®˜æ–¹ issue ä¸­:</p><ul><li><a href="https://github.com/moby/moby/issues/29638">https://github.com/moby/moby/issues/29638</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/70324">https://github.com/kubernetes/kubernetes/issues/70324</a></li></ul><p>ä» 1.13 å¼€å§‹çš„ç‰ˆæœ¬ï¼ŒDocker å°±é»˜è®¤å¯ç”¨äº†è¯¥åŠŸèƒ½ï¼Œä¸”æ— æ³•å…³é—­ï¼Œåªåˆ° 18.09.1 ç‰ˆæœ¬åæ‰ä¿®å¤äº†è¯¥é—®é¢˜ã€‚</p><p>kubelet çš„ vender ä¸­å¼•ç”¨äº† runcï¼Œæ‰€ä»¥ kubelet ä¹Ÿå°±å¼€å¯äº† kmemï¼Œè¦è§£å†³è¯¥é—®é¢˜å°±éœ€è¦ä¿®æ”¹æºç é‡æ–°ç¼–è¯‘ã€‚</p><h2 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h2><h3 id="1ã€æ–¹æ¡ˆä¸€-â€”â€”-å‡çº§å†…æ ¸è‡³-4-x"><a href="#1ã€æ–¹æ¡ˆä¸€-â€”â€”-å‡çº§å†…æ ¸è‡³-4-x" class="headerlink" title="1ã€æ–¹æ¡ˆä¸€ â€”â€” å‡çº§å†…æ ¸è‡³ 4.x"></a>1ã€æ–¹æ¡ˆä¸€ â€”â€” å‡çº§å†…æ ¸è‡³ 4.x</h3><p>æ—¢ç„¶è¿™ä¸ªé—®é¢˜åªä¼šå‡ºç°åœ¨ 3.xï¼Œå¹¶ä¸”åœ¨ 4.x ä¸­è§£å†³äº†ï¼Œé‚£ä¹ˆç›´æ¥å°†å†…æ ¸ç‰ˆæœ¬å‡çº§æ˜¯æœ€ç›´æ¥çš„æ–¹æ³•ï¼Œä½†æ˜¯<strong>åœ¨äº§çº¿ç¯å¢ƒä¸­å¹¶ä¸æ¨è</strong>ã€‚</p><h4 id="1ï¼‰è¯¥æ–¹å¼çš„ç¼ºç‚¹"><a href="#1ï¼‰è¯¥æ–¹å¼çš„ç¼ºç‚¹" class="headerlink" title="1ï¼‰è¯¥æ–¹å¼çš„ç¼ºç‚¹:"></a>1ï¼‰è¯¥æ–¹å¼çš„ç¼ºç‚¹:</h4><ul><li>éœ€è¦å‡çº§æ‰€æœ‰çš„èŠ‚ç‚¹å¹¶é‡å¯ï¼Œé‡å¯å¿…ç„¶ä¼šå¯¼è‡´ pod æ¼‚ç§»ï¼Œæ‰€ä»¥ä¸€æ—¦é›†ç¾¤è§„æ¨¡è¾ƒå¤§è¿™ä¸ªè¿‡ç¨‹å°±ä¼šæ¯”è¾ƒç—›è‹¦ï¼Œä¸”å¯èƒ½å¯¹ä¸šåŠ¡äº§ç”Ÿç›´æ¥çš„å½±å“ï¼Œéœ€è¦äº‹å…ˆäº‰å–ä¸šåŠ¡éƒ¨é—¨åŒæ„</li><li>ä½¿ç”¨å…¬æœ‰äº‘ç¯å¢ƒæ—¶ï¼Œå†…æ ¸ç‰ˆæœ¬çš„å‡çº§å¯èƒ½ä¼šä¸å…¬æœ‰äº‘vmç¯å¢ƒäº§ç”Ÿå†²çªï¼Œéœ€è¦äº‘å•†æœ‰è¶³å¤Ÿçš„è¯„æµ‹ï¼Œè¯æ˜å…¶å¯è¡Œæ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ä¼šå¾ˆé•¿ï¼Œå¹¶ä¸”ä¸ä¸€å®šèƒ½ä¿è¯é—®é¢˜è¢«è§£å†³</li><li>å·²æœ‰ç¯å¢ƒçš„ä»£ç åœ¨ 3.x è¿è¡Œæ­£å¸¸ï¼Œå¹¶ä¸ä»£è¡¨åœ¨ 4.x ä¹Ÿèƒ½æ­£å¸¸ï¼Œåœ¨å…¨é‡å‡çº§å‰è¦åšè¾ƒä¹…çš„å…¼å®¹æ€§æµ‹è¯•ï¼Œå‘¨æœŸå¾ˆé•¿ã€‚</li></ul><h4 id="2ï¼‰å®æ–½æ–¹æ¡ˆ"><a href="#2ï¼‰å®æ–½æ–¹æ¡ˆ" class="headerlink" title="2ï¼‰å®æ–½æ–¹æ¡ˆ"></a>2ï¼‰å®æ–½æ–¹æ¡ˆ</h4><blockquote><p><strong>åœ¨æ­¤ä»…è®°å½•é€šç”¨çš„å‡çº§å†…æ ¸ç‰ˆæœ¬çš„æ–¹æ¡ˆï¼ˆyum æ–¹å¼ï¼‰ä»¥ä¾›å‚è€ƒï¼š</strong></p></blockquote><h5 id="1-æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬"><a href="#1-æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬" class="headerlink" title="1. æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬"></a>1. æŸ¥çœ‹å½“å‰å†…æ ¸ç‰ˆæœ¬</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# uname -r<br>3.10.0-862.el7.x86_64<br></code></pre></td></tr></table></figure><h5 id="2-å®‰è£…-elrepo-çš„-yum-æº"><a href="#2-å®‰è£…-elrepo-çš„-yum-æº" class="headerlink" title="2. å®‰è£… elrepo çš„ yum æº"></a>2. å®‰è£… elrepo çš„ yum æº</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm<br></code></pre></td></tr></table></figure><blockquote><p>å®‰è£…å®Œæˆåæ£€æŸ¥ <code>/boot/grub2/grub</code>.cfg ä¸­å¯¹åº”å†…æ ¸ menuentry ä¸­æ˜¯å¦åŒ…å« initrd16 é…ç½®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†å®‰è£…ä¸€æ¬¡ï¼</p></blockquote><h5 id="3-å®‰è£…å†…æ ¸"><a href="#3-å®‰è£…å†…æ ¸" class="headerlink" title="3. å®‰è£…å†…æ ¸"></a>3. å®‰è£…å†…æ ¸</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# yum --enablerepo=elrepo-kernel install -y kernel-lt<br></code></pre></td></tr></table></figure><blockquote><p>åœ¨ yum çš„ elrepo æºä¸­ï¼Œæœ‰æœ€æ–°ç‰ˆæœ¬çš„å†…æ ¸ï¼Œç›´æ¥ yum å®‰è£…å³å¯</p></blockquote><h5 id="4-è®¾ç½®å¼€æœºä»æ–°å†…æ ¸å¯åŠ¨"><a href="#4-è®¾ç½®å¼€æœºä»æ–°å†…æ ¸å¯åŠ¨" class="headerlink" title="4. è®¾ç½®å¼€æœºä»æ–°å†…æ ¸å¯åŠ¨"></a>4. è®¾ç½®å¼€æœºä»æ–°å†…æ ¸å¯åŠ¨</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# grub2-set-default 0<br></code></pre></td></tr></table></figure><h5 id="5-é‡å¯æœåŠ¡å™¨"><a href="#5-é‡å¯æœåŠ¡å™¨" class="headerlink" title="5. é‡å¯æœåŠ¡å™¨"></a>5. é‡å¯æœåŠ¡å™¨</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# reboot<br></code></pre></td></tr></table></figure><h5 id="6-å®‰è£…å†…æ ¸æºæ–‡ä»¶ï¼ˆåœ¨å‡çº§å®Œå†…æ ¸å¹¶é‡å¯æœºå™¨åæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¸ç”¨æ‰§è¡Œè¿™ä¸€æ­¥ã€‚å¯é€‰ï¼‰"><a href="#6-å®‰è£…å†…æ ¸æºæ–‡ä»¶ï¼ˆåœ¨å‡çº§å®Œå†…æ ¸å¹¶é‡å¯æœºå™¨åæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¸ç”¨æ‰§è¡Œè¿™ä¸€æ­¥ã€‚å¯é€‰ï¼‰" class="headerlink" title="6. å®‰è£…å†…æ ¸æºæ–‡ä»¶ï¼ˆåœ¨å‡çº§å®Œå†…æ ¸å¹¶é‡å¯æœºå™¨åæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¸ç”¨æ‰§è¡Œè¿™ä¸€æ­¥ã€‚å¯é€‰ï¼‰"></a>6. å®‰è£…å†…æ ¸æºæ–‡ä»¶ï¼ˆåœ¨å‡çº§å®Œå†…æ ¸å¹¶é‡å¯æœºå™¨åæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä¸ç”¨æ‰§è¡Œè¿™ä¸€æ­¥ã€‚å¯é€‰ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# yum --enablerepo=elrepo-kernel install kernel-lt-devel-$(uname -r) kernel-lt-headers-$(uname -r)<br></code></pre></td></tr></table></figure><h5 id="7-å†æ¬¡æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬"><a href="#7-å†æ¬¡æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬" class="headerlink" title="7. å†æ¬¡æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬"></a>7. å†æ¬¡æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# uname -r<br>4.4.180-2.el7.elrepo.x86_64<br></code></pre></td></tr></table></figure><h3 id="2ã€æ–¹æ¡ˆäºŒ-â€”â€”-å…³é—­-grub-å¼•å¯¼ä¸­çš„-kmem-é…ç½®"><a href="#2ã€æ–¹æ¡ˆäºŒ-â€”â€”-å…³é—­-grub-å¼•å¯¼ä¸­çš„-kmem-é…ç½®" class="headerlink" title="2ã€æ–¹æ¡ˆäºŒ â€”â€” å…³é—­ grub å¼•å¯¼ä¸­çš„ kmem é…ç½®"></a>2ã€æ–¹æ¡ˆäºŒ â€”â€” å…³é—­ grub å¼•å¯¼ä¸­çš„ kmem é…ç½®</h3><p>å®˜æ–¹æ—©å·²ç”³æ˜è¯¥ç‰¹æ€§ä¸ºå®éªŒç‰¹æ€§ï¼Œå¹¶ä¸æ¨èä½¿ç”¨ï¼Œäº‹å®ä¸Šï¼Œåªè¦ä¸å¼€å¯ kmem accounting å°±ä¸ä¼šå‘å‡º cgroup æ³„æ¼é—®é¢˜ã€‚æ‰€ä»¥å¦ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯å¼€æœºå¼•å¯¼æ—¶å°±ç›´æ¥å…³é—­è¯¥åŠŸèƒ½ï¼Œç¦ç”¨ cgroup çš„ kmem ç‰¹æ€§ã€‚</p><h4 id="1ï¼‰è¯¥æ–¹å¼çš„ç¼ºç‚¹-1"><a href="#1ï¼‰è¯¥æ–¹å¼çš„ç¼ºç‚¹-1" class="headerlink" title="1ï¼‰è¯¥æ–¹å¼çš„ç¼ºç‚¹:"></a>1ï¼‰è¯¥æ–¹å¼çš„ç¼ºç‚¹:</h4><ul><li>ä»ç„¶éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œæ‰€ä»¥å…¶å®å’Œå‡çº§å†…æ ¸æ€§è´¨å·®ä¸å¤š</li><li>è¿™ä¸ªæ–¹å¼å¹¶ä¸èƒ½å…¨å±€ç”Ÿæ•ˆï¼Œæœ‰äº›æœåŠ¡å™¨å¯èƒ½æ— æ³•ç”Ÿæ•ˆ</li></ul><h4 id="2ï¼‰å®æ–½æ–¹æ¡ˆ-1"><a href="#2ï¼‰å®æ–½æ–¹æ¡ˆ-1" class="headerlink" title="2ï¼‰å®æ–½æ–¹æ¡ˆ"></a>2ï¼‰å®æ–½æ–¹æ¡ˆ</h4><blockquote><p><strong>åœ¨æ­¤ä»…è®°å½•æ–¹æ¡ˆä»¥ä¾›å‚è€ƒï¼š</strong></p></blockquote><h5 id="1-ä¿®æ”¹-etc-default-grub-ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹"><a href="#1-ä¿®æ”¹-etc-default-grub-ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹" class="headerlink" title="1. ä¿®æ”¹ /etc/default/grub ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹:"></a>1. ä¿®æ”¹ <code>/etc/default/grub</code> ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">GRUB_CMDLINE_LINUX=&quot;crashkernel=auto net.ifnames=0 biosdevname=0 intel_pstate=disable cgroup.memory=nokmem&quot;<br></code></pre></td></tr></table></figure><blockquote><p>è®¾ç½® <code>cgroup.memory=nokmem</code>ï¼Œç¦ç”¨ kmemã€‚</p></blockquote><h5 id="2-ç”Ÿæˆé…ç½®"><a href="#2-ç”Ÿæˆé…ç½®" class="headerlink" title="2. ç”Ÿæˆé…ç½®"></a>2. ç”Ÿæˆé…ç½®</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# /usr/sbin/grub2-mkconfig -o /boot/grub2/grub.cfg<br></code></pre></td></tr></table></figure><h5 id="3-é‡å¯æœåŠ¡å™¨"><a href="#3-é‡å¯æœåŠ¡å™¨" class="headerlink" title="3. é‡å¯æœåŠ¡å™¨"></a>3. é‡å¯æœåŠ¡å™¨</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# reboot<br></code></pre></td></tr></table></figure><h5 id="4-éªŒè¯"><a href="#4-éªŒè¯" class="headerlink" title="4. éªŒè¯"></a>4. éªŒè¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# cat /sys/fs/cgroup/memory/kubepods/burstable/pod*/*/memory.kmem.slabinfo<br></code></pre></td></tr></table></figure><blockquote><p>æ— è¾“å‡ºå³å¯ã€‚</p></blockquote><h3 id="3ã€æ–¹æ¡ˆä¸‰-â€”â€”-ä»ä½¿ç”¨æ–¹ç»´åº¦å…³é—­-kmem-é…ç½®ï¼ˆæ¨èï¼‰"><a href="#3ã€æ–¹æ¡ˆä¸‰-â€”â€”-ä»ä½¿ç”¨æ–¹ç»´åº¦å…³é—­-kmem-é…ç½®ï¼ˆæ¨èï¼‰" class="headerlink" title="3ã€æ–¹æ¡ˆä¸‰ â€”â€” ä»ä½¿ç”¨æ–¹ç»´åº¦å…³é—­ kmem é…ç½®ï¼ˆæ¨èï¼‰"></a>3ã€æ–¹æ¡ˆä¸‰ â€”â€” ä»ä½¿ç”¨æ–¹ç»´åº¦å…³é—­ kmem é…ç½®ï¼ˆæ¨èï¼‰</h3><p>ä¹‹å‰çš„ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯ä»OSå±‚é¢è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å½’æ ¹ç»“åº•ï¼Œé—®é¢˜å…¶å®æ˜¯å‡ºåœ¨ä½¿ç”¨æ–¹çš„å…¼å®¹æ€§ä¸Šï¼Œæ‰€ä»¥ä»ä½¿ç”¨æ–¹çš„ç»´åº¦å»ç¦ç”¨è¯¥ç‰¹æ€§æ˜¯æ›´åŠ æœ‰æ•ˆçš„ï¼Œè¿™ä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„æ–¹æ³•ï¼Œå¹¶ä¹Ÿç»™å‡ºäº†è§£å†³æ–¹å¼ã€‚</p><h4 id="1ï¼‰å¯¹äº-Docker"><a href="#1ï¼‰å¯¹äº-Docker" class="headerlink" title="1ï¼‰å¯¹äº Docker"></a>1ï¼‰å¯¹äº Docker</h4><p>é’ˆå¯¹ Dokcer æ—¢ç„¶å®˜æ–¹å·²ç»è§£å†³äº†è¯¥å…¼å®¹æ€§é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å®‰è£… Docker æ—¶å®‰è£…é«˜äº 18.09.1 çš„ç‰ˆæœ¬å³å¯ï¼ˆæˆ–å‡çº§ï¼‰ã€‚</p><h4 id="2ï¼‰å¯¹äº-runc-å®˜æ–¹é’ˆå¯¹è¿™ä¸ªé—®é¢˜åšäº†æ¯”è¾ƒçµæ´»çš„ä¿®å¤ï¼Œé€šè¿‡-BUILDTAGS-çš„æ–¹å¼é‡æ–°ç¼–è¯‘å³å¯ï¼Œæ–¹æ³•å¦‚ä¸‹"><a href="#2ï¼‰å¯¹äº-runc-å®˜æ–¹é’ˆå¯¹è¿™ä¸ªé—®é¢˜åšäº†æ¯”è¾ƒçµæ´»çš„ä¿®å¤ï¼Œé€šè¿‡-BUILDTAGS-çš„æ–¹å¼é‡æ–°ç¼–è¯‘å³å¯ï¼Œæ–¹æ³•å¦‚ä¸‹" class="headerlink" title="2ï¼‰å¯¹äº runc å®˜æ–¹é’ˆå¯¹è¿™ä¸ªé—®é¢˜åšäº†æ¯”è¾ƒçµæ´»çš„ä¿®å¤ï¼Œé€šè¿‡ BUILDTAGS çš„æ–¹å¼é‡æ–°ç¼–è¯‘å³å¯ï¼Œæ–¹æ³•å¦‚ä¸‹"></a>2ï¼‰å¯¹äº runc å®˜æ–¹é’ˆå¯¹è¿™ä¸ªé—®é¢˜åšäº†æ¯”è¾ƒçµæ´»çš„ä¿®å¤ï¼Œé€šè¿‡ BUILDTAGS çš„æ–¹å¼é‡æ–°ç¼–è¯‘å³å¯ï¼Œæ–¹æ³•å¦‚ä¸‹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd $GO_PATH/src/github.com/opencontainers/runc/<br>make BUILDTAGS=&quot;seccomp nokmem&quot;<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰å¯¹äº-kubelet"><a href="#3ï¼‰å¯¹äº-kubelet" class="headerlink" title="3ï¼‰å¯¹äº kubelet"></a>3ï¼‰å¯¹äº kubelet</h4><p>é’ˆå¯¹ kubelet  ï¼Œå®˜æ–¹ issue ç»™å‡ºçš„è§£å†³æ–¹å¼æ˜¯è‡ªè¡Œé‡æ–°ç¼–è¯‘ kubelet æ¥è§£å†³ã€‚</p><h5 id="1-v1-13-åŠä»¥å‰ç‰ˆæœ¬çš„-kubelet"><a href="#1-v1-13-åŠä»¥å‰ç‰ˆæœ¬çš„-kubelet" class="headerlink" title="1. v1.13 åŠä»¥å‰ç‰ˆæœ¬çš„ kubelet"></a>1. v1.13 åŠä»¥å‰ç‰ˆæœ¬çš„ kubelet</h5><p>ä¿®æ”¹æºç ï¼Œæ–‡ä»¶è·¯å¾„: <code>vendor/github.com/opencontainers/runc/libcontainer/cgroups/fs/memory.go</code>ï¼Œæ›¿æ¢ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">EnableKernelMemoryAccounting</span><span class="hljs-params">(path <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">error</span></span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setKernelMemory</span><span class="hljs-params">(path <span class="hljs-keyword">string</span>, kernelMemoryLimit <span class="hljs-keyword">int64</span>)</span> <span class="hljs-title">error</span></span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åé‡æ–°ç¼–è¯‘ kubeletï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make WHAT=cmd/kubelet GOFLAGS=-v GOGCFLAGS=&quot;-N -l&quot;<br></code></pre></td></tr></table></figure><h5 id="2-v1-14-åŠä»¥åç‰ˆæœ¬çš„-kubelet"><a href="#2-v1-14-åŠä»¥åç‰ˆæœ¬çš„-kubelet" class="headerlink" title="2. v1.14 åŠä»¥åç‰ˆæœ¬çš„ kubelet"></a>2. v1.14 åŠä»¥åç‰ˆæœ¬çš„ kubelet</h5><p>k8s v1.14 èµ·ä¹Ÿå·²ç»å¦‚ runc ä¸€æ ·æ”¯æŒé€šè¿‡ BUILDTAGS çš„æ–¹å¼æ¥ç¦æ­¢ kmem accounting äº†ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç¼–è¯‘ kubeletï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make BUILDTAGS=&quot;nokmem&quot; WHAT=cmd/kubelet GOFLAGS=-v GOGCFLAGS=&quot;-N -l&quot;<br></code></pre></td></tr></table></figure><h2 id="å››ã€å®æ–½è®°å½•"><a href="#å››ã€å®æ–½è®°å½•" class="headerlink" title="å››ã€å®æ–½è®°å½•"></a>å››ã€å®æ–½è®°å½•</h2><h3 id="1ã€é…ç½®-go-ç¯å¢ƒ"><a href="#1ã€é…ç½®-go-ç¯å¢ƒ" class="headerlink" title="1ã€é…ç½® go ç¯å¢ƒ"></a>1ã€é…ç½® go ç¯å¢ƒ</h3><p>ç”±äºä¸åŒç‰ˆæœ¬çš„ k8s ç¼–è¯‘ä½¿ç”¨ go ç‰ˆæœ¬æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨å¤šç‰ˆæœ¬æ§åˆ¶çš„æ–¹å¼æ¥é…ç½® go ç¯å¢ƒã€‚å…·ä½“å¯å‚è€ƒä¹‹å‰çš„æ–‡ç« : <a href="https://tareya.github.io/2021/08/25/golang-%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-%E2%80%94-g/">golang å¤šç‰ˆæœ¬ç®¡ç†å·¥å…· â€” g</a></p><h3 id="2ã€é‡æ–°ç¼–è¯‘-runc"><a href="#2ã€é‡æ–°ç¼–è¯‘-runc" class="headerlink" title="2ã€é‡æ–°ç¼–è¯‘ runc"></a>2ã€é‡æ–°ç¼–è¯‘ runc</h3><h4 id="1ï¼‰ä¸‹è½½-runc-æºç "><a href="#1ï¼‰ä¸‹è½½-runc-æºç " class="headerlink" title="1ï¼‰ä¸‹è½½ runc æºç "></a>1ï¼‰ä¸‹è½½ runc æºç </h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/opencontainers/runc &amp;&amp; \<br>cd runc/ &amp;&amp; \<br>git checkout v1.0.2<br></code></pre></td></tr></table></figure><blockquote><p>åˆ‡æ¢åˆ°æœ€æ–°tag</p></blockquote><h4 id="2ï¼‰é‡æ–°ç¼–è¯‘"><a href="#2ï¼‰é‡æ–°ç¼–è¯‘" class="headerlink" title="2ï¼‰é‡æ–°ç¼–è¯‘"></a>2ï¼‰é‡æ–°ç¼–è¯‘</h4><h5 id="1-å®‰è£…ç¼–è¯‘ç»„ä»¶"><a href="#1-å®‰è£…ç¼–è¯‘ç»„ä»¶" class="headerlink" title="1. å®‰è£…ç¼–è¯‘ç»„ä»¶"></a>1. å®‰è£…ç¼–è¯‘ç»„ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo yum install libseccomp-devel -y <br></code></pre></td></tr></table></figure><h5 id="2-ç¼–è¯‘æºç "><a href="#2-ç¼–è¯‘æºç " class="headerlink" title="2. ç¼–è¯‘æºç "></a>2. ç¼–è¯‘æºç </h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make BUILDTAGS=&quot;seccomp nokmem&quot;<br></code></pre></td></tr></table></figure><blockquote><p>ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆæ–°çš„ runc äºŒè¿›åˆ¶æ–‡ä»¶</p></blockquote><h3 id="3ã€é‡æ–°ç¼–è¯‘-kubelet"><a href="#3ã€é‡æ–°ç¼–è¯‘-kubelet" class="headerlink" title="3ã€é‡æ–°ç¼–è¯‘ kubelet"></a>3ã€é‡æ–°ç¼–è¯‘ kubelet</h3><h4 id="1ï¼‰ä¸‹è½½-Kubernetes-æºç "><a href="#1ï¼‰ä¸‹è½½-Kubernetes-æºç " class="headerlink" title="1ï¼‰ä¸‹è½½ Kubernetes æºç "></a>1ï¼‰ä¸‹è½½ Kubernetes æºç </h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/kubernetes/kubernetes.git &amp;&amp; \<br>cd kubernetes &amp;&amp; \<br>git checkout v1.18.18<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰é‡æ–°ç¼–è¯‘-1"><a href="#2ï¼‰é‡æ–°ç¼–è¯‘-1" class="headerlink" title="2ï¼‰é‡æ–°ç¼–è¯‘"></a>2ï¼‰é‡æ–°ç¼–è¯‘</h4><blockquote><p>ä¿®æ”¹æºç å‡½æ•°è¿‡ç¨‹å¿½ç•¥</p></blockquote><h5 id="1-v1-18-18-ç‰ˆæœ¬"><a href="#1-v1-18-18-ç‰ˆæœ¬" class="headerlink" title="1. v1.18.18 ç‰ˆæœ¬"></a>1. v1.18.18 ç‰ˆæœ¬</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">KUBE_GIT_TREE_STATE=clean KUBE_GIT_VERSION=v1.18.18 make BUILDTAGS=&quot;nokmem&quot; WHAT=cmd/kubelet GOFLAGS=-v GOGCFLAGS=&quot;-N -l&quot;<br></code></pre></td></tr></table></figure><blockquote><p><strong>å‚æ•°è¯´æ˜:</strong></p><ul><li><code>KUBE_GIT_TREE_STATE</code> å’Œ <code>KUBE_GIT_VERSION</code> ä¸¤ä¸ªå‚æ•°ç”¨äºè®¾ç½®ç‰ˆæœ¬ï¼Œä¿æŒç‰ˆæœ¬å·å¹²å‡€ï¼›</li><li><code>BUILDTAGS</code> è®¾ç½® nokmem ç”¨äºå…³é—­ kmem çš„ä½¿ç”¨ã€‚</li></ul></blockquote><p>ç¼–è¯‘ç»“æœä¼šç”Ÿäº§åœ¨ <code>kubernetes/_output/local/bin/linux/amd64</code> ä¸‹ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä»¥éªŒè¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">_output/local/bin/linux/amd64/kubelet --version<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å€¼ä¸º:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Kubernetes v1.18.18<br></code></pre></td></tr></table></figure><h5 id="2-v1-15-5-ç‰ˆæœ¬"><a href="#2-v1-15-5-ç‰ˆæœ¬" class="headerlink" title="2. v1.15.5 ç‰ˆæœ¬"></a>2. v1.15.5 ç‰ˆæœ¬</h5><blockquote><p>âš ï¸ <strong>å…³äºç¼–è¯‘ k8s æºç çš„ go ç‰ˆæœ¬</strong></p><p>ç”±äº v1.15.5 ç‰ˆæœ¬çš„ k8s ä½¿ç”¨çš„ go ç‰ˆæœ¬ä¸º 1.12.10ï¼Œæ–°ç‰ˆæœ¬çš„go å¯¹äºåŒ…ç®¡ç†çš„æ–¹å¼ä¸è€ç‰ˆæœ¬å››ä¸åŒçš„ï¼Œè€Œä¸” k8s ç‰ˆæœ¬çš„vender æ˜¯ä¸å…¼å®¹çš„ï¼Œéœ€è¦æ ¹æ® go.mod é‡Œçš„éœ€æ±‚æ¥è¿›è¡ŒåŒ¹é…ï¼Œæœ€ç›´æ¥çš„æ–¹å¼å…¶å®å°±æ˜¯çœ‹å®˜æ–¹ç»™å‡ºçš„ kubectl äºŒè¿›åˆ¶åŒ…ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„ go ç¼–è¯‘çš„ï¼Œå†äºŒæ¬¡ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨ç›¸åŒç‰ˆæœ¬å³å¯ï¼Œå¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl version --client<br></code></pre></td></tr></table></figure><p>å…¶è¿”å›ä¸º:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Client Version: version.Info&#123;Major:&quot;1&quot;, Minor:&quot;15&quot;, GitVersion:&quot;v1.15.5&quot;, GitCommit:&quot;20c265fef0741dd71a66480e35bd69f18351daea&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-10-15T19:16:51Z&quot;, GoVersion:&quot;go1.12.10&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„go ç‰ˆæœ¬ä¸º 1.12.10 ï¼Œé€šè¿‡ g æ¥åˆ‡æ¢åˆ°å¯¹åº”çš„ç‰ˆæœ¬ï¼Œå…·ä½“å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">g install 1.12.10<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">Downloading 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| (122/122 MB, 1.149 MB/s) [1m46s:0s]         <br><br>Computing checksum with SHA256<br><br>Checksums matched<br><br>Now using go1.12.10<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">KUBE_GIT_TREE_STATE=clean KUBE_GIT_VERSION=v1.15.5 make BUILDTAGS=&quot;nokmem&quot; WHAT=cmd/kubelet GOFLAGS=-v GOGCFLAGS=&quot;-N -l&quot;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ç»“æœä»ç„¶ä¼šç”Ÿäº§åœ¨ <code>kubernetes/_output/local/bin/linux/amd64</code> ä¸‹ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä»¥éªŒè¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">_output/local/bin/linux/amd64/kubelet --version<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å€¼ä¸º:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Kubernetes v1.15.5<br></code></pre></td></tr></table></figure><h3 id="4ã€æ›¿æ¢åŸæœ‰çš„-kubelet-å’Œ-docker-runc"><a href="#4ã€æ›¿æ¢åŸæœ‰çš„-kubelet-å’Œ-docker-runc" class="headerlink" title="4ã€æ›¿æ¢åŸæœ‰çš„ kubelet å’Œ docker-runc"></a>4ã€æ›¿æ¢åŸæœ‰çš„ kubelet å’Œ docker-runc</h3><h4 id="1ï¼‰æ‰¹é‡å¤‡ä»½åŸç‰ˆæœ¬"><a href="#1ï¼‰æ‰¹é‡å¤‡ä»½åŸç‰ˆæœ¬" class="headerlink" title="1ï¼‰æ‰¹é‡å¤‡ä»½åŸç‰ˆæœ¬"></a>1ï¼‰æ‰¹é‡å¤‡ä»½åŸç‰ˆæœ¬</h4><blockquote><p>è¯¥è¿‡ç¨‹å¯ä»¥æ‰¹é‡è¿›è¡Œ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible all -S -R root -m file -a &quot;path=/tmp/bak state=directory owner=root group=root&quot;<br>ansible all -S -R root -m shell -a &quot;cp -a /usr/bin/runc /tmp/bak/&quot;<br>ansible all -S -R root -m shell -a &quot;cp -a /usr/bin/docker-runc /tmp/bak/&quot;<br>ansible all -S -R root -m shell -a &quot;cp -a /data/application/kubernetes/bin/kubelet /tmp/bak/&quot;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ†å‘é‡æ–°ç¼–è¯‘åçš„-runc-å’Œ-kubelet"><a href="#2ï¼‰åˆ†å‘é‡æ–°ç¼–è¯‘åçš„-runc-å’Œ-kubelet" class="headerlink" title="2ï¼‰åˆ†å‘é‡æ–°ç¼–è¯‘åçš„ runc å’Œ kubelet"></a>2ï¼‰åˆ†å‘é‡æ–°ç¼–è¯‘åçš„ runc å’Œ kubelet</h4><blockquote><p>è¯¥è¿‡ç¨‹å¯ä»¥æ‰¹é‡è¿›è¡Œ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible all -S -R root -m copy -a &quot;src=runc dest=/tmp/runc owner=root group=root mode=0755&quot; <br>ansible all -S -R root -m copy -a &quot;src=runc dest=/tmp/docker-runc owner=root group=root mode=0755&quot; <br>ansible all -S -R root -m copy -a &quot;src=kubelet dest=/tmp/kubelet owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰åœæ­¢-docker-å’Œ-kubelet"><a href="#3ï¼‰åœæ­¢-docker-å’Œ-kubelet" class="headerlink" title="3ï¼‰åœæ­¢ docker å’Œ kubelet"></a>3ï¼‰åœæ­¢ docker å’Œ kubelet</h4><blockquote><p>è¯¥è¿‡ç¨‹å»ºè®®é€ä¸ªèŠ‚ç‚¹è¿›è¡Œ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop kubelet<br>systemctl stop docker<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰æ›¿æ¢é‡æ–°ç¼–è¯‘çš„-runc-å’Œ-kubelet"><a href="#3ï¼‰æ›¿æ¢é‡æ–°ç¼–è¯‘çš„-runc-å’Œ-kubelet" class="headerlink" title="3ï¼‰æ›¿æ¢é‡æ–°ç¼–è¯‘çš„ runc å’Œ kubelet"></a>3ï¼‰æ›¿æ¢é‡æ–°ç¼–è¯‘çš„ runc å’Œ kubelet</h4><blockquote><p>è¯¥è¿‡ç¨‹å»ºè®®é€ä¸ªèŠ‚ç‚¹è¿›è¡Œ</p></blockquote><h5 id="1-æ›¿æ¢-runc"><a href="#1-æ›¿æ¢-runc" class="headerlink" title="1. æ›¿æ¢ runc"></a>1. æ›¿æ¢ runc</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">/bin/rm -f /usr/bin/runc /usr/bin/docker-runc &amp;&amp; \<br>/bin/mv /tmp/*runc /usr/bin/<br></code></pre></td></tr></table></figure><h5 id="2-æ›¿æ¢-kubelet"><a href="#2-æ›¿æ¢-kubelet" class="headerlink" title="2. æ›¿æ¢ kubelet"></a>2. æ›¿æ¢ kubelet</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">/bin/rm -f /data/applications/kubernetes/bin/kubelet &amp;&amp; \<br>/bin/mv -a /tmp/kubelet /data/applications/kubernetes/bin/<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰é‡å¯æœåŠ¡å™¨éªŒè¯"><a href="#4ï¼‰é‡å¯æœåŠ¡å™¨éªŒè¯" class="headerlink" title="4ï¼‰é‡å¯æœåŠ¡å™¨éªŒè¯"></a>4ï¼‰é‡å¯æœåŠ¡å™¨éªŒè¯</h4><blockquote><p>æ£€æŸ¥ kmem æ˜¯å¦å…³é—­éœ€è¦å°†èŠ‚ç‚¹çš„ pod æ€æ‰é‡å¯æˆ–é‡å¯æœåŠ¡å™¨ï¼Œä½†æ˜¯è¿™ä¸€å·¥ä½œå¯ä»¥å†æ–°å¢èŠ‚ç‚¹çš„å‡†å¤‡ç¯å¢ƒå°±å®Œæˆ</p></blockquote><h5 id="1-æŸ¥çœ‹k8s-pod-kmem-å†…å­˜-ä½¿ç”¨"><a href="#1-æŸ¥çœ‹k8s-pod-kmem-å†…å­˜-ä½¿ç”¨" class="headerlink" title="1. æŸ¥çœ‹k8s pod kmem å†…å­˜ ä½¿ç”¨"></a>1. æŸ¥çœ‹k8s pod kmem å†…å­˜ ä½¿ç”¨</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /sys/fs/cgroup/memory/kubepods/burstable/memory.kmem.usage_in_bytes<br></code></pre></td></tr></table></figure><p>å¦‚æœè¿”å›å€¼ä¸º0ï¼Œåˆ™è¡¨æ˜ kmem å·²å…³é—­</p><h5 id="2-æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼"><a href="#2-æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼" class="headerlink" title="2. æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼"></a>2. æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /sys/fs/cgroup/memory/kubepods/memory.kmem.slabinfo<br></code></pre></td></tr></table></figure><p>å¦‚æœè¿”å›å€¼ä¸º <code>Input/output error</code>ï¼Œåˆ™ä¹Ÿè¡¨æ˜ kmem å·²å…³é—­</p>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é—®é¢˜è§£å†³æ–¹æ¡ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes 1.18ï¼ˆcalico ç½‘ç»œï¼‰äºŒè¿›åˆ¶åŒ…éƒ¨ç½²</title>
    <link href="/2021/09/22/Kubernetes-1-18%EF%BC%88calico-%E7%BD%91%E7%BB%9C%EF%BC%89-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E9%83%A8%E7%BD%B2/"/>
    <url>/2021/09/22/Kubernetes-1-18%EF%BC%88calico-%E7%BD%91%E7%BB%9C%EF%BC%89-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-1-18ï¼ˆcalico-ç½‘ç»œï¼‰äºŒè¿›åˆ¶åŒ…éƒ¨ç½²"><a href="#Kubernetes-1-18ï¼ˆcalico-ç½‘ç»œï¼‰äºŒè¿›åˆ¶åŒ…éƒ¨ç½²" class="headerlink" title="Kubernetes 1.18ï¼ˆcalico ç½‘ç»œï¼‰äºŒè¿›åˆ¶åŒ…éƒ¨ç½²"></a>Kubernetes 1.18ï¼ˆcalico ç½‘ç»œï¼‰äºŒè¿›åˆ¶åŒ…éƒ¨ç½²</h1><span id="more"></span><h2 id="ä¸€ã€åŸºç¡€ä¿¡æ¯"><a href="#ä¸€ã€åŸºç¡€ä¿¡æ¯" class="headerlink" title="ä¸€ã€åŸºç¡€ä¿¡æ¯"></a>ä¸€ã€åŸºç¡€ä¿¡æ¯</h2><h3 id="1ã€é›†ç¾¤è§„åˆ’"><a href="#1ã€é›†ç¾¤è§„åˆ’" class="headerlink" title="1ã€é›†ç¾¤è§„åˆ’"></a>1ã€é›†ç¾¤è§„åˆ’</h3><table><thead><tr><th>IP åœ°å€</th><th>ä¸»æœºå</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>192.168.3.231</td><td>k8s-master01</td><td>masterèŠ‚ç‚¹1ã€etcd èŠ‚ç‚¹1ã€nodeèŠ‚ç‚¹2</td></tr><tr><td>192.168.3.232</td><td>k8s-master02</td><td>masterèŠ‚ç‚¹2ã€etcd èŠ‚ç‚¹2ã€nodeèŠ‚ç‚¹3</td></tr><tr><td>192.168.3.233</td><td>k8s-master03</td><td>masterèŠ‚ç‚¹3ã€etcd èŠ‚ç‚¹3ã€nodeèŠ‚ç‚¹4</td></tr><tr><td>192.168.3.234</td><td>k8s-node01</td><td>node èŠ‚ç‚¹1</td></tr><tr><td>192.168.3.235</td><td>k8s-lb01</td><td>LoadBalance 1ï¼ˆVIP 192.168.3.230ï¼‰</td></tr><tr><td>192.168.3.236</td><td>k8s-lb02</td><td>LoadBalance 2</td></tr></tbody></table><h3 id="2ã€ç‰ˆæœ¬ä¿¡æ¯"><a href="#2ã€ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="2ã€ç‰ˆæœ¬ä¿¡æ¯"></a>2ã€ç‰ˆæœ¬ä¿¡æ¯</h3><table><thead><tr><th>ç»„ä»¶åç§°</th><th>ç‰ˆæœ¬ä¿¡æ¯</th></tr></thead><tbody><tr><td>OS</td><td>CentOS 7.9</td></tr><tr><td>Docker</td><td>20.10.8</td></tr><tr><td>Kubernetesã€kubectl</td><td>1.18.18</td></tr><tr><td>etcd</td><td>3.4.14</td></tr><tr><td>cni</td><td>0.6.0</td></tr><tr><td>Calico</td><td>3.19.2</td></tr></tbody></table><h3 id="3ã€è·¯å¾„æ ‡å‡†"><a href="#3ã€è·¯å¾„æ ‡å‡†" class="headerlink" title="3ã€è·¯å¾„æ ‡å‡†"></a>3ã€è·¯å¾„æ ‡å‡†</h3><h4 id="1ï¼‰Kubernetes-master-èŠ‚ç‚¹"><a href="#1ï¼‰Kubernetes-master-èŠ‚ç‚¹" class="headerlink" title="1ï¼‰Kubernetes master èŠ‚ç‚¹"></a>1ï¼‰Kubernetes master èŠ‚ç‚¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">/data/applications/<br>â”œâ”€â”€ etcd<br>â”‚Â Â  â”œâ”€â”€ bin<br>â”‚Â Â  â”œâ”€â”€ cfg<br>â”‚Â Â  â”œâ”€â”€ data<br>â”‚Â Â  â”œâ”€â”€ logs<br>â”‚Â Â  â”œâ”€â”€ ssl<br>â”‚Â Â  â””â”€â”€ wal<br>â””â”€â”€ kubernetes<br>    â”œâ”€â”€ bin<br>    â”œâ”€â”€ cfg<br>    â”œâ”€â”€ logs<br>    â””â”€â”€ ssl<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰-Kubernetes-node-èŠ‚ç‚¹"><a href="#2ï¼‰-Kubernetes-node-èŠ‚ç‚¹" class="headerlink" title="2ï¼‰ Kubernetes node èŠ‚ç‚¹"></a>2ï¼‰ Kubernetes node èŠ‚ç‚¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">/data/applications/<br>â””â”€â”€ kubernetes<br>    â”œâ”€â”€ bin<br>    â”œâ”€â”€ cfg<br>    â”œâ”€â”€ logs<br>    â””â”€â”€ ssl<br></code></pre></td></tr></table></figure><h2 id="äºŒã€éƒ¨ç½²å®æ–½"><a href="#äºŒã€éƒ¨ç½²å®æ–½" class="headerlink" title="äºŒã€éƒ¨ç½²å®æ–½"></a>äºŒã€éƒ¨ç½²å®æ–½</h2><h3 id="1ã€ç¯å¢ƒå‡†å¤‡"><a href="#1ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1ã€ç¯å¢ƒå‡†å¤‡"></a>1ã€ç¯å¢ƒå‡†å¤‡</h3><h4 id="1ï¼‰ç³»ç»Ÿç¯å¢ƒ"><a href="#1ï¼‰ç³»ç»Ÿç¯å¢ƒ" class="headerlink" title="1ï¼‰ç³»ç»Ÿç¯å¢ƒ"></a>1ï¼‰ç³»ç»Ÿç¯å¢ƒ</h4><h5 id="1-å…³é—­é˜²ç«å¢™"><a href="#1-å…³é—­é˜²ç«å¢™" class="headerlink" title="1. å…³é—­é˜²ç«å¢™"></a>1. å…³é—­é˜²ç«å¢™</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop firewalld<br>systemctl disable firewalld<br></code></pre></td></tr></table></figure><h5 id="2-å…³é—­-selinux"><a href="#2-å…³é—­-selinux" class="headerlink" title="2. å…³é—­ selinux"></a>2. å…³é—­ selinux</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">setenforce 0# ä¸´æ—¶å…³é—­<br>sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config# æ°¸ä¹…å…³é—­<br></code></pre></td></tr></table></figure><h5 id="3-å…³é—­-swap"><a href="#3-å…³é—­-swap" class="headerlink" title="3. å…³é—­ swap"></a>3. å…³é—­ swap</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ‰€æœ‰ K8S èŠ‚ç‚¹æ‰§è¡Œ</span><br>swapoff -a      # ä¸´æ—¶å…³é—­<br>sed -i &#x27;/swap/s/UUID/#UUID/g&#x27; /etc/fstab # æ°¸ä¹…å…³é—­<br></code></pre></td></tr></table></figure><h5 id="4-yum-é•œåƒæºå¤„ç†"><a href="#4-yum-é•œåƒæºå¤„ç†" class="headerlink" title="4. yum é•œåƒæºå¤„ç†"></a>4. yum é•œåƒæºå¤„ç†</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo &amp;&amp; \<br>curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo <br></code></pre></td></tr></table></figure><h5 id="5-å®‰è£…å¿…è¦ä¾èµ–"><a href="#5-å®‰è£…å¿…è¦ä¾èµ–" class="headerlink" title="5. å®‰è£…å¿…è¦ä¾èµ–"></a>5. å®‰è£…å¿…è¦ä¾èµ–</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y conntrack ntpdate ntp jq iptables curl sysstat libseccomp wget lsof telnet<br></code></pre></td></tr></table></figure><h5 id="6-æ—¶é—´åŒæ­¥"><a href="#6-æ—¶é—´åŒæ­¥" class="headerlink" title="6. æ—¶é—´åŒæ­¥"></a>6. æ—¶é—´åŒæ­¥</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ‰€æœ‰ K8S èŠ‚ç‚¹æ‰§è¡Œ</span><br>ntpdate -u time1.aliyun.com # æ—¶é—´åŒæ­¥<br>echo &quot;*/20 * * * * /usr/sbin/ntpdate -u time1.aliyun.com &gt;/dev/null &amp;&quot; &gt;&gt; /var/spool/cron/root  # æ·»åŠ å®šæ—¶ä»»åŠ¡<br></code></pre></td></tr></table></figure><h5 id="7-è®¾ç½®ç³»ç»Ÿæ—¶åŒº"><a href="#7-è®¾ç½®ç³»ç»Ÿæ—¶åŒº" class="headerlink" title="7. è®¾ç½®ç³»ç»Ÿæ—¶åŒº"></a>7. è®¾ç½®ç³»ç»Ÿæ—¶åŒº</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è°ƒæ•´ç³»ç»Ÿ TimeZone</span><br>timedatectl set-timezone Asia/Shanghai<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> å°†å½“å‰çš„ UTC æ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é’Ÿ</span><br>timedatectl set-local-rtc 0<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> é‡å¯ä¾èµ–äºç³»ç»Ÿæ—¶é—´çš„æœåŠ¡</span><br>systemctl restart rsyslog<br>systemctl restart crond<br></code></pre></td></tr></table></figure><h5 id="8-å†…æ ¸å‚æ•°ä¼˜åŒ–"><a href="#8-å†…æ ¸å‚æ•°ä¼˜åŒ–" class="headerlink" title="8. å†…æ ¸å‚æ•°ä¼˜åŒ–"></a>8. å†…æ ¸å‚æ•°ä¼˜åŒ–</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; /etc/sysctl.d/kubernetes.conf &lt;&lt; EOF<br>net.ipv4.ip_forward=1<br>net.ipv4.tcp_tw_recycle=0  #ç”±äºtcp_tw_recycleä¸kubernetesçš„NATå†²çªï¼Œå¿…é¡»å…³é—­ï¼å¦åˆ™ä¼šå¯¼è‡´æœåŠ¡ä¸é€šã€‚<br>vm.swappiness=0            #ç¦æ­¢ä½¿ç”¨ swap ç©ºé—´ï¼Œåªæœ‰å½“ç³»ç»Ÿ OOM æ—¶æ‰å…è®¸ä½¿ç”¨å®ƒ<br>vm.overcommit_memory=1     #ä¸æ£€æŸ¥ç‰©ç†å†…å­˜æ˜¯å¦å¤Ÿç”¨<br>vm.panic_on_oom=0          #å¼€å¯ OOM<br>fs.inotify.max_user_instances=8192<br>fs.inotify.max_user_watches=1048576<br>fs.file-max=52706963<br>fs.nr_open=52706963<br>net.ipv6.conf.all.disable_ipv6=1  #å…³é—­ä¸ä½¿ç”¨çš„ipv6åè®®æ ˆï¼Œé˜²æ­¢è§¦å‘docker BUG.<br>EOF<br><br>sysctl -p /etc/sysctl.d/kubernetes.conf<br></code></pre></td></tr></table></figure><h5 id="9-å…³é—­æ— ç”¨æœåŠ¡"><a href="#9-å…³é—­æ— ç”¨æœåŠ¡" class="headerlink" title="9. å…³é—­æ— ç”¨æœåŠ¡"></a>9. å…³é—­æ— ç”¨æœåŠ¡</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop postfix.service <br>systemctl disable postfix.service<br></code></pre></td></tr></table></figure><h5 id="10-æ·»åŠ -host-dns-è§£æ"><a href="#10-æ·»åŠ -host-dns-è§£æ" class="headerlink" title="10. æ·»åŠ  host / dns è§£æ"></a>10. æ·»åŠ  host / dns è§£æ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt;&gt; /etc/hosts &lt;&lt; EOF<br>192.168.3.231    k8s-master01    etcd-01<br>192.168.3.232    k8s-master02    etcd-02<br>192.168.3.233    k8s-master03    etcd-03<br>192.168.3.234    k8s-node01<br>192.168.3.235    k8s-lb01<br>192.168.3.236    k8s-lb02<br>EOF<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰è¿›è¡ŒèŠ‚ç‚¹é—´å…å¯†é€šä¿¡å¤„ç†"><a href="#2ï¼‰è¿›è¡ŒèŠ‚ç‚¹é—´å…å¯†é€šä¿¡å¤„ç†" class="headerlink" title="2ï¼‰è¿›è¡ŒèŠ‚ç‚¹é—´å…å¯†é€šä¿¡å¤„ç†"></a>2ï¼‰è¿›è¡ŒèŠ‚ç‚¹é—´å…å¯†é€šä¿¡å¤„ç†</h4><h5 id="1-å®‰è£…-sshpass"><a href="#1-å®‰è£…-sshpass" class="headerlink" title="1. å®‰è£… sshpass"></a>1. å®‰è£… sshpass</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y sshpass<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºè‡ªåŠ¨å¤„ç†è„šæœ¬ssh-copy-id-sh-ï¼Œè„šæœ¬å¦‚ä¸‹"><a href="#2-åˆ›å»ºè‡ªåŠ¨å¤„ç†è„šæœ¬ssh-copy-id-sh-ï¼Œè„šæœ¬å¦‚ä¸‹" class="headerlink" title="2. åˆ›å»ºè‡ªåŠ¨å¤„ç†è„šæœ¬ssh-copy-id.sh ï¼Œè„šæœ¬å¦‚ä¸‹:"></a>2. åˆ›å»ºè‡ªåŠ¨å¤„ç†è„šæœ¬<code>ssh-copy-id.sh</code> ï¼Œè„šæœ¬å¦‚ä¸‹:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/sh</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ä»¥ä¸‹å˜é‡æ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œä¿®æ”¹</span><br>IPArray=(192.168.3.231 192.168.3.232 192.168.3.233 192.168.3.234 192.168.3.235 192.168.3.236)<br>Port=36022<br>TargetPass=Union@#JuYin2021<br>TargetUser=uniondrug<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ›å»ºå¯†é’¥</span><br>rm ~/.ssh/id_rsa* -f<br>ssh-keygen -t rsa -f ~/.ssh/id_rsa -N &quot;&quot; -q<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘å…¬é’¥</span><br>for IP in $&#123;IPArray[@]&#125;<br>do<br><br>   sshpass -p &quot;$TargetPass&quot; ssh-copy-id -o &quot;StrictHostKeyChecking no&quot;  -i ~/.ssh/id_rsa.pub -p $Port $TargetUser@$IP &amp;&gt;/dev/null<br><br>done<br></code></pre></td></tr></table></figure><h5 id="3-è¿è¡Œè„šæœ¬ï¼š"><a href="#3-è¿è¡Œè„šæœ¬ï¼š" class="headerlink" title="3. è¿è¡Œè„šæœ¬ï¼š"></a>3. è¿è¡Œè„šæœ¬ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sh -x ssh-copy-id.sh<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰å®‰è£…æ‰¹ç®¡ç†å·¥å…·"><a href="#3ï¼‰å®‰è£…æ‰¹ç®¡ç†å·¥å…·" class="headerlink" title="3ï¼‰å®‰è£…æ‰¹ç®¡ç†å·¥å…·"></a>3ï¼‰å®‰è£…æ‰¹ç®¡ç†å·¥å…·</h4><h5 id="1-å®‰è£…-python3"><a href="#1-å®‰è£…-python3" class="headerlink" title="1. å®‰è£… python3"></a>1. å®‰è£… python3</h5><p>åˆ›å»ºè‡ªåŠ¨å¤„ç†è„šæœ¬ <code>install-python3.py</code>ï¼Œè„šæœ¬å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> os,sys<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exe_cmd</span>(<span class="hljs-params">cmd</span>):</span><br>    p = subprocess.Popen(cmd, shell=<span class="hljs-literal">True</span>, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        next_line = p.stdout.readline()<br>        return_line = next_line.decode(<span class="hljs-string">&quot;utf-8&quot;</span>, <span class="hljs-string">&quot;ignore&quot;</span>)<br>        <span class="hljs-keyword">if</span> return_line == <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">and</span> p.poll() != <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-built_in">print</span>(return_line)<br>    stdout, stderr = p.communicate()<br>    <span class="hljs-keyword">if</span> p.returncode != <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;python 3.8.5 ä¸€é”®å®‰è£…å¼€å§‹ï¼&quot;</span>)<br>    backinfo = exe_cmd(<span class="hljs-string">&#x27;ping -c 1 -w 1 www.baidu.com&#x27;</span>)<br>    <span class="hljs-keyword">if</span> backinfo == <span class="hljs-literal">False</span>:<br>        <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;ç½‘ç»œæ£€æµ‹å¤±è´¥ç¨‹åºé€€å‡ºï¼Œè¯·é‡æ–°æ£€æµ‹ç½‘ç»œç¯å¢ƒ!&quot;</span>)<br>        sys.exit()<br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;ç½‘ç»œè¿æ¥æ­£å¸¸!&quot;</span>)<br>    yum_jc = exe_cmd(<span class="hljs-string">&#x27;yum list&#x27;</span>)<br>    <span class="hljs-keyword">if</span> yum_jc == <span class="hljs-literal">False</span>:<br>        <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;yum ä¸å¯ç”¨ï¼Œè¯·å…ˆæ‰‹åŠ¨é…ç½®yumå®‰è£…!&quot;</span>)<br>        sys.exit()<br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&#x27;yumå®‰è£…æ£€æµ‹å¯ç”¨!&#x27;</span>)<br><br>    exe_cmd(<span class="hljs-string">&quot;yum install gcc -y&quot;</span>)<br>    exe_cmd(<span class="hljs-string">&quot;yum install openssl-devel bizp2-devel expat-devel gdbm-devel readline-devel sqlite-devel libffi-devel -y&quot;</span>)<br>    exe_cmd(<span class="hljs-string">&quot;wget http://npm.taobao.org/mirrors/python/3.8.5/Python-3.8.5.tgz&quot;</span>)<br>    exe_cmd(<span class="hljs-string">&quot;tar -zxvf Python-3.8.5.tgz&quot;</span>)<br>    exe_cmd(<span class="hljs-string">&quot;mv Python-3.8.5 /usr/local/&quot;</span>)<br>    exe_cmd(<span class="hljs-string">&quot;rm -rf Python-3.8.5.tgz&quot;</span>)<br>    os.chdir(<span class="hljs-string">&#x27;/usr/local/Python-3.8.5&#x27;</span>)<br>    exe_cmd(<span class="hljs-string">&quot;./configure&quot;</span>)<br>    exe_cmd(<span class="hljs-string">&quot;make&quot;</span>)<br>    exe_cmd(<span class="hljs-string">&quot;make install&quot;</span>)<br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;ç¨‹åºæ‰§è¡Œå®Œæˆï¼è¾“å…¥python3 æŸ¥çœ‹æ•ˆæœã€‚&quot;</span>)<br>    exe_cmd(<span class="hljs-string">&quot;python3 -V&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h5 id="2-è¿è¡Œè„šæœ¬"><a href="#2-è¿è¡Œè„šæœ¬" class="headerlink" title="2. è¿è¡Œè„šæœ¬:"></a>2. è¿è¡Œè„šæœ¬:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python install-python3.py<br></code></pre></td></tr></table></figure><h5 id="3-å®‰è£…-ansible"><a href="#3-å®‰è£…-ansible" class="headerlink" title="3. å®‰è£… ansible"></a>3. å®‰è£… ansible</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple ansible==2.7.1<br></code></pre></td></tr></table></figure><h5 id="4-ç®¡ç†-ansible-é…ç½®"><a href="#4-ç®¡ç†-ansible-é…ç½®" class="headerlink" title="4. ç®¡ç† ansible é…ç½®"></a>4. ç®¡ç† ansible é…ç½®</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /etc/ansible/roles &amp;&amp; \<br>cat &gt; /etc/ansible/ansible.cfg &lt;&lt; EOF<br>[defaults]<br>inventory = /etc/ansible/hosts<br>remote_tmp = /tmp/.ansible/<br>local_tmp = ~/.ansible/tmp<br>remote_user = uniondrug<br>sudo_user = root<br>remote_port = 36022<br>host_key_checking = False  <br><br>roles_path = /etc/ansible/roles<br><br>EOF<br></code></pre></td></tr></table></figure><h5 id="5-ç®¡ç†-ansible-ä¸»æœºæ¸…å•"><a href="#5-ç®¡ç†-ansible-ä¸»æœºæ¸…å•" class="headerlink" title="5. ç®¡ç† ansible ä¸»æœºæ¸…å•"></a>5. ç®¡ç† ansible ä¸»æœºæ¸…å•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; /etc/ansible/hosts &lt;&lt; EOF<br>[k8s-master01]<br>192.168.3.231 ansible_ssh_port=36022 ansible_ssh_user=uniondrug ansible_become_pass=&#x27;*UiiJC9&amp;#CzV@b0H&#x27;<br><br>[k8s-master02]<br>192.168.3.232 ansible_ssh_port=36022 ansible_ssh_user=uniondrug ansible_become_pass=&#x27;*UiiJC9&amp;#CzV@b0H&#x27;<br><br>[k8s-master03]<br>192.168.3.233 ansible_ssh_port=36022 ansible_ssh_user=uniondrug ansible_become_pass=&#x27;*UiiJC9&amp;#CzV@b0H&#x27;<br><br>[k8s-node01]<br>192.168.3.234 ansible_ssh_port=36022 ansible_ssh_user=uniondrug ansible_become_pass=&#x27;*UiiJC9&amp;#CzV@b0H&#x27;<br><br>[k8s-lb01]<br>192.168.3.235 ansible_ssh_port=36022 ansible_ssh_user=uniondrug ansible_become_pass=&#x27;*UiiJC9&amp;#CzV@b0H&#x27;<br><br>[k8s-lb02]<br>192.168.3.236 ansible_ssh_port=36022 ansible_ssh_user=uniondrug ansible_become_pass=&#x27;*UiiJC9&amp;#CzV@b0H&#x27;<br><br>[k8s-master:children]<br>k8s-master01<br>k8s-master02<br>k8s-master03<br><br>[k8s-node:children]<br>k8s-master01<br>k8s-master02<br>k8s-master03<br>k8s-node01<br><br>[k8s-nginx:children]<br>k8s-lb01<br>k8s-lb02<br>EOF<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰è®¾ç½®-rsyslogd-å’Œ-systemd-journald-æ—¥å¿—æŒä¹…åŒ–"><a href="#4ï¼‰è®¾ç½®-rsyslogd-å’Œ-systemd-journald-æ—¥å¿—æŒä¹…åŒ–" class="headerlink" title="4ï¼‰è®¾ç½® rsyslogd å’Œ systemd journald æ—¥å¿—æŒä¹…åŒ–"></a>4ï¼‰è®¾ç½® rsyslogd å’Œ systemd journald æ—¥å¿—æŒä¹…åŒ–</h4><blockquote><p>ğŸŒˆ systemd çš„ journald æ˜¯ CentOS 7 ç¼ºçœæ—¥å¿—è®°å½•å·¥å…·ï¼Œå®ƒè®°å½•äº†æ‰€æœ‰ç³»ç»Ÿã€å†…æ ¸ã€Service Unit çš„æ—¥å¿—ï¼Œç›¸è¾ƒäº systemd æœ¬èº«ï¼Œjournald çš„ä¼˜åŠ¿åœ¨äº:</p><ul><li>å¯ä»¥è®°å½•åˆ°å†…å­˜æˆ–æ–‡ä»¶ç³»ç»Ÿï¼›ï¼ˆé»˜è®¤è®°å½•åˆ°å†…å­˜ï¼Œå¯¹åº”çš„ä½ç½®ä¸º /run/log/journalï¼‰</li><li>å¯ä»¥é™åˆ¶å ç”¨çš„ç£ç›˜ç©ºé—´ã€ä¿è¯ç£ç›˜å‰©ä½™ç©ºé—´</li><li>å¯ä»¥é™åˆ¶æ—¥å¿—çš„å¤§å°ã€ä¿å­˜çš„æ—¶é—´</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>journald</code> é»˜è®¤ä¼šå°†æ—¥å¿—è½¬å‘ç»™ <code>rsyslog</code>ï¼Œè¿™ä¼šå¯¼è‡´æ—¥å¿—å†™äº†å¤šä»½ï¼Œ``/var/log/messages<code> </code>ä¸­åŒ…å«äº†å¤ªå¤šæ— å…³æ—¥å¿—ï¼Œä¸æ–¹ä¾¿åç»­æŸ¥çœ‹ï¼ŒåŒæ—¶ä¹Ÿå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œæå‰åšä¼˜åŒ–å¤„ç†ã€‚</p></blockquote><h5 id="1-æ‰¹é‡åˆ›å»ºæ—¥å¿—ç›®å½•"><a href="#1-æ‰¹é‡åˆ›å»ºæ—¥å¿—ç›®å½•" class="headerlink" title="1. æ‰¹é‡åˆ›å»ºæ—¥å¿—ç›®å½•"></a>1. æ‰¹é‡åˆ›å»ºæ—¥å¿—ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ›å»ºæ—¥å¿—æŒä¹…åŒ–ç›®å½•</span><br>ansible all -S -R root -m file -a &quot;path=/var/log/journal state=directory owner=root group=root mode=0755&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ›å»º journald å­é…ç½®æ–‡ä»¶ç›®å½•</span><br>ansible all -S -R root -m file -a &quot;path=/etc/systemd/journald.conf.d state=directory owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»º-journald-æŒä¹…åŒ–é…ç½®"><a href="#2-åˆ›å»º-journald-æŒä¹…åŒ–é…ç½®" class="headerlink" title="2. åˆ›å»º journald æŒä¹…åŒ–é…ç½®"></a>2. åˆ›å»º journald æŒä¹…åŒ–é…ç½®</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; 99-prophet.conf &lt;&lt;EOF<br>[Journal]<br><span class="hljs-meta">#</span><span class="bash"> æŒä¹…åŒ–ä¿å­˜åˆ°ç£ç›˜</span><br>Storage=persistent<br>     <br><span class="hljs-meta">#</span><span class="bash"> å‹ç¼©å†å²æ—¥å¿—</span><br>Compress=yes<br>     <br>SyncIntervalSec=5m<br>RateLimitInterval=30s<br>RateLimitBurst=1000<br>     <br><span class="hljs-meta">#</span><span class="bash"> æœ€å¤§å ç”¨ç©ºé—´ 10G</span><br>SystemMaxUse=10G<br>     <br><span class="hljs-meta">#</span><span class="bash"> å•æ—¥å¿—æ–‡ä»¶æœ€å¤§ 200M</span><br>SystemMaxFileSize=200M<br>     <br><span class="hljs-meta">#</span><span class="bash"> æ—¥å¿—ä¿å­˜æ—¶é—´ 2 å‘¨</span><br>MaxRetentionSec=2week<br>     <br><span class="hljs-meta">#</span><span class="bash"> ä¸å°†æ—¥å¿—è½¬å‘åˆ° syslog</span><br>ForwardToSyslog=no<br>EOF<br></code></pre></td></tr></table></figure><h5 id="3-åˆ†å‘é…ç½®æ–‡ä»¶"><a href="#3-åˆ†å‘é…ç½®æ–‡ä»¶" class="headerlink" title="3. åˆ†å‘é…ç½®æ–‡ä»¶"></a>3. åˆ†å‘é…ç½®æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible all -S -R root -m copy -a &quot;src=99-prophet.conf dest=/etc/systemd/journald.conf.d/99-prophet.conf owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="4-æ‰¹é‡é‡å¯-journald"><a href="#4-æ‰¹é‡é‡å¯-journald" class="headerlink" title="4. æ‰¹é‡é‡å¯ journald"></a>4. æ‰¹é‡é‡å¯ journald</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible all -S -R root -m shell -a &quot;systemctl restart systemd-journald&quot;<br></code></pre></td></tr></table></figure><h4 id="5ï¼‰åˆ›å»º-Kubernetes-ç›¸å…³ç›®å½•"><a href="#5ï¼‰åˆ›å»º-Kubernetes-ç›¸å…³ç›®å½•" class="headerlink" title="5ï¼‰åˆ›å»º Kubernetes ç›¸å…³ç›®å½•"></a>5ï¼‰åˆ›å»º Kubernetes ç›¸å…³ç›®å½•</h4><h5 id="1-æ‰¹é‡åˆ›å»º-etcd-é›†ç¾¤ç›¸å…³ç›®å½•"><a href="#1-æ‰¹é‡åˆ›å»º-etcd-é›†ç¾¤ç›¸å…³ç›®å½•" class="headerlink" title="1. æ‰¹é‡åˆ›å»º etcd é›†ç¾¤ç›¸å…³ç›®å½•"></a>1. æ‰¹é‡åˆ›å»º etcd é›†ç¾¤ç›¸å…³ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m shell -a &quot;mkdir -p /data/applications/etcd/&#123;bin,cfg,ssl,data,wal,logs&#125;&quot;<br></code></pre></td></tr></table></figure><h5 id="2-æ‰¹é‡åˆ›å»º-K8S-é›†ç¾¤ç›¸å…³ç›®å½•"><a href="#2-æ‰¹é‡åˆ›å»º-K8S-é›†ç¾¤ç›¸å…³ç›®å½•" class="headerlink" title="2. æ‰¹é‡åˆ›å»º K8S é›†ç¾¤ç›¸å…³ç›®å½•"></a>2. æ‰¹é‡åˆ›å»º K8S é›†ç¾¤ç›¸å…³ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m shell -a &quot;mkdir -p /data/applications/kubernetes/&#123;bin,cfg,ssl,logs&#125;&quot;<br></code></pre></td></tr></table></figure><h5 id="3-æ‰¹é‡åˆ›å»º-docker-ç›¸å…³ç›®å½•"><a href="#3-æ‰¹é‡åˆ›å»º-docker-ç›¸å…³ç›®å½•" class="headerlink" title="3. æ‰¹é‡åˆ›å»º docker ç›¸å…³ç›®å½•"></a>3. æ‰¹é‡åˆ›å»º docker ç›¸å…³ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m file -a &quot;path=/data/applications/docker state=directory owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h4 id="6ï¼‰ä¸‹è½½-kubernetes-ç»„ä»¶"><a href="#6ï¼‰ä¸‹è½½-kubernetes-ç»„ä»¶" class="headerlink" title="6ï¼‰ä¸‹è½½ kubernetes ç»„ä»¶"></a>6ï¼‰ä¸‹è½½ kubernetes ç»„ä»¶</h4><h5 id="1-ä¸‹è½½è§£å‹-1-18-18-server-ç»„ä»¶"><a href="#1-ä¸‹è½½è§£å‹-1-18-18-server-ç»„ä»¶" class="headerlink" title="1. ä¸‹è½½è§£å‹ 1.18.18 server ç»„ä»¶"></a>1. ä¸‹è½½è§£å‹ 1.18.18 server ç»„ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~ &amp;&amp; \<br>wget -c https://dl.k8s.io/v1.18.18/kubernetes-server-linux-amd64.tar.gz &amp;&amp; \<br>tar xf kubernetes-server-linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h6 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯:"></a>éªŒè¯:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">~/kubernetes/server/bin/kube-apiserver --version<br>~/kubernetes/server/bin/kube-controller-manager --version<br>~/kubernetes/server/bin/kube-scheduler --version<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›éƒ½å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Kubernetes v1.18.18<br></code></pre></td></tr></table></figure><h5 id="2-ä¸‹è½½è§£å‹-1-18-18-node-ç»„ä»¶"><a href="#2-ä¸‹è½½è§£å‹-1-18-18-node-ç»„ä»¶" class="headerlink" title="2. ä¸‹è½½è§£å‹ 1.18.18 node ç»„ä»¶"></a>2. ä¸‹è½½è§£å‹ 1.18.18 node ç»„ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~ &amp;&amp; \<br>wget -c https://dl.k8s.io/v1.18.18/kubernetes-node-linux-amd64.tar.gz &amp;&amp; \<br>tar xf kubernetes-node-linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h6 id="éªŒè¯-1"><a href="#éªŒè¯-1" class="headerlink" title="éªŒè¯:"></a>éªŒè¯:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">~/kubernetes/node/bin/kubelet --version<br>~/kubernetes/node/bin/kube-proxy --version<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›éƒ½å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Kubernetes v1.18.18<br></code></pre></td></tr></table></figure><h4 id="7ï¼‰åˆ†å‘-Kubernetes-ç»„ä»¶"><a href="#7ï¼‰åˆ†å‘-Kubernetes-ç»„ä»¶" class="headerlink" title="7ï¼‰åˆ†å‘ Kubernetes ç»„ä»¶"></a>7ï¼‰åˆ†å‘ Kubernetes ç»„ä»¶</h4><h5 id="1-åˆ†å‘-server-ç»„ä»¶è‡³å„-master-èŠ‚ç‚¹"><a href="#1-åˆ†å‘-server-ç»„ä»¶è‡³å„-master-èŠ‚ç‚¹" class="headerlink" title="1. åˆ†å‘ server ç»„ä»¶è‡³å„ master èŠ‚ç‚¹"></a>1. åˆ†å‘ server ç»„ä»¶è‡³å„ master èŠ‚ç‚¹</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ kube-apiserver</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/bin/kube-apiserver dest=/data/applications/kubernetes/bin/kube-apiserver owner=root group=root mode=0755&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ kube-controller-manager</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/bin/kube-controller-manager dest=/data/applications/kubernetes/bin/kube-controller-manager owner=root group=root mode=0755&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ kube-scheduler</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/bin/kube-scheduler dest=/data/applications/kubernetes/bin/kube-scheduler owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h5 id="2-åˆ†å‘-node-ç»„ä»¶è‡³å„-node-èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬-master-èŠ‚ç‚¹ï¼‰"><a href="#2-åˆ†å‘-node-ç»„ä»¶è‡³å„-node-èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬-master-èŠ‚ç‚¹ï¼‰" class="headerlink" title="2. åˆ†å‘ node ç»„ä»¶è‡³å„ node èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ master èŠ‚ç‚¹ï¼‰"></a>2. åˆ†å‘ node ç»„ä»¶è‡³å„ node èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬ master èŠ‚ç‚¹ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ kubelet</span><br>ansible k8s-node -S -R root -m copy -a &quot;src=~/kubernetes/node/bin/kubelet dest=/data/applications/kubernetes/bin/kubelet owner=root group=root mode=0755&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ kube-proxy</span><br>ansible k8s-node -S -R root -m copy -a &quot;src=~/kubernetes/node/bin/kube-proxy dest=/data/applications/kubernetes/bin/kube-proxy owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h4 id="8ï¼‰å®‰è£…-docker-ç¯å¢ƒ"><a href="#8ï¼‰å®‰è£…-docker-ç¯å¢ƒ" class="headerlink" title="8ï¼‰å®‰è£… docker ç¯å¢ƒ"></a>8ï¼‰å®‰è£… docker ç¯å¢ƒ</h4><blockquote><p>ğŸš© <strong>å…³äºæ˜¯å¦éœ€è¦å‡çº§ç³»ç»Ÿå†…æ ¸çš„æƒ…å†µè¯´æ˜</strong></p><p>CentOS 7.x ç³»ç»Ÿè‡ªå¸¦çš„ 3.10.x çš„å†…æ ¸å­˜åœ¨ä¸å®¹å™¨å…¼å®¹æ€§ä¸Šçš„é—®é¢˜ï¼Œä¼šå¯¼è‡´ Dockerã€Kubernetes è¿è¡Œä¸ç¨³å®šï¼Œæ¯”å¦‚ï¼š</p><ul><li>docker 1.13 ç‰ˆæœ¬åé»˜è®¤å¯ç”¨äº† 3.10 å†…æ ¸å®éªŒæ”¯æŒçš„ <code>kernel memory account</code> åŠŸèƒ½ä¸”æ— æ³•å…³é—­ï¼Œå½“èŠ‚ç‚¹å‹åŠ›å¤§ã€é¢‘ç¹å¯åŠ¨å’Œåœæ­¢å®¹å™¨æ—¶ä¼šå¯¼è‡´ <code>cgroup memory leak</code>ï¼›</li><li>ç½‘ç»œè®¾å¤‡å¼•ç”¨çš„è®¡æ•°æ³„æ¼ä¼šå¯¼è‡´ç±»ä¼¼æŠ¥é”™: <code>&quot;kernel:unregister_netdevice: waiting for eth0 to become free. Usage count = 1&quot;</code></li></ul><p><strong>é’ˆå¯¹è¿™ç§é—®é¢˜æœ‰å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆ:</strong></p><p>1.å‡çº§å†…æ ¸ç›´ 4.4.x ä»¥ä¸Šï¼ˆå·²åšå…¼å®¹æ€§å¤„ç†ï¼‰</p><p>2.æ‰‹åŠ¨ç¼–è¯‘å†…æ ¸ï¼Œdisable æ‰ <code>CONFIG_MEMCG_KMEM</code> ç‰¹æ€§</p><p>3.Docker 18.09.1 ç‰ˆæœ¬èµ·å·²ä¿®å¤äº†è¯¥å…¼å®¹æ€§é—®é¢˜ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç›´æ¥é€‰æ‹©å®‰è£…é«˜ç‰ˆæœ¬çš„ Dockerï¼›ä½†ç”±äº kubelet ä¹Ÿä¼šè®¾ç½® kmemï¼ˆå®ƒ vendor äº† runcï¼‰ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°ç¼–è¯‘ kubelet å¹¶æŒ‡å®š GOFLAGS=<code>&quot;-tags=nokmem&quot;</code></p><p>ğŸŒˆ <strong>è§£å†³æ–¹æ¡ˆæ–‡æ¡£</strong></p><p>å¯çœ‹ä¹‹å‰çš„åšå®¢ï¼Œ<a href="https://tareya.github.io/2021/09/27/Kubernetes-kmem-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">Kubernetes kmem å†…å­˜æ³„æ¼é—®é¢˜è§£å†³æ–¹æ¡ˆ</a></p><p>ğŸŒŸ <strong>æ‰¹é‡æ›¿æ¢ runc</strong></p><p><a href="https://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/runc">å·²å¤„ç† kmem runc äºŒè¿›åˆ¶åŒ…ä¸‹è½½</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible all -S -R root -m copy -a &quot;src=runc dest=/usr/bin/runc owner=root group=root mode=0755&quot;<br>ansible all -S -R root -m copy -a &quot;src=runc dest=/usr/bin/docker-runc owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure></blockquote><h5 id="1-è‡ªåŠ¨å®‰è£…å‡çº§è„šæœ¬"><a href="#1-è‡ªåŠ¨å®‰è£…å‡çº§è„šæœ¬" class="headerlink" title="1. è‡ªåŠ¨å®‰è£…å‡çº§è„šæœ¬"></a>1. è‡ªåŠ¨å®‰è£…å‡çº§è„šæœ¬</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; /tmp/install-docker.sh &lt;&lt; END<br><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br><br>echo &quot;Docker ä¸€é”®å®‰è£…å¼€å§‹ï¼&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> æ¸…ç†æ®‹ç•™ç‰ˆæœ¬</span><br>yum remove -y docker \<br>docker-client \<br>docker-client-latest \<br>docker-common \<br>docker-latest \<br>docker-latest-logrotate \<br>docker-logrotate \<br>docker-engine &amp;&amp; \<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®å­˜å‚¨åº“</span><br>yum install -y yum-utils \<br>  device-mapper-persistent-data \<br>  lvm2 wget&amp;&amp; \<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> æ·»åŠ  yum æº</span><br>wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo &amp;&amp; \<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ä¿®æ”¹å›½å†…é•œåƒæº</span><br>sed -i &#x27;s#download.docker.com#mirrors.tuna.tsinghua.edu.cn/docker-ce#g&#x27; /etc/yum.repos.d/docker-ce.repo &amp;&amp; \<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼ˆä¹Ÿå¯ä»¥æŒ‡å®šç‰ˆæœ¬ï¼Œå¦‚ docker-ce-18.09.5-3.el7ï¼‰</span><br>yum install -y docker-ce &amp;&amp; \<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> æ·»åŠ å¼€æœºè‡ªå¯</span><br>systemctl enable docker <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ç”Ÿæˆ docker é•œåƒåŠ é€Ÿåœ°å€ä»¥åŠæ—¥å¿—æ¸…ç†çš„é…ç½®æ–‡ä»¶ã€‚</span><br>if [ ! -d &quot;/etc/docker&quot; ]; then<br>mkdir /etc/docker<br>fi<br><br>cat &gt; /etc/docker/daemon.json &lt;&lt; EOF<br>&#123;<br>  &quot;registry-mirrors&quot;: [&quot;https://5a8zducs.mirror.aliyuncs.com&quot;],<br>  &quot;log-driver&quot;:&quot;json-file&quot;,<br>  &quot;log-opts&quot;: &#123;&quot;max-size&quot;:&quot;500m&quot;, &quot;max-file&quot;:&quot;3&quot;&#125;<br>&#125;<br>EOF<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> å¯åŠ¨ docker (å› ä¸ºè¦æ›´æ”¹ docker æ•°æ®ç›®å½•ï¼Œå»ºè®®ä¸ç›´æ¥å¯åŠ¨)</span><br><span class="hljs-meta">#</span><span class="bash"> systemctl start docker</span><br><br>echo &quot;Docker å®‰è£…å·²å®Œæˆ!&quot;<br><br>docker version<br><br>END<br></code></pre></td></tr></table></figure><h5 id="2-æ–°å»º-docker-systemd-unit-é…ç½®"><a href="#2-æ–°å»º-docker-systemd-unit-é…ç½®" class="headerlink" title="2. æ–°å»º docker systemd unit é…ç½®"></a>2. æ–°å»º docker systemd unit é…ç½®</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; docker.service &lt;&lt; EOF<br>[Unit]<br>Description=Docker Application Container Engine<br>Documentation=https://docs.docker.com<br>After=network-online.target firewalld.service containerd.service<br>Wants=network-online.target<br>Requires=docker.socket containerd.service<br><br>[Service]<br>Type=notify<br><span class="hljs-meta">#</span><span class="bash"> the default is not to use systemd <span class="hljs-keyword">for</span> cgroups because the delegate issues still</span><br><span class="hljs-meta">#</span><span class="bash"> exists and systemd currently does not support the cgroup feature <span class="hljs-built_in">set</span> required</span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-keyword">for</span> containers run by docker</span><br>ExecStart=/usr/bin/dockerd -H fd:// --graph=/data/applications/docker --containerd=/run/containerd/containerd.sock<br>ExecReload=/bin/kill -s HUP $MAINPID<br>TimeoutSec=0<br>RestartSec=2<br>Restart=always<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Note that StartLimit* options were moved from <span class="hljs-string">&quot;Service&quot;</span> to <span class="hljs-string">&quot;Unit&quot;</span> <span class="hljs-keyword">in</span> systemd 229.</span><br><span class="hljs-meta">#</span><span class="bash"> Both the old, and new location are accepted by systemd 229 and up, so using the old location</span><br><span class="hljs-meta">#</span><span class="bash"> to make them work <span class="hljs-keyword">for</span> either version of systemd.</span><br>StartLimitBurst=3<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Note that StartLimitInterval was renamed to StartLimitIntervalSec <span class="hljs-keyword">in</span> systemd 230.</span><br><span class="hljs-meta">#</span><span class="bash"> Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span><br><span class="hljs-meta">#</span><span class="bash"> this option work <span class="hljs-keyword">for</span> either version of systemd.</span><br>StartLimitInterval=60s<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-keyword">in</span> the kernel. We recommend using cgroups to <span class="hljs-keyword">do</span> container-local accounting.</span><br>LimitNOFILE=infinity<br>LimitNPROC=infinity<br>LimitCORE=infinity<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Comment TasksMax <span class="hljs-keyword">if</span> your systemd version does not support it.</span><br><span class="hljs-meta">#</span><span class="bash"> Only systemd 226 and above support this option.</span><br>TasksMax=infinity<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">set</span> delegate yes so that systemd does not reset the cgroups of docker containers</span><br>Delegate=yes<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">kill</span> only the docker process, not all processes <span class="hljs-keyword">in</span> the cgroup</span><br>KillMode=process<br>OOMScoreAdjust=-500<br><br>[Install]<br>WantedBy=multi-user.target<br><br>EOF<br></code></pre></td></tr></table></figure><h5 id="3-åˆ†å‘-systemd-unit-é…ç½®"><a href="#3-åˆ†å‘-systemd-unit-é…ç½®" class="headerlink" title="3. åˆ†å‘ systemd unit é…ç½®"></a>3. åˆ†å‘ systemd unit é…ç½®</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible all -S -R root -m copy -a &quot;src=docker.service dest=/usr/lib/systemd/system/docker.service owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="4-æ‰¹é‡å¯åŠ¨-docker"><a href="#4-æ‰¹é‡å¯åŠ¨-docker" class="headerlink" title="4. æ‰¹é‡å¯åŠ¨ docker"></a>4. æ‰¹é‡å¯åŠ¨ docker</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible all -S -R root -m shell -a &quot;systemctl daemon-reload&quot;<br>ansible all -S -R root -m shell -a &quot;systemctl restart docker&quot;<br></code></pre></td></tr></table></figure><h5 id="5-éªŒè¯"><a href="#5-éªŒè¯" class="headerlink" title="5. éªŒè¯"></a>5. éªŒè¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ll /data/applications/docker/<br></code></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µï¼Œå­˜å‚¨ç›®å½•å·²è½¬ç§»è‡³<code>/data/applications/docker</code></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210930134233588.png" alt="image-20210930134233588"></p><h3 id="2ã€ç”Ÿæˆè¯ä¹¦"><a href="#2ã€ç”Ÿæˆè¯ä¹¦" class="headerlink" title="2ã€ç”Ÿæˆè¯ä¹¦"></a>2ã€ç”Ÿæˆè¯ä¹¦</h3><h4 id="1ï¼‰å‰æœŸå‡†å¤‡"><a href="#1ï¼‰å‰æœŸå‡†å¤‡" class="headerlink" title="1ï¼‰å‰æœŸå‡†å¤‡"></a>1ï¼‰å‰æœŸå‡†å¤‡</h4><h5 id="1-å®‰è£…-cfssl-å·¥å…·"><a href="#1-å®‰è£…-cfssl-å·¥å…·" class="headerlink" title="1. å®‰è£… cfssl å·¥å…·"></a>1. å®‰è£… cfssl å·¥å…·</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">export CFSSL_URL=&quot;https://pkg.cfssl.org/R1.2&quot;<br>wget &quot;$&#123;CFSSL_URL&#125;/cfssl_linux-amd64&quot; -O /usr/bin/cfssl<br>wget &quot;$&#123;CFSSL_URL&#125;/cfssljson_linux-amd64&quot; -O /usr/bin/cfssljson<br>wget &quot;$&#123;CFSSL_URL&#125;/cfssl-certinfo_linux-amd64&quot; -O /usr/bin/cfssl-certinfo<br>chmod +x /usr/bin/cfssl*<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºè¯ä¹¦ç»Ÿä¸€ç®¡ç†ç›®å½•ï¼ˆç”±æ­¤åˆ†å‘è‡³æ­£å¼ç›®å½•ï¼‰"><a href="#2-åˆ›å»ºè¯ä¹¦ç»Ÿä¸€ç®¡ç†ç›®å½•ï¼ˆç”±æ­¤åˆ†å‘è‡³æ­£å¼ç›®å½•ï¼‰" class="headerlink" title="2. åˆ›å»ºè¯ä¹¦ç»Ÿä¸€ç®¡ç†ç›®å½•ï¼ˆç”±æ­¤åˆ†å‘è‡³æ­£å¼ç›®å½•ï¼‰"></a>2. åˆ›å»ºè¯ä¹¦ç»Ÿä¸€ç®¡ç†ç›®å½•ï¼ˆç”±æ­¤åˆ†å‘è‡³æ­£å¼ç›®å½•ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p ~/tls<br></code></pre></td></tr></table></figure><h5 id="3-åˆ›å»º-k8s-ç›¸å…³ç»„ä»¶ã€é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ç›®å½•ï¼ˆç”±æ­¤åˆ†å‘è‡³æ­£å¼ç›®å½•ï¼‰"><a href="#3-åˆ›å»º-k8s-ç›¸å…³ç»„ä»¶ã€é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ç›®å½•ï¼ˆç”±æ­¤åˆ†å‘è‡³æ­£å¼ç›®å½•ï¼‰" class="headerlink" title="3. åˆ›å»º k8s ç›¸å…³ç»„ä»¶ã€é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ç›®å½•ï¼ˆç”±æ­¤åˆ†å‘è‡³æ­£å¼ç›®å½•ï¼‰"></a>3. åˆ›å»º k8s ç›¸å…³ç»„ä»¶ã€é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ç›®å½•ï¼ˆç”±æ­¤åˆ†å‘è‡³æ­£å¼ç›®å½•ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p ~/kubernetes/&#123;server,node,client,etcd,network,prometheus,nginx&#125;/&#123;cfg,systemd&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç”Ÿæˆ-ca-æ ¹è¯ä¹¦"><a href="#2ï¼‰ç”Ÿæˆ-ca-æ ¹è¯ä¹¦" class="headerlink" title="2ï¼‰ç”Ÿæˆ ca æ ¹è¯ä¹¦"></a>2ï¼‰ç”Ÿæˆ ca æ ¹è¯ä¹¦</h4><blockquote><p>ğŸš© <strong>æç¤ºï¼š</strong></p><p>ca è¯ä¹¦æ˜¯é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹å¯ä»¥å…±äº«çš„ï¼Œæ‰€ä»¥åªéœ€è¦åˆ›å»ºä¸€ä¸ª ca è¯ä¹¦å³å¯ï¼Œåç»­åˆ›å»ºçš„æ‰€æœ‰è¯ä¹¦éƒ½ç”±å…¶ç­¾å‘ã€‚</p></blockquote><h5 id="1-åˆ›å»º-ca-é…ç½®æ–‡ä»¶"><a href="#1-åˆ›å»º-ca-é…ç½®æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º ca é…ç½®æ–‡ä»¶"></a>1. åˆ›å»º ca é…ç½®æ–‡ä»¶</h5><blockquote><p>ğŸŒˆ  ca é…ç½®æ–‡ä»¶ç”¨äºé…ç½®æ ¹è¯ä¹¦çš„ä½¿ç”¨åœºæ™¯ï¼ˆprofileï¼‰ å’Œå…·ä½“å‚æ•° (usagesï¼Œè¿‡æœŸæ—¶é—´ã€æœåŠ¡ç«¯è®¤è¯ã€å®¢æˆ·ç«¯è®¤è¯ã€åŠ å¯†ç­‰)ï¼Œåç»­åœ¨ç­¾åå…¶å®ƒè¯ä¹¦æ—¶éœ€è¦æŒ‡å®šç‰¹å®šåœºæ™¯ã€‚</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json">cat &gt; ~/tls/ca-config.json &lt;&lt;EOF<br>&#123;<br>  <span class="hljs-attr">&quot;signing&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;default&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;expiry&quot;</span>: <span class="hljs-string">&quot;87600h&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;profiles&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;kubernetes&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;usages&quot;</span>: [<br>            <span class="hljs-string">&quot;signing&quot;</span>,<br>            <span class="hljs-string">&quot;key encipherment&quot;</span>,<br>            <span class="hljs-string">&quot;server auth&quot;</span>,<br>            <span class="hljs-string">&quot;client auth&quot;</span><br>        ],<br>        <span class="hljs-attr">&quot;expiry&quot;</span>: <span class="hljs-string">&quot;87600h&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜"><a href="#é…ç½®å‚æ•°è¯´æ˜" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><table><thead><tr><th>å‚æ•°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td>signing</td><td>è¡¨ç¤ºè¯¥è¯ä¹¦å¯ç”¨äºç­¾åå…¶ä»–è¯ä¹¦ï¼Œç”Ÿæˆçš„ ca.pem è¯ä¹¦ä¸­ CA=TRUE</td></tr><tr><td>server auth</td><td>è¡¨ç¤º client å¯ä»¥é€šè¿‡è¯¥è¯ä¹¦å¯¹ server æä¾›çš„è¯ä¹¦è¿›è¡ŒéªŒè¯</td></tr><tr><td>client auth</td><td>è¡¨ç¤º server å¯ä»¥é€šè¿‡è¯¥è¯ä¹¦å¯¹ client æä¾›çš„è¯ä¹¦è¿›è¡ŒéªŒè¯</td></tr><tr><td>expiry</td><td>è¿‡æœŸæ—¶é—´ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º 8760hï¼Œå³1å¹´</td></tr></tbody></table><h5 id="2-åˆ›å»º-ca-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"><a href="#2-åˆ›å»º-ca-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶" class="headerlink" title="2. åˆ›å»º ca è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"></a>2. åˆ›å»º ca è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/tls/ca-csr.json &lt;&lt;EOF<br>&#123;<br>  &quot;CN&quot;: &quot;kubernetes&quot;,<br>  &quot;key&quot;: &#123;<br>    &quot;algo&quot;: &quot;rsa&quot;,<br>    &quot;size&quot;: 2048<br>  &#125;,<br>  &quot;names&quot;: [<br>    &#123;<br>      &quot;C&quot;: &quot;CN&quot;,<br>      &quot;ST&quot;: &quot;BeiJing&quot;,<br>      &quot;L&quot;: &quot;BeiJing&quot;,<br>      &quot;O&quot;: &quot;k8s&quot;,<br>      &quot;OU&quot;: &quot;system&quot;<br>    &#125;<br>  ],<br>  &quot;ca&quot;: &#123;<br>      &quot;expiry&quot;: &quot;87600h&quot;<br>  &#125;<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜-1"><a href="#é…ç½®å‚æ•°è¯´æ˜-1" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><table><thead><tr><th>å‚æ•°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td>CN</td><td>Common Nameï¼Œkube-apiserver ä¼šä»è¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºè¯·æ±‚çš„ç”¨æˆ·åï¼ˆUser Nameï¼‰ã€æµè§ˆå™¨ä½¿ç”¨è¯¥å­—æ®µéªŒè¯ç½‘ç«™çš„åˆæ³•æ€§</td></tr><tr><td>C</td><td>Countryï¼Œå›½å®¶</td></tr><tr><td>L</td><td>Localityï¼Œåœ°åŒºï¼ŒåŸå¸‚</td></tr><tr><td>ST</td><td>Stateï¼Œæ´²ï¼Œçœ</td></tr><tr><td>O</td><td>Organizationï¼Œç»„ç»‡åç§°ï¼Œå…¬å¸åç§°ï¼Œkube-apiserver ä¼šä»è¯ä¹¦ä¸­æå–è¯¥å­—æ®µä½œä¸ºç”¨æˆ·æ‰€å±çš„ç»„ï¼ˆGroupï¼‰</td></tr><tr><td>OU</td><td>Organization Unitï¼Œç»„ç»‡å•ä½åç§°ï¼Œå…¬å¸éƒ¨é—¨</td></tr></tbody></table><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>kube-apiserver ä¼šæå– Group å’Œ User ä½œä¸º K8S RBAC æˆæƒçš„ç”¨æˆ·æ ‡è¯†ï¼Œæ‰€ä»¥ CN å’Œ O çš„å‘½åå’Œé‡è¦ï¼Œå»ºè®®å‘½åè¦è§„èŒƒã€‚</p></blockquote><h5 id="3-ç”Ÿæˆ-CA-è¯ä¹¦å’Œç§é’¥"><a href="#3-ç”Ÿæˆ-CA-è¯ä¹¦å’Œç§é’¥" class="headerlink" title="3. ç”Ÿæˆ CA è¯ä¹¦å’Œç§é’¥"></a>3. ç”Ÿæˆ CA è¯ä¹¦å’Œç§é’¥</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~/tls &amp;&amp; \<br>cfssl gencert -initca ca-csr.json | cfssljson -bare ca<br></code></pre></td></tr></table></figure><h5 id="4-è¯ä¹¦æ–‡ä»¶è¯´æ˜"><a href="#4-è¯ä¹¦æ–‡ä»¶è¯´æ˜" class="headerlink" title="4. è¯ä¹¦æ–‡ä»¶è¯´æ˜"></a>4. è¯ä¹¦æ–‡ä»¶è¯´æ˜</h5><table><thead><tr><th>è¯ä¹¦è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>~/tls/ca.csr</td><td>ca è¯ä¹¦çš„ç­¾åè¯·æ±‚æ–‡ä»¶</td></tr><tr><td>~/tls/ca.pem</td><td>ca è¯ä¹¦æ–‡ä»¶ï¼Œå³åé¢ K8S ç»„ä»¶ä½¿ç”¨çš„ RootCA</td></tr><tr><td>~/tls/ca-key.pem</td><td>ca è¯ä¹¦çš„ç§é’¥æ–‡ä»¶</td></tr></tbody></table><h5 id="5-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶"><a href="#5-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶" class="headerlink" title="5. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶"></a>5. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ ca è¯ä¹¦ï¼ˆk8s æ‰€æœ‰èŠ‚ç‚¹ã€etcd æ‰€æœ‰èŠ‚ç‚¹ï¼‰</span><br>ansible k8s-node -S -R root -m copy -a &quot;src=~/tls/ca.pem dest=/data/applications/kubernetes/ssl/ca.pem owner=root group=root mode=0644&quot; <br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/ca.pem dest=/data/applications/etcd/ssl/ca.pem owner=root group=root mode=0644&quot; <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ ca è¯ä¹¦ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œæƒé™è®¾ç½®ä»–äººæ— æƒé™ï¼ˆk8s masterèŠ‚ç‚¹ã€etcd æ‰€æœ‰èŠ‚ç‚¹ï¼‰</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/ca-key.pem  dest=/data/applications/kubernetes/ssl/ca-key.pem owner=root group=root mode=0600&quot; <br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/ca-key.pem  dest=/data/applications/etcd/ssl/ca-key.pem owner=root group=root mode=0600&quot; <br></code></pre></td></tr></table></figure><h4 id="3ï¼‰ç”Ÿæˆ-server-è¯ä¹¦"><a href="#3ï¼‰ç”Ÿæˆ-server-è¯ä¹¦" class="headerlink" title="3ï¼‰ç”Ÿæˆ server è¯ä¹¦"></a>3ï¼‰ç”Ÿæˆ server è¯ä¹¦</h4><blockquote><p>ğŸš© <strong>æç¤º:</strong></p><p>æ­¤å¤„ç”Ÿæˆçš„ server è¯ä¹¦åŒæ—¶å¯æä¾› etcd é›†ç¾¤å’Œ kube-apiserver ä½¿ç”¨ï¼ˆå¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ‹†åˆ†æˆ2å¥—ï¼‰</p></blockquote><h5 id="1-åˆ›å»º-server-ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"><a href="#1-åˆ›å»º-server-ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º server ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"></a>1. åˆ›å»º server ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/tls/server-csr.json &lt;&lt;EOF<br>&#123;<br>    &quot;CN&quot;: &quot;kubernetes&quot;,<br>    &quot;hosts&quot;: [<br>      &quot;10.0.0.1&quot;,<br>      &quot;127.0.0.1&quot;,<br>      &quot;192.168.3.230&quot;,<br>      &quot;192.168.3.231&quot;,<br>      &quot;192.168.3.232&quot;,<br>      &quot;192.168.3.233&quot;,<br>      &quot;k8s-master01&quot;,<br>      &quot;k8s-master02&quot;,<br>      &quot;k8s-master03&quot;,<br>      &quot;etcd-01&quot;,<br>      &quot;etcd-02&quot;,<br>      &quot;etcd-03&quot;,<br>      &quot;kubernetes&quot;,<br>      &quot;kubernetes.default&quot;,<br>      &quot;kubernetes.default.svc&quot;,<br>      &quot;kubernetes.default.svc.cluster&quot;,<br>      &quot;kubernetes.default.svc.cluster.local&quot;<br>    ],<br>    &quot;key&quot;: &#123;<br>        &quot;algo&quot;: &quot;rsa&quot;,<br>        &quot;size&quot;: 2048<br>    &#125;,<br>    &quot;names&quot;: [<br>        &#123;<br>            &quot;C&quot;: &quot;CN&quot;,<br>            &quot;L&quot;: &quot;BeiJing&quot;,<br>            &quot;ST&quot;: &quot;BeiJing&quot;,<br>            &quot;O&quot;: &quot;k8s&quot;,<br>            &quot;OU&quot;: &quot;System&quot;<br>        &#125;<br>    ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>å¦‚æœ hosts å­—æ®µçš„å€¼ä¸ä¸ºç©ºå°±éœ€è¦æŒ‡å®šå…·ä½“æˆæƒçš„ IP å’Œ åŸŸååˆ—è¡¨ï¼Œè¿™é‡Œåˆ—å‡ºäº† vipã€apiserver èŠ‚ç‚¹ ipã€kubernetes æœåŠ¡ ip å’ŒåŸŸå</p><p>server è¯ä¹¦åç»­ä¼šè¢« etcd é›†ç¾¤å’Œ K8S master èŠ‚ç‚¹ä½¿ç”¨ï¼Œæ‰€ä»¥è¦å°† etcdã€master èŠ‚ç‚¹å’Œ kube-apiserver çš„vipéƒ½å¡«ä¸Šï¼ŒåŒæ—¶è¿˜æœ‰service ç½‘ç»œçš„é¦–IPä¹Ÿéœ€è¦å¡«ä¸Šã€‚(ä¸€èˆ¬æ˜¯ kube-apiserver æŒ‡å®š <code>--service-cluster-ip-range</code> çš„ç½‘æ®µçš„ç¬¬ä¸€ä¸ªIPï¼Œå¦‚ 10.0.0.1)</p><hr><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨åŸŸåçš„è¯ï¼ŒåŸŸåæœ€åçš„å­—ç¬¦ä¸èƒ½æ˜¯ . ï¼Œå¦‚ä¸èƒ½ä¸º <code>kubernetes.default.svc.cluster.local.</code> ã€‚è™½ç„¶æŒ‰å¸¸è§„dnsè§£æçš„è¯æœ€åå¸¦ . è¡¨ç¤ºæ ¹åŸŸï¼Œä½†æ˜¯åœ¨ k8s ä¸­ä¼šå¯¼è‡´è§£æå¤±è´¥ï¼Œæç¤º <code>x509: cannot parse dnsName &quot;kubernetes.default.svc.cluster.local.&quot;</code></p><p>å¦å¤–ï¼Œå¦‚æœè¦ä½¿ç”¨é <code>cluster.local</code> çš„åŸŸåï¼Œå¦‚ <code>tareya.cn</code>ï¼Œåˆ™éœ€è¦ä¿®æ”¹åŸŸååˆ—è¡¨ä¸­æœ€åä¸¤ä¸ªåŸŸåä¸º <code>kubernetes.default.svc.tareya</code> å’Œ <code>kubernetes.default.svc.tareya.cn</code></p></blockquote><h5 id="2-ç”Ÿæˆ-server-è¯ä¹¦å’Œç§é’¥"><a href="#2-ç”Ÿæˆ-server-è¯ä¹¦å’Œç§é’¥" class="headerlink" title="2. ç”Ÿæˆ server è¯ä¹¦å’Œç§é’¥"></a>2. ç”Ÿæˆ server è¯ä¹¦å’Œç§é’¥</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~/tls &amp;&amp; \<br>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server<br></code></pre></td></tr></table></figure><h5 id="3-è¯ä¹¦æ–‡ä»¶è¯´æ˜"><a href="#3-è¯ä¹¦æ–‡ä»¶è¯´æ˜" class="headerlink" title="3. è¯ä¹¦æ–‡ä»¶è¯´æ˜"></a>3. è¯ä¹¦æ–‡ä»¶è¯´æ˜</h5><table><thead><tr><th>è¯ä¹¦è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>~/tls/server.csr</td><td>server è¯ä¹¦çš„ç­¾åè¯·æ±‚æ–‡ä»¶</td></tr><tr><td>~/tls/server.pem</td><td>server è¯ä¹¦ï¼Œä¸º etcdã€kube-apiserver ä½¿ç”¨</td></tr><tr><td>~/tls/server-key.pem</td><td>server è¯ä¹¦çš„ç§é’¥æ–‡ä»¶</td></tr></tbody></table><h5 id="4-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶"><a href="#4-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶" class="headerlink" title="4. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶"></a>4. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ server è¯ä¹¦ï¼ˆk8s masterèŠ‚ç‚¹ã€etcd æ‰€æœ‰èŠ‚ç‚¹ï¼‰</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/server.pem dest=/data/applications/kubernetes/ssl/server.pem owner=root group=root mode=0644&quot; <br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/server.pem dest=/data/applications/etcd/ssl/server.pem owner=root group=root mode=0644&quot; <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ server è¯ä¹¦ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œæƒé™è®¾ç½®ä»–äººæ— æƒé™ï¼ˆk8s masterèŠ‚ç‚¹ã€etcd æ‰€æœ‰èŠ‚ç‚¹ï¼‰</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/server-key.pem dest=/data/applications/kubernetes/ssl/server-key.pem owner=root group=root mode=0600&quot; <br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/server-key.pem dest=/data/applications/etcd/ssl/server-key.pem owner=root group=root mode=0600&quot; <br></code></pre></td></tr></table></figure><h4 id="4ï¼‰ç”Ÿæˆ-etcd-è¯ä¹¦"><a href="#4ï¼‰ç”Ÿæˆ-etcd-è¯ä¹¦" class="headerlink" title="4ï¼‰ç”Ÿæˆ etcd è¯ä¹¦"></a>4ï¼‰ç”Ÿæˆ etcd è¯ä¹¦</h4><h4 id="5ï¼‰ç”Ÿæˆ-admin-è¯ä¹¦"><a href="#5ï¼‰ç”Ÿæˆ-admin-è¯ä¹¦" class="headerlink" title="5ï¼‰ç”Ÿæˆ admin è¯ä¹¦"></a>5ï¼‰ç”Ÿæˆ admin è¯ä¹¦</h4><blockquote><p>ğŸš© <strong>æç¤º:</strong></p><p>k8s çš„å®¢æˆ·ç«¯å·¥å…·ï¼ˆå¦‚ kubectlï¼‰å’Œ apiserver ä¹‹é—´æ˜¯é€šè¿‡ httpså®‰å…¨ç«¯å£è¿›è¡Œé€šä¿¡ï¼Œapiserver ä¼šå¯¹å®¢æˆ·ç«¯æä¾›çš„è¯ä¹¦è¿›è¡Œè®¤è¯ã€æˆæƒã€‚å®¢æˆ·ç«¯å·¥å…·é€šè¿‡ kubeconfig æ–‡ä»¶æ¥è¿›è¡Œé‰´æƒã€‚</p><p>kubectl ä½œä¸ºæ•´ä¸ªé›†ç¾¤çš„ç®¡ç†å·¥å…·ï¼Œéœ€è¦è¢«æˆäºˆæœ€é«˜çš„æƒé™ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬åˆ›å»ºå…·æœ‰æœ€é«˜æƒé™çš„ admin è¯ä¹¦ã€‚</p></blockquote><h5 id="1-åˆ›å»º-admin-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"><a href="#1-åˆ›å»º-admin-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º admin è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"></a>1. åˆ›å»º admin è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/tls/admin-csr.json &lt;&lt;EOF<br>&#123;<br>  &quot;CN&quot;: &quot;admin&quot;,<br>  &quot;hosts&quot;: [],<br>  &quot;key&quot;: &#123;<br>    &quot;algo&quot;: &quot;rsa&quot;,<br>    &quot;size&quot;: 2048<br>  &#125;,<br>  &quot;names&quot;: [<br>    &#123;<br>      &quot;C&quot;: &quot;CN&quot;,<br>      &quot;ST&quot;: &quot;BeiJing&quot;,<br>      &quot;L&quot;: &quot;BeiJing&quot;,<br>      &quot;O&quot;: &quot;system:masters&quot;,<br>      &quot;OU&quot;: &quot;system&quot;<br>    &#125;<br>  ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜-2"><a href="#é…ç½®å‚æ•°è¯´æ˜-2" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><blockquote><p>è¿™é‡Œå°† O è®¾ç½®ä¸º <code>system:masters</code>ï¼Œkube-apiserver ä¼šæå–è¯¥å­—æ®µï¼Œå°†è¯·æ±‚çš„ Group è®¾ç½®ä¸º <code>system:masters</code>ï¼›</p><p>Kube-apiserver é¢„å®šä¹‰çš„ ClusterRoleBinding <code>cluster-admin</code> å°† Group <code>system:masters</code> å’Œ ClusterRole <code>cluster-admin</code> ç»‘å®šï¼Œè¯¥ Role æˆæƒè®¿é—®æ‰€æœ‰ API çš„æƒé™ï¼›</p><p>è¯¥è¯ä¹¦åªä¼šè¢« kubectl å½“ä½œ client è¯ä¹¦ä½¿ç”¨ï¼Œå› æ­¤ hosts å­—æ®µä¸éœ€è¦é™å®šIPã€åŸŸåï¼Œè®¾ç½®ä¸ºç©ºå³å¯ã€‚</p></blockquote><h5 id="2-ç”Ÿæˆ-admin-è¯ä¹¦å’Œç§é’¥"><a href="#2-ç”Ÿæˆ-admin-è¯ä¹¦å’Œç§é’¥" class="headerlink" title="2. ç”Ÿæˆ admin è¯ä¹¦å’Œç§é’¥"></a>2. ç”Ÿæˆ admin è¯ä¹¦å’Œç§é’¥</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~/tls &amp;&amp; \<br>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin<br></code></pre></td></tr></table></figure><h5 id="3-è¯ä¹¦æ–‡ä»¶è¯´æ˜-1"><a href="#3-è¯ä¹¦æ–‡ä»¶è¯´æ˜-1" class="headerlink" title="3. è¯ä¹¦æ–‡ä»¶è¯´æ˜"></a>3. è¯ä¹¦æ–‡ä»¶è¯´æ˜</h5><table><thead><tr><th>è¯ä¹¦è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>~/tls/admin.csr</td><td>admin è¯ä¹¦çš„ç­¾åè¯·æ±‚æ–‡ä»¶</td></tr><tr><td>~/tls/admin.pem</td><td>admin è¯ä¹¦ï¼Œkubectl å’Œå…¶ä»– k8s å®¢æˆ·ç«¯ä½¿ç”¨</td></tr><tr><td>~/tls/admin-key.pem</td><td>admin è¯ä¹¦çš„ç§é’¥æ–‡ä»¶</td></tr></tbody></table><h5 id="4-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶-1"><a href="#4-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶-1" class="headerlink" title="4. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶"></a>4. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ admin è¯ä¹¦ï¼ˆk8s masterèŠ‚ç‚¹ï¼‰</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/admin.pem dest=/data/applications/kubernetes/ssl/admin.pem owner=root group=root mode=0644&quot; <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ admin è¯ä¹¦ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œæƒé™è®¾ç½®ä»–äººæ— æƒé™ï¼ˆk8s masterèŠ‚ç‚¹ï¼‰</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/admin-key.pem dest=/data/applications/kubernetes/ssl/admin-key.pem owner=root group=root mode=0600&quot; <br></code></pre></td></tr></table></figure><h4 id="6ï¼‰ç”Ÿæˆ-metrics-server-è¯ä¹¦"><a href="#6ï¼‰ç”Ÿæˆ-metrics-server-è¯ä¹¦" class="headerlink" title="6ï¼‰ç”Ÿæˆ metrics-server è¯ä¹¦"></a>6ï¼‰ç”Ÿæˆ metrics-server è¯ä¹¦</h4><h5 id="1-åˆ›å»º-metrics-server-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"><a href="#1-åˆ›å»º-metrics-server-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º metrics-server è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"></a>1. åˆ›å»º metrics-server è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/tls/metrics-server-csr.json  &lt;&lt;EOF<br>&#123;<br>  &quot;CN&quot;: &quot;system:metrics-server&quot;,<br>  &quot;hosts&quot;: [],<br>  &quot;key&quot;: &#123;<br>    &quot;algo&quot;: &quot;rsa&quot;,<br>    &quot;size&quot;: 2048<br>  &#125;,<br>  &quot;names&quot;: [<br>    &#123;<br>      &quot;C&quot;: &quot;CN&quot;,<br>      &quot;ST&quot;: &quot;BeiJing&quot;,<br>      &quot;L&quot;: &quot;BeiJing&quot;,<br>      &quot;O&quot;: &quot;k8s&quot;,<br>      &quot;OU&quot;: &quot;system&quot;<br>    &#125;<br>  ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜-3"><a href="#é…ç½®å‚æ•°è¯´æ˜-3" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><blockquote><p>è¿™é‡Œ CN è®¾å®šçš„åç§°ï¼Œéœ€è¦ä¸åç»­ metrics-server çš„ <code>--requestheader-allowed-names</code> å‚æ•°é…ç½®ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šè¢« metrics-server æ‹’ç»è®¿é—®ï¼Œ</p><p>åç»­éœ€è¦å¯¹ metrics-server è¿›è¡Œä¸“é—¨çš„ RBAC æˆæƒï¼Œå»ºè®® CN é…ç½®å’Œ RBAC æˆæƒç”¨æˆ·ä¿æŒä¸€è‡´ã€‚</p></blockquote><h5 id="2-ç”Ÿæˆ-metrics-server-è¯ä¹¦å’Œç§é’¥"><a href="#2-ç”Ÿæˆ-metrics-server-è¯ä¹¦å’Œç§é’¥" class="headerlink" title="2. ç”Ÿæˆ metrics-server è¯ä¹¦å’Œç§é’¥"></a>2. ç”Ÿæˆ metrics-server è¯ä¹¦å’Œç§é’¥</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~/tls &amp;&amp; \<br>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes metrics-server-csr.json | cfssljson -bare metrics-server<br></code></pre></td></tr></table></figure><h5 id="3-è¯ä¹¦æ–‡ä»¶è¯´æ˜-2"><a href="#3-è¯ä¹¦æ–‡ä»¶è¯´æ˜-2" class="headerlink" title="3. è¯ä¹¦æ–‡ä»¶è¯´æ˜"></a>3. è¯ä¹¦æ–‡ä»¶è¯´æ˜</h5><table><thead><tr><th>è¯ä¹¦è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>~/tls/metrics-server.csr</td><td>metrics-server è¯ä¹¦çš„ç­¾åè¯·æ±‚æ–‡ä»¶</td></tr><tr><td>~/tls/metrics-server.pem</td><td>metrics-server è¯ä¹¦ï¼Œmetrics-server ä½¿ç”¨</td></tr><tr><td>~/tls/metrics-server-key.pem</td><td>metrics-server è¯ä¹¦çš„ç§é’¥æ–‡ä»¶</td></tr></tbody></table><h5 id="4-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶-2"><a href="#4-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶-2" class="headerlink" title="4. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶"></a>4. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ metrics-server è¯ä¹¦ï¼ˆk8s masterèŠ‚ç‚¹ï¼‰</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/metrics-server.pem dest=/data/applications/kubernetes/ssl/metrics-server.pem owner=root group=root mode=0644&quot; <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ metrics-server è¯ä¹¦ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œæƒé™è®¾ç½®ä»–äººæ— æƒé™ï¼ˆk8s masterèŠ‚ç‚¹ï¼‰</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/tls/metrics-server-key.pem dest=/data/applications/kubernetes/ssl/metrics-server-key.pem owner=root group=root mode=0600&quot; <br></code></pre></td></tr></table></figure><h4 id="7ï¼‰ç”Ÿæˆ-kube-proxy-è¯ä¹¦"><a href="#7ï¼‰ç”Ÿæˆ-kube-proxy-è¯ä¹¦" class="headerlink" title="7ï¼‰ç”Ÿæˆ kube-proxy è¯ä¹¦"></a>7ï¼‰ç”Ÿæˆ kube-proxy è¯ä¹¦</h4><h5 id="1-åˆ›å»º-kube-proxy-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"><a href="#1-åˆ›å»º-kube-proxy-è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º kube-proxy è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶"></a>1. åˆ›å»º kube-proxy è¯ä¹¦ç­¾åè¯·æ±‚æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/tls/kube-proxy-csr.json &lt;&lt;EOF<br>&#123;<br>  &quot;CN&quot;: &quot;system:kube-proxy&quot;,<br>  &quot;hosts&quot;: [],<br>  &quot;key&quot;: &#123;<br>    &quot;algo&quot;: &quot;rsa&quot;,<br>    &quot;size&quot;: 2048<br>  &#125;,<br>  &quot;names&quot;: [<br>    &#123;<br>      &quot;C&quot;: &quot;CN&quot;,<br>      &quot;ST&quot;: &quot;BeiJing&quot;,<br>      &quot;L&quot;: &quot;BeiJing&quot;,<br>      &quot;O&quot;: &quot;k8s&quot;,<br>      &quot;OU&quot;: &quot;system&quot;<br>    &#125;<br>  ]<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜-4"><a href="#é…ç½®å‚æ•°è¯´æ˜-4" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><blockquote><p>è¿™é‡Œå°† CN è®¾ç½®ä¸º <code>system:kube-proxy</code>ï¼Œkube-apiserver ä¼šæå–è¯¥å­—æ®µï¼Œå°†è¯·æ±‚çš„ Userè®¾ç½®ä¸º <code>system:kube-proxy</code>ï¼›</p><p>Kube-apiserver é¢„å®šä¹‰çš„ ClusterRoleBinding <code>system:node-proxier</code> å°† User <code>system:kube-proxy</code> å’Œ ClusterRole<code>system:node-proxier </code> ç»‘å®šï¼Œè¯¥ Role æˆäºˆäº†è°ƒç”¨ kube-apiserver Proxy ç›¸å…³ API çš„æƒé™ï¼›</p><p>è¯¥è¯ä¹¦åªä¼šè¢« kube-proxy å½“ä½œ client è¯ä¹¦ä½¿ç”¨ï¼Œå› æ­¤ hosts å­—æ®µä¸éœ€è¦é™å®šIPã€åŸŸåï¼Œè®¾ç½®ä¸ºç©ºå³å¯ã€‚</p></blockquote><h5 id="2-ç”Ÿæˆ-kube-proxy-è¯ä¹¦å’Œç§é’¥"><a href="#2-ç”Ÿæˆ-kube-proxy-è¯ä¹¦å’Œç§é’¥" class="headerlink" title="2. ç”Ÿæˆ kube-proxy è¯ä¹¦å’Œç§é’¥"></a>2. ç”Ÿæˆ kube-proxy è¯ä¹¦å’Œç§é’¥</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~/tls &amp;&amp; \<br>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy<br></code></pre></td></tr></table></figure><h5 id="3-è¯ä¹¦æ–‡ä»¶è¯´æ˜-3"><a href="#3-è¯ä¹¦æ–‡ä»¶è¯´æ˜-3" class="headerlink" title="3. è¯ä¹¦æ–‡ä»¶è¯´æ˜"></a>3. è¯ä¹¦æ–‡ä»¶è¯´æ˜</h5><table><thead><tr><th>è¯ä¹¦è·¯å¾„</th><th>æè¿°</th></tr></thead><tbody><tr><td>~/tls/kube-proxy.csr</td><td>kube-proxy è¯ä¹¦çš„ç­¾åè¯·æ±‚æ–‡ä»¶</td></tr><tr><td>~/tls/kube-proxy.pem</td><td>kube-proxy è¯ä¹¦ï¼Œkube-proxy ä½¿ç”¨</td></tr><tr><td>~/tls/kube-proxy-key.pem</td><td>Kube-proxy è¯ä¹¦çš„ç§é’¥æ–‡ä»¶</td></tr></tbody></table><h5 id="4-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶-3"><a href="#4-æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶-3" class="headerlink" title="4. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶"></a>4. æ‰¹é‡åˆ†å‘è¯ä¹¦æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ kube-proxy è¯ä¹¦ï¼ˆk8s æ‰€æœ‰èŠ‚ç‚¹ï¼‰</span><br>ansible k8s-node -S -R root -m copy -a &quot;src=~/tls/kube-proxy.pem dest=/data/applications/kubernetes/ssl/kube-proxy.pem owner=root group=root mode=0644&quot; <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ kube-proxy è¯ä¹¦ç§é’¥ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œæƒé™è®¾ç½®ä»–äººæ— æƒé™ï¼ˆk8s æ‰€æœ‰èŠ‚ç‚¹ï¼‰</span><br>ansible k8s-node -S -R root -m copy -a &quot;src=~/tls/kube-proxy-key.pem dest=/data/applications/kubernetes/ssl/kube-proxy-key.pem owner=root group=root mode=0600&quot; <br></code></pre></td></tr></table></figure><h3 id="2ã€éƒ¨ç½²-kubectl-å‘½ä»¤è¡Œå·¥å…·"><a href="#2ã€éƒ¨ç½²-kubectl-å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="2ã€éƒ¨ç½² kubectl å‘½ä»¤è¡Œå·¥å…·"></a>2ã€éƒ¨ç½² kubectl å‘½ä»¤è¡Œå·¥å…·</h3><h4 id="1ï¼‰ä¸‹è½½-kubectl-äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#1ï¼‰ä¸‹è½½-kubectl-äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="1ï¼‰ä¸‹è½½ kubectl äºŒè¿›åˆ¶æ–‡ä»¶"></a>1ï¼‰ä¸‹è½½ kubectl äºŒè¿›åˆ¶æ–‡ä»¶</h4><blockquote><p><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.18.md">å®˜æ–¹ä¸‹è½½åœ°å€</a></p><p>è™½ç„¶ kubectl æ˜¯å…·å¤‡å‘ä¸‹å…¼å®¹èƒ½åŠ›çš„ï¼Œä½†æ˜¯åœ¨é€‰æ‹©ç‰ˆæœ¬æ—¶è¿˜æ˜¯å»ºè®®å°½é‡ä¸ K8S ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œå¦‚æœ¬æ–‡ K8S ç‰ˆæœ¬ä¸º 1.18.18ï¼Œæ•… kubectl ç‰ˆæœ¬ä¹Ÿé€‰ç”¨ 1.18.18 ã€‚ä¸‹è½½äºŒè¿›åˆ¶æ—¶ï¼Œæ³¨æ„å¹³å°åŒ¹é…ã€‚</p></blockquote><h5 id="1-ä¸‹è½½è§£å‹-1-18-18-kubectl-äºŒè¿›åˆ¶åŒ…"><a href="#1-ä¸‹è½½è§£å‹-1-18-18-kubectl-äºŒè¿›åˆ¶åŒ…" class="headerlink" title="1. ä¸‹è½½è§£å‹ 1.18.18 kubectl äºŒè¿›åˆ¶åŒ…"></a>1. ä¸‹è½½è§£å‹ 1.18.18 kubectl äºŒè¿›åˆ¶åŒ…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~ &amp;&amp; \<br>wget -c https://dl.k8s.io/v1.18.18/kubernetes-client-linux-amd64.tar.gz &amp;&amp; \<br>tar xf kubernetes-client-linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h5 id="2-éªŒè¯"><a href="#2-éªŒè¯" class="headerlink" title="2. éªŒè¯"></a>2. éªŒè¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd kubernetes/client/bin/ &amp;&amp; ./kubectl version<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Client Version: version.Info&#123;Major:&quot;1&quot;, Minor:&quot;18&quot;, GitVersion:&quot;v1.18.18&quot;, GitCommit:&quot;6f6ce59dc8fefde25a3ba0ef0047f4ec6662ef24&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2021-04-15T03:31:30Z&quot;, GoVersion:&quot;go1.13.15&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ†å‘-kubectl-è‡³å„-master-èŠ‚ç‚¹"><a href="#2ï¼‰åˆ†å‘-kubectl-è‡³å„-master-èŠ‚ç‚¹" class="headerlink" title="2ï¼‰åˆ†å‘ kubectl è‡³å„ master èŠ‚ç‚¹"></a>2ï¼‰åˆ†å‘ kubectl è‡³å„ master èŠ‚ç‚¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/client/bin/kubectl dest=/usr/bin/kubectl owner=root<br>group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰åˆ›å»º-kubeconfig"><a href="#3ï¼‰åˆ›å»º-kubeconfig" class="headerlink" title="3ï¼‰åˆ›å»º kubeconfig"></a>3ï¼‰åˆ›å»º kubeconfig</h4><h5 id="1-è®¾ç½®é›†ç¾¤å‚æ•°"><a href="#1-è®¾ç½®é›†ç¾¤å‚æ•°" class="headerlink" title="1. è®¾ç½®é›†ç¾¤å‚æ•°"></a>1. è®¾ç½®é›†ç¾¤å‚æ•°</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config set-cluster kubernetes \<br>  --certificate-authority=/data/applications/kubernetes/ssl/ca.pem \<br>  --embed-certs=true \<br>  --server=$&#123;KUBE_APISERVER&#125; \<br>  --kubeconfig=$HOME/.kube/kubectl.kubeconfig<br></code></pre></td></tr></table></figure><h6 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜:"></a>å‚æ•°è¯´æ˜:</h6><table><thead><tr><th>å‚æ•°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td>â€“certificate-authority</td><td>éªŒè¯ kube-apiserver è¯ä¹¦çš„æ ¹è¯ä¹¦</td></tr><tr><td>â€“embed-certs=true</td><td>å°†è¯ä¹¦å†…å®¹åŠ å¯†åµŒå…¥kubeconfigä¸­ï¼Œå¦‚æœè®¾ä¸º false åˆ™é€šè¿‡æŒ‡å‘çš„æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶</td></tr><tr><td>â€“server</td><td>apiserver çš„åŠ å¯†é€šä¿¡åœ°å€</td></tr><tr><td>â€“kubeconfig</td><td>kubeconfig ç”Ÿæˆè·¯å¾„</td></tr></tbody></table><h5 id="2-è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°"><a href="#2-è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°" class="headerlink" title="2. è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°"></a>2. è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config set-credentials admin \<br>  --client-certificate=/data/applications/kubernetes/ssl/admin.pem \<br>  --client-key=/data/applications/kubernetes/ssl/admin-key.pem \<br>  --embed-certs=true \<br>  --kubeconfig=$HOME/.kube/kubectl.kubeconfig<br></code></pre></td></tr></table></figure><h6 id="å‚æ•°è¯´æ˜-1"><a href="#å‚æ•°è¯´æ˜-1" class="headerlink" title="å‚æ•°è¯´æ˜:"></a>å‚æ•°è¯´æ˜:</h6><table><thead><tr><th>å‚æ•°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td>â€“client-certificate</td><td>è¿æ¥ apiserver æ—¶ï¼Œè®¤è¯ä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦</td></tr><tr><td>â€“client-key</td><td>è¿æ¥ apiserver æ—¶ï¼Œè®¤è¯ä½¿ç”¨çš„è¯ä¹¦ç§é’¥</td></tr></tbody></table><h5 id="3-è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°"><a href="#3-è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°" class="headerlink" title="3. è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°"></a>3. è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config set-context kubernetes \<br> --cluster=kubernetes \<br> --user=admin \<br> --kubeconfig=$HOME/.kube/kubectl.kubeconfig<br></code></pre></td></tr></table></figure><h5 id="4-è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡"><a href="#4-è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡" class="headerlink" title="4. è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡"></a>4. è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config use-context kubernetes --kubeconfig=$HOME/.kube/kubectl.kubeconfig<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰åˆ†å‘-kubeconfig-è‡³å„-master-èŠ‚ç‚¹"><a href="#4ï¼‰åˆ†å‘-kubeconfig-è‡³å„-master-èŠ‚ç‚¹" class="headerlink" title="4ï¼‰åˆ†å‘ kubeconfig è‡³å„ master èŠ‚ç‚¹"></a>4ï¼‰åˆ†å‘ kubeconfig è‡³å„ master èŠ‚ç‚¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> root ç”¨æˆ·</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=$HOME/.kube/kubectl.kubeconfig dest=/root/.kube/kubectl.kubeconfig owner=root group=root mode=0600&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> æ™®é€šç”¨æˆ·</span><br>ansible k8s-master -m copy -a &quot;src=$HOME/.kube/kubectl.kubeconfig dest=$HOME/.kube/kubectl.kubeconfig mode=0600&quot;<br></code></pre></td></tr></table></figure><h3 id="3ã€éƒ¨ç½²-etcd-é›†ç¾¤"><a href="#3ã€éƒ¨ç½²-etcd-é›†ç¾¤" class="headerlink" title="3ã€éƒ¨ç½² etcd é›†ç¾¤"></a>3ã€éƒ¨ç½² etcd é›†ç¾¤</h3><p><strong>åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” etcd:</strong> <a href="https://tareya.github.io/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-etcd/#Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-etcd">ä¼ é€é—¨</a></p><blockquote><p>ğŸŒˆ etcd ä» 3.4 ç‰ˆæœ¬å¼€å§‹ä¼šè‡ªåŠ¨é€šè¿‡é…ç½®æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡å‚æ•°ï¼ŒEnvironmentFile æ–‡ä»¶ä¸­æœ‰çš„å‚æ•°ä¸éœ€è¦åœ¨ systems unit çš„ ExecStart ä¸­æ·»åŠ äº†ï¼Œå¯ä»¥æ›´åŠ çš„ç²¾ç®€åŒ–é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæˆ‘ä»¬é€‰ç”¨ 3.4 ç‰ˆæœ¬çš„ etcdã€‚æ–¹ä¾¿åæœŸç»Ÿä¸€çš„é…ç½®ç®¡ç†ã€‚</p></blockquote><h4 id="1ï¼‰ä¸‹è½½-etcd-äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#1ï¼‰ä¸‹è½½-etcd-äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="1ï¼‰ä¸‹è½½ etcd äºŒè¿›åˆ¶æ–‡ä»¶"></a>1ï¼‰ä¸‹è½½ etcd äºŒè¿›åˆ¶æ–‡ä»¶</h4><blockquote><p><a href="https://github.com/etcd-io/etcd/releases">å®˜æ–¹ä¸‹è½½åœ°å€</a></p></blockquote><h5 id="1-ä¸‹è½½è§£å‹-3-4-14-etcd-å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äºŒè¿›åˆ¶åŒ…"><a href="#1-ä¸‹è½½è§£å‹-3-4-14-etcd-å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äºŒè¿›åˆ¶åŒ…" class="headerlink" title="1. ä¸‹è½½è§£å‹ 3.4.14 etcd å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äºŒè¿›åˆ¶åŒ…"></a>1. ä¸‹è½½è§£å‹ 3.4.14 etcd å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äºŒè¿›åˆ¶åŒ…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~ &amp;&amp; \<br>wget -c https://github.com/coreos/etcd/releases/download/v3.4.14/etcd-v3.4.14-linux-amd64.tar.gz &amp;&amp; \<br>tar xf etcd-v3.4.14-linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h5 id="2-éªŒè¯-1"><a href="#2-éªŒè¯-1" class="headerlink" title="2. éªŒè¯"></a>2. éªŒè¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd etcd-v3.4.14-linux-amd64 &amp;&amp; ./etcdctl version<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">etcdctl version: 3.4.14<br>API version: 3.4<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ†å‘-etcd-è‡³å„-master-èŠ‚ç‚¹"><a href="#2ï¼‰åˆ†å‘-etcd-è‡³å„-master-èŠ‚ç‚¹" class="headerlink" title="2ï¼‰åˆ†å‘ etcd è‡³å„ master èŠ‚ç‚¹"></a>2ï¼‰åˆ†å‘ etcd è‡³å„ master èŠ‚ç‚¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ etcd server ç«¯</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/etcd-v3.4.14-linux-amd64/etcd dest=/data/applications/etcd/bin/etcd owner=root group=root mode=0755&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ etcd client å·¥å…·</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/etcd-v3.4.14-linux-amd64/etcdctl dest=/data/applications/etcd/bin/etcdctl owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#3ï¼‰åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="3ï¼‰åˆ›å»ºé…ç½®æ–‡ä»¶"></a>3ï¼‰åˆ›å»ºé…ç½®æ–‡ä»¶</h4><h5 id="1-æ–°å»º-etcd-é…ç½®æ–‡ä»¶-etcd-conf"><a href="#1-æ–°å»º-etcd-é…ç½®æ–‡ä»¶-etcd-conf" class="headerlink" title="1. æ–°å»º etcd é…ç½®æ–‡ä»¶ etcd.conf"></a>1. æ–°å»º etcd é…ç½®æ–‡ä»¶ <code>etcd.conf</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/kubernetes/etcd/cfg/etcd.conf &lt;&lt; EOF<br><span class="hljs-meta">#</span><span class="bash">[Member]</span><br>ETCD_NAME=&quot;etcd-1&quot;<br>ETCD_DATA_DIR=&quot;/data/applications/etcd/data&quot;<br>ETCD_WAL_DIR=&quot;/data/applications/etcd/wal&quot;<br>ETCD_LISTEN_PEER_URLS=&quot;https://192.168.3.231:2380&quot;<br>ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.3.231:2379,http://127.0.0.1:2379&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">[Clustering]</span><br>ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.3.231:2380&quot;<br>ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.3.231:2379&quot;<br>ETCD_INITIAL_CLUSTER=&quot;etcd-1=https://192.168.3.231:2380,etcd-2=https://192.168.3.232:2380,etcd-3=https://192.168.3.233:2380&quot;<br>ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster-0&quot;<br>ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;<br>ETCD_ENABLE_V2=&quot;true&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">[Security]</span><br>ETCD_CERT_FILE=&quot;/data/applications/etcd/ssl/server.pem&quot;<br>ETCD_KEY_FILE=&quot;/data/applications/etcd/ssl/server-key.pem&quot;<br>ETCD_TRUSTED_CA_FILE=&quot;/data/applications/etcd/ssl/ca.pem&quot;<br>ETCD_CLIENT_CERT_AUTH=&quot;true&quot;<br>ETCD_PEER_CERT_FILE=&quot;/data/applications/etcd/ssl/server.pem&quot;<br>ETCD_PEER_KEY_FILE=&quot;/data/applications/etcd/ssl/server-key.pem&quot;<br>ETCD_PEER_TRUSTED_CA_FILE=&quot;/data/applications/etcd/ssl/ca.pem&quot;<br>ETCD_PEER_CLIENT_CERT_AUTH=&quot;true&quot;<br><br>EOF<br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>etcd æ¯ä¸ªèŠ‚ç‚¹çš„é…ç½®ä¸åŒï¼Œæ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡ jinja æ¨¡ç‰ˆæ¸²æŸ“ã€‚</p><p>3.4 ç‰ˆæœ¬çš„ etcd é»˜è®¤ä½¿ç”¨çš„æ˜¯ v3 ç‰ˆæœ¬çš„APIï¼Œå¹¶é»˜è®¤å…³é—­äº† v2 ç‰ˆæœ¬APIçš„ä½¿ç”¨ï¼Œå¦‚æœè¦ç»§ç»­ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® <code>ETCD_ENABLE_V2=&quot;true&quot;</code>ï¼Œæˆ–è€…åœ¨ä½¿ç”¨å‘½ä»¤è¡Œæ—¶è®¾ç½® <code>ETCDCTL_API</code> ç¯å¢ƒå˜é‡ï¼Œå¦‚<code>ETCDCTL_API=2 etcdctl</code>ã€‚</p><p>flannel æ“ä½œ etcd ä½¿ç”¨çš„æ˜¯ v2 çš„APIï¼Œ kubernetes æ“ä½œ etcd ä½¿ç”¨çš„ v3 çš„APIï¼Œcalico 3.x ç‰ˆæœ¬ä¹Ÿä½¿ç”¨ v3 çš„ APIã€‚</p></blockquote><h5 id="2-æ–°å»º-systemd-unit-é…ç½®-etcd-service"><a href="#2-æ–°å»º-systemd-unit-é…ç½®-etcd-service" class="headerlink" title="2. æ–°å»º systemd unit é…ç½® etcd.service"></a>2. æ–°å»º systemd unit é…ç½® <code>etcd.service</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/kubernetes/etcd/systemd/etcd.service &lt;&lt; EOF<br>[Unit]<br>Description=Etcd Server<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br>Documentation=https://github.com/coreos<br>   <br>[Service]<br>Type=notify<br>EnvironmentFile=/data/applications/etcd/cfg/etcd.conf<br>ExecStart=/data/applications/etcd/bin/etcd \<br>--auto-compaction-mode=periodic \<br>--auto-compaction-retention=1 \<br>--max-request-bytes=33554432 \<br>--quota-backend-bytes=6442450944 \<br>--heartbeat-interval=250 \<br>--election-timeout=2000 \<br>--logger=zap<br>Restart=on-failure<br>RestartSec=5<br>LimitNOFILE=65536<br>   <br>[Install]<br>WantedBy=multi-user.target<br><br>EOF<br></code></pre></td></tr></table></figure><h6 id="é‡è¦é…ç½®å‚æ•°è¯´æ˜"><a href="#é‡è¦é…ç½®å‚æ•°è¯´æ˜" class="headerlink" title="é‡è¦é…ç½®å‚æ•°è¯´æ˜:"></a>é‡è¦é…ç½®å‚æ•°è¯´æ˜:</h6><table><thead><tr><th>é‡è¦å‚æ•°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td>EnvironmentFile</td><td>ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨æ”¹æ–¹å¼å¯ä»¥ä»¥åŠ è½½å˜é‡çš„å½¢å¼åˆ¶ä½œç»Ÿä¸€çš„ unit æ¨¡ç‰ˆ</td></tr><tr><td>â€“cert-file / â€“key-file</td><td>etcd server ä¸ client é€šä¿¡æ—¶ä½¿ç”¨çš„è¯ä¹¦å’Œç§é’¥</td></tr><tr><td>â€“trusted-ca-file</td><td>ç­¾å‘ client è¯ä¹¦çš„ ca è¯ä¹¦ï¼Œç”¨äºéªŒè¯ client è¯ä¹¦ï¼›</td></tr><tr><td>â€“peer-cert-file / â€“peer-key-file</td><td>etcd peer ä¹‹é—´é€šä¿¡ä½¿ç”¨çš„è¯ä¹¦å’Œç§é’¥ï¼›</td></tr><tr><td>â€“peer-trusted-ca-file</td><td>ç­¾å‘ peer è¯ä¹¦çš„ ca è¯ä¹¦ï¼Œç”¨äºéªŒè¯ peer è¯ä¹¦ï¼Œå¯ä»¥å’Œ client è¯ä¹¦ä½¿ç”¨åŒä¸€å¥—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸åŒçš„ï¼›</td></tr></tbody></table><h4 id="4ï¼‰åˆ†å‘é…ç½®æ–‡ä»¶"><a href="#4ï¼‰åˆ†å‘é…ç½®æ–‡ä»¶" class="headerlink" title="4ï¼‰åˆ†å‘é…ç½®æ–‡ä»¶"></a>4ï¼‰åˆ†å‘é…ç½®æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ systemd unit é…ç½®æ–‡ä»¶</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/etcd/systemd/etcd.service dest=/usr/lib/systemd/system/etcd.service owner=root group=root mode=0644&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ etcd é…ç½®æ–‡ä»¶</span><br>ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/etcd/cfg/etcd.conf dest=/data/applications/etcd/cfg/etcd.conf owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h4 id="5ï¼‰å¯åŠ¨é›†ç¾¤"><a href="#5ï¼‰å¯åŠ¨é›†ç¾¤" class="headerlink" title="5ï¼‰å¯åŠ¨é›†ç¾¤"></a>5ï¼‰å¯åŠ¨é›†ç¾¤</h4><h5 id="1-æ‰¹é‡å¯åŠ¨-etcd"><a href="#1-æ‰¹é‡å¯åŠ¨-etcd" class="headerlink" title="1. æ‰¹é‡å¯åŠ¨ etcd"></a>1. æ‰¹é‡å¯åŠ¨ etcd</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m shell -a &quot;systemctl daemon-reload&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl enable etcd.service&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl start etcd.service&quot;<br></code></pre></td></tr></table></figure><h5 id="2-éªŒè¯æœåŠ¡çŠ¶æ€"><a href="#2-éªŒè¯æœåŠ¡çŠ¶æ€" class="headerlink" title="2. éªŒè¯æœåŠ¡çŠ¶æ€"></a>2. éªŒè¯æœåŠ¡çŠ¶æ€</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m shell -a &quot;ETCDCTL_API=3 /data/applications/etcd/bin/etcdctl  --endpoints=http://127.0.0.1:2379 --cacert=/data/applications/etcd/ssl/ca.pem --cert=/data/applications/etcd/ssl/server.pem --key=/data/applications/etcd/ssl/server-key.pem endpoint health&quot;<br></code></pre></td></tr></table></figure><h6 id="æ­£å¸¸è¿”å›ç»“æœ"><a href="#æ­£å¸¸è¿”å›ç»“æœ" class="headerlink" title="æ­£å¸¸è¿”å›ç»“æœ:"></a>æ­£å¸¸è¿”å›ç»“æœ:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‡è¿”å› healthy æ—¶ï¼Œé›†ç¾¤çŠ¶æ€æœªæ­£å¸¸</span><br>192.168.3.233 | CHANGED | rc=0 &gt;&gt;<br>http://127.0.0.1:2379 is healthy: successfully committed proposal: took = 2.802973ms<br><br>192.168.3.231 | CHANGED | rc=0 &gt;&gt;<br>http://127.0.0.1:2379 is healthy: successfully committed proposal: took = 2.426585ms<br><br>192.168.3.232 | CHANGED | rc=0 &gt;&gt;<br>http://127.0.0.1:2379 is healthy: successfully committed proposal: took = 3.491516ms<br></code></pre></td></tr></table></figure><h5 id="3-æŸ¥çœ‹é›†ç¾¤-leader"><a href="#3-æŸ¥çœ‹é›†ç¾¤-leader" class="headerlink" title="3. æŸ¥çœ‹é›†ç¾¤ leader"></a>3. æŸ¥çœ‹é›†ç¾¤ leader</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ETCDCTL_API=3 /data/applications/etcd/bin/etcdctl -w table  --endpoints=https://192.168.3.231:2379,https://192.168.3.232:2379,https://192.168.3.233:2379 --cacert=/data/applications/etcd/ssl/ca.pem --cert=/data/applications/etcd/ssl/server.pem --key=/data/applications/etcd/ssl/server-key.pem endpoint status<br></code></pre></td></tr></table></figure><h6 id="æ­£å¸¸è¿”å›ç»“æœ-1"><a href="#æ­£å¸¸è¿”å›ç»“æœ-1" class="headerlink" title="æ­£å¸¸è¿”å›ç»“æœ:"></a>æ­£å¸¸è¿”å›ç»“æœ:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å½“å‰ etcd raft leader ä¸º 192.168.3.231</span><br><br>+----------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>|          ENDPOINT          |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |<br>+----------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br>| https://192.168.3.231:2379 | e7d52edc2101ab48 |  3.4.14 |   20 kB |      true |      false |         5 |         28 |                 28 |        |<br>| https://192.168.3.232:2379 | a191bc097f41b735 |  3.4.14 |   20 kB |     false |      false |         5 |         28 |                 28 |        |<br>| https://192.168.3.233:2379 | 307ec828b6239718 |  3.4.14 |   20 kB |     false |      false |         5 |         28 |                 28 |        |<br>+----------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+<br></code></pre></td></tr></table></figure><h3 id="4ã€éƒ¨ç½²å››å±‚ä»£ç†-HA-ç¯å¢ƒ"><a href="#4ã€éƒ¨ç½²å››å±‚ä»£ç†-HA-ç¯å¢ƒ" class="headerlink" title="4ã€éƒ¨ç½²å››å±‚ä»£ç† HA ç¯å¢ƒ"></a>4ã€éƒ¨ç½²å››å±‚ä»£ç† HA ç¯å¢ƒ</h3><blockquote><p>ğŸš© <strong>ç”¨ nginx 4 å±‚é€æ˜ä»£ç†æ¥åšè´Ÿè½½å‡è¡¡çš„åŠŸèƒ½</strong></p><p>æ­å»ºnginx+keepalivedç¯å¢ƒï¼Œå¯¹å¤–æä¾›ä¸€ä¸ªç»Ÿä¸€çš„vipåœ°å€ï¼Œåç«¯å¯¹æ¥å¤šä¸ª apiserver å®ä¾‹ï¼Œnginx å¯¹å®ƒä»¬åšå¥åº·æ£€æŸ¥å’Œè´Ÿè½½å‡è¡¡ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ openrestyï¼Œå…¶å®è´¨ä»ç„¶æ˜¯ nginxï¼Œåªæ˜¯å°è£…äº† luaã€‚<code>kubelet</code>ã€<code>kube-proxy</code>ã€<code>controller-manager</code>ã€<code>scheduler</code> é€šè¿‡vipåœ°å€è®¿é—® kube-apiserverï¼Œä»è€Œå®ç° kube-apiserver çš„é«˜å¯ç”¨ï¼›</p><p>master èŠ‚ç‚¹çš„ <code>kube-controller-manager</code>ã€<code>kube-schedule</code>r æ˜¯å¤šå®ä¾‹(3ä¸ª)éƒ¨ç½²ï¼Œè‡ªèº«å³å­˜åœ¨é«˜å¯ç”¨æœºåˆ¶ï¼Œæ‰€ä»¥åªè¦æœ‰ä¸€ä¸ªå®ä¾‹æ­£å¸¸ï¼Œå°±å¯ä»¥ä¿è¯é«˜å¯ç”¨ã€‚</p></blockquote><h4 id="1ï¼‰å®‰è£…-openresty"><a href="#1ï¼‰å®‰è£…-openresty" class="headerlink" title="1ï¼‰å®‰è£… openresty"></a>1ï¼‰å®‰è£… openresty</h4><blockquote><p>ğŸš© ä»¥ä¸‹æ“ä½œåœ¨æ‰€æœ‰ lb èŠ‚ç‚¹è¿›è¡Œ</p></blockquote><h5 id="1-å®‰è£…ä¾èµ–åº“"><a href="#1-å®‰è£…ä¾èµ–åº“" class="headerlink" title="1. å®‰è£…ä¾èµ–åº“"></a>1. å®‰è£…ä¾èµ–åº“</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y curl git gcc glibc gcc-c++ openssl-devel pcre-devel yum-utils<br></code></pre></td></tr></table></figure><h5 id="2-å®‰è£…openrestyä»¥åŠopenssl-ä¾èµ–"><a href="#2-å®‰è£…openrestyä»¥åŠopenssl-ä¾èµ–" class="headerlink" title="2. å®‰è£…openrestyä»¥åŠopenssl ä¾èµ–"></a>2. å®‰è£…openrestyä»¥åŠopenssl ä¾èµ–</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum-config-manager --add-repo https://openresty.org/package/centos/openresty.repo &amp;&amp; \<br>yum install -y openresty openresty-openssl111-devel<br></code></pre></td></tr></table></figure><h5 id="3-è½¯é“¾è‡³æ ‡å‡†ç›®å½•"><a href="#3-è½¯é“¾è‡³æ ‡å‡†ç›®å½•" class="headerlink" title="3. è½¯é“¾è‡³æ ‡å‡†ç›®å½•"></a>3. è½¯é“¾è‡³æ ‡å‡†ç›®å½•</h5><p>ä½¿ç”¨yumå®‰è£…ï¼Œé»˜è®¤å®‰è£…è·¯å¾„åœ¨<code>/usr/local/openresty</code> ï¼Œå°†å…¶è½¯é“¾åˆ°æ ‡å‡†ç›®å½• <code>/data/applications</code>ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s /usr/local/openresty /data/applications<br></code></pre></td></tr></table></figure><p>ä¸ºäº†ä½¿ç”¨ä¹ æƒ¯ï¼Œå¯ä»¥å°† openresty åˆ«åä¸º nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s /usr/bin/openresty /usr/bin/nginx<br></code></pre></td></tr></table></figure><h5 id="4-æ–‡ä»¶å¥æŸ„ä¼˜åŒ–"><a href="#4-æ–‡ä»¶å¥æŸ„ä¼˜åŒ–" class="headerlink" title="4. æ–‡ä»¶å¥æŸ„ä¼˜åŒ–"></a>4. æ–‡ä»¶å¥æŸ„ä¼˜åŒ–</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ulimit -n 65525<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘æ–‡ä»¶ <code>/etc/security/limits.conf </code>ï¼Œè¿½åŠ ä»¥ä¸‹å†…å®¹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ–‡ä»¶åº•éƒ¨æ·»åŠ ä¸‹é¢å››è¡Œå†…å®¹</span><br>* soft nofile 65525<br>* hard nofile 65525<br>* soft nproc 65525<br>* hard nproc 65525<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ›å»º-nginx-stream-é…ç½®æ–‡ä»¶"><a href="#2ï¼‰åˆ›å»º-nginx-stream-é…ç½®æ–‡ä»¶" class="headerlink" title="2ï¼‰åˆ›å»º nginx stream é…ç½®æ–‡ä»¶"></a>2ï¼‰åˆ›å»º nginx stream é…ç½®æ–‡ä»¶</h4><blockquote><p>ğŸš© ä»¥ä¸‹æ“ä½œåœ¨ k8s-master01 è¿›è¡Œ</p></blockquote><h5 id="1-ç¼–è¾‘é…ç½®æ–‡ä»¶"><a href="#1-ç¼–è¾‘é…ç½®æ–‡ä»¶" class="headerlink" title="1. ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>1. ç¼–è¾‘é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/nginx/cfg/kube-nginx.conf</code> ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">worker_processes</span> <span class="hljs-number">2</span>;<br> <br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">65525</span>;<br>&#125;<br> <br><span class="hljs-section">stream</span> &#123;<br>    <span class="hljs-attribute">upstream</span> apiserver &#123;<br>        <span class="hljs-attribute">hash</span> $remote_addr consistent;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">172.16.60.231:6443</span>        max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">30s</span>;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">172.16.60.232:6443</span>        max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">30s</span>;<br>        <span class="hljs-attribute">server</span> <span class="hljs-number">172.16.60.233:6443</span>        max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">30s</span>;<br>    &#125;<br> <br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">8443</span>;<br>        <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">1s</span>;<br>        <span class="hljs-attribute">proxy_pass</span> apiserver;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-åˆ†å‘é…ç½®æ–‡ä»¶"><a href="#2-åˆ†å‘é…ç½®æ–‡ä»¶" class="headerlink" title="2. åˆ†å‘é…ç½®æ–‡ä»¶"></a>2. åˆ†å‘é…ç½®æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-nginx -S -R root -m copy -a &quot;src=~/kubernetes/nginx/cfg/kube-nginx.conf dest=/data/applications/openresty/nginx/conf/kube-nginx.conf owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰åˆ›å»º-nginx-systemd-unit-æ–‡ä»¶"><a href="#3ï¼‰åˆ›å»º-nginx-systemd-unit-æ–‡ä»¶" class="headerlink" title="3ï¼‰åˆ›å»º nginx systemd unit æ–‡ä»¶"></a>3ï¼‰åˆ›å»º nginx systemd unit æ–‡ä»¶</h4><blockquote><p>ğŸš© ä»¥ä¸‹æ“ä½œåœ¨ k8s-master01 è¿›è¡Œ</p></blockquote><h5 id="1-ç¼–è¾‘é…ç½®æ–‡ä»¶-1"><a href="#1-ç¼–è¾‘é…ç½®æ–‡ä»¶-1" class="headerlink" title="1. ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>1. ç¼–è¾‘é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/nginx/systemd/kube-nginx.service</code> ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs nginx">[Unit]<br>Description=kube-<span class="hljs-attribute">apiserver</span> nginx proxy<br>After=network.target<br>After=network-online.target<br>Wants=network-online.target<br> <br>[Service]<br>Type=forking<br>ExecStartPre=/usr/bin/nginx -c /data/applications/openresty/nginx/conf/kube-nginx.conf -p /data/applications/openresty/nginx -t<br>ExecStart=/usr/bin/nginx -c /data/applications/openresty/nginx/conf/kube-nginx.conf -p /data/applications/openresty/nginx<br>ExecReload=/usr/bin/nginx -c data/applications/openresty/nginx/conf/kube-nginx.conf -p /data/applications/openresty/nginx -s reload<br>PrivateTmp=<span class="hljs-literal">true</span><br>Restart=always<br>RestartSec=<span class="hljs-number">5</span><br>StartLimitInterval=<span class="hljs-number">0</span><br>LimitNOFILE=<span class="hljs-number">65536</span><br> <br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h5 id="2-åˆ†å‘é…ç½®æ–‡ä»¶-1"><a href="#2-åˆ†å‘é…ç½®æ–‡ä»¶-1" class="headerlink" title="2. åˆ†å‘é…ç½®æ–‡ä»¶"></a>2. åˆ†å‘é…ç½®æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-nginx -S -R root -m copy -a &quot;src=~/kubernetes/nginx/systemd/kube-nginx.service dest=/usr/lib/systemd/system/kube-nginx.service owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰å¯åŠ¨-nginx-ä»£ç†"><a href="#4ï¼‰å¯åŠ¨-nginx-ä»£ç†" class="headerlink" title="4ï¼‰å¯åŠ¨ nginx ä»£ç†"></a>4ï¼‰å¯åŠ¨ nginx ä»£ç†</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-nginx -S -R root -m shell -a &quot;systemctl daemon-reload&quot;<br>ansible k8s-nginx -S -R root -m shell -a &quot;systemctl enable kube-nginx.service&quot;<br>ansible k8s-nginx -S -R root -m shell -a &quot;systemctl start kube-nginx.service&quot;<br>ansible k8s-nginx -S -R root -m shell -a &quot;systemctl status kube-nginx.service&quot;<br></code></pre></td></tr></table></figure><h4 id="5ï¼‰å®‰è£…-keepalived"><a href="#5ï¼‰å®‰è£…-keepalived" class="headerlink" title="5ï¼‰å®‰è£… keepalived"></a>5ï¼‰å®‰è£… keepalived</h4><blockquote><p>ğŸš© ä»¥ä¸‹æ“ä½œåœ¨æ‰€æœ‰ lb èŠ‚ç‚¹è¿›è¡Œ</p></blockquote><h5 id="1-é…ç½®å†…æ ¸å‚æ•°"><a href="#1-é…ç½®å†…æ ¸å‚æ•°" class="headerlink" title="1. é…ç½®å†…æ ¸å‚æ•°"></a>1. é…ç½®å†…æ ¸å‚æ•°</h5><p>ç¼–è¾‘æ–‡ä»¶ <code>/etc/sysctl.d/kubernetes.conf </code>ï¼Œè¿½åŠ ä»¥ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">net.ipv4.ip_nonlocal_bind = 1# å¼€å¯å…è®¸ç»‘å®šéæœ¬æœºIP<br>net.ipv4.conf.lo.arp_announce = 2# arp ç›¸å…³é…ç½®(lvs çš„ DRã€TUN æ¨¡å¼éœ€è¦)<br>net.ipv4.conf.all.arp_announce = 2<br>net.ipv4.conf.lo.arp_ignore = 1<br>net.ipv4.conf.all.arp_ignore = 1<br></code></pre></td></tr></table></figure><h6 id="åŠ è½½é…ç½®"><a href="#åŠ è½½é…ç½®" class="headerlink" title="åŠ è½½é…ç½®:"></a>åŠ è½½é…ç½®:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sysctl -p /etc/sysctl.d/kubernetes.conf <br></code></pre></td></tr></table></figure><h5 id="2-éƒ¨ç½²-keepalived"><a href="#2-éƒ¨ç½²-keepalived" class="headerlink" title="2. éƒ¨ç½² keepalived"></a>2. éƒ¨ç½² keepalived</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y keepalived<br></code></pre></td></tr></table></figure><h5 id="3-é…ç½®-keepalived-ç‹¬ç«‹æ—¥å¿—"><a href="#3-é…ç½®-keepalived-ç‹¬ç«‹æ—¥å¿—" class="headerlink" title="3. é…ç½® keepalived ç‹¬ç«‹æ—¥å¿—"></a>3. é…ç½® keepalived ç‹¬ç«‹æ—¥å¿—</h5><p>æ–‡ä»¶è·¯å¾„: <code>/etc/sysconfig/keepalived</code>ï¼Œä¿®æ”¹ <code>KEEPALIVED_OPTIONS</code> é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sed -i &#x27;s/&quot;-D&quot;/&quot;-D -d -S 0&quot;/g&#x27; /etc/sysconfig/keepalived <br></code></pre></td></tr></table></figure><p>æ–‡ä»¶è·¯å¾„: <code>/etc/rsyslog.conf </code>ï¼Œæœ«å°¾è¿½åŠ é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;local0.*                                                 /var/log/keepalived.log&quot; &gt;&gt; /etc/rsyslog.conf<br></code></pre></td></tr></table></figure><h5 id="4-é…ç½®-keepalived-æ—¥å¿—åˆ‡å‰²"><a href="#4-é…ç½®-keepalived-æ—¥å¿—åˆ‡å‰²" class="headerlink" title="4. é…ç½® keepalived æ—¥å¿—åˆ‡å‰²"></a>4. é…ç½® keepalived æ—¥å¿—åˆ‡å‰²</h5><p>æ–‡ä»¶è·¯å¾„: <code>/etc/logrotate.d/keepalived</code>ï¼Œç¼–è¾‘ä»¥ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">/var/log/keepalived.log &#123;<br>    daily<br>    missingok<br>    dateext<br>    rotate 7<br>    create 0600 root root<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="5-é‡å¯-rsyslog-æœåŠ¡"><a href="#5-é‡å¯-rsyslog-æœåŠ¡" class="headerlink" title="5. é‡å¯ rsyslog æœåŠ¡"></a>5. é‡å¯ rsyslog æœåŠ¡</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl restart rsyslog.service <br></code></pre></td></tr></table></figure><h4 id="6ï¼‰åˆ›å»º-keepalived-é…ç½®æ–‡ä»¶"><a href="#6ï¼‰åˆ›å»º-keepalived-é…ç½®æ–‡ä»¶" class="headerlink" title="6ï¼‰åˆ›å»º keepalived é…ç½®æ–‡ä»¶"></a>6ï¼‰åˆ›å»º keepalived é…ç½®æ–‡ä»¶</h4><h5 id="1-ç¼–è¾‘-master-é…ç½®æ–‡ä»¶"><a href="#1-ç¼–è¾‘-master-é…ç½®æ–‡ä»¶" class="headerlink" title="1. ç¼–è¾‘ master é…ç½®æ–‡ä»¶"></a>1. ç¼–è¾‘ master é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/nginx/cfg/keepalived-master.conf</code> ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell">! Configuration File for keepalived    <br>   <br>global_defs &#123;<br>router_id master<br><br>    script_user root<br>    enable_script_security  <br>&#125;<br>   <br>vrrp_script chk_http_port &#123;     <br>    script &quot;/etc/keepalived/chk_nginx.sh&quot; <br>    interval 2                  <br>    weight -5                  <br>    fall 2              <br>    rise 1                 <br>&#125;<br>   <br>vrrp_instance VI_1 &#123;   <br>    state MASTER   <br>    interface eth0     <br>    virtual_router_id 51        <br>    priority 101               <br>    advert_int 1                <br>    authentication &#123;           <br>        auth_type PASS         <br>        auth_pass kubernetes         <br>    &#125;<br>    <br>    virtual_ipaddress &#123;       <br>        192.168.3.230 dev eth0 label eth0:1<br>    &#125;<br>  <br>track_script &#123;                     <br>   chk_http_port                   <br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-ç¼–è¾‘-backup-é…ç½®æ–‡ä»¶"><a href="#2-ç¼–è¾‘-backup-é…ç½®æ–‡ä»¶" class="headerlink" title="2. ç¼–è¾‘ backup é…ç½®æ–‡ä»¶"></a>2. ç¼–è¾‘ backup é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/nginx/cfg/keepalived-backup.conf</code> ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell">! Configuration File for keepalived    <br>   <br>global_defs &#123;<br>router_id backup<br><br>    script_user root<br>    enable_script_security  <br>&#125;<br>   <br>vrrp_script chk_http_port &#123;     <br>    script &quot;/etc/keepalived/chk_nginx.sh&quot; <br>    interval 2                  <br>    weight -5                  <br>    fall 2              <br>    rise 1                 <br>&#125;<br>   <br>vrrp_instance VI_1 &#123;   <br>    state BACKUP   <br>    interface eth0     <br>    virtual_router_id 50     <br>    priority 99               <br>    advert_int 1                <br>    authentication &#123;           <br>        auth_type PASS         <br>        auth_pass kubernetes         <br>    &#125;<br>    <br>    virtual_ipaddress &#123;       <br>        192.168.3.230 dev eth0 label eth0:1<br>    &#125;<br>  <br>track_script &#123;                     <br>   chk_http_port                   <br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-ç¼–è¾‘-nginx-ç›‘æ§è„šæœ¬"><a href="#3-ç¼–è¾‘-nginx-ç›‘æ§è„šæœ¬" class="headerlink" title="3. ç¼–è¾‘ nginx ç›‘æ§è„šæœ¬"></a>3. ç¼–è¾‘ nginx ç›‘æ§è„šæœ¬</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/nginx/cfg/chk_nginx.sh</code> ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br>counter=$(ps -ef|grep -w kube-nginx|grep -v grep|wc -l)<br>if [ &quot;$&#123;counter&#125;&quot; = &quot;0&quot; ]; then<br>    systemctl restart kube-nginx<br>    sleep 2<br>    counter=$(ps -ef|grep kube-nginx|grep -v grep|wc -l)<br>    if [ &quot;$&#123;counter&#125;&quot; = &quot;0&quot; ]; then<br>        systemctl stop keepalived<br>    fi<br>fi<br></code></pre></td></tr></table></figure><h5 id="4-åˆ†å‘é…ç½®æ–‡ä»¶"><a href="#4-åˆ†å‘é…ç½®æ–‡ä»¶" class="headerlink" title="4. åˆ†å‘é…ç½®æ–‡ä»¶"></a>4. åˆ†å‘é…ç½®æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> master é…ç½®æ–‡ä»¶åˆ†å‘åˆ° lb01</span><br>ansible k8s-lb01 -S -R root -m copy -a &quot;src=~/kubernetes/nginx/cfg/keepalived-master.conf dest=/etc/keepalived/keepalived.conf owner=root group=root mode=0644&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> backend é…ç½®æ–‡ä»¶åˆ†å‘åˆ° lb02</span><br>ansible k8s-lb02 -S -R root -m copy -a &quot;src=~/kubernetes/nginx/cfg/keepalived-backup.conf dest=/etc/keepalived/keepalived.conf owner=root group=root mode=0644&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ç›‘æ§è„šæœ¬åˆ†å‘åˆ° 2ä¸ªèŠ‚ç‚¹</span><br>ansible k8s-nginx -S -R root -m copy -a &quot;src=~/kubernetes/nginx/cfg/chk_nginx.sh dest=/etc/keepalived/chk_nginx.sh owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h4 id="7ï¼‰åˆ›å»º-keepalived-systemd-unit-é…ç½®æ–‡ä»¶"><a href="#7ï¼‰åˆ›å»º-keepalived-systemd-unit-é…ç½®æ–‡ä»¶" class="headerlink" title="7ï¼‰åˆ›å»º keepalived systemd unit é…ç½®æ–‡ä»¶"></a>7ï¼‰åˆ›å»º keepalived systemd unit é…ç½®æ–‡ä»¶</h4><h5 id="1-ç¼–è¾‘é…ç½®æ–‡ä»¶-2"><a href="#1-ç¼–è¾‘é…ç½®æ–‡ä»¶-2" class="headerlink" title="1. ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>1. ç¼–è¾‘é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/nginx/systemd/keepalived.service</code> ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Unit]<br>Description=LVS and VRRP High Availability Monitor<br>After=syslog.target network-online.target<br><br>[Service]<br>Type=forking<br>PIDFile=/var/run/keepalived.pid<br>KillMode=process<br>EnvironmentFile=-/etc/sysconfig/keepalived<br>ExecStart=/usr/sbin/keepalived $KEEPALIVED_OPTIONS<br>ExecReload=/bin/kill -HUP $MAINPID<br><br>Restart=on-failure<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h5 id="2-åˆ†å‘é…ç½®æ–‡ä»¶-2"><a href="#2-åˆ†å‘é…ç½®æ–‡ä»¶-2" class="headerlink" title="2. åˆ†å‘é…ç½®æ–‡ä»¶"></a>2. åˆ†å‘é…ç½®æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-nginx -S -R root -m copy -a &quot;src=~/kubernetes/nginx/systemd/keepalived.service dest=/usr/lib/systemd/system/keepalived.service owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h4 id="8ï¼‰å¯åŠ¨-keepalived-HA"><a href="#8ï¼‰å¯åŠ¨-keepalived-HA" class="headerlink" title="8ï¼‰å¯åŠ¨ keepalived HA"></a>8ï¼‰å¯åŠ¨ keepalived HA</h4><h5 id="1-æ‰¹é‡å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯"><a href="#1-æ‰¹é‡å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯" class="headerlink" title="1. æ‰¹é‡å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯"></a>1. æ‰¹é‡å¯åŠ¨å¹¶åŠ å…¥å¼€æœºè‡ªå¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-nginx -S -R root -m shell -a &quot;systemctl daemon-reload&quot;<br>ansible k8s-nginx -S -R root -m shell -a &quot;systemctl enable keepalived.service&quot;<br>ansible k8s-nginx -S -R root -m shell -a &quot;systemctl start keepalived.service&quot;<br>ansible k8s-nginx -S -R root -m shell -a &quot;systemctl status keepalived.service&quot;<br></code></pre></td></tr></table></figure><h5 id="2-éªŒè¯-vip-çŠ¶æ€"><a href="#2-éªŒè¯-vip-çŠ¶æ€" class="headerlink" title="2. éªŒè¯ vip çŠ¶æ€"></a>2. éªŒè¯ vip çŠ¶æ€</h5><blockquote><p>ğŸš© ç”±äº master èŠ‚ç‚¹çš„çš„æƒé‡é«˜ï¼Œæ‰€ä»¥ vip é»˜è®¤ä¼šèµ·åœ¨ master èŠ‚ç‚¹ä¸Šï¼Œåœ¨ k8s-lb01 æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ifconfig <br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500<br>        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255<br>        ether 02:42:86:cf:0e:ee  txqueuelen 0  (Ethernet)<br>        RX packets 0  bytes 0 (0.0 B)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 0  bytes 0 (0.0 B)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 192.168.3.235  netmask 255.255.255.0  broadcast 192.168.3.255<br>        ether 00:50:56:b0:b7:c1  txqueuelen 1000  (Ethernet)<br>        RX packets 4501804  bytes 410256599 (391.2 MiB)<br>        RX errors 0  dropped 259641  overruns 0  frame 0<br>        TX packets 51487  bytes 4490345 (4.2 MiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>eth0:1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 192.168.3.230  netmask 255.255.255.255  broadcast 0.0.0.0<br>        ether 00:50:56:b0:b7:c1  txqueuelen 1000  (Ethernet)<br><br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        loop  txqueuelen 1000  (Local Loopback)<br>        RX packets 0  bytes 0 (0.0 B)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 0  bytes 0 (0.0 B)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br></code></pre></td></tr></table></figure><blockquote><p>ç”±äºæˆ‘ä»¬ç»™ vip ç»‘å®šåšäº†åˆ«åï¼Œæ•…è¿™è¾¹å¯ä»¥çœ‹åˆ° <code>eth0:1</code> çš„è™šæ‹Ÿç½‘å¡ï¼Œè¯æ˜ vip çš„ç¡®èµ·åœ¨ master èŠ‚ç‚¹ä¸Šäº†</p></blockquote><h3 id="5ã€éƒ¨ç½²-Kubernetes-master-èŠ‚ç‚¹"><a href="#5ã€éƒ¨ç½²-Kubernetes-master-èŠ‚ç‚¹" class="headerlink" title="5ã€éƒ¨ç½² Kubernetes master èŠ‚ç‚¹"></a>5ã€éƒ¨ç½² Kubernetes master èŠ‚ç‚¹</h3><blockquote><p>ğŸŒˆ <strong>å…³äº master èŠ‚ç‚¹</strong></p><p>éƒ¨ç½²åœ¨ master èŠ‚ç‚¹çš„å¿…è¦ç»„ä»¶æœ‰ <code>kube-apiserver</code>ã€<code>kube-scheduler</code> å’Œ <code>kube-controller-manager</code> ï¼Œå‡ä¸ºå¤šå®ä¾‹æ¨¡å¼è¿è¡Œã€‚</p></blockquote><h4 id="1ï¼‰éƒ¨ç½²-kube-apiserver"><a href="#1ï¼‰éƒ¨ç½²-kube-apiserver" class="headerlink" title="1ï¼‰éƒ¨ç½² kube-apiserver"></a>1ï¼‰éƒ¨ç½² kube-apiserver</h4><p><strong>åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-apiserver:</strong> <a href="https://tareya.github.io/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-apiserver/">ä¼ é€é—¨</a></p><blockquote><p>ğŸš© è¿™é‡Œéƒ¨ç½²çš„æ˜¯ä¸€ä¸ªä¸‰å®ä¾‹çš„ kube-apiserver é›†ç¾¤ç¯å¢ƒï¼Œkube-apiserver æ˜¯æ— çŠ¶æ€çš„ï¼Œé€šè¿‡ nginx å››å±‚ä»£ç†è¿›è¡Œè®¿é—®ï¼Œå¹¶å¯¹å¤–æä¾›ç»Ÿä¸€çš„ vip åœ°å€ï¼Œä»¥æ­¤æ¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚</p><p><strong>ä»¥ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨ k8s-master01 ä¸Šè¿›è¡Œï¼Œç„¶åå†é€šè¿‡æ‰¹ç®¡ç†å·¥å…·åˆ†å‘è‡³å…¶ä»–èŠ‚ç‚¹è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚</strong></p></blockquote><h5 id="1-åˆ›å»º-TLS-Bootstrap-è®¤è¯-token-æ–‡ä»¶"><a href="#1-åˆ›å»º-TLS-Bootstrap-è®¤è¯-token-æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º TLS Bootstrap è®¤è¯ token æ–‡ä»¶"></a>1. åˆ›å»º TLS Bootstrap è®¤è¯ token æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ç”Ÿæˆä¸€ä¸ªåŠ å¯†token</span><br>export BOOTSTRAP_TOKEN=$(head -c 16 /dev/urandom | od -An -t x | tr -d &#x27; &#x27;) <br><span class="hljs-meta">#</span><span class="bash"> åˆ›å»º tokenæ–‡ä»¶</span><br>cat &gt; ~/kubernetes/server/cfg/token.csv &lt;&lt;EOF<br><span class="hljs-meta">$</span><span class="bash">&#123;BOOTSTRAP_TOKEN&#125;,kubelet-bootstrap,10001,<span class="hljs-string">&quot;system:node-bootstrap&quot;</span></span><br>EOF<br></code></pre></td></tr></table></figure><blockquote><p>ğŸŒˆ tokenæ–‡ä»¶çš„æ ¼å¼ä¸º token,ç”¨æˆ·,uid,ç”¨æˆ·ç»„</p></blockquote><h6 id="åˆ†å‘-token-è‡³å„-master-èŠ‚ç‚¹"><a href="#åˆ†å‘-token-è‡³å„-master-èŠ‚ç‚¹" class="headerlink" title="åˆ†å‘ token è‡³å„ master èŠ‚ç‚¹"></a>åˆ†å‘ token è‡³å„ master èŠ‚ç‚¹</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/cfg/token.csv dest=/data/applications/kubernetes/cfg/token.csv owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºå®¡è®¡ç­–ç•¥æ–‡ä»¶"><a href="#2-åˆ›å»ºå®¡è®¡ç­–ç•¥æ–‡ä»¶" class="headerlink" title="2. åˆ›å»ºå®¡è®¡ç­–ç•¥æ–‡ä»¶"></a>2. åˆ›å»ºå®¡è®¡ç­–ç•¥æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/kubernetes/server/cfg/audit-policy.yaml &lt;&lt;EOF<br>apiVersion: audit.k8s.io/v1beta1<br>kind: Policy<br>rules:<br><span class="hljs-meta">  #</span><span class="bash"> The following requests were manually identified as high-volume and low-risk, so drop them.</span><br>  - level: None<br>    resources:<br>      - group: &quot;&quot;<br>        resources:<br>          - endpoints<br>          - services<br>          - services/status<br>    users:<br>      - &#x27;system:kube-proxy&#x27;<br>    verbs:<br>      - watch<br>   <br>  - level: None<br>    resources:<br>      - group: &quot;&quot;<br>        resources:<br>          - nodes<br>          - nodes/status<br>    userGroups:<br>      - &#x27;system:nodes&#x27;<br>    verbs:<br>      - get<br>   <br>  - level: None<br>    namespaces:<br>      - kube-system<br>    resources:<br>      - group: &quot;&quot;<br>        resources:<br>          - endpoints<br>    users:<br>      - &#x27;system:kube-controller-manager&#x27;<br>      - &#x27;system:kube-scheduler&#x27;<br>      - &#x27;system:serviceaccount:kube-system:endpoint-controller&#x27;<br>    verbs:<br>      - get<br>      - update<br>   <br>  - level: None<br>    resources:<br>      - group: &quot;&quot;<br>        resources:<br>          - namespaces<br>          - namespaces/status<br>          - namespaces/finalize<br>    users:<br>      - &#x27;system:apiserver&#x27;<br>    verbs:<br>      - get<br>   <br><span class="hljs-meta">  #</span><span class="bash"> Don<span class="hljs-string">&#x27;t log HPA fetching metrics.</span></span><br>  - level: None<br>    resources:<br>      - group: metrics.k8s.io<br>    users:<br>      - &#x27;system:kube-controller-manager&#x27;<br>    verbs:<br>      - get<br>      - list<br>   <br><span class="hljs-meta">  #</span><span class="bash"><span class="hljs-string"> Don&#x27;</span>t <span class="hljs-built_in">log</span> these read-only URLs.</span><br>  - level: None<br>    nonResourceURLs:<br>      - &#x27;/healthz*&#x27;<br>      - /version<br>      - &#x27;/swagger*&#x27;<br>   <br><span class="hljs-meta">  #</span><span class="bash"> Don<span class="hljs-string">&#x27;t log events requests.</span></span><br>  - level: None<br>    resources:<br>      - group: &quot;&quot;<br>        resources:<br>          - events<br>   <br><span class="hljs-meta">  #</span><span class="bash"><span class="hljs-string"> node and pod status calls from nodes are high-volume and can be large, don&#x27;</span>t <span class="hljs-built_in">log</span> responses <span class="hljs-keyword">for</span> expected updates from nodes</span><br>  - level: Request<br>    omitStages:<br>      - RequestReceived<br>    resources:<br>      - group: &quot;&quot;<br>        resources:<br>          - nodes/status<br>          - pods/status<br>    users:<br>      - kubelet<br>      - &#x27;system:node-problem-detector&#x27;<br>      - &#x27;system:serviceaccount:kube-system:node-problem-detector&#x27;<br>    verbs:<br>      - update<br>      - patch<br>   <br>  - level: Request<br>    omitStages:<br>      - RequestReceived<br>    resources:<br>      - group: &quot;&quot;<br>        resources:<br>          - nodes/status<br>          - pods/status<br>    userGroups:<br>      - &#x27;system:nodes&#x27;<br>    verbs:<br>      - update<br>      - patch<br>   <br><span class="hljs-meta">  #</span><span class="bash"> deletecollection calls can be large, don<span class="hljs-string">&#x27;t log responses for expected namespace deletions</span></span><br>  - level: Request<br>    omitStages:<br>      - RequestReceived<br>    users:<br>      - &#x27;system:serviceaccount:kube-system:namespace-controller&#x27;<br>    verbs:<br>      - deletecollection<br>   <br><span class="hljs-meta">  #</span><span class="bash"><span class="hljs-string"> Secrets, ConfigMaps, and TokenReviews can contain sensitive &amp; binary data,</span></span><br><span class="hljs-meta">  #</span><span class="bash"><span class="hljs-string"> so only log at the Metadata level.</span></span><br>  - level: Metadata<br>    omitStages:<br>      - RequestReceived<br>    resources:<br>      - group: &quot;&quot;<br>        resources:<br>          - secrets<br>          - configmaps<br>      - group: authentication.k8s.io<br>        resources:<br>          - tokenreviews<br><span class="hljs-meta">  #</span><span class="bash"><span class="hljs-string"> Get repsonses can be large; skip them.</span></span><br>  - level: Request<br>    omitStages:<br>      - RequestReceived<br>    resources:<br>      - group: &quot;&quot;<br>      - group: admissionregistration.k8s.io<br>      - group: apiextensions.k8s.io<br>      - group: apiregistration.k8s.io<br>      - group: apps<br>      - group: authentication.k8s.io<br>      - group: authorization.k8s.io<br>      - group: autoscaling<br>      - group: batch<br>      - group: certificates.k8s.io<br>      - group: extensions<br>      - group: metrics.k8s.io<br>      - group: networking.k8s.io<br>      - group: policy<br>      - group: rbac.authorization.k8s.io<br>      - group: scheduling.k8s.io<br>      - group: settings.k8s.io<br>      - group: storage.k8s.io<br>    verbs:<br>      - get<br>      - list<br>      - watch<br>   <br><span class="hljs-meta">  #</span><span class="bash"><span class="hljs-string"> Default level for known APIs</span></span><br>  - level: RequestResponse<br>    omitStages:<br>      - RequestReceived<br>    resources:<br>      - group: &quot;&quot;<br>      - group: admissionregistration.k8s.io<br>      - group: apiextensions.k8s.io<br>      - group: apiregistration.k8s.io<br>      - group: apps<br>      - group: authentication.k8s.io<br>      - group: authorization.k8s.io<br>      - group: autoscaling<br>      - group: batch<br>      - group: certificates.k8s.io<br>      - group: extensions<br>      - group: metrics.k8s.io<br>      - group: networking.k8s.io<br>      - group: policy<br>      - group: rbac.authorization.k8s.io<br>      - group: scheduling.k8s.io<br>      - group: settings.k8s.io<br>      - group: storage.k8s.io<br>         <br><span class="hljs-meta">  #</span><span class="bash"><span class="hljs-string"> Default level for all other requests.</span></span><br>  - level: Metadata<br>    omitStages:<br>      - RequestReceived<br>EOF<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘å®¡è®¡ç­–ç•¥æ–‡ä»¶"><a href="#åˆ†å‘å®¡è®¡ç­–ç•¥æ–‡ä»¶" class="headerlink" title="åˆ†å‘å®¡è®¡ç­–ç•¥æ–‡ä»¶:"></a>åˆ†å‘å®¡è®¡ç­–ç•¥æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/cfg/audit-policy.yaml dest=/data/applications/kubernetes/cfg/audit-policy.yaml owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="3-åˆ›å»º-kube-apiserver-é…ç½®æ–‡ä»¶"><a href="#3-åˆ›å»º-kube-apiserver-é…ç½®æ–‡ä»¶" class="headerlink" title="3. åˆ›å»º kube-apiserver é…ç½®æ–‡ä»¶"></a>3. åˆ›å»º kube-apiserver é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/server/cfg/kube-apiserver.conf</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹: (èŠ‚ç‚¹IPæ ¹æ®å®é™…æƒ…å†µæ›¿æ¢)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs shell">KUBE_APISERVER_OPTS=&quot;--advertise-address=192.168.3.231 \<br>--bind-address=192.168.3.231 \<br>--secure-port=6443 \<br>--insecure-port=8080 \<br>--service-cluster-ip-range=10.0.0.0/16 \<br>--service-node-port-range=30000-50000 \<br>--default-not-ready-toleration-seconds=360 \<br>--default-unreachable-toleration-seconds=360 \<br>--feature-gates=DynamicAuditing=true \<br>--max-mutating-requests-inflight=2000 \<br>--max-requests-inflight=4000 \<br>--default-watch-cache-size=200 \<br>--delete-collection-workers=2 \<br>--etcd-cafile=/data/applications/etcd/ssl/ca.pem \<br>--etcd-certfile=/data/applications/etcd/ssl/server.pem \<br>--etcd-keyfile=/data/applications/etcd/ssl/server-key.pem \<br>--etcd-servers=https://192.168.3.231:2379,https://192.168.3.232:2379,https://192.168.3.233:2379 \<br>--tls-cert-file=/data/applications/kubernetes/ssl/server.pem  \<br>--tls-private-key-file=/data/applications/kubernetes/ssl/server-key.pem \<br>--client-ca-file=/data/applications/kubernetes/ssl/ca.pem \<br>--service-account-key-file=/data/applications/kubernetes/ssl/ca-key.pem \<br>--audit-log-maxage=30 \<br>--audit-log-maxbackup=3 \<br>--audit-log-maxsize=100 \<br>--audit-log-mode=batch \<br>--audit-log-truncate-enabled \<br>--audit-log-batch-buffer-size=20000 \<br>--audit-log-batch-max-size=2 \<br>--audit-log-path=/data/applications/kubernetes/logs/k8s-audit.log \<br>--audit-policy-file=/data/applications/kubernetes/cfg/audit-policy.yaml \<br>--profiling \<br>--enable-bootstrap-token-auth=true \<br>--token-auth-file=/data/applications/kubernetes/cfg/token.csv \<br>--authorization-mode=RBAC,Node \<br>--runtime-config=api/all=true \<br>--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \<br>--allow-privileged=true \<br>--apiserver-count=3 \<br>--event-ttl=168h \<br>--kubelet-certificate-authority=/data/applications/kubernetes/ssl/ca.pem \<br>--kubelet-client-certificate=/data/applications/kubernetes/ssl/server.pem \<br>--kubelet-client-key=/data/applications/kubernetes/ssl/server-key.pem \<br>--kubelet-https=true \<br>--kubelet-timeout=10s \<br>--proxy-client-cert-file=/data/applications/kubernetes/ssl/metrics-server.pem \<br>--proxy-client-key-file=/data/applications/kubernetes/ssl/metrics-server-key.pem \<br>--logtostderr=true \<br>--log-dir=/data/applications/kubernetes/logs \<br>--v=2 \<br>--enable-aggregator-routing=true&quot;<br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜-5"><a href="#é…ç½®å‚æ•°è¯´æ˜-5" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><table><thead><tr><th>é…ç½®å‚æ•°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/cfg/kube-apiserver.conf dest=/data/applications/kubernetes/cfg/kube-apiserver.conf owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>æ³¨æ„</strong></p><p>åˆ†å‘åè¦ä¿®æ”¹å¯¹åº”èŠ‚ç‚¹çš„ <code>advertise-address</code> å’Œ <code>bind-address</code></p></blockquote><h5 id="4-åˆ›å»º-systemd-unit-æ–‡ä»¶"><a href="#4-åˆ›å»º-systemd-unit-æ–‡ä»¶" class="headerlink" title="4. åˆ›å»º systemd unit æ–‡ä»¶"></a>4. åˆ›å»º systemd unit æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/server/systemd/kube-apiserver.service</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Unit]<br>Description=Kubernetes API Server<br>Documentation=https://github.com/kubernetes/kubernetes<br>After=network.target<br>After=etcd.service<br>Wants=etcd.service<br><br>[Service]<br>EnvironmentFile=/data/application/kubernetes/cfg/kube-apiserver.conf<br>ExecStart=/data/applications/kubernetes/bin/kube-apiserver $KUBE_APISERVER_OPTS<br>Restart=on-failure<br>RestartSec=10<br>Type=notify<br>LimitNOFILE=65536<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘-systemd-æ–‡ä»¶"><a href="#åˆ†å‘-systemd-æ–‡ä»¶" class="headerlink" title="åˆ†å‘ systemd æ–‡ä»¶:"></a>åˆ†å‘ systemd æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/systemd/kube-apiserver.service dest=/usr/lib/systemd/system/kube-apiserver.service owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="5-å¯åŠ¨-kube-apiserver-é›†ç¾¤"><a href="#5-å¯åŠ¨-kube-apiserver-é›†ç¾¤" class="headerlink" title="5. å¯åŠ¨ kube-apiserver é›†ç¾¤"></a>5. å¯åŠ¨ kube-apiserver é›†ç¾¤</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m shell -a &quot;systemctl daemon-reload&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl enable kube-apiserver.service&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl start kube-apiserver.service&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl status kube-apiserver.service&quot;<br></code></pre></td></tr></table></figure><h5 id="6-éªŒè¯kube-apiserver-é›†ç¾¤çŠ¶æ€"><a href="#6-éªŒè¯kube-apiserver-é›†ç¾¤çŠ¶æ€" class="headerlink" title="6. éªŒè¯kube-apiserver é›†ç¾¤çŠ¶æ€"></a>6. éªŒè¯kube-apiserver é›†ç¾¤çŠ¶æ€</h5><h6 id="1âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯"><a href="#1âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯" class="headerlink" title="1âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯:"></a>1âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl cluster-info<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Kubernetes master is running at https://192.168.3.230:8443<br><br>To further debug and diagnose cluster problems, use &#x27;kubectl cluster-info dump&#x27;.<br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰å†…å®¹"><a href="#2âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰å†…å®¹" class="headerlink" title="2âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰å†…å®¹:"></a>2âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰å†…å®¹:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get all --all-namespaces<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAMESPACE   NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE<br>default     service/kubernetes   ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP   49m<br></code></pre></td></tr></table></figure><h6 id="3âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯"><a href="#3âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯" class="headerlink" title="3âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯:"></a>3âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get componentstatuses # æˆ–æ‰§è¡Œ kubectl get cs<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME                 STATUS      MESSAGE                                                                                     ERROR<br>scheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: connect: connection refused   <br>controller-manager   Unhealthy   Get http://127.0.0.1:10252/healthz: dial tcp 127.0.0.1:10252: connect: connection refused   <br>etcd-0               Healthy     &#123;&quot;health&quot;:&quot;true&quot;&#125;                                                                           <br>etcd-2               Healthy     &#123;&quot;health&quot;:&quot;true&quot;&#125;                                                                           <br>etcd-1               Healthy     &#123;&quot;health&quot;:&quot;true&quot;&#125;    <br></code></pre></td></tr></table></figure><blockquote><p>ğŸš© æ­¤æ—¶è¿˜æ²¡æœ‰éƒ¨ç½² <code>controller-managerhe</code> å’Œ <code>schedule</code> è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œæ‰€ä»¥çŠ¶æ€ä¸º Unhealthyï¼Œå¾…åç»­éƒ¨ç½²å¥½ä¹‹åå†æŸ¥çœ‹ã€‚</p></blockquote><h5 id="7-æŸ¥çœ‹-kube-apiserver-å†™å…¥-etcd-ä¸­çš„æ•°æ®"><a href="#7-æŸ¥çœ‹-kube-apiserver-å†™å…¥-etcd-ä¸­çš„æ•°æ®" class="headerlink" title="7. æŸ¥çœ‹ kube-apiserver å†™å…¥ etcd ä¸­çš„æ•°æ®"></a>7. æŸ¥çœ‹ kube-apiserver å†™å…¥ etcd ä¸­çš„æ•°æ®</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">ETCDCTL_API=3 /data/applications/etcd/bin/etcdctl \<br>--endpoints=https://192.168.3.231:2379,https://192.168.3.232:2379,https://192.168.3.233:2379 \<br>--cacert=/data/applications/etcd/ssl/ca.pem \<br>--cert=/data/applications/etcd/ssl/server.pem \<br>--key=/data/applications/etcd/ssl/server-key.pem \<br>get /registry/ --prefix --keys-only<br></code></pre></td></tr></table></figure><h5 id="8-æˆæƒ-kube-apiserver-è®¿é—®-kubelet-API-çš„æƒé™"><a href="#8-æˆæƒ-kube-apiserver-è®¿é—®-kubelet-API-çš„æƒé™" class="headerlink" title="8. æˆæƒ kube-apiserver è®¿é—® kubelet API çš„æƒé™"></a>8. æˆæƒ kube-apiserver è®¿é—® kubelet API çš„æƒé™</h5><blockquote><p>ğŸš© åœ¨æ‰§è¡Œ kubectl execã€runã€logs ç­‰å‘½ä»¤æ—¶ï¼Œapiserver ä¼šå°†è¯·æ±‚è½¬å‘åˆ° kubelet çš„ https ç«¯å£ï¼Œå› æ­¤åœ¨è¿™è¾¹å®šä¹‰ RBAC è§„åˆ™ï¼Œæˆæƒ apiserver ä½¿ç”¨è¯ä¹¦ï¼ˆserver.pemï¼‰ç”¨æˆ·åï¼ˆkubernetesï¼‰è®¿é—® kubelet API çš„æƒé™ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create clusterrolebinding kube-apiserver:kubelet-apis --clusterrole=system:kubelet-api-admin --user kubernetes<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰éƒ¨ç½²-kube-controller-manager"><a href="#2ï¼‰éƒ¨ç½²-kube-controller-manager" class="headerlink" title="2ï¼‰éƒ¨ç½² kube-controller-manager"></a>2ï¼‰éƒ¨ç½² kube-controller-manager</h4><p><strong>åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-controller-manager:</strong> <a href="https://tareya.github.io/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-controller-manager/">ä¼ é€é—¨</a></p><blockquote><p>ğŸš© è¿™é‡Œéƒ¨ç½²çš„æ˜¯ä¸€ä¸ªä¸‰å®ä¾‹çš„ kube-controller-manager é›†ç¾¤ï¼Œå¯åŠ¨åä¼šé€šè¿‡é€‰ä¸¾æœºåˆ¶äº§ç”Ÿä¸€ä¸ª leaderï¼ˆç±»ä¼¼ consul æˆ– etcdçš„æœºåˆ¶ï¼‰ï¼Œå…¶ä»–èŠ‚ç‚¹å¤„äºå µå¡çŠ¶æ€ï¼Œå½“ leader èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œå‰©ä½™çš„å µå¡èŠ‚ç‚¹ä¼šå†æ¬¡é€‰ä¸¾äº§ç”Ÿæ–°çš„ leaderï¼Œä»çƒ­ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚</p><p><strong>ä»¥ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨ k8s-master01 ä¸Šè¿›è¡Œï¼Œç„¶åå†é€šè¿‡æ‰¹ç®¡ç†å·¥å…·åˆ†å‘è‡³å…¶ä»–èŠ‚ç‚¹è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚</strong></p></blockquote><h5 id="1-åˆ›å»º-kube-controller-manager-é…ç½®æ–‡ä»¶"><a href="#1-åˆ›å»º-kube-controller-manager-é…ç½®æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º kube-controller-manager é…ç½®æ–‡ä»¶"></a>1. åˆ›å»º kube-controller-manager é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/server/cfg/kube-controller-manager.conf</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹: </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell">KUBE_CONTROLLER_MANAGER_OPTS=&quot;--v=2 \<br>--logtostderr=true \<br>--log-dir=/data/applications/kubernetes/logs \<br>--profiling \<br>--cluster-name=kubernetes \<br>--bind-address=127.0.0.1 \<br>--master=127.0.0.1:8080 \<br>--service-cluster-ip-range=10.0.0.0/16 \<br>--cluster-cidr=10.244.0.0/16 \<br>--allocate-node-cidrs=true \<br>--cluster-signing-cert-file=/data/applications/kubernetes/ssl/ca.pem \<br>--cluster-signing-key-file=/data/applications/kubernetes/ssl/ca-key.pem  \<br>--service-account-private-key-file=/data/applications/kubernetes/ssl/ca-key.pem \<br>--root-ca-file=/data/applications/kubernetes/ssl/ca.pem \<br>--controllers=*,bootstrapsigner,tokencleaner \<br>--kube-api-qps=1000 \<br>--kube-api-burst=2000 \<br>--leader-elect=true \<br>--use-service-account-credentials=true \<br>--horizontal-pod-autoscaler-sync-period=10s \<br>--concurrent-service-syncs=2 \<br>--concurrent-deployment-syncs=10 \<br>--concurrent-gc-syncs=30 \<br>--node-cidr-mask-size=24 \<br>--pod-eviction-timeout=6m \<br>--terminated-pod-gc-threshold=10000 \<br>--experimental-cluster-signing-duration=87600h0m0s \<br>--feature-gates=RotateKubeletClientCertificate=true,RotateKubeletServerCertificate=true&quot;<br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜-6"><a href="#é…ç½®å‚æ•°è¯´æ˜-6" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶ï¼š"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶ï¼š" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶ï¼š"></a>åˆ†å‘é…ç½®æ–‡ä»¶ï¼š</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/cfg/kube-controller-manager.conf dest=/data/applications/kubernetes/cfg/kube-controller-manager.conf owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»º-systemd-unit-æ–‡ä»¶"><a href="#2-åˆ›å»º-systemd-unit-æ–‡ä»¶" class="headerlink" title="2. åˆ›å»º systemd unit æ–‡ä»¶"></a>2. åˆ›å»º systemd unit æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/server/systemd/kube-controller-manager.service</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Unit]<br>Description=Kubernetes Controller Manager<br>Documentation=https://github.com/kubernetes/kubernetes<br><br>[Service]<br>EnvironmentFile=/data/applications/kubernetes/cfg/kube-controller-manager.conf<br>ExecStart=/data/applications/kubernetes/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_OPTS<br>Restart=on-failure<br>RestartSec=5<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-1"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-1" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/systemd/kube-controller-manager.service dest=/usr/lib/systemd/system/kube-controller-manager.service owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="3-å¯åŠ¨-kube-controller-manager-é›†ç¾¤"><a href="#3-å¯åŠ¨-kube-controller-manager-é›†ç¾¤" class="headerlink" title="3. å¯åŠ¨ kube-controller-manager é›†ç¾¤"></a>3. å¯åŠ¨ kube-controller-manager é›†ç¾¤</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m shell -a &quot;systemctl daemon-reload&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl enable kube-controller-manager.service&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl start kube-controller-manager.service&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl status kube-controller-manager.service&quot;<br></code></pre></td></tr></table></figure><h5 id="4-éªŒè¯-kube-controller-manager-é›†ç¾¤çŠ¶æ€"><a href="#4-éªŒè¯-kube-controller-manager-é›†ç¾¤çŠ¶æ€" class="headerlink" title="4. éªŒè¯ kube-controller-manager é›†ç¾¤çŠ¶æ€"></a>4. éªŒè¯ kube-controller-manager é›†ç¾¤çŠ¶æ€</h5><h6 id="1âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯"><a href="#1âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯" class="headerlink" title="1âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯:"></a>1âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get componentstatuses # æˆ–æ‰§è¡Œ kubectl get cs<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME                 STATUS      MESSAGE                                                                                     ERROR<br>scheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: connect: connection refused   <br>controller-manager   Healthy     ok                                                                                          <br>etcd-0               Healthy     &#123;&quot;health&quot;:&quot;true&quot;&#125;                                                                           <br>etcd-1               Healthy     &#123;&quot;health&quot;:&quot;true&quot;&#125;                                                                           <br>etcd-2               Healthy     &#123;&quot;health&quot;:&quot;true&quot;&#125; <br></code></pre></td></tr></table></figure><blockquote><p>ğŸš© æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼Œcontroller-managerçš„çŠ¶æ€ä¸ºâ€okâ€</p><p>å½“ <code>kube-controller-manager</code> é›†ç¾¤ä¸­çš„1ä¸ªæˆ–2ä¸ªèŠ‚ç‚¹çš„ <code>controller-manager</code> æœåŠ¡æŒ‚æ‰ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„ <code>controller-manager</code> æœåŠ¡æ´»ç€ï¼Œåˆ™é›†ç¾¤ä¸­ <code>controller-manager</code> çš„çŠ¶æ€ä»ç„¶ä¸º <strong>â€œokâ€</strong> ,ä»ç„¶ä¼šç»§ç»­æä¾›æœåŠ¡ï¼</p></blockquote><h6 id="2âƒ£ï¸-æŸ¥çœ‹ç›‘å¬ç«¯å£"><a href="#2âƒ£ï¸-æŸ¥çœ‹ç›‘å¬ç«¯å£" class="headerlink" title="2âƒ£ï¸ æŸ¥çœ‹ç›‘å¬ç«¯å£:"></a>2âƒ£ï¸ æŸ¥çœ‹ç›‘å¬ç«¯å£:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -lntp | grep kube-controller <br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">tcp        0      0 127.0.0.1:10257         0.0.0.0:*               LISTEN      494/kube-controller <br>tcp6       0      0 :::10252                :::*                    LISTEN      494/kube-controller <br></code></pre></td></tr></table></figure><blockquote><p>ğŸŒˆ kube-controller-manager ç›‘å¬ç«¯å£ä¸º 10252 å’Œ 10257</p><p><code>10257</code>ï¼šæ¥æ”¶ http è¯·æ±‚ï¼Œéå®‰å…¨ç«¯å£ï¼Œä¸éœ€è¦è®¤è¯æˆæƒï¼›<br><code>10252</code>ï¼šæ¥æ”¶ https è¯·æ±‚ï¼Œå®‰å…¨ç«¯å£ï¼Œéœ€è¦è®¤è¯æˆæƒï¼›<br>ä¸¤ä¸ªæ¥å£éƒ½å¯¹å¤–æä¾› <code>/metrics</code> å’Œ <code>/healthz</code> çš„è®¿é—®ã€‚</p></blockquote><h6 id="3âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤å½“ä¸­çš„-leader"><a href="#3âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤å½“ä¸­çš„-leader" class="headerlink" title="3âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤å½“ä¸­çš„ leader:"></a>3âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤å½“ä¸­çš„ leader:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get endpoints kube-controller-manager --namespace=kube-system  -o yaml<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹ï¼Œå¯è§å½“ç„¶ leader ä¸º <code>k8s-master01</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">apiVersion: v1<br>kind: Endpoints<br>metadata:<br>  annotations:<br>    control-plane.alpha.kubernetes.io/leader: &#x27;&#123;&quot;holderIdentity&quot;:&quot;k8s-master01_a6307360-f814-4a7d-82cc-d4b89928438b&quot;,&quot;leaseDurationSeconds&quot;:15,&quot;acquireTime&quot;:&quot;2021-10-06T13:37:48Z&quot;,&quot;renewTime&quot;:&quot;2021-10-06T13:39:47Z&quot;,&quot;leaderTransitions&quot;:1&#125;&#x27;<br>  creationTimestamp: &quot;2021-10-06T13:11:30Z&quot;<br>  managedFields:<br>  - apiVersion: v1<br>    fieldsType: FieldsV1<br>    fieldsV1:<br>      f:metadata:<br>        f:annotations:<br>          .: &#123;&#125;<br>          f:control-plane.alpha.kubernetes.io/leader: &#123;&#125;<br>    manager: kube-controller-manager<br>    operation: Update<br>    time: &quot;2021-10-06T13:11:30Z&quot;<br>  name: kube-controller-manager<br>  namespace: kube-system<br>  resourceVersion: &quot;7596&quot;<br>  selfLink: /api/v1/namespaces/kube-system/endpoints/kube-controller-manager<br>  uid: ccc812be-c1cf-4e2c-a1cb-5133198aae47<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰éƒ¨ç½²-kube-scheduler"><a href="#3ï¼‰éƒ¨ç½²-kube-scheduler" class="headerlink" title="3ï¼‰éƒ¨ç½² kube-scheduler"></a>3ï¼‰éƒ¨ç½² kube-scheduler</h4><p><strong>åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-scheduler:</strong> <a href="https://tareya.github.io/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-scheduler/">ä¼ é€é—¨</a></p><blockquote><p>ğŸš©  è¿™é‡Œéƒ¨ç½²çš„æ˜¯ä¸€ä¸ªä¸‰å®ä¾‹çš„ kube-scheduler é›†ç¾¤ï¼Œå¯åŠ¨åä¼šé€šè¿‡é€‰ä¸¾æœºåˆ¶äº§ç”Ÿä¸€ä¸ª leaderï¼Œå…¶ä»–èŠ‚ç‚¹å¤„äºå µå¡çŠ¶æ€ï¼Œå½“ leader èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œå‰©ä½™çš„å µå¡èŠ‚ç‚¹ä¼šå†æ¬¡é€‰ä¸¾äº§ç”Ÿæ–°çš„ leaderï¼Œä»çƒ­ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚</p><p><strong>ä»¥ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨ k8s-master01 ä¸Šè¿›è¡Œï¼Œç„¶åå†é€šè¿‡æ‰¹ç®¡ç†å·¥å…·åˆ†å‘è‡³å…¶ä»–èŠ‚ç‚¹è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚</strong></p></blockquote><h5 id="1-åˆ›å»º-kube-scheduler-é…ç½®æ–‡ä»¶"><a href="#1-åˆ›å»º-kube-scheduler-é…ç½®æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º kube-scheduler é…ç½®æ–‡ä»¶"></a>1. åˆ›å»º kube-scheduler é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/server/cfg/kube-scheduler.conf</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹: </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">KUBE_SCHEDULER_OPTS=&quot;--master=127.0.0.1:8080 \<br>--address=127.0.0.1 \<br>--leader-elect \<br>--logtostderr=true \<br>--log-dir=/data/applications/kubernetes/logs \<br>--v=2&quot;<br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜-7"><a href="#é…ç½®å‚æ•°è¯´æ˜-7" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-2"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-2" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/cfg/kube-scheduler.conf dest=/data/applications/kubernetes/cfg/kube-scheduler.conf owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»º-systemd-unit-æ–‡ä»¶-1"><a href="#2-åˆ›å»º-systemd-unit-æ–‡ä»¶-1" class="headerlink" title="2. åˆ›å»º systemd unit æ–‡ä»¶"></a>2. åˆ›å»º systemd unit æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/server/systemd/kube-scheduler.service</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Unit]<br>Description=Kubernetes Scheduler<br>Documentation=https://github.com/kubernetes/kubernetes<br><br>[Service]<br>EnvironmentFile=/data/applications/kubernetes/cfg/kube-scheduler.conf<br>ExecStart=/data/applications/kubernetes/bin/kube-scheduler $KUBE_SCHEDULER_OPTS<br>Restart=on-failure<br>RestartSec=5<br>StartLimitInterval=0<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-3"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-3" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m copy -a &quot;src=~/kubernetes/server/systemd/kube-scheduler.service dest=/usr/lib/systemd/system/kube-scheduler.service owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="3-å¯åŠ¨-kube-scheduler-é›†ç¾¤"><a href="#3-å¯åŠ¨-kube-scheduler-é›†ç¾¤" class="headerlink" title="3. å¯åŠ¨ kube-scheduler é›†ç¾¤"></a>3. å¯åŠ¨ kube-scheduler é›†ç¾¤</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-master -S -R root -m shell -a &quot;systemctl daemon-reload&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl enable kube-scheduler.service&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl start kube-scheduler.service&quot;<br>ansible k8s-master -S -R root -m shell -a &quot;systemctl status kube-scheduler.service&quot;<br></code></pre></td></tr></table></figure><h5 id="4-éªŒè¯-kube-scheduler-é›†ç¾¤çŠ¶æ€"><a href="#4-éªŒè¯-kube-scheduler-é›†ç¾¤çŠ¶æ€" class="headerlink" title="4. éªŒè¯ kube-scheduler é›†ç¾¤çŠ¶æ€"></a>4. éªŒè¯ kube-scheduler é›†ç¾¤çŠ¶æ€</h5><h6 id="1âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯-1"><a href="#1âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯-1" class="headerlink" title="1âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯:"></a>1âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get componentstatuses # æˆ–æ‰§è¡Œ kubectl get cs<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME                 STATUS    MESSAGE             ERROR<br>controller-manager   Healthy   ok                  <br>scheduler            Healthy   ok                  <br>etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;   <br>etcd-1               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;   <br>etcd-2               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125; <br></code></pre></td></tr></table></figure><blockquote><p>ğŸš© æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼Œé›†ç¾¤çš„çŠ¶æ€å°±å…¨éƒ½ä¸ºâ€okâ€</p><p>å½“ <code>kube-scheduler </code> é›†ç¾¤ä¸­çš„1ä¸ªæˆ–2ä¸ªèŠ‚ç‚¹çš„ <code>scheduler </code> æœåŠ¡æŒ‚æ‰ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„ <code>scheduler </code> æœåŠ¡æ´»ç€ï¼Œåˆ™é›†ç¾¤ä¸­<code>scheduler</code> çš„çŠ¶æ€ä»ç„¶ä¸º <strong>â€œokâ€</strong>,ä»ç„¶ä¼šç»§ç»­æä¾›æœåŠ¡ï¼</p></blockquote><h6 id="2âƒ£ï¸-æŸ¥çœ‹ç›‘å¬ç«¯å£-1"><a href="#2âƒ£ï¸-æŸ¥çœ‹ç›‘å¬ç«¯å£-1" class="headerlink" title="2âƒ£ï¸ æŸ¥çœ‹ç›‘å¬ç«¯å£:"></a>2âƒ£ï¸ æŸ¥çœ‹ç›‘å¬ç«¯å£:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -lntp | grep kube-scheduler<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">tcp        0      0 127.0.0.1:10251         0.0.0.0:*               LISTEN      2049/kube-scheduler <br>tcp6       0      0 :::10259                :::*                    LISTEN      2049/kube-scheduler cai<br></code></pre></td></tr></table></figure><blockquote><p>ğŸŒˆ kube-scheduler ç›‘å¬ç«¯å£ä¸º 10251 å’Œ 10259</p><p><code>10251</code>ï¼šæ¥æ”¶ http è¯·æ±‚ï¼Œéå®‰å…¨ç«¯å£ï¼Œä¸éœ€è¦è®¤è¯æˆæƒï¼›<br><code>10259</code>ï¼šæ¥æ”¶ https è¯·æ±‚ï¼Œå®‰å…¨ç«¯å£ï¼Œéœ€è¦è®¤è¯æˆæƒï¼›<br>ä¸¤ä¸ªæ¥å£éƒ½å¯¹å¤–æä¾› <code>/metrics</code> å’Œ <code>/healthz</code> çš„è®¿é—®ã€‚</p></blockquote><h6 id="3âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤å½“ä¸­çš„-leader-1"><a href="#3âƒ£ï¸-æŸ¥çœ‹é›†ç¾¤å½“ä¸­çš„-leader-1" class="headerlink" title="3âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤å½“ä¸­çš„ leader:"></a>3âƒ£ï¸ æŸ¥çœ‹é›†ç¾¤å½“ä¸­çš„ leader:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get endpoints kube-scheduler --namespace=kube-system  -o yaml<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹ï¼Œå¯è§å½“ç„¶ leader ä¸º <code>k8s-master03</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">apiVersion: v1<br>kind: Endpoints<br>metadata:<br>  annotations:<br>    control-plane.alpha.kubernetes.io/leader: &#x27;&#123;&quot;holderIdentity&quot;:&quot;k8s-master03_cd78cdca-b2e3-4f36-b2c3-234bb8651d08&quot;,&quot;leaseDurationSeconds&quot;:15,&quot;acquireTime&quot;:&quot;2021-10-07T02:36:24Z&quot;,&quot;renewTime&quot;:&quot;2021-10-07T02:46:33Z&quot;,&quot;leaderTransitions&quot;:0&#125;&#x27;<br>  creationTimestamp: &quot;2021-10-07T02:36:24Z&quot;<br>  managedFields:<br>  - apiVersion: v1<br>    fieldsType: FieldsV1<br>    fieldsV1:<br>      f:metadata:<br>        f:annotations:<br>          .: &#123;&#125;<br>          f:control-plane.alpha.kubernetes.io/leader: &#123;&#125;<br>    manager: kube-scheduler<br>    operation: Update<br>    time: &quot;2021-10-07T02:36:24Z&quot;<br>  name: kube-scheduler<br>  namespace: kube-system<br>  resourceVersion: &quot;69322&quot;<br>  selfLink: /api/v1/namespaces/kube-system/endpoints/kube-scheduler<br>  uid: 645f7d7d-6413-4ef4-bd2b-61a5a82adfe8<br></code></pre></td></tr></table></figure><h3 id="6ã€éƒ¨ç½²-Kubernetes-node-èŠ‚ç‚¹"><a href="#6ã€éƒ¨ç½²-Kubernetes-node-èŠ‚ç‚¹" class="headerlink" title="6ã€éƒ¨ç½² Kubernetes node èŠ‚ç‚¹"></a>6ã€éƒ¨ç½² Kubernetes node èŠ‚ç‚¹</h3><blockquote><p>ğŸŒˆ <strong>å…³äº node èŠ‚ç‚¹</strong></p><p>éƒ¨ç½²åœ¨ master èŠ‚ç‚¹çš„å¿…è¦ç»„ä»¶æœ‰ <code>docker</code>ã€<code>kubelet</code> ã€ <code>kube-proxy</code> ã€<code>ç½‘ç»œç»„ä»¶</code>ï¼Œç”±äºè€ƒè™‘åˆ°åç»­ mertics-serverã€istio ç­‰æœåŠ¡çš„ä½¿ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬å°† master èŠ‚ç‚¹ä¹Ÿä½œä¸º node åŠ å…¥é›†ç¾¤ï¼Œä½†æ˜¯é€šè¿‡æ±¡ç‚¹çš„æ–¹å¼ç¦æ­¢ç›´æ¥è°ƒåº¦ã€‚</p></blockquote><h4 id="1ï¼‰éƒ¨ç½²-kubelet"><a href="#1ï¼‰éƒ¨ç½²-kubelet" class="headerlink" title="1ï¼‰éƒ¨ç½² kubelet"></a>1ï¼‰éƒ¨ç½² kubelet</h4><p><strong>åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kubelet:</strong> <a href="https://tareya.github.io/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kubelet/">ä¼ é€é—¨</a></p><blockquote><p>ğŸš© kubelet è¿è¡Œåœ¨æ¯ä¸ªnodeèŠ‚ç‚¹ä¸Šï¼Œæ¥æ”¶ kube-apiserver å‘é€çš„è¯·æ±‚ï¼Œç®¡ç† Pod å®¹å™¨ï¼Œæ‰§è¡Œäº¤äº’å¼å‘½ä»¤ï¼Œå¦‚ execã€runã€logs ç­‰ã€‚kubelet å¯åŠ¨æ—¶è‡ªåŠ¨å‘ kube-apiserver æ³¨å†ŒèŠ‚ç‚¹ä¿¡æ¯ï¼Œå†…ç½®çš„ cadvisor ç»Ÿè®¡å’Œç›‘æ§èŠ‚ç‚¹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨éƒ¨ç½²æ—¶ç›´æ¥å¼€å¯ TLS bootstrapï¼Œä»¥æ­¤æ¥è‡ªåŠ¨ç­¾å‘ kubelet çš„è¯ä¹¦ã€‚</p><p><strong>ä»¥ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨ k8s-master01 ä¸Šè¿›è¡Œï¼Œç„¶åå†é€šè¿‡æ‰¹ç®¡ç†å·¥å…·åˆ†å‘è‡³å…¶ä»–èŠ‚ç‚¹è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚</strong></p></blockquote><h5 id="1-åˆ›å»º-kubelet-çš„-kubeconfig-é…ç½®æ–‡ä»¶"><a href="#1-åˆ›å»º-kubelet-çš„-kubeconfig-é…ç½®æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º kubelet çš„ kubeconfig é…ç½®æ–‡ä»¶"></a>1. åˆ›å»º kubelet çš„ kubeconfig é…ç½®æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®å¿…è¦å˜é‡</span><br>BOOTSTRAP_TOKEN=$(cat /data/applications/kubernetes/cfg/token.csv | awk -F &#x27;,&#x27; &#x27;&#123;print $1&#125;&#x27;)<br>KUBE_APISERVER=&quot;https://$(hostname -i):6443&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®é›†ç¾¤å‚æ•°</span><br>kubectl config set-cluster kubernetes \<br>  --certificate-authority=/data/applications/kubernetes/ssl/ca.pem \<br>  --embed-certs=true \<br>  --server=$&#123;KUBE_APISERVER&#125; \<br>  --kubeconfig=$&#123;HOME&#125;/kubernetes/node/cfg/bootstrap.kubeconfig<br><span class="hljs-meta">  </span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°</span><br>kubectl config set-credentials kubelet-bootstrap \<br>  --token=$&#123;BOOTSTRAP_TOKEN&#125; \<br>  --kubeconfig=$&#123;HOME&#125;/kubernetes/node/cfg/bootstrap.kubeconfig<br><span class="hljs-meta">  </span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°</span><br>kubectl config set-context default \<br>  --cluster=kubernetes \<br>  --user=kubelet-bootstrap \<br>  --kubeconfig=$&#123;HOME&#125;/kubernetes/node/cfg/bootstrap.kubeconfig<br><span class="hljs-meta">  </span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡</span><br>kubectl config use-context default --kubeconfig=$&#123;HOME&#125;/kubernetes/node/cfg/bootstrap.kubeconfig<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-4"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-4" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m copy  -a &quot;src=~/kubernetes/node/cfg/bootstrap.kubeconfig dest=/data/applications/kubernetes/cfg/bootstrap.kubeconfig owner=root group=root mode=0600&quot;<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»º-kubelet-å‚æ•°-yaml-é…ç½®æ–‡ä»¶"><a href="#2-åˆ›å»º-kubelet-å‚æ•°-yaml-é…ç½®æ–‡ä»¶" class="headerlink" title="2. åˆ›å»º kubelet å‚æ•° yaml é…ç½®æ–‡ä»¶"></a>2. åˆ›å»º kubelet å‚æ•° yaml é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/node/cfg/kubelet-config.yml</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹: </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">KubeletConfiguration</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubelet.config.k8s.io/v1beta1</span><br><span class="hljs-attr">address:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br><span class="hljs-attr">port:</span> <span class="hljs-number">10250</span><br><span class="hljs-attr">readOnlyPort:</span> <span class="hljs-number">10255</span><br><span class="hljs-attr">cgroupDriver:</span> <span class="hljs-string">cgroupfs</span><br><span class="hljs-attr">clusterDNS:</span><br><span class="hljs-bullet">-</span> <span class="hljs-number">10.0</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span><br><span class="hljs-attr">clusterDomain:</span> <span class="hljs-string">cluster.local</span> <br><span class="hljs-attr">failSwapOn:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">authentication:</span><br>  <span class="hljs-attr">anonymous:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">webhook:</span><br>    <span class="hljs-attr">cacheTTL:</span> <span class="hljs-string">2m0s</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">x509:</span><br>    <span class="hljs-attr">clientCAFile:</span> <span class="hljs-string">/data/applications/kubernetes/ssl/ca.pem</span> <br><span class="hljs-attr">authorization:</span><br>  <span class="hljs-attr">mode:</span> <span class="hljs-string">Webhook</span><br>  <span class="hljs-attr">webhook:</span><br>    <span class="hljs-attr">cacheAuthorizedTTL:</span> <span class="hljs-string">5m0s</span><br>    <span class="hljs-attr">cacheUnauthorizedTTL:</span> <span class="hljs-string">30s</span><br><span class="hljs-attr">evictionHard:</span><br>  <span class="hljs-attr">imagefs.available:</span> <span class="hljs-number">15</span><span class="hljs-string">%</span><br>  <span class="hljs-attr">memory.available:</span> <span class="hljs-string">100Mi</span><br>  <span class="hljs-attr">nodefs.available:</span> <span class="hljs-number">10</span><span class="hljs-string">%</span><br>  <span class="hljs-attr">nodefs.inodesFree:</span> <span class="hljs-number">5</span><span class="hljs-string">%</span><br><span class="hljs-attr">maxOpenFiles:</span> <span class="hljs-number">1000000</span><br><span class="hljs-attr">maxPods:</span> <span class="hljs-number">80</span><br><span class="hljs-attr">featureGates:</span><br>  <span class="hljs-attr">RotateKubeletServerCertificate:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">rotateCertificates:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">serverTLSBootstrap:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜-8"><a href="#é…ç½®å‚æ•°è¯´æ˜-8" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-5"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-5" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m copy  -a &quot;src=~/kubernetes/node/cfg/kubelet-config.yml dest=/data/applications/kubernetes/cfg/kubelet-config.yml owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="3-åˆ›å»º-kubelet-é…ç½®æ–‡ä»¶"><a href="#3-åˆ›å»º-kubelet-é…ç½®æ–‡ä»¶" class="headerlink" title="3. åˆ›å»º kubelet é…ç½®æ–‡ä»¶"></a>3. åˆ›å»º kubelet é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/node/cfg/kubelet.conf</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹: (<code>hostname-override</code> æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">KUBELET_OPTS=&quot;--hostname-override=k8s-master01 \<br>--pod_infra_container_image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.1 \<br>--bootstrap-kubeconfig=/data/applications/kubernetes/cfg/bootstrap.kubeconfig \<br>--kubeconfig=/data/application/kubernetes/cfg/kubelet.kubeconfig \<br>--config=/data/applications/kubernetes/cfg/kubelet-config.yml \<br>--cert-dir=/data/applications/kubernetes/ssl \<br>--network-plugin=cni \<br>--fail-swap-on=false \<br>--logtostderr=true \<br>--v=2 \<br>--log-dir=/data/applications/kubernetes/logs \<br>--node-labels=node.kubernetes.io/k8s-master=true&quot;<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-6"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-6" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m copy  -a &quot;src=~/kubernetes/node/cfg/kubelet.conf dest=/data/applications/kubernetes/cfg/kubelet.conf owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p><code>hostname-override</code> è®¾ç½®ä¸ºå„nodeèŠ‚ç‚¹ä¸»æœºIPï¼ˆæˆ– ä¸»æœºådnsè§£æï¼‰</p><p><code>KUBELET_POD_INFRA_CONTAINER</code> å¯è®¾ç½®ä¸ºç§æœ‰å®¹å™¨ä»“åº“åœ°å€ï¼Œå¦‚æœ‰å¯è®¾ç½®ä¸º <code>KUBELET_POD_INFRA_CONTAINER=&quot;--pod_infra_container_image=&#123;ç§æœ‰é•œåƒä»“åº“ip&#125;:80/k8s/pause-amd64:v3.1&quot;</code></p><p><code>node-labels</code> å¦‚æ˜¯ master èŠ‚ç‚¹åˆ™è®¾ç½®ä¸º masterï¼Œnode èŠ‚ç‚¹åˆ™è®¾ç½®ä¸º node</p></blockquote><h5 id="4-åˆ›å»º-systemd-unit-æ–‡ä»¶-1"><a href="#4-åˆ›å»º-systemd-unit-æ–‡ä»¶-1" class="headerlink" title="4. åˆ›å»º systemd unit æ–‡ä»¶"></a>4. åˆ›å»º systemd unit æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/node/systemd/kubelet.service</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Unit]<br>Description=Kubernetes Kubelet<br>Documentation=https://github.com/GoogleCloudPlatform/kubernetes<br>After=docker.service<br>Requires=docker.service<br><br>[Service]<br>EnvironmentFile=/data/applications/kubernetes/cfg/kubelet.conf <br>ExecStart=/data/applications/kubernetes/bin/kubelet $KUBELET_OPTS<br>Restart=always<br>RestartSec=5<br>StartLimitInterval=0<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-7"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-7" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m copy -a &quot;src=~/kubernetes/node/systemd/kubelet.service dest=/usr/lib/systemd/system/kubelet.service owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="5-å¯åŠ¨-kubelet-æœåŠ¡"><a href="#5-å¯åŠ¨-kubelet-æœåŠ¡" class="headerlink" title="5. å¯åŠ¨ kubelet æœåŠ¡"></a>5. å¯åŠ¨ kubelet æœåŠ¡</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m shell -a &quot;systemctl daemon-reload&quot;<br>ansible k8s-node -S -R root -m shell -a &quot;systemctl enable kubelet.service&quot;<br>ansible k8s-node -S -R root -m shell -a &quot;systemctl start kubelet.service&quot;<br>ansible k8s-node -S -R root -m shell -a &quot;systemctl status kubelet.service&quot;<br></code></pre></td></tr></table></figure><h5 id="6-bootstrap-token-è®¤è¯æˆæƒ"><a href="#6-bootstrap-token-è®¤è¯æˆæƒ" class="headerlink" title="6. bootstrap token è®¤è¯æˆæƒ"></a>6. bootstrap token è®¤è¯æˆæƒ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap<br></code></pre></td></tr></table></figure><h5 id="7-è‡ªåŠ¨-approce-CSR-è¯·æ±‚"><a href="#7-è‡ªåŠ¨-approce-CSR-è¯·æ±‚" class="headerlink" title="7. è‡ªåŠ¨ approce CSR è¯·æ±‚"></a>7. è‡ªåŠ¨ approce CSR è¯·æ±‚</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/yaml/csr-crb.yaml </code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Approve all CSRs <span class="hljs-keyword">for</span> the group <span class="hljs-string">&quot;system:bootstrappers&quot;</span></span><br>kind: ClusterRoleBinding<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  name: auto-approve-csrs-for-group<br>subjects:<br>- kind: Group<br>  name: system:node-bootstrap<br>  apiGroup: rbac.authorization.k8s.io<br>roleRef:<br>  kind: ClusterRole<br>  name: system:certificates.k8s.io:certificatesigningrequests:nodeclient<br>  apiGroup: rbac.authorization.k8s.io<br>---<br><span class="hljs-meta">#</span><span class="bash"> To <span class="hljs-built_in">let</span> a node of the group <span class="hljs-string">&quot;system:nodes&quot;</span> renew its own credentials</span><br>kind: ClusterRoleBinding<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  name: node-client-cert-renewal<br>subjects:<br>- kind: Group<br>  name: system:nodes<br>  apiGroup: rbac.authorization.k8s.io<br>roleRef:<br>  kind: ClusterRole<br>  name: system:certificates.k8s.io:certificatesigningrequests:selfnodeclient<br>  apiGroup: rbac.authorization.k8s.io<br>---<br><span class="hljs-meta">#</span><span class="bash"> A ClusterRole <span class="hljs-built_in">which</span> instructs the CSR approver to approve a node requesting a</span><br><span class="hljs-meta">#</span><span class="bash"> serving cert matching its client cert.</span><br>kind: ClusterRole<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  name: approve-node-server-renewal-csr<br>rules:<br>- apiGroups: [&quot;certificates.k8s.io&quot;]<br>  resources: [&quot;certificatesigningrequests/selfnodeserver&quot;]<br>  verbs: [&quot;create&quot;]<br>---<br><span class="hljs-meta">#</span><span class="bash"> To <span class="hljs-built_in">let</span> a node of the group <span class="hljs-string">&quot;system:nodes&quot;</span> renew its own server credentials</span><br>kind: ClusterRoleBinding<br>apiVersion: rbac.authorization.k8s.io/v1<br>metadata:<br>  name: node-server-cert-renewal<br>subjects:<br>- kind: Group<br>  name: system:nodes<br>  apiGroup: rbac.authorization.k8s.io<br>roleRef:<br>  kind: ClusterRole<br>  name: approve-node-server-renewal-csr<br>  apiGroup: rbac.authorization.k8s.io<br></code></pre></td></tr></table></figure><blockquote><p>ğŸŒˆ <strong>rbacè§„åˆ™è§£é‡Šè¯´æ˜</strong></p><p><code>auto-approve-csrs-for-group</code>ï¼š</p><ul><li>è‡ªåŠ¨ approve node çš„ç¬¬ä¸€æ¬¡ CSRï¼› æ³¨æ„ç¬¬ä¸€æ¬¡ CSR æ—¶ï¼Œè¯·æ±‚çš„ Group ä¸º system:bootstrapï¼ˆæ³¨æ„ group è¦å’Œè®¤è¯ç”¨çš„ token.csv ä¸­çš„ group ä¿æŒä¸€è‡´ï¼‰ï¼›</li></ul><p><code>node-client-cert-renewal</code>ï¼š</p><ul><li>è‡ªåŠ¨ approve node åç»­è¿‡æœŸçš„ client è¯ä¹¦ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„è¯ä¹¦ Group ä¸º system:nodesï¼›</li></ul><p><code>node-server-cert-renewal</code>ï¼š</p><p>è‡ªåŠ¨ approve node åç»­è¿‡æœŸçš„ server è¯ä¹¦ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„è¯ä¹¦ Group ä¸º system:nodes;`</p></blockquote><h6 id="æ‰§è¡Œåˆ›å»º"><a href="#æ‰§è¡Œåˆ›å»º" class="headerlink" title="æ‰§è¡Œåˆ›å»º:"></a>æ‰§è¡Œåˆ›å»º:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl apply -f ~/kubernetes/yaml/csr-crb.yaml <br></code></pre></td></tr></table></figure><h5 id="8-æŸ¥çœ‹CSRè¯ä¹¦è¯·æ±‚å¹¶æ‰¹å‡†-kubelet-çš„-TLS-è¯ä¹¦è¯·æ±‚"><a href="#8-æŸ¥çœ‹CSRè¯ä¹¦è¯·æ±‚å¹¶æ‰¹å‡†-kubelet-çš„-TLS-è¯ä¹¦è¯·æ±‚" class="headerlink" title="8. æŸ¥çœ‹CSRè¯ä¹¦è¯·æ±‚å¹¶æ‰¹å‡† kubelet çš„ TLS è¯ä¹¦è¯·æ±‚"></a>8. æŸ¥çœ‹CSRè¯ä¹¦è¯·æ±‚å¹¶æ‰¹å‡† kubelet çš„ TLS è¯ä¹¦è¯·æ±‚</h5><blockquote><p>ğŸš© å¦‚æœé€šè¿‡ TLS bootstrap ç®¡ç†åï¼Œkubelet çš„ è¯ä¹¦å°±ä¼šå˜æˆè½®è¯¢è¯ä¹¦çš„å½¢å¼ï¼Œclient è¯ä¹¦ä¼šè‡ªåŠ¨ç­¾å‘ï¼Œserver è¯ä¹¦åŸºäºå®‰å…¨æ€§è€ƒè™‘ï¼ŒCSR approving controllers ä¸ä¼šè‡ªåŠ¨ approve kubelet server è¯ä¹¦ç­¾åè¯·æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨ approveï¼Œä½†æ˜¯é€šè¿‡è‡ªå®šä¹‰çš„è§¦å‘å™¨ï¼ŒåŒæ ·ä¹Ÿèƒ½å®ç°è‡ªåŠ¨åŒ–ã€‚å¹¶ä¸”ä¼šè‡ªåŠ¨ç”Ÿæˆ kubelet.kubeconfig ä¸“é—¨ç”¨äºè¯ä¹¦çš„è®¤è¯å’Œç­¾å‘ç®¡ç†ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ‰¹é‡ç­¾å‘(Pending çš„ CSR ç”¨äºåˆ›å»º kubelet server è¯ä¹¦ï¼Œéœ€è¦æ‰‹åŠ¨ approve)</span><br>kubectl get csr|grep &#x27;Pending&#x27; | awk &#x27;NR&gt;0&#123;print $1&#125;&#x27;|xargs kubectl certificate approve<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹ csr è¯·æ±‚ï¼ˆæ‰¹å‡†ç”³è¯·æŸ¥çœ‹åCONDITIONæ˜¾ç¤ºApproved,Issuedå³å¯ï¼‰</span><br>kubectl get csr<br></code></pre></td></tr></table></figure><h5 id="9-éªŒè¯-TLS-bootstrap-ç®¡ç†è¯ä¹¦"><a href="#9-éªŒè¯-TLS-bootstrap-ç®¡ç†è¯ä¹¦" class="headerlink" title="9. éªŒè¯ TLS bootstrap ç®¡ç†è¯ä¹¦:"></a>9. éªŒè¯ TLS bootstrap ç®¡ç†è¯ä¹¦:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ll /data/applications/kubernetes/ssl/kubelet-*.pem<br></code></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µï¼Œç»“æœå¦‚ä¸‹:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211008113644603.png" alt="image-20211008113644603"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /data/applications/kubernetes/cfg/kubelet.kubeconfig <br></code></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µï¼Œç»“æœå¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority-data:</span> <span class="hljs-string">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR2akNDQXFhZ0F3SUJBZ0lVR0lHZ2VQSWNoSWtKRnFZOTJ6MWE2Z1RCNVBnd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1pURUxNQWtHQTFVRUJoTUNRMDR4RURBT0JnTlZCQWdUQjBKbGFVcHBibWN4RURBT0JnTlZCQWNUQjBKbAphVXBwYm1jeEREQUtCZ05WQkFvVEEyczRjekVQTUEwR0ExVUVDeE1HYzNsemRHVnRNUk13RVFZRFZRUURFd3ByCmRXSmxjbTVsZEdWek1CNFhEVEl4TURreU16QTVNVEF3TUZvWERUTXhNRGt5TVRBNU1UQXdNRm93WlRFTE1Ba0cKQTFVRUJoTUNRMDR4RURBT0JnTlZCQWdUQjBKbGFVcHBibWN4RURBT0JnTlZCQWNUQjBKbGFVcHBibWN4RERBSwpCZ05WQkFvVEEyczRjekVQTUEwR0ExVUVDeE1HYzNsemRHVnRNUk13RVFZRFZRUURFd3ByZFdKbGNtNWxkR1Z6Ck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBeUU4ZytUWUhMdCtjQXJSRkRyZTYKNmp5ZG9VbFkvM29TeW1uT3d6dEhHMFk0ZDhPOXVBZVZRTTdNWm1BMGhpRHhXUVZiWHlKQTBvNkVwVzFvRlR3YgpHdG5QUWlqSVFJTWlnZVNTNnVHVEZiRklpUTNBam53Y2tGdlI5WHlRTHVyejBRNnJFM21yc3RMNlBLYUx1SEJwCmo1SDZsRUx3OTdxdCtjR0NtQnMraEdFc202THVEWmwxRGlBb1RQQnduZTdlWHRqM2xmam5oUW44a0IrbGJMSmYKYjRSakFSbkN5RUgwMnBzTXNUcW85ckhiZEczUUNCeHlGZ2s1ZHRNczQwVFMyV0VzQjNyRnJnaHF0R2hPRWM2cApGZytrMjZEL0RMTHpNTWxCLzBKOXlkN0FkOUZlbkdjeUZIc2FKclMvM3RCVlFpWk5oaTBaZzlWM013Rk0zUHZPClZ3SURBUUFCbzJZd1pEQU9CZ05WSFE4QkFmOEVCQU1DQVFZd0VnWURWUjBUQVFIL0JBZ3dCZ0VCL3dJQkFqQWQKQmdOVkhRNEVGZ1FVREhEaGVia1hzWlRPZWw3TTdhQmtML2cxSUtvd0h3WURWUjBqQkJnd0ZvQVVESERoZWJrWApzWlRPZWw3TTdhQmtML2cxSUtvd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFFSjZZby9oNklsTWlZSFVHY1NhCkNJKytuUTNHWklKQlJYc0huMWlSRGVUaVBtejQvQm5pWmJlT3dXK1V2WVIwcytEMTlVeTRwa2cvb2tYUGdUM1oKdjBIN1IzdHpmMklGUVNhbnhBTE9hVTdxbm5tWU9JOUpYa0FDclR6QjJ5TlhWSXpZamRDMkxZS1kzRDI2TVZFZwpLQWtVWG5ybWxZcGUxOUh5UWFiVy9uSklPTDNJUzZRQlp2WGZ1aHpRMEJXL3g5OWdPV2swVGFrYnIrdlhhdWZxCk9Eb2hJT0E1cmk0UkVWN0M4WE1QYWNpREVGRVVGNG9hZlV6eFVjNVlIbDhkMnQwN1k3Mkl3WTdFaDY5ZG8weGkKQjNRZS8xc2dLRWZBZXp1NXV5eGhTZlpqODYybzQ1WGpCMzc1dHRETlEwdlhkcVRBUGU1SFpaUzUyeDAyRVFLWAp1V2c9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://192.168.3.231:6443</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">default-cluster</span><br><span class="hljs-attr">contexts:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">context:</span><br>    <span class="hljs-attr">cluster:</span> <span class="hljs-string">default-cluster</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">default-auth</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">default-context</span><br><span class="hljs-attr">current-context:</span> <span class="hljs-string">default-context</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span><br><span class="hljs-attr">preferences:</span> &#123;&#125;<br><span class="hljs-attr">users:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">default-auth</span><br>  <span class="hljs-attr">user:</span><br>    <span class="hljs-attr">client-certificate:</span> <span class="hljs-string">/data/applications/kubernetes/ssl/kubelet-client-current.pem</span><br>    <span class="hljs-attr">client-key:</span> <span class="hljs-string">/data/applications/kubernetes/ssl/kubelet-client-current.pem</span><br></code></pre></td></tr></table></figure><h5 id="10-éªŒè¯èŠ‚ç‚¹çŠ¶æ€"><a href="#10-éªŒè¯èŠ‚ç‚¹çŠ¶æ€" class="headerlink" title="10. éªŒè¯èŠ‚ç‚¹çŠ¶æ€"></a>10. éªŒè¯èŠ‚ç‚¹çŠ¶æ€</h5><h6 id="1âƒ£ï¸-æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯"><a href="#1âƒ£ï¸-æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯" class="headerlink" title="1âƒ£ï¸ æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯:"></a>1âƒ£ï¸ æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get nodes<br></code></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µï¼Œè¿”å›å¦‚ä¸‹: (æ­¤æ—¶å‘ç°æ‰€æœ‰nodeèŠ‚ç‚¹çŠ¶æ€å‡ä¸º â€œreadyâ€)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME           STATUS   ROLES    AGE   VERSION<br>k8s-master01   Ready    &lt;none&gt;   12h   v1.18.18<br>k8s-master02   Ready    &lt;none&gt;   12h   v1.18.18<br>k8s-master03   Ready    &lt;none&gt;   12h   v1.18.18<br>k8s-node1      Ready    &lt;none&gt;   12h   v1.18.18<br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-æŸ¥çœ‹ç›‘å¬ç«¯å£-2"><a href="#2âƒ£ï¸-æŸ¥çœ‹ç›‘å¬ç«¯å£-2" class="headerlink" title="2âƒ£ï¸ æŸ¥çœ‹ç›‘å¬ç«¯å£:"></a>2âƒ£ï¸ æŸ¥çœ‹ç›‘å¬ç«¯å£:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -lntp|grep kubelet<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">tcp        0      0 127.0.0.1:40621         0.0.0.0:*               LISTEN      28305/kubelet       <br>tcp        0      0 127.0.0.1:10248         0.0.0.0:*               LISTEN      28305/kubelet       <br>tcp6       0      0 :::10250                :::*                    LISTEN      28305/kubelet       <br>tcp6       0      0 :::10255                :::*                    LISTEN      28305/kubelet    <br></code></pre></td></tr></table></figure><blockquote><p>ğŸŒˆ kubelet ç›‘å¬ç«¯å£ä¸º 10248ã€10250ã€10255</p><p><code>10248</code>ï¼šhealthz httpæœåŠ¡ç«¯å£ï¼Œå³å¥åº·æ£€æŸ¥æœåŠ¡çš„ç«¯å£ï¼Œæ¥æ”¶ http è¯·æ±‚ï¼Œä¸éœ€è¦è®¤è¯æˆæƒï¼›<br><code>10250</code>ï¼škubelet æœåŠ¡ç›‘å¬çš„ç«¯å£, api ä¼šæ£€æµ‹ä»–æ˜¯å¦å­˜æ´»ã€‚æ¥æ”¶ https è¯·æ±‚ï¼Œè®¿é—®è¯¥ç«¯å£æ—¶éœ€è¦è®¤è¯å’Œæˆæƒï¼ˆå³ä½¿è®¿é—®<code>/healthz</code>ä¹Ÿéœ€è¦ï¼‰ï¼›</p><p><code>10255</code>: åªè¯»ç«¯å£ï¼Œå¯ä»¥ä¸ç”¨éªŒè¯å’Œæˆæƒæœºåˆ¶ï¼Œç›´æ¥è®¿é—®ã€‚é…ç½® <code>&quot;readOnlyPort: 0&quot;</code> åˆ™è¡¨ç¤ºå…³é—­åªè¯»ç«¯å£ï¼›</p></blockquote><h4 id="2ï¼‰éƒ¨ç½²-kube-proxy"><a href="#2ï¼‰éƒ¨ç½²-kube-proxy" class="headerlink" title="2ï¼‰éƒ¨ç½² kube-proxy"></a>2ï¼‰éƒ¨ç½² kube-proxy</h4><p><strong>åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” kube-proxy:</strong> <a href="https://tareya.github.io/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-kube-proxy/">ä¼ é€é—¨</a></p><blockquote><p>ğŸš© kube-proxyè¿è¡Œåœ¨æ‰€æœ‰çš„nodeèŠ‚ç‚¹ä¸Šï¼Œå®ƒç›‘å¬apiserverä¸­serviceå’Œendpointçš„å˜åŒ–æƒ…å†µï¼Œåˆ›å»ºè·¯ç”±è§„åˆ™ä»¥æä¾›æœåŠ¡IPå’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</p><p><strong>ä»¥ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨ k8s-master01 ä¸Šè¿›è¡Œï¼Œç„¶åå†é€šè¿‡æ‰¹ç®¡ç†å·¥å…·åˆ†å‘è‡³å…¶ä»–èŠ‚ç‚¹è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚</strong></p></blockquote><h5 id="1-åˆ›å»º-kube-proxy-çš„-kubeconfig-é…ç½®æ–‡ä»¶"><a href="#1-åˆ›å»º-kube-proxy-çš„-kubeconfig-é…ç½®æ–‡ä»¶" class="headerlink" title="1. åˆ›å»º kube-proxy çš„ kubeconfig é…ç½®æ–‡ä»¶"></a>1. åˆ›å»º kube-proxy çš„ kubeconfig é…ç½®æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">KUBE_APISERVER=&quot;https://$(hostname -i):6443&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®é›†ç¾¤å‚æ•°</span><br>kubectl config set-cluster kubernetes \<br>  --certificate-authority=/data/applications/kubernetes/ssl/ca.pem \<br>  --embed-certs=true \<br>  --server=$&#123;KUBE_APISERVER&#125; \<br>  --kubeconfig=$&#123;HOME&#125;/kubernetes/node/cfg/kube-proxy.kubeconfig<br><span class="hljs-meta"> </span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°</span> <br>kubectl config set-credentials kube-proxy \<br>  --client-certificate=/data/applications/kubernetes/ssl/kube-proxy.pem \<br>  --client-key=/data/applications/kubernetes/ssl/kube-proxy-key.pem \<br>  --embed-certs=true \<br>  --kubeconfig=$&#123;HOME&#125;/kubernetes/node/cfg/kube-proxy.kubeconfig<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°</span><br>kubectl config set-context default \<br>  --cluster=kubernetes \<br>  --user=kube-proxy \<br>  --kubeconfig=$&#123;HOME&#125;/kubernetes/node/cfg/kube-proxy.kubeconfig<br><span class="hljs-meta">  </span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡</span> <br>kubectl config use-context default --kubeconfig=$&#123;HOME&#125;/kubernetes/node/cfg/kube-proxy.kubeconfig<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-8"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-8" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m copy  -a &quot;src=~/kubernetes/node/cfg/kube-proxy.kubeconfig dest=/data/applications/kubernetes/cfg/kube-proxy.kubeconfig owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»º-kube-proxy-å‚æ•°-yaml-é…ç½®æ–‡ä»¶"><a href="#2-åˆ›å»º-kube-proxy-å‚æ•°-yaml-é…ç½®æ–‡ä»¶" class="headerlink" title="2. åˆ›å»º kube-proxy å‚æ•° yaml é…ç½®æ–‡ä»¶"></a>2. åˆ›å»º kube-proxy å‚æ•° yaml é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/node/cfg/kube-proxy-config.yml</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:  (<code>hostname-override</code> æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">kind: KubeProxyConfiguration<br>apiVersion: kubeproxy.config.k8s.io/v1alpha1<br>hostnameOverride: k8s-master01<br>address: 0.0.0.0<br>metricsBindAddress: 0.0.0.0:10249<br>healthzBindAddress: 0.0.0.0:10256<br>clientConnection:<br>  burst: 200<br>  kubeconfig: &quot;/data/applications/kubernetes/cfg/kube-proxy.kubeconfig&quot;<br>  qps: 100<br>enableProfiling: true<br>clusterCIDR: 10.0.0.0/16<br>portRange: &quot;&quot;<br>mode: &quot;ipvs&quot;<br>kubeProxyIPTablesConfiguration:<br>  masqueradeAll: true<br>kubeProxyIPVSConfiguration:<br>  scheduler: rr<br>  excludeCIDRs: []<br></code></pre></td></tr></table></figure><h6 id="é…ç½®å‚æ•°è¯´æ˜-9"><a href="#é…ç½®å‚æ•°è¯´æ˜-9" class="headerlink" title="é…ç½®å‚æ•°è¯´æ˜:"></a>é…ç½®å‚æ•°è¯´æ˜:</h6><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-9"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-9" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m copy  -a &quot;src=~/kubernetes/node/cfg/kube-proxy-config.yml dest=/data/applications/kubernetes/cfg/kube-proxy-config.yml owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="3-åˆ›å»º-kube-proxy-é…ç½®æ–‡ä»¶"><a href="#3-åˆ›å»º-kube-proxy-é…ç½®æ–‡ä»¶" class="headerlink" title="3. åˆ›å»º kube-proxy é…ç½®æ–‡ä»¶"></a>3. åˆ›å»º kube-proxy é…ç½®æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/node/cfg/kube-proxy.conf</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">KUBE_PROXY_OPTS=&quot;--logtostderr=true \<br>--v=2 \<br>--log-dir=/data/applications/kubernetes/logs \<br>--ipvs-min-sync-period=5s \<br>--ipvs-sync-period=5s \<br>--config=/data/applications/kubernetes/cfg/kube-proxy-config.yml&quot;<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-10"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-10" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m copy  -a &quot;src=~/kubernetes/node/cfg/kube-proxy.conf dest=/data/applications/kubernetes/cfg/kube-proxy.conf owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="4-åˆ›å»º-systemd-unit-æ–‡ä»¶-2"><a href="#4-åˆ›å»º-systemd-unit-æ–‡ä»¶-2" class="headerlink" title="4. åˆ›å»º systemd unit æ–‡ä»¶"></a>4. åˆ›å»º systemd unit æ–‡ä»¶</h5><p>æ–°å»ºæ–‡ä»¶ <code>~/kubernetes/node/systemd/kube-proxy.service</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Unit]<br>Description=Kubernetes Kube-Proxy Server<br>Documentation=https://github.com/GoogleCloudPlatform/kubernetes<br>After=network.target<br><br>[Service]<br>EnvironmentFile=/data/applications/kubernetes/cfg/kube-proxy.conf<br>ExecStart=/data/applications/kubernetes/bin/kube-proxy $KUBE_PROXY_OPTS<br>Restart=on-failure<br>RestartSec=5<br>LimitNOFILE=65536<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘é…ç½®æ–‡ä»¶-11"><a href="#åˆ†å‘é…ç½®æ–‡ä»¶-11" class="headerlink" title="åˆ†å‘é…ç½®æ–‡ä»¶:"></a>åˆ†å‘é…ç½®æ–‡ä»¶:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m copy -a &quot;src=~/kubernetes/node/systemd/kube-proxy.service dest=/usr/lib/systemd/system/kube-proxy.service owner=root group=root mode=0644&quot;<br></code></pre></td></tr></table></figure><h5 id="5-å¼€å¯-ipvs"><a href="#5-å¼€å¯-ipvs" class="headerlink" title="5. å¼€å¯ ipvs"></a>5. å¼€å¯ ipvs</h5><blockquote><p>ğŸŒˆ ä» <code>k8s</code> çš„1.8ç‰ˆæœ¬å¼€å§‹ï¼Œ<code>kube-proxy</code> å¼•å…¥äº† <code>IPVS</code> æ¨¡å¼ï¼Œ<code>IPVS</code>æ¨¡å¼ä¸ <code>iptables</code> åŒæ ·åŸºäº <code>Netfilter</code> ï¼Œä½†æ˜¯é‡‡ç”¨çš„ <code>hash</code> è¡¨ï¼Œå› æ­¤å½“<code>service</code>æ•°é‡è¾¾åˆ°ä¸€å®šè§„æ¨¡æ—¶ï¼ŒhashæŸ¥è¡¨çš„é€Ÿåº¦ä¼˜åŠ¿å°±ä¼šæ˜¾ç°å‡ºæ¥ï¼Œä»è€Œæé«˜ <code>service</code>çš„æœåŠ¡æ€§èƒ½ã€‚</p><p><strong>ä»¥ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨æ‰€æœ‰ node èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚</strong></p></blockquote><h6 id="1âƒ£ï¸-å¼€å¯å†…æ ¸å‚æ•°"><a href="#1âƒ£ï¸-å¼€å¯å†…æ ¸å‚æ•°" class="headerlink" title="1âƒ£ï¸ å¼€å¯å†…æ ¸å‚æ•°"></a>1âƒ£ï¸ å¼€å¯å†…æ ¸å‚æ•°</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è¿½åŠ å†…æ ¸å‚æ•°ï¼Œå¼€å¯äºŒå±‚ç½‘æ¡¥å¤„ç†</span><br>cat &gt;&gt; /etc/sysctl.d/kubernetes.conf &lt;&lt; EOF<br>net.bridge.bridge-nf-call-iptables = 1<br>net.bridge.bridge-nf-call-ip6tables = 1<br>EOF<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åŠ è½½å‚æ•°</span><br>sysctl -p /etc/sysctl.d/kubernetes.conf <br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-å®‰è£…-ipvsadm-ç­‰å·¥å…·"><a href="#2âƒ£ï¸-å®‰è£…-ipvsadm-ç­‰å·¥å…·" class="headerlink" title="2âƒ£ï¸ å®‰è£… ipvsadm ç­‰å·¥å…·"></a>2âƒ£ï¸ å®‰è£… ipvsadm ç­‰å·¥å…·</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m shell -a &quot;yum install -y ipvsadm ipset bridge-utils conntrack&quot;<br></code></pre></td></tr></table></figure><h6 id="3âƒ£ï¸-å¼€å¯-ipvs-æ”¯æŒ"><a href="#3âƒ£ï¸-å¼€å¯-ipvs-æ”¯æŒ" class="headerlink" title="3âƒ£ï¸ å¼€å¯ ipvs æ”¯æŒ"></a>3âƒ£ï¸ å¼€å¯ ipvs æ”¯æŒ</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ›å»º ipvs æ¨¡å—é…ç½®</span><br>cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF<br>modprobe -- ip_vs<br>modprobe -- ip_vs_rr<br>modprobe -- ip_vs_wrr<br>modprobe -- ip_vs_sh<br>modprobe -- nf_conntrack_ipv4<br>EOF<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> èµ‹äºˆæ‰§è¡Œæƒé™</span><br>chmod 755 /etc/sysconfig/modules/ipvs.modules<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åŠ è½½é…ç½®</span><br>bash /etc/sysconfig/modules/ipvs.modules<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹åŠ è½½ä¿¡æ¯</span><br>lsmod | grep ip_vs<br></code></pre></td></tr></table></figure><p>æ­£ç¡®æƒ…å†µï¼Œè¿”å›å¦‚ä¸‹:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211008141710750.png" alt="image-20211008141710750"></p><h5 id="6-å¯åŠ¨-kube-proxy-æœåŠ¡"><a href="#6-å¯åŠ¨-kube-proxy-æœåŠ¡" class="headerlink" title="6. å¯åŠ¨ kube-proxy æœåŠ¡"></a>6. å¯åŠ¨ kube-proxy æœåŠ¡</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m shell -a &quot;systemctl daemon-reload&quot;<br>ansible k8s-node -S -R root -m shell -a &quot;systemctl enable kube-proxy.service&quot;<br>ansible k8s-node -S -R root -m shell -a &quot;systemctl start kube-proxy.service&quot;<br>ansible k8s-node -S -R root -m shell -a &quot;systemctl status kube-proxy.service&quot;<br></code></pre></td></tr></table></figure><h5 id="7-éªŒè¯èŠ‚ç‚¹çŠ¶æ€"><a href="#7-éªŒè¯èŠ‚ç‚¹çŠ¶æ€" class="headerlink" title="7. éªŒè¯èŠ‚ç‚¹çŠ¶æ€"></a>7. éªŒè¯èŠ‚ç‚¹çŠ¶æ€</h5><h6 id="1âƒ£ï¸-æŸ¥çœ‹ç›‘å¬ç«¯å£"><a href="#1âƒ£ï¸-æŸ¥çœ‹ç›‘å¬ç«¯å£" class="headerlink" title="1âƒ£ï¸ æŸ¥çœ‹ç›‘å¬ç«¯å£:"></a>1âƒ£ï¸ æŸ¥çœ‹ç›‘å¬ç«¯å£:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -lnpt|grep kube-proxy<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">tcp6       0      0 :::10256                :::*                    LISTEN      25828/kube-proxy    <br>tcp6       0      0 :::10249                :::*                    LISTEN      25828/kube-proxy       <br></code></pre></td></tr></table></figure><blockquote><p>ğŸŒˆ kubelet ç›‘å¬ç«¯å£ä¸º 10249ã€10256</p><p><code>10249</code>ï¼šæ¥æ”¶ http è¯·æ±‚ï¼Œä¸éœ€è¦è®¤è¯æˆæƒï¼Œç”¨äºæä¾› <code>/metrics </code>ï¼›<br><code>10256</code>ï¼šæ¥æ”¶ http è¯·æ±‚ï¼Œä¸éœ€è¦è®¤è¯æˆæƒï¼Œç”¨äºæä¾›<code> /healthz</code>ã€‚</p></blockquote><h6 id="2âƒ£ï¸-æŸ¥çœ‹-ipvs-è·¯ç”±è§„åˆ™"><a href="#2âƒ£ï¸-æŸ¥çœ‹-ipvs-è·¯ç”±è§„åˆ™" class="headerlink" title="2âƒ£ï¸ æŸ¥çœ‹ ipvs è·¯ç”±è§„åˆ™"></a>2âƒ£ï¸ æŸ¥çœ‹ ipvs è·¯ç”±è§„åˆ™</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ipvsadm -ln<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">IP Virtual Server version 1.2.1 (size=4096)<br>Prot LocalAddress:Port Scheduler Flags<br><span class="hljs-meta">  -&gt;</span><span class="bash"> RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br>TCP  10.0.0.1:443 rr<br><span class="hljs-meta">  -&gt;</span><span class="bash"> 192.168.3.231:6443           Masq    1      0          0</span>         <br><span class="hljs-meta">  -&gt;</span><span class="bash"> 192.168.3.232:6443           Masq    1      0          0</span>         <br><span class="hljs-meta">  -&gt;</span><span class="bash"> 192.168.3.233:6443           Masq    1      0          0</span>        <br></code></pre></td></tr></table></figure><blockquote><p>ğŸš© <strong>ç”±ä¸Šé¢å¯ä»¥çœ‹å‡º</strong>ï¼šæ‰€æœ‰é€šè¿‡ https è®¿é—® K8S SVC kubernetes çš„è¯·æ±‚éƒ½è½¬å‘åˆ° kube-apiserver èŠ‚ç‚¹çš„ 6443 ç«¯å£ï¼›</p></blockquote><h3 id="7ã€éƒ¨ç½²-calico-ç½‘ç»œæ–¹æ¡ˆ"><a href="#7ã€éƒ¨ç½²-calico-ç½‘ç»œæ–¹æ¡ˆ" class="headerlink" title="7ã€éƒ¨ç½² calico ç½‘ç»œæ–¹æ¡ˆ"></a>7ã€éƒ¨ç½² calico ç½‘ç»œæ–¹æ¡ˆ</h3><p><strong>åŸºç¡€ç»„ä»¶ä»‹ç» â€”â€” ç½‘ç»œç»„ä»¶:</strong> <a href="https://tareya.github.io/2021/10/21/Kubernetes-%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6/">ä¼ é€é—¨</a></p><h4 id="1ï¼‰ä¸‹è½½å’Œåˆ†å‘-calico-å’Œ-cni-æ’ä»¶"><a href="#1ï¼‰ä¸‹è½½å’Œåˆ†å‘-calico-å’Œ-cni-æ’ä»¶" class="headerlink" title="1ï¼‰ä¸‹è½½å’Œåˆ†å‘ calico å’Œ cni æ’ä»¶"></a>1ï¼‰ä¸‹è½½å’Œåˆ†å‘ calico å’Œ cni æ’ä»¶</h4><h5 id="1-æ‰¹é‡åˆ›å»º-calico-å’Œ-cni-ç»„ä»¶ç›¸å…³ç›®å½•"><a href="#1-æ‰¹é‡åˆ›å»º-calico-å’Œ-cni-ç»„ä»¶ç›¸å…³ç›®å½•" class="headerlink" title="1. æ‰¹é‡åˆ›å»º calico å’Œ cni ç»„ä»¶ç›¸å…³ç›®å½•"></a>1. æ‰¹é‡åˆ›å»º calico å’Œ cni ç»„ä»¶ç›¸å…³ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m shell -a &quot;mkdir -p /etc/calico/&#123;conf,yaml&#125; /opt/cni/bin/ /etc/cni/net.d&quot;<br></code></pre></td></tr></table></figure><h5 id="2-ä¸‹è½½-calico-äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#2-ä¸‹è½½-calico-äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="2. ä¸‹è½½ calico äºŒè¿›åˆ¶æ–‡ä»¶"></a>2. ä¸‹è½½ calico äºŒè¿›åˆ¶æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p ~/kubernetes/network/bin&amp;&amp; \<br>wget -c https://github.com/projectcalico/calicoctl/releases/download/v3.19.2/calicoctl-linux-amd64 -O ~/kubernetes/network/bin/calicoctl &amp;&amp; \<br>chmod +x ~/kubernetes/network/bin/calicoctl <br></code></pre></td></tr></table></figure><h6 id="éªŒè¯ç‰ˆæœ¬"><a href="#éªŒè¯ç‰ˆæœ¬" class="headerlink" title="éªŒè¯ç‰ˆæœ¬:"></a>éªŒè¯ç‰ˆæœ¬:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">~/kubernetes/network/bin/calicoctl version<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Client Version:    v3.19.2<br>Git commit:        6f3d4900<br>invalid configuration: no configuration has been provided, try setting KUBERNETES_MASTER environment variable<br></code></pre></td></tr></table></figure><blockquote><p>ç”±äºå°šæœªè¿›è¡Œé…ç½®ï¼Œæ•…æ— æ³•è·å–å…·ä½“çš„é…ç½®ä¿¡æ¯ã€‚</p></blockquote><h6 id="åˆ†å‘äºŒè¿›åˆ¶åŒ…è‡³å„-master-èŠ‚ç‚¹"><a href="#åˆ†å‘äºŒè¿›åˆ¶åŒ…è‡³å„-master-èŠ‚ç‚¹" class="headerlink" title="åˆ†å‘äºŒè¿›åˆ¶åŒ…è‡³å„ master èŠ‚ç‚¹:"></a>åˆ†å‘äºŒè¿›åˆ¶åŒ…è‡³å„ master èŠ‚ç‚¹:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m copy -a &quot;src=~/kubernetes/network/bin/calicoctl dest=/usr/local/bin/calicoctl owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h5 id="3-ä¸‹è½½-cni-ç»„ä»¶"><a href="#3-ä¸‹è½½-cni-ç»„ä»¶" class="headerlink" title="3. ä¸‹è½½ cni ç»„ä»¶"></a>3. ä¸‹è½½ cni ç»„ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä¸‹è½½è§£ cni ç½‘ç»œæ’ä»¶</span><br>wget -c https://github.com/containernetworking/plugins/releases/download/v0.8.6/cni-plugins-linux-amd64-v1.0.1.tgz -O ~/kubernetes/network/bin/cni-plugins-linux-amd64-v1.0.1.tgz <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ä¸‹è½½ calico cni ç»„ä»¶</span><br>wget -c https://github.com/projectcalico/cni-plugin/releases/download/v3.19.2/calico-amd64 -O ~/kubernetes/network/bin/calico &amp;&amp; \<br>wget -c  https://github.com/projectcalico/cni-plugin/releases/download/v3.19.2/calico-ipam-amd64 -O ~/kubernetes/network/bin/calico-ipam<br></code></pre></td></tr></table></figure><h6 id="åˆ†å‘äºŒè¿›åˆ¶åŒ…è‡³å„-master-èŠ‚ç‚¹-1"><a href="#åˆ†å‘äºŒè¿›åˆ¶åŒ…è‡³å„-master-èŠ‚ç‚¹-1" class="headerlink" title="åˆ†å‘äºŒè¿›åˆ¶åŒ…è‡³å„ master èŠ‚ç‚¹:"></a>åˆ†å‘äºŒè¿›åˆ¶åŒ…è‡³å„ master èŠ‚ç‚¹:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è§£å‹ cni æ’ä»¶å‹ç¼©åŒ…åˆ°å„èŠ‚ç‚¹ cni é»˜è®¤ç›®å½•</span><br>ansible k8s-node -S -R root -m unarchive -a &quot;src=~/kubernetes/network/bin/cni-plugins-linux-amd64-v1.0.1.tgz dest=/opt/cni/bin/ mode=0755 copy=yes&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ†å‘ calico cni ç»„ä»¶</span><br>ansible k8s-node -S -R root -m copy -a &quot;src=~/kubernetes/network/bin/calico dest=/opt/cni/bin/calico owner=root group=root mode=0755&quot;<br>ansible k8s-node -S -R root -m copy -a &quot;src=~/kubernetes/network/bin/calico-ipam dest=/opt/cni/bin/calico-ipam owner=root group=root mode=0755&quot;<br></code></pre></td></tr></table></figure><h5 id="4-é•œåƒå‡†å¤‡"><a href="#4-é•œåƒå‡†å¤‡" class="headerlink" title="4. é•œåƒå‡†å¤‡"></a>4. é•œåƒå‡†å¤‡</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æå‰ä¸‹è½½å¦‚ä¸‹é•œåƒ</span><br>ansible k8s-node -S -R root -m shell -a &quot;docker pull calico/node:v3.19.2&quot;<br>ansible k8s-node -S -R root -m shell -a &quot;docker pull calico/cni:v3.19.2&quot;<br>ansible k8s-node -S -R root -m shell -a &quot;docker pull calico/kube-controllers:v3.19.2&quot;<br>ansible k8s-node -S -R root -m shell -a &quot;docker pull calico/pod2daemon-flexvol:v3.19.2&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ä¸Šä¼ è‡³ç§ä»“ï¼ˆå¯é€‰ï¼‰</span><br></code></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="2ï¼‰åˆ›å»º-calico-é…ç½®æ–‡ä»¶"><a href="#2ï¼‰åˆ›å»º-calico-é…ç½®æ–‡ä»¶" class="headerlink" title="2ï¼‰åˆ›å»º calico é…ç½®æ–‡ä»¶"></a>2ï¼‰åˆ›å»º calico é…ç½®æ–‡ä»¶</h4><h5 id="1-è·å–-calico-manifest"><a href="#1-è·å–-calico-manifest" class="headerlink" title="1. è·å– calico manifest"></a>1. è·å– calico manifest</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget -c --no-check-certificate https://docs.projectcalico.org/archive/v3.19/manifests/calico.yaml -O ~/kubernetes/network/cfg/calico.yaml<br></code></pre></td></tr></table></figure><h5 id="2-ä¿®æ”¹é•œåƒç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰"><a href="#2-ä¿®æ”¹é•œåƒç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="2. ä¿®æ”¹é•œåƒç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰"></a>2. ä¿®æ”¹é•œåƒç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰</h5><blockquote><p>ğŸš© <strong>å…³äºé•œåƒç‰ˆæœ¬</strong></p><p>ç”±äºå®˜æ–¹æä¾›çš„ yaml æ–‡ä»¶æ˜¯å®æ—¶æ›´æ–°çš„ï¼Œå…¶å®¹å™¨çš„ç‰ˆæœ¬ä¹Ÿä¼šéšä¹‹æ›´æ–°ã€‚æ•…ï¼Œå¦‚æœè¦ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ calico çš„è¯ï¼Œå°±éœ€è¦è‡ªè¡Œæ›¿æ¢é•œåƒç‰ˆæœ¬ï¼Œå¦‚æœ¬æ–‡ä½¿ç”¨ v3.19.2ï¼Œè€Œå®˜æ–¹é»˜è®¤æä¾›çš„å¯èƒ½å·²ç»æ˜¯ v3.19.3 äº†ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è·å–å®˜æ–¹é»˜è®¤æä¾›çš„é•œåƒç‰ˆæœ¬</span><br>DEFAULT_VERSION=$(awk -F &quot;:&quot; &#x27;/image:/&#123;print $NF&#125;&#x27; ~/kubernetes/network/cfg/calico.yaml|head -1)<br><span class="hljs-meta">#</span><span class="bash"> æ›¿æ¢ä¸ºæŒ‡å®šç‰ˆæœ¬</span><br>sed -i &quot;s/$DEFAULT_VERSION/v3.19.2/g&quot; ~/kubernetes/network/cfg/calico.yaml<br></code></pre></td></tr></table></figure><h5 id="3-å…³é—­-IPIP-æ¨¡å¼ï¼ˆå¯é€‰ï¼‰"><a href="#3-å…³é—­-IPIP-æ¨¡å¼ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="3. å…³é—­ IPIP æ¨¡å¼ï¼ˆå¯é€‰ï¼‰"></a>3. å…³é—­ IPIP æ¨¡å¼ï¼ˆå¯é€‰ï¼‰</h5><blockquote><p>ğŸš© <strong>å…³äº CALICO_IPV4POOL_IPIP å‚æ•°</strong></p><p>calico ç½‘ç»œé»˜è®¤ä½¿ç”¨ IPIP æ¨¡å¼ï¼Œå®ƒä¼šåœ¨æ¯ä¸ª node èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ª <code>tunl0</code> ç½‘å£ï¼Œé€šè¿‡éš§é“è·¯ç”±çš„æ–¹å¼å°†æ‰€æœ‰çš„nodeèŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æ˜¯ä¸åŒç½‘æ®µçš„èŠ‚ç‚¹é€šè¿‡è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥çº³å…¥ç»Ÿä¸€ä¸ª k8s é›†ç¾¤ï¼Œæ‰€ä»¥å®˜æ–¹æ¨èè¿™ç§æƒ…å†µæ—¶ï¼Œä½¿ç”¨è¯¥æ¨¡å¼ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æœ¬æ–‡æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨åŒä¸€ç½‘æ®µå†…ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…³é—­ IPIP æ¨¡å¼ã€‚</p><p><code>CALICO_IPV4POOL_IPIP</code> æä¾›ä»¥ä¸‹ä¸‰ç§ value:</p><ul><li><code>Always</code>: å¼€å¯ IPIP æ¨¡å¼(é»˜è®¤)</li><li><code>CrossSubnet</code>: åªåœ¨è·¨ç½‘æ®µæ—¶æ‰å¼€å¯ IPIP æ¨¡å¼ï¼Œé€‚åˆæœ‰ Kubernetes èŠ‚ç‚¹åœ¨å…¶ä»–ç½‘æ®µçš„æƒ…å†µï¼Œå±äºä¸­è‚¯å‹å¥½æ–¹æ¡ˆ</li><li><code>Never</code>: å…³é—­ IPIP æ¨¡å¼ï¼Œé€‚åˆç¡®è®¤æ‰€æœ‰ Kubernetes èŠ‚ç‚¹éƒ½åœ¨åŒä¸€ä¸ªç½‘æ®µä¸‹çš„æƒ…å†µ</li></ul></blockquote><p>åœ¨ DaemonSet éƒ¨åˆ† <code>calico-node</code>çš„ <code>pod</code> çš„å˜é‡ä¸­ï¼Œä¿®æ”¹ <code>CALICO_IPV4POOL_IPIP</code> å€¼ä¸º <code>Never</code>ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Enable IPIP</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_IPV4POOL_IPIP</span><br><span class="hljs-attr">value:</span> <span class="hljs-string">&quot;Never&quot;</span><br></code></pre></td></tr></table></figure><h5 id="4-ä¿®æ”¹-pod-çš„ç½‘æ®µ"><a href="#4-ä¿®æ”¹-pod-çš„ç½‘æ®µ" class="headerlink" title="4. ä¿®æ”¹ pod çš„ç½‘æ®µ"></a>4. ä¿®æ”¹ pod çš„ç½‘æ®µ</h5><blockquote><p>ğŸš© <strong>å…³äº CALICO_IPV4POOL_CIDR å‚æ•°</strong></p><p>calico é»˜è®¤ä½¿ç”¨çš„ k8s é›†ç¾¤çš„ pod ç½‘æ®µä¸º <code>192.168.0.0/16</code> ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„ CIDR ä¸åŒäºè¿™ä¸ªæ®µï¼Œæ‰€ä»¥è¦è‡ªè¡Œä¿®æ”¹ï¼Œæ³¨æ„ä¿æŒå’Œ kube-controller-manager ä¸­çš„ <code>--cluster-cidr</code> ä¿æŒä¸€è‡´ã€‚</p></blockquote><p>åœ¨ DaemonSet éƒ¨åˆ† <code>calico-node</code>çš„ <code>pod</code> çš„å˜é‡ä¸­ï¼Œå¼€å¯ <code>CALICO_IPV4POOL_CIDR</code> ï¼Œä¿®æ”¹æˆé›†ç¾¤ä½¿ç”¨çš„ CIDR ç½‘æ®µã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># The default IPv4 pool to create on startup if none exists. Pod IPs will be</span><br><span class="hljs-comment"># chosen from this range. Changing this value after installation will have</span><br><span class="hljs-comment"># no effect. This should fall within `--cluster-cidr`.</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_IPV4POOL_CIDR</span><br>  <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;10.244.0.0/16&quot;</span><br></code></pre></td></tr></table></figure><h5 id="5-ä¿®æ”¹-apiserver-çš„ä¿¡æ¯"><a href="#5-ä¿®æ”¹-apiserver-çš„ä¿¡æ¯" class="headerlink" title="5. ä¿®æ”¹ apiserver çš„ä¿¡æ¯"></a>5. ä¿®æ”¹ apiserver çš„ä¿¡æ¯</h5><blockquote><p>ğŸš© <strong>å…³äº calico è®¿é—® apiserver</strong></p><p>å¦‚æœæœªé…ç½® apiserver ä¿¡æ¯ã€‚calicoé»˜è®¤å°†è®¾ç½®é»˜è®¤çš„ calico ç½‘æ®µï¼ˆCIDRï¼‰ å’Œ 443ç«¯å£ï¼Œå¦‚ 10.0.0.1:443ã€‚ä¼šå¯¼è‡´ node èŠ‚ç‚¹æ— æ³•è¿æ¥ apiserverï¼ŒæŠ¥é”™ç±»ä¼¼ä»¥ä¸‹æƒ…å†µ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[ERROR][9] startup/startup.go 159: failed to query kubeadm&#x27;s config map error=Get &quot;https://10.0.0.1:443/api/v1/namespaces/kube-system/configmaps/kubeadm-config?timeout=2s&quot;: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)<br></code></pre></td></tr></table></figure><p>ä»¥åŠï¼ˆcalico-kube-controllersï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Failed to create pod sandbox: rpc error: code = Unknown desc = failed to set up sandbox container &quot;2c9d1a481b2ab8328466ba5f7b236bdc822957371579812fa8e7ce3e464dce04&quot; network for pod &quot;calico-kube-controllers-86497987b6-j2fch&quot;: networkPlugin cni failed to set up pod &quot;calico-kube-controllers-86497987b6-j2fch_kube-system&quot; network: error getting ClusterInformation: Get &quot;https://[10.0.0.1]:443/apis/crd.projectcalico.org/v1/clusterinformations/default&quot;: dial tcp 10.0.0.1:443: i/o timeout<br></code></pre></td></tr></table></figure><p>apiserver é…ç½®å­—æ®µä¸ºï¼š<code>KUBERNETES_SERVICE_HOST</code>ã€<code>KUBERNETES_SERVICE_PORT</code>ã€<code>KUBERNETES_SERVICE_PORT_HTTPS</code>ã€‚</p><p>åˆ†åˆ«åœ¨ DaemonSet éƒ¨åˆ† <code>calico-node</code> çš„ <code>upgrade-ipam</code>, <code>install-cni</code>, <code>calico-node</code> å’Œ Deployment éƒ¨åˆ† <code>calico-kube-controllers</code> çš„ <code>env</code> å˜é‡ä¸­æ·»åŠ  apiserver ä¿¡æ¯ã€‚</p></blockquote><p>åœ¨ DaemonSet éƒ¨åˆ† <code>calico-node</code> çš„  <code>env</code> å˜é‡å’Œ Deployment éƒ¨åˆ† <code>calico-kube-controllers</code> çš„ <code>env</code> å˜é‡ä¸­å¢åŠ  apiserver çš„ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> The kubernetes apiserver info</span><br>- name: KUBERNETES_SERVICE_HOST<br>  value: &quot;192.168.3.231&quot;<br>- name: KUBERNETES_SERVICE_PORT<br>  value: &quot;6443&quot;<br>- name: KUBERNETES_SERVICE_PORT_HTTPS<br>  value: &quot;6443&quot;<br></code></pre></td></tr></table></figure><h5 id="6-ä¿®æ”¹-typha-service-nameï¼ˆé›†ç¾¤èŠ‚ç‚¹æ•°è¶…è¿‡50ä»¥ä¸Šå¯é€‰ï¼‰"><a href="#6-ä¿®æ”¹-typha-service-nameï¼ˆé›†ç¾¤èŠ‚ç‚¹æ•°è¶…è¿‡50ä»¥ä¸Šå¯é€‰ï¼‰" class="headerlink" title="6. ä¿®æ”¹ typha_service_nameï¼ˆé›†ç¾¤èŠ‚ç‚¹æ•°è¶…è¿‡50ä»¥ä¸Šå¯é€‰ï¼‰"></a>6. ä¿®æ”¹ typha_service_nameï¼ˆé›†ç¾¤èŠ‚ç‚¹æ•°è¶…è¿‡50ä»¥ä¸Šå¯é€‰ï¼‰</h5><blockquote><p>ğŸš© <strong>å…³äº calico-typha</strong></p><p>å®˜æ–¹æ¨èå½“k8sæ•°æ®å­˜å‚¨æ¨¡å¼è¶…è¿‡50å„èŠ‚ç‚¹æ—¶å¯ç”¨typhaæ¨¡å¼ï¼ŒTypha ç»„ä»¶å¯ä»¥å¸®åŠ© Calico æ‰©å±•åˆ°å¤§é‡çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸ä¼šå¯¹ Kubernetes API æœåŠ¡å™¨é€ æˆè¿‡åº¦å½±å“ã€‚</p><p>å®˜æ–¹æä¾›çš„ manifest åœ°å€: <a href="https://docs.projectcalico.org/archive/v3.19/manifests/calico-typha.yaml">https://docs.projectcalico.org/archive/v3.19/manifests/calico-typha.yaml</a></p></blockquote><p>åœ¨ ConfigMap éƒ¨åˆ†çš„ <code>data</code>å˜é‡ä¸­ï¼Œä¿®æ”¹ <code>typha_service_name</code> ä¸º <code>calico-typha</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-config</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-comment"># Typha is disabled.</span><br>  <span class="hljs-attr">typha_service_name:</span> <span class="hljs-string">&quot;calico-typha&quot;</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰åˆ›å»º-calico-ç½‘ç»œ"><a href="#3ï¼‰åˆ›å»º-calico-ç½‘ç»œ" class="headerlink" title="3ï¼‰åˆ›å»º calico ç½‘ç»œ"></a>3ï¼‰åˆ›å»º calico ç½‘ç»œ</h4><blockquote><p>ğŸš© åˆ›å»ºå‰å…ˆæ¸…ç©º /etc/cni/net.d ç›®å½•ä¸‹çš„ cni ç½‘ç»œé…ç½®ï¼Œå¦‚ <code>10-flannel.conflist</code> ã€<code>10-calico.conflist</code>ã€<code>calico-kubeconfig</code> ã€<code>calico-tls</code> ç­‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ansible k8s-node -S -R root -m shell -a &quot;\rm -r /etc/cni/net.d/*&quot;<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl apply -f ~/kubernetes/network/cfg/calico.yaml<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell">configmap/calico-config created<br>customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/kubecontrollersconfigurations.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created<br>customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created<br>clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created<br>clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created<br>clusterrole.rbac.authorization.k8s.io/calico-node created<br>clusterrolebinding.rbac.authorization.k8s.io/calico-node created<br>daemonset.apps/calico-node created<br>serviceaccount/calico-node created<br>deployment.apps/calico-kube-controllers created<br>serviceaccount/calico-kube-controllers created<br>poddisruptionbudget.policy/calico-kube-controllers created<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰é›†ç¾¤çŠ¶æ€éªŒè¯"><a href="#4ï¼‰é›†ç¾¤çŠ¶æ€éªŒè¯" class="headerlink" title="4ï¼‰é›†ç¾¤çŠ¶æ€éªŒè¯"></a>4ï¼‰é›†ç¾¤çŠ¶æ€éªŒè¯</h4><h5 id="1-æŸ¥çœ‹-pod-çŠ¶æ€"><a href="#1-æŸ¥çœ‹-pod-çŠ¶æ€" class="headerlink" title="1. æŸ¥çœ‹ pod çŠ¶æ€"></a>1. æŸ¥çœ‹ pod çŠ¶æ€</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pods -n kube-system<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME                                       READY   STATUS    RESTARTS   AGE<br>calico-kube-controllers-5cdd469496-sqqdh   1/1     Running   0          4h<br>calico-node-927gm                          1/1     Running   0          4h<br>calico-node-j5886                          1/1     Running   0          4h<br>calico-node-pbgcb                          1/1     Running   0          4h<br>calico-node-zn4g8                          1/1     Running   0          4h<br></code></pre></td></tr></table></figure><h5 id="2-æŸ¥çœ‹-node-çŠ¶æ€"><a href="#2-æŸ¥çœ‹-node-çŠ¶æ€" class="headerlink" title="2. æŸ¥çœ‹ node çŠ¶æ€"></a>2. æŸ¥çœ‹ node çŠ¶æ€</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get nodes -n kube-system<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME           STATUS   ROLES    AGE   VERSION<br>k8s-master01   Ready    &lt;none&gt;   5h   v1.18.18<br>k8s-master02   Ready    &lt;none&gt;   5h   v1.18.18<br>k8s-master03   Ready    &lt;none&gt;   5h   v1.18.18<br>k8s-node01     Ready    &lt;none&gt;   5h   v1.18.18<br></code></pre></td></tr></table></figure><h5 id="3-æŸ¥çœ‹è·¯ç”±ï¼ˆBGP-æ¨¡å¼ï¼‰"><a href="#3-æŸ¥çœ‹è·¯ç”±ï¼ˆBGP-æ¨¡å¼ï¼‰" class="headerlink" title="3. æŸ¥çœ‹è·¯ç”±ï¼ˆBGP æ¨¡å¼ï¼‰"></a>3. æŸ¥çœ‹è·¯ç”±ï¼ˆBGP æ¨¡å¼ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ip route<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">default via 192.168.3.1 dev eth0 proto static metric 100 <br>10.244.32.128 dev calie5ddea5eea8 scope link <br>blackhole 10.244.32.128/26 proto bird <br>10.244.122.128/26 via 192.168.3.232 dev eth0 proto bird <br>172.17.0.0/16 dev docker0 proto kernel scope link src 172.17.0.1 <br>192.168.3.0/24 dev eth0 proto kernel scope link src 192.168.3.231 metric 100 <br></code></pre></td></tr></table></figure><p>ç›¸å…³è·¯ç”±è¯´æ˜:</p><blockquote><ul><li><p><code>10.244.32.128 dev calie5ddea5eea8 scope link</code> : è¯¥è·¯ç”±ä¼šå°†é€šå‘å®¹å™¨IPçš„è¯·æ±‚å¯¼å‘ veth <code>calie5ddea5eea8</code>ï¼Œè¿›è€Œè®©è¯·æ±‚ç›´è¾¾å®¹å™¨å†…çš„ç½‘å¡ã€‚</p></li><li><p><code>blackhole 10.244.32.128/26 proto bird </code>: è¯¥è·¯ç”±è¡¨ç¤ºå‘å¾€ <code>10.244.32.128/26</code> ç½‘æ®µçš„æŠ¥æ–‡éƒ½ä¼šè¢«ä¸¢å¼ƒä¸”ä¸ä¼šå›å¤æºåœ°å€ï¼Œæ‰€ä»¥æ˜¯ <code>blackhole</code>ã€‚é…ç½®è¿™æ¡è·¯ç”±ä»¥é¿å…æŠ¥æ–‡è¢«å‘é€åˆ°éè¯¥ç½‘æ®µçš„å¤–éƒ¨åœ°å€ã€‚</p></li><li><p><code>10.244.122.128/26 via 192.168.3.232 dev eth0 proto bird</code>: è¦è®¿é—® calico ç½‘ç»œä¸­çš„æŸä¸ªç½‘æ®µï¼Œéœ€è¦ä»¥ node IPä½œä¸ºç½‘å…³ï¼Œé€šè¿‡ eth0 å‘åŒ…ã€‚</p></li></ul></blockquote><h3 id="7ã€éƒ¨ç½²å¿…è¦-Kubernetesé›†ç¾¤æ’ä»¶"><a href="#7ã€éƒ¨ç½²å¿…è¦-Kubernetesé›†ç¾¤æ’ä»¶" class="headerlink" title="7ã€éƒ¨ç½²å¿…è¦ Kubernetesé›†ç¾¤æ’ä»¶"></a>7ã€éƒ¨ç½²å¿…è¦ Kubernetesé›†ç¾¤æ’ä»¶</h3><blockquote><p>ğŸŒˆ æ’ä»¶æ˜¯Kubernetesé›†ç¾¤çš„é™„ä»¶ç»„ä»¶ï¼Œä¸°å¯Œå’Œå®Œå–„äº†é›†ç¾¤çš„åŠŸèƒ½ï¼Œè¿™é‡Œåˆ†åˆ«ä»‹ç»çš„æ’ä»¶æœ‰corednsã€Dashboardã€Metrics Serverï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼škuberntes è‡ªå¸¦æ’ä»¶çš„ manifests yaml æ–‡ä»¶ä½¿ç”¨ gcr.io çš„ docker registryï¼Œå›½å†…è¢«å¢™ï¼Œéœ€è¦æ‰‹åŠ¨æ›¿æ¢ä¸ºå…¶å®ƒ registry åœ°å€æˆ–æå‰åœ¨FQæœåŠ¡å™¨ä¸Šä¸‹è½½ï¼Œç„¶åå†åŒæ­¥åˆ°å¯¹åº”çš„k8séƒ¨ç½²æœºå™¨ä¸Šã€‚</p></blockquote><h4 id="1ï¼‰éƒ¨ç½²-CoreDNS"><a href="#1ï¼‰éƒ¨ç½²-CoreDNS" class="headerlink" title="1ï¼‰éƒ¨ç½² CoreDNS"></a>1ï¼‰éƒ¨ç½² CoreDNS</h4><p><strong>æ’ä»¶ä»‹ç» â€”â€” CoreDNS:</strong> <a href="https://tareya.github.io/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-CoreDNS/">ä¼ é€é—¨</a></p><h5 id="1-è·å–-CoreDNS-manifest"><a href="#1-è·å–-CoreDNS-manifest" class="headerlink" title="1. è·å– CoreDNS manifest"></a>1. è·å– CoreDNS manifest</h5><blockquote><p>ğŸš© æˆ‘ä»¬ä¹‹å‰åœ¨éƒ¨ç½² k8s server ç«¯çš„æ—¶å€™ï¼Œå·²ç»è§£å‹äº† <code>kubernetes-server-linux-amd64.tar.gz</code> ï¼Œå…¶ä¸­ä¼šæœ‰ <code>kubernetes-src.tar.gz</code>ï¼Œå…¶ä¸­åŒ…å«çš„æ˜¯ k8s çš„æºç ã€‚è§£å‹åï¼Œcoredns çš„ç›®å½•æ˜¯ <code>cluster/addons/dns</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~/kubernetes &amp;&amp; \<br>mkdir -p src addons &amp;&amp; \<br>tar xf kubernetes-src.tar.gz -C src &amp;&amp; \<br>cp -a src/cluster/addons/dns/coredns/coredns.yaml.base addons/coredns.yaml<br></code></pre></td></tr></table></figure><h5 id="2-ä¿®æ”¹-CoreDNS-manifest"><a href="#2-ä¿®æ”¹-CoreDNS-manifest" class="headerlink" title="2. ä¿®æ”¹ CoreDNS manifest"></a>2. ä¿®æ”¹ CoreDNS manifest</h5><p>æ–‡ä»¶è·¯å¾„ <code>~/kubernetes/addons/coredns.yaml</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sed -i -e &quot;s/__PILLAR__DNS__DOMAIN__/cluster.local/&quot; -e &quot;s/__PILLAR__DNS__SERVER__/10.0.0.2/&quot; -e &quot;s/__PILLAR__DNS__MEMORY__LIMIT__/170Mi/&quot; -e &quot;s/k8s.gcr.io/coredns/&quot; ~/kubernetes/addons/coredns.yaml<br></code></pre></td></tr></table></figure><h6 id="å‚æ•°è¯´æ˜-2"><a href="#å‚æ•°è¯´æ˜-2" class="headerlink" title="å‚æ•°è¯´æ˜:"></a>å‚æ•°è¯´æ˜:</h6><blockquote><ul><li><code>__PILLAR__DNS__DOMAIN__</code>: é›†ç¾¤ DNS åŸŸåï¼Œè¿™é‡Œæ›¿æ¢æˆ cluster.localï¼Œå³æ²¿ç”¨æœ¬åœ°è§£æ</li><li><code>__PILLAR__DNS__SERVER__</code>ï¼šé›†ç¾¤ DNS æœåŠ¡ IPï¼Œä» SERVICE_CIDR ä¸­é¢„åˆ†é…ä¸€ä¸ª IP å³å¯ï¼ˆæ³¨æ„ä¸è¦ç”¨ CIDR ç¬¬ä¸€ä¸ª IPï¼‰</li><li><code>__PILLAR__DNS__MEMORY__LIMIT__</code>: CoreDNS æœåŠ¡å†…å­˜æœ€å¤§é™åˆ¶ï¼Œ<code>requests</code> ä¸º 70Miï¼Œlimit å¤šç»™ 100Mi å³å¯</li><li><code>k8s.gcr.io</code>: k8s é»˜è®¤çš„é•œåƒåœ°å€å›½å†…è¢«å¢™çš„ï¼Œä½†æ˜¯åœ¨ docker hub ä¸Šæœ‰å®˜æ–¹æä¾›çš„é•œåƒåœ°å€ï¼Œæ•…å¯ä»¥ä½¿ç”¨ docke hub åœ°å€</li></ul></blockquote><h5 id="3-åˆ›å»º-CoreDNS"><a href="#3-åˆ›å»º-CoreDNS" class="headerlink" title="3. åˆ›å»º CoreDNS"></a>3. åˆ›å»º CoreDNS</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl apply -f ~/kubernetes/addons/coredns.yaml <br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">serviceaccount/coredns created<br>clusterrole.rbac.authorization.k8s.io/system:coredns created<br>clusterrolebinding.rbac.authorization.k8s.io/system:coredns created<br>configmap/coredns created<br>deployment.apps/coredns created<br>service/kube-dns created<br></code></pre></td></tr></table></figure><h5 id="4-éªŒè¯-CoreDNS-çŠ¶æ€"><a href="#4-éªŒè¯-CoreDNS-çŠ¶æ€" class="headerlink" title="4. éªŒè¯ CoreDNS çŠ¶æ€"></a>4. éªŒè¯ CoreDNS çŠ¶æ€</h5><p>æ£€æŸ¥ coredns åŠŸèƒ½ (æ‰§è¡Œä¸‹é¢å‘½ä»¤åï¼Œç¨å¾®ç­‰ä¸€ä¼šå„¿ï¼Œç¡®ä¿ READY çŠ¶æ€éƒ½æ˜¯å¯ç”¨çš„)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pod -n kube-system -o wide|grep coredns<br></code></pre></td></tr></table></figure><p>è¿”å›ç»“æœå¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">coredns-55f9545c85-dbf67                   1/1     Running   0          44s   10.244.32.128    k8s-master01   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹åˆ›å»ºçš„corednsçš„podçŠ¶æ€,ç¡®ä¿æ²¡æœ‰æŠ¥é”™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl describe pod -n kube-system coredns-55f9545c85-dbf67<br></code></pre></td></tr></table></figure><p>æ­£ç¡®è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">......<br>......<br>Events:<br>  Type    Reason     Age   From               Message<br>  ----    ------     ----  ----               -------<br>  Normal  Scheduled  2m    default-scheduler  Successfully assigned kube-system/coredns-55f9545c85-dbf67 to k8s-master01<br>  Normal  Pulling    119s  kubelet            Pulling image &quot;coredns/coredns:1.6.5&quot;<br>  Normal  Pulled     92s   kubelet            Successfully pulled image &quot;coredns/coredns:1.6.5&quot;<br>  Normal  Created    92s   kubelet            Created container coredns<br>  Normal  Started    92s   kubelet            Started container coredns<br></code></pre></td></tr></table></figure><h5 id="5-éªŒè¯-CoreDNS-åŠŸèƒ½"><a href="#5-éªŒè¯-CoreDNS-åŠŸèƒ½" class="headerlink" title="5. éªŒè¯ CoreDNS åŠŸèƒ½"></a>5. éªŒè¯ CoreDNS åŠŸèƒ½</h5><h6 id="1âƒ£ï¸-åˆ›å»º-nginx-demo-çš„-Deployment-manifest"><a href="#1âƒ£ï¸-åˆ›å»º-nginx-demo-çš„-Deployment-manifest" class="headerlink" title="1âƒ£ï¸ åˆ›å»º nginx-demo çš„ Deployment  manifest"></a>1âƒ£ï¸ åˆ›å»º nginx-demo çš„ Deployment  manifest</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/kubernetes/yaml/nginx-demo.yaml &lt;&lt;EOF<br>apiVersion: v1<br>kind: Deployment<br>metadata:<br>  name: nginx-demo<br>spec:<br>  replicas: 2<br>  selector:<br>    matchLabels:<br>      app: nginx-demo<br>  template:<br>    metadata:<br>      labels:<br>        app: nginx-demo<br>    spec:<br>      containers:<br>      - name: nginx-demo<br>        image: nginx:stable<br>        ports:<br>        - containerPort: 80<br>EOF<br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-åˆ›å»ºèµ„æº"><a href="#2âƒ£ï¸-åˆ›å»ºèµ„æº" class="headerlink" title="2âƒ£ï¸ åˆ›å»ºèµ„æº"></a>2âƒ£ï¸ åˆ›å»ºèµ„æº</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl apply -f ~/kubernetes/yaml/nginx-demo.yaml<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">deployment.apps/nginx-demo created<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ pod çŠ¶æ€:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pod <br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME                          READY   STATUS    RESTARTS   AGE<br>nginx-demo-7fc57f6f87-8sgxm   1/1     Running   0          78s<br>nginx-demo-7fc57f6f87-tzfzh   1/1     Running   0          78s<br></code></pre></td></tr></table></figure><h6 id="3âƒ£ï¸-æš´éœ²-nginx-demo"><a href="#3âƒ£ï¸-æš´éœ²-nginx-demo" class="headerlink" title="3âƒ£ï¸ æš´éœ² nginx-demo"></a>3âƒ£ï¸ æš´éœ² nginx-demo</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl expose deployment nginx-demo<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">service/nginx-demo exposed<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ service çŠ¶æ€:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get svc<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME         TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE<br>kubernetes   ClusterIP   10.0.0.1      &lt;none&gt;        443/TCP   2d18h<br>nginx-demo   ClusterIP   10.0.53.182   &lt;none&gt;        80/TCP    3s#<br></code></pre></td></tr></table></figure><h6 id="4âƒ£ï¸-éªŒè¯å†…éƒ¨è§£æåŠŸèƒ½"><a href="#4âƒ£ï¸-éªŒè¯å†…éƒ¨è§£æåŠŸèƒ½" class="headerlink" title="4âƒ£ï¸ éªŒè¯å†…éƒ¨è§£æåŠŸèƒ½"></a>4âƒ£ï¸ éªŒè¯å†…éƒ¨è§£æåŠŸèƒ½</h6><blockquote><p>ğŸš© æˆ‘ä»¬çŸ¥é“ k8s å†…éƒ¨é€šè®¯æ˜¯é€šè¿‡ service å‘ä¸‹æ‰¾å¯¹åº” pod çš„ï¼Œæ¯ä¸ª service çš„è§£æåŸç†å®é™…ä¸Šä¹Ÿæ˜¯éµå¾ª dns è§£æåŸç†çš„ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬èƒ½ä»å¦ä¸€ä¸ª pod ä¸­æ­£ç¡®è§£æ nginx-demo çš„ serviceï¼Œåˆ™èƒ½è¯æ˜ coredns å†…éƒ¨è§£æåŠŸèƒ½æ˜¯æ­£å¸¸çš„ã€‚</p></blockquote><p>å†åˆ›å»ºå¦ä¸€ä¸ª daemonset  <code>dnsutils-demo</code> ç”¨äºè§£ææµ‹è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt; ~/kubernetes/yaml/dnsutils-demo.yml &lt;&lt;EOF<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: dnsutils-demo<br>  labels:<br>    app: dnsutils-demo<br>spec:<br>  type: NodePort<br>  selector:<br>    app: dnsutils-demo<br>  ports:<br>  - name: http<br>    port: 80<br>    targetPort: 80<br>---<br>apiVersion: apps/v1<br>kind: DaemonSet<br>metadata:<br>  name: dnsutils-demo<br>  labels:<br>    addonmanager.kubernetes.io/mode: Reconcile<br>spec:<br>selector:<br>matchLabels:<br>      app: dnsutils-demo<br>  template:<br>    metadata:<br>      labels:<br>        app: dnsutils-demo<br>    spec:<br>      containers:<br>      - name: dnsutils-demo<br>        image: tutum/dnsutils:latest<br>        command:<br>          - sleep<br>          - &quot;3600&quot;<br>        ports:<br>        - containerPort: 80<br>EOF<br></code></pre></td></tr></table></figure><p>åˆ›å»ºèµ„æº:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl apply -f ~/kubernetes/yaml/dnsutils-demo.yml<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">service/dnsutils-demo unchanged<br>daemonset.apps/dnsutils-demo created<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ pod ä¿¡æ¯:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pod -o wide<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹, åœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ½ç”Ÿæˆäº† dnsutils-demo çš„ pod</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME                          READY   STATUS    RESTARTS   AGE    IP               NODE           NOMINATED NODE   READINESS GATES<br>dnsutils-demo-9nbzt           1/1     Running   0          3m8s   10.244.32.129    k8s-master01   &lt;none&gt;           &lt;none&gt;<br>dnsutils-demo-fqcnf           1/1     Running   0          3m8s   10.244.195.1     k8s-master03   &lt;none&gt;           &lt;none&gt;<br>dnsutils-demo-jgkll           1/1     Running   0          3m8s   10.244.85.193    k8s-node01     &lt;none&gt;           &lt;none&gt;<br>dnsutils-demo-n7j9r           1/1     Running   0          3m8s   10.244.122.130   k8s-master02   &lt;none&gt;           &lt;none&gt;<br>nginx-demo-7fc57f6f87-8sgxm   1/1     Running   0          145m   10.244.85.192    k8s-node01     &lt;none&gt;           &lt;none&gt;<br>nginx-demo-7fc57f6f87-tzfzh   1/1     Running   0          145m   10.244.195.0     k8s-master03   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ service ä¿¡æ¯:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get sv<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹ï¼Œå¤šäº† dnsutils-demo çš„ svc</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE<br>dnsutils-demo   NodePort    10.0.243.227   &lt;none&gt;        80:36461/TCP   4m21s<br>kubernetes      ClusterIP   10.0.0.1       &lt;none&gt;        443/TCP        2d20h<br>nginx-demo      ClusterIP   10.0.53.182    &lt;none&gt;        80/TCP         139m<br></code></pre></td></tr></table></figure><p>ä¾æ¬¡é€šè¿‡ dnsutils-demo çš„ pod ä¸­è§£æ nginx-demo çš„ svcï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥è§£æå¾—åˆ°å¯¹åº”çš„ clusterIP</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">for i in $(kubectl get pod|awk &#x27;/dnsutils/&#123;print $1&#125;&#x27;|xargs);do kubectl exec $i nslookup nginx-demo;done<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›ç»“æœå¦‚ä¸‹ï¼Œè¯æ˜å¯ä»¥é€šè¿‡ CoreDNS è§£æ service è·å–åˆ°æ­£ç¡®çš„ ClusterIPã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">Server:10.0.0.2<br>Address:10.0.0.2#53<br><br>Name:nginx-demo.default.svc.cluster.local<br>Address: 10.0.53.182<br><br>Server:10.0.0.2<br>Address:10.0.0.2#53<br><br>Name:nginx-demo.default.svc.cluster.local<br>Address: 10.0.53.182<br><br>Server:10.0.0.2<br>Address:10.0.0.2#53<br><br>Name:nginx-demo.default.svc.cluster.local<br>Address: 10.0.53.182<br><br>Server:10.0.0.2<br>Address:10.0.0.2#53<br><br>Name:nginx-demo.default.svc.cluster.local<br>Address: 10.0.53.182<br><br></code></pre></td></tr></table></figure><h6 id="5âƒ£ï¸-éªŒè¯å¤–éƒ¨è§£æåŠŸèƒ½"><a href="#5âƒ£ï¸-éªŒè¯å¤–éƒ¨è§£æåŠŸèƒ½" class="headerlink" title="5âƒ£ï¸ éªŒè¯å¤–éƒ¨è§£æåŠŸèƒ½"></a>5âƒ£ï¸ éªŒè¯å¤–éƒ¨è§£æåŠŸèƒ½</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl exec -it  nginx-demo-7fc57f6f87-8sgxm /bin/bash<br></code></pre></td></tr></table></figure><p>è¿›å…¥podåæŸ¥çœ‹ <code>/etc/resolv.conf</code>ã€‚ç¡®ä¿ pod å®¹å™¨ä¸­<code>/etc/resolv.conf</code> é‡Œçš„ nameserver åœ°å€ä¸º kubelet é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„ clusterDNS ä»¥åŠ clusterDomainã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@nginx-demo-7fc57f6f87-8sgxm:/# cat /etc/resolv.conf <br>nameserver 10.0.0.2<br>search default.svc.cluster.local svc.cluster.local cluster.local<br>options ndots:5<br></code></pre></td></tr></table></figure><blockquote><p>ğŸš© å®˜æ–¹æä¾›çš„ CoreDNS manifest ä¸­ DNS ç›¸å…³ configmap ä¸­ <code>forward . /etc/resolv.conf</code> çš„é…ç½®è¡¨ç¤º CoreDNS ä¼šç»§æ‰¿å®¿ä¸»æœºæœ¬åœ° <code>/etc/resolv.conf</code> ä¸­çš„ nameserverï¼Œå› æ­¤å¦‚æœ CoreDNS å¦‚æœåŠŸèƒ½æ­£å¸¸çš„è¯ï¼Œæˆ‘ä»¬åœ¨ pod å†…å³å¯è¿›è¡Œæ­£å¸¸çš„ dns è§£æå…¬ç½‘åŸŸåï¼Œå¦‚ <code>www.baidu.com</code> ç­‰ã€‚</p></blockquote><p>åœ¨ pod å†…å®‰è£… pingï¼Œnginx é»˜è®¤æä¾›çš„é•œåƒ OS ä¸º Debianï¼Œä½¿ç”¨ apt è¿›è¡ŒåŒ…ç®¡ç†ï¼Œè‡ªè¡Œå®‰è£… ping å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get update<br>apt-get install inetutils-ping<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œping baiduï¼ŒéªŒè¯è§£æ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ping -c4 www.baidu.com<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹ï¼Œè¯´æ˜å¤–éƒ¨ dns è§£æåŠŸèƒ½æ­£å¸¸:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">PING www.a.shifen.com (180.101.49.12): 56 data bytes<br>64 bytes from 180.101.49.12: icmp_seq=0 ttl=47 time=8.186 ms<br>64 bytes from 180.101.49.12: icmp_seq=1 ttl=47 time=8.048 ms<br>64 bytes from 180.101.49.12: icmp_seq=2 ttl=47 time=7.854 ms<br>64 bytes from 180.101.49.12: icmp_seq=3 ttl=47 time=7.688 ms<br>--- www.a.shifen.com ping statistics ---<br>4 packets transmitted, 4 packets received, 0% packet loss<br>round-trip min/avg/max/stddev = 7.688/7.944/8.186/0.189 ms<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡ dnsutils è¿›è¡Œè§£ææŸ¥è¯¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl exec dnsutils-demo-9nbzt nslookup www.baidu.com<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹ï¼Œå¯ä»¥é€šè¿‡ CoreDNS è§£æåˆ°å¤–éƒ¨åŸŸå:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">Server:10.0.0.2<br>Address:10.0.0.2#53<br><br>Non-authoritative answer:<br>www.baidu.comcanonical name = www.a.shifen.com.<br>Name:www.a.shifen.com<br>Address: 180.101.49.12<br>Name:www.a.shifen.com<br>Address: 180.101.49.11<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰éƒ¨ç½²-dashboard"><a href="#2ï¼‰éƒ¨ç½²-dashboard" class="headerlink" title="2ï¼‰éƒ¨ç½² dashboard"></a>2ï¼‰éƒ¨ç½² dashboard</h4><p><strong>æ’ä»¶ä»‹ç» â€”â€” Dashboard:</strong> <a href="https://tareya.github.io/2021/10/21/Kubernetes-%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D-%E2%80%94%E2%80%94-Dashboard/">ä¼ é€ä»¬</a></p><h5 id="1-è·å–-Dashboard-manifest"><a href="#1-è·å–-Dashboard-manifest" class="headerlink" title="1. è·å– Dashboard manifest"></a>1. è·å– Dashboard manifest</h5><blockquote><p>ğŸš© æˆ‘ä»¬ä¹‹å‰åœ¨éƒ¨ç½² coredns çš„æ—¶å€™ï¼Œå·²ç»è§£å‹äº† <code>kubernetes-src.tar.gz</code>ï¼Œdashboard çš„ç›®å½•æ˜¯ <code>cluster/addons/dashboard</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p ~/kubernetes/addons/dashboard &amp;&amp; \<br>wget -c https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml -O  ~/kubernetes/addons/dashboard/recommended.yaml<br></code></pre></td></tr></table></figure><h5 id="2-ä¿®æ”¹-Dashboard-manifest"><a href="#2-ä¿®æ”¹-Dashboard-manifest" class="headerlink" title="2. ä¿®æ”¹ Dashboard manifest"></a>2. ä¿®æ”¹ Dashboard manifest</h5><p>æ–‡ä»¶è·¯å¾„ <code>~/kubernetes/addons/dashboard/recommended.yaml </code>ï¼Œä¿®æ”¹æ–‡ä»¶ï¼Œå°† service ç±»å‹æ”¹ä¸º NodePortï¼Œè¿™æ ·å°±å¤–éƒ¨å¯ä»¥ç›´æ¥é€šè¿‡è®¿é—® NodeIP:NodePort è®¿é—® Dashboardã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">...</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kubernetes-dashboard</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes-dashboard</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kubernetes-dashboard</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><span class="hljs-comment"># æ–°å¢</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">443</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8443</span><br>      <span class="hljs-attr">nodePort:</span> <span class="hljs-number">30443</span><span class="hljs-comment"># æ–°å¢</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kubernetes-dashboard</span><br><span class="hljs-string">...</span><br></code></pre></td></tr></table></figure><h5 id="3-åˆ›å»º-Dashboard"><a href="#3-åˆ›å»º-Dashboard" class="headerlink" title="3. åˆ›å»º Dashboard"></a>3. åˆ›å»º Dashboard</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ~/kubernetes/addons/dashboard/ &amp;&amp; \<br>kubectl apply -f .<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">namespace/kubernetes-dashboard created<br>serviceaccount/kubernetes-dashboard created<br>service/kubernetes-dashboard created<br>secret/kubernetes-dashboard-certs created<br>secret/kubernetes-dashboard-csrf created<br>secret/kubernetes-dashboard-key-holder created<br>configmap/kubernetes-dashboard-settings created<br>role.rbac.authorization.k8s.io/kubernetes-dashboard created<br>clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created<br>rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created<br>clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created<br>deployment.apps/kubernetes-dashboard created<br>service/dashboard-metrics-scraper created<br>deployment.apps/dashboard-metrics-scraper created<br></code></pre></td></tr></table></figure><h5 id="4-éªŒè¯-Dashboard-çŠ¶æ€"><a href="#4-éªŒè¯-Dashboard-çŠ¶æ€" class="headerlink" title="4. éªŒè¯ Dashboard çŠ¶æ€"></a>4. éªŒè¯ Dashboard çŠ¶æ€</h5><p>è·å– dashboard pod ä¿¡æ¯ (æ‰§è¡Œä¸‹é¢å‘½ä»¤åï¼Œç¨å¾®ç­‰ä¸€ä¼šå„¿ï¼Œç¡®ä¿ READY çŠ¶æ€éƒ½æ˜¯å¯ç”¨çš„)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get pod -A -o wide|grep dashboard<br></code></pre></td></tr></table></figure><p>è¿”å›ç»“æœå¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubernetes-dashboard   dashboard-metrics-scraper-6b4884c9d5-kzrdw   1/1     Running   0          81s     10.244.195.4     k8s-master03   &lt;none&gt;           &lt;none&gt;<br>kubernetes-dashboard   kubernetes-dashboard-7b544877d5-ngbts        1/1     Running   0          81s     10.244.85.197    k8s-node01     &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹åˆ›å»ºçš„ dashboard çš„ pod çŠ¶æ€ï¼Œç¡®ä¿æ²¡æœ‰æŠ¥é”™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl describe pod -n kubernetes-dashboard kubernetes-dashboard-7b544877d5-ngbts<br></code></pre></td></tr></table></figure><p>æ­£ç¡®è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">......<br>......<br>Events:<br>  Type    Reason     Age   From               Message<br>  ----    ------     ----  ----               -------<br>  Normal  Scheduled  118s  default-scheduler  Successfully assigned kubernetes-dashboard/kubernetes-dashboard-7b544877d5-ngbts to k8s-node01<br>  Normal  Pulling    118s  kubelet            Pulling image &quot;kubernetesui/dashboard:v2.0.0&quot;<br>  Normal  Pulled     102s  kubelet            Successfully pulled image &quot;kubernetesui/dashboard:v2.0.0&quot;<br>  Normal  Created    102s  kubelet            Created container kubernetes-dashboard<br>  Normal  Started    102s  kubelet            Started container kubernetes-dashboard<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹åˆ†é…çš„ NodePort </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get svc -n kubernetes-dashboard<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME                        TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)         AGE<br>dashboard-metrics-scraper   ClusterIP   10.0.251.223   &lt;none&gt;        8000/TCP        2m38s<br>kubernetes-dashboard        NodePort    10.0.73.122    &lt;none&gt;        443:30443/TCP   2m38s<br></code></pre></td></tr></table></figure><h5 id="5-é€šè¿‡-kube-apiserver-å¤–éƒ¨è®¿é—®-dashboard"><a href="#5-é€šè¿‡-kube-apiserver-å¤–éƒ¨è®¿é—®-dashboard" class="headerlink" title="5. é€šè¿‡ kube-apiserver å¤–éƒ¨è®¿é—® dashboard"></a>5. é€šè¿‡ kube-apiserver å¤–éƒ¨è®¿é—® dashboard</h5><h6 id="1âƒ£ï¸-å¯¼å…¥å®¢æˆ·ç«¯è¯ä¹¦"><a href="#1âƒ£ï¸-å¯¼å…¥å®¢æˆ·ç«¯è¯ä¹¦" class="headerlink" title="1âƒ£ï¸ å¯¼å…¥å®¢æˆ·ç«¯è¯ä¹¦"></a>1âƒ£ï¸ å¯¼å…¥å®¢æˆ·ç«¯è¯ä¹¦</h6><blockquote><p>âš ï¸  <strong>æ³¨æ„</strong></p><p>éœ€è¦æ³¨æ„ï¼Œå¤–éƒ¨è®¿é—®å¿…é¡»é€šè¿‡ kube-apiserver çš„å®‰å…¨ç«¯å£(https)è®¿é—® dashbaordï¼Œè®¿é—®æ—¶æµè§ˆå™¨éœ€è¦è¿›è¡Œè®¤è¯ï¼Œå¦åˆ™ä¼šè¢« kube-apiserver æ‹’ç»è®¿é—®ã€‚æŠ¥é”™å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">services &quot;https:kubernetes-dashboard:&quot; is forbidden: User &quot;system:anonymous&quot; cannot get resource &quot;services/proxy&quot; in API group &quot;&quot; in the namespace &quot;kube-system&quot;<br></code></pre></td></tr></table></figure><p><strong>Mac OSç³»ç»Ÿå®¢æˆ·æœºä¸Šå¯¼å…¥è¯ä¹¦çš„æ–¹æ³•:</strong></p><p>1ï¼‰åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦</p><p>éœ€è¦ä½¿ç”¨æˆ‘ä»¬ä¸€å¼€å§‹ç”Ÿæˆçš„ç”Ÿæˆçš„ admin è¯ä¹¦å¯¹ï¼Œåˆ›å»ºçš„å®¢æˆ·ç«¯è¯ä¹¦ä¸º Chrome æˆ– Firefox è¯†åˆ«çš„ p12 æ ¼å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">openssl pkcs12 -export  -out kube-admin.pfx -name &quot;kubernetes-client&quot; -inkey /data/applications/kubernetes/ssl/admin-key.pem -in /data/applications/kubernetes/ssl/admin.pem -certfile /data/applications/kubernetes/ssl/ca.pem<br></code></pre></td></tr></table></figure><p>è¿”å›äº¤äº’å‘½ä»¤:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">Enter Export Password:                      # è¿™é‡Œè¾“å…¥è‡ªå·±è®¾å®šçš„ä»»æ„å¯†ç ï¼Œæ¯”å¦‚&quot;123456&quot;<br>Verifying - Enter Export Password:          # ç¡®è®¤å¯†ç : 123456<br></code></pre></td></tr></table></figure><p>2ï¼‰æœ¬åœ°å¯¼å…¥è¯ä¹¦</p><p>å°†ç”Ÿæˆçš„å®¢æˆ·ç«¯è¯ä¹¦æ‹·è´åˆ°æœ¬åœ°ï¼Œåœ¨ â€œé’¥åŒ™ä¸²è®¿é—®â€ =&gt; â€œç³»ç»Ÿâ€ =&gt; â€œæ·»åŠ é’¥åŒ™ä¸²â€ï¼Œå¯¼å…¥å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆå¯¼å…¥æ—¶ä¼šæç¤ºè¾“å…¥è¯ä¹¦å¯†ç ï¼Œå³ â€œ123456â€ï¼‰ï¼Œå¦‚ä¸‹å›¾</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211012171934292.png" alt="image-20211012171934292"></p><p>3ï¼‰è®¾ç½® kubernetes ï¼ˆå³ apiserverçš„ï¼‰tls è¯ä¹¦æ°¸ä¹…ä¿¡ä»»</p><p>ç‚¹å‡»Macæœ¬ä¸Šçš„â€<strong>é’¥åŒ™ä¸²è®¿é—®</strong>â€œ -&gt; â€œ<strong>ç³»ç»Ÿ</strong>â€œ -&gt; â€œ<strong>è¯ä¹¦</strong>â€œ -&gt; â€œ<strong>kebernetes</strong>â€œ(åŒå‡»é‡Œé¢çš„â€<strong>ä¿¡ä»»</strong>â€œï¼Œæ”¹æˆâ€<strong>å§‹ç»ˆä¿¡ä»»</strong>â€œ),å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211012171426530.png" alt="image-20211012171426530"></p><p>æ¸…é™¤æµè§ˆå™¨å†å²è®°å½•ï¼Œä¸€å®šè¦é‡å¯æµè§ˆå™¨ï¼Œæ¥ç€è®¿é—® apiserveråœ°å€ï¼Œæ¥ç€ä¼šæç¤ºé€‰æ‹©ä¸€ä¸ªæµè§ˆå™¨è¯ä¹¦ï¼Œä¼šæç¤ºè¯ä¹¦è®¤è¯, ç„¶åå†æ¬¡è®¿é—® apiserverï¼Œå‘ç°ç›¸åº”çš„ metrics æ•°æ®å°±æˆåŠŸæ˜¾ç¤ºå‡ºæ¥äº†ï¼ï¼(æ³¨æ„ï¼Œå¦‚æœå¤±è´¥äº†ã€‚åˆ™å¯ä»¥åˆ é™¤è¯ä¹¦ï¼Œç„¶åé‡æ–°ç”Ÿæˆï¼Œé‡æ–°å¯¼å…¥å†è·Ÿç€æ“ä½œæ­¥éª¤æ¥ä¸€éï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œé‡å¯æµè§ˆå™¨ï¼Œé€‰æ‹©å¯¼å…¥çš„è¯ä¹¦ï¼Œå†æ¬¡è®¿é—®å³å¯ï¼ï¼‰</p><p>è®¿é—® <a href="https://192.168.3.231:6443/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login%EF%BC%8C%E4%BC%9A%E6%9C%89%E5%A6%82%E4%B8%8B%E8%AE%A4%E8%AF%81%E6%8F%90%E7%A4%BA">https://192.168.3.231:6443/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/loginï¼Œä¼šæœ‰å¦‚ä¸‹è®¤è¯æç¤º</a></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211012172918878.png" alt="image-20211012172918878"></p><p>é€‰æ‹©è¯ä¹¦åï¼Œå³è·³è½¬åˆ° dashboard çš„è®¤è¯é¡µé¢</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211012182139093.png" alt="image-20211012182139093"></p></blockquote><h6 id="2âƒ£ï¸-åˆ›å»ºç™»å½•-Dashboard-çš„-token"><a href="#2âƒ£ï¸-åˆ›å»ºç™»å½•-Dashboard-çš„-token" class="headerlink" title="2âƒ£ï¸ åˆ›å»ºç™»å½• Dashboard çš„ token"></a>2âƒ£ï¸ åˆ›å»ºç™»å½• Dashboard çš„ token</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ›å»º service account</span><br>kubectl create sa dashboard-admin -n kube-system<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ›å»º clusterrolebinding</span> <br>kubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> è·å– token</span><br>ADMIN_SECRET=$(kubectl get secrets -n kube-system | grep dashboard-admin | awk &#x27;&#123;print $1&#125;&#x27;)<br>DASHBOARD_LOGIN_TOKEN=$(kubectl describe secret -n kube-system $ADMIN_SECRET| grep -E &#x27;^token&#x27; | awk &#x27;&#123;print $2&#125;&#x27;)<br>echo $DASHBOARD_LOGIN_TOKEN<br></code></pre></td></tr></table></figure><h6 id="3âƒ£ï¸-åˆ›å»ºç™»å½•-Dashboard-çš„-kubeconfig-é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰"><a href="#3âƒ£ï¸-åˆ›å»ºç™»å½•-Dashboard-çš„-kubeconfig-é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰" class="headerlink" title="3âƒ£ï¸ åˆ›å»ºç™»å½• Dashboard çš„ kubeconfig é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰"></a>3âƒ£ï¸ åˆ›å»ºç™»å½• Dashboard çš„ kubeconfig é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰</h6><p>dashboard é»˜è®¤åªæ”¯æŒ token è®¤è¯ï¼ˆä¸æ”¯æŒ client è¯ä¹¦è®¤è¯ï¼‰ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ Kubeconfig æ–‡ä»¶ï¼Œéœ€è¦å°† token å†™å…¥åˆ°è¯¥æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®é›†ç¾¤å‚æ•°</span><br>kubectl config set-cluster kubernetes \<br>  --certificate-authority=/data/applications/kubernetes/ssl/ca.pem \<br>  --embed-certs=true \<br>  --server=https://192.168.3.231:6443 \<br>  --kubeconfig=dashboard.kubeconfig<br><span class="hljs-meta">  </span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°ï¼Œä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ Token</span><br>kubectl config set-credentials dashboard_user \<br>  --token=$&#123;DASHBOARD_LOGIN_TOKEN&#125; \<br>  --kubeconfig=dashboard.kubeconfig<br><span class="hljs-meta">  </span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°</span><br>kubectl config set-context default \<br>  --cluster=kubernetes \<br>  --user=dashboard_user \<br>  --kubeconfig=dashboard.kubeconfig<br><span class="hljs-meta">  </span><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡</span><br>kubectl config use-context default --kubeconfig=dashboard.kubeconfig<br></code></pre></td></tr></table></figure><p>å°†ä¸Šé¢ç”Ÿæˆçš„ dashboard.kubeconfig æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ç™»å½• Dashboard å³å¯ï¼Œè®¿é—®ç»“æœå¦‚ä¸‹å›¾:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20211012182619869.png" alt="image-20211012182619869"></p><blockquote><p>ğŸš© <strong>è¿™é‡Œç”±äºç¼ºå°‘Heapsteræˆ–metrics-serveræ’ä»¶ï¼Œå½“å‰dashboardè¿˜ä¸èƒ½å±•ç¤º Podã€Nodes çš„ CPUã€å†…å­˜ç­‰ç»Ÿè®¡æ•°æ®å’Œå›¾è¡¨ã€‚</strong></p></blockquote><h4 id="3ï¼‰éƒ¨ç½²-metrics-server"><a href="#3ï¼‰éƒ¨ç½²-metrics-server" class="headerlink" title="3ï¼‰éƒ¨ç½² metrics-server"></a>3ï¼‰éƒ¨ç½² metrics-server</h4><h4 id="4ï¼‰éƒ¨ç½²-kube-state-metrics"><a href="#4ï¼‰éƒ¨ç½²-kube-state-metrics" class="headerlink" title="4ï¼‰éƒ¨ç½² kube-state-metrics"></a>4ï¼‰éƒ¨ç½² kube-state-metrics</h4><h4 id="5ï¼‰éƒ¨ç½²-prometheus"><a href="#5ï¼‰éƒ¨ç½²-prometheus" class="headerlink" title="5ï¼‰éƒ¨ç½² prometheus"></a>5ï¼‰éƒ¨ç½² prometheus</h4>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Kubernetes å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬12ç« ã€é¡¹ç›®ç®¡ç†é«˜çº§çŸ¥è¯†</title>
    <link href="/2021/09/21/%E7%AC%AC12%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E9%AB%98%E7%BA%A7%E7%9F%A5%E8%AF%86/"/>
    <url>/2021/09/21/%E7%AC%AC12%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E9%AB%98%E7%BA%A7%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬12ç« ã€é¡¹ç›®ç®¡ç†é«˜çº§çŸ¥è¯†"><a href="#ç¬¬12ç« ã€é¡¹ç›®ç®¡ç†é«˜çº§çŸ¥è¯†" class="headerlink" title="ç¬¬12ç« ã€é¡¹ç›®ç®¡ç†é«˜çº§çŸ¥è¯†"></a>ç¬¬12ç« ã€é¡¹ç›®ç®¡ç†é«˜çº§çŸ¥è¯†</h1><span id="more"></span><h2 id="ä¸€ã€çŸ¥è¯†ç®¡ç†"><a href="#ä¸€ã€çŸ¥è¯†ç®¡ç†" class="headerlink" title="ä¸€ã€çŸ¥è¯†ç®¡ç†"></a>ä¸€ã€çŸ¥è¯†ç®¡ç†</h2><h3 id="1ã€çŸ¥è¯†çš„æ¦‚å¿µ"><a href="#1ã€çŸ¥è¯†çš„æ¦‚å¿µ" class="headerlink" title="1ã€çŸ¥è¯†çš„æ¦‚å¿µ"></a>1ã€çŸ¥è¯†çš„æ¦‚å¿µ</h3><h4 id="1ï¼‰çŸ¥è¯†çš„åˆ†ç±»"><a href="#1ï¼‰çŸ¥è¯†çš„åˆ†ç±»" class="headerlink" title="1ï¼‰çŸ¥è¯†çš„åˆ†ç±»"></a>1ï¼‰çŸ¥è¯†çš„åˆ†ç±»</h4><h5 id="1-æ˜¾æ€§çŸ¥è¯†"><a href="#1-æ˜¾æ€§çŸ¥è¯†" class="headerlink" title="1. æ˜¾æ€§çŸ¥è¯†"></a>1. æ˜¾æ€§çŸ¥è¯†</h5><h5 id="2-éšæ€§çŸ¥è¯†"><a href="#2-éšæ€§çŸ¥è¯†" class="headerlink" title="2. éšæ€§çŸ¥è¯†"></a>2. éšæ€§çŸ¥è¯†</h5><h4 id="2ï¼‰çŸ¥è¯†çš„ç‰¹å¾"><a href="#2ï¼‰çŸ¥è¯†çš„ç‰¹å¾" class="headerlink" title="2ï¼‰çŸ¥è¯†çš„ç‰¹å¾"></a>2ï¼‰çŸ¥è¯†çš„ç‰¹å¾</h4><h4 id="3ï¼‰çŸ¥è¯†çš„ç®¡ç†å·¥å…·"><a href="#3ï¼‰çŸ¥è¯†çš„ç®¡ç†å·¥å…·" class="headerlink" title="3ï¼‰çŸ¥è¯†çš„ç®¡ç†å·¥å…·"></a>3ï¼‰çŸ¥è¯†çš„ç®¡ç†å·¥å…·</h4><h4 id="4ï¼‰éšæ€§çŸ¥è¯†çš„å…±äº«"><a href="#4ï¼‰éšæ€§çŸ¥è¯†çš„å…±äº«" class="headerlink" title="4ï¼‰éšæ€§çŸ¥è¯†çš„å…±äº«"></a>4ï¼‰éšæ€§çŸ¥è¯†çš„å…±äº«</h4><h5 id="1-å…±äº«çš„æ–¹æ³•"><a href="#1-å…±äº«çš„æ–¹æ³•" class="headerlink" title="1. å…±äº«çš„æ–¹æ³•"></a>1. å…±äº«çš„æ–¹æ³•</h5><ul><li>ç¼–ç åŒ–</li><li>é¢å¯¹é¢äº¤æµ</li><li>äººå‘˜è½®æ¢å’Œç½‘ç»œ</li></ul><h5 id="2-å…±äº«çš„é€”å¾„"><a href="#2-å…±äº«çš„é€”å¾„" class="headerlink" title="2. å…±äº«çš„é€”å¾„"></a>2. å…±äº«çš„é€”å¾„</h5><ul><li>åˆ›å»ºå­¦ä¹ å‹ç»„ç»‡</li><li>æ„å»ºå†…éƒ¨çš„ä¿¡ä»»æœºåˆ¶</li><li>ç¼–ç åŒ–</li><li></li></ul><h2 id="äºŒã€æˆ˜ç•¥ç®¡ç†"><a href="#äºŒã€æˆ˜ç•¥ç®¡ç†" class="headerlink" title="äºŒã€æˆ˜ç•¥ç®¡ç†"></a>äºŒã€æˆ˜ç•¥ç®¡ç†</h2><h3 id="1ã€ç»„ç»‡æˆ˜ç•¥"><a href="#1ã€ç»„ç»‡æˆ˜ç•¥" class="headerlink" title="1ã€ç»„ç»‡æˆ˜ç•¥"></a>1ã€ç»„ç»‡æˆ˜ç•¥</h3><h4 id="1ï¼‰æˆ˜ç•¥ç›®æ ‡"><a href="#1ï¼‰æˆ˜ç•¥ç›®æ ‡" class="headerlink" title="1ï¼‰æˆ˜ç•¥ç›®æ ‡"></a>1ï¼‰æˆ˜ç•¥ç›®æ ‡</h4><h4 id="2ï¼‰æˆ˜ç•¥æ–¹é’ˆ"><a href="#2ï¼‰æˆ˜ç•¥æ–¹é’ˆ" class="headerlink" title="2ï¼‰æˆ˜ç•¥æ–¹é’ˆ"></a>2ï¼‰æˆ˜ç•¥æ–¹é’ˆ</h4><h4 id="3ï¼‰æˆ˜ç•¥å®æ–½èƒ½åŠ›"><a href="#3ï¼‰æˆ˜ç•¥å®æ–½èƒ½åŠ›" class="headerlink" title="3ï¼‰æˆ˜ç•¥å®æ–½èƒ½åŠ›"></a>3ï¼‰æˆ˜ç•¥å®æ–½èƒ½åŠ›</h4><h4 id="4ï¼‰æˆ˜ç•¥æªæ–½"><a href="#4ï¼‰æˆ˜ç•¥æªæ–½" class="headerlink" title="4ï¼‰æˆ˜ç•¥æªæ–½"></a>4ï¼‰æˆ˜ç•¥æªæ–½</h4><h3 id="2ã€æˆ˜ç•¥å®æ–½è¿‡ç¨‹åˆ†è§£"><a href="#2ã€æˆ˜ç•¥å®æ–½è¿‡ç¨‹åˆ†è§£" class="headerlink" title="2ã€æˆ˜ç•¥å®æ–½è¿‡ç¨‹åˆ†è§£"></a>2ã€æˆ˜ç•¥å®æ–½è¿‡ç¨‹åˆ†è§£</h3><h3 id="3ã€ç»„ç»‡äº‹ä¸šæˆ˜ç•¥ç±»å‹"><a href="#3ã€ç»„ç»‡äº‹ä¸šæˆ˜ç•¥ç±»å‹" class="headerlink" title="3ã€ç»„ç»‡äº‹ä¸šæˆ˜ç•¥ç±»å‹"></a>3ã€ç»„ç»‡äº‹ä¸šæˆ˜ç•¥ç±»å‹</h3><h4 id="1ï¼‰é˜²å¾¡è€…æˆ˜ç•¥ï¼ˆDefenderï¼‰"><a href="#1ï¼‰é˜²å¾¡è€…æˆ˜ç•¥ï¼ˆDefenderï¼‰" class="headerlink" title="1ï¼‰é˜²å¾¡è€…æˆ˜ç•¥ï¼ˆDefenderï¼‰"></a>1ï¼‰é˜²å¾¡è€…æˆ˜ç•¥ï¼ˆDefenderï¼‰</h4><h4 id="2ï¼‰æ¢ç´¢è€…æˆ˜ç•¥ï¼ˆProspectorï¼‰"><a href="#2ï¼‰æ¢ç´¢è€…æˆ˜ç•¥ï¼ˆProspectorï¼‰" class="headerlink" title="2ï¼‰æ¢ç´¢è€…æˆ˜ç•¥ï¼ˆProspectorï¼‰"></a>2ï¼‰æ¢ç´¢è€…æˆ˜ç•¥ï¼ˆProspectorï¼‰</h4><h4 id="3ï¼‰åˆ†æè€…æˆ˜ç•¥ï¼ˆAnaiyserï¼‰"><a href="#3ï¼‰åˆ†æè€…æˆ˜ç•¥ï¼ˆAnaiyserï¼‰" class="headerlink" title="3ï¼‰åˆ†æè€…æˆ˜ç•¥ï¼ˆAnaiyserï¼‰"></a>3ï¼‰åˆ†æè€…æˆ˜ç•¥ï¼ˆAnaiyserï¼‰</h4><h4 id="4ï¼‰ååº”è€…æˆ˜ç•¥ï¼ˆReactorï¼‰"><a href="#4ï¼‰ååº”è€…æˆ˜ç•¥ï¼ˆReactorï¼‰" class="headerlink" title="4ï¼‰ååº”è€…æˆ˜ç•¥ï¼ˆReactorï¼‰"></a>4ï¼‰ååº”è€…æˆ˜ç•¥ï¼ˆReactorï¼‰</h4><h3 id="4ã€æˆ˜ç•¥ç»„ç»‡ç±»å‹"><a href="#4ã€æˆ˜ç•¥ç»„ç»‡ç±»å‹" class="headerlink" title="4ã€æˆ˜ç•¥ç»„ç»‡ç±»å‹"></a>4ã€æˆ˜ç•¥ç»„ç»‡ç±»å‹</h3><h4 id="1ï¼‰æŒ‡æŒ¥å‹"><a href="#1ï¼‰æŒ‡æŒ¥å‹" class="headerlink" title="1ï¼‰æŒ‡æŒ¥å‹"></a>1ï¼‰æŒ‡æŒ¥å‹</h4><h4 id="2ï¼‰å˜é©å‹"><a href="#2ï¼‰å˜é©å‹" class="headerlink" title="2ï¼‰å˜é©å‹"></a>2ï¼‰å˜é©å‹</h4><h4 id="3ï¼‰åˆä½œå‹"><a href="#3ï¼‰åˆä½œå‹" class="headerlink" title="3ï¼‰åˆä½œå‹"></a>3ï¼‰åˆä½œå‹</h4><h4 id="4ï¼‰æ–‡åŒ–å‹"><a href="#4ï¼‰æ–‡åŒ–å‹" class="headerlink" title="4ï¼‰æ–‡åŒ–å‹"></a>4ï¼‰æ–‡åŒ–å‹</h4><h4 id="5ï¼‰å¢é•¿å‹"><a href="#5ï¼‰å¢é•¿å‹" class="headerlink" title="5ï¼‰å¢é•¿å‹"></a>5ï¼‰å¢é•¿å‹</h4><h3 id="5ã€ç»„ç»‡æˆ˜ç•¥å±‚æ¬¡"><a href="#5ã€ç»„ç»‡æˆ˜ç•¥å±‚æ¬¡" class="headerlink" title="5ã€ç»„ç»‡æˆ˜ç•¥å±‚æ¬¡"></a>5ã€ç»„ç»‡æˆ˜ç•¥å±‚æ¬¡</h3><h4 id="1ï¼‰ç›®æ ‡å±‚"><a href="#1ï¼‰ç›®æ ‡å±‚" class="headerlink" title="1ï¼‰ç›®æ ‡å±‚"></a>1ï¼‰ç›®æ ‡å±‚</h4><h4 id="2ï¼‰æ–¹é’ˆå±‚"><a href="#2ï¼‰æ–¹é’ˆå±‚" class="headerlink" title="2ï¼‰æ–¹é’ˆå±‚"></a>2ï¼‰æ–¹é’ˆå±‚</h4><h4 id="3ï¼‰è¡Œä¸ºå±‚"><a href="#3ï¼‰è¡Œä¸ºå±‚" class="headerlink" title="3ï¼‰è¡Œä¸ºå±‚"></a>3ï¼‰è¡Œä¸ºå±‚</h4><h2 id="ä¸‰ã€ç»„ç»‡çº§é¡¹ç›®ç®¡ç†"><a href="#ä¸‰ã€ç»„ç»‡çº§é¡¹ç›®ç®¡ç†" class="headerlink" title="ä¸‰ã€ç»„ç»‡çº§é¡¹ç›®ç®¡ç†"></a>ä¸‰ã€ç»„ç»‡çº§é¡¹ç›®ç®¡ç†</h2><h3 id="1ã€ç»„ç»‡çº§é¡¹ç›®ç®¡ç†æˆç†Ÿåº¦æ¨¡å‹ï¼ˆOPM3ï¼‰"><a href="#1ã€ç»„ç»‡çº§é¡¹ç›®ç®¡ç†æˆç†Ÿåº¦æ¨¡å‹ï¼ˆOPM3ï¼‰" class="headerlink" title="1ã€ç»„ç»‡çº§é¡¹ç›®ç®¡ç†æˆç†Ÿåº¦æ¨¡å‹ï¼ˆOPM3ï¼‰"></a>1ã€ç»„ç»‡çº§é¡¹ç›®ç®¡ç†æˆç†Ÿåº¦æ¨¡å‹ï¼ˆOPM3ï¼‰</h3><h2 id="å››ã€æµç¨‹ç®¡ç†"><a href="#å››ã€æµç¨‹ç®¡ç†" class="headerlink" title="å››ã€æµç¨‹ç®¡ç†"></a>å››ã€æµç¨‹ç®¡ç†</h2><h3 id="1ã€ä¼ä¸šæµç¨‹åˆ†ç±»"><a href="#1ã€ä¼ä¸šæµç¨‹åˆ†ç±»" class="headerlink" title="1ã€ä¼ä¸šæµç¨‹åˆ†ç±»"></a>1ã€ä¼ä¸šæµç¨‹åˆ†ç±»</h3><h4 id="1ï¼‰ç”Ÿäº§æµç¨‹å±‚"><a href="#1ï¼‰ç”Ÿäº§æµç¨‹å±‚" class="headerlink" title="1ï¼‰ç”Ÿäº§æµç¨‹å±‚"></a>1ï¼‰ç”Ÿäº§æµç¨‹å±‚</h4><h4 id="2ï¼‰è¿ä½œå±‚"><a href="#2ï¼‰è¿ä½œå±‚" class="headerlink" title="2ï¼‰è¿ä½œå±‚"></a>2ï¼‰è¿ä½œå±‚</h4><h4 id="3ï¼‰è®¡åˆ’å±‚"><a href="#3ï¼‰è®¡åˆ’å±‚" class="headerlink" title="3ï¼‰è®¡åˆ’å±‚"></a>3ï¼‰è®¡åˆ’å±‚</h4><h4 id="4ï¼‰æˆ˜ç•¥å±‚"><a href="#4ï¼‰æˆ˜ç•¥å±‚" class="headerlink" title="4ï¼‰æˆ˜ç•¥å±‚"></a>4ï¼‰æˆ˜ç•¥å±‚</h4><h3 id="2ã€æµç¨‹åˆ†æå·¥å…·"><a href="#2ã€æµç¨‹åˆ†æå·¥å…·" class="headerlink" title="2ã€æµç¨‹åˆ†æå·¥å…·"></a>2ã€æµç¨‹åˆ†æå·¥å…·</h3><h4 id="1ï¼‰ä¸šåŠ¡æµç¨‹å›¾"><a href="#1ï¼‰ä¸šåŠ¡æµç¨‹å›¾" class="headerlink" title="1ï¼‰ä¸šåŠ¡æµç¨‹å›¾"></a>1ï¼‰ä¸šåŠ¡æµç¨‹å›¾</h4><h4 id="2ï¼‰ä¸šåŠ¡æ´»åŠ¨å›¾ç¤º"><a href="#2ï¼‰ä¸šåŠ¡æ´»åŠ¨å›¾ç¤º" class="headerlink" title="2ï¼‰ä¸šåŠ¡æ´»åŠ¨å›¾ç¤º"></a>2ï¼‰ä¸šåŠ¡æ´»åŠ¨å›¾ç¤º</h4><h4 id="3ï¼‰UMLçš„æ´»åŠ¨å›¾"><a href="#3ï¼‰UMLçš„æ´»åŠ¨å›¾" class="headerlink" title="3ï¼‰UMLçš„æ´»åŠ¨å›¾"></a>3ï¼‰UMLçš„æ´»åŠ¨å›¾</h4><h4 id="4ï¼‰æ ‡æ†ç„å‡†"><a href="#4ï¼‰æ ‡æ†ç„å‡†" class="headerlink" title="4ï¼‰æ ‡æ†ç„å‡†"></a>4ï¼‰æ ‡æ†ç„å‡†</h4><h4 id="5ï¼‰IDEF"><a href="#5ï¼‰IDEF" class="headerlink" title="5ï¼‰IDEF"></a>5ï¼‰IDEF</h4><h4 id="6ï¼‰DEMO"><a href="#6ï¼‰DEMO" class="headerlink" title="6ï¼‰DEMO"></a>6ï¼‰DEMO</h4><h4 id="7ï¼‰Petri-ç½‘"><a href="#7ï¼‰Petri-ç½‘" class="headerlink" title="7ï¼‰Petri ç½‘"></a>7ï¼‰Petri ç½‘</h4><h4 id="8ï¼‰ä¸šåŠ¡æµç¨‹å»ºæ¨¡è¯­è¨€"><a href="#8ï¼‰ä¸šåŠ¡æµç¨‹å»ºæ¨¡è¯­è¨€" class="headerlink" title="8ï¼‰ä¸šåŠ¡æµç¨‹å»ºæ¨¡è¯­è¨€"></a>8ï¼‰ä¸šåŠ¡æµç¨‹å»ºæ¨¡è¯­è¨€</h4><h3 id="3ã€ä¸šåŠ¡æµç¨‹è¯„ä¼°"><a href="#3ã€ä¸šåŠ¡æµç¨‹è¯„ä¼°" class="headerlink" title="3ã€ä¸šåŠ¡æµç¨‹è¯„ä¼°"></a>3ã€ä¸šåŠ¡æµç¨‹è¯„ä¼°</h3><h4 id="1ï¼‰å¢å€¼æ€§åˆ†æ"><a href="#1ï¼‰å¢å€¼æ€§åˆ†æ" class="headerlink" title="1ï¼‰å¢å€¼æ€§åˆ†æ"></a>1ï¼‰å¢å€¼æ€§åˆ†æ</h4><p>1.å®šä¹‰</p><p>2.è¯„ä»·æ´»åŠ¨çš„ä¸‰ä¸ªå‚æ•°</p><h4 id="2ï¼‰æµç¨‹è®¾è®¡çš„æ­£ç¡®æ€§æ£€éªŒ"><a href="#2ï¼‰æµç¨‹è®¾è®¡çš„æ­£ç¡®æ€§æ£€éªŒ" class="headerlink" title="2ï¼‰æµç¨‹è®¾è®¡çš„æ­£ç¡®æ€§æ£€éªŒ"></a>2ï¼‰æµç¨‹è®¾è®¡çš„æ­£ç¡®æ€§æ£€éªŒ</h4><h4 id="3ï¼‰ä¸šåŠ¡æµç¨‹æ–¹æ¡ˆçš„è¯„ä»·"><a href="#3ï¼‰ä¸šåŠ¡æµç¨‹æ–¹æ¡ˆçš„è¯„ä»·" class="headerlink" title="3ï¼‰ä¸šåŠ¡æµç¨‹æ–¹æ¡ˆçš„è¯„ä»·"></a>3ï¼‰ä¸šåŠ¡æµç¨‹æ–¹æ¡ˆçš„è¯„ä»·</h4><h3 id="4ã€æ•æ·é¡¹ç›®ç®¡ç†æ¨¡å¼çš„ç»“æ„"><a href="#4ã€æ•æ·é¡¹ç›®ç®¡ç†æ¨¡å¼çš„ç»“æ„" class="headerlink" title="4ã€æ•æ·é¡¹ç›®ç®¡ç†æ¨¡å¼çš„ç»“æ„"></a>4ã€æ•æ·é¡¹ç›®ç®¡ç†æ¨¡å¼çš„ç»“æ„</h3><h4 id="1ï¼‰æ„æƒ³"><a href="#1ï¼‰æ„æƒ³" class="headerlink" title="1ï¼‰æ„æƒ³"></a>1ï¼‰æ„æƒ³</h4><h4 id="2ï¼‰æ¨æµ‹"><a href="#2ï¼‰æ¨æµ‹" class="headerlink" title="2ï¼‰æ¨æµ‹"></a>2ï¼‰æ¨æµ‹</h4><h4 id="3ï¼‰æ¢ç´¢"><a href="#3ï¼‰æ¢ç´¢" class="headerlink" title="3ï¼‰æ¢ç´¢"></a>3ï¼‰æ¢ç´¢</h4><h4 id="4ï¼‰é€‚åº”"><a href="#4ï¼‰é€‚åº”" class="headerlink" title="4ï¼‰é€‚åº”"></a>4ï¼‰é€‚åº”</h4><h4 id="5ï¼‰ç»“æŸ"><a href="#5ï¼‰ç»“æŸ" class="headerlink" title="5ï¼‰ç»“æŸ"></a>5ï¼‰ç»“æŸ</h4><h2 id="äº”ã€é¡¹ç›®ã€é¡¹ç›®é›†ã€é¡¹ç›®ç»„åˆç®¡ç†"><a href="#äº”ã€é¡¹ç›®ã€é¡¹ç›®é›†ã€é¡¹ç›®ç»„åˆç®¡ç†" class="headerlink" title="äº”ã€é¡¹ç›®ã€é¡¹ç›®é›†ã€é¡¹ç›®ç»„åˆç®¡ç†"></a>äº”ã€é¡¹ç›®ã€é¡¹ç›®é›†ã€é¡¹ç›®ç»„åˆç®¡ç†</h2><h3 id="1ã€åŸºæœ¬æ¦‚å¿µ"><a href="#1ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1ã€åŸºæœ¬æ¦‚å¿µ"></a>1ã€åŸºæœ¬æ¦‚å¿µ</h3><h4 id="1ï¼‰é¡¹ç›®"><a href="#1ï¼‰é¡¹ç›®" class="headerlink" title="1ï¼‰é¡¹ç›®"></a>1ï¼‰é¡¹ç›®</h4><h4 id="2ï¼‰é¡¹ç›®é›†"><a href="#2ï¼‰é¡¹ç›®é›†" class="headerlink" title="2ï¼‰é¡¹ç›®é›†"></a>2ï¼‰é¡¹ç›®é›†</h4><h4 id="3ï¼‰é¡¹ç›®ç»„åˆ"><a href="#3ï¼‰é¡¹ç›®ç»„åˆ" class="headerlink" title="3ï¼‰é¡¹ç›®ç»„åˆ"></a>3ï¼‰é¡¹ç›®ç»„åˆ</h4><h2 id="å…­ã€æˆç†Ÿåº¦æ¨¡å‹ã€é‡åŒ–ç®¡ç†"><a href="#å…­ã€æˆç†Ÿåº¦æ¨¡å‹ã€é‡åŒ–ç®¡ç†" class="headerlink" title="å…­ã€æˆç†Ÿåº¦æ¨¡å‹ã€é‡åŒ–ç®¡ç†"></a>å…­ã€æˆç†Ÿåº¦æ¨¡å‹ã€é‡åŒ–ç®¡ç†</h2><h3 id="1ã€ç»„ç»‡é¡¹ç›®ç®¡ç†æˆç†Ÿåº¦æ¨¡å‹ï¼ˆOPM3ï¼‰"><a href="#1ã€ç»„ç»‡é¡¹ç›®ç®¡ç†æˆç†Ÿåº¦æ¨¡å‹ï¼ˆOPM3ï¼‰" class="headerlink" title="1ã€ç»„ç»‡é¡¹ç›®ç®¡ç†æˆç†Ÿåº¦æ¨¡å‹ï¼ˆOPM3ï¼‰"></a>1ã€ç»„ç»‡é¡¹ç›®ç®¡ç†æˆç†Ÿåº¦æ¨¡å‹ï¼ˆOPM3ï¼‰</h3><h3 id="2ã€èƒ½åŠ›æˆç†Ÿåº¦æ¨¡å‹é›†æˆï¼ˆCMMIï¼‰"><a href="#2ã€èƒ½åŠ›æˆç†Ÿåº¦æ¨¡å‹é›†æˆï¼ˆCMMIï¼‰" class="headerlink" title="2ã€èƒ½åŠ›æˆç†Ÿåº¦æ¨¡å‹é›†æˆï¼ˆCMMIï¼‰"></a>2ã€èƒ½åŠ›æˆç†Ÿåº¦æ¨¡å‹é›†æˆï¼ˆCMMIï¼‰</h3><p>ä½œä¸šï¼š</p><p>1ã€åŒºåˆ†æ˜¾æ€§çŸ¥è¯†ä¸éšæ€§çŸ¥è¯†</p><p>2ã€çŸ¥è¯†ç®¡ç†å·¥å…·</p><p>3ã€ç»„ç»‡äº‹ä¸šæˆ˜ç•¥ç±»å‹</p><p>4ã€æˆ˜ç•¥ç»„ç»‡ç±»å‹</p><p>5ã€ç»„ç»‡æˆ˜ç•¥å±‚æ¬¡</p><p>6ã€ç»„ç»‡çº§é¡¹ç›®ç®¡ç†æˆç†Ÿåº¦æ¨¡å‹ï¼ˆOPM3ï¼‰å››ä¸ªæ¢¯çº§</p><p>7ã€æ•æ·é¡¹ç›®ç®¡ç†æ¨¡å¼çš„ç»“æ„</p>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes calico ç½‘ç»œç»„ä»¶å‡çº§</title>
    <link href="/2021/09/18/Kubernetes-calico-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6%E5%8D%87%E7%BA%A7/"/>
    <url>/2021/09/18/Kubernetes-calico-%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6%E5%8D%87%E7%BA%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-calico-ç½‘ç»œç»„ä»¶å‡çº§"><a href="#Kubernetes-calico-ç½‘ç»œç»„ä»¶å‡çº§" class="headerlink" title="Kubernetes calico ç½‘ç»œç»„ä»¶å‡çº§"></a>Kubernetes calico ç½‘ç»œç»„ä»¶å‡çº§</h1><span id="more"></span><h2 id="ä¸€ã€èƒŒæ™¯ä»‹ç»"><a href="#ä¸€ã€èƒŒæ™¯ä»‹ç»" class="headerlink" title="ä¸€ã€èƒŒæ™¯ä»‹ç»"></a>ä¸€ã€èƒŒæ™¯ä»‹ç»</h2><p>ç”±äºåŸæœ¬ä¸šåŠ¡æ¶æ„è®¾è®¡çš„ä¸åˆç†æ€§ï¼Œåªæ˜¯éå¸¸ç‰‡é¢çš„å°†æœåŠ¡åœ¨ä»£ç å±‚é¢è¿›è¡Œäº†æ‹†åˆ†ï¼Œè¿™å°±å¯¼è‡´äº†æœåŠ¡æ•°é‡çš„æ€¥å‰§æ‰©å¼ ï¼Œè€Œä»æ ¹æœ¬ä¸Šæ¥è¯´å¤§å¤šæ•°æ‹†åˆ†å‡ºçš„æœåŠ¡å®é™…ä¸Šå´æ˜¯èµ·ä¸åˆ°å¾®æœåŠ¡çš„ä½œç”¨çš„ï¼Œå‡ºäºä¸šç»©éœ€æ±‚å°†ä¸Šæ¸¸æœåŠ¡äººä¸ºçš„å†æ‹†åˆ†ä¸Šä¸‹æ¸¸ï¼Œè€Œè¿™ç±»ä¸Šä¸‹æ¸¸æœåŠ¡å´åˆéƒ½ä¾èµ–äºä¸­å°åº”ç”¨ï¼Œå¹¶ä¸”æœåŠ¡èšåˆã€æ²»ç†ã€APIç½‘å…³ã€æœåŠ¡å‘ç°ç­‰æ–¹é¢éƒ½å°šä¸å®Œå–„ï¼ŒåŸå­æœåŠ¡ä¹‹é—´ç›´æ¥é€šè¿‡ http è¿›è¡Œäº’ç›¸é€šä¿¡ï¼Œå¸¦æ¥çš„é™¤äº†è°ƒç”¨é“¾æ··ä¹±å¤–ï¼Œè¿˜æœ‰æ›´å¤šçš„æ— è°“çš„ç½‘ç»œæ¶ˆè€—ï¼ˆæ¯•ç«ŸåŸæœ¬2ä¸ªæœåŠ¡ä¹‹é—´çš„æ²Ÿé€šæ¸ é“ä¸º2ï¼Œnä¸ªæœåŠ¡ä¹‹é—´å°±ä¼šå˜æˆ n*(n-1)/2ï¼Œäº¤äº’æˆæœ¬å°±æ˜¯ç½‘ç»œæ¶ˆè€—çš„ä¸æ–­ç´¯åŠ ï¼‰ã€‚</p><p>å› æ­¤ï¼Œç”±äº K8S æ•´ä½“è¿ç§»å·¥ä½œè¿›å±•è¾ƒå¿«ï¼ŒåŠ ä»¥æœåŠ¡æ•°é‡ä¸æ–­çš„å¢å¤šï¼ˆå‰¯æœ¬æ•°è¿‘åƒï¼‰ã€æœåŠ¡é—´é€šä¿¡çš„å¤æ‚ï¼Œä¸å¿…è¦çš„ç½‘ç»œé€šä¿¡è¿‡å¤šã€è¿­ä»£çš„é¢‘ç‡è¿‡é«˜ã€æœ¬èº«å‡ºäºå…¬æœ‰äº‘èµ„æºçš„æˆæœ¬è€ƒè™‘ï¼Œæ‰€ä½¿ç”¨çš„æœåŠ¡å™¨èµ„æºä¹Ÿåªæ˜¯æœ€å¤§åŒ–å¹³è¡¡åçš„æœ€ä½é—¨æ§›èµ„æºï¼Œè¿™è¯¸å¤šçš„å› ç´ ï¼Œéƒ½ç›´æ¥å¯¹åŸºç¡€çš„ flannel ç½‘ç»œç»„ä»¶é€ æˆäº†å·¨å¤§çš„å‹åŠ›ï¼Œå¦‚æœè€ƒè™‘ä»¥ç›®å‰çš„è¶‹åŠ¿è€Œæ¯«æ— æ”¹åˆ¶å’ŒèŠ‚åˆ¶çš„è¯ï¼Œåœ¨å‰¯æœ¬æ•°è¶…è¿‡åƒæ•°åï¼Œæ•´ä½“ç½‘ç»œçš„æ€§èƒ½å°±ä¼šæ€¥å‰§ä¸‹é™ï¼Œåˆ°1500å·¦å³æ—¶ï¼Œç½‘ç»œç»„ä»¶å°±ä¼šå‡ºç°è¾ƒä¸ºé¢‘ç¹çš„å´©æºƒã€‚</p><p>åŸæœ¬é‡‡ç”¨ flannel çš„ä¸»è¦å› ç´ åœ¨äºç»´æŠ¤ç›¸å¯¹ç®€å•ï¼Œå¯¹äºç»´æŠ¤äººå‘˜çš„äººæ•°ä»¥åŠæŠ€æœ¯æ¡ä»¶ä¸ä¼šå¤ªé«˜ï¼Œæ¯”è¾ƒé€‚åˆå•äººç»´æŠ¤å¤šé›†ç¾¤çš„æƒ…å†µï¼Œä½†æ˜¯ä»¥ç›®å‰çš„æƒ…å†µæ¥è¯´ï¼Œflannel å·²ç»ä¸è¶³ä»¥æ”¯æ’‘ä¹‹å1å¹´åŠè½½å†…å¯èƒ½çš„å‘å±•éœ€è¦äº†ï¼Œé‚£ä¹ˆï¼Œæ˜¯æ—¶å€™è¿›è¡Œå‡çº§æ¢ä»£äº†ã€‚</p><h2 id="äºŒã€çŸ¥è¯†è®²è§£"><a href="#äºŒã€çŸ¥è¯†è®²è§£" class="headerlink" title="äºŒã€çŸ¥è¯†è®²è§£"></a>äºŒã€çŸ¥è¯†è®²è§£</h2><h3 id="1ã€Kubernetes-å†…çš„ç½‘ç»œé€šä¿¡"><a href="#1ã€Kubernetes-å†…çš„ç½‘ç»œé€šä¿¡" class="headerlink" title="1ã€Kubernetes å†…çš„ç½‘ç»œé€šä¿¡"></a>1ã€Kubernetes å†…çš„ç½‘ç»œé€šä¿¡</h3><h4 id="1ï¼‰Container-é—´çš„é€šä¿¡"><a href="#1ï¼‰Container-é—´çš„é€šä¿¡" class="headerlink" title="1ï¼‰Container é—´çš„é€šä¿¡"></a>1ï¼‰Container é—´çš„é€šä¿¡</h4><p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ª K8S çš„ Pod ä¸­æ˜¯å¯ä»¥å­˜åœ¨å¤šä¸ªå®¹å™¨ï¼ˆContainerï¼‰çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ dockerã€Podman ä¹‹ç±»çš„ã€‚åœ¨åŒä¸€ä¸ª Pod å†…ï¼Œå®¹å™¨ä¹‹é—´å…±äº«ç½‘ç»œå‘½åç©ºé—´ï¼Œæ•…å…¶ä¹‹é—´é€šè¿‡ loopback å£å³å¯å®ç°é€šä¿¡ï¼ˆ127.0.0.1:Portï¼‰ï¼Œå…¶æ•´ä½“çš„ç½‘ç»œæ¨¡å¼ä»æ˜¯ç»§æ‰¿è‡ª docker ç½‘æ¡¥é€šä¿¡çš„æ€è·¯ï¼ŒPod å³ç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„å®¿ä¸»å¯¹è±¡ï¼Œä¸€ä¸ªè™šæ‹ŸåŒ–æ²™ç›’ï¼Œå…¶é€šä¿¡åŸç†å¦‚ä¸‹å›¾ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/K8S%20Container%E9%97%B4%E9%80%9A%E4%BF%A1.jpg" alt="K8S Containeré—´é€šä¿¡"></p><h4 id="2ï¼‰åŒèŠ‚ç‚¹-Pod-é—´çš„é€šä¿¡"><a href="#2ï¼‰åŒèŠ‚ç‚¹-Pod-é—´çš„é€šä¿¡" class="headerlink" title="2ï¼‰åŒèŠ‚ç‚¹ Pod é—´çš„é€šä¿¡"></a>2ï¼‰åŒèŠ‚ç‚¹ Pod é—´çš„é€šä¿¡</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/K8S%20%E5%90%8C%E8%8A%82%E7%82%B9Pod%E9%97%B4%E9%80%9A%E4%BF%A1.jpg" alt="K8S åŒèŠ‚ç‚¹Podé—´é€šä¿¡"></p><h4 id="3ï¼‰Pod-å’Œ-Service-é—´çš„é€šä¿¡"><a href="#3ï¼‰Pod-å’Œ-Service-é—´çš„é€šä¿¡" class="headerlink" title="3ï¼‰Pod å’Œ Service é—´çš„é€šä¿¡"></a>3ï¼‰Pod å’Œ Service é—´çš„é€šä¿¡</h4><h4 id="4ï¼‰Service-å’Œé›†ç¾¤å¤–éƒ¨çš„é€šä¿¡"><a href="#4ï¼‰Service-å’Œé›†ç¾¤å¤–éƒ¨çš„é€šä¿¡" class="headerlink" title="4ï¼‰Service å’Œé›†ç¾¤å¤–éƒ¨çš„é€šä¿¡"></a>4ï¼‰Service å’Œé›†ç¾¤å¤–éƒ¨çš„é€šä¿¡</h4><h4 id="5ï¼‰ä¸åŒèŠ‚ç‚¹-Pod-é—´é€šä¿¡"><a href="#5ï¼‰ä¸åŒèŠ‚ç‚¹-Pod-é—´é€šä¿¡" class="headerlink" title="5ï¼‰ä¸åŒèŠ‚ç‚¹ Pod é—´é€šä¿¡"></a>5ï¼‰ä¸åŒèŠ‚ç‚¹ Pod é—´é€šä¿¡</h4><h5 id="1-å…³äº-CNI"><a href="#1-å…³äº-CNI" class="headerlink" title="1. å…³äº CNI"></a>1. å…³äº CNI</h5><p>CNIï¼Œå³ Container Network Interfaceï¼ˆå®¹å™¨ç½‘ç»œæ¥å£ï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯ä¸€ç§ä¸ºå®¹å™¨å¹³å°çš„ç½‘ç»œæ‰€å»ºç«‹çš„æ ‡å‡†åè®®è§„èŒƒï¼Œä½¿ç”¨è¿™ç§æ ‡å‡†å¯ä»¥è®©ä¸åŒçš„å®¹å™¨å¹³å°ï¼ˆå¦‚ï¼ŒKubernetesã€Swarmã€Mesos ç­‰ï¼‰ï¼Œå¯ä»¥é€šè¿‡ç›¸åŒçš„æ¥å£è°ƒç”¨ä¸åŒçš„ç½‘ç»œæ’ä»¶ã€‚é›†ç¾¤å†…çš„è·¨èŠ‚ç‚¹é€šä¿¡æ¶‰åŠåˆ°äº†ä¸åŒå­ç½‘å†…çš„é€šä¿¡ï¼Œä»…é  docker0 æ˜¯æ— æ³•å®ç°çš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦å€ŸåŠ© CNI ç½‘ç»œæ’ä»¶æ¥å®ç°ã€‚</p><p>ç›®å‰ K8S æ‰€èƒ½å¤Ÿæ”¯æŒçš„ CNI ç»„ä»¶ç§ç±»å¾ˆå¤šï¼Œå¦‚ host-localã€bridgeã€dhcpã€flannelã€calicoã€ipvlanã€tuning vlan ç­‰ç­‰ï¼Œå…¶è™½ç„¶ç°åœ¨ K8S åœ¨å°è¯•æ¨åŠ¨ä½¿ç”¨ Podman æ¥å–ä»£ Dockerï¼Œä½†æ˜¯ç›®å‰å¸‚é¢ä¸Š Docker ä»ç„¶æ˜¯ K8S é›†ç¾¤æœ€ä¸»è¦çš„ Container æ–¹æ¡ˆï¼Œå› æ­¤ä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œåœ¨è¯´ K8S ç½‘ç»œæ–¹æ¡ˆçš„åŒæ—¶å…¶å®å°±æ˜¯åœ¨è¯´ Docker çš„ç½‘ç»œæ–¹æ¡ˆã€‚</p><h5 id="2-å…³äº-Docker-çš„è·¨èŠ‚ç‚¹é€šä¿¡æ¨¡å¼"><a href="#2-å…³äº-Docker-çš„è·¨èŠ‚ç‚¹é€šä¿¡æ¨¡å¼" class="headerlink" title="2. å…³äº Docker çš„è·¨èŠ‚ç‚¹é€šä¿¡æ¨¡å¼"></a>2. å…³äº Docker çš„è·¨èŠ‚ç‚¹é€šä¿¡æ¨¡å¼</h5><p>åœ¨ Docker ä¸­ï¼Œä¸»æµçš„è·¨èŠ‚ç‚¹é€šä¿¡æ–¹æ¡ˆä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><h6 id="1âƒ£ï¸-åŸºäºéš§é“çš„-overlay-ç½‘ç»œ"><a href="#1âƒ£ï¸-åŸºäºéš§é“çš„-overlay-ç½‘ç»œ" class="headerlink" title="1âƒ£ï¸ åŸºäºéš§é“çš„ overlay ç½‘ç»œ"></a>1âƒ£ï¸ åŸºäºéš§é“çš„ overlay ç½‘ç»œ</h6><p>Docker åŸç”Ÿçš„ overlay ç½‘ç»œæ˜¯åŸºäº vxlan éš§é“çš„æ–¹å¼å®ç°çš„ï¼Œæ–°ç‰ˆæœ¬çš„ flannel ç‰ˆæœ¬ä¹Ÿæ˜¯ä»¥è¿™ç§æ–¹å¼å®ç° overlay ç½‘ç»œçš„ã€‚</p><h6 id="2âƒ£ï¸-åŸºäºåŒ…å°è£…çš„-overlay-ç½‘ç»œ"><a href="#2âƒ£ï¸-åŸºäºåŒ…å°è£…çš„-overlay-ç½‘ç»œ" class="headerlink" title="2âƒ£ï¸ åŸºäºåŒ…å°è£…çš„ overlay ç½‘ç»œ"></a>2âƒ£ï¸ åŸºäºåŒ…å°è£…çš„ overlay ç½‘ç»œ</h6><p>åŸºäº UDP å°è£…ç­‰æ•°æ®åŒ…åŒ…è£…æ–¹å¼ï¼Œå®ç°è·¨ä¸»æœºç½‘ç»œï¼Œæ¯”å¦‚ weaveå’Œæ—©æœŸçš„ flannelã€‚</p><h6 id="3âƒ£ï¸-åŸºäºä¸‰å±‚å®ç°çš„-SDN-ç½‘ç»œ"><a href="#3âƒ£ï¸-åŸºäºä¸‰å±‚å®ç°çš„-SDN-ç½‘ç»œ" class="headerlink" title="3âƒ£ï¸ åŸºäºä¸‰å±‚å®ç°çš„ SDN ç½‘ç»œ"></a>3âƒ£ï¸ åŸºäºä¸‰å±‚å®ç°çš„ SDN ç½‘ç»œ</h6><p>åŸºäºä¸‰å±‚åè®®å’Œè·¯ç”±ï¼Œç›´æ¥åœ¨ä¸‰å±‚å®ç°è·¨ä¸»æœºç½‘ç»œï¼Œå¹¶ä¸”é€šè¿‡ iptables å®ç°ç½‘ç»œçš„å®‰å…¨éš”ç¦»ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ Project Calicoã€‚</p><h5 id="3-é€šä¿¡æ–¹å¼"><a href="#3-é€šä¿¡æ–¹å¼" class="headerlink" title="3. é€šä¿¡æ–¹å¼"></a>3. é€šä¿¡æ–¹å¼</h5><h3 id="2ã€Kubernetes-ç½‘ç»œç»„ä»¶ç®€ä»‹"><a href="#2ã€Kubernetes-ç½‘ç»œç»„ä»¶ç®€ä»‹" class="headerlink" title="2ã€Kubernetes ç½‘ç»œç»„ä»¶ç®€ä»‹"></a>2ã€Kubernetes ç½‘ç»œç»„ä»¶ç®€ä»‹</h3><h4 id="1ï¼‰å…³äº-Flannel"><a href="#1ï¼‰å…³äº-Flannel" class="headerlink" title="1ï¼‰å…³äº Flannel"></a>1ï¼‰å…³äº Flannel</h4><h4 id="2ï¼‰å…³äº-Calico"><a href="#2ï¼‰å…³äº-Calico" class="headerlink" title="2ï¼‰å…³äº Calico"></a>2ï¼‰å…³äº Calico</h4><h2 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h2>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é—®é¢˜è§£å†³æ–¹æ¡ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬5ç« ã€Ansible API</title>
    <link href="/2021/09/16/%E7%AC%AC5%E7%AB%A0%E3%80%81Ansible-API/"/>
    <url>/2021/09/16/%E7%AC%AC5%E7%AB%A0%E3%80%81Ansible-API/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬5ç« ã€Ansible-API"><a href="#ç¬¬5ç« ã€Ansible-API" class="headerlink" title="ç¬¬5ç« ã€Ansible API"></a>ç¬¬5ç« ã€Ansible API</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬4ç« ã€Ansible Roles</title>
    <link href="/2021/09/16/%E7%AC%AC4%E7%AB%A0%E3%80%81Ansible-Roles/"/>
    <url>/2021/09/16/%E7%AC%AC4%E7%AB%A0%E3%80%81Ansible-Roles/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬4ç« ã€Ansible-Roles"><a href="#ç¬¬4ç« ã€Ansible-Roles" class="headerlink" title="ç¬¬4ç« ã€Ansible Roles"></a>ç¬¬4ç« ã€Ansible Roles</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬3ç« ã€Ansible PlayBooks</title>
    <link href="/2021/09/16/%E7%AC%AC3%E7%AB%A0%E3%80%81Ansible-PlayBooks/"/>
    <url>/2021/09/16/%E7%AC%AC3%E7%AB%A0%E3%80%81Ansible-PlayBooks/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬3ç« ã€Ansible-PlayBooks"><a href="#ç¬¬3ç« ã€Ansible-PlayBooks" class="headerlink" title="ç¬¬3ç« ã€Ansible PlayBooks"></a>ç¬¬3ç« ã€Ansible PlayBooks</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬2ç« ã€Ansible Modules</title>
    <link href="/2021/09/16/%E7%AC%AC2%E7%AB%A0%E3%80%81Ansible-Modules/"/>
    <url>/2021/09/16/%E7%AC%AC2%E7%AB%A0%E3%80%81Ansible-Modules/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2ç« ã€Ansible-Modules"><a href="#ç¬¬2ç« ã€Ansible-Modules" class="headerlink" title="ç¬¬2ç« ã€Ansible Modules"></a>ç¬¬2ç« ã€Ansible Modules</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬1ç« ã€Ansible ç®€ä»‹</title>
    <link href="/2021/09/16/%E7%AC%AC1%E7%AB%A0%E3%80%81Ansible-%E7%AE%80%E4%BB%8B/"/>
    <url>/2021/09/16/%E7%AC%AC1%E7%AB%A0%E3%80%81Ansible-%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€Ansible-ç®€ä»‹"><a href="#ç¬¬1ç« ã€Ansible-ç®€ä»‹" class="headerlink" title="ç¬¬1ç« ã€Ansible ç®€ä»‹"></a>ç¬¬1ç« ã€Ansible ç®€ä»‹</h1><span id="more"></span><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/ansible.jpeg" alt="ansible"></p>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Ansible</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬2ç« ã€é€šè¿‡ client-go è°ƒç”¨ k8s api</title>
    <link href="/2021/09/16/%E7%AC%AC2%E7%AB%A0%E3%80%81%E9%80%9A%E8%BF%87-client-go-%E8%B0%83%E7%94%A8-k8s-api/"/>
    <url>/2021/09/16/%E7%AC%AC2%E7%AB%A0%E3%80%81%E9%80%9A%E8%BF%87-client-go-%E8%B0%83%E7%94%A8-k8s-api/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2ç« ã€é€šè¿‡-go-client-è°ƒç”¨-k8s-api"><a href="#ç¬¬2ç« ã€é€šè¿‡-go-client-è°ƒç”¨-k8s-api" class="headerlink" title="ç¬¬2ç« ã€é€šè¿‡ go-client è°ƒç”¨ k8s api"></a>ç¬¬2ç« ã€é€šè¿‡ go-client è°ƒç”¨ k8s api</h1><span id="more"></span><h2 id="ä¸€ã€client-go-ç®€ä»‹"><a href="#ä¸€ã€client-go-ç®€ä»‹" class="headerlink" title="ä¸€ã€client-go ç®€ä»‹"></a>ä¸€ã€client-go ç®€ä»‹</h2><h3 id="1ã€client-go-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€client-go-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€client-go æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€client-go æ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote><p>ğŸš© <strong>å®˜æ–¹è§£é‡Š:</strong></p><p>Go clients for talking to a kubernetes cluster.</p><p><a href="https://github.com/kubernetes/client-go">å®˜æ–¹ github</a></p></blockquote><p>ç®€å•çš„è¯´ï¼Œclient-go å°±æ˜¯ kubernetes å®˜æ–¹æä¾›çš„ Goè¯­è¨€ SDKï¼Œç±»ä¼¼çš„è¿˜æœ‰ javaã€python ç­‰è¯­è¨€çš„client SDKï¼Œä¸è¿‡ client-go æ˜¯å…¶ä¸­æœ€å¤è€çš„ä¸€ä¸ªï¼Œæ¯•ç«Ÿ K8S æœ¬èº«åŸºäº Goå¼€å‘çš„ã€‚å¹¶ä¸”ï¼Œclient-go æ²¡æœ‰ä½¿ç”¨ Swagger ç”Ÿæˆå™¨ï¼Œè€Œæ˜¯ä½¿ç”¨äº† K8S æºä»£ç çš„ç”Ÿæˆå·¥å…·ï¼Œè¿™ä½¿å¾—ä½¿ç”¨ client-go ç”Ÿæˆçš„ä¼šæ˜¯ K8S é£æ ¼çš„å¯¹è±¡å’Œåºåˆ—åŒ–ç¨‹åºã€‚</p><p>äº‹å®ä¸Šï¼Œclient-go æ˜¯ä¸€ç»„åŒ…çš„é›†åˆï¼Œæä¾›äº†å››ç§è®¿é—® APIserver çš„æ–¹å¼ï¼ˆä» REST é£æ ¼åŸè¯­åˆ°å¤æ‚ clientï¼‰ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„ API ä»¥æ­¤æ»¡è¶³ä¸åŒç¨‹åº¦çš„ç¼–ç¨‹éœ€æ±‚ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/client-go%E7%BB%93%E6%9E%84.jpg" alt="client-goç»“æ„"></p><h3 id="2ã€client-go-å¯ä»¥åšä»€ä¹ˆï¼Ÿ"><a href="#2ã€client-go-å¯ä»¥åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€client-go å¯ä»¥åšä»€ä¹ˆï¼Ÿ"></a>2ã€client-go å¯ä»¥åšä»€ä¹ˆï¼Ÿ</h3><p>é¦–å…ˆï¼Œé€šè¿‡ client-go çš„ client ï¼ŒGo åº”ç”¨å°±å¯ä»¥è®¿é—® Kubernetes çš„ APIserverï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼å¯¹ kubernetes çš„èµ„æºè¿›è¡Œ crud æ“ä½œäº†ã€‚</p><p>å…¶æ¬¡ï¼Œclient-go è¿˜ä¸º controller å’Œ operator æä¾›äº†é‡è¦çš„æ”¯æŒï¼Œä½¿å¾—è‡ªå®šä¹‰å®¢æˆ·ç«¯ï¼ˆä¹Ÿæ˜¯ç±» kubectl å·¥å…·ï¼‰æˆä¸ºå¯èƒ½ã€‚å¦‚ä¸‹å›¾ï¼Œä½¿ç”¨ client-go çš„ informer æœºåˆ¶å°±å¯ä»¥å°† controller å…³æ³¨çš„èµ„æºå˜åŒ–åŠæ—¶åé¦ˆå›æ¥ï¼Œä½¿å¾— controller èƒ½å¤ŸåŠæ—¶å¾—å»å“åº”å˜åŒ–ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/client-go%20%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.jpeg" alt="client-go å·¥ä½œåŸç†"></p><h3 id="3ã€ç¯å¢ƒè¯´æ˜"><a href="#3ã€ç¯å¢ƒè¯´æ˜" class="headerlink" title="3ã€ç¯å¢ƒè¯´æ˜"></a>3ã€ç¯å¢ƒè¯´æ˜</h3><h4 id="1ï¼‰å­¦ä¹ -client-go-é‡è¦å‰ææ¡ä»¶"><a href="#1ï¼‰å­¦ä¹ -client-go-é‡è¦å‰ææ¡ä»¶" class="headerlink" title="1ï¼‰å­¦ä¹  client-go é‡è¦å‰ææ¡ä»¶"></a>1ï¼‰å­¦ä¹  client-go é‡è¦å‰ææ¡ä»¶</h4><ul><li>äº†è§£å¹¶æŒæ¡ K8S çš„åŸºæœ¬åŸç†å’Œæ“ä½œ</li><li>äº†è§£å¹¶æŒæ¡ K8S çš„ Groupã€Versionã€Resource ç­‰æ¦‚å¿µ</li></ul><h4 id="2ï¼‰ç¯å¢ƒä¿¡æ¯"><a href="#2ï¼‰ç¯å¢ƒä¿¡æ¯" class="headerlink" title="2ï¼‰ç¯å¢ƒä¿¡æ¯"></a>2ï¼‰ç¯å¢ƒä¿¡æ¯</h4><ul><li>K8S é›†ç¾¤ï¼ˆminikubeï¼‰ï¼Œç‰ˆæœ¬ä¸º 1.18.18</li><li>æœ¬åœ°ç¼–ç ç¯å¢ƒä¸º macOS Catalina(10.15.7) </li><li>Go ç‰ˆæœ¬ä¸º 1.16.7</li><li>IDE ä¸º VSCode</li></ul><h3 id="4ã€å®‰è£…-client-go"><a href="#4ã€å®‰è£…-client-go" class="headerlink" title="4ã€å®‰è£… client-go"></a>4ã€å®‰è£… client-go</h3><h4 id="1ï¼‰client-go-å’Œ-k8s-ç‰ˆæœ¬å¯¹åº”å…³ç³»è¡¨"><a href="#1ï¼‰client-go-å’Œ-k8s-ç‰ˆæœ¬å¯¹åº”å…³ç³»è¡¨" class="headerlink" title="1ï¼‰client-go å’Œ k8s ç‰ˆæœ¬å¯¹åº”å…³ç³»è¡¨"></a>1ï¼‰client-go å’Œ k8s ç‰ˆæœ¬å¯¹åº”å…³ç³»è¡¨</h4><table><thead><tr><th>Kubernetes 1.15</th><th>Kubernetes 1.16</th><th>Kubernetes 1.17</th><th>Kubernetes 1.18</th><th>Kubernetes 1.19</th><th>Kubernetes 1.20</th><th></th></tr></thead><tbody><tr><td><code>kubernetes-1.15.0</code></td><td>âœ“</td><td>+-</td><td>+-</td><td>+-</td><td>+-</td><td>+-</td></tr><tr><td><code>kubernetes-1.16.0</code></td><td>+-</td><td>âœ“</td><td>+-</td><td>+-</td><td>+-</td><td>+-</td></tr><tr><td><code>kubernetes-1.17.0</code>/<code>v0.17.0</code></td><td>+-</td><td>+-</td><td>âœ“</td><td>+-</td><td>+-</td><td>+-</td></tr><tr><td><code>kubernetes-1.18.0</code>/<code>v0.18.0</code></td><td>+-</td><td>+-</td><td>+-</td><td>âœ“</td><td>+-</td><td>+-</td></tr><tr><td><code>kubernetes-1.19.0</code>/<code>v0.19.0</code></td><td>+-</td><td>+-</td><td>+-</td><td>+-</td><td>âœ“</td><td>+-</td></tr><tr><td><code>kubernetes-1.20.0</code>/<code>v0.20.0</code></td><td>+-</td><td>+-</td><td>+-</td><td>+-</td><td>+-</td><td>âœ“</td></tr><tr><td><code>HEAD</code></td><td>+-</td><td>+-</td><td>+-</td><td>+-</td><td>+-</td><td>+-</td></tr></tbody></table><h4 id="2ï¼‰å¦‚ä½•é€‰æ‹©ç‰ˆæœ¬"><a href="#2ï¼‰å¦‚ä½•é€‰æ‹©ç‰ˆæœ¬" class="headerlink" title="2ï¼‰å¦‚ä½•é€‰æ‹©ç‰ˆæœ¬"></a>2ï¼‰å¦‚ä½•é€‰æ‹©ç‰ˆæœ¬</h4><h5 id="1-k8s-ç‰ˆæœ¬-gt-v1-17-0"><a href="#1-k8s-ç‰ˆæœ¬-gt-v1-17-0" class="headerlink" title="1. k8s ç‰ˆæœ¬ &gt;= v1.17.0"></a>1. k8s ç‰ˆæœ¬ &gt;= v1.17.0</h5><p>é’ˆå¯¹ 1.17.0 ç‰ˆæœ¬æˆ–ä»¥ä¸Šçš„ k8s é›†ç¾¤ï¼Œclient-go çš„é…ç½®é¡¹ç‰ˆæœ¬å·å½¢å¼ä¸º <code>v0.x.y</code>ï¼Œæ¯”å¦‚ <code>k8s.io/client-go@v0.20.4</code>ï¼Œå¯¹åº”çš„ k8s ç‰ˆæœ¬ä¸º <code>v1.20.4</code>ã€‚</p><h5 id="2-k8s-ç‰ˆæœ¬-lt-v1-17-0"><a href="#2-k8s-ç‰ˆæœ¬-lt-v1-17-0" class="headerlink" title="2. k8s ç‰ˆæœ¬ &lt; v1.17.0"></a>2. k8s ç‰ˆæœ¬ &lt; v1.17.0</h5><p>é’ˆå¯¹ 1.17.0 ä»¥ä¸‹ç‰ˆæœ¬çš„ k8s é›†ç¾¤ï¼Œclient-go çš„é…ç½®é¡¹ç‰ˆæœ¬å·å½¢å¼ä¸º <code>kubernetes-1.x.y</code>ï¼Œæ¯”å¦‚ <code>k8s.io/client-go@kubernetes-1.16.3</code>ï¼Œå¯¹åº”çš„ k8s ç‰ˆæœ¬ä¸º <code>v1.16.3</code>ã€‚</p><h4 id="3ï¼‰è·å–-client-go"><a href="#3ï¼‰è·å–-client-go" class="headerlink" title="3ï¼‰è·å– client-go"></a>3ï¼‰è·å– client-go</h4><blockquote><p>ğŸš© æœ¬æ–‡æ‰€ç”¨ç¯å¢ƒçš„ k8s ç‰ˆæœ¬ä¸º v1.18.18</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">go get k8s.io/apimachinery@v0.18.18<br>go get k8s.io/client-go@v0.18.18<br></code></pre></td></tr></table></figure><h2 id="äºŒã€kubeconfig-ç®¡ç†"><a href="#äºŒã€kubeconfig-ç®¡ç†" class="headerlink" title="äºŒã€kubeconfig ç®¡ç†"></a>äºŒã€kubeconfig ç®¡ç†</h2><h3 id="1ã€RBAC-æˆæƒ"><a href="#1ã€RBAC-æˆæƒ" class="headerlink" title="1ã€RBAC æˆæƒ"></a>1ã€RBAC æˆæƒ</h3><h4 id="1ï¼‰åŸºäº-ServiceAccount-ClusterRole-æˆæƒ"><a href="#1ï¼‰åŸºäº-ServiceAccount-ClusterRole-æˆæƒ" class="headerlink" title="1ï¼‰åŸºäº ServiceAccount - ClusterRole æˆæƒ"></a>1ï¼‰åŸºäº ServiceAccount - ClusterRole æˆæƒ</h4><p>æ–°å»ºæ–‡ä»¶ <code>apiadmin-rbac.yaml</code>ï¼Œæˆæƒå¸¸ç”¨èµ„æºçš„ crud æƒé™ï¼ˆæ ¹æ®å®é™…æƒ…å†µå¢æ”¹ï¼‰ï¼Œå…·ä½“æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-clusterrole</span><br><span class="hljs-attr">rules:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;configmaps&quot;</span>, <span class="hljs-string">&quot;secrets&quot;</span>, <span class="hljs-string">&quot;nodes&quot;</span>, <span class="hljs-string">&quot;pods&quot;</span>, <span class="hljs-string">&quot;services&quot;</span>, <span class="hljs-string">&quot;resourcequotas&quot;</span>, <span class="hljs-string">&quot;replicationcontrollers&quot;</span>, <span class="hljs-string">&quot;limitranges&quot;</span>, <span class="hljs-string">&quot;persistentvolumeclaims&quot;</span>, <span class="hljs-string">&quot;persistentvolumes&quot;</span>, <span class="hljs-string">&quot;namespaces&quot;</span>, <span class="hljs-string">&quot;endpoints&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;extensions&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;daemonsets&quot;</span>, <span class="hljs-string">&quot;deployments&quot;</span>, <span class="hljs-string">&quot;replicasets&quot;</span>, <span class="hljs-string">&quot;ingresses&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;apps&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;statefulsets&quot;</span>, <span class="hljs-string">&quot;daemonsets&quot;</span>, <span class="hljs-string">&quot;deployments&quot;</span>, <span class="hljs-string">&quot;replicasets&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;batch&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;cronjobs&quot;</span>, <span class="hljs-string">&quot;jobs&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-clusterrole-binding</span><br><span class="hljs-attr">subjects:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-clusterrole</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç”Ÿæ•ˆæ–‡ä»¶ï¼Œåˆ›å»ºrbacè§„åˆ™"><a href="#2ï¼‰ç”Ÿæ•ˆæ–‡ä»¶ï¼Œåˆ›å»ºrbacè§„åˆ™" class="headerlink" title="2ï¼‰ç”Ÿæ•ˆæ–‡ä»¶ï¼Œåˆ›å»ºrbacè§„åˆ™"></a>2ï¼‰ç”Ÿæ•ˆæ–‡ä»¶ï¼Œåˆ›å»ºrbacè§„åˆ™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl apply -f apiadmin-rbac.yaml<br></code></pre></td></tr></table></figure><h5 id="æƒé™å®¡è®¡"><a href="#æƒé™å®¡è®¡" class="headerlink" title="æƒé™å®¡è®¡:"></a>æƒé™å®¡è®¡:</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl auth can-i create configmap --as=system:serviceaccount:default:apiadmin -n $&#123;NAMESPACE&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€ç¼–å†™-kubeconfig"><a href="#2ã€ç¼–å†™-kubeconfig" class="headerlink" title="2ã€ç¼–å†™ kubeconfig"></a>2ã€ç¼–å†™ kubeconfig</h3><h4 id="1ï¼‰kubeconfig-ä¸­çš„åŸºç¡€æ¦‚å¿µ"><a href="#1ï¼‰kubeconfig-ä¸­çš„åŸºç¡€æ¦‚å¿µ" class="headerlink" title="1ï¼‰kubeconfig ä¸­çš„åŸºç¡€æ¦‚å¿µ"></a>1ï¼‰kubeconfig ä¸­çš„åŸºç¡€æ¦‚å¿µ</h4><blockquote><p>ğŸŒˆ <strong>kubeconfig æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å¼€å¯äº† TLS çš„ K8S é›†ç¾¤ä¸­ï¼Œæ¯ä¸€æ¬¡ä¸é›†ç¾¤çš„äº¤äº’éƒ½éœ€è¦è¿›è¡Œèº«ä»½è®¤è¯ï¼Œè€Œ kubeconfig å®é™…ä¸Šå°±æ˜¯ K8S é›†ç¾¤ä¸­ä¸€ä¸ªåŒ…å«äº†é›†ç¾¤ã€ç”¨æˆ·ã€namespaceã€è®¤è¯æœºåˆ¶ä¿¡æ¯çš„é…ç½®æ–‡ä»¶ã€‚å®ƒé»˜è®¤ç”Ÿæˆåœ¨ <code>$HOME/.kube</code> ç›®å½•ä¸‹ï¼Œå¹¶ä¸” <code>kubectl</code> é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šä¼˜å…ˆæŸ¥æ‰¾è¯¥ç›®å½•ä¸‹åä¸º <code>config</code> çš„æ–‡ä»¶ï¼ŒåŠ è½½å…¶ä¸­çš„é›†ç¾¤è®¿é—®è®¤è¯é…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ <code>KUBECONFIG</code> æŒ‡å®šå…¶ä»– kubeconfig ã€‚</p><p>K8S çš„ç»„ä»¶å¯ä»¥ä½¿ç”¨ kubeconfig è¿æ¥ APIserverï¼ˆæ¯”å¦‚ bootstrap.kubeconfigï¼‰ï¼Œclient-goã€operatorã€helm ç­‰ä¹Ÿå¯ä»¥ä½¿ç”¨ kubeconfig è®¿é—® APIserverã€‚</p></blockquote><h5 id="1-ä¸€ä¸ª-kubeconfig-çš„åŸºæœ¬ç»“æ„ï¼ˆä»¥-minikube-ä¸ºä¾‹ï¼‰"><a href="#1-ä¸€ä¸ª-kubeconfig-çš„åŸºæœ¬ç»“æ„ï¼ˆä»¥-minikube-ä¸ºä¾‹ï¼‰" class="headerlink" title="1. ä¸€ä¸ª kubeconfig çš„åŸºæœ¬ç»“æ„ï¼ˆä»¥ minikube ä¸ºä¾‹ï¼‰"></a>1. ä¸€ä¸ª kubeconfig çš„åŸºæœ¬ç»“æ„ï¼ˆä»¥ minikube ä¸ºä¾‹ï¼‰</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority:</span> <span class="hljs-string">/Users/Tareya/.minikube/ca.crt</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://127.0.0.1:32769</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">minikube</span><br><span class="hljs-attr">contexts:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">context:</span><br>    <span class="hljs-attr">cluster:</span> <span class="hljs-string">minikube</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">minikube</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">minikube</span><br><span class="hljs-attr">current-context:</span> <span class="hljs-string">minikube</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span><br><span class="hljs-attr">preferences:</span> &#123;&#125;<br><span class="hljs-attr">users:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">minikube</span><br>  <span class="hljs-attr">user:</span><br>    <span class="hljs-attr">client-certificate:</span> <span class="hljs-string">/Users/Tareya/.minikube/profiles/minikube/client.crt</span><br>    <span class="hljs-attr">client-key:</span> <span class="hljs-string">/Users/Tareya/.minikube/profiles/minikube/client.key</span><br></code></pre></td></tr></table></figure><h5 id="2-é›†ç¾¤æ¨¡å—-â€”â€”-clusters"><a href="#2-é›†ç¾¤æ¨¡å—-â€”â€”-clusters" class="headerlink" title="2. é›†ç¾¤æ¨¡å— â€”â€” clusters"></a>2. é›†ç¾¤æ¨¡å— â€”â€” clusters</h5><blockquote><p>å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œclusters æ¨¡å—æ ¹æ® yaml è¯­æ³•æ¥è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªå¯åŒ…å«å¤šä¸ª cluster ä¿¡æ¯çš„åˆ—è¡¨ã€‚æ¯ä¸€ä¸ª cluster éƒ½éœ€è¦åŒ…å« K8S é›†ç¾¤çš„ç«¯ç‚¹ä¿¡æ¯ã€‚</p><ul><li>server: K8S çš„ apiserver çš„å®Œæ•´ urlï¼ˆ<a href="https://xxx:6443ï¼‰">https://xxx:6443ï¼‰</a></li><li>certificate-authority: K8S é›†ç¾¤çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCA è¯ä¹¦æˆ–è¯ä¹¦è§£ç æ•°æ®ï¼‰<ul><li>è¯ä¹¦å½¢å¼: certificate-authority: xxx/ca.crt</li><li>è§£ç æ•°æ®å½¢å¼: certificate-authority-data: xxx</li></ul></li></ul></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ·»åŠ æˆ–ä¿®æ”¹ cluster æ¡ç›®</span><br>kubectl config set-cluster<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤ cluster æ¡ç›®</span><br>kubectl config unset cluster.&lt;cluster_name&gt;<br></code></pre></td></tr></table></figure><h5 id="3-ç”¨æˆ·æ¨¡å—-â€”â€”-users"><a href="#3-ç”¨æˆ·æ¨¡å—-â€”â€”-users" class="headerlink" title="3. ç”¨æˆ·æ¨¡å— â€”â€” users"></a>3. ç”¨æˆ·æ¨¡å— â€”â€” users</h5><blockquote><p>users æ¨¡å—ï¼Œå®šä¹‰çš„æ˜¯ç”¨äºå‘ K8S é›†ç¾¤è¿›è¡Œèº«ä»½éªŒè¯çš„å®¢æˆ·ç«¯å‡­è¯</p><p>å¯ç”¨å‡­è¯ç±»å‹æœ‰ï¼š</p><ul><li>username/password</li><li>client-certificate/client-key</li><li>client-certificate-data/client-key-data</li><li>token</li></ul><p>å…¶ä¸­ï¼Œç”¨æˆ·å/å¯†ç çš„åŸºç¡€è®¤è¯ å’Œ token è®¤è¯ä¸¤è€…åªèƒ½å–å…¶ä¸€ï¼›è€Œ client-certificate å’Œ client-key åˆ™å¯ä»¥åˆ†åˆ«ä¸å…¶ä¸€ç»„åˆã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ·»åŠ æˆ–ä¿®æ”¹ user æ¡ç›®</span><br>kubectl config set-credentials <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤ user æ¡ç›®</span><br>kubectl config unset user.&lt;user_name&gt;<br></code></pre></td></tr></table></figure><h5 id="4-ä¸Šä¸‹æ–‡æ¨¡å—-â€”â€”-contexts"><a href="#4-ä¸Šä¸‹æ–‡æ¨¡å—-â€”â€”-contexts" class="headerlink" title="4. ä¸Šä¸‹æ–‡æ¨¡å— â€”â€” contexts"></a>4. ä¸Šä¸‹æ–‡æ¨¡å— â€”â€” contexts</h5><blockquote><p>contexts æ¨¡å—ï¼Œå³ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæä¾›äº†ä¸€ä¸ªåŒ…å«äº† clusterã€namesapce å’Œ user å…³ç³»çš„å…ƒç»„ã€‚é€šè¿‡ contextï¼Œä½¿ç”¨æŒ‡å®šçš„è®¤è¯ä¿¡æ¯å’Œå‘½åç©ºé—´å°†è¯·æ±‚å‘é€åˆ°é›†ç¾¤ã€‚clusterã€namespaceã€user ä¸‰ä¸ªå…ƒç´ ä¸­ä»»æ„ä¸€ä¸ªå³å¯æŒ‡å®šä¸Šä¸‹æ–‡ï¼ŒæœªæŒ‡å®šçš„å€¼åˆ™ä¼šè¢«æ›¿æ¢æˆé»˜è®¤å€¼ã€‚</p><p><strong>current-context</strong></p><p>current-context æ˜¯ kubectl åœ¨åŠ è½½é…ç½®æ—¶é»˜è®¤ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œé»˜è®¤ä¸º cluster1-contextï¼ˆæ’åºç¬¬ä¸€çš„é›†ç¾¤ï¼‰</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ·»åŠ æˆ–ä¿®æ”¹ context æ¡ç›®</span><br>kubectl config set-context<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤ context æ¡ç›®</span><br>kubectl config unset context.&lt;context_name&gt;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ä½¿ç”¨ context</span><br>kubectl config use-context <br></code></pre></td></tr></table></figure><h4 id="2ï¼‰è‡ªå®šä¹‰ä¸€ä¸ª-kubeconfig"><a href="#2ï¼‰è‡ªå®šä¹‰ä¸€ä¸ª-kubeconfig" class="headerlink" title="2ï¼‰è‡ªå®šä¹‰ä¸€ä¸ª kubeconfig"></a>2ï¼‰è‡ªå®šä¹‰ä¸€ä¸ª kubeconfig</h4><h5 id="1-è·å–-ServiceAccount-ç›¸å…³ä¿¡æ¯"><a href="#1-è·å–-ServiceAccount-ç›¸å…³ä¿¡æ¯" class="headerlink" title="1. è·å– ServiceAccount ç›¸å…³ä¿¡æ¯"></a>1. è·å– ServiceAccount ç›¸å…³ä¿¡æ¯</h5><p>ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è·å–ä¸Šæ–‡ rbac æˆæƒçš„ ServiceAccount çš„ token ä»¥åŠé›†ç¾¤ç›¸å…³ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">SECRET=$(kubectl get serviceaccount apiadmin -ojsonpath=&#x27;&#123;.secrets[0].name&#125;&#x27;)<br>TOKEN=$(kubectl get secret $&#123;SECRET&#125; -ojsonpath=&#x27;&#123;.data.token&#125;&#x27;|base64 -d)<br>CA=$(kubectl get secret $&#123;SECRET&#125; -o jsonpath=&quot;&#123;.data[&#x27;ca\.crt&#x27;]&#125;&quot;)<br>APISERVER=https://$(kubectl -n default get endpoints kubernetes --no-headers | awk -F &quot;[, ]+&quot; &#x27;&#123;print $2&#125;&#x27;)<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºé›†ç¾¤ä¿¡æ¯"><a href="#2-åˆ›å»ºé›†ç¾¤ä¿¡æ¯" class="headerlink" title="2. åˆ›å»ºé›†ç¾¤ä¿¡æ¯"></a>2. åˆ›å»ºé›†ç¾¤ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config set-cluster kubernetes --certificate-authority=./kubernetes/ssl/ca.pem --embed-certs=true --server=https://$&#123;APISERVER&#125;:6443<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆæ–‡ä»¶è·¯å¾„: <code>~/.kube/config</code>ï¼Œæ–‡ä»¶å†…å®¹ç±»ä¼¼ä¸‹é¢çš„å½¢å¼ï¼Œå…·ä½“å†…å®¹ä»¥å˜é‡æ–¹å¼éšå»äº†: </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority-data:</span> <span class="hljs-string">$&#123;CA&#125;</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://$&#123;APISERVER&#125;:6443</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes</span><br><span class="hljs-attr">contexts:</span> []<br><span class="hljs-attr">current-context:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span><br><span class="hljs-attr">preferences:</span> &#123;&#125;<br><span class="hljs-attr">users:</span> []<br></code></pre></td></tr></table></figure><blockquote><p>è¿™ä¸€æ­¥ï¼Œä¸»è¦éœ€è¦ ca è¯ä¹¦ base64 è½¬åŒ–åçš„ <code>certificate-authority-data</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦å†é€šè¿‡ ca è¯ä¹¦æ–‡ä»¶è¿›è¡Œè®¤è¯äº†ã€‚å…¶ä¸»è¦æ€è·¯å°±æ˜¯ä» ServiceAccount ç›¸åº”çš„ secret çš„ json ä¸­è·å–å¯¹åº”çš„ä¿¡æ¯ã€‚</p></blockquote><h5 id="3-åˆ›å»ºç”¨æˆ·è®¤è¯ä¿¡æ¯"><a href="#3-åˆ›å»ºç”¨æˆ·è®¤è¯ä¿¡æ¯" class="headerlink" title="3. åˆ›å»ºç”¨æˆ·è®¤è¯ä¿¡æ¯"></a>3. åˆ›å»ºç”¨æˆ·è®¤è¯ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config set-credentials apiadmin --token=$&#123;TOKEN&#125;<br></code></pre></td></tr></table></figure><p>æ›´æ–°çš„æ–‡ä»¶å†…å®¹ç±»ä¼¼ä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority-data:</span> <span class="hljs-string">$&#123;CA&#125;</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://$&#123;APISERVER&#125;:6443</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes</span><br><span class="hljs-attr">contexts:</span> []<br><span class="hljs-attr">current-context:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span><br><span class="hljs-attr">preferences:</span> &#123;&#125;<br><span class="hljs-attr">users:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">user:</span><br>    <span class="hljs-attr">token:</span> <span class="hljs-string">$&#123;TOKEN&#125;</span><br></code></pre></td></tr></table></figure><h5 id="4-åˆ›å»ºä¸Šä¸‹æ–‡ä¿¡æ¯"><a href="#4-åˆ›å»ºä¸Šä¸‹æ–‡ä¿¡æ¯" class="headerlink" title="4. åˆ›å»ºä¸Šä¸‹æ–‡ä¿¡æ¯"></a>4. åˆ›å»ºä¸Šä¸‹æ–‡ä¿¡æ¯</h5><blockquote><p>ç”±äºæˆ‘ä»¬åˆ›å»ºçš„ ServiceAccount ç»‘å®šçš„æ˜¯é›†ç¾¤èµ„æºçº§åˆ«çš„ ClusterRoleï¼Œæ‰€ä»¥ä¸éœ€è¦è®¾ç½® namespaceï¼Œå¦‚éœ€æ·»åŠ åˆ™ä½¿ç”¨ <code>--namespace</code> å‚æ•°ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config set-context apiadmin-context --cluster=kubernetes --user=apiadmin <br></code></pre></td></tr></table></figure><p>æ›´æ–°çš„æ–‡ä»¶å†…å®¹ç±»ä¼¼ä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority-data:</span> <span class="hljs-string">$&#123;CA&#125;</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://$&#123;APISERVER&#125;:6443</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes</span><br><span class="hljs-attr">contexts:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">context:</span><br>    <span class="hljs-attr">cluster:</span> <span class="hljs-string">kubernetes</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-context</span><br><span class="hljs-attr">current-context:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span><br><span class="hljs-attr">preferences:</span> &#123;&#125;<br><span class="hljs-attr">users:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">user:</span><br>    <span class="hljs-attr">token:</span> <span class="hljs-string">$&#123;TOKEN&#125;</span><br></code></pre></td></tr></table></figure><h5 id="5-ä½¿ç”¨context"><a href="#5-ä½¿ç”¨context" class="headerlink" title="5. ä½¿ç”¨context"></a>5. ä½¿ç”¨context</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config use-context apiadmin-context<br></code></pre></td></tr></table></figure><h5 id="6-æŸ¥çœ‹-current-context"><a href="#6-æŸ¥çœ‹-current-context" class="headerlink" title="6. æŸ¥çœ‹ current-context"></a>6. æŸ¥çœ‹ <code>current-context</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config view<br></code></pre></td></tr></table></figure><p>è¿”å›å†…å®¹ç±»ä¼¼ä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority-data:</span> <span class="hljs-string">$&#123;CA&#125;</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://$&#123;APISERVER&#125;:6443</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes</span><br><span class="hljs-attr">contexts:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">context:</span><br>    <span class="hljs-attr">cluster:</span> <span class="hljs-string">kubernetes</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-context</span><br><span class="hljs-attr">current-context:</span> <span class="hljs-string">apiadmin-context</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span><br><span class="hljs-attr">preferences:</span> &#123;&#125;<br><span class="hljs-attr">users:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">user:</span><br>    <span class="hljs-attr">token:</span> <span class="hljs-string">$&#123;TOKEN&#125;</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰è¯ä¹¦è½¬åŒ–è¯ä¹¦æ•°æ®"><a href="#3ï¼‰è¯ä¹¦è½¬åŒ–è¯ä¹¦æ•°æ®" class="headerlink" title="3ï¼‰è¯ä¹¦è½¬åŒ–è¯ä¹¦æ•°æ®"></a>3ï¼‰è¯ä¹¦è½¬åŒ–è¯ä¹¦æ•°æ®</h4><blockquote><p>ğŸš© Kubeconfig ä¸­ä½¿ç”¨çš„è¯ä¹¦æ•°æ®å®é™…å°±æ˜¯å°†è¯ä¹¦å†…å®¹è¿›è¡Œ base64 è½¬ç </p></blockquote><h5 id="1-è·å–-ca-è¯ä¹¦æ•°æ®"><a href="#1-è·å–-ca-è¯ä¹¦æ•°æ®" class="headerlink" title="1. è·å– ca è¯ä¹¦æ•°æ®"></a>1. è·å– ca è¯ä¹¦æ•°æ®</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">SECRET=$(kubectl get serviceaccount default -ojsonpath=&#x27;&#123;.secrets[0].name&#125;&#x27;)<br>CA=$(kubectl get secret $&#123;SECRET&#125; -o jsonpath=&quot;&#123;.data[&#x27;ca\.crt&#x27;]&#125;&quot;)<br></code></pre></td></tr></table></figure><h5 id="2-è·å–-client-crt-è¯ä¹¦æ•°æ®"><a href="#2-è·å–-client-crt-è¯ä¹¦æ•°æ®" class="headerlink" title="2. è·å– client.crt è¯ä¹¦æ•°æ®"></a>2. è·å– client.crt è¯ä¹¦æ•°æ®</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat client.crt | base64 <br></code></pre></td></tr></table></figure><h5 id="3-è·å–-client-key-è¯ä¹¦æ•°æ®"><a href="#3-è·å–-client-key-è¯ä¹¦æ•°æ®" class="headerlink" title="3. è·å– client.key è¯ä¹¦æ•°æ®"></a>3. è·å– client.key è¯ä¹¦æ•°æ®</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat client.key | base64 <br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€è¿æ¥-API-Sever"><a href="#ä¸‰ã€è¿æ¥-API-Sever" class="headerlink" title="ä¸‰ã€è¿æ¥ API Sever"></a>ä¸‰ã€è¿æ¥ API Sever</h2><h3 id="1ã€é›†ç¾¤å¤–è¯»å–é…ç½®æ–‡ä»¶"><a href="#1ã€é›†ç¾¤å¤–è¯»å–é…ç½®æ–‡ä»¶" class="headerlink" title="1ã€é›†ç¾¤å¤–è¯»å–é…ç½®æ–‡ä»¶"></a>1ã€é›†ç¾¤å¤–è¯»å–é…ç½®æ–‡ä»¶</h3><blockquote><p>ğŸš© å¦‚æœä»£ç è¿è¡Œåœ¨ K8S é›†ç¾¤ä¹‹å¤–ï¼Œå¯ä»¥æ¯”è¾ƒç®€å•çš„é€šè¿‡ <code>clientcmd.BuildConfigFromFlags(&quot;&quot;, ConfigFile)</code>  æ–¹æ³•æ¥è¯»å–é›†ç¾¤å¤–çš„ <code>kubeconfig</code>ï¼Œä»æœªå®ç°è¿æ¥ API Serverã€‚ </p></blockquote><h4 id="1ï¼‰ä½¿ç”¨æœ¬åœ°çš„-kubeconfig-ç¤ºä¾‹"><a href="#1ï¼‰ä½¿ç”¨æœ¬åœ°çš„-kubeconfig-ç¤ºä¾‹" class="headerlink" title="1ï¼‰ä½¿ç”¨æœ¬åœ°çš„ kubeconfig ç¤ºä¾‹"></a>1ï¼‰ä½¿ç”¨æœ¬åœ°çš„ kubeconfig ç¤ºä¾‹</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go">...<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><br>  <span class="hljs-string">&quot;k8s.io/client-go/tools/clientcmd&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>kubeconfig := filepath.Join(<br>os.Getenv(<span class="hljs-string">&quot;HOME&quot;</span>), <span class="hljs-string">&quot;.kube&quot;</span>, <span class="hljs-string">&quot;config&quot;</span>,<br>)<br><br>config, err := clientcmd.BuildConfigFromFlags(<span class="hljs-string">&quot;&quot;</span>, kubeconfig)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>  <br>  fmt.Println(config) <span class="hljs-comment">// æ‰“å°é…ç½®</span><br>  <br>  <span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ç¤ºä¾‹"><a href="#2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ç¤ºä¾‹" class="headerlink" title="2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ç¤ºä¾‹"></a>2ï¼‰ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ç¤ºä¾‹</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// init client</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> (<br>restconf *rest.Config<br>err      error<br>)<br><br>restconf, err = GetRestConf()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br>fmt.Println(restconf) <span class="hljs-comment">// æ‰“å° restconf é…ç½®</span><br><span class="hljs-keyword">return</span><br>&#125;<br><br><span class="hljs-comment">// use config file</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetRestConf</span><span class="hljs-params">()</span> <span class="hljs-params">(config *rest.Config, err error)</span></span> &#123;<br>config, err = clientcmd.BuildConfigFromFlags(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;./admin.conf&quot;</span>) <span class="hljs-comment">// è¯»å–é¡¹ç›®æ ¹ç›®å½•çš„ admin.conf æ–‡ä»¶</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>  <br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="è¾“å‡ºç»“æœï¼š"><a href="#è¾“å‡ºç»“æœï¼š" class="headerlink" title="è¾“å‡ºç»“æœï¼š"></a>è¾“å‡ºç»“æœï¼š</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210906140753390.png" alt="image-20210906140753390"></p><blockquote><p>è¾“å‡ºçš„ç»“æœå®é™…ä¸Šå°±æ˜¯å°† kubeconfig çš„ context è½¬æ¢æˆäº† rest.Config çš„ç±»å‹</p></blockquote><h3 id="2-ä»é›†ç¾¤å†…è·å–é…ç½®"><a href="#2-ä»é›†ç¾¤å†…è·å–é…ç½®" class="headerlink" title="2. ä»é›†ç¾¤å†…è·å–é…ç½®"></a>2. ä»é›†ç¾¤å†…è·å–é…ç½®</h3><h4 id="1ï¼‰è‡ªåŠ¨è·å–é›†ç¾¤å†…ä¿¡æ¯"><a href="#1ï¼‰è‡ªåŠ¨è·å–é›†ç¾¤å†…ä¿¡æ¯" class="headerlink" title="1ï¼‰è‡ªåŠ¨è·å–é›†ç¾¤å†…ä¿¡æ¯"></a>1ï¼‰è‡ªåŠ¨è·å–é›†ç¾¤å†…ä¿¡æ¯</h4><blockquote><p>ğŸš© å½“ä»£ç è¿è¡Œåœ¨é›†ç¾¤ä¸­æ˜¯ï¼Œä½¿ç”¨ <code>clientcmd.BuildConfigFromFlags(&quot;&quot;, &quot;&quot;)</code> å‡½æ•°å¯ä»¥ç›´æ¥é€šè¿‡é›†ç¾¤ä¿¡æ¯è¿æ¥åˆ° api serverã€‚ï¼ˆä½†æ˜¯é»˜è®¤çš„ default ç”¨æˆ·ä¸ä¼šæœ‰é‚£ä¹ˆå¤šçš„æƒé™ã€‚ï¼‰</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;k8s.io/client-go/tools/clientcmd&quot;</span><br><br>...<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  ...<br>  config, err = clientcmd.BuildConfigFromFlags(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>...<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ä½¿ç”¨-ServiceAccount-æˆæƒä¿¡æ¯"><a href="#2ï¼‰ä½¿ç”¨-ServiceAccount-æˆæƒä¿¡æ¯" class="headerlink" title="2ï¼‰ä½¿ç”¨ ServiceAccount æˆæƒä¿¡æ¯"></a>2ï¼‰ä½¿ç”¨ ServiceAccount æˆæƒä¿¡æ¯</h4><blockquote><p>ğŸš© k8s çš„æ‰€æœ‰ Pod éƒ½ä¼šä»¥ Volume çš„æ–¹å¼æŒ‚è½½ k8s ä¸­é»˜è®¤çš„ ServiceAccountï¼Œå¯ä»¥æ˜¯ç”¨ <code>rest.InClusterConfig()</code> å‡½æ•°ï¼Œå®ƒä¼šä½¿ç”¨é»˜è®¤çš„ ServiceAccount çš„æˆæƒä¿¡æ¯å»è¿æ¥ apiserver</p></blockquote><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;k8s.io/client-go/rest&quot;</span><br><br>...<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  ...<br>  rest.InClusterConfig()<br>  ...<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å››ã€åˆ›å»ºå®¢æˆ·ç«¯"><a href="#å››ã€åˆ›å»ºå®¢æˆ·ç«¯" class="headerlink" title="å››ã€åˆ›å»ºå®¢æˆ·ç«¯"></a>å››ã€åˆ›å»ºå®¢æˆ·ç«¯</h2><h3 id="1ã€å®¢æˆ·ç«¯ç±»å‹è¯´æ˜"><a href="#1ã€å®¢æˆ·ç«¯ç±»å‹è¯´æ˜" class="headerlink" title="1ã€å®¢æˆ·ç«¯ç±»å‹è¯´æ˜"></a>1ã€å®¢æˆ·ç«¯ç±»å‹è¯´æ˜</h3><p>ä¸Šæ–‡æˆ‘ä»¬è¯´è¿‡ client-go æä¾›äº†å››ç§è®¿é—® APIserverçš„æ–¹å¼ï¼Œå¯¹åº”çš„ä¾¿æ˜¯å››ç§å®¢æˆ·ç«¯å¯¹è±¡ï¼Œå…¶å…·ä½“çš„å®šä½å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/client-go%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%B1%BB%E5%9E%8B.png" alt="client-go å®¢æˆ·ç«¯ç±»å‹"></p><h5 id="1-RESTClient"><a href="#1-RESTClient" class="headerlink" title="1. RESTClient"></a>1. RESTClient</h5><p>RESTClient æ˜¯æœ€åŸºç¡€çš„å®¢æˆ·ç«¯å¯¹è±¡ï¼Œåªæ˜¯å¯¹ Httprequest çš„åŸºæœ¬å°è£…ï¼Œé€šè¿‡å°† api-machinery åº“ä¸­çš„ç±»å‹ä½œä¸ºä¸€ç»„ REST åŸè¯­æ¥è®¿é—® APIserverï¼Œå…·ä½“å½¢å¼å¦‚ä¸‹:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// Get takes name of the pod, and returns the corresponding pod object, and an error if there is any.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *pods)</span> <span class="hljs-title">Get</span><span class="hljs-params">(ctx context.Context, name <span class="hljs-keyword">string</span>, options metav1.GetOptions)</span> <span class="hljs-params">(result *v1.Pod, err error)</span></span> &#123;<br>result = &amp;v1.Pod&#123;&#125;<br>err = c.client.Get().<br>Namespace(c.ns).<br>Resource(<span class="hljs-string">&quot;pods&quot;</span>).<br>Name(name).<br>VersionedParams(&amp;options, scheme.ParameterCodec).<br>Do(ctx).<br>Into(result)<br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œè®¸å¤šå‚æ•°éƒ½éœ€è¦ä½¿ç”¨è€…æ¥è®¾ç½®ï¼Œä½¿ç”¨èµ·æ¥å¾ˆä¸æ–¹ä¾¿ï¼Œäºæ˜¯ client-go åœ¨å…¶åŸºç¡€ä¸Šåˆå®ç°äº†å¦å¤–ä¸‰ç§å®¢æˆ·ç«¯å¯¹è±¡ã€‚</p><h5 id="2-ClientSet"><a href="#2-ClientSet" class="headerlink" title="2. ClientSet"></a>2. ClientSet</h5><p>Clientset å¯ä»¥è¯´æ˜¯ä½¿ç”¨ client-go æœ€å¸¸ç”¨çš„å®¢æˆ·ç«¯å¯¹è±¡ï¼Œå®ƒåœ¨ RESTClient çš„åŸºç¡€ä¸Šå°† K8S çš„ Resource å’Œ Version ä¹Ÿè¿›è¡Œäº†å°è£…ï¼Œä»¥æ­¤å®ç°äº†ä¸€ä¸ªèµ„æºå¯¹åº”ä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹ï¼Œäºæ˜¯ä¹ï¼Œå¤šä¸ªå®¢æˆ·ç«¯ï¼ˆèµ„æºå¯¹è±¡ï¼‰çš„é›†åˆå°±æ˜¯ Client Setã€‚</p><p>æ€»ä½“æ¥è¯´ï¼ŒClientset æš´éœ²äº†K8Så…¬å¼€åŒ–çš„APIèµ„æºå¹¶ä¸”å®ç°äº†å…¶å¯¹åº”çš„åºåˆ—åŒ–ï¼Œè¿™ä½¿å¾—å¯¹äºèµ„æºçš„æ“ä½œå˜å¾—ç®€å•äº†èµ·æ¥ï¼Œäº‹å®ä¸Šï¼Œclientset æ‰æ˜¯æˆ‘ä»¬åˆ›å»º K8S client çš„èµ·ç‚¹ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒClientset åªèƒ½è®¿é—® K8S å†…ç½®çš„èµ„æºï¼Œå¹¶ä¸èƒ½è®¿é—®ç”¨æˆ·è‡ªå®šä¹‰èµ„æºï¼ˆCRDï¼‰ã€‚</p><h5 id="3-DynamicClient"><a href="#3-DynamicClient" class="headerlink" title="3. DynamicClient"></a>3. DynamicClient</h5><p>Clientset åªèƒ½è®¿é—®å†…ç½®èµ„æºï¼Œè€Œå¾€å¾€åœ¨åŸºäº K8S çš„æ·±å…¥ä½¿ç”¨å’ŒäºŒæ¬¡å¼€å‘ä¸­éƒ½ä¼šæ¶‰åŠå¤§é‡çš„è‡ªå®šä¹‰èµ„æºï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿclient-go å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†åº”å¯¹çš„ç­”æ¡ˆ â€”â€” DynamicClientã€‚æ˜¯ä¸€ç§æ›´ä¸ºé«˜çº§çš„ä¸Šå±‚æŠ½è±¡ï¼Œè·å–çš„å†…å®¹ç›´æ¥å°±æ˜¯ object ç±»å‹ï¼Œéœ€è¦è‡ªè¡Œåšè½¬æ¢ï¼Œå¯èƒ½ä¼šè½¬æ¢å¤±è´¥ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬åªå…ˆåšç®€å•äº†è§£ï¼Œåé¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åœ¨å…·ä½“ä»‹ç»ã€‚</p><h5 id="4-DiscoveryClient"><a href="#4-DiscoveryClient" class="headerlink" title="4. DiscoveryClient"></a>4. DiscoveryClient</h5><p>DiscoveryClient ç”¨äºå‘ç° K8S çš„ APIServeræ”¯æŒçš„Groupã€Versionã€Resourcesç­‰ä¿¡æ¯ï¼Œå…ˆåšäº†è§£ï¼Œåé¢æˆ‘ä»¬å†å…·ä½“ä»‹ç»ã€‚</p><blockquote><p>ğŸŒŸ <strong>æœ¬æ–‡æœ¬æ¬¡ä¸»è¦ä»‹ç» ClientSet çš„ä½¿ç”¨ï¼Œå¯¹äºå…¶ä»–ä¸‰ç±»å®¢æˆ·ç«¯å¯¹è±¡ï¼Œåœ¨åç»­çš„æ–‡ç« ä¸­ä¸€ä¸€ä»‹ç»</strong>ã€‚</p></blockquote><h3 id="2ã€ClientSet-çš„ä½¿ç”¨"><a href="#2ã€ClientSet-çš„ä½¿ç”¨" class="headerlink" title="2ã€ClientSet çš„ä½¿ç”¨"></a>2ã€ClientSet çš„ä½¿ç”¨</h3><h4 id="1ï¼‰åˆ›å»º-ClientSet-å®¢æˆ·ç«¯"><a href="#1ï¼‰åˆ›å»º-ClientSet-å®¢æˆ·ç«¯" class="headerlink" title="1ï¼‰åˆ›å»º ClientSet å®¢æˆ·ç«¯"></a>1ï¼‰åˆ›å»º ClientSet å®¢æˆ·ç«¯</h4><p>ä»£ç ç¤ºä¾‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">//</span> <span class="hljs-string">init</span> <span class="hljs-string">the</span> <span class="hljs-string">clientset</span><br><span class="hljs-string">func</span> <span class="hljs-string">InitClient()</span> <span class="hljs-string">*kubernetes.Clientset</span> &#123;<br><span class="hljs-string">//</span> <span class="hljs-string">create</span> <span class="hljs-string">a</span> <span class="hljs-string">kubeconfig</span> <span class="hljs-string">instance</span><br><span class="hljs-string">c</span> <span class="hljs-string">:=</span> <span class="hljs-string">LoadConfig()</span><br><br><span class="hljs-string">//</span> <span class="hljs-string">init</span> <span class="hljs-string">the</span> <span class="hljs-string">rest</span> <span class="hljs-string">client</span><br><span class="hljs-string">clientset</span>, <span class="hljs-string">err</span> <span class="hljs-string">:=</span> <span class="hljs-string">kubernetes.NewForConfig(c)</span><br><span class="hljs-string">if</span> <span class="hljs-string">err</span> <span class="hljs-type">!=</span> <span class="hljs-string">nil</span> &#123;<br><span class="hljs-string">log.Fatal(err)</span><br>&#125;<br><br><span class="hljs-string">return</span> <span class="hljs-string">clientset</span><br>&#125;<br><br><span class="hljs-string">//</span> <span class="hljs-string">load</span> <span class="hljs-string">the</span> <span class="hljs-string">kubeconfig</span> <span class="hljs-string">file</span><br><span class="hljs-string">func</span> <span class="hljs-string">LoadConfig()</span> <span class="hljs-string">*rest.Config</span> &#123;<br><br><span class="hljs-string">config</span>, <span class="hljs-string">err</span> <span class="hljs-string">:=</span> <span class="hljs-string">clientcmd.BuildConfigFromFlags(&quot;&quot;</span>, <span class="hljs-string">&quot;./config&quot;</span><span class="hljs-string">)</span><br><span class="hljs-string">if</span> <span class="hljs-string">err</span> <span class="hljs-type">!=</span> <span class="hljs-string">nil</span> &#123;<br><span class="hljs-string">log.Fatal(err)</span><br>&#125;<br>  <span class="hljs-string">return</span> <span class="hljs-string">config</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ä½¿ç”¨-Clientset-è¿›è¡Œ-K8S-èµ„æºçš„-CRUD-æ“ä½œ"><a href="#2ï¼‰ä½¿ç”¨-Clientset-è¿›è¡Œ-K8S-èµ„æºçš„-CRUD-æ“ä½œ" class="headerlink" title="2ï¼‰ä½¿ç”¨ Clientset è¿›è¡Œ K8S èµ„æºçš„ CRUD æ“ä½œ"></a>2ï¼‰ä½¿ç”¨ Clientset è¿›è¡Œ K8S èµ„æºçš„ CRUD æ“ä½œ</h4><h5 id="1-Get-æ“ä½œ-ä»£ç ç¤ºä¾‹ï¼š"><a href="#1-Get-æ“ä½œ-ä»£ç ç¤ºä¾‹ï¼š" class="headerlink" title="1. Get æ“ä½œ ä»£ç ç¤ºä¾‹ï¼š"></a>1. <code>Get æ“ä½œ</code> ä»£ç ç¤ºä¾‹ï¼š</h5><p><strong>ç¤ºä¾‹ä½œç”¨ï¼š</strong>è·å–æŒ‡å®š namespace ä¸‹æŒ‡å®š pod èµ„æºçš„ä¿¡æ¯å¹¶æ‰“å°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PodGet</span><span class="hljs-params">()</span> *<span class="hljs-title">corev1</span>.<span class="hljs-title">Pod</span></span> &#123;<br><br><span class="hljs-comment">// init the clientset instance</span><br>client := InitClient()<br><br><span class="hljs-comment">// define the api iinterface</span><br>api := client.CoreV1()<br>opts := metav1.GetOptions&#123;&#125;<br><br>namespace := os.Getenv(<span class="hljs-string">&quot;POD_NAMESPACE&quot;</span>)<br>name := os.Getenv(<span class="hljs-string">&quot;POD_NAME&quot;</span>)<br><br>podGet, err := api.Pods(namespace).Get(context.TODO(), name, opts)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>  <br>PrintPod(podGet)<br><span class="hljs-keyword">return</span> podGet<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintPod</span><span class="hljs-params">(pod *corev1.Pod)</span></span> &#123;<br>template := <span class="hljs-string">&quot;%-16s%-16s%-8s\n&quot;</span><br>fmt.Printf(template, <span class="hljs-string">&quot;NAME&quot;</span>, <span class="hljs-string">&quot;STATUS&quot;</span>, <span class="hljs-string">&quot;IMAGE&quot;</span>)<br><br><span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> pod.Spec.Containers &#123;<br>fmt.Printf(template, v.Name, pod.Status.Phase, v.Image)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-List-æ“ä½œ-ä»£ç ç¤ºä¾‹ï¼š"><a href="#2-List-æ“ä½œ-ä»£ç ç¤ºä¾‹ï¼š" class="headerlink" title="2. List æ“ä½œ ä»£ç ç¤ºä¾‹ï¼š"></a>2. <code>List æ“ä½œ</code> ä»£ç ç¤ºä¾‹ï¼š</h5><p><strong>ç¤ºä¾‹ä½œç”¨ï¼š</strong>è·å–æŒ‡å®š namespace ä¸‹ pod ä¿¡æ¯åˆ—è¡¨å¹¶æ‰“å°ï¼ˆé™ 500 ä¸ªï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PodList</span><span class="hljs-params">()</span> *<span class="hljs-title">corev1</span>.<span class="hljs-title">PodList</span></span> &#123;<br><br><span class="hljs-comment">// init the clientset instance</span><br>client := InitClient()<br><br><span class="hljs-comment">// define the api iinterface</span><br>api := client.CoreV1()<br>opts := metav1.ListOptions&#123;<br>Limit: <span class="hljs-number">500</span>,<br>&#125;<br><br>namespace := os.Getenv(<span class="hljs-string">&quot;POD_NAMESPACE&quot;</span>)<br><br>podList, err := api.Pods(namespace).List(context.TODO(), opts)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br>PrintPodList(podList)<br><br><span class="hljs-keyword">return</span> podList<br>&#125;<br><br><span class="hljs-comment">// pod list print template</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintPodList</span><span class="hljs-params">(podList *corev1.PodList)</span></span> &#123;<br>template := <span class="hljs-string">&quot;%-16s%-36s%-8s\n&quot;</span><br>fmt.Printf(template, <span class="hljs-string">&quot;NAMESPACE&quot;</span>, <span class="hljs-string">&quot;NAME&quot;</span>, <span class="hljs-string">&quot;STATUS&quot;</span>)<br><br><span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> podList.Items &#123;<br>fmt.Printf(template, v.Namespace, v.Name, v.Status.Phase)<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3-å¢åˆ æ“ä½œä»£ç ç¤ºä¾‹ï¼š"><a href="#3-å¢åˆ æ“ä½œä»£ç ç¤ºä¾‹ï¼š" class="headerlink" title="3. å¢åˆ æ“ä½œä»£ç ç¤ºä¾‹ï¼š"></a>3. å¢åˆ æ“ä½œä»£ç ç¤ºä¾‹ï¼š</h5><p><strong>ç¤ºä¾‹ä½œç”¨ï¼š</strong></p><ul><li>æ–°å»ºä¸€ä¸ªåä¸º <code>clientset-demo</code> çš„ namespace</li><li>åœ¨ clientset-demo ä¸‹æ–°å»ºä¸€ä¸ªåä¸º <code>deployment-demo</code> çš„ deploymentï¼Œé•œåƒä½¿ç”¨ tomcatï¼Œå‰¯æœ¬æ•°ä¸º 2</li><li>åœ¨ clientset-demo ä¸‹æ–°å»ºä¸€ä¸ªåä¸º <code>service-demo</code> çš„ serivceï¼Œç±»å‹ä¸º NodePort</li><li>ä¸€é”®æ¸…ç©ºæœ¬æ¬¡åˆ›å»ºèµ„æºåŠŸèƒ½</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;flag&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;path&quot;</span><br><br>appsv1 <span class="hljs-string">&quot;k8s.io/api/apps/v1&quot;</span><br>corev1 <span class="hljs-string">&quot;k8s.io/api/core/v1&quot;</span><br>metav1 <span class="hljs-string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span><br><span class="hljs-string">&quot;k8s.io/utils/pointer&quot;</span><br><br><span class="hljs-string">&quot;k8s.io/client-go/kubernetes&quot;</span><br><span class="hljs-string">&quot;k8s.io/client-go/rest&quot;</span><br><span class="hljs-string">&quot;k8s.io/client-go/tools/clientcmd&quot;</span><br>)<br><br><span class="hljs-keyword">const</span> (<br>NAMESPACE  = <span class="hljs-string">&quot;clientset-demo&quot;</span><br>DEPLOYMENT = <span class="hljs-string">&quot;deployment-demo&quot;</span><br>SERVICE    = <span class="hljs-string">&quot;service-demo&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><br><span class="hljs-comment">// define the operation types</span><br>operation := flag.String(<span class="hljs-string">&quot;operate&quot;</span>, <span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;operate type: create or clean&quot;</span>)<br><br>flag.Parse()<br><br><span class="hljs-comment">// init the clientset instance</span><br>clientset := InitClient()<br><br>fmt.Printf(<span class="hljs-string">&quot;operation is %s\n&quot;</span>, *operation)<br><br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;clean&quot;</span> == *operation &#123;<br>CleanResource(clientset)<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;create&quot;</span> == *operation &#123;<br>NamespaceCreate(clientset)<br><br>DeploymentCreate(clientset)<br><br>ServiceCreate(clientset)<br>&#125;<br><br>&#125;<br><br><span class="hljs-comment">// init the clientset</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitClient</span><span class="hljs-params">()</span> *<span class="hljs-title">kubernetes</span>.<span class="hljs-title">Clientset</span></span> &#123;<br><span class="hljs-comment">// create a kubeconfig instance</span><br>c := LoadConfig()<br><br><span class="hljs-comment">// init the rest client</span><br>clientset, err := kubernetes.NewForConfig(c)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err.Error()) <span class="hljs-comment">// exit when error is returned</span><br>&#125;<br><br><span class="hljs-keyword">return</span> clientset<br>&#125;<br><br><span class="hljs-comment">// load the kubeconfig file</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadConfig</span><span class="hljs-params">()</span> *<span class="hljs-title">rest</span>.<span class="hljs-title">Config</span></span> &#123;<br><br>config, err := clientcmd.BuildConfigFromFlags(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;./kubeconfig&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err.Error()) <span class="hljs-comment">// exit when error is returned</span><br>&#125;<br><span class="hljs-keyword">return</span> config<br>&#125;<br><br><span class="hljs-comment">// create the namespace</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NamespaceCreate</span><span class="hljs-params">(clientset *kubernetes.Clientset)</span> *<span class="hljs-title">corev1</span>.<span class="hljs-title">Namespace</span></span> &#123;<br><br><span class="hljs-comment">// define the api resource</span><br>api := clientset.CoreV1().Namespaces()<br><br>opts := metav1.CreateOptions&#123;&#125;<br><br><span class="hljs-comment">// serialize the namespace struct</span><br>namespace := &amp;corev1.Namespace&#123;<br>ObjectMeta: metav1.ObjectMeta&#123;<br>Name: NAMESPACE,<br>&#125;,<br>&#125;<br><br><span class="hljs-comment">// Convert the create operation</span><br>resource, err := api.Create(context.TODO(), namespace, opts)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err.Error()) <span class="hljs-comment">// exit when error</span><br>&#125;<br><br><span class="hljs-comment">// print the result</span><br>fmt.Printf(<span class="hljs-string">&quot;Create the namespace %s \n&quot;</span>, resource.GetName())<br><br><span class="hljs-keyword">return</span> resource<br>&#125;<br><br><span class="hljs-comment">// create the service</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ServiceCreate</span><span class="hljs-params">(clientset *kubernetes.Clientset)</span> *<span class="hljs-title">corev1</span>.<span class="hljs-title">Service</span></span> &#123;<br><br><span class="hljs-comment">// define the api resource</span><br>api := clientset.CoreV1().Services(NAMESPACE)<br><br>opts := metav1.CreateOptions&#123;&#125;<br><br><span class="hljs-comment">// serialize the service struct</span><br>service := &amp;corev1.Service&#123;<br>ObjectMeta: metav1.ObjectMeta&#123;<br>Name:      SERVICE,<br>Namespace: NAMESPACE,<br>&#125;,<br>Spec: corev1.ServiceSpec&#123;<br>Ports: []corev1.ServicePort&#123;&#123; <span class="hljs-comment">// [] means it needs a slice, the elements can be some json.</span><br>Name:     <span class="hljs-string">&quot;http&quot;</span>,<br>Port:     <span class="hljs-number">8080</span>,<br>NodePort: <span class="hljs-number">30080</span>,<br>&#125;,<br>&#125;,<br>Selector: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>&#123;<br><span class="hljs-string">&quot;app&quot;</span>: <span class="hljs-string">&quot;tomcat&quot;</span>,<br>&#125;,<br>Type: corev1.ServiceTypeNodePort,<br>&#125;,<br>&#125;<br><br><span class="hljs-comment">// Convert the create operation</span><br>resource, err := api.Create(context.TODO(), service, opts)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err.Error()) <span class="hljs-comment">// exit when error</span><br>&#125;<br><br><span class="hljs-comment">// print the result</span><br>fmt.Printf(<span class="hljs-string">&quot;Create the service %s \n&quot;</span>, resource.GetName())<br><br><span class="hljs-keyword">return</span> resource<br>&#125;<br><br><span class="hljs-comment">// create the deployment</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DeploymentCreate</span><span class="hljs-params">(clientset *kubernetes.Clientset)</span> *<span class="hljs-title">appsv1</span>.<span class="hljs-title">Deployment</span></span> &#123;<br><br><span class="hljs-comment">// define the api resource</span><br>api := clientset.AppsV1().Deployments(NAMESPACE)<br><br>opts := metav1.CreateOptions&#123;&#125;<br><br><span class="hljs-comment">// serialize the deployment struct</span><br>deployment := &amp;appsv1.Deployment&#123;<br>ObjectMeta: metav1.ObjectMeta&#123;<br>Name: DEPLOYMENT,<br>&#125;,<br>Spec: appsv1.DeploymentSpec&#123;<br>Replicas: pointer.Int32Ptr(<span class="hljs-number">2</span>), <span class="hljs-comment">// Replicas need *int32, so it should be a pointer</span><br>Selector: &amp;metav1.LabelSelector&#123;<br>MatchLabels: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>&#123;<br><span class="hljs-string">&quot;app&quot;</span>: <span class="hljs-string">&quot;tomcat&quot;</span>,<br>&#125;,<br>&#125;,<br>Template: corev1.PodTemplateSpec&#123;<br>ObjectMeta: metav1.ObjectMeta&#123;<br>Labels: <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>&#123;<br><span class="hljs-string">&quot;app&quot;</span>: <span class="hljs-string">&quot;tomcat&quot;</span>,<br>&#125;,<br>&#125;,<br>Spec: corev1.PodSpec&#123;<br>Containers: []corev1.Container&#123;&#123; <span class="hljs-comment">// [] means it needs a slice, the elements can be some json.</span><br>Name:            <span class="hljs-string">&quot;tomcat&quot;</span>,<br>Image:           <span class="hljs-string">&quot;tomcat:8.0.18-jre8&quot;</span>,<br>ImagePullPolicy: <span class="hljs-string">&quot;IfNotPresent&quot;</span>,<br>Ports: []corev1.ContainerPort&#123;&#123;<br>Name:          <span class="hljs-string">&quot;http&quot;</span>,<br>Protocol:      corev1.ProtocolTCP,<br>ContainerPort: <span class="hljs-number">8080</span>,<br>&#125;,<br>&#125;,<br>&#125;,<br>&#125;,<br>&#125;,<br>&#125;,<br>&#125;,<br>&#125;<br><br><span class="hljs-comment">// Convert the create operation</span><br>resource, err := api.Create(context.TODO(), deployment, opts)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err.Error()) <span class="hljs-comment">// exit when error</span><br>&#125;<br><br><span class="hljs-comment">// print the result</span><br>fmt.Printf(<span class="hljs-string">&quot;Create the deployment %s \n&quot;</span>, resource.GetName())<br><br><span class="hljs-keyword">return</span> resource<br>&#125;<br><br><span class="hljs-comment">// clean all the created resource</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CleanResource</span><span class="hljs-params">(clientset *kubernetes.Clientset)</span></span> &#123;<br><br>opts := metav1.DeleteOptions&#123;&#125;<br><br><span class="hljs-comment">// delete the service</span><br><span class="hljs-keyword">if</span> err := clientset.CoreV1().Services(NAMESPACE).Delete(context.TODO(), SERVICE, opts); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err.Error()) <span class="hljs-comment">// exit when error</span><br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;Delete the service %s \n&quot;</span>, SERVICE)<br><br><span class="hljs-comment">// delete the deployment</span><br><span class="hljs-keyword">if</span> err := clientset.AppsV1().Deployments(NAMESPACE).Delete(context.TODO(), DEPLOYMENT, opts); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err.Error()) <span class="hljs-comment">// exit when error</span><br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;Delete the deployment %s\n&quot;</span>, DEPLOYMENT)<br><br><span class="hljs-comment">// delete the namespace</span><br><span class="hljs-keyword">if</span> err := clientset.CoreV1().Namespaces().Delete(context.TODO(), NAMESPACE, opts); err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err.Error()) <span class="hljs-comment">// exit when error</span><br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;Delete the namespace %s \n&quot;</span>, NAMESPACE)<br><br><span class="hljs-keyword">return</span><br>&#125;<br></code></pre></td></tr></table></figure><h6 id="1âƒ£ï¸-åŠŸèƒ½éªŒè¯-â€”-åˆ›å»ºèµ„æºï¼š"><a href="#1âƒ£ï¸-åŠŸèƒ½éªŒè¯-â€”-åˆ›å»ºèµ„æºï¼š" class="headerlink" title="1âƒ£ï¸ åŠŸèƒ½éªŒè¯ â€” åˆ›å»ºèµ„æºï¼š"></a>1âƒ£ï¸ åŠŸèƒ½éªŒè¯ â€” åˆ›å»ºèµ„æºï¼š</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">go run main.go -operate create<br></code></pre></td></tr></table></figure><p>è¿”å›ç»“æœ:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916103730186.png" alt="image-20210916103730186"></p><h6 id="2âƒ£ï¸-kubernetes-dashboard-æŸ¥çœ‹ï¼š"><a href="#2âƒ£ï¸-kubernetes-dashboard-æŸ¥çœ‹ï¼š" class="headerlink" title="2âƒ£ï¸ kubernetes dashboard æŸ¥çœ‹ï¼š"></a>2âƒ£ï¸ kubernetes dashboard æŸ¥çœ‹ï¼š</h6><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916104140456.png" alt="image-20210916104140456"></p><h6 id="3âƒ£ï¸-minikube-service-è®¿é—®-endpointï¼š"><a href="#3âƒ£ï¸-minikube-service-è®¿é—®-endpointï¼š" class="headerlink" title="3âƒ£ï¸ minikube service è®¿é—® endpointï¼š"></a>3âƒ£ï¸ minikube service è®¿é—® endpointï¼š</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">minikube service service-demo -n clientset-demo<br></code></pre></td></tr></table></figure><p>è¿”å›ç»“æœ:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916104252394.png" alt="image-20210916104252394"></p><p>é€šè¿‡æµè§ˆå™¨è®¿é—®:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916104318784.png" alt="image-20210916104318784"></p><h6 id="4âƒ£ï¸-åŠŸèƒ½éªŒè¯-â€”â€”-æ¸…ç†èµ„æºï¼š"><a href="#4âƒ£ï¸-åŠŸèƒ½éªŒè¯-â€”â€”-æ¸…ç†èµ„æºï¼š" class="headerlink" title="4âƒ£ï¸ åŠŸèƒ½éªŒè¯ â€”â€” æ¸…ç†èµ„æºï¼š"></a>4âƒ£ï¸ åŠŸèƒ½éªŒè¯ â€”â€” æ¸…ç†èµ„æºï¼š</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">go run main.go -operate clean<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916104839958.png" alt="image-20210916104839958"></p><h2 id="äº”ã€ç»éªŒæ€»ç»“"><a href="#äº”ã€ç»éªŒæ€»ç»“" class="headerlink" title="äº”ã€ç»éªŒæ€»ç»“"></a>äº”ã€ç»éªŒæ€»ç»“</h2><h3 id="1ã€ClientSet-æ“ä½œ-K8S-å¸¸ç”¨-API"><a href="#1ã€ClientSet-æ“ä½œ-K8S-å¸¸ç”¨-API" class="headerlink" title="1ã€ClientSet æ“ä½œ K8S å¸¸ç”¨ API"></a>1ã€ClientSet æ“ä½œ K8S å¸¸ç”¨ API</h3><h4 id="1ï¼‰deployment"><a href="#1ï¼‰deployment" class="headerlink" title="1ï¼‰deployment"></a>1ï¼‰deployment</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// åˆ—å‡º deploymentList</span><br>deploymentList, err := clientset.AppsV1().Deployments(<span class="hljs-string">&quot;default&quot;</span>).List(metav1.ListOptions&#123;&#125;)<br><br><span class="hljs-comment">// æŸ¥è¯¢ deploymentGet</span><br>deploymentGet, err := clientset.AppsV1().Deployments(<span class="hljs-string">&quot;default&quot;</span>).Get(<span class="hljs-string">&quot;nginx-web-v2&quot;</span>, metav1.GetOptions&#123;&#125;)<br><br><span class="hljs-comment">// åˆ›å»º deploymentCreate</span><br>deploymentCreate, err := clientset.AppsV1().Deployments(<span class="hljs-string">&quot;default&quot;</span>).Create(deploymentName)<br><br><span class="hljs-comment">// æ›´æ–° deploymentUpdate</span><br>deploymentUpdate, err := clientset.AppsV1().Deployments(<span class="hljs-string">&quot;default&quot;</span>).Update(deploymentName)<br><br><span class="hljs-comment">// åˆ é™¤deployment</span><br>err = clientset.AppsV1().Deployments(<span class="hljs-string">&quot;default&quot;</span>).Delete(<span class="hljs-string">&quot;deploymentName&quot;</span>, &amp;metav1.DeleteOptions&#123;&#125;)<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰pod"><a href="#2ï¼‰pod" class="headerlink" title="2ï¼‰pod"></a>2ï¼‰pod</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//åˆ—å‡ºpodï¼ˆä¸å†™å‘½ä»¤ç©ºé—´  å³åˆ—å‡ºæ‰€æœ‰podï¼‰</span><br>podList, err := clientset.CoreV1().Pods(<span class="hljs-string">&quot;default&quot;</span>).List(&amp;meta_v1.ListOptions&#123;&#125;)<br><br><span class="hljs-comment">//æŸ¥è¯¢pod</span><br>pod, err := clientset.CoreV1().Pods(<span class="hljs-string">&quot;default&quot;</span>).Get(&lt;podName&gt;, meta_v1.GetOptions&#123;&#125;)<br><br><span class="hljs-comment">//åˆ›å»ºpod</span><br>pod, err := clientset.CoreV1().Pods(<span class="hljs-string">&quot;default&quot;</span>).Create(web)<br><br><span class="hljs-comment">//æ›´æ–°pod</span><br>pod, err := clientset.CoreV1().Pods(<span class="hljs-string">&quot;default&quot;</span>).Update(web)<br><br><span class="hljs-comment">//åˆ é™¤pod</span><br>err := clientset.CoreV1().Pods(<span class="hljs-string">&quot;default&quot;</span>).Delete(&lt;podName&gt;, &amp;meta_v1.DeleteOptions&#123;&#125;)<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰statefulset"><a href="#3ï¼‰statefulset" class="headerlink" title="3ï¼‰statefulset"></a>3ï¼‰statefulset</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// åˆ—å‡º statefulList</span><br>statefulList, err := clientset.AppsV1().StatefulSets(<span class="hljs-string">&quot;default&quot;</span>).List(metav1.ListOptions&#123;&#125;)<br><br><span class="hljs-comment">// æŸ¥è¯¢ statefulGet</span><br>statefulGet, err := clientset.AppsV1().StatefulSets(<span class="hljs-string">&quot;default&quot;</span>).Get(<span class="hljs-string">&quot;web&quot;</span>, metav1.GetOptions&#123;&#125;)<br><span class="hljs-comment">// åˆ›å»º statefulCreate</span><br>statefulCreate, err := clientset.AppsV1().StatefulSets(<span class="hljs-string">&quot;default&quot;</span>).Create(statefulName)<br><br><span class="hljs-comment">// æ›´æ–° statefulUpdate</span><br>statefulUpdate, err := clientset.AppsV1().StatefulSets(<span class="hljs-string">&quot;default&quot;</span>).Update(statefulName)<br><br><span class="hljs-comment">// åˆ é™¤ stateful</span><br>err = clientset.AppsV1().StatefulSets(<span class="hljs-string">&quot;default&quot;</span>).Delete(<span class="hljs-string">&quot;statefulName&quot;</span>, &amp;metav1.DeleteOptions&#123;&#125;)<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰service"><a href="#4ï¼‰service" class="headerlink" title="4ï¼‰service"></a>4ï¼‰service</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// åˆ—å‡º serviceList</span><br>serviceList, err := clientset.CoreV1().Services(<span class="hljs-string">&quot;default&quot;</span>).List(metav1.ListOptions&#123;&#125;)<br><br><span class="hljs-comment">// æŸ¥è¯¢ serviceGet</span><br>serviceGet, err := clientset.CoreV1().Services(<span class="hljs-string">&quot;default&quot;</span>).Get(<span class="hljs-string">&quot;web&quot;</span>, metav1.GetOptions&#123;&#125;)<br><br><span class="hljs-comment">// åˆ›å»º serviceCreate</span><br>serviceCreate, err := clientset.CoreV1().Services(<span class="hljs-string">&quot;default&quot;</span>).Create(web)<br><br><span class="hljs-comment">// æ›´æ–° serviceUpdate</span><br>serviceUpdate, err := clientset.CoreV1().Services(<span class="hljs-string">&quot;default&quot;</span>).Update(web)<br><br><span class="hljs-comment">// åˆ é™¤ service</span><br>err = clientset.CoreV1().Services.(<span class="hljs-string">&quot;default&quot;</span>).Delete(<span class="hljs-string">&quot;serviceName&quot;</span>, &amp;metav1.DeleteOptions&#123;&#125;)<br></code></pre></td></tr></table></figure><h4 id="5ï¼‰ingress"><a href="#5ï¼‰ingress" class="headerlink" title="5ï¼‰ingress"></a>5ï¼‰ingress</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs GO"><span class="hljs-comment">// åˆ—å‡º ingressList</span><br>ingressList, err := clientset.ExtensionsV1beta1().Ingresses(<span class="hljs-string">&quot;default&quot;</span>).List(metav1.ListOptions&#123;&#125;)<br><br><span class="hljs-comment">// æŸ¥è¯¢ ingressGet</span><br>ingressGet, err := clientset.ExtensionsV1beta1().Ingresses(<span class="hljs-string">&quot;default&quot;</span>).Get(<span class="hljs-string">&quot;web&quot;</span>, metav1.GetOptions&#123;&#125;)<br><br><span class="hljs-comment">// åˆ›å»º ingressCreate</span><br>ingressCreate, err := clientset.ExtensionsV1beta1().Ingresses(<span class="hljs-string">&quot;default&quot;</span>).Create(web)<br><br><span class="hljs-comment">// æ›´æ–° ingressUpdate</span><br>ingressUpdate, err := clientset.ExtensionsV1beta1().Ingresses(<span class="hljs-string">&quot;default&quot;</span>).Update(web)<br><br><span class="hljs-comment">// åˆ é™¤ ingress</span><br>err = clientset.ExtensionsV1beta1().Ingresses(<span class="hljs-string">&quot;default&quot;</span>).Delete(<span class="hljs-string">&quot;web&quot;</span>, &amp;metav1.DeleteOptions&#123;&#125;)<br></code></pre></td></tr></table></figure><h4 id="6ï¼‰configmap"><a href="#6ï¼‰configmap" class="headerlink" title="6ï¼‰configmap"></a>6ï¼‰configmap</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// åˆ—å‡º configmapList</span><br>configmapList, err := clientset.CoreV1().ConfigMaps(<span class="hljs-string">&quot;default&quot;</span>).List(context.TODO(), meta_v1.ListOptions)<br><br><span class="hljs-comment">// æŸ¥è¯¢ configmapGet</span><br>configmapGet, err := clientset.CoreV1().ConfigMaps(<span class="hljs-string">&quot;default&quot;</span>).Get(context.TODO(), <span class="hljs-string">&quot;name&quot;</span>, meta_v1.GetOptions&#123;&#125;)<br><br><span class="hljs-comment">// åˆ›å»º configmapCreate</span><br>configmapCreate, err<br></code></pre></td></tr></table></figure><h3 id="2ã€å¦‚ä½•æŸ¥æ‰¾-ClientSet-çš„èµ„æºå¯¹è±¡ç»“æ„"><a href="#2ã€å¦‚ä½•æŸ¥æ‰¾-ClientSet-çš„èµ„æºå¯¹è±¡ç»“æ„" class="headerlink" title="2ã€å¦‚ä½•æŸ¥æ‰¾ ClientSet çš„èµ„æºå¯¹è±¡ç»“æ„"></a>2ã€å¦‚ä½•æŸ¥æ‰¾ ClientSet çš„èµ„æºå¯¹è±¡ç»“æ„</h3><blockquote><p>ä»ä¸Šæ–‡çš„ç¤ºä¾‹ä¸­ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ¸…æ¥šçš„äº†è§£å‡ ä¸ªå…³é”®ç‚¹ï¼Œå…¶å®é€šè¿‡ clientset è¿›è¡ŒæŸ¥è¯¢å’Œåˆ é™¤æ“ä½œï¼Œæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå®ƒçš„æœ¬è´¨è¿˜æ˜¯åœ¨æ‰§è¡Œå°è£…ä¸‹å±‚çš„ REST åŸè¯­è°ƒç”¨ K8S APIServer è¿›è¡Œå¯¹åº”çš„å¤„ç†ã€‚</p><p>ä½†æ˜¯åœ¨åˆ›å»ºèµ„æºæ—¶æ˜¯ä¸åŒçš„ï¼Œåˆ›å»ºæ—¶ï¼Œé™¤äº†å¸¸ç”¨çš„å…¥ namespace ã€context ç­‰å‚æ•°å¤–ï¼Œæˆ‘ä»¬æ˜¯è¦å¯¼å…¥ç¬¦åˆ clientset åºåˆ—åŒ–ç»“æ„çš„å¯¹è±¡çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªéš¾ç‚¹ï¼Œå½“ç„¶é€šè¿‡ IDE æˆ‘ä»¬æ˜¯å¯ä»¥ç®€åŒ–æŸ¥æ‰¾çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨è¿™é‡Œç®€å•çš„è¯´ä¸€ä¸‹ã€‚</p></blockquote><h4 id="1ï¼‰ä½¿ç”¨-IDE-çš„åŒå±æ¨¡å¼"><a href="#1ï¼‰ä½¿ç”¨-IDE-çš„åŒå±æ¨¡å¼" class="headerlink" title="1ï¼‰ä½¿ç”¨ IDE çš„åŒå±æ¨¡å¼"></a>1ï¼‰ä½¿ç”¨ IDE çš„åŒå±æ¨¡å¼</h4><p>ç¬”è€…ä¸ªäººæ¯”è¾ƒæ¨èçš„æ–¹å¼æ˜¯é€šè¿‡ IDE çš„åŒå±åŠŸèƒ½åŒæ—¶æ‰“å¼€2ä¸ªçª—å£ï¼Œæ–¹ä¾¿å¯¹åº”æºç çš„æŸ¥è¯¢ï¼Œæ˜¯çš„ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå…¶å®éœ€è¦çš„æ•°æ®æœºæ„éƒ½å¯ä»¥ä»å¼•ç”¨çš„åŒ…ä¸­æŸ¥åˆ°å¯¹åº”çš„æºç ï¼Œç„¶åæˆ‘ä»¬æ ¹æ®å¯¹åº”çš„éœ€æ±‚å»è½¬åŒ–å°±å¯ä»¥äº†ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916110720621.png" alt="image-20210916110720621"></p><h4 id="2ï¼‰å¦‚ä½•æ‰¾åˆ°éœ€è¦æ“ä½œçš„API"><a href="#2ï¼‰å¦‚ä½•æ‰¾åˆ°éœ€è¦æ“ä½œçš„API" class="headerlink" title="2ï¼‰å¦‚ä½•æ‰¾åˆ°éœ€è¦æ“ä½œçš„API"></a>2ï¼‰å¦‚ä½•æ‰¾åˆ°éœ€è¦æ“ä½œçš„API</h4><p>ClientSet å¸¸ç”¨çš„æ“ä½œæˆ‘ä»¬å†ä¸Šé¢å·²ç»åˆ—å‡ºï¼Œè¿™å—ä¸»è¦æ˜¯å¯¹ K8S åŸç”Ÿèµ„æºçš„è½¬åŒ–ï¼Œæ‰€ä»¥ä¸å†ç´¯è¿°ï¼Œå¦‚æœå¯¹äºè¿™è¾¹æ–¹é¢ä¸Šå°šä¸å¤ªäº†è§£ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹çš„ API æ–‡æ¡£: <a href="https://v1-18.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/">v1.18 å®˜æ–¹APIæ–‡æ¡£</a>ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916111600757.png" alt="image-20210916111600757"></p><p>æˆ‘ä»¬åœ¨ä¸Šæ–‡è¯´è¿‡ï¼ŒClientSet å°è£…äº† Resource å’Œ Versionï¼Œå†ç»“åˆæˆ‘ä»¬çš„ä»£ç ç¤ºä¾‹ï¼Œæ˜¯å¦å°±æ¯”è¾ƒå¥½ç†è§£äº†å‘¢ï¼Ÿ</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916111808287.png" alt="image-20210916111808287"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916111912629.png" alt="image-20210916111912629"></p><h4 id="3ï¼‰æŸ¥æ‰¾å¯¹åº”-API-æ‰€å°è£…çš„å‡½æ•°"><a href="#3ï¼‰æŸ¥æ‰¾å¯¹åº”-API-æ‰€å°è£…çš„å‡½æ•°" class="headerlink" title="3ï¼‰æŸ¥æ‰¾å¯¹åº” API æ‰€å°è£…çš„å‡½æ•°"></a>3ï¼‰æŸ¥æ‰¾å¯¹åº” API æ‰€å°è£…çš„å‡½æ•°</h4><p>å¯¹äº ClientSet API çš„ä½¿ç”¨æœ‰äº†ä¸€å®šäº†è§£åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ IDE å»æ‰¾æºç å¯¹åº”çš„å†…å®¹äº†ã€‚é¼ æ ‡æŒ‡å‘å¯¹åº”çš„èµ„æºï¼Œé€šè¿‡æŒ‰ä½ cmdï¼ˆWindowsä¸€èˆ¬ä¸º ctrlï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º IDE å·²ç»ä¸ºæˆ‘ä»¬æ‰¾åˆ°äº†æ‰€ç»§æ‰¿çš„ç±»ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916112308208.png" alt="image-20210916112308208"></p><p>æŒ‰ä½ cmd ç‚¹å‡»å¯¹è±¡åï¼Œå°±ä¼šè·³è½¬åˆ°å¯¹åº”çš„ä»£ç æ®µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916112712437.png" alt="image-20210916112712437"></p><p>å¯ä»¥çœ‹å‡ºï¼Œclient-go å·²ç»å°†å¯èƒ½çš„æ“ä½œéƒ½è¿›è¡Œäº†å°è£…ï¼Œå¹¶ä¸”å…¥å‚éœ€è¦ä»€ä¹ˆï¼Œå‡ºå‚æ˜¯ä»€ä¹ˆç±»å‹éƒ½æœ‰æ˜ç¡®çš„æ˜¾ç¤ºäº†ï¼Œæ¯”å¦‚ service çš„ create æ“ä½œéœ€è¦çš„çš„å…¥å‚æœ‰ï¼š</p><ul><li>ä¸Šä¸‹æ–‡ context</li><li>service å¯¹è±¡</li><li>opts å³è°ƒç”¨ apimachinery çš„å‚æ•°</li></ul><p>è¿”å›å€¼ä¸º service å¯¹è±¡å’Œ errorï¼Œé‚£ä¹ˆè½¬æ¢æˆä»£ç å³å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">serviceCreate, err := clientset.CoreV1().Create(context.TODO(), service, metav1.CreateOptions&#123;&#125;)<br></code></pre></td></tr></table></figure><p>è¿”å›å€¼æœ‰2ä¸ªï¼Œé‚£ä¹ˆå°±éœ€è¦2ä¸ªå˜é‡æ¥æ¥æ”¶ï¼Œå› æ­¤ä½¿ç”¨ <code>serviceCreate, err</code>ï¼›å¯¹äº context æ¥è¯´ï¼Œä½¿ç”¨ <code>context.TODO()</code> å³å¯ï¼Œå°±æ˜¯ä½¿ç”¨å®ä¾‹åŒ–çš„ client æ‰€ä½¿ç”¨çš„ contextï¼›optsï¼Œæˆ‘ä»¬è¦è¿›è¡Œä»€ä¹ˆæ“ä½œï¼Œå°±ç”¨å®ƒæ‰€éœ€è¦çš„å‚æ•°ç±»å‹å³å¯ï¼Œå½“ç„¶è¦å°†å…¶è½¬ä¸ºå¯¹è±¡ï¼Œå³ <code>metav1.CreateOptions&#123;&#125;</code>ï¼›</p><p>è€Œå¯¹äº service å¯¹è±¡ï¼Œé€šè¿‡é˜…è¯»æºç ï¼Œæˆ‘ä»¬çœ‹å‡ºå®ƒçš„ç±»å‹å°±æ˜¯ K8S å®šä¹‰çš„ Service ç±»å‹ï¼Œæ—¢ç„¶æœ‰ç±»å‹ï¼Œå°±ä¼šæœ‰å¯¹åº”çš„ç»“æ„ä½“ã€‚</p><h4 id="4ï¼‰æŸ¥æ‰¾èµ„æºå¯¹è±¡å¯¹åº”çš„-struct"><a href="#4ï¼‰æŸ¥æ‰¾èµ„æºå¯¹è±¡å¯¹åº”çš„-struct" class="headerlink" title="4ï¼‰æŸ¥æ‰¾èµ„æºå¯¹è±¡å¯¹åº”çš„ struct"></a>4ï¼‰æŸ¥æ‰¾èµ„æºå¯¹è±¡å¯¹åº”çš„ struct</h4><p>åŒæ ·ï¼Œè¿˜æ˜¯ä½¿ç”¨ IDE æ–¹ä¾¿çš„æ£€ç´¢åŠŸèƒ½ï¼ŒæŒ‰ä½ cmd æŒ‡å‘å¯¹åº”çš„ç±»å‹ï¼Œå¦‚ <code>*v1.Service</code>ï¼Œå®ƒå°±ä¼šå°†è¯¥ç±»å‹å¯¹åº”çš„ç»“æ„ä½“è¿”å›ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916114336129.png" alt="image-20210916114336129"></p><p>åŒæ ·çš„ï¼ŒæŒ‰ä½ cmd ç‚¹å‡»ï¼Œåˆä¼šè·³è½¬åˆ°ä¸€ä¸ªæ–°çš„æ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾å®šä¹‰äº†ç±»å‹ç»“æ„</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916114559010.png" alt="image-20210916114559010"></p><p>å¯ä»¥çœ‹å‡ºï¼ŒService è¿™ä¸ªç±»å‹æ‰€åŒ…å«çš„å†…å®¹æœ‰ä»¥ä¸Šå‡ ä¸ªå…ƒç´ å¯¹è±¡ï¼Œå®ƒä»¬ä¹Ÿæ˜¯æœ‰è‡ªå·±å¯¹åº”çš„ç±»å‹çš„ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­å“ªäº›æ˜¯å…ƒç´ æ˜¯å¿…è¦çš„ï¼Œè¿™å°±éœ€è¦ç»“åˆåˆ° K8S çš„çŸ¥è¯†ï¼Œå› ä¸ºæ— è®ºå¦‚ä½•å°è£…ï¼Œéƒ½å¿…é¡»è¦éµå¾ª K8S èµ„æºæœ¬èº«çš„ç‰¹æ€§ï¼Œä¸€ä¸ªå¸¸ç”¨çš„ service yaml å£°æ˜ä¸€èˆ¬å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>  <span class="hljs-attr">namespace:</span> &#123;&#123; <span class="hljs-string">.Values.namespace</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.labels</span> &#125;&#125;<br>  <span class="hljs-attr">labels:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.service.annotations</span> &#125;&#125;<br>  <span class="hljs-attr">annotations:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> &#123;&#123; <span class="hljs-string">.Values.service.type</span> &#125;&#125;<br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.service.http.name</span> &#125;&#125;<br>      <span class="hljs-attr">port:</span> &#123;&#123; <span class="hljs-string">.Values.service.http.port</span> &#125;&#125;<br>      <span class="hljs-attr">targetPort:</span> &#123;&#123; <span class="hljs-string">.Values.service.http.name</span> &#125;&#125;<br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.service.telemetry.name</span> &#125;&#125;<br>      <span class="hljs-attr">port:</span> &#123;&#123; <span class="hljs-string">.Values.service.telemetry.port</span> &#125;&#125;<br>      <span class="hljs-attr">targetPort:</span> &#123;&#123; <span class="hljs-string">.Values.service.telemetry.name</span> &#125;&#125;<br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">k8s-app:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€æ®µ helm çš„ service æ¨¡æ¿ï¼Œæˆ‘ä»¬åªéœ€è¦ç†è§£å…¶ä¸­ key çš„ä¸»ä½“ç»“æ„å³å¯ï¼Œæ— éœ€ç†ä¼š value æ˜¯ä»€ä¹ˆã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç¤ºä¾‹ï¼Œå…¶ä¸­ <code>apiVersion</code> å’Œ <code>kind</code> ï¼Œæˆ‘ä»¬åœ¨ ClientSet å·²ç»å®šä¹‰å¥½äº†ï¼ˆæˆ‘ä»¬åœ¨å®šä¹‰ api çš„è¿‡ç¨‹å…¶å®å°±æ˜¯åœ¨å®šä¹‰è¿™ä¸ªï¼‰ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ <code>metadata</code> å’Œ <code>spec</code> å°±æ˜¯å¿…è¦å…ƒç´ äº†ã€‚</p><p>åŒæ ·ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ä» å®˜æ–¹çš„ APIæ–‡æ¡£ä¸­æ‰¾åˆ°å¯¹åº”çš„ä¿¡æ¯ <a href="https://v1-18.docs.kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#service-v1-core">ä¼ é€é—¨</a></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916120436835.png" alt="image-20210916120436835"></p><h4 id="5ï¼‰æŸ¥æ‰¾å†…å®¹å…ƒç´ å¯¹åº”çš„-struct"><a href="#5ï¼‰æŸ¥æ‰¾å†…å®¹å…ƒç´ å¯¹åº”çš„-struct" class="headerlink" title="5ï¼‰æŸ¥æ‰¾å†…å®¹å…ƒç´ å¯¹åº”çš„ struct"></a>5ï¼‰æŸ¥æ‰¾å†…å®¹å…ƒç´ å¯¹åº”çš„ struct</h4><p>æˆ‘ä»¬ä¸Šé¢è¯´åˆ°ï¼Œservice å¿…è¦çš„ä¸¤ä¸ªå…ƒç´ ä¸º metadata å’Œ specï¼Œå…¶åœ¨ client-go çš„ Service ç±»å‹çš„æœºæ„ä½“ä¸­å³è¡¨ç°ä¸º ``metav1.ObjectMeta<code>å’Œ</code>Spec<code>ä¸¤ä¸ªå¯¹è±¡ï¼Œå…¶å¯¹åº”çš„ç±»å‹ä¸º</code>metav1.ObjectMeta<code>å’Œ</code>ServiceSpec` ï¼Œè¿™ä¹Ÿæ˜¯ä¸¤ç§ç‹¬ç«‹çš„ç±»å‹ï¼Œæœ‰è‡ªå·±çš„ç»“æ„ä½“ã€‚é€šè¿‡ä¸€æ ·çš„æ–¹æ³•ï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„æºç æ®µã€‚</p><h5 id="1-ObjectMeta"><a href="#1-ObjectMeta" class="headerlink" title="1. ObjectMeta"></a>1. ObjectMeta</h5><p>ObjectMeta çš„ç»“æ„ä½“å¦‚ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹é€šç”¨å‹çš„ç»“æ„ä½“ï¼Œå¯¹äº metadata æ¥è¯´ï¼Œæœ€å¿…è¦çš„å…ƒç´ ä¸º <code>Name</code> å’Œ <code>Namespace</code>ï¼Œä»–ä»¬å³ç›¸å½“äºSQL ä¸­çš„è”åˆå”¯ä¸€é”®ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916131519088.png" alt="image-20210916131519088"></p><p>è€Œä½œä¸ºå¯¹è±¡æ˜¯å®ä¾‹åŒ–ï¼Œä¹Ÿå°±å¿…é¡»è¦åŒ…å«è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå› æ­¤å…¶åºåˆ—åŒ–åæ˜¯è¿™æ ·çš„ï¼Œå…¶ä¸­åŒ…å«äº†å¿…è¦çš„ Nameã€Namespaceï¼Œè‡³äºå…¶ä»–çš„å…ƒç´ åˆ™éƒ½æ˜¯å¯é€‰é¡¹ï¼Œå…·ä½“çš„åŸç†è¿˜æ˜¯ä¸€æ ·çš„ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916131934518.png" alt="image-20210916131934518"></p><h5 id="2-Spec"><a href="#2-Spec" class="headerlink" title="2. Spec"></a>2. Spec</h5><p>Spec çš„ç»“æ„ä½“ä¸º corev1.ServiceSpecï¼Œé€šè¿‡ cmd æŸ¥çœ‹å…¶ç»“æ„ä½“ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916132623163.png" alt="image-20210916132623163"></p><p>ç»“åˆ K8S çš„çŸ¥è¯†ï¼Œå¯¹äº Service çš„ Spec æ¥è¯´ï¼Œå¿…è¦çš„å…ƒç´ æœ‰ä¸‰ä¸ªï¼Œå³  <code>type</code>ã€<code>ports</code> ã€<code>selector</code>ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ª Spec å¯¹è±¡æ¥è¯´ï¼Œä¹Ÿå¿…é¡»åŒ…å«å…¶ä¸‰è€…ï¼Œå…¶åœ¨ ServiceSpec è¡¨ç°ä¸º <code>Type</code>ã€<code>Ports</code>ã€<code>Selector</code> ä¸‰ä¸ªå¯¹è±¡ã€‚</p><h6 id="1âƒ£ï¸-Portsï¼š"><a href="#1âƒ£ï¸-Portsï¼š" class="headerlink" title="1âƒ£ï¸ Portsï¼š"></a>1âƒ£ï¸ Portsï¼š</h6><p>Ports å¯¹è±¡å¯¹åº”çš„ç±»å‹ä¸º <code>[]ServicePort </code>ï¼Œæœ‰ <code>[]</code> è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ª sliceï¼Œå…¶ä¸­ä¼šåŒ…å«å¤šä¸ªå…ƒç´ ã€‚ServicePort åˆæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»å‹ï¼Œè¿˜æ˜¯è€æ–¹æ³•ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å…¶ç»“æ„ä½“ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916133359159.png" alt="image-20210916133359159"></p><p>åœ¨ K8S ä¸­ï¼Œports æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªå…ƒç´ çš„è¯ï¼Œåˆ™éœ€è¦æ‰§è¡Œ Name æ¥éš”ç¦»ï¼Œè€Œ port åˆ™è¡¨ç¤ºèµ·å”¯ä¸€æ€§ï¼Œå¦‚æœä½¿ç”¨ NodePort çš„å½¢å¼çš„è¯ï¼Œåˆ™éœ€è¦æŒ‡å®š NodePort çš„ç«¯å£ï¼Œè€Œå…¶å¯¹åº”çš„ç±»å‹ä¸º <code>Name string</code>ã€<code>Port int32</code> ã€<code>NodePort32</code> ï¼Œå­—ç¬¦ä¸²æˆ–æ•´å‹ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œèµ·åºåˆ—åŒ–ååº”è¯¥æ˜¯è¿™æ ·çš„ï¼Œç”±äºæ˜¯ä¸€ä¸ª sliceï¼Œæ‰€ä»¥ä»¥ä¸€ä¸ª json æ¥å›Šæ‹¬ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916133935262.png" alt="image-20210916133935262"></p><h6 id="2âƒ£ï¸-Selectorï¼š"><a href="#2âƒ£ï¸-Selectorï¼š" class="headerlink" title="2âƒ£ï¸ Selectorï¼š"></a>2âƒ£ï¸ Selectorï¼š</h6><p>Selector å¯¹è±¡å¯¹åº”çš„ç±»å‹ä¸º map[string]stringï¼Œç›´æ¥ä»¥ä¸€ä¸ª json æ¥å®ä¾‹åŒ–å³å¯</p><h6 id="3âƒ£ï¸-Typeï¼š"><a href="#3âƒ£ï¸-Typeï¼š" class="headerlink" title="3âƒ£ï¸ Typeï¼š"></a>3âƒ£ï¸ Typeï¼š</h6><p>Type å¯¹è±¡å¯¹åº”çš„ç±»å‹æ˜¯ ServiceTypeï¼Œæœ‰ä»¥ä¸‹å‡ ç§ï¼Œå…¶å®å¯¹åº”çš„å°±æ˜¯ K8S service çš„ç±»å‹ï¼Œåªæ˜¯ client-go å¯¹å…¶è¿›è¡Œäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œå¹¶ä¸”å…¶æœ€ç»ˆå®šä¹‰éƒ½æ˜¯ stringï¼Œå› æ­¤ç›´æ¥å¼•ç”¨å³å¯ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916134412052.png" alt="image-20210916134412052"></p><h4 id="6ï¼‰æœ€ç»ˆèšåˆæˆèµ„æºå¯¹è±¡"><a href="#6ï¼‰æœ€ç»ˆèšåˆæˆèµ„æºå¯¹è±¡" class="headerlink" title="6ï¼‰æœ€ç»ˆèšåˆæˆèµ„æºå¯¹è±¡"></a>6ï¼‰æœ€ç»ˆèšåˆæˆèµ„æºå¯¹è±¡</h4><p>ç»“åˆä¸Šé¢æ‰€è¯´çš„å†…å®¹ï¼Œå°†å„ä¸ªå…ƒç´ å¯¹è±¡æœ€ç»ˆæ‹¼å‡‘èµ·æ¥å°±æ˜¯èµ„æºå¯¹è±¡äº†ï¼Œè¿™å…¶ä¸­è¿˜æœ‰ä¸€ç‚¹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œèµ„æºå¯¹è±¡çš„ç±»å‹éƒ½æ˜¯ä»¥ *corev1.xxx çš„æŒ‡é’ˆç±»å‹ï¼Œæ‰€ä»¥åœ¨å®ä¾‹åŒ–å®ƒä»¬çš„æ—¶å€™éƒ½è¦é€šè¿‡ &amp; æ¥è¿›è¡Œå¯¹è±¡å–å€ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210916135203688.png" alt="image-20210916135203688"></p><p>æœ‰äº†èµ„æºå¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ ClientSet çš„ API è¿›è¡Œåˆ›å»ºèµ„æºçš„æ“ä½œäº†ã€‚ä½ å¯ä»¥å‘ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯å°† K8S çš„èµ„æºå¯¹è±¡è½¬åŒ–æˆ client-go å°è£…çš„ç±»å¯¹è±¡çš„è¿‡ç¨‹ï¼ŒæŒæ¡äº†ä»¥ä¸Šæ–¹æ³•ï¼Œå°±åŸºæœ¬å¯ä»¥æŒæ¡ ClientSet å¯¹äºK8S å†…ç½®èµ„æºçš„ crud æ“ä½œäº†ã€‚</p><h2 id="å…­ã€å‚è€ƒæ–‡æ¡£"><a href="#å…­ã€å‚è€ƒæ–‡æ¡£" class="headerlink" title="å…­ã€å‚è€ƒæ–‡æ¡£"></a>å…­ã€å‚è€ƒæ–‡æ¡£</h2><p><a href="https://zhuanlan.zhihu.com/p/76706821">https://zhuanlan.zhihu.com/p/76706821</a></p><p><a href="https://xinchen.blog.csdn.net/article/details/113753087">https://xinchen.blog.csdn.net/article/details/113753087</a></p><p><a href="https://blog.csdn.net/weixin_34192816/article/details/92382936">https://blog.csdn.net/weixin_34192816/article/details/92382936</a></p>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang K8S API å¿«é€Ÿå…¥é—¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>alpine å®ç° selenium ç½‘é¡µæ–‡ä»¶è½¬åŒ–å›¾ç‰‡ç¯å¢ƒ</title>
    <link href="/2021/09/14/alpine-%E5%AE%9E%E7%8E%B0-selenium-%E7%BD%91%E9%A1%B5%E6%96%87%E4%BB%B6%E8%BD%AC%E5%8C%96%E5%9B%BE%E7%89%87%E7%8E%AF%E5%A2%83/"/>
    <url>/2021/09/14/alpine-%E5%AE%9E%E7%8E%B0-selenium-%E7%BD%91%E9%A1%B5%E6%96%87%E4%BB%B6%E8%BD%AC%E5%8C%96%E5%9B%BE%E7%89%87%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<h1 id="alpine-å®ç°ç½‘é¡µæ–‡ä»¶è½¬åŒ–å›¾ç‰‡ç¯å¢ƒ"><a href="#alpine-å®ç°ç½‘é¡µæ–‡ä»¶è½¬åŒ–å›¾ç‰‡ç¯å¢ƒ" class="headerlink" title="alpine å®ç°ç½‘é¡µæ–‡ä»¶è½¬åŒ–å›¾ç‰‡ç¯å¢ƒ"></a>alpine å®ç°ç½‘é¡µæ–‡ä»¶è½¬åŒ–å›¾ç‰‡ç¯å¢ƒ</h1><span id="more"></span><h2 id="ä¸€ã€èƒŒæ™¯ä»‹ç»"><a href="#ä¸€ã€èƒŒæ™¯ä»‹ç»" class="headerlink" title="ä¸€ã€èƒŒæ™¯ä»‹ç»"></a>ä¸€ã€èƒŒæ™¯ä»‹ç»</h2><p>è¿‘æœŸå…¬å¸åˆä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¯æˆªå–å‰ç«¯é¡µé¢å¹¶ç”Ÿæˆå›¾ç‰‡ï¼Œç”¨äºä¿å­˜ä¸€äº›ç­¾åå‡­è¯ç­‰ã€‚å¯ä»¥è¯´æ˜¯ selenium æ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨æ–¹å¼äº†ï¼Œä½†æ˜¯å¯¹äºæ²¡æœ‰æ¥è§¦è¿‡ selenium çš„æŠ€æœ¯äººå‘˜æ¥è¯´ï¼Œå°±æ˜¯èƒ½é€šè¿‡æœç´¢å¼•æ“æŸ¥è¯¢åˆ°ä¸€äº›æ–¹æ¡ˆï¼Œä¹Ÿä¸çŸ¥é“åˆ°åº•æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Œå®é™…ä¸Šï¼Œä¸ªäººè®¤ä¸ºè¿™çš„ç¡®æ›´åŠ åå‘å‰ç«¯å·¥ç¨‹å¸ˆæˆ–æµ‹è¯•ã€çˆ¬è™«å·¥ç¨‹å¸ˆçš„å·¥ä½œï¼Œæœ‰äº›è¶…å‡º crud boys çš„å·¥ä½œèŒƒç•´äº†ï¼Œäºæ˜¯åœ¨åŸºç¡€ç¯å¢ƒçš„é…ç½®ä¸Šç£¨è¹­äº†å‡ å¤©ä¹Ÿæ²¡æœ‰è§£å†³é—®é¢˜ã€‚é‚£ä¹ˆå€Ÿç€è§£å†³å¹¶è®°å½•è¿™æ¬¡é—®é¢˜çš„æœºä¼šï¼Œå°±å¤§æ¦‚ç®€å•çš„ä»‹ç»ä¸‹ç›¸å…³çš„çŸ¥è¯†ã€‚</p><h2 id="äºŒã€çŸ¥è¯†è®²è§£"><a href="#äºŒã€çŸ¥è¯†è®²è§£" class="headerlink" title="äºŒã€çŸ¥è¯†è®²è§£"></a>äºŒã€çŸ¥è¯†è®²è§£</h2><h3 id="1ã€chromeã€chrome-driverã€selenium-ç®€ä»‹"><a href="#1ã€chromeã€chrome-driverã€selenium-ç®€ä»‹" class="headerlink" title="1ã€chromeã€chrome driverã€selenium ç®€ä»‹"></a>1ã€chromeã€chrome driverã€selenium ç®€ä»‹</h3><h4 id="1ï¼‰Chrome-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ï¼‰Chrome-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ï¼‰Chrome æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ï¼‰Chrome æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>ç›¸ä¿¡ä¸€èˆ¬çš„æŠ€æœ¯äººå‘˜æˆ–è€…PCç”¨æˆ·å¯¹äº Chrome éƒ½ä¸ä¼šé™Œç”Ÿï¼Œå®ƒæ˜¯Google æ¨å‡ºçš„ä¸€æ¬¾ç½‘é¡µæµè§ˆå™¨ï¼Œæ˜¯ç›®å‰å¸‚é¢ä¸Šä½¿ç”¨æœ€å¹¿æ³›çš„æµè§ˆå™¨ä¹‹ä¸€ã€‚å®ƒåŸºäºå¼€æºçš„ WebKit ã€Blink å¼•æ“å¼€å‘ï¼ˆå…¶ä¸­ä¹ŸåŒ…å«çš„Google çš„Gearsï¼‰ï¼Œé‡‡ç”¨æ›´å¼ºå¤§çš„ JavaScript <a href="https://baike.baidu.com/item/V8/6178125">V8</a> è™šæ‹Ÿæœºè¿›è¡Œå¤šçº¿ç¨‹çš„ Javascrip tæ‰§è¡ŒåŠ é€Ÿï¼Œè¿™æ˜¯å½“å‰å…¶ä»–Webæµè§ˆå™¨æ‰€æ— æ³•å®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥è¯´ Chrome æ˜¯æ¯äº²å•Šæœ€å¿«çš„ Web æµè§ˆå™¨ã€‚</p><p>æœ€æ—©çš„betaæµ‹è¯•ç‰ˆæœ¬äº 2008å¹´9æœˆ2æ—¥å‘å¸ƒï¼Œæä¾›äº†50ä¸­è¯­è¨€çš„ç‰ˆæœ¬ï¼Œä»¥åŠå¯¹ Windowsã€macOSã€Linuxã€Androidã€IOSçš„è·¨å¹³å°æ”¯æŒã€‚</p><h4 id="2ï¼‰ChromeDriver-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2ï¼‰ChromeDriver-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ï¼‰ChromeDriver æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2ï¼‰ChromeDriver æ˜¯ä»€ä¹ˆï¼Ÿ</h4><blockquote><p>ğŸŒˆ ChromeDriver is the WebDriver for Chrome.</p></blockquote><p>WebDriveræ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œç”¨äºåœ¨è®¸å¤šæµè§ˆå™¨ä¸Šè‡ªåŠ¨æµ‹è¯•webappsã€‚å®ƒæä¾›äº†å¯¼èˆªåˆ°ç½‘é¡µï¼Œç”¨æˆ·è¾“å…¥ï¼ŒJavaScriptæ‰§è¡Œç­‰åŠŸèƒ½ã€‚</p><p>ChromeDriver åˆ™æ˜¯ç”± Googleå¼€å‘æä¾›çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¥å£ï¼Œæ˜¯ Chrome ä¸“ç”¨çš„ WebDriverã€‚å®ƒæ˜¯ selenium2 ä¸ chrome é€šä¿¡çš„æ¡¥æ¢ï¼Œä¸º Chromium å®ç°äº† WebDriver çš„ JsonWireProtocolã€‚</p><p>é€‚ç”¨äº Androidç‰ˆå’Œæ¡Œé¢ç‰ˆçš„ Chrome ï¼ˆMacã€Linuxã€Windowsã€ChromeOSï¼‰</p><h4 id="3ï¼‰Selenium-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3ï¼‰Selenium-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3ï¼‰Selenium æ˜¯ä»€ä¹ˆï¼Ÿ"></a>3ï¼‰Selenium æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>Selenium æ˜¯ ThoughWorks æä¾›çš„ä¸€æ¬¾åŸºäºæµè§ˆå™¨çš„å¼€æºè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œç”¨äºæ¨¡ä»¿ç”¨æˆ·çš„åœ¨æµè§ˆå™¨çš„æ‰‹åŠ¨æ“ä½œã€‚æ”¯æŒçš„æµè§ˆå™¨åŒ…æ‹¬ IEã€Chrome å’Œ Firefox ç­‰ã€‚å¸¸ç”¨äºæµ‹è¯•æµè§ˆå™¨å…¼å®¹æ€§ã€æ¨¡ä»¿ç”¨æˆ·è¡Œä¸ºåšå›å½’å’Œçˆ¬è™«ç­‰æ–¹é¢ï¼Œæ”¯æŒè‡ªåŠ¨å½•åˆ¶åŠ¨ä½œã€è‡ªåŠ¨ç”Ÿæˆ .Netã€Perlã€Pythonã€Ruby å’Œ Java ç­‰ä¸åŒè¯­è¨€çš„æµ‹è¯•è„šæœ¬ã€‚</p><p>è€Œ Selenium çš„è¿›é˜¶ç‰ˆ Selenium2 åˆ™æ˜¯å¯¹æµè§ˆå™¨æä¾›çš„åŸç”ŸAPIè¿›è¡Œå°è£…ï¼Œä½¿å…¶æˆä¸ºä¸€å¥—é¢å‘å¯¹è±¡çš„ Selenium WebDriver APIã€‚ä½¿ç”¨è¿™å¥— API å¯ä»¥æ“æ§æµè§ˆå™¨çš„å¼€å¯ã€å…³é—­ï¼Œæ‰“å¼€ç½‘é¡µï¼Œæ“ä½œç•Œé¢å…ƒç´ ï¼Œæ§åˆ¶ Cookieï¼Œè¿˜å¯ä»¥æ“ä½œæµè§ˆå™¨æˆªå±ã€å®‰è£…æ’ä»¶ã€è®¾ç½®ä»£ç†ã€é…ç½®è¯ä¹¦ç­‰ã€‚</p><p>å¯¹äºå…¶æ“ä½œéœ€è¦åŸºäºæµè§ˆå™¨å‚å•†æä¾›çš„é©±åŠ¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ driverã€‚ç”±äºä¸åŒçš„æµè§ˆå™¨å‚å•†ä¼šæä¾›çš„è‡ªå·±çš„é©±åŠ¨ï¼Œæ¯”å¦‚ï¼ŒChromeDriverã€FirefoxDriver(xpiæ’ä»¶)ã€InternetExplorerDriver(exe) ç­‰ï¼Œéƒ½å„æœ‰ä¸åŒï¼ŒAPIä¹Ÿå¹¶æ²¡æœ‰å½¢æˆç»Ÿä¸€æ ‡å‡†ï¼ˆç›®å‰éƒ½æ”¯æŒ JSON Wire Protocolï¼Œæ­£é€æ­¥å‘ W3C æ ‡å‡†é æ‹¢ï¼‰ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼ŒSelenium å¯¹å„ä¸ªå‚å•†çš„é©±åŠ¨éƒ½è¿›è¡Œäº†å°è£…ï¼Œå¦‚ selenium-chrome-driverã€selenium-firefox-driverã€selenium-edge-driverç­‰ã€‚è¿˜åŒ…æ‹¬äº†å¯¹ç§»åŠ¨åº”ç”¨è¿›è¡Œæµ‹è¯•çš„AndroidDriverå’ŒiOS WebDriverï¼Œä»¥åŠä¸€ä¸ªåŸºäºHtmlUnitçš„æ— ç•Œé¢å®ç°HtmlUnitDriverã€‚</p><p>é€šè¿‡ Pythonã€Rubyã€Javaã€C# ç­‰è¯­è¨€å¯ä»¥è®¿é—® Selenium WebDriverAPIã€‚</p><h3 id="2ã€chrome-driver-å’Œ-chrome-å¯¹ç…§è¡¨"><a href="#2ã€chrome-driver-å’Œ-chrome-å¯¹ç…§è¡¨" class="headerlink" title="2ã€chrome driver å’Œ chrome å¯¹ç…§è¡¨"></a>2ã€chrome driver å’Œ chrome å¯¹ç…§è¡¨</h3><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>chrome driver çš„ç‰ˆæœ¬éœ€è¦ä¸¥æ ¼æŒ‰ç…§ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼Œå¦åˆ™ä¼šå‡ºç°æ— æ³•è°ƒç”¨çš„æƒ…å†µã€‚</p></blockquote><table><thead><tr><th>ChromeDriver Version</th><th>Chrome Version</th></tr></thead><tbody><tr><td>v2.34</td><td>v61-63</td></tr><tr><td>v2.33</td><td>v60-62</td></tr><tr><td>v2.32</td><td>v59-61</td></tr><tr><td>v2.31</td><td>v58-60</td></tr><tr><td>v2.30</td><td>v58-60</td></tr><tr><td>v2.29</td><td>v56-58</td></tr><tr><td>v2.28</td><td>v55-57</td></tr><tr><td>v2.27</td><td>v54-56</td></tr><tr><td>v2.26</td><td>v53-55</td></tr><tr><td>v2.25</td><td>v53-55</td></tr><tr><td>v2.24</td><td>v52-54</td></tr><tr><td>v2.23</td><td>v51-53</td></tr><tr><td>v2.22</td><td>v49-52</td></tr><tr><td>v2.21</td><td>v46-50</td></tr><tr><td>v2.20</td><td>v43-48</td></tr><tr><td>v2.19</td><td>v43-47</td></tr><tr><td>v2.18</td><td>v43-46</td></tr><tr><td>v2.17</td><td>v42-43</td></tr><tr><td>v2.13</td><td>v42-45</td></tr><tr><td>v2.15</td><td>v40-43</td></tr><tr><td>v2.14</td><td>v39-42</td></tr><tr><td>v2.13</td><td>v38-41</td></tr><tr><td>v2.12</td><td>v36-40</td></tr><tr><td>v2.11</td><td>v36-40</td></tr><tr><td>v2.10</td><td>v33-36</td></tr><tr><td>v2.9</td><td>v31-34</td></tr><tr><td>v2.8</td><td>v30-33</td></tr><tr><td>v2.7</td><td>v30-33</td></tr><tr><td>v2.6</td><td>v29-32</td></tr><tr><td>v2.5</td><td>v29-32</td></tr><tr><td>v2.4</td><td>v29-32</td></tr></tbody></table><h3 id="3ã€chromeã€chrome-driver-ä¸‹è½½åœ°å€"><a href="#3ã€chromeã€chrome-driver-ä¸‹è½½åœ°å€" class="headerlink" title="3ã€chromeã€chrome driver ä¸‹è½½åœ°å€"></a>3ã€chromeã€chrome driver ä¸‹è½½åœ°å€</h3><blockquote><p>ğŸš© ç”±äºå›½å†…ä¸èƒ½ç›´æ¥è®¿é—® Chrome å®˜ç½‘ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€æ¥ä¸‹è½½</p></blockquote><p><a href="https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm">64ä½ Linux ç”¨ Chrome (rpm)</a></p><p><a href="http://www.google.cn/chrome/browser/desktop/index.html?standalone=1&platform=win64">64ä½ Windows ç”¨ Chrome</a></p><p><a href="http://www.google.cn/chrome/browser/desktop/index.html?standalone=1&platform=win">32ä½ Windows ç”¨ Chrome</a></p><p><a href="http://chromedriver.storage.googleapis.com/">chrome driver Google å®˜æ–¹é•œåƒæº</a></p><p><a href="https://npm.taobao.org/mirrors/chromedriver/">chrome driver æ·˜å®ç½‘å›½å†…é•œåƒæº</a></p><h2 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h2><h3 id="1ã€æ„å»ºåŸºç¡€é•œåƒ"><a href="#1ã€æ„å»ºåŸºç¡€é•œåƒ" class="headerlink" title="1ã€æ„å»ºåŸºç¡€é•œåƒ"></a>1ã€æ„å»ºåŸºç¡€é•œåƒ</h3><h4 id="Dockerfileï¼š"><a href="#Dockerfileï¼š" class="headerlink" title="Dockerfileï¼š"></a>Dockerfileï¼š</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> alpine AS final<br><br><span class="hljs-keyword">LABEL</span><span class="bash"> maintainer=<span class="hljs-string">&quot;Tareya&quot;</span> \</span><br><span class="bash">      version=<span class="hljs-string">&quot;1.0&quot;</span> \</span><br><span class="bash">      description=<span class="hljs-string">&quot;alpine with chrome and chrome drivers&quot;</span></span><br><br><span class="hljs-keyword">RUN</span><span class="bash"> sed -i <span class="hljs-string">&#x27;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#x27;</span> /etc/apk/repositories</span><br><br><span class="hljs-keyword">RUN</span><span class="bash"> apk add  --no-cache tzdata libc6-compat ca-certificates &amp;&amp; \</span><br><span class="bash">    cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</span><br><span class="bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Asia/Shanghai&quot;</span> &gt; /etc/timezone &amp;&amp; \</span><br><span class="bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hosts: files dns&quot;</span> &gt; /etc/nsswitch.conf</span><br><br><span class="hljs-keyword">RUN</span><span class="bash"> apk update &amp;&amp; apk upgrade &amp;&amp; \</span><br><span class="bash">    apk add --no-cache chromium \</span><br><span class="bash">          chromium-chromedriver \</span><br><span class="bash">          nss \</span><br><span class="bash">          freetype \</span><br><span class="bash">          harfbuzz \</span><br><span class="bash">          ttf-freefont \</span><br><span class="bash">          ttf-dejavu \</span><br><span class="bash">          fontconfig \</span><br><span class="bash">          dumb-init </span><br>                    <br></code></pre></td></tr></table></figure><h3 id="2ã€è§£å†³ä¸­æ–‡å­—ä½“é—®é¢˜"><a href="#2ã€è§£å†³ä¸­æ–‡å­—ä½“é—®é¢˜" class="headerlink" title="2ã€è§£å†³ä¸­æ–‡å­—ä½“é—®é¢˜"></a>2ã€è§£å†³ä¸­æ–‡å­—ä½“é—®é¢˜</h3><h4 id="1ï¼‰CentOS-7-å®‰è£…å­—ä½“åº“ä»¥åŠä¸­æ–‡å­—ä½“"><a href="#1ï¼‰CentOS-7-å®‰è£…å­—ä½“åº“ä»¥åŠä¸­æ–‡å­—ä½“" class="headerlink" title="1ï¼‰CentOS 7 å®‰è£…å­—ä½“åº“ä»¥åŠä¸­æ–‡å­—ä½“"></a>1ï¼‰CentOS 7 å®‰è£…å­—ä½“åº“ä»¥åŠä¸­æ–‡å­—ä½“</h4><h5 id="1-å®‰è£…å­—ä½“åº“"><a href="#1-å®‰è£…å­—ä½“åº“" class="headerlink" title="1. å®‰è£…å­—ä½“åº“"></a>1. å®‰è£…å­—ä½“åº“</h5><p>ä» CentOS 4.x èµ·ï¼Œç³»ç»Ÿä½¿ç”¨ fontconfig æ¥å®‰è£…å­—ä½“åº“ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¸‹è½½å³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y install fontconfig<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œä¼šç”Ÿæˆ <code>/usr/share/fonts</code> è¿™ä¸ªé»˜è®¤çš„ç³»ç»Ÿå­—ä½“é›†ç›®å½•</p><h5 id="2-å®‰è£…å¾®è½¯å­—ä½“"><a href="#2-å®‰è£…å¾®è½¯å­—ä½“" class="headerlink" title="2. å®‰è£…å¾®è½¯å­—ä½“"></a>2. å®‰è£…å¾®è½¯å­—ä½“</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install cabextract<br>yum install http://sourceforge.net/projects/mscorefonts2/files/rpms/msttcore-fonts-installer-2.6-1.noarch.rpm<br></code></pre></td></tr></table></figure><h5 id="3-å®‰è£…å¾®è½¯ä¸­æ–‡å­—ä½“é›†"><a href="#3-å®‰è£…å¾®è½¯ä¸­æ–‡å­—ä½“é›†" class="headerlink" title="3. å®‰è£…å¾®è½¯ä¸­æ–‡å­—ä½“é›†"></a>3. å®‰è£…å¾®è½¯ä¸­æ–‡å­—ä½“é›†</h5><blockquote><p>âš ï¸ <strong>æ³¨æ„ï¼š</strong></p><p>ç¡®åˆ‡çš„è¯´ï¼Œå¾®è½¯çš„å­—ä½“ä½¿ç”¨ç‰ˆæƒçš„ï¼Œåœ¨éå¾®è½¯çš„ç³»ç»Ÿä¸­ä½¿ç”¨å…¶å­—ä½“é›†æ˜¯è¿åæœ€ç»ˆç”¨æˆ·åè®®çš„ï¼Œå±äºè¿æ³•è¡Œä¸ºã€‚</p><p><a href="https://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/%E5%BE%AE%E8%BD%AF%E4%B8%AD%E6%96%87%E5%AD%97%E4%BD%93%E9%9B%86.zip">å¾®è½¯ä¸­æ–‡å­—ä½“é›†ä¸‹è½½åœ°å€</a></p><p><a href="https://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/Simsun.ttf">å®‹ä½“ Simsun.ttf ä¸‹è½½åœ°å€</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä¸‹è½½è§£å‹</span><br>wget https://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/%E5%BE%AE%E8%BD%AF%E4%B8%AD%E6%96%87%E5%AD%97%E4%BD%93%E9%9B%86.zip<br>unzip å¾®è½¯ä¸­æ–‡å­—ä½“é›†.zip <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> å¤åˆ¶åˆ°å­—ä½“é›†ç›®å½•</span><br>mkdir -p /usr/share/fonts/truetype/WindowsFonts/<br>cp -a å¾®è½¯ä¸­æ–‡å­—ä½“é›†/*.ttf /usr/share/fonts/truetype/WindowsFonts/<br>cp -a å¾®è½¯ä¸­æ–‡å­—ä½“é›†/*.TTF /usr/share/fonts/truetype/WindowsFonts/<br></code></pre></td></tr></table></figure><h5 id="5-å®‰è£…å¼€æºä¸­æ–‡å­—ä½“"><a href="#5-å®‰è£…å¼€æºä¸­æ–‡å­—ä½“" class="headerlink" title="5. å®‰è£…å¼€æºä¸­æ–‡å­—ä½“"></a>5. å®‰è£…å¼€æºä¸­æ–‡å­—ä½“</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo yum install wqy-microhei-fonts wqy-zenhei-fonts<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰k8s-deployment-ä¸­è¿›è¡ŒæŒ‚è½½"><a href="#2ï¼‰k8s-deployment-ä¸­è¿›è¡ŒæŒ‚è½½" class="headerlink" title="2ï¼‰k8s deployment ä¸­è¿›è¡ŒæŒ‚è½½"></a>2ï¼‰k8s deployment ä¸­è¿›è¡ŒæŒ‚è½½</h4><h5 id="helm-deployment-template-ç¤ºä¾‹ï¼š"><a href="#helm-deployment-template-ç¤ºä¾‹ï¼š" class="headerlink" title="helm deployment template ç¤ºä¾‹ï¼š"></a>helm deployment template ç¤ºä¾‹ï¼š</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span>  &#125;&#125;<br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> &#123;&#123; <span class="hljs-string">.Values.replicaCount</span> &#125;&#125;<br>  <span class="hljs-attr">strategy:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span><br>    <span class="hljs-attr">rollingUpdate:</span><br>      <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">50</span><span class="hljs-string">%</span><br>      <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">50</span><span class="hljs-string">%</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span>  &#125;&#125;<br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span>  &#125;&#125;<br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">nodeSelector:</span><br>        <span class="hljs-attr">namespaces:</span> &#123;&#123; <span class="hljs-string">.Values.image.namespace</span> &#125;&#125;<br>      <span class="hljs-attr">imagePullSecrets:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harborsecret</span> <br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span> &#125;&#125;<br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; .Values.image.repository &#125;&#125;</span>:<span class="hljs-template-variable">&#123;&#123; .Values.image.tag &#125;&#125;</span>&quot;</span><br>          <span class="hljs-attr">imagePullPolicy:</span> &#123;&#123; <span class="hljs-string">.Values.image.pullPolicy</span> &#125;&#125;<br>          <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span>  &#125;&#125;<br>          <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;bin/startup.sh&quot;</span>]<br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">port:</span>  &#123;&#123; <span class="hljs-string">.Values.service.port</span> &#125;&#125; <br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/actuator/health</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">100</span><br>            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">180</span><br>            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">10</span><br>            <span class="hljs-attr">successThreshold:</span> <span class="hljs-number">1</span><br>            <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">tcpSocket:</span><br>              <span class="hljs-attr">port:</span>  &#123;&#123; <span class="hljs-string">.Values.service.port</span> &#125;&#125;<br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">100</span><br>            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">30</span><br>            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">2</span><br>            <span class="hljs-attr">successThreshold:</span> <span class="hljs-number">1</span><br>            <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span><br>          <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/share/fonts/truetype</span> <span class="hljs-string">//</span> <span class="hljs-string">pod</span> <span class="hljs-string">å†…æŒ‚è½½è·¯å¾„</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">ttf-fonts</span>   <span class="hljs-string">//</span> <span class="hljs-string">æŒ‚åœ¨å·çš„åå­—</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/share/fonts/msttcore</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">msttcore</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/share/fonts/wqy-microhei</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">wqy-microhei</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/share/fonts/wqy-zenhei</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">wqy-zenhei</span><br>          <span class="hljs-attr">env:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">POD_NAMESPACE</span><br>            <span class="hljs-attr">valueFrom:</span><br>              <span class="hljs-attr">fieldRef:</span><br>                <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br>                <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">metadata.namespace</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SPRING_PROFILES_ACTIVE</span><br>            <span class="hljs-attr">value:</span> &#123;&#123; <span class="hljs-string">.Values.SPRING_PROFILES_ACTIVE</span>  &#125;&#125; <br>          <span class="hljs-attr">resources:</span><br>            &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.resources</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">12</span> &#125;&#125;<br>      <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ttf-fonts</span> <span class="hljs-string">//</span> <span class="hljs-string">æŒ‚è½½å·çš„åç§°ï¼Œå’Œä¸Šé¢è¦å¯¹åº”</span><br>        <span class="hljs-attr">hostPath:</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">/usr/share/fonts/truetype</span>  <span class="hljs-string">//</span> <span class="hljs-string">æœ¬åœ°éœ€è¦æŒ‚è½½çš„è·¯å¾„</span><br>          <span class="hljs-attr">type:</span> <span class="hljs-string">Directory</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">msttcore</span><br>      <span class="hljs-attr">hostPath:</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/usr/share/fonts/msttcore</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">Directory</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">wqy-microhei</span><br>      <span class="hljs-attr">hostPath:</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/usr/share/fonts/wqy-microhei</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">Directory</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">wqy-zenhei</span><br>      <span class="hljs-attr">hostPath:</span><br>      <span class="hljs-attr">path:</span> <span class="hljs-string">/usr/share/fonts/wqy-zenhei</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">Directory</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.affinity</span> &#125;&#125;<br>      <span class="hljs-attr">affinity:</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">8</span> &#125;&#125;<br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.tolerations</span> &#125;&#125;<br>      <span class="hljs-attr">tolerations:</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">8</span> &#125;&#125;<br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€å¼•å…¥-selenium-ä¾èµ–"><a href="#3ã€å¼•å…¥-selenium-ä¾èµ–" class="headerlink" title="3ã€å¼•å…¥ selenium ä¾èµ–"></a>3ã€å¼•å…¥ selenium ä¾èµ–</h3><h4 id="1ï¼‰Springboot-é¡¹ç›®"><a href="#1ï¼‰Springboot-é¡¹ç›®" class="headerlink" title="1ï¼‰Springboot é¡¹ç›®"></a>1ï¼‰Springboot é¡¹ç›®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.seleniumhq.selenium<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>selenium-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.141.59<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="2ï¼‰Python-é¡¹ç›®"><a href="#2ï¼‰Python-é¡¹ç›®" class="headerlink" title="2ï¼‰Python é¡¹ç›®"></a>2ï¼‰Python é¡¹ç›®</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install selenium<br></code></pre></td></tr></table></figure><h3 id="4ã€ç½‘é¡µæ•´é¡µè½¬åŒ–æˆå›¾ç‰‡ä»£ç ç¤ºä¾‹"><a href="#4ã€ç½‘é¡µæ•´é¡µè½¬åŒ–æˆå›¾ç‰‡ä»£ç ç¤ºä¾‹" class="headerlink" title="4ã€ç½‘é¡µæ•´é¡µè½¬åŒ–æˆå›¾ç‰‡ä»£ç ç¤ºä¾‹"></a>4ã€ç½‘é¡µæ•´é¡µè½¬åŒ–æˆå›¾ç‰‡ä»£ç ç¤ºä¾‹</h3><h4 id="1ï¼‰Springboot-é¡¹ç›®-1"><a href="#1ï¼‰Springboot-é¡¹ç›®-1" class="headerlink" title="1ï¼‰Springboot é¡¹ç›®"></a>1ï¼‰Springboot é¡¹ç›®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">convertHtml2Image</span><span class="hljs-params">(String url)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;ã€€ã€€ã€€ã€€ã€€<br>        System.setProperty(<span class="hljs-string">&quot;webdriver.chrome.driver&quot;</span>, <span class="hljs-string">&quot;/usr/bin/chromedriver&quot;</span>);ã€€ã€€ã€€ã€€<span class="hljs-comment">// è®¾ç½® chromedriver åœ°å€</span><br>        System.setProperty(<span class="hljs-string">&quot;webdriver.chrome.silentOutput&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<span class="hljs-comment">// å…³é—­æ—¥å¿—</span><br>        <span class="hljs-comment">//å®ä¾‹åŒ–ä¸€ä¸ªChromeæµè§ˆå™¨çš„å®ä¾‹</span><br>        ChromeOptions options = <span class="hljs-keyword">new</span> ChromeOptions();<br>        <span class="hljs-comment">// å­—ç¬¦ç¼–ç  utf-8 æ”¯æŒä¸­æ–‡å­—ç¬¦</span><br>        options.addArguments(<span class="hljs-string">&quot;lang=zh_CN.UTF-8&quot;</span>);<br>        <span class="hljs-comment">// å¼€å¯æœ€å¤§åŒ–</span><br>        options.addArguments(<span class="hljs-string">&quot;â€“start-maximized&quot;</span>);<br>        options.addArguments(<span class="hljs-string">&quot;â€“no-sandbox&quot;</span>);<br>        <span class="hljs-comment">// å¼€å¯æ— å¤´æ¨¡å¼</span><br>        options.addArguments(<span class="hljs-string">&quot;--headless&quot;</span>);<br>        options.addArguments(<span class="hljs-string">&quot;--disable-gpu&quot;</span>);        <br>  options.addArguments(<span class="hljs-string">&quot;--window-size=1920,1080&quot;</span>);        <br>  options.addArguments(<span class="hljs-string">&quot;--silent&quot;</span>);             <br>  options.addArguments(<span class="hljs-string">&quot;--disable-logging&quot;</span>);<span class="hljs-comment">// å…³é—­æ—¥å¿—   </span><br>        WebDriver driver = <span class="hljs-keyword">new</span> ChromeDriver(options);<br>        driver.get(url);<br>        Thread.sleep(<span class="hljs-number">3000</span>);<br>        <span class="hljs-keyword">int</span> height = Integer.parseInt((String) ((JavascriptExecutor) driver).executeScript(<span class="hljs-string">&quot;return document.body.scrollHeight.toString()&quot;</span>));<br>        <span class="hljs-keyword">int</span> width = Integer.parseInt((String) ((JavascriptExecutor) driver).executeScript(<span class="hljs-string">&quot;return document.body.scrollWidth.toString()&quot;</span>));<br><br>        driver.manage().window().setSize(<span class="hljs-keyword">new</span> Dimension(width, height));<br>        driver.manage().window().maximize();<br>        <span class="hljs-comment">//æˆªå±æ“ä½œ</span><br>        <span class="hljs-comment">//æˆªå›¾åˆ°output</span><br>        File scrFile = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);<br>        <span class="hljs-keyword">try</span> &#123;<br>            String desImage = UUID.randomUUID().toString() + <span class="hljs-string">&quot;.png&quot;</span>;<br>            <span class="hljs-comment">//å¤åˆ¶å†…å®¹åˆ°æŒ‡å®šæ–‡ä»¶ä¸­</span><br>            FileUtil.copyFile(scrFile, <span class="hljs-keyword">new</span> File(desImage));<br>            System.out.println(desImage);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        driver.close();<br>    &#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰Python-é¡¹ç›®-1"><a href="#2ï¼‰Python-é¡¹ç›®-1" class="headerlink" title="2ï¼‰Python é¡¹ç›®"></a>2ï¼‰Python é¡¹ç›®</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> time, os<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Html2Image</span>(<span class="hljs-params">url,fname</span>):</span><br>    v_url = url<br>    chrome_driver = <span class="hljs-string">&quot;&quot;&quot;/usr/bin/chromedriver&quot;&quot;&quot;</span> <span class="hljs-comment"># è®¾ç½® chromedriver åœ°å€</span><br>    save_fn = fname + <span class="hljs-string">&#x27;.png&#x27;</span><br>    option = webdriver.ChromeOptions()<br>    option.add_argument(<span class="hljs-string">&#x27;--headless&#x27;</span>)<span class="hljs-comment"># å¼€å¯æ— å¤´æ¨¡å¼</span><br>    option.add_argument(<span class="hljs-string">&#x27;--disable-gpu&#x27;</span>)<br>    option.add_argument(<span class="hljs-string">&quot;--window-size=900,1200&quot;</span>)<span class="hljs-comment">#image size</span><br>    option.add_argument(<span class="hljs-string">&quot;--hide-scrollbars&quot;</span>)<br>    driver = webdriver.Chrome(options=option,executable_path=chrome_driver)<br>    driver.get(v_url)<br>    time.sleep(<span class="hljs-number">5</span>)<br>    scroll_width = driver.execute_script(<span class="hljs-string">&#x27;return document.body.parentNode.scrollWidth&#x27;</span>)<br>    scroll_height = driver.execute_script(<span class="hljs-string">&#x27;return document.body.parentNode.scrollHeight&#x27;</span>)<br>    driver.set_window_size(scroll_width, scroll_height)<br>    <span class="hljs-comment">#æ‰“å¼€htmlæ–‡ä»¶æˆªå›¾ä¸ºå›¾ç‰‡</span><br>    driver.save_screenshot(save_fn)<br>    time.sleep(<span class="hljs-number">5</span>)<br>    driver.quit()<br>    <span class="hljs-comment">#ç”Ÿæˆhtmlæ–‡ä»¶ï¼ŒåµŒå…¥ä¸Šé¢ç”Ÿæˆçš„å›¾ç‰‡</span><br>    im = Image.<span class="hljs-built_in">open</span>(save_fn)<br>    w, h = im.size<br>    imgCount = h // <span class="hljs-number">2000</span> + <span class="hljs-number">1</span><br>    size = h / imgCount<br>    left = <span class="hljs-number">0</span><br>    shang = <span class="hljs-number">0</span><br>    index = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(imgCount):<br>        i = i + <span class="hljs-number">1</span><br>        shang += <span class="hljs-number">1</span><br>        a = size * left<br>        b = size * (i - <span class="hljs-number">1</span>)<br>        c = w<br>        d = size * i<br>        region = im.crop((a, b, c, d))<br>        region.save(<span class="hljs-string">&quot;report%s.png&quot;</span> % i)<br><br>    fp = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;report.html&quot;</span>, <span class="hljs-string">&quot;w+b&quot;</span>)  <span class="hljs-comment"># æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, imgCount + <span class="hljs-number">1</span>):<br>        fp.write(<span class="hljs-built_in">bytes</span>(<span class="hljs-string">&#x27;&lt;img src=&quot;report&#x27;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&#x27;.png&quot;&gt;&lt;/img&gt;&#x27;</span>,<span class="hljs-string">&#x27;utf-8&#x27;</span>))  <span class="hljs-comment"># å†™å…¥æ•°æ®</span><br>    fp.close()  <span class="hljs-comment"># å…³é—­æ–‡ä»¶</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    Html2Image(url=<span class="hljs-string">&quot;file:///tools/scripts/oradbinfo/storage_report_HtmlResult.html&quot;</span>,fname=<span class="hljs-string">&#x27;storage_report_HtmlResult&#x27;</span>)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯æŠ€æœ¯æ ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é—®é¢˜è§£å†³æ–¹æ¡ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Go template è¯¦è§£</title>
    <link href="/2021/09/01/Go-template-%E8%AF%A6%E8%A7%A3/"/>
    <url>/2021/09/01/Go-template-%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Go-template-è¯¦è§£"><a href="#Go-template-è¯¦è§£" class="headerlink" title="Go template è¯¦è§£"></a>Go template è¯¦è§£</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
      <category>Go æ ‡å‡†åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes éƒ¨ç½² APISIX</title>
    <link href="/2021/08/31/Kubernetes-%E9%83%A8%E7%BD%B2-APISIX/"/>
    <url>/2021/08/31/Kubernetes-%E9%83%A8%E7%BD%B2-APISIX/</url>
    
    <content type="html"><![CDATA[<h1 id="Kubernetes-éƒ¨ç½²-APISIX"><a href="#Kubernetes-éƒ¨ç½²-APISIX" class="headerlink" title="Kubernetes éƒ¨ç½² APISIX"></a>Kubernetes éƒ¨ç½² APISIX</h1><span id="more"></span><h2 id="ä¸€ã€ç¯å¢ƒå‡†å¤‡"><a href="#ä¸€ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ä¸€ã€ç¯å¢ƒå‡†å¤‡"></a>ä¸€ã€ç¯å¢ƒå‡†å¤‡</h2><h3 id="1ã€ç¯å¢ƒè¯´æ˜"><a href="#1ã€ç¯å¢ƒè¯´æ˜" class="headerlink" title="1ã€ç¯å¢ƒè¯´æ˜"></a>1ã€ç¯å¢ƒè¯´æ˜</h3><table><thead><tr><th>æ‰€éœ€ç»„ä»¶</th><th>ç‰ˆæœ¬è¯´æ˜</th></tr></thead><tbody><tr><td>K8S</td><td>Minikubeï¼ˆK8S v1.18.18ï¼‰</td></tr><tr><td>helm</td><td>helm3ï¼ˆv3.5.4ï¼‰</td></tr><tr><td>apisix-admin</td><td>v2.8.0</td></tr><tr><td>apisix-dashboard</td><td>v2.7.1</td></tr><tr><td>apisix-ingress-controller</td><td>v1.2.0</td></tr></tbody></table><h3 id="2ã€å¿…è¦ç»„ä»¶å‡†å¤‡"><a href="#2ã€å¿…è¦ç»„ä»¶å‡†å¤‡" class="headerlink" title="2ã€å¿…è¦ç»„ä»¶å‡†å¤‡"></a>2ã€å¿…è¦ç»„ä»¶å‡†å¤‡</h3><h4 id="1ï¼‰minikube-k8s-ç¯å¢ƒæ­å»º"><a href="#1ï¼‰minikube-k8s-ç¯å¢ƒæ­å»º" class="headerlink" title="1ï¼‰minikube k8s ç¯å¢ƒæ­å»º"></a>1ï¼‰minikube k8s ç¯å¢ƒæ­å»º</h4><p>å‚è€ƒä¹‹å‰çš„æ–‡æ¡£: <a href="https://tareya.github.io/2021/08/10/MiniKube-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C/">MiniKube å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</a></p><h4 id="2ï¼‰helm-å®‰è£…"><a href="#2ï¼‰helm-å®‰è£…" class="headerlink" title="2ï¼‰helm å®‰è£…"></a>2ï¼‰helm å®‰è£…</h4><p>å‚è€ƒä¹‹å‰çš„åšå®¢: <a href="https://tareya.github.io/2021/07/24/%E7%AC%AC2%E7%AB%A0%E3%80%81Helm3-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/">Helm3 å®‰è£…éƒ¨ç½²</a> </p><h3 id="3ã€æ·»åŠ -APISIX-é•œåƒä»“åº“"><a href="#3ã€æ·»åŠ -APISIX-é•œåƒä»“åº“" class="headerlink" title="3ã€æ·»åŠ  APISIX é•œåƒä»“åº“"></a>3ã€æ·»åŠ  APISIX é•œåƒä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo add apisix https://charts.apiseven.com<br>helm repo update<br></code></pre></td></tr></table></figure><h3 id="4ã€APISIX-ç‰ˆæœ¬é€‰æ‹©"><a href="#4ã€APISIX-ç‰ˆæœ¬é€‰æ‹©" class="headerlink" title="4ã€APISIX ç‰ˆæœ¬é€‰æ‹©"></a>4ã€APISIX ç‰ˆæœ¬é€‰æ‹©</h3><h4 id="1ï¼‰åœºæ™¯ä»‹ç»"><a href="#1ï¼‰åœºæ™¯ä»‹ç»" class="headerlink" title="1ï¼‰åœºæ™¯ä»‹ç»"></a>1ï¼‰åœºæ™¯ä»‹ç»</h4><p>ä½¿ç”¨ Nacos ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå¹¶é€šè¿‡ APISIX çš„ nacos discovery å®ç°æœåŠ¡æ³¨å†ŒèŠ‚ç‚¹çš„åŠ¨æ€è·å–ã€‚åŸæœ¬å®‰è£…ç‰ˆæœ¬ä¸º 2.6.0ï¼Œå¯¹äº nacos å€¼æ”¯æŒå°šå¤„äºå¼€å‘é˜¶æ®µã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210903103018772.png" alt="image-20210903103018772"></p><h4 id="2ï¼‰ç‰ˆæœ¬é€‰æ‹©"><a href="#2ï¼‰ç‰ˆæœ¬é€‰æ‹©" class="headerlink" title="2ï¼‰ç‰ˆæœ¬é€‰æ‹©"></a>2ï¼‰ç‰ˆæœ¬é€‰æ‹©</h4><p>æ ¹æ®å®˜æ–¹å‘å¸ƒçš„æœåŠ¡ changelogï¼Œ2.7.0 ä¹‹åçš„ç‰ˆæœ¬å¯¹äº nacos discovery æœ‰äº†ä¸€å®šçš„å‡çº§ï¼Œæ•…é€‰æ‹©çš„ç‰ˆæœ¬éœ€æ—¶ 2.7.0 ä¹‹åçš„ç‰ˆæœ¬ã€‚</p><p><a href="https://github.com/apache/apisix/blob/release/2.9/CHANGELOG.md#270"><strong>CHANGELOG</strong></a></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210903103359426.png" alt="image-20210903103359426"></p><p>ç›®å‰å®˜æ–¹ dockerhub æä¾›çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬é•œåƒä¸º 2.8.0 ï¼Œæ•…æœ¬æ¬¡ç‰ˆæœ¬ï¼Œé€‰æ‹©ä½¿ç”¨ 2.8.0 çš„ç‰ˆæœ¬ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å®˜æ–¹æä¾›çš„æ–¹å¼ç¼–è¯‘æœ€æ–°ç‰ˆæœ¬çš„é•œåƒï¼Œçœ‹ä¸ªäººéœ€æ±‚ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210903104639074.png" alt="image-20210903104639074"></p><p><a href="https://hub.docker.com/r/apache/apisix">apisix å®˜æ–¹é•œåƒ</a></p><p><a href="https://hub.docker.com/r/apache/apisix-dashboard">apisix-dashboard å®˜æ–¹é•œåƒ</a></p><p><a href="https://hub.docker.com/r/apache/apisix-ingress-controller">apisix-ingress-controller å®˜æ–¹é•œåƒ</a></p><h4 id="3ï¼‰æŸ¥çœ‹å®˜æ–¹æä¾›çš„-chart"><a href="#3ï¼‰æŸ¥çœ‹å®˜æ–¹æä¾›çš„-chart" class="headerlink" title="3ï¼‰æŸ¥çœ‹å®˜æ–¹æä¾›çš„ chart"></a>3ï¼‰æŸ¥çœ‹å®˜æ–¹æä¾›çš„ chart</h4><blockquote><p>ğŸš© å®˜æ–¹æä¾›çš„ chart ä½¿ç”¨çš„ç‰ˆæœ¬ä¸æˆ‘ä»¬æœŸæœ›çš„ç‰ˆæœ¬ä¸å®Œå…¨ç›¸ç¬¦ï¼Œä½†æ˜¯æ•´ä½“çš„èµ„æºç»“æ„ä¸ä¼šæœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åŸºäºå®˜æ–¹æä¾›çš„ chart å»åˆ¶ä½œæˆ‘ä»¬è‡ªå·±éœ€è¦çš„ chartï¼Œç„¶åå†é€šè¿‡ helm è¿›è¡Œçº³ç®¡ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm search repo apisix<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210903105314277.png" alt="image-20210903105314277"></p><h2 id="äºŒã€éƒ¨ç½²-APISIX"><a href="#äºŒã€éƒ¨ç½²-APISIX" class="headerlink" title="äºŒã€éƒ¨ç½² APISIX"></a>äºŒã€éƒ¨ç½² APISIX</h2><h3 id="1ã€å‡†å¤‡-chart"><a href="#1ã€å‡†å¤‡-chart" class="headerlink" title="1ã€å‡†å¤‡ chart"></a>1ã€å‡†å¤‡ chart</h3><h4 id="1ï¼‰æ‹‰å–å®˜æ–¹-chart"><a href="#1ï¼‰æ‹‰å–å®˜æ–¹-chart" class="headerlink" title="1ï¼‰æ‹‰å–å®˜æ–¹ chart"></a>1ï¼‰æ‹‰å–å®˜æ–¹ chart</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm pull apisix/apisix <br></code></pre></td></tr></table></figure><h4 id="2ï¼‰è§£å‹-chart-åŒ…"><a href="#2ï¼‰è§£å‹-chart-åŒ…" class="headerlink" title="2ï¼‰è§£å‹ chart åŒ…"></a>2ï¼‰è§£å‹ chart åŒ…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xf apisix-0.4.0.tgz<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰chart-çš„ç›®å½•ç»“æ„"><a href="#3ï¼‰chart-çš„ç›®å½•ç»“æ„" class="headerlink" title="3ï¼‰chart çš„ç›®å½•ç»“æ„"></a>3ï¼‰chart çš„ç›®å½•ç»“æ„</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tree -L 3 apisix<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210903110331471.png" alt="image-20210903110331471"></p><h4 id="4ï¼‰è¯†åˆ«ä¾èµ–ç»„ä»¶"><a href="#4ï¼‰è¯†åˆ«ä¾èµ–ç»„ä»¶" class="headerlink" title="4ï¼‰è¯†åˆ«ä¾èµ–ç»„ä»¶"></a>4ï¼‰è¯†åˆ«ä¾èµ–ç»„ä»¶</h4><p>ä»å®˜æ–¹ chart çš„çš„ç›®å½•ç»“æ„å¯ä»¥çœ‹å‡ºï¼Œéƒ¨ç½² apisix åŒæ—¶è¿˜ä¼šæœ‰ <code>etcd</code>ã€<code>dashboard</code>ã€<code>ingress-controller</code> ä¸‰ä¸ªä¾èµ–ç»„ä»¶ï¼ŒåŸºæœ¬å’Œéå®¹å™¨åŒ–éƒ¨ç½²æ˜¯ä¸€æ ·çš„ã€‚etcd ä½œä¸ºæ•°æ®å­˜å‚¨ï¼Œdashboard æä¾› UI ç•Œé¢ï¼Œè€Œ ingress-controller åˆ™ç›¸å½“äº openrestyã€‚</p><h5 id="1-etcdé›†ç¾¤"><a href="#1-etcdé›†ç¾¤" class="headerlink" title="1. etcdé›†ç¾¤"></a>1. etcdé›†ç¾¤</h5><p>etcd åªæ˜¯ä½œä¸ºæ•°æ®å­˜å‚¨æ¥è¯´ï¼Œå®ƒçš„ç‰ˆæœ¬å…¶å®å¹¶ä¸éœ€è¦è¿‡å¤šè€ƒè™‘ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ K8S æœ¬èº«çš„ etcd é›†ç¾¤ï¼Œä½†æ˜¯ä¸æ¨èè¿™ä¹ˆåšã€‚</p><h5 id="2-apisix-dashboard"><a href="#2-apisix-dashboard" class="headerlink" title="2. apisix-dashboard"></a>2. apisix-dashboard</h5><p>dashboard æ ¹æ®ä¸Šæ–‡å¯çŸ¥ï¼Œæœ€æ–°çš„é•œåƒç‰ˆæœ¬ä¸º 2.7.1 ï¼Œè¿™æ˜¯æˆ‘ä»¬éœ€è¦æ›´æ”¹çš„ã€‚</p><h5 id="3-apisix-ingress-controller"><a href="#3-apisix-ingress-controller" class="headerlink" title="3. apisix-ingress-controller"></a>3. apisix-ingress-controller</h5><p>ingress-controller å®é™…ä¸Šå°±æ˜¯ ingressï¼Œå…¶ä½¿ç”¨çš„ api group æ˜¯éš K8S ç‰ˆæœ¬çš„ï¼Œå› æ­¤éœ€è¦æ ¹æ®å®é™…çš„ k8S ç‰ˆæœ¬ä¿®æ”¹ingress çš„ç‰ˆæœ¬ã€‚å®˜æ–¹ç»™å‡ºçš„å‚æ•°è§£é‡Šå¦‚ä¸‹:</p><blockquote><h3 id="ingress-version"><a href="#ingress-version" class="headerlink" title="ingress version"></a><a href="https://apisix.apache.org/docs/helm-chart/apisix-ingress-controller#ingress-version">ingress version</a></h3><p>By default apisix-ingress-controller watches the <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Ingress</a> resources in api group <code>networking/v1</code>, however, if your Kubernetes cluster is prior to <code>v1.19</code>, you need to change the ingress watching version.</p><p>If your Kubernetes version is older than <code>v1.14</code>, then:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install apisix-ingress-controller apisix/apisix-ingress-controller --namespace ingress-apisix --set config.kubernetes.ingressVersion=extensions/v1beta1<br></code></pre></td></tr></table></figure><p>Or if your Kubernetes version is between <code>v1.14</code> and <code>v1.19</code>, try below:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shel">helm install apisix-ingress-controller apisix/apisix-ingress-controller --namespace ingress-apisix --set config.kubernetes.ingressVersion=networking/v1beta1<br></code></pre></td></tr></table></figure></blockquote><p>æœ¬æ–‡ä½¿ç”¨çš„ K8S ç¯å¢ƒä¸º v1.18.18 ç‰ˆæœ¬ï¼Œå…¶ç½‘ç»œ api ç»„ä¸º beta ç‰ˆæœ¬ï¼Œæ•… ingress ç‰ˆæœ¬éœ€é€‰ç”¨ <code>networking/v1beta1</code>ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ chart ä¸­å®šä¹‰ï¼Œæˆ–åˆ™åœ¨å‘å¸ƒæ—¶è¿›è¡Œå‚æ•°å®šä¹‰ã€‚</p><h3 id="2ã€ä¿®æ”¹-chart-é…ç½®"><a href="#2ã€ä¿®æ”¹-chart-é…ç½®" class="headerlink" title="2ã€ä¿®æ”¹ chart é…ç½®"></a>2ã€ä¿®æ”¹ chart é…ç½®</h3><h4 id="1ï¼‰apisix-dashboard"><a href="#1ï¼‰apisix-dashboard" class="headerlink" title="1ï¼‰apisix-dashboard"></a>1ï¼‰apisix-dashboard</h4><h5 id="1-Chart-yaml"><a href="#1-Chart-yaml" class="headerlink" title="1. Chart.yaml"></a>1. Chart.yaml</h5><p>æ–‡ä»¶è·¯å¾„: <code>apisix/charts/apisix-dashboard/Chart.yaml</code>ï¼Œä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v2</span><br><span class="hljs-attr">appVersion:</span> <span class="hljs-number">2.7</span><span class="hljs-number">.1</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">A</span> <span class="hljs-string">Helm</span> <span class="hljs-string">chart</span> <span class="hljs-string">for</span> <span class="hljs-string">Apache</span> <span class="hljs-string">APISIX</span> <span class="hljs-string">Dashboard</span><br><span class="hljs-attr">icon:</span> <span class="hljs-string">https://apache.org/logos/res/apisix/apisix.png</span><br><span class="hljs-attr">maintainers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Tareya</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">apisix-dashboard</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">application</span><br><span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.6</span><br></code></pre></td></tr></table></figure><h5 id="3-templates-service-yaml"><a href="#3-templates-service-yaml" class="headerlink" title="3. templates/service.yaml"></a>3. templates/service.yaml</h5><p>æ–‡ä»¶è·¯å¾„: <code>apisix/charts/apisix-dashboard/templates/service.yaml</code>ï¼Œä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#</span><br><span class="hljs-comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="hljs-comment"># contributor license agreements.  See the NOTICE file distributed with</span><br><span class="hljs-comment"># this work for additional information regarding copyright ownership.</span><br><span class="hljs-comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="hljs-comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="hljs-comment"># the License.  You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"># See the License for the specific language governing permissions and</span><br><span class="hljs-comment"># limitations under the License.</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;apisix-dashboard.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>  <span class="hljs-attr">namespace:</span> &#123;&#123; <span class="hljs-string">.Release.Namespace</span> &#125;&#125;<br>  <span class="hljs-attr">labels:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">include</span> <span class="hljs-string">&quot;apisix-dashboard.labels&quot;</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> &#123;&#123; <span class="hljs-string">.Values.service.type</span> &#125;&#125;<br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> &#123;&#123; <span class="hljs-string">.Values.service.port</span> &#125;&#125;<br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-string">http</span><br>      <span class="hljs-attr">nodePort:</span> &#123;&#123; <span class="hljs-string">.Values.service.nodePort</span> &#125;&#125;<br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>  <span class="hljs-attr">selector:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">include</span> <span class="hljs-string">&quot;apisix-dashboard.selectorLabels&quot;</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br><br></code></pre></td></tr></table></figure><h5 id="2-values-yaml"><a href="#2-values-yaml" class="headerlink" title="2. values.yaml"></a>2. values.yaml</h5><p>æ–‡ä»¶è·¯å¾„: <code>apisix/charts/apisix-dashboard/values.yaml</code>ï¼Œä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#</span><br><span class="hljs-comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="hljs-comment"># contributor license agreements.  See the NOTICE file distributed with</span><br><span class="hljs-comment"># this work for additional information regarding copyright ownership.</span><br><span class="hljs-comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="hljs-comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="hljs-comment"># the License.  You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"># See the License for the specific language governing permissions and</span><br><span class="hljs-comment"># limitations under the License.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Default values for apisix-dashboard.</span><br><span class="hljs-comment"># This is a YAML-formatted file.</span><br><span class="hljs-comment"># Declare variables to be passed into your templates.</span><br><br><span class="hljs-attr">replicaCount:</span> <span class="hljs-number">1</span><br><br><span class="hljs-attr">image:</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">apache/apisix-dashboard</span><br>  <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>  <span class="hljs-comment"># Overrides the image tag whose default is the chart appVersion.</span><br>  <span class="hljs-attr">tag:</span> <span class="hljs-string">&quot;2.7.1&quot;</span><br><br><span class="hljs-attr">imagePullSecrets:</span> []<br><span class="hljs-attr">nameOverride:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">fullnameOverride:</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-attr">serviceAccount:</span><br>  <span class="hljs-comment"># Specifies whether a service account should be created</span><br>  <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># Annotations to add to the service account</span><br>  <span class="hljs-attr">annotations:</span> &#123;&#125;<br>  <span class="hljs-comment"># The name of the service account to use.</span><br>  <span class="hljs-comment"># If not set and create is true, a name is generated using the fullname template</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-attr">podAnnotations:</span> &#123;&#125;<br><br><span class="hljs-attr">podSecurityContext:</span> &#123;&#125;<br>  <span class="hljs-comment"># fsGroup: 2000</span><br><br><span class="hljs-attr">securityContext:</span> &#123;&#125;<br>  <span class="hljs-comment"># capabilities:</span><br>  <span class="hljs-comment">#   drop:</span><br>  <span class="hljs-comment">#   - ALL</span><br>  <span class="hljs-comment"># readOnlyRootFilesystem: true</span><br>  <span class="hljs-comment"># runAsNonRoot: true</span><br>  <span class="hljs-comment"># runAsUser: 1000</span><br><br><span class="hljs-attr">config:</span><br>  <span class="hljs-attr">conf:</span><br>    <span class="hljs-attr">listen:</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br>    <span class="hljs-attr">etcd:</span><br>      <span class="hljs-comment"># Supports defining multiple etcd host addresses for an etcd cluster</span><br>      <span class="hljs-attr">endpoints:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">apisix-etcd:2379</span><br>      <span class="hljs-comment"># Etcd basic auth info</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">~</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">~</span><br>    <span class="hljs-attr">log:</span><br>      <span class="hljs-attr">errorLog:</span><br>        <span class="hljs-attr">level:</span> <span class="hljs-string">warn</span><br>        <span class="hljs-attr">filePath:</span> <span class="hljs-string">/dev/stderr</span><br>      <span class="hljs-attr">accessLog:</span><br>        <span class="hljs-attr">filePath:</span> <span class="hljs-string">/dev/stdout</span><br><br>  <span class="hljs-attr">authentication:</span><br>    <span class="hljs-attr">secert:</span> <span class="hljs-string">secert</span><br>    <span class="hljs-attr">expireTime:</span> <span class="hljs-number">3600</span><br>    <span class="hljs-attr">users:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">admin</span><br><br><span class="hljs-attr">service:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br>  <span class="hljs-attr">nodePort:</span> <span class="hljs-number">9980</span><br><br><span class="hljs-attr">ingress:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">annotations:</span> &#123;&#125;<br>    <span class="hljs-comment"># kubernetes.io/ingress.class: nginx</span><br>    <span class="hljs-comment"># kubernetes.io/tls-acme: &quot;true&quot;</span><br>  <span class="hljs-attr">hosts:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-string">apisix-dashboard.local</span><br>      <span class="hljs-attr">paths:</span> []<br>  <span class="hljs-attr">tls:</span> []<br>  <span class="hljs-comment">#  - secretName: chart-example-tls</span><br>  <span class="hljs-comment">#    hosts:</span><br>  <span class="hljs-comment">#      - chart-example.local</span><br><br><span class="hljs-attr">resources:</span> &#123;&#125;<br>  <span class="hljs-comment"># We usually recommend not to specify default resources and to leave this as a conscious</span><br>  <span class="hljs-comment"># choice for the user. This also increases chances charts run on environments with little</span><br>  <span class="hljs-comment"># resources, such as Minikube. If you do want to specify resources, uncomment the following</span><br>  <span class="hljs-comment"># lines, adjust them as necessary, and remove the curly braces after &#x27;resources:&#x27;.</span><br>  <span class="hljs-comment"># limits:</span><br>  <span class="hljs-comment">#   cpu: 100m</span><br>  <span class="hljs-comment">#   memory: 128Mi</span><br>  <span class="hljs-comment"># requests:</span><br>  <span class="hljs-comment">#   cpu: 100m</span><br>  <span class="hljs-comment">#   memory: 128Mi</span><br><br><span class="hljs-attr">autoscaling:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">minReplicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">100</span><br>  <span class="hljs-attr">targetCPUUtilizationPercentage:</span> <span class="hljs-number">80</span><br>  <span class="hljs-comment"># targetMemoryUtilizationPercentage: 80</span><br><br><span class="hljs-attr">nodeSelector:</span> &#123;&#125;<br><br><span class="hljs-attr">tolerations:</span> []<br><br><span class="hljs-attr">affinity:</span> &#123;&#125;<br><br></code></pre></td></tr></table></figure><h4 id="2ï¼‰apisix-ingress-controller"><a href="#2ï¼‰apisix-ingress-controller" class="headerlink" title="2ï¼‰apisix-ingress-controller"></a>2ï¼‰apisix-ingress-controller</h4><h5 id="1-Chart-yaml-1"><a href="#1-Chart-yaml-1" class="headerlink" title="1. Chart.yaml"></a>1. Chart.yaml</h5><p>æ–‡ä»¶è·¯å¾„: <code>apisix/charts/apisix-ingress-controller/Chart.yaml</code>ï¼Œä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v2</span><br><span class="hljs-attr">appVersion:</span> <span class="hljs-number">1.2</span><span class="hljs-number">.0</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">Apache</span> <span class="hljs-string">APISIX</span> <span class="hljs-string">Ingress</span> <span class="hljs-string">Controller</span> <span class="hljs-string">for</span> <span class="hljs-string">Kubernetes</span><br><span class="hljs-attr">icon:</span> <span class="hljs-string">https://apache.org/logos/res/apisix/apisix.png</span><br><span class="hljs-attr">keywords:</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">ingress</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">apisix</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">nginx</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">crd</span><br><span class="hljs-attr">maintainers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Tareya</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">apisix-ingress-controller</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">application</span><br><span class="hljs-attr">version:</span> <span class="hljs-number">0.7</span><span class="hljs-number">.1</span><br></code></pre></td></tr></table></figure><h5 id="2-values-yaml-1"><a href="#2-values-yaml-1" class="headerlink" title="2. values.yaml"></a>2. values.yaml</h5><p>æ–‡ä»¶è·¯å¾„: <code>apisix/charts/apisix-ingress-controller/values.yaml</code>ï¼Œä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#</span><br><span class="hljs-comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="hljs-comment"># contributor license agreements.  See the NOTICE file distributed with</span><br><span class="hljs-comment"># this work for additional information regarding copyright ownership.</span><br><span class="hljs-comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="hljs-comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="hljs-comment"># the License.  You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"># See the License for the specific language governing permissions and</span><br><span class="hljs-comment"># limitations under the License.</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># Default values for apisix-ingress-controller.</span><br><span class="hljs-comment"># This is a YAML-formatted file.</span><br><span class="hljs-comment"># Declare variables to be passed into your templates.</span><br><span class="hljs-comment">#</span><br><span class="hljs-attr">nameOverride:</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-attr">fullnameOverride:</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-attr">rbac:</span><br>  <span class="hljs-comment"># Specifies whether RBAC resources should be created</span><br>  <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-attr">serviceAccount:</span><br>  <span class="hljs-comment"># Specifies whether a ServiceAccount should be created</span><br>  <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># The name of the ServiceAccount to use.</span><br>  <span class="hljs-comment"># If not set and create is true, a name is generated using the fullname template</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-comment"># Whether automounting API credentials for a service account</span><br>  <span class="hljs-attr">automountServiceAccountToken:</span> <span class="hljs-literal">true</span><br><br><br><span class="hljs-attr">replicaCount:</span> <span class="hljs-number">1</span><br><br><span class="hljs-attr">image:</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">apache/apisix-ingress-controller</span><br>  <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>  <span class="hljs-attr">tag:</span> <span class="hljs-string">&quot;1.2.0&quot;</span><br><br><span class="hljs-attr">imagePullSecrets:</span> []<br><br><span class="hljs-attr">service:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br><br><span class="hljs-attr">config:</span><br>  <span class="hljs-comment"># the error log level, default is info, optional values are:</span><br>  <span class="hljs-comment"># debug</span><br>  <span class="hljs-comment"># info</span><br>  <span class="hljs-comment"># warn</span><br>  <span class="hljs-comment"># error</span><br>  <span class="hljs-comment"># panic</span><br>  <span class="hljs-comment"># fatal</span><br>  <span class="hljs-attr">logLevel:</span> <span class="hljs-string">&quot;info&quot;</span><br>  <span class="hljs-comment"># the output file path of error log, default is stderr, when</span><br>  <span class="hljs-comment"># the file path is &quot;stderr&quot; or &quot;stdout&quot;, logs are marshalled</span><br>  <span class="hljs-comment"># plainly, which is more readable for human; otherwise logs</span><br>  <span class="hljs-comment"># are marshalled in JSON format, which can be parsed by</span><br>  <span class="hljs-comment"># programs easily.</span><br>  <span class="hljs-attr">logOutput:</span> <span class="hljs-string">&quot;stderr&quot;</span><br>  <span class="hljs-comment"># the HTTP Server listen address, default is &quot;:8080&quot;</span><br>  <span class="hljs-attr">httpListen:</span> <span class="hljs-string">&quot;:8080&quot;</span><br>  <span class="hljs-comment"># enable profiling via web interfaces host:port/debug/pprof, default is true.</span><br>  <span class="hljs-attr">enableProfiling:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># Kubernetes related configurations.</span><br>  <span class="hljs-attr">kubernetes:</span><br>    <span class="hljs-comment"># the Kubernetes configuration file path, default is &quot;&quot;, so the in-cluster</span><br>    <span class="hljs-comment"># configuration will be used.</span><br>    <span class="hljs-attr">kubeconfig:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-comment"># how long should apisix-ingress-controller re-synchronizes with Kubernetes,</span><br>    <span class="hljs-comment"># default is 6h,</span><br>    <span class="hljs-attr">resyncInterval:</span> <span class="hljs-string">&quot;6h&quot;</span><br>    <span class="hljs-comment"># namespace list that controller will watch for resources,</span><br>    <span class="hljs-comment"># by default all namespaces (represented by &quot;*&quot;) are watched.</span><br>    <span class="hljs-attr">appNamespaces:</span> [<span class="hljs-string">&quot;*&quot;</span>]<br>    <span class="hljs-comment"># the election id for the controller leader campaign,</span><br>    <span class="hljs-comment"># only the leader will watch and delivery resource changes,</span><br>    <span class="hljs-comment"># other instances (as candidates) stand by.</span><br>    <span class="hljs-attr">electionId:</span> <span class="hljs-string">&quot;ingress-apisix-leader&quot;</span><br>    <span class="hljs-comment"># The class of an Ingress object is set using the field IngressClassName in</span><br>    <span class="hljs-comment"># Kubernetes clusters version v1.18.0 or higher or the annotation</span><br>    <span class="hljs-comment"># &quot;kubernetes.io/ingress.class&quot; (deprecated).</span><br>    <span class="hljs-attr">ingressClass:</span> <span class="hljs-string">&quot;apisix&quot;</span><br>    <span class="hljs-comment"># the supported ingress api group version, can be &quot;networking/v1beta1&quot;,</span><br>    <span class="hljs-comment"># &quot;networking/v1&quot; (for Kubernetes version v1.19.0 or higher), and</span><br>    <span class="hljs-comment"># &quot;extensions/v1beta1&quot;, default is &quot;networking/v1&quot;.</span><br>    <span class="hljs-attr">ingressVersion:</span> <span class="hljs-string">&quot;networking/v1beta1&quot;</span><br>    <span class="hljs-comment"># the supported apisixroute api group version, can be &quot;apisix.apache.org/v1&quot;</span><br>    <span class="hljs-comment"># &quot;apisix.apache.org/v2alpha1&quot; or &quot;apisix.apache.org/v2beta1&quot;</span><br>    <span class="hljs-attr">apisixRouteVersion:</span> <span class="hljs-string">&quot;apisix.apache.org/v2beta1&quot;</span><br>  <span class="hljs-comment"># APISIX related configurations.</span><br>  <span class="hljs-attr">apisix:</span><br>    <span class="hljs-attr">baseURL:</span> <span class="hljs-string">&quot;http://apisix-admin:9180/apisix/admin&quot;</span><br>    <span class="hljs-attr">adminKey:</span> <span class="hljs-string">&quot;edd1c9f034335f136f87ad84b625c8f1&quot;</span><br><br><span class="hljs-attr">resources:</span> &#123;&#125;<br><br><span class="hljs-attr">autoscaling:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">minReplicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">100</span><br>  <span class="hljs-attr">targetCPUUtilizationPercentage:</span> <span class="hljs-number">80</span><br>  <span class="hljs-comment"># targetMemoryUtilizationPercentage: 80</span><br><br><span class="hljs-attr">nodeSelector:</span> &#123;&#125;<br><span class="hljs-attr">tolerations:</span> []<br><br><span class="hljs-comment"># namespace: &quot;ingress-apisix&quot;</span><br><br><span class="hljs-attr">serviceMonitor:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">&quot;monitoring&quot;</span><br>  <span class="hljs-attr">interval:</span> <span class="hljs-string">15s</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰Chart-yaml"><a href="#3ï¼‰Chart-yaml" class="headerlink" title="3ï¼‰Chart.yaml"></a>3ï¼‰Chart.yaml</h4><p>æ–‡ä»¶è·¯å¾„: <code>apisix/Chart.yaml</code>ï¼Œä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v2</span><br><span class="hljs-attr">appVersion:</span> <span class="hljs-number">2.8</span><span class="hljs-number">.0</span><br><span class="hljs-attr">dependencies:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">condition:</span> <span class="hljs-string">etcd.enabled</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">etcd</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">https://charts.bitnami.com/bitnami</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">6.2</span><span class="hljs-number">.6</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">alias:</span> <span class="hljs-string">dashboard</span><br>  <span class="hljs-attr">condition:</span> <span class="hljs-string">dashboard.enabled</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apisix-dashboard</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">https://charts.apiseven.com</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.6</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">alias:</span> <span class="hljs-string">ingress-controller</span><br>  <span class="hljs-attr">condition:</span> <span class="hljs-string">ingress-controller.enabled</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apisix-ingress-controller</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">https://charts.apiseven.com</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">0.7</span><span class="hljs-number">.1</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">A</span> <span class="hljs-string">Helm</span> <span class="hljs-string">chart</span> <span class="hljs-string">for</span> <span class="hljs-string">Apache</span> <span class="hljs-string">APISIX</span><br><span class="hljs-attr">icon:</span> <span class="hljs-string">https://apache.org/logos/res/apisix/apisix.png</span><br><span class="hljs-attr">maintainers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Tareya</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">apisix</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">application</span><br><span class="hljs-attr">version:</span> <span class="hljs-number">0.4</span><span class="hljs-number">.1</span><br></code></pre></td></tr></table></figure><h4 id="4ï¼‰templates-configmap-yaml"><a href="#4ï¼‰templates-configmap-yaml" class="headerlink" title="4ï¼‰templates/configmap.yaml"></a>4ï¼‰templates/configmap.yaml</h4><p>æ–‡ä»¶è·¯å¾„: <code>apisix/templates/configmap.yaml</code>ï¼Œä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#</span><br><span class="hljs-comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="hljs-comment"># contributor license agreements.  See the NOTICE file distributed with</span><br><span class="hljs-comment"># this work for additional information regarding copyright ownership.</span><br><span class="hljs-comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="hljs-comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="hljs-comment"># the License.  You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"># See the License for the specific language governing permissions and</span><br><span class="hljs-comment"># limitations under the License.</span><br><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.apisix.enabled</span> &#125;&#125;<br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;apisix.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>  <span class="hljs-attr">namespace:</span> &#123;&#123; <span class="hljs-string">.Release.Namespace</span> &#125;&#125;<br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">config.yaml:</span> <span class="hljs-string">|-</span><br><span class="hljs-string">    #</span><br><span class="hljs-string">    # Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="hljs-string">    # contributor license agreements.  See the NOTICE file distributed with</span><br><span class="hljs-string">    # this work for additional information regarding copyright ownership.</span><br><span class="hljs-string">    # The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="hljs-string">    # (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="hljs-string">    # the License.  You may obtain a copy of the License at</span><br><span class="hljs-string">    #</span><br><span class="hljs-string">    #     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-string">    #</span><br><span class="hljs-string">    # Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-string">    # distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-string">    # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-string">    # See the License for the specific language governing permissions and</span><br><span class="hljs-string">    # limitations under the License.</span><br><span class="hljs-string">    #</span><br><span class="hljs-string">    apisix:</span><br><span class="hljs-string">      node_listen: &#123;&#123; .Values.gateway.http.containerPort &#125;&#125;             # APISIX listening port</span><br><span class="hljs-string">      enable_heartbeat: true</span><br><span class="hljs-string">      enable_admin: &#123;&#123; .Values.admin.enabled &#125;&#125;</span><br><span class="hljs-string">      enable_admin_cors: &#123;&#123; .Values.admin.cors &#125;&#125;</span><br><span class="hljs-string">      enable_debug: false</span><br><span class="hljs-string">      enable_dev_mode: false          # Sets nginx worker_processes to 1 if set to true</span><br><span class="hljs-string">      enable_reuseport: true          # Enable nginx SO_REUSEPORT switch if set to true.</span><br><span class="hljs-string">      enable_ipv6: true</span><br><span class="hljs-string">      config_center: etcd             # etcd: use etcd to store the config value</span><br><span class="hljs-string">                                      # yaml: fetch the config value from local yaml file `/your_path/conf/apisix.yaml`</span><br><span class="hljs-string"></span><br>      <span class="hljs-comment">#proxy_protocol:                 # Proxy Protocol configuration</span><br>      <span class="hljs-comment">#  listen_http_port: 9181        # The port with proxy protocol for http, it differs from node_listen and port_admin.</span><br>                                      <span class="hljs-comment"># This port can only receive http request with proxy protocol, but node_listen &amp; port_admin</span><br>                                      <span class="hljs-comment"># can only receive http request. If you enable proxy protocol, you must use this port to</span><br>                                      <span class="hljs-comment"># receive http request with proxy protocol</span><br>      <span class="hljs-comment">#  listen_https_port: 9182       # The port with proxy protocol for https</span><br>      <span class="hljs-comment">#  enable_tcp_pp: true           # Enable the proxy protocol for tcp proxy, it works for stream_proxy.tcp option</span><br>      <span class="hljs-comment">#  enable_tcp_pp_to_upstream: true # Enables the proxy protocol to the upstream server</span><br><br>      <span class="hljs-attr">proxy_cache:</span>                     <span class="hljs-comment"># Proxy Caching configuration</span><br>        <span class="hljs-attr">cache_ttl:</span> <span class="hljs-string">10s</span>                 <span class="hljs-comment"># The default caching time if the upstream does not specify the cache time</span><br>        <span class="hljs-attr">zones:</span>                         <span class="hljs-comment"># The parameters of a cache</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">disk_cache_one</span>         <span class="hljs-comment"># The name of the cache, administrator can be specify</span><br>                                      <span class="hljs-comment"># which cache to use by name in the admin api</span><br>          <span class="hljs-attr">memory_size:</span> <span class="hljs-string">50m</span>             <span class="hljs-comment"># The size of shared memory, it&#x27;s used to store the cache index</span><br>          <span class="hljs-attr">disk_size:</span> <span class="hljs-string">1G</span>                <span class="hljs-comment"># The size of disk, it&#x27;s used to store the cache data</span><br>          <span class="hljs-attr">disk_path:</span> <span class="hljs-string">&quot;/tmp/disk_cache_one&quot;</span> <span class="hljs-comment"># The path to store the cache data</span><br>          <span class="hljs-attr">cache_levels:</span> <span class="hljs-string">&quot;1:2&quot;</span>           <span class="hljs-comment"># The hierarchy levels of a cache</span><br>      <span class="hljs-comment">#  - name: disk_cache_two</span><br>      <span class="hljs-comment">#    memory_size: 50m</span><br>      <span class="hljs-comment">#    disk_size: 1G</span><br>      <span class="hljs-comment">#    disk_path: &quot;/tmp/disk_cache_two&quot;</span><br>      <span class="hljs-comment">#    cache_levels: &quot;1:2&quot;</span><br><br>      <span class="hljs-attr">allow_admin:</span>                  <span class="hljs-comment"># http://nginx.org/en/docs/http/ngx_http_access_module.html#allow</span><br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.admin.allow.ipList</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">range</span> <span class="hljs-string">$ips</span> <span class="hljs-string">:=</span> <span class="hljs-string">.Values.admin.allow.ipList</span> &#125;&#125;<br>        <span class="hljs-bullet">-</span> &#123;&#123; <span class="hljs-string">$ips</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">else</span> &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/0</span><br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span>&#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">or</span> <span class="hljs-string">(index</span> <span class="hljs-string">.Values</span> <span class="hljs-string">&quot;ingress-controller&quot;</span> <span class="hljs-string">&quot;enabled&quot;</span><span class="hljs-string">)</span> <span class="hljs-string">.Values.dashboard.enabled</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/0</span><br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span>&#125;&#125;<br>      <span class="hljs-comment">#   - &quot;::/64&quot;</span><br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.admin.enabled</span> &#125;&#125;<br>      <span class="hljs-attr">port_admin:</span> &#123;&#123; <span class="hljs-string">.Values.admin.port</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><br>      <span class="hljs-comment"># Default token when use API to call for Admin API.</span><br>      <span class="hljs-comment"># *NOTE*: Highly recommended to modify this value to protect APISIX&#x27;s Admin API.</span><br>      <span class="hljs-comment"># Disabling this configuration item means that the Admin API does not</span><br>      <span class="hljs-comment"># require any authentication.</span><br>      <span class="hljs-attr">admin_key:</span><br>        <span class="hljs-comment"># admin: can everything for configuration data</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;admin&quot;</span><br>          <span class="hljs-attr">key:</span> &#123;&#123; <span class="hljs-string">.Values.admin.credentials.admin</span> &#125;&#125;<br>          <span class="hljs-attr">role:</span> <span class="hljs-string">admin</span><br>        <span class="hljs-comment"># viewer: only can view configuration data</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;viewer&quot;</span><br>          <span class="hljs-attr">key:</span> &#123;&#123; <span class="hljs-string">.Values.admin.credentials.viewer</span> &#125;&#125;<br>          <span class="hljs-attr">role:</span> <span class="hljs-string">viewer</span><br>      <span class="hljs-attr">router:</span><br>        <span class="hljs-attr">http:</span> <span class="hljs-string">&#x27;radixtree_uri&#x27;</span>         <span class="hljs-comment"># radixtree_uri: match route by uri(base on radixtree)</span><br>                                      <span class="hljs-comment"># radixtree_host_uri: match route by host + uri(base on radixtree)</span><br>        <span class="hljs-attr">ssl:</span> <span class="hljs-string">&#x27;radixtree_sni&#x27;</span>          <span class="hljs-comment"># radixtree_sni: match route by SNI(base on radixtree)</span><br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">and</span> <span class="hljs-string">.Values.gateway.stream.enabled</span> <span class="hljs-string">(or</span> <span class="hljs-string">(gt</span> <span class="hljs-string">(len</span> <span class="hljs-string">.Values.gateway.stream.tcp)</span> <span class="hljs-number">0</span><span class="hljs-string">)</span> <span class="hljs-string">(gt</span> <span class="hljs-string">(len</span> <span class="hljs-string">.Values.gateway.stream.udp)</span> <span class="hljs-number">0</span><span class="hljs-string">))</span> &#125;&#125;<br>      <span class="hljs-attr">stream_proxy:</span>                 <span class="hljs-comment"># TCP/UDP proxy</span><br>        <span class="hljs-attr">only:</span> &#123;&#123; <span class="hljs-string">.Values.gateway.stream.only</span> &#125;&#125;<br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">gt</span> <span class="hljs-string">(len</span> <span class="hljs-string">.Values.gateway.stream.tcp)</span> <span class="hljs-number">0</span> &#125;&#125;<br>        <span class="hljs-attr">tcp:</span>                        <span class="hljs-comment"># TCP proxy port list</span><br>          &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">range</span> <span class="hljs-string">.Values.gateway.stream.tcp</span> &#125;&#125;<br>          <span class="hljs-bullet">-</span> &#123;&#123; <span class="hljs-string">.</span> &#125;&#125;<br>          &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">gt</span> <span class="hljs-string">(len</span> <span class="hljs-string">.Values.gateway.stream.udp)</span> <span class="hljs-number">0</span> &#125;&#125;<br>        <span class="hljs-attr">udp:</span>                        <span class="hljs-comment"># UDP proxy port list</span><br>          &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">range</span> <span class="hljs-string">.Values.gateway.stream.udp</span> &#125;&#125;<br>          <span class="hljs-bullet">-</span> &#123;&#123; <span class="hljs-string">.</span> &#125;&#125;<br>          &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>      <span class="hljs-comment"># dns_resolver:</span><br>      <span class="hljs-comment">#   &#123;&#123;- range $resolver := .Values.dns.resolvers &#125;&#125;</span><br>      <span class="hljs-comment">#   - &#123;&#123; $resolver &#125;&#125;</span><br>      <span class="hljs-comment">#   &#123;&#123;- end &#125;&#125;</span><br>      <span class="hljs-attr">dns_resolver_valid:</span> &#123;&#123;<span class="hljs-string">.Values.dns.validity</span>&#125;&#125;<br>      <span class="hljs-attr">resolver_timeout:</span> &#123;&#123;<span class="hljs-string">.Values.dns.timeout</span>&#125;&#125;<br>      <span class="hljs-attr">ssl:</span><br>        <span class="hljs-attr">enable:</span> &#123;&#123; <span class="hljs-string">.Values.gateway.tls.enabled</span> &#125;&#125;<br>        <span class="hljs-attr">enable_http2:</span> &#123;&#123; <span class="hljs-string">.Values.gateway.tls.http2.enabled</span> &#125;&#125;<br>        <span class="hljs-attr">listen_port:</span> &#123;&#123; <span class="hljs-string">.Values.gateway.tls.containerPort</span> &#125;&#125;<br>        <span class="hljs-attr">ssl_protocols:</span> <span class="hljs-string">&quot;TLSv1 TLSv1.1 TLSv1.2 TLSv1.3&quot;</span><br>        <span class="hljs-attr">ssl_ciphers:</span> <span class="hljs-string">&quot;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA256:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA&quot;</span><br><br>    <span class="hljs-attr">nginx_config:</span>                     <span class="hljs-comment"># config for render the template to genarate nginx.conf</span><br>      <span class="hljs-attr">error_log:</span> <span class="hljs-string">&quot;/dev/stderr&quot;</span><br>      <span class="hljs-attr">error_log_level:</span> <span class="hljs-string">&quot;warn&quot;</span>         <span class="hljs-comment"># warn,error</span><br>      <span class="hljs-attr">worker_rlimit_nofile:</span> <span class="hljs-number">20480</span>     <span class="hljs-comment"># the number of files a worker process can open, should be larger than worker_connections</span><br>      <span class="hljs-attr">event:</span><br>        <span class="hljs-attr">worker_connections:</span> <span class="hljs-number">10620</span><br>      <span class="hljs-attr">http:</span><br>        <span class="hljs-attr">access_log:</span> <span class="hljs-string">&quot;/dev/stdout&quot;</span><br>        <span class="hljs-attr">keepalive_timeout:</span> <span class="hljs-string">60s</span>         <span class="hljs-comment"># timeout during which a keep-alive client connection will stay open on the server side.</span><br>        <span class="hljs-attr">client_header_timeout:</span> <span class="hljs-string">60s</span>     <span class="hljs-comment"># timeout for reading client request header, then 408 (Request Time-out) error is returned to the client</span><br>        <span class="hljs-attr">client_body_timeout:</span> <span class="hljs-string">60s</span>       <span class="hljs-comment"># timeout for reading client request body, then 408 (Request Time-out) error is returned to the client</span><br>        <span class="hljs-attr">send_timeout:</span> <span class="hljs-string">10s</span>              <span class="hljs-comment"># timeout for transmitting a response to the client.then the connection is closed</span><br>        <span class="hljs-attr">underscores_in_headers:</span> <span class="hljs-string">&quot;on&quot;</span>   <span class="hljs-comment"># default enables the use of underscores in client request header fields</span><br>        <span class="hljs-attr">real_ip_header:</span> <span class="hljs-string">&quot;X-Real-IP&quot;</span>    <span class="hljs-comment"># http://nginx.org/en/docs/http/ngx_http_realip_module.html#real_ip_header</span><br>        <span class="hljs-attr">real_ip_from:</span>                  <span class="hljs-comment"># http://nginx.org/en/docs/http/ngx_http_realip_module.html#set_real_ip_from</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;unix:&#x27;</span><br>        <span class="hljs-comment">#lua_shared_dicts:              # add custom shared cache to nginx.conf</span><br>        <span class="hljs-comment">#  ipc_shared_dict: 100m        # custom shared cache, format: `cache-key: cache-size`</span><br><br>    <span class="hljs-attr">etcd:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.etcd.enabled</span> &#125;&#125;<br>      <span class="hljs-attr">host:</span>                                 <span class="hljs-comment"># it&#x27;s possible to define multiple etcd hosts addresses of the same etcd cluster.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;http://<span class="hljs-template-variable">&#123;&#123; .Release.Name &#125;&#125;</span>-etcd.<span class="hljs-template-variable">&#123;&#123; .Release.Namespace &#125;&#125;</span>.svc.<span class="hljs-template-variable">&#123;&#123; .Values.etcd.clusterDomain &#125;&#125;</span>:<span class="hljs-template-variable">&#123;&#123; .Values.etcd.service.port &#125;&#125;</span>&quot;</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">else</span> &#125;&#125;<br>      <span class="hljs-attr">host:</span>                                 <span class="hljs-comment"># it&#x27;s possible to define multiple etcd hosts addresses of the same etcd cluster.</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">range</span> <span class="hljs-string">$value</span> <span class="hljs-string">:=</span> <span class="hljs-string">.Values.etcd.host</span> &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span>             <span class="hljs-comment"># multiple etcd address</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span>&#125;&#125;<br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>      <span class="hljs-attr">prefix:</span> &#123;&#123; <span class="hljs-string">.Values.etcd.prefix</span> <span class="hljs-string">|</span> <span class="hljs-string">quote</span> &#125;&#125;     <span class="hljs-comment"># apisix configurations prefix</span><br>      <span class="hljs-attr">timeout:</span> &#123;&#123; <span class="hljs-string">.Values.etcd.timeout</span> &#125;&#125;   <span class="hljs-comment"># 30 seconds</span><br><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.discovery.enabled</span> &#125;&#125;<br>    <span class="hljs-attr">discovery:</span>                        <span class="hljs-comment"># Service discovery configuration</span><br>      &#123;&#123; <span class="hljs-string">.Values.discovery.method</span> &#125;&#125;<span class="hljs-string">:</span><br>        <span class="hljs-attr">host:</span> <br>          &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">range</span> <span class="hljs-string">$value</span> <span class="hljs-string">:=</span> <span class="hljs-string">.Values.discovery.host</span> &#125;&#125;<br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; $value &#125;&#125;</span>&quot;</span>             <span class="hljs-comment"># multiple nacos address</span><br>          &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span>&#125;&#125;<br>        <span class="hljs-attr">prefix:</span> &#123;&#123; <span class="hljs-string">.Values.discovery.prefix</span> &#125;&#125;       <br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.plugins</span> &#125;&#125;<br>    <span class="hljs-attr">plugins:</span>                          <span class="hljs-comment"># plugin list</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">range</span> <span class="hljs-string">$plugin</span> <span class="hljs-string">:=</span> <span class="hljs-string">.Values.plugins</span> &#125;&#125;<br>      <span class="hljs-bullet">-</span> &#123;&#123; <span class="hljs-string">$plugin</span> &#125;&#125;<br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>    <span class="hljs-attr">stream_plugins:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">range</span> <span class="hljs-string">$plugin</span> <span class="hljs-string">:=</span> <span class="hljs-string">.Values.stream_plugins</span> &#125;&#125;<br>      <span class="hljs-bullet">-</span> &#123;&#123; <span class="hljs-string">$plugin</span> &#125;&#125;<br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><br></code></pre></td></tr></table></figure><h4 id="5ï¼‰values-yaml"><a href="#5ï¼‰values-yaml" class="headerlink" title="5ï¼‰values.yaml"></a>5ï¼‰values.yaml</h4><p>æ–‡ä»¶è·¯å¾„: <code>apisix/values.yaml</code>ï¼Œä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#</span><br><span class="hljs-comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="hljs-comment"># contributor license agreements.  See the NOTICE file distributed with</span><br><span class="hljs-comment"># this work for additional information regarding copyright ownership.</span><br><span class="hljs-comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="hljs-comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="hljs-comment"># the License.  You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"># See the License for the specific language governing permissions and</span><br><span class="hljs-comment"># limitations under the License.</span><br><br><span class="hljs-attr">global:</span><br>  <span class="hljs-attr">imagePullSecrets:</span> []<br><br><br><span class="hljs-attr">apisix:</span><br>  <span class="hljs-comment"># Enable or disable Apache APISIX itself</span><br>  <span class="hljs-comment"># Set it to flase and ingress-controller.enabled=true will deploy only ingress-controller</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-attr">image:</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">apache/apisix</span><br>    <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>    <span class="hljs-comment"># Overrides the image tag whose default is the chart appVersion.</span><br>    <span class="hljs-attr">tag:</span> <span class="hljs-number">2.8</span><span class="hljs-string">-alpine</span><br><br>  <span class="hljs-attr">replicaCount:</span> <span class="hljs-number">1</span><br><br>  <span class="hljs-attr">podAnnotations:</span> &#123;&#125;<br>  <span class="hljs-attr">podSecurityContext:</span> &#123;&#125;<br>    <span class="hljs-comment"># fsGroup: 2000</span><br>  <span class="hljs-attr">securityContext:</span> &#123;&#125;<br>    <span class="hljs-comment"># capabilities:</span><br>    <span class="hljs-comment">#   drop:</span><br>    <span class="hljs-comment">#   - ALL</span><br>    <span class="hljs-comment"># readOnlyRootFilesystem: true</span><br>    <span class="hljs-comment"># runAsNonRoot: true</span><br>    <span class="hljs-comment"># runAsUser: 1000</span><br><br>  <span class="hljs-attr">resources:</span> &#123;&#125;<br>    <span class="hljs-comment"># We usually recommend not to specify default resources and to leave this as a conscious</span><br>    <span class="hljs-comment"># choice for the user. This also increases chances charts run on environments with little</span><br>    <span class="hljs-comment"># resources, such as Minikube. If you do want to specify resources, uncomment the following</span><br>    <span class="hljs-comment"># lines, adjust them as necessary, and remove the curly braces after &#x27;resources:&#x27;.</span><br>    <span class="hljs-comment"># limits:</span><br>    <span class="hljs-comment">#   cpu: 100m</span><br>    <span class="hljs-comment">#   memory: 128Mi</span><br>    <span class="hljs-comment"># requests:</span><br>    <span class="hljs-comment">#   cpu: 100m</span><br>    <span class="hljs-comment">#   memory: 128Mi</span><br><br>  <span class="hljs-attr">nodeSelector:</span> &#123;&#125;<br>  <span class="hljs-attr">tolerations:</span> []<br>  <span class="hljs-attr">affinity:</span> &#123;&#125;<br>  <span class="hljs-comment"># If true, it will sets the anti-affinity of the Pod.</span><br>  <span class="hljs-attr">podAntiAffinity:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br><br><br><span class="hljs-attr">nameOverride:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">fullnameOverride:</span> <span class="hljs-string">&quot;&quot;</span><br><br><br><span class="hljs-attr">gateway:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>  <span class="hljs-comment"># If you want to keep the client source IP, you can set this to Local.</span><br>  <span class="hljs-comment"># ref: https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/#preserving-the-client-source-ip</span><br>  <span class="hljs-attr">externalTrafficPolicy:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-comment"># type: LoadBalancer</span><br>  <span class="hljs-comment"># annotations:</span><br>  <span class="hljs-comment">#   service.beta.kubernetes.io/aws-load-balancer-type: nlb</span><br>  <span class="hljs-attr">http:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">servicePort:</span> <span class="hljs-number">80</span><br>    <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9080</span><br>  <span class="hljs-attr">tls:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">servicePort:</span> <span class="hljs-number">443</span><br>    <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9443</span><br>    <span class="hljs-attr">http2:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">stream:</span>  <span class="hljs-comment"># L4 proxy (TCP/UDP)</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">only:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">tcp:</span> []<br>    <span class="hljs-attr">udp:</span> []<br>  <span class="hljs-attr">ingress:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">annotations:</span> &#123;&#125;<br>      <span class="hljs-comment"># kubernetes.io/ingress.class: nginx</span><br>      <span class="hljs-comment"># kubernetes.io/tls-acme: &quot;true&quot;</span><br>    <span class="hljs-attr">hosts:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">host:</span> <span class="hljs-string">apisix.local</span><br>        <span class="hljs-attr">paths:</span> []<br>    <span class="hljs-attr">tls:</span> []<br>  <span class="hljs-comment">#  - secretName: apisix-tls</span><br>  <span class="hljs-comment">#    hosts:</span><br>  <span class="hljs-comment">#      - chart-example.local</span><br><br><br><span class="hljs-attr">admin:</span><br>  <span class="hljs-comment"># Enable Admin API</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># admin service type</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>  <span class="hljs-comment"># loadBalancerIP: a.b.c.d</span><br>  <span class="hljs-comment"># loadBalancerSourceRanges:</span><br>  <span class="hljs-comment">#   - &quot;143.231.0.0/16&quot;</span><br>  <span class="hljs-attr">externalIPs:</span> []<br>  <span class="hljs-comment">#</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9180</span><br>  <span class="hljs-attr">servicePort:</span> <span class="hljs-number">9180</span><br>  <span class="hljs-comment"># Admin API support CORS response headers</span><br>  <span class="hljs-attr">cors:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># Admin API credentials</span><br>  <span class="hljs-attr">credentials:</span><br>    <span class="hljs-attr">admin:</span> <span class="hljs-string">edd1c9f034335f136f87ad84b625c8f1</span><br>    <span class="hljs-attr">viewer:</span> <span class="hljs-string">4054f7cf07e344346cd3f287985e76a2</span><br><br>  <span class="hljs-attr">allow:</span><br>    <span class="hljs-comment"># The ip range for allowing access to Apache APISIX</span><br>    <span class="hljs-attr">ipList:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/0</span><br><br><br><span class="hljs-comment"># APISIX plugins to be enabled</span><br><span class="hljs-attr">plugins:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">api-breaker</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">authz-keycloak</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">basic-auth</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">batch-requests</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">consumer-restriction</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">cors</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">fault-injection</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">grpc-transcode</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">hmac-auth</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">http-logger</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ip-restriction</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">jwt-auth</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">kafka-logger</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">key-auth</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">limit-conn</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">limit-count</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">limit-req</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">node-status</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">openid-connect</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">prometheus</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">proxy-cache</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">proxy-mirror</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">proxy-rewrite</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">redirect</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">referer-restriction</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">request-id</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">request-validation</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">response-rewrite</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">serverless-post-function</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">serverless-pre-function</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">sls-logger</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">syslog</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">tcp-logger</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">udp-logger</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">uri-blocker</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">wolf-rbac</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">zipkin</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">traffic-split</span><br><span class="hljs-attr">stream_plugins:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">mqtt-proxy</span><br><br><br><span class="hljs-attr">dns:</span><br>  <span class="hljs-attr">resolvers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">172.20</span><span class="hljs-number">.0</span><span class="hljs-number">.10</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">223.5</span><span class="hljs-number">.5</span><span class="hljs-number">.5</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">1.1</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.3</span><span class="hljs-number">.252</span><br>  <span class="hljs-attr">validity:</span> <span class="hljs-number">30</span><br>  <span class="hljs-attr">timeout:</span> <span class="hljs-number">5</span><br><br><br><span class="hljs-attr">autoscaling:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">minReplicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">100</span><br>  <span class="hljs-attr">targetCPUUtilizationPercentage:</span> <span class="hljs-number">80</span><br>  <span class="hljs-attr">targetMemoryUtilizationPercentage:</span> <span class="hljs-number">80</span><br><br><br><span class="hljs-comment"># etcd configuration</span><br><span class="hljs-comment"># use the FQDN address or the IP of the etcd</span><br><span class="hljs-attr">etcd:</span><br>  <span class="hljs-comment"># install etcd(v3) by default, set false if do not want to install etcd(v3) together</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">host:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">http://etcd.host:2379</span>  <span class="hljs-comment"># host or ip e.g. http://172.20.128.89:2379</span><br>  <span class="hljs-attr">prefix:</span> <span class="hljs-string">&quot;/apisix&quot;</span><br>  <span class="hljs-attr">timeout:</span> <span class="hljs-number">30</span><br><br>  <span class="hljs-comment"># if etcd.enabled is true, set more values of bitnami/etcd helm chart</span><br>  <span class="hljs-attr">auth:</span><br>    <span class="hljs-attr">rbac:</span><br>      <span class="hljs-comment"># No authentication by default</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br><br>  <span class="hljs-attr">service:</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">2379</span><br><br>  <span class="hljs-attr">replicaCount:</span> <span class="hljs-number">3</span><br><br><br><span class="hljs-attr">discovery:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">method:</span> <span class="hljs-string">nacos</span><br>  <span class="hljs-attr">host:</span> <br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;http://nacos:nacos@192.168.3.33:18848&quot;</span><br>  <span class="hljs-attr">prefix:</span> <span class="hljs-string">&quot;/nacos/v1/&quot;</span><br><br>    <br><span class="hljs-attr">dashboard:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><br><br><span class="hljs-attr">ingress-controller:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><br></code></pre></td></tr></table></figure><h3 id="3ã€å‘å¸ƒ-release"><a href="#3ã€å‘å¸ƒ-release" class="headerlink" title="3ã€å‘å¸ƒ release"></a>3ã€å‘å¸ƒ release</h3><h4 id="1ï¼‰é¦–æ¬¡å‘å¸ƒ"><a href="#1ï¼‰é¦–æ¬¡å‘å¸ƒ" class="headerlink" title="1ï¼‰é¦–æ¬¡å‘å¸ƒ"></a>1ï¼‰é¦–æ¬¡å‘å¸ƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è¿›å…¥ chart ç›®å½•</span><br>helm install -n apisix apisix .<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åç»­æ›´æ–°"><a href="#2ï¼‰åç»­æ›´æ–°" class="headerlink" title="2ï¼‰åç»­æ›´æ–°"></a>2ï¼‰åç»­æ›´æ–°</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è¿›å…¥ chart ç›®å½•</span><br>helm upgrade --install -n apisix apisix .<br></code></pre></td></tr></table></figure><h3 id="4ã€è°ƒè¯•-apisix-admin-api"><a href="#4ã€è°ƒè¯•-apisix-admin-api" class="headerlink" title="4ã€è°ƒè¯• apisix admin api"></a>4ã€è°ƒè¯• apisix admin api</h3><blockquote><p>ğŸš© å‡ºäºæ–¹ä¾¿è€ƒè™‘ï¼Œå·²å°† admin api ä»¥ nodeport çš„æ–¹å¼æ˜ å°„</p></blockquote><h4 id="1ï¼‰æŸ¥çœ‹æœåŠ¡"><a href="#1ï¼‰æŸ¥çœ‹æœåŠ¡" class="headerlink" title="1ï¼‰æŸ¥çœ‹æœåŠ¡"></a>1ï¼‰æŸ¥çœ‹æœåŠ¡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl &quot;http://192.168.3.151:8585/apisix/admin/services/&quot; -H &#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;<br></code></pre></td></tr></table></figure><h5 id="è¿”å›å€¼ï¼š"><a href="#è¿”å›å€¼ï¼š" class="headerlink" title="è¿”å›å€¼ï¼š"></a>è¿”å›å€¼ï¼š</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;node&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;key&quot;</span>: <span class="hljs-string">&quot;/apisix/services&quot;</span>,<br>        <span class="hljs-attr">&quot;dir&quot;</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">&quot;nodes&quot;</span>: &#123;&#125;<br>    &#125;,<br>    <span class="hljs-attr">&quot;action&quot;</span>: <span class="hljs-string">&quot;get&quot;</span>,<br>    <span class="hljs-attr">&quot;count&quot;</span>: <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ›å»ºè·¯ç”±"><a href="#2ï¼‰åˆ›å»ºè·¯ç”±" class="headerlink" title="2ï¼‰åˆ›å»ºè·¯ç”±"></a>2ï¼‰åˆ›å»ºè·¯ç”±</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl  -X PUT -i http://192.168.3.151:8585/apisix/admin/routes/1 -H &#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27;-d &#x27;&#123;&quot;uri&quot;:&quot;/nacos/*&quot;,&quot;name&quot;:&quot;nacos-testing&quot;,&quot;upstream&quot;:&#123;&quot;service_name&quot;:&quot;APISIX-NACOS&quot;,&quot;type&quot;:&quot;roundrobin&quot;,&quot;discovery_type&quot;:&quot;nacos&quot;,&quot;discovery_args&quot;:&#123;&quot;namespace_id&quot;:&quot;nacos&quot;,&quot;group_name&quot;:&quot;DEFAULT_GROUP&quot;&#125;&#125;&#125;&#x27;<br></code></pre></td></tr></table></figure><h5 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼:"></a>è¿”å›å€¼:</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;action&quot;</span>: <span class="hljs-string">&quot;set&quot;</span>,<br>    <span class="hljs-attr">&quot;node&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;key&quot;</span>: <span class="hljs-string">&quot;/apisix/routes/1&quot;</span>,<br>        <span class="hljs-attr">&quot;value&quot;</span>: &#123;<br>            <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">1</span>,<br>            <span class="hljs-attr">&quot;update_time&quot;</span>: <span class="hljs-number">1630663679</span>,<br>            <span class="hljs-attr">&quot;create_time&quot;</span>: <span class="hljs-number">1630663679</span>,<br>            <span class="hljs-attr">&quot;upstream&quot;</span>: &#123;<br>                <span class="hljs-attr">&quot;discovery_args&quot;</span>: &#123;<br>                    <span class="hljs-attr">&quot;namespace_id&quot;</span>: <span class="hljs-string">&quot;nacos&quot;</span>,<br>                    <span class="hljs-attr">&quot;group_name&quot;</span>: <span class="hljs-string">&quot;DEFAULT_GROUP&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">&quot;pass_host&quot;</span>: <span class="hljs-string">&quot;pass&quot;</span>,<br>                <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;roundrobin&quot;</span>,<br>                <span class="hljs-attr">&quot;hash_on&quot;</span>: <span class="hljs-string">&quot;vars&quot;</span>,<br>                <span class="hljs-attr">&quot;service_name&quot;</span>: <span class="hljs-string">&quot;APISIX-NACOS&quot;</span>,<br>                <span class="hljs-attr">&quot;scheme&quot;</span>: <span class="hljs-string">&quot;http&quot;</span>,<br>                <span class="hljs-attr">&quot;discovery_type&quot;</span>: <span class="hljs-string">&quot;nacos&quot;</span><br>            &#125;,<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;nacos-testing&quot;</span>,<br>            <span class="hljs-attr">&quot;uri&quot;</span>: <span class="hljs-string">&quot;/nacos/*&quot;</span>,<br>            <span class="hljs-attr">&quot;priority&quot;</span>: <span class="hljs-number">0</span>,<br>            <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-string">&quot;1&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210903180828420.png" alt="image-20210903180828420"></p>]]></content>
    
    
    <categories>
      
      <category>APIç½‘å…³</category>
      
    </categories>
    
    
    <tags>
      
      <tag>APISIX å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬11ç« ã€é¡¹ç›®çš„çŸ¥è¯†äº§æƒå’Œæ ‡å‡†è§„èŒƒ</title>
    <link href="/2021/08/31/%E7%AC%AC11%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%9F%A5%E8%AF%86%E4%BA%A7%E6%9D%83%E5%92%8C%E6%A0%87%E5%87%86%E8%A7%84%E8%8C%83/"/>
    <url>/2021/08/31/%E7%AC%AC11%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%9F%A5%E8%AF%86%E4%BA%A7%E6%9D%83%E5%92%8C%E6%A0%87%E5%87%86%E8%A7%84%E8%8C%83/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬11ç« ã€é¡¹ç›®çš„çŸ¥è¯†äº§æƒå’Œæ ‡å‡†è§„èŒƒ"><a href="#ç¬¬11ç« ã€é¡¹ç›®çš„çŸ¥è¯†äº§æƒå’Œæ ‡å‡†è§„èŒƒ" class="headerlink" title="ç¬¬11ç« ã€é¡¹ç›®çš„çŸ¥è¯†äº§æƒå’Œæ ‡å‡†è§„èŒƒ"></a>ç¬¬11ç« ã€é¡¹ç›®çš„çŸ¥è¯†äº§æƒå’Œæ ‡å‡†è§„èŒƒ</h1><span id="more"></span><h2 id="ä¸€ã€çŸ¥è¯†äº§æƒ"><a href="#ä¸€ã€çŸ¥è¯†äº§æƒ" class="headerlink" title="ä¸€ã€çŸ¥è¯†äº§æƒ"></a>ä¸€ã€çŸ¥è¯†äº§æƒ</h2><h3 id="1ã€ã€ŠåˆåŒæ³•ã€‹å¯¹äºåˆåŒå†…å®¹çº¦å®šä¸æ˜ç¡®çš„è§„å®š"><a href="#1ã€ã€ŠåˆåŒæ³•ã€‹å¯¹äºåˆåŒå†…å®¹çº¦å®šä¸æ˜ç¡®çš„è§„å®š" class="headerlink" title="1ã€ã€ŠåˆåŒæ³•ã€‹å¯¹äºåˆåŒå†…å®¹çº¦å®šä¸æ˜ç¡®çš„è§„å®š"></a>1ã€ã€ŠåˆåŒæ³•ã€‹å¯¹äºåˆåŒå†…å®¹çº¦å®šä¸æ˜ç¡®çš„è§„å®š</h3><h4 id="1ï¼‰è´¨é‡è¦æ±‚ä¸æ˜ç¡®"><a href="#1ï¼‰è´¨é‡è¦æ±‚ä¸æ˜ç¡®" class="headerlink" title="1ï¼‰è´¨é‡è¦æ±‚ä¸æ˜ç¡®"></a>1ï¼‰è´¨é‡è¦æ±‚ä¸æ˜ç¡®</h4><ul><li>æŒ‰ç…§å›½å®¶æ ‡å‡†ã€è¡Œä¸šæ ‡å‡†å±¥è¡Œ</li><li>æ²¡æœ‰å›½å®¶æ ‡å‡†ã€è¡Œä¸šæ ‡å‡†çš„ï¼ŒæŒ‰ç…§é€šå¸¸è¾¨å‡†æˆ–ç¬¦åˆåˆåŒç›®çš„çš„ç‰¹å®šæ ‡å‡†å±¥è¡Œ</li></ul><h4 id="2ï¼‰ä»·æ¬¾æˆ–è€…æŠ¥é…¬ä¸æ˜ç¡®"><a href="#2ï¼‰ä»·æ¬¾æˆ–è€…æŠ¥é…¬ä¸æ˜ç¡®" class="headerlink" title="2ï¼‰ä»·æ¬¾æˆ–è€…æŠ¥é…¬ä¸æ˜ç¡®"></a>2ï¼‰ä»·æ¬¾æˆ–è€…æŠ¥é…¬ä¸æ˜ç¡®</h4><h4 id="3ï¼‰å±¥è¡Œåœ°ç‚¹ä¸æ˜ç¡®"><a href="#3ï¼‰å±¥è¡Œåœ°ç‚¹ä¸æ˜ç¡®" class="headerlink" title="3ï¼‰å±¥è¡Œåœ°ç‚¹ä¸æ˜ç¡®"></a>3ï¼‰å±¥è¡Œåœ°ç‚¹ä¸æ˜ç¡®</h4><h4 id="4ï¼‰å±¥è¡ŒæœŸé™ä¸æ˜ç¡®"><a href="#4ï¼‰å±¥è¡ŒæœŸé™ä¸æ˜ç¡®" class="headerlink" title="4ï¼‰å±¥è¡ŒæœŸé™ä¸æ˜ç¡®"></a>4ï¼‰å±¥è¡ŒæœŸé™ä¸æ˜ç¡®</h4><h4 id="5ï¼‰å±¥è¡Œæ–¹å¼ä¸æ˜ç¡®"><a href="#5ï¼‰å±¥è¡Œæ–¹å¼ä¸æ˜ç¡®" class="headerlink" title="5ï¼‰å±¥è¡Œæ–¹å¼ä¸æ˜ç¡®"></a>5ï¼‰å±¥è¡Œæ–¹å¼ä¸æ˜ç¡®</h4><h4 id="6ï¼‰å±¥è¡Œè´¹ç”¨çš„è´Ÿæ‹…ä¸æ˜ç¡®"><a href="#6ï¼‰å±¥è¡Œè´¹ç”¨çš„è´Ÿæ‹…ä¸æ˜ç¡®" class="headerlink" title="6ï¼‰å±¥è¡Œè´¹ç”¨çš„è´Ÿæ‹…ä¸æ˜ç¡®"></a>6ï¼‰å±¥è¡Œè´¹ç”¨çš„è´Ÿæ‹…ä¸æ˜ç¡®</h4><h2 id="äºŒã€æ ‡å‡†è§„èŒƒ"><a href="#äºŒã€æ ‡å‡†è§„èŒƒ" class="headerlink" title="äºŒã€æ ‡å‡†è§„èŒƒ"></a>äºŒã€æ ‡å‡†è§„èŒƒ</h2><h2 id="ä¸‰ã€ä½œä¸š"><a href="#ä¸‰ã€ä½œä¸š" class="headerlink" title="ä¸‰ã€ä½œä¸š"></a>ä¸‰ã€ä½œä¸š</h2><h3 id="1ã€è‘—ä½œæƒäººå¯¹ä½œå“äº«æœ‰ä»¥ä¸‹äº”ç§æƒåˆ©"><a href="#1ã€è‘—ä½œæƒäººå¯¹ä½œå“äº«æœ‰ä»¥ä¸‹äº”ç§æƒåˆ©" class="headerlink" title="1ã€è‘—ä½œæƒäººå¯¹ä½œå“äº«æœ‰ä»¥ä¸‹äº”ç§æƒåˆ©"></a>1ã€è‘—ä½œæƒäººå¯¹ä½œå“äº«æœ‰ä»¥ä¸‹äº”ç§æƒåˆ©</h3><blockquote><ul><li>å‘è¡¨æƒ</li><li>ç½²åæƒ</li><li>ä¿®æ”¹æƒ</li><li>ä¿æŠ¤ä½œå“å®Œæ•´æƒ</li><li>ä½¿ç”¨æƒã€ä½¿ç”¨è®¸å¯æƒå’Œè·å–æŠ¥é…¬æƒã€è½¬è®©æƒ</li></ul></blockquote><h3 id="2ã€åˆ†åŒ…ç¦æ­¢æ¡ä»¶"><a href="#2ã€åˆ†åŒ…ç¦æ­¢æ¡ä»¶" class="headerlink" title="2ã€åˆ†åŒ…ç¦æ­¢æ¡ä»¶"></a>2ã€åˆ†åŒ…ç¦æ­¢æ¡ä»¶</h3><blockquote><ul><li><p>ä¸å¾—å‘ä»–äººè½¬è®©ä¸­æ ‡é¡¹ç›®</p></li><li><p>ä¸å¾—å°†ä¸­æ ‡é¡¹ç›®è‚¢è§£ååˆ†åˆ«å‘ä»–äººè½¬è®©</p></li><li><p>æŒ‰åˆåŒçº¦å®šæˆ–æ‹›æ ‡äººåŒæ„ï¼Œå¯ä»¥å°†ä¸­æ ‡é¡¹ç›®çš„éä¸»ä½“ã€éå…³é”®å·¥ä½œåˆ†åŒ…ï¼Œæ¥å—åˆ†åŒ…æ–¹éœ€è¦å…·å¤‡ç›¸åº”èµ„è´¨ï¼Œå¹¶ä¸”ä¸å¾—å†æ¬¡åˆ†åŒ…</p></li><li><p>ä¸­æ ‡äººéœ€è¦å°±åˆ†åŒ…é¡¹ç›®å‘æ‹›æ ‡äººè´Ÿè´£ï¼Œæ¥å—åˆ†åŒ…çš„äººå°±åˆ†åŒ…é¡¹ç›®æ‰¿æ‹…è¿å¸¦è´£ä»»</p></li></ul></blockquote><h3 id="3ã€å“ªäº›æƒ…å½¢å¯ä»¥ä¸è¿›è¡Œæ‹›æ ‡"><a href="#3ã€å“ªäº›æƒ…å½¢å¯ä»¥ä¸è¿›è¡Œæ‹›æ ‡" class="headerlink" title="3ã€å“ªäº›æƒ…å½¢å¯ä»¥ä¸è¿›è¡Œæ‹›æ ‡"></a>3ã€å“ªäº›æƒ…å½¢å¯ä»¥ä¸è¿›è¡Œæ‹›æ ‡</h3><blockquote><ul><li>éœ€è¦é‡‡ç”¨ä¸å¯æ›¿ä»£çš„ä¸“åˆ©æˆ–ä¸“æœ‰æŠ€æœ¯</li><li>é‡‡è´­äººä¾æ³•èƒ½å¤Ÿè‡ªè¡Œå»ºè®¾ã€ç”Ÿäº§æˆ–æä¾›</li><li>å·²é€šè¿‡æ‹›æ ‡æ–¹å¼é€‰å®šçš„ç‰¹è®¸ç»è¥é¡¹ç›®æŠ•èµ„äººä¾æ³•èƒ½å¤Ÿè‡ªè¡Œå»ºè®¾ã€ç”Ÿäº§æˆ–æä¾›</li><li>éœ€è¦å‘åŸä¸­æ ‡äººé‡‡è´­å·¥ç¨‹ã€è´§ç‰©æˆ–æœåŠ¡ï¼Œå¦åˆ™å°†å½±å“æ–½å·¥æˆ–åŠŸèƒ½é…å¥—è¦æ±‚</li><li>å›½å®¶è§„å®šçš„å…¶ä»–ç‰¹æ®Šæƒ…å†µ</li></ul></blockquote><h3 id="4ã€åŒºåˆ†ç­‰åŒé‡‡ç”¨ã€ä¿®æ”¹é‡‡ç”¨ã€ç­‰æ•ˆé‡‡ç”¨å’Œéç­‰æ•ˆé‡‡ç”¨æ¦‚å¿µ"><a href="#4ã€åŒºåˆ†ç­‰åŒé‡‡ç”¨ã€ä¿®æ”¹é‡‡ç”¨ã€ç­‰æ•ˆé‡‡ç”¨å’Œéç­‰æ•ˆé‡‡ç”¨æ¦‚å¿µ" class="headerlink" title="4ã€åŒºåˆ†ç­‰åŒé‡‡ç”¨ã€ä¿®æ”¹é‡‡ç”¨ã€ç­‰æ•ˆé‡‡ç”¨å’Œéç­‰æ•ˆé‡‡ç”¨æ¦‚å¿µ"></a>4ã€åŒºåˆ†ç­‰åŒé‡‡ç”¨ã€ä¿®æ”¹é‡‡ç”¨ã€ç­‰æ•ˆé‡‡ç”¨å’Œéç­‰æ•ˆé‡‡ç”¨æ¦‚å¿µ</h3><blockquote><ul><li>ç­‰åŒé‡‡ç”¨ï¼šæŒ‡æŠ€æœ¯å†…å®¹ç›¸åŒ</li><li>ä¿®æ”¹é‡‡ç”¨ï¼šæŒ‡ä¸å›½é™…æ ‡å‡†ä¹‹é—´å­˜åœ¨æŠ€æœ¯æ€§å·®å¼‚</li><li>ç­‰æ•ˆé‡‡ç”¨ï¼šæŒ‡ä¸»è¦æŠ€æœ¯å†…å®¹ç›¸åŒï¼ŒæŠ€æœ¯ä¸Šåªæœ‰å¾ˆå°‘å·®å¼‚ï¼Œç¼–å†™æ–¹æ³•ä¸å®Œå…¨ç›¸å¯¹åº”</li><li>éç­‰æ•ˆé‡‡ç”¨ï¼šæŒ‡ä¸ç›¸åº”å›½é™…æ ‡å‡†åœ¨æŠ€æœ¯å†…å®¹å’Œæ–‡æœ¬ç»“æ„ä¸Šä¸åŒ</li></ul></blockquote><h3 id="5ã€è´¨é‡ç‰¹æ€§ä¸è´¨é‡å­ç‰¹æ€§"><a href="#5ã€è´¨é‡ç‰¹æ€§ä¸è´¨é‡å­ç‰¹æ€§" class="headerlink" title="5ã€è´¨é‡ç‰¹æ€§ä¸è´¨é‡å­ç‰¹æ€§"></a>5ã€è´¨é‡ç‰¹æ€§ä¸è´¨é‡å­ç‰¹æ€§</h3><blockquote><p>å£è¯€: åŠŸèƒ½é ç”¨æ•ˆæŠ¤ç§»ï¼Œé€‚å‡†ç”¨ä¾å®‰ï¼Œé”™æ˜“æˆï¼Œå­¦è§£ä½œæºæ—¶ï¼Œè¯•æ”¹å®šåˆ†ï¼Œåº”è£…ä¸€é¢˜</p><table><thead><tr><th>åŠŸèƒ½æ€§</th><th>å¯é æ€§</th><th>æ˜“ç”¨æ€§</th><th>æ•ˆç‡</th><th>ç»´æŠ¤æ€§</th><th>å¯ç§»æ¤æ€§</th></tr></thead><tbody><tr><td><strong>é€‚</strong>åˆæ€§</td><td>å®¹<strong>é”™</strong>æ€§</td><td>æ˜“<strong>å­¦</strong>æ€§</td><td>èµ„<strong>æº</strong>ç‰¹æ€§</td><td>å¯æµ‹<strong>è¯•</strong>æ€§</td><td>é€‚<strong>åº”</strong>æ€§</td></tr><tr><td><strong>å‡†</strong>ç¡®æ€§</td><td><strong>æ˜“</strong>æ¢å¤æ€§</td><td>æ˜“ç†<strong>è§£</strong>æ€§</td><td><strong>æ—¶</strong>é—´ç‰¹æ€§</td><td>å¯ä¿®<strong>æ”¹</strong>æ€§</td><td>æ˜“å®‰<strong>è£…</strong>æ€§</td></tr><tr><td>äº’<strong>ç”¨</strong>æ€§</td><td><strong>æˆ</strong>ç†Ÿæ€§</td><td>æ˜“æ“<strong>ä½œ</strong>æ€§</td><td></td><td>ç¨³<strong>å®š</strong>æ€§</td><td><strong>ä¸€</strong>è‡´æ€§</td></tr><tr><td><strong>ä¾</strong>ä»æ€§</td><td></td><td></td><td></td><td>æ˜“<strong>åˆ†</strong>ææ€§</td><td>å¯<strong>æ›¿</strong>æ¢æ€§</td></tr><tr><td><strong>å®‰</strong>å…¨æ€§</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table></blockquote>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬10ç« ã€é¡¹ç›®çš„å˜æ›´ç®¡ç†å’Œå®‰å…¨ç®¡ç†</title>
    <link href="/2021/08/31/%E7%AC%AC10%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8F%98%E6%9B%B4%E7%AE%A1%E7%90%86%E5%92%8C%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86/"/>
    <url>/2021/08/31/%E7%AC%AC10%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%8F%98%E6%9B%B4%E7%AE%A1%E7%90%86%E5%92%8C%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬10ç« ã€é¡¹ç›®çš„å˜æ›´ç®¡ç†å’Œå®‰å…¨ç®¡ç†"><a href="#ç¬¬10ç« ã€é¡¹ç›®çš„å˜æ›´ç®¡ç†å’Œå®‰å…¨ç®¡ç†" class="headerlink" title="ç¬¬10ç« ã€é¡¹ç›®çš„å˜æ›´ç®¡ç†å’Œå®‰å…¨ç®¡ç†"></a>ç¬¬10ç« ã€é¡¹ç›®çš„å˜æ›´ç®¡ç†å’Œå®‰å…¨ç®¡ç†</h1><span id="more"></span><h2 id="ä¸€ã€å˜æ›´ç®¡ç†"><a href="#ä¸€ã€å˜æ›´ç®¡ç†" class="headerlink" title="ä¸€ã€å˜æ›´ç®¡ç†"></a>ä¸€ã€å˜æ›´ç®¡ç†</h2><h3 id="1ã€åŸºæœ¬æ¦‚å¿µ"><a href="#1ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1ã€åŸºæœ¬æ¦‚å¿µ"></a>1ã€åŸºæœ¬æ¦‚å¿µ</h3><h4 id="1ï¼‰é¡¹ç›®å˜æ›´ç®¡ç†çš„å®šä¹‰"><a href="#1ï¼‰é¡¹ç›®å˜æ›´ç®¡ç†çš„å®šä¹‰" class="headerlink" title="1ï¼‰é¡¹ç›®å˜æ›´ç®¡ç†çš„å®šä¹‰"></a>1ï¼‰é¡¹ç›®å˜æ›´ç®¡ç†çš„å®šä¹‰</h4><h5 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><p>æŒ‡åœ¨ä¿¡æ¯ç³»ç»Ÿå·¥ç¨‹å»ºè®¾é¡¹ç›®çš„å®æ–½è¿‡ç¨‹ä¸­ï¼Œç”±äºé¡¹ç›®ç¯å¢ƒæˆ–å…¶ä»–çš„åŸå› å¯¹é¡¹ç›®çš„<strong>åŠŸèƒ½ã€æ€§èƒ½ã€æ¶æ„ã€æŠ€æœ¯æŒ‡æ ‡ã€é›†æˆæ–¹æ³•ã€é¡¹ç›®è¿›åº¦</strong>ç­‰æ–¹é¢åšå‡ºçš„æ›´æ”¹</p><h5 id="2-ç‰¹ç‚¹"><a href="#2-ç‰¹ç‚¹" class="headerlink" title="2. ç‰¹ç‚¹"></a>2. ç‰¹ç‚¹</h5><ul><li><strong>å˜æ›´çš„å½±å“å¯èƒ½æ˜¯ç§¯æçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¶ˆæçš„</strong></li><li>åšå¥½å˜æ›´ç®¡ç†ï¼Œå¯ä»¥ä½¿é¡¹ç›®çš„è´¨é‡ã€è¿›åº¦ã€æˆæœ¬ç®¡ç†æ›´åŠ æœ‰æ•ˆ</li></ul><h4 id="2ï¼‰é¡¹ç›®å˜æ›´äº§ç”Ÿçš„åŸå› "><a href="#2ï¼‰é¡¹ç›®å˜æ›´äº§ç”Ÿçš„åŸå› " class="headerlink" title="2ï¼‰é¡¹ç›®å˜æ›´äº§ç”Ÿçš„åŸå› "></a>2ï¼‰é¡¹ç›®å˜æ›´äº§ç”Ÿçš„åŸå› </h4><h5 id="1-äº§å“èŒƒå›´ï¼ˆæˆæœï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½"><a href="#1-äº§å“èŒƒå›´ï¼ˆæˆæœï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½" class="headerlink" title="1. äº§å“èŒƒå›´ï¼ˆæˆæœï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½"></a>1. äº§å“èŒƒå›´ï¼ˆæˆæœï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½</h5><h5 id="2-é¡¹ç›®èŒƒå›´ï¼ˆå·¥ä½œï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½"><a href="#2-é¡¹ç›®èŒƒå›´ï¼ˆå·¥ä½œï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½" class="headerlink" title="2. é¡¹ç›®èŒƒå›´ï¼ˆå·¥ä½œï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½"></a>2. é¡¹ç›®èŒƒå›´ï¼ˆå·¥ä½œï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½</h5><h5 id="3-å¢å€¼å˜æ›´"><a href="#3-å¢å€¼å˜æ›´" class="headerlink" title="3. å¢å€¼å˜æ›´"></a>3. å¢å€¼å˜æ›´</h5><h5 id="4-åº”å¯¹é£é™©çš„ç´§æ€¥è®¡åˆ’æˆ–å›é¿è®¡åˆ’"><a href="#4-åº”å¯¹é£é™©çš„ç´§æ€¥è®¡åˆ’æˆ–å›é¿è®¡åˆ’" class="headerlink" title="4. åº”å¯¹é£é™©çš„ç´§æ€¥è®¡åˆ’æˆ–å›é¿è®¡åˆ’"></a>4. åº”å¯¹é£é™©çš„ç´§æ€¥è®¡åˆ’æˆ–å›é¿è®¡åˆ’</h5><h5 id="5-é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹ä¸åŸºå‡†è¦æ±‚ä¸ä¸€è‡´å¯¼è‡´çš„è¢«åŠ¨è°ƒæ•´"><a href="#5-é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹ä¸åŸºå‡†è¦æ±‚ä¸ä¸€è‡´å¯¼è‡´çš„è¢«åŠ¨è°ƒæ•´" class="headerlink" title="5. é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹ä¸åŸºå‡†è¦æ±‚ä¸ä¸€è‡´å¯¼è‡´çš„è¢«åŠ¨è°ƒæ•´"></a>5. é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹ä¸åŸºå‡†è¦æ±‚ä¸ä¸€è‡´å¯¼è‡´çš„è¢«åŠ¨è°ƒæ•´</h5><h5 id="6-å¤–éƒ¨äº‹ä»¶"><a href="#6-å¤–éƒ¨äº‹ä»¶" class="headerlink" title="6. å¤–éƒ¨äº‹ä»¶"></a>6. å¤–éƒ¨äº‹ä»¶</h5><h4 id="3ï¼‰é¡¹ç›®å˜æ›´çš„åˆ†ç±»"><a href="#3ï¼‰é¡¹ç›®å˜æ›´çš„åˆ†ç±»" class="headerlink" title="3ï¼‰é¡¹ç›®å˜æ›´çš„åˆ†ç±»"></a>3ï¼‰é¡¹ç›®å˜æ›´çš„åˆ†ç±»</h4><h5 id="1-æ ¹æ®å˜æ›´æ€§è´¨åˆ’åˆ†"><a href="#1-æ ¹æ®å˜æ›´æ€§è´¨åˆ’åˆ†" class="headerlink" title="1. æ ¹æ®å˜æ›´æ€§è´¨åˆ’åˆ†"></a>1. æ ¹æ®å˜æ›´æ€§è´¨åˆ’åˆ†</h5><h6 id="åˆ†ç±»ï¼š"><a href="#åˆ†ç±»ï¼š" class="headerlink" title="åˆ†ç±»ï¼š"></a>åˆ†ç±»ï¼š</h6><ul><li>é‡å¤§å˜æ›´</li><li>é‡è¦å˜æ›´</li><li>ä¸€èˆ¬å˜æ›´</li></ul><h6 id="æ§åˆ¶æ–¹æ³•ï¼š"><a href="#æ§åˆ¶æ–¹æ³•ï¼š" class="headerlink" title="æ§åˆ¶æ–¹æ³•ï¼š"></a>æ§åˆ¶æ–¹æ³•ï¼š</h6><ul><li>é€šè¿‡ä¸åŒå®¡æ‰¹æƒé™æ§åˆ¶</li></ul><h5 id="2-æ ¹æ®å˜æ›´çš„ç´§è¿«æ€§åˆ’åˆ†"><a href="#2-æ ¹æ®å˜æ›´çš„ç´§è¿«æ€§åˆ’åˆ†" class="headerlink" title="2. æ ¹æ®å˜æ›´çš„ç´§è¿«æ€§åˆ’åˆ†"></a>2. æ ¹æ®å˜æ›´çš„ç´§è¿«æ€§åˆ’åˆ†</h5><h6 id="åˆ†ç±»ï¼š-1"><a href="#åˆ†ç±»ï¼š-1" class="headerlink" title="åˆ†ç±»ï¼š"></a>åˆ†ç±»ï¼š</h6><ul><li>ç´§æ€¥å˜æ›´</li><li>éç´§æ€¥å˜æ›´</li></ul><h6 id="æ§åˆ¶æ–¹æ³•ï¼š-1"><a href="#æ§åˆ¶æ–¹æ³•ï¼š-1" class="headerlink" title="æ§åˆ¶æ–¹æ³•ï¼š"></a>æ§åˆ¶æ–¹æ³•ï¼š</h6><ul><li>é€šè¿‡ä¸åŒçš„å˜æ›´å¤„ç†æµç¨‹è¿›è¡Œ </li></ul><h3 id="2ã€åŸåˆ™å’Œå·¥ä½œæµç¨‹"><a href="#2ã€åŸåˆ™å’Œå·¥ä½œæµç¨‹" class="headerlink" title="2ã€åŸåˆ™å’Œå·¥ä½œæµç¨‹"></a>2ã€åŸåˆ™å’Œå·¥ä½œæµç¨‹</h3><h4 id="1ï¼‰é¡¹ç›®å˜æ›´ç®¡ç†çš„åŸåˆ™"><a href="#1ï¼‰é¡¹ç›®å˜æ›´ç®¡ç†çš„åŸåˆ™" class="headerlink" title="1ï¼‰é¡¹ç›®å˜æ›´ç®¡ç†çš„åŸåˆ™"></a>1ï¼‰é¡¹ç›®å˜æ›´ç®¡ç†çš„åŸåˆ™</h4><h4 id="2ï¼‰å˜æ›´ç®¡ç†çš„ç»„ç»‡æœºæ„"><a href="#2ï¼‰å˜æ›´ç®¡ç†çš„ç»„ç»‡æœºæ„" class="headerlink" title="2ï¼‰å˜æ›´ç®¡ç†çš„ç»„ç»‡æœºæ„"></a>2ï¼‰å˜æ›´ç®¡ç†çš„ç»„ç»‡æœºæ„</h4><h4 id="3ï¼‰å˜æ›´ç®¡ç†çš„å·¥ä½œç¨‹åº"><a href="#3ï¼‰å˜æ›´ç®¡ç†çš„å·¥ä½œç¨‹åº" class="headerlink" title="3ï¼‰å˜æ›´ç®¡ç†çš„å·¥ä½œç¨‹åº"></a>3ï¼‰å˜æ›´ç®¡ç†çš„å·¥ä½œç¨‹åº</h4><h3 id="3ã€å·¥ä½œå†…å®¹"><a href="#3ã€å·¥ä½œå†…å®¹" class="headerlink" title="3ã€å·¥ä½œå†…å®¹"></a>3ã€å·¥ä½œå†…å®¹</h3><h4 id="1ï¼‰å˜æ›´ç”³è¯·çš„æäº¤"><a href="#1ï¼‰å˜æ›´ç”³è¯·çš„æäº¤" class="headerlink" title="1ï¼‰å˜æ›´ç”³è¯·çš„æäº¤"></a>1ï¼‰å˜æ›´ç”³è¯·çš„æäº¤</h4><h4 id="2ï¼‰å˜æ›´æ§åˆ¶"><a href="#2ï¼‰å˜æ›´æ§åˆ¶" class="headerlink" title="2ï¼‰å˜æ›´æ§åˆ¶"></a>2ï¼‰å˜æ›´æ§åˆ¶</h4><h4 id="3ï¼‰å˜æ›´ç®¡ç†ä¸å…¶ä»–é¡¹ç›®ç®¡ç†è¦ç´ çš„å…³ç³»"><a href="#3ï¼‰å˜æ›´ç®¡ç†ä¸å…¶ä»–é¡¹ç›®ç®¡ç†è¦ç´ çš„å…³ç³»" class="headerlink" title="3ï¼‰å˜æ›´ç®¡ç†ä¸å…¶ä»–é¡¹ç›®ç®¡ç†è¦ç´ çš„å…³ç³»"></a>3ï¼‰å˜æ›´ç®¡ç†ä¸å…¶ä»–é¡¹ç›®ç®¡ç†è¦ç´ çš„å…³ç³»</h4><h4 id="4ï¼‰è½¯ä»¶ç‰ˆæœ¬å‘å¸ƒä¸å›é€€æ–¹æ¡ˆ"><a href="#4ï¼‰è½¯ä»¶ç‰ˆæœ¬å‘å¸ƒä¸å›é€€æ–¹æ¡ˆ" class="headerlink" title="4ï¼‰è½¯ä»¶ç‰ˆæœ¬å‘å¸ƒä¸å›é€€æ–¹æ¡ˆ"></a>4ï¼‰è½¯ä»¶ç‰ˆæœ¬å‘å¸ƒä¸å›é€€æ–¹æ¡ˆ</h4><p>å˜æ›´ç®¡ç†çš„8ä¸ªæ­¥éª¤</p><p>å¯¹æˆæœ¬å˜æ›´çš„æ§åˆ¶</p><h2 id="äºŒã€å®‰å…¨ç®¡ç†"><a href="#äºŒã€å®‰å…¨ç®¡ç†" class="headerlink" title="äºŒã€å®‰å…¨ç®¡ç†"></a>äºŒã€å®‰å…¨ç®¡ç†</h2><h3 id="1ã€ä¿¡æ¯å®‰å…¨ç­–ç•¥"><a href="#1ã€ä¿¡æ¯å®‰å…¨ç­–ç•¥" class="headerlink" title="1ã€ä¿¡æ¯å®‰å…¨ç­–ç•¥"></a>1ã€ä¿¡æ¯å®‰å…¨ç­–ç•¥</h3><h4 id="1ï¼‰å®‰å…¨ç­–ç•¥çš„æ¦‚å¿µä¸å†…å®¹"><a href="#1ï¼‰å®‰å…¨ç­–ç•¥çš„æ¦‚å¿µä¸å†…å®¹" class="headerlink" title="1ï¼‰å®‰å…¨ç­–ç•¥çš„æ¦‚å¿µä¸å†…å®¹"></a>1ï¼‰å®‰å…¨ç­–ç•¥çš„æ¦‚å¿µä¸å†…å®¹</h4><h4 id="2ï¼‰ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ç­‰çº§ä¿æŠ¤çš„æ¦‚å¿µ"><a href="#2ï¼‰ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ç­‰çº§ä¿æŠ¤çš„æ¦‚å¿µ" class="headerlink" title="2ï¼‰ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ç­‰çº§ä¿æŠ¤çš„æ¦‚å¿µ"></a>2ï¼‰ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ç­‰çº§ä¿æŠ¤çš„æ¦‚å¿µ</h4><h3 id="2ã€ä¿¡æ¯å®‰å…¨ç³»ç»Ÿ"><a href="#2ã€ä¿¡æ¯å®‰å…¨ç³»ç»Ÿ" class="headerlink" title="2ã€ä¿¡æ¯å®‰å…¨ç³»ç»Ÿ"></a>2ã€ä¿¡æ¯å®‰å…¨ç³»ç»Ÿ</h3><h4 id="1ï¼‰ä¿¡æ¯å®‰å…¨ç³»ç»Ÿçš„ä¸‰ç§æ¶æ„ä½“ç³»"><a href="#1ï¼‰ä¿¡æ¯å®‰å…¨ç³»ç»Ÿçš„ä¸‰ç§æ¶æ„ä½“ç³»" class="headerlink" title="1ï¼‰ä¿¡æ¯å®‰å…¨ç³»ç»Ÿçš„ä¸‰ç§æ¶æ„ä½“ç³»"></a>1ï¼‰ä¿¡æ¯å®‰å…¨ç³»ç»Ÿçš„ä¸‰ç§æ¶æ„ä½“ç³»</h4><h4 id="2ï¼‰ä¿¡æ¯å®‰å…¨ç³»ç»Ÿä¸‰ç»´ç©ºé—´"><a href="#2ï¼‰ä¿¡æ¯å®‰å…¨ç³»ç»Ÿä¸‰ç»´ç©ºé—´" class="headerlink" title="2ï¼‰ä¿¡æ¯å®‰å…¨ç³»ç»Ÿä¸‰ç»´ç©ºé—´"></a>2ï¼‰ä¿¡æ¯å®‰å…¨ç³»ç»Ÿä¸‰ç»´ç©ºé—´</h4><h3 id="3ã€PKIå…¬å¼€å¯†é’¥åŸºç¡€è®¾ç½®"><a href="#3ã€PKIå…¬å¼€å¯†é’¥åŸºç¡€è®¾ç½®" class="headerlink" title="3ã€PKIå…¬å¼€å¯†é’¥åŸºç¡€è®¾ç½®"></a>3ã€PKIå…¬å¼€å¯†é’¥åŸºç¡€è®¾ç½®</h3><h4 id="1ï¼‰PKIæ€»ä½“æ¶æ„"><a href="#1ï¼‰PKIæ€»ä½“æ¶æ„" class="headerlink" title="1ï¼‰PKIæ€»ä½“æ¶æ„"></a>1ï¼‰PKIæ€»ä½“æ¶æ„</h4><h4 id="2ï¼‰X-509-æ ‡å‡†"><a href="#2ï¼‰X-509-æ ‡å‡†" class="headerlink" title="2ï¼‰X.509 æ ‡å‡†"></a>2ï¼‰X.509 æ ‡å‡†</h4><h3 id="4ã€PMI-æƒé™ï¼ˆæˆæƒï¼‰ç®¡ç†åŸºç¡€è®¾æ–½"><a href="#4ã€PMI-æƒé™ï¼ˆæˆæƒï¼‰ç®¡ç†åŸºç¡€è®¾æ–½" class="headerlink" title="4ã€PMI æƒé™ï¼ˆæˆæƒï¼‰ç®¡ç†åŸºç¡€è®¾æ–½"></a>4ã€PMI æƒé™ï¼ˆæˆæƒï¼‰ç®¡ç†åŸºç¡€è®¾æ–½</h3><h4 id="1ï¼‰PMI-çš„æ¦‚å¿µ"><a href="#1ï¼‰PMI-çš„æ¦‚å¿µ" class="headerlink" title="1ï¼‰PMI çš„æ¦‚å¿µ"></a>1ï¼‰PMI çš„æ¦‚å¿µ</h4><h4 id="2ï¼‰PMI-ä¸-PKI-çš„åŒºåˆ«"><a href="#2ï¼‰PMI-ä¸-PKI-çš„åŒºåˆ«" class="headerlink" title="2ï¼‰PMI ä¸ PKI çš„åŒºåˆ«"></a>2ï¼‰PMI ä¸ PKI çš„åŒºåˆ«</h4><h4 id="3ï¼‰è®¿é—®æ§åˆ¶"><a href="#3ï¼‰è®¿é—®æ§åˆ¶" class="headerlink" title="3ï¼‰è®¿é—®æ§åˆ¶"></a>3ï¼‰è®¿é—®æ§åˆ¶</h4><h4 id="4ï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"><a href="#4ï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶" class="headerlink" title="4ï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶"></a>4ï¼‰åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</h4><h3 id="5ã€ä¿¡æ¯å®‰å…¨å®¡è®¡"><a href="#5ã€ä¿¡æ¯å®‰å…¨å®¡è®¡" class="headerlink" title="5ã€ä¿¡æ¯å®‰å…¨å®¡è®¡"></a>5ã€ä¿¡æ¯å®‰å…¨å®¡è®¡</h3><h4 id="1ï¼‰å®‰å…¨å®¡è®¡çš„æ¦‚å¿µä¸ä½œç”¨"><a href="#1ï¼‰å®‰å…¨å®¡è®¡çš„æ¦‚å¿µä¸ä½œç”¨" class="headerlink" title="1ï¼‰å®‰å…¨å®¡è®¡çš„æ¦‚å¿µä¸ä½œç”¨"></a>1ï¼‰å®‰å…¨å®¡è®¡çš„æ¦‚å¿µä¸ä½œç”¨</h4><h4 id="2ï¼‰å»ºç«‹å®‰å…¨å®¡è®¡ç³»ç»Ÿ"><a href="#2ï¼‰å»ºç«‹å®‰å…¨å®¡è®¡ç³»ç»Ÿ" class="headerlink" title="2ï¼‰å»ºç«‹å®‰å…¨å®¡è®¡ç³»ç»Ÿ"></a>2ï¼‰å»ºç«‹å®‰å…¨å®¡è®¡ç³»ç»Ÿ</h4><h4 id="3ï¼‰åˆ†å¸ƒå¼å®¡è®¡ç³»ç»Ÿ"><a href="#3ï¼‰åˆ†å¸ƒå¼å®¡è®¡ç³»ç»Ÿ" class="headerlink" title="3ï¼‰åˆ†å¸ƒå¼å®¡è®¡ç³»ç»Ÿ"></a>3ï¼‰åˆ†å¸ƒå¼å®¡è®¡ç³»ç»Ÿ</h4><h2 id="ä¸‰ã€ä½œä¸š"><a href="#ä¸‰ã€ä½œä¸š" class="headerlink" title="ä¸‰ã€ä½œä¸š"></a>ä¸‰ã€ä½œä¸š</h2><h3 id="1ã€å˜æ›´çš„å¸¸è§åŸå› "><a href="#1ã€å˜æ›´çš„å¸¸è§åŸå› " class="headerlink" title="1ã€å˜æ›´çš„å¸¸è§åŸå› "></a>1ã€å˜æ›´çš„å¸¸è§åŸå› </h3><ul><li>äº§å“èŒƒå›´ï¼ˆæˆæœï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½</li><li>é¡¹ç›®èŒƒå›´ï¼ˆå·¥ä½œï¼‰å®šä¹‰çš„è¿‡å¤±æˆ–ç–å¿½</li><li>å¢å€¼å˜æ›´</li><li>åº”å¯¹é£é™©çš„ç´§æ€¥è®¡åˆ’æˆ–å›é¿è®¡åˆ’</li><li>é¡¹ç›®æ‰§è¡Œè¿‡ç¨‹ä¸åŸºå‡†è¦æ±‚ä¸ä¸€è‡´å¸¦æ¥çš„è¢«åŠ¨è°ƒæ•´</li><li>å¤–éƒ¨äº‹ä»¶</li></ul><h3 id="2ã€å˜æ›´çš„åˆ†ç±»"><a href="#2ã€å˜æ›´çš„åˆ†ç±»" class="headerlink" title="2ã€å˜æ›´çš„åˆ†ç±»"></a>2ã€å˜æ›´çš„åˆ†ç±»</h3><ul><li>æ ¹æ®æ€§è´¨åˆ’åˆ†ï¼ˆé€šè¿‡ä¸åŒå®¡æ‰¹æƒé™æ§åˆ¶ï¼‰<ul><li>é‡å¤§å˜æ›´</li><li>é‡è¦å˜æ›´</li><li>ä¸€èˆ¬å˜æ›´</li></ul></li><li>æ ¹æ®å˜æ›´æ€¥è¿«æ€§åˆ’åˆ†ï¼ˆé€šè¿‡ä¸åŒå˜æ›´å¤„ç†è¿›è¡Œæ§åˆ¶ï¼‰<ul><li>ç´§æ€¥å˜æ›´</li><li>éç´§æ€¥å˜æ›´</li></ul></li></ul><h3 id="3ã€åŒºåˆ†äº§å“èŒƒå›´å’Œé¡¹ç›®èŒƒå›´"><a href="#3ã€åŒºåˆ†äº§å“èŒƒå›´å’Œé¡¹ç›®èŒƒå›´" class="headerlink" title="3ã€åŒºåˆ†äº§å“èŒƒå›´å’Œé¡¹ç›®èŒƒå›´"></a>3ã€åŒºåˆ†äº§å“èŒƒå›´å’Œé¡¹ç›®èŒƒå›´</h3><h3 id="4ã€å˜æ›´ç®¡ç†çš„8ä¸ªæ­¥éª¤-8ä¸ªå˜æ›´æµç¨‹"><a href="#4ã€å˜æ›´ç®¡ç†çš„8ä¸ªæ­¥éª¤-8ä¸ªå˜æ›´æµç¨‹" class="headerlink" title="4ã€å˜æ›´ç®¡ç†çš„8ä¸ªæ­¥éª¤/8ä¸ªå˜æ›´æµç¨‹"></a>4ã€å˜æ›´ç®¡ç†çš„8ä¸ªæ­¥éª¤/8ä¸ªå˜æ›´æµç¨‹</h3><h3 id="5ã€å®‰å…¨ç­–ç•¥çš„æ ¸å¿ƒå†…å®¹"><a href="#5ã€å®‰å…¨ç­–ç•¥çš„æ ¸å¿ƒå†…å®¹" class="headerlink" title="5ã€å®‰å…¨ç­–ç•¥çš„æ ¸å¿ƒå†…å®¹"></a>5ã€å®‰å…¨ç­–ç•¥çš„æ ¸å¿ƒå†…å®¹</h3><h3 id="6ã€ä¿¡æ¯å®‰å…¨çš„å±æ€§"><a href="#6ã€ä¿¡æ¯å®‰å…¨çš„å±æ€§" class="headerlink" title="6ã€ä¿¡æ¯å®‰å…¨çš„å±æ€§"></a>6ã€ä¿¡æ¯å®‰å…¨çš„å±æ€§</h3><blockquote><p>1ã€å®Œæ•´æ€§: ä¿¡æ¯åœ¨å­˜å‚¨å’Œä¼ è¾“è¿‡ç¨‹ä¸­ä¿æŒ<strong>ä¸è¢«ä¿®æ”¹ã€ä¸è¢«ç ´åã€ä¸è¢«æ’å…¥ã€ä¸å»¶è¿Ÿã€ä¸ä¹±åºå’Œä¸ä¸¢å¤±</strong></p></blockquote><h3 id="7ã€ä¿¡æ¯çš„è´¨é‡å±æ€§"><a href="#7ã€ä¿¡æ¯çš„è´¨é‡å±æ€§" class="headerlink" title="7ã€ä¿¡æ¯çš„è´¨é‡å±æ€§"></a>7ã€ä¿¡æ¯çš„è´¨é‡å±æ€§</h3><h3 id="8ã€ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ç­‰çº§ä¿æŠ¤çš„æ¦‚å¿µ"><a href="#8ã€ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ç­‰çº§ä¿æŠ¤çš„æ¦‚å¿µ" class="headerlink" title="8ã€ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ç­‰çº§ä¿æŠ¤çš„æ¦‚å¿µ"></a>8ã€ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ç­‰çº§ä¿æŠ¤çš„æ¦‚å¿µ</h3>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬9ç« ã€é¡¹ç›®çš„åˆåŒç®¡ç†å’Œæ–‡æ¡£ä¸é…ç½®ç®¡ç†</title>
    <link href="/2021/08/31/%E7%AC%AC9%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%90%88%E5%90%8C%E7%AE%A1%E7%90%86%E5%92%8C%E6%96%87%E6%A1%A3%E4%B8%8E%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/"/>
    <url>/2021/08/31/%E7%AC%AC9%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%90%88%E5%90%8C%E7%AE%A1%E7%90%86%E5%92%8C%E6%96%87%E6%A1%A3%E4%B8%8E%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬9ç« ã€é¡¹ç›®çš„åˆåŒç®¡ç†å’Œæ–‡æ¡£ä¸é…ç½®ç®¡ç†"><a href="#ç¬¬9ç« ã€é¡¹ç›®çš„åˆåŒç®¡ç†å’Œæ–‡æ¡£ä¸é…ç½®ç®¡ç†" class="headerlink" title="ç¬¬9ç« ã€é¡¹ç›®çš„åˆåŒç®¡ç†å’Œæ–‡æ¡£ä¸é…ç½®ç®¡ç†"></a>ç¬¬9ç« ã€é¡¹ç›®çš„åˆåŒç®¡ç†å’Œæ–‡æ¡£ä¸é…ç½®ç®¡ç†</h1><span id="more"></span><h2 id="ä¸€ã€åˆåŒç®¡ç†"><a href="#ä¸€ã€åˆåŒç®¡ç†" class="headerlink" title="ä¸€ã€åˆåŒç®¡ç†"></a>ä¸€ã€åˆåŒç®¡ç†</h2><h3 id="1ã€åˆåŒå½¢å¼"><a href="#1ã€åˆåŒå½¢å¼" class="headerlink" title="1ã€åˆåŒå½¢å¼"></a>1ã€åˆåŒå½¢å¼</h3><h4 id="1ï¼‰æœ€æ–°çš„æ³•è§„"><a href="#1ï¼‰æœ€æ–°çš„æ³•è§„" class="headerlink" title="1ï¼‰æœ€æ–°çš„æ³•è§„"></a>1ï¼‰æœ€æ–°çš„æ³•è§„</h4><p>2021å¹´1æœˆèµ·ï¼Œé¢å¸ƒã€Šä¸­åäººæ°‘å…±å’Œå›½æ°‘æ³•å…¸ã€‹ï¼ŒåŸæ¥çš„ã€ŠåˆåŒæ³•ã€‹åˆå¹¶å…¶ä¸­ï¼Œå¹¶è§„èŒƒäº†éƒ¨åˆ†è§£é‡Š</p><h5 id="ã€Šæ°‘æ³•å…¸ã€‹å¯¹åˆåŒå½¢å¼çš„è§£é‡Š"><a href="#ã€Šæ°‘æ³•å…¸ã€‹å¯¹åˆåŒå½¢å¼çš„è§£é‡Š" class="headerlink" title="ã€Šæ°‘æ³•å…¸ã€‹å¯¹åˆåŒå½¢å¼çš„è§£é‡Š"></a>ã€Šæ°‘æ³•å…¸ã€‹å¯¹åˆåŒå½¢å¼çš„è§£é‡Š</h5><blockquote><p>**ç¬¬å››ç™¾å…­åä¹æ¡: **</p><p>å½“äº‹äººè®¢ç«‹åˆåŒï¼Œå¯ä»¥é‡‡ç”¨ä¹¦é¢å½¢å¼ã€å£å¤´å½¢å¼æˆ–è€…å…¶ä»–å½¢å¼ã€‚</p><p>ä¹¦é¢å½¢å¼æ˜¯åˆåŒä¹¦ã€ä¿¡ä»¶ã€ç”µæŠ¥ã€ç”µä¼ ã€ä¼ çœŸç­‰å¯ä»¥æœ‰å½¢åœ°è¡¨ç°æ‰€è½½å†…å®¹çš„å½¢å¼ã€‚</p><p>ä»¥ç”µå­æ•°æ®äº¤æ¢ã€ç”µå­é‚®ä»¶ç­‰æ–¹å¼èƒ½å¤Ÿæœ‰å½¢åœ°è¡¨ç°æ‰€è½½å†…å®¹ï¼Œå¹¶å¯ä»¥éšæ—¶è°ƒå–èŒ¶ç”¨çš„æ•°æ®ç”µæ–‡ï¼Œè§†ä¸ºä¹¦é¢å½¢å¼ã€‚</p></blockquote><h4 id="2ï¼‰ä¹¦é¢å½¢å¼"><a href="#2ï¼‰ä¹¦é¢å½¢å¼" class="headerlink" title="2ï¼‰ä¹¦é¢å½¢å¼"></a>2ï¼‰ä¹¦é¢å½¢å¼</h4><h5 id="æ¦‚å¿µï¼š"><a href="#æ¦‚å¿µï¼š" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h5><p>æŒ‡ä»¥æ–‡å­—å†™æˆä¹¦é¢æ–‡ä»¶çš„æ–¹å¼è¾¾æˆçš„åè®®</p><h5 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h5><ul><li>å½¢å¼æ˜ç¡®è‚¯å®šï¼Œæœ‰æ®å¯æŸ¥</li><li>å¯¹äºé˜²æ­¢çº çº·å’Œè§£å†³äº‰è®®å…·æœ‰é‡è¦ä½œç”¨</li></ul><h4 id="3ï¼‰å£å¤´å½¢å¼"><a href="#3ï¼‰å£å¤´å½¢å¼" class="headerlink" title="3ï¼‰å£å¤´å½¢å¼"></a>3ï¼‰å£å¤´å½¢å¼</h4><h5 id="æ¦‚å¿µï¼š-1"><a href="#æ¦‚å¿µï¼š-1" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h5><p>æŒ‡å½“äº‹äººé¢å¯¹é¢åœ°è°ˆè¯æˆ–è€…ä»¥ç”µè¯äº¤è°ˆç­‰æ–¹å¼è¾¾æˆçš„åè®®</p><h5 id="ç‰¹ç‚¹ï¼š-1"><a href="#ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h5><ul><li>ç›´æ¥ã€ç®€ä¾¿ã€å¿«é€Ÿ</li><li>æ•°é¢è¾ƒå°æˆ–è€…ç°æ¬¾äº¤æ˜“é€šå¸¸é‡‡ç”¨å£å¤´å½¢å¼</li><li>æ˜¯è€ç™¾å§“æ—¥å¸¸ç”Ÿæ´»ä¸­å¹¿æ³›é‡‡ç”¨çš„åˆåŒå½¢å¼</li></ul><h5 id="ç¼ºé™·ï¼š"><a href="#ç¼ºé™·ï¼š" class="headerlink" title="ç¼ºé™·ï¼š"></a>ç¼ºé™·ï¼š</h5><ul><li>å‘ç”Ÿçº çº·ä¸¾è¯å›°éš¾</li></ul><h4 id="4ï¼‰å…¶ä»–å½¢å¼"><a href="#4ï¼‰å…¶ä»–å½¢å¼" class="headerlink" title="4ï¼‰å…¶ä»–å½¢å¼"></a>4ï¼‰å…¶ä»–å½¢å¼</h4><h5 id="æ¦‚å¿µï¼š-2"><a href="#æ¦‚å¿µï¼š-2" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h5><p>æŒ‡æ ¹æ®å½“äº‹äººçš„è¡Œä¸ºæˆ–è€…ç‰¹å®šæƒ…å½¢<strong>æ¨å®šæˆç«‹</strong>çš„åˆåŒï¼Œä¹Ÿç§°ä¸º<strong>é»˜ç¤ºåˆåŒ</strong></p><h5 id="ç‰¹ç‚¹ï¼š-2"><a href="#ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h5><p>å½“äº‹äººæœªç”¨è¯­è¨€æ˜ç¡®è¡¨ç¤ºæˆç«‹ï¼Œè€Œæ˜¯æ ¹æ®å½“äº‹äººçš„è¡Œä¸ºæ¨å®šæˆç«‹</p><h5 id="æ ·ä¾‹ï¼š"><a href="#æ ·ä¾‹ï¼š" class="headerlink" title="æ ·ä¾‹ï¼š"></a>æ ·ä¾‹ï¼š</h5><p>å¦‚æˆ¿å±‹ç§ŸèµåˆåŒï¼Œç§ŸèµæœŸæ»¡åï¼Œå‡ºç§Ÿäººä¸ºæå‡ºè®©æ‰¿ç§Ÿäººé€€æˆ¿ï¼Œæ‰¿ç§Ÿäººä¹Ÿæœªè¡¨ç¤ºé€€æˆ¿è€Œç»§ç»­äº¤ç§Ÿé‡‘ï¼Œå‡ºç§Ÿäººä»æ¥å—ç§Ÿé‡‘ï¼Œå°½ç®¡å½“äº‹äººä¹‹é—´æ²¡æœ‰é‡æ–°ç­¾è®¢åˆåŒï¼Œä½†æ˜¯ä¾è¡Œä¸ºæ¨å®šï¼ŒåˆåŒä»æœ‰æ•ˆï¼Œç»§ç»­å±¥è¡Œ</p><h3 id="2ã€åˆåŒç­¾è®¢ä¹‹å‰çš„ç¨‹åº"><a href="#2ã€åˆåŒç­¾è®¢ä¹‹å‰çš„ç¨‹åº" class="headerlink" title="2ã€åˆåŒç­¾è®¢ä¹‹å‰çš„ç¨‹åº"></a>2ã€åˆåŒç­¾è®¢ä¹‹å‰çš„ç¨‹åº</h3><h4 id="1ï¼‰è¦çº¦"><a href="#1ï¼‰è¦çº¦" class="headerlink" title="1ï¼‰è¦çº¦"></a>1ï¼‰è¦çº¦</h4><h5 id="æ¦‚å¿µï¼š-3"><a href="#æ¦‚å¿µï¼š-3" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h5><p>å¸Œæœ›ä¸ä»–äººè®¢ç«‹åˆåŒï¼ˆæŠ•æ ‡æ–‡ä»¶ï¼‰</p><h5 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹:"></a>ç‰¹ç‚¹:</h5><ul><li>å†…å®¹å…·ä½“ç¡®å®šï¼Œå¦‚ä»·æ ¼ã€è§„æ ¼ã€å‹å·ã€æ•°é‡</li><li>ç»å—è¦çº¦äººæ‰¿è¯ºï¼Œä¸€æ—¦æ¥å—å°±å¿…é¡»å»åš</li></ul><h4 id="2ï¼‰è¦çº¦é‚€è¯·"><a href="#2ï¼‰è¦çº¦é‚€è¯·" class="headerlink" title="2ï¼‰è¦çº¦é‚€è¯·"></a>2ï¼‰è¦çº¦é‚€è¯·</h4><h5 id="æ¦‚å¿µï¼š-4"><a href="#æ¦‚å¿µï¼š-4" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h5><p>å¸Œæœ›ä»–äººå‘è‡ªå·±å‘å‡ºè¦çº¦ï¼ˆæ‹›æ ‡æ–‡ä»¶ï¼‰</p><h5 id="ç‰¹ç‚¹ï¼š-3"><a href="#ç‰¹ç‚¹ï¼š-3" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h5><p>è¦çº¦é‚€è¯·ä¸ä¼šç¡®å®šå…·ä½“çš„ä»·æ ¼</p><h5 id="æ ·ä¾‹ï¼š-1"><a href="#æ ·ä¾‹ï¼š-1" class="headerlink" title="æ ·ä¾‹ï¼š"></a>æ ·ä¾‹ï¼š</h5><p>æ‹å–å…¬å‘Šã€æ‹›æ ‡å…¬å‘Šã€æ‹›è‚¡è¯´æ˜ä¹¦ã€å€ºåˆ¸å‹Ÿé›†åŠæ³•ã€åŸºé‡‘æ‹›å‹Ÿè¯´æ˜ä¹¦ã€å•†ä¸šå¹¿å‘Šå’Œå®£ä¼ ã€å¯„é€çš„ä»·ç›®è¡¨ç­‰</p><h5 id="ä¾‹å¤–ï¼š"><a href="#ä¾‹å¤–ï¼š" class="headerlink" title="ä¾‹å¤–ï¼š"></a>ä¾‹å¤–ï¼š</h5><p>å•†ä¸šå¹¿å‘Šå’Œå®£ä¼ å†…å®¹ç¬¦åˆè¦çº¦æ¡ä»¶ï¼Œå³è§†ä¸ºè¦çº¦</p><h4 id="3ï¼‰æ‰¿è¯º"><a href="#3ï¼‰æ‰¿è¯º" class="headerlink" title="3ï¼‰æ‰¿è¯º"></a>3ï¼‰æ‰¿è¯º</h4><h5 id="æ¦‚å¿µï¼š-5"><a href="#æ¦‚å¿µï¼š-5" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h5><p>å—è¦çº¦äººåŒæ„è¦çº¦</p><h5 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h5><p><strong>æ‰¿è¯ºå½“ä»¥é€šçŸ¥çš„æ–¹å¼ä½œå‡º</strong>ï¼Œä½†æ˜¯æ ¹æ®äº¤æ˜“ä¹ æƒ¯æˆ–è¦çº¦è¡¨æ˜å¯ä»¥é€šè¿‡è¡Œä¸ºä½œå‡ºæ‰¿è¯ºçš„æƒ…å†µé™¤å¤–</p><h4 id="4ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Šï¼š"><a href="#4ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Šï¼š" class="headerlink" title="4ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Šï¼š"></a>4ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Šï¼š</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831130036062.png" alt="image-20210831130036062"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831130217704.png" alt="image-20210831130217704"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831130241412.png" alt="image-20210831130241412"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831130419210.png" alt="image-20210831130419210"></p><h3 id="3ã€å…³äºåˆåŒå†…å®¹çº¦å®šä¸æ˜ç¡®çš„è§„å®š"><a href="#3ã€å…³äºåˆåŒå†…å®¹çº¦å®šä¸æ˜ç¡®çš„è§„å®š" class="headerlink" title="3ã€å…³äºåˆåŒå†…å®¹çº¦å®šä¸æ˜ç¡®çš„è§„å®š"></a>3ã€å…³äºåˆåŒå†…å®¹çº¦å®šä¸æ˜ç¡®çš„è§„å®š</h3><h4 id="1ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Š"><a href="#1ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Š" class="headerlink" title="1ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Š"></a>1ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Š</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831131953380.png" alt="image-20210831131953380"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831132031790.png" alt="image-20210831132031790"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831132139924.png" alt="image-20210831132139924"></p><h4 id="2ï¼‰æ€»ç»“"><a href="#2ï¼‰æ€»ç»“" class="headerlink" title="2ï¼‰æ€»ç»“"></a>2ï¼‰æ€»ç»“</h4><h5 id="1-è´¨é‡ä¸æ˜ç¡®"><a href="#1-è´¨é‡ä¸æ˜ç¡®" class="headerlink" title="1. è´¨é‡ä¸æ˜ç¡®"></a>1. è´¨é‡ä¸æ˜ç¡®</h5><ul><li>ä¾ç…§å›½å®¶æ ‡å‡†</li><li>ä¾ç…§è¡Œä¸šæ ‡å‡†ï¼ˆå¦‚æ²¡æœ‰å›½å®¶æ ‡å‡†ï¼‰</li><li>ä¾ç…§åˆåŒç›®çš„ï¼ˆå¦‚æ²¡æœ‰è¡Œä¸šæ ‡å‡†ï¼‰</li></ul><h5 id="2-ä»·æ¬¾ï¼ˆæŠ¥é…¬ï¼‰ä¸æ˜ç¡®"><a href="#2-ä»·æ¬¾ï¼ˆæŠ¥é…¬ï¼‰ä¸æ˜ç¡®" class="headerlink" title="2. ä»·æ¬¾ï¼ˆæŠ¥é…¬ï¼‰ä¸æ˜ç¡®"></a>2. ä»·æ¬¾ï¼ˆæŠ¥é…¬ï¼‰ä¸æ˜ç¡®</h5><ul><li>ä¾ç…§è®¢ç«‹åˆåŒæ—¶å±¥è¡Œåœ°çš„å¸‚åœºä»·</li></ul><h5 id="3-åœ°ç‚¹ä¸æ˜ç¡®"><a href="#3-åœ°ç‚¹ä¸æ˜ç¡®" class="headerlink" title="3. åœ°ç‚¹ä¸æ˜ç¡®"></a>3. åœ°ç‚¹ä¸æ˜ç¡®</h5><ul><li>é’±ï¼šåœ¨æ¥å—æ–¹æ‰€è½½åœ°å±¥è¡Œ</li><li>ä¸åŠ¨äº§ï¼šåœ¨ä¸åŠ¨äº§æ‰€åœ¨åœ°å±¥è¡Œ</li><li>å…¶ä»–ï¼šåœ¨å±¥è¡Œä¹‰åŠ¡æ–¹æ‰€åœ¨åœ°å±¥è¡Œ</li></ul><h5 id="4-æœŸé™ä¸æ˜ç¡®"><a href="#4-æœŸé™ä¸æ˜ç¡®" class="headerlink" title="4. æœŸé™ä¸æ˜ç¡®"></a>4. æœŸé™ä¸æ˜ç¡®</h5><ul><li>å€ºåŠ¡äººéšæ—¶å¯å±¥è¡Œï¼Œä½†éœ€ç»™å‡†å¤‡æ—¶é—´</li><li>å€ºæƒäººéšæ—¶å¯è¯·æ±‚å±¥è¡Œ</li></ul><h5 id="5-æ–¹å¼ä¸æ˜ç¡®"><a href="#5-æ–¹å¼ä¸æ˜ç¡®" class="headerlink" title="5. æ–¹å¼ä¸æ˜ç¡®"></a>5. æ–¹å¼ä¸æ˜ç¡®</h5><ul><li>æŒ‰æœ‰åˆ©äºåˆåŒç›®çš„çš„æ–¹å¼</li></ul><h5 id="6-è´¹ç”¨ä¸æ˜ç¡®"><a href="#6-è´¹ç”¨ä¸æ˜ç¡®" class="headerlink" title="6. è´¹ç”¨ä¸æ˜ç¡®"></a>6. è´¹ç”¨ä¸æ˜ç¡®</h5><ul><li>ç”±å±¥è¡Œä¹‰åŠ¡æ–¹æ‰¿æ‹…</li><li>å› å€ºæƒäººåŸå› å¢åŠ çš„è´¹ç”¨ç”±å€ºæƒäººæ‰¿æ‹…</li></ul><h3 id="4ã€ä»€ä¹ˆæ˜¯æ”¿åºœæŒ‡å¯¼ä»·ï¼Ÿ"><a href="#4ã€ä»€ä¹ˆæ˜¯æ”¿åºœæŒ‡å¯¼ä»·ï¼Ÿ" class="headerlink" title="4ã€ä»€ä¹ˆæ˜¯æ”¿åºœæŒ‡å¯¼ä»·ï¼Ÿ"></a>4ã€ä»€ä¹ˆæ˜¯æ”¿åºœæŒ‡å¯¼ä»·ï¼Ÿ</h3><h4 id="1ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Š-1"><a href="#1ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Š-1" class="headerlink" title="1ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Š"></a>1ï¼‰ã€Šæ°‘æ³•å…¸ã€‹è§£é‡Š</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831133930987.png" alt="image-20210831133930987"></p><p>2ï¼‰</p><h3 id="5ã€å®šé‡‘ã€è®¢é‡‘"><a href="#5ã€å®šé‡‘ã€è®¢é‡‘" class="headerlink" title="5ã€å®šé‡‘ã€è®¢é‡‘"></a>5ã€å®šé‡‘ã€è®¢é‡‘</h3><h3 id="6ã€å»ºè®¾å·¥ç¨‹åˆåŒã€å§”æ‰˜åˆåŒ"><a href="#6ã€å»ºè®¾å·¥ç¨‹åˆåŒã€å§”æ‰˜åˆåŒ" class="headerlink" title="6ã€å»ºè®¾å·¥ç¨‹åˆåŒã€å§”æ‰˜åˆåŒ"></a>6ã€å»ºè®¾å·¥ç¨‹åˆåŒã€å§”æ‰˜åˆåŒ</h3><h3 id="7ã€æ— å› ç®¡ç†ã€ä¸å½“å¾—åˆ©"><a href="#7ã€æ— å› ç®¡ç†ã€ä¸å½“å¾—åˆ©" class="headerlink" title="7ã€æ— å› ç®¡ç†ã€ä¸å½“å¾—åˆ©"></a>7ã€æ— å› ç®¡ç†ã€ä¸å½“å¾—åˆ©</h3><h2 id="äºŒã€ä¿¡æ¯ç³»ç»Ÿæ–‡æ¡£ä¸é…ç½®ç®¡ç†"><a href="#äºŒã€ä¿¡æ¯ç³»ç»Ÿæ–‡æ¡£ä¸é…ç½®ç®¡ç†" class="headerlink" title="äºŒã€ä¿¡æ¯ç³»ç»Ÿæ–‡æ¡£ä¸é…ç½®ç®¡ç†"></a>äºŒã€ä¿¡æ¯ç³»ç»Ÿæ–‡æ¡£ä¸é…ç½®ç®¡ç†</h2><h3 id="1ã€æ–‡æ¡£ç®¡ç†"><a href="#1ã€æ–‡æ¡£ç®¡ç†" class="headerlink" title="1ã€æ–‡æ¡£ç®¡ç†"></a>1ã€æ–‡æ¡£ç®¡ç†</h3><h3 id="2ã€é…ç½®ç®¡ç†"><a href="#2ã€é…ç½®ç®¡ç†" class="headerlink" title="2ã€é…ç½®ç®¡ç†"></a>2ã€é…ç½®ç®¡ç†</h3><h3 id="3ã€å¼€å‘æ–‡æ¡£ã€äº§å“æ–‡æ¡£ã€ç®¡ç†æ–‡æ¡£"><a href="#3ã€å¼€å‘æ–‡æ¡£ã€äº§å“æ–‡æ¡£ã€ç®¡ç†æ–‡æ¡£" class="headerlink" title="3ã€å¼€å‘æ–‡æ¡£ã€äº§å“æ–‡æ¡£ã€ç®¡ç†æ–‡æ¡£"></a>3ã€å¼€å‘æ–‡æ¡£ã€äº§å“æ–‡æ¡£ã€ç®¡ç†æ–‡æ¡£</h3><h4 id="4ã€å¦‚ä½•è¿›è¡Œæ–‡æ¡£è§„èŒƒåŒ–ç®¡ç†"><a href="#4ã€å¦‚ä½•è¿›è¡Œæ–‡æ¡£è§„èŒƒåŒ–ç®¡ç†" class="headerlink" title="4ã€å¦‚ä½•è¿›è¡Œæ–‡æ¡£è§„èŒƒåŒ–ç®¡ç†"></a>4ã€å¦‚ä½•è¿›è¡Œæ–‡æ¡£è§„èŒƒåŒ–ç®¡ç†</h4><h4 id="5ã€é…ç½®ç®¡ç†ç›¸å…³æ¦‚å¿µ"><a href="#5ã€é…ç½®ç®¡ç†ç›¸å…³æ¦‚å¿µ" class="headerlink" title="5ã€é…ç½®ç®¡ç†ç›¸å…³æ¦‚å¿µ"></a>5ã€é…ç½®ç®¡ç†ç›¸å…³æ¦‚å¿µ</h4><p>6ã€è‰ç¨¿ã€æ­£å¼ã€æ­£åœ¨ä¿®æ”¹</p><p>7ã€å¼€å‘åº“ã€å—æ§åº“ã€äº§å“åº“</p><p>8ã€é…ç½®ç®¡ç†å‘˜æ´»åŠ¨</p>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬8ç« ã€é¡¹ç›®çš„ç«‹é¡¹å’Œæ”¶å°¾</title>
    <link href="/2021/08/31/%E7%AC%AC8%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%AB%8B%E9%A1%B9%E5%92%8C%E6%94%B6%E5%B0%BE/"/>
    <url>/2021/08/31/%E7%AC%AC8%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%AB%8B%E9%A1%B9%E5%92%8C%E6%94%B6%E5%B0%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬8ç« ã€é¡¹ç›®çš„ç«‹é¡¹å’Œæ”¶å°¾"><a href="#ç¬¬8ç« ã€é¡¹ç›®çš„ç«‹é¡¹å’Œæ”¶å°¾" class="headerlink" title="ç¬¬8ç« ã€é¡¹ç›®çš„ç«‹é¡¹å’Œæ”¶å°¾"></a>ç¬¬8ç« ã€é¡¹ç›®çš„ç«‹é¡¹å’Œæ”¶å°¾</h1><span id="more"></span><h2 id="ä¸€ã€é¡¹ç›®ç«‹é¡¹"><a href="#ä¸€ã€é¡¹ç›®ç«‹é¡¹" class="headerlink" title="ä¸€ã€é¡¹ç›®ç«‹é¡¹"></a>ä¸€ã€é¡¹ç›®ç«‹é¡¹</h2><h2 id="äºŒã€é¡¹ç›®æ”¶å°¾"><a href="#äºŒã€é¡¹ç›®æ”¶å°¾" class="headerlink" title="äºŒã€é¡¹ç›®æ”¶å°¾"></a>äºŒã€é¡¹ç›®æ”¶å°¾</h2>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬7ç« ã€é¡¹ç›®çš„æ²Ÿé€šç®¡ç†å’Œå¹²ç³»äººç®¡ç†</title>
    <link href="/2021/08/31/%E7%AC%AC7%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%B2%9F%E9%80%9A%E7%AE%A1%E7%90%86%E5%92%8C%E5%B9%B2%E7%B3%BB%E4%BA%BA%E7%AE%A1%E7%90%86/"/>
    <url>/2021/08/31/%E7%AC%AC7%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%B2%9F%E9%80%9A%E7%AE%A1%E7%90%86%E5%92%8C%E5%B9%B2%E7%B3%BB%E4%BA%BA%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬7ç« ã€é¡¹ç›®çš„æ²Ÿé€šç®¡ç†å’Œå¹²ç³»äººç®¡ç†"><a href="#ç¬¬7ç« ã€é¡¹ç›®çš„æ²Ÿé€šç®¡ç†å’Œå¹²ç³»äººç®¡ç†" class="headerlink" title="ç¬¬7ç« ã€é¡¹ç›®çš„æ²Ÿé€šç®¡ç†å’Œå¹²ç³»äººç®¡ç†"></a>ç¬¬7ç« ã€é¡¹ç›®çš„æ²Ÿé€šç®¡ç†å’Œå¹²ç³»äººç®¡ç†</h1><span id="more"></span><h2 id="ä¸€ã€æ²Ÿé€šç®¡ç†"><a href="#ä¸€ã€æ²Ÿé€šç®¡ç†" class="headerlink" title="ä¸€ã€æ²Ÿé€šç®¡ç†"></a>ä¸€ã€æ²Ÿé€šç®¡ç†</h2><h3 id="1ã€åŸºç¡€çŸ¥è¯†"><a href="#1ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="1ã€åŸºç¡€çŸ¥è¯†"></a>1ã€åŸºç¡€çŸ¥è¯†</h3><h4 id="1ï¼‰æ²Ÿé€šçš„æ¦‚å¿µ"><a href="#1ï¼‰æ²Ÿé€šçš„æ¦‚å¿µ" class="headerlink" title="1ï¼‰æ²Ÿé€šçš„æ¦‚å¿µ"></a>1ï¼‰æ²Ÿé€šçš„æ¦‚å¿µ</h4><ul><li><p>æ²Ÿé€šå°±æ˜¯ä¸ºç¡®ä¿é¡¹ç›®ä¿¡æ¯åŠæ—¶ä¸”æ°å½“åœ°è§„åˆ’ã€æ”¶é›†ã€ç”Ÿäº§ã€å‘å¸ƒã€å­˜å‚¨ã€æ£€ç´¢ã€ç®¡ç†ã€æ§åˆ¶ã€ç›‘ç£å’Œæœ€ç»ˆå¤„ç½®é¡¹ç›®æ‰€éœ€çš„å„ä¸ªè¿‡ç¨‹</p></li><li><p>ç®¡ç†å°±æ˜¯æ²Ÿé€šï¼Œæ²¡æœ‰æ²Ÿé€šå°±æ²¡æœ‰ç®¡ç†</p></li><li><p>è‰¯å¥½çš„æ²Ÿé€šä¿ƒè¿›é¡¹ç›®çš„æˆåŠŸ</p></li><li><p>æ²Ÿé€šä¸­æœ€é‡è¦çš„ä¸ä»…æ˜¯ä½ å‘å‡ºäº†ä»€ä¹ˆï¼Œä¸”è¦å…³æ³¨å¯¹æ–¹æ¥æ”¶å’Œç†è§£äº†ä»€ä¹ˆã€æœ‰ä»€ä¹ˆæ ·çš„åé¦ˆ</p></li></ul><h4 id="2ï¼‰æ²Ÿé€šçš„åˆ†ç±»"><a href="#2ï¼‰æ²Ÿé€šçš„åˆ†ç±»" class="headerlink" title="2ï¼‰æ²Ÿé€šçš„åˆ†ç±»"></a>2ï¼‰æ²Ÿé€šçš„åˆ†ç±»</h4><h5 id="1-æŒ‰ä¸¥è‚ƒç¨‹åº¦åˆ’åˆ†"><a href="#1-æŒ‰ä¸¥è‚ƒç¨‹åº¦åˆ’åˆ†" class="headerlink" title="1. æŒ‰ä¸¥è‚ƒç¨‹åº¦åˆ’åˆ†"></a>1. æŒ‰ä¸¥è‚ƒç¨‹åº¦åˆ’åˆ†</h5><ul><li>æ­£å¼æ²Ÿé€š</li><li>éæ­£å¼æ²Ÿé€š</li></ul><h5 id="2-æŒ‰æ²Ÿé€šæ–¹å‘åˆ’åˆ†"><a href="#2-æŒ‰æ²Ÿé€šæ–¹å‘åˆ’åˆ†" class="headerlink" title="2. æŒ‰æ²Ÿé€šæ–¹å‘åˆ’åˆ†"></a>2. æŒ‰æ²Ÿé€šæ–¹å‘åˆ’åˆ†</h5><ul><li>å•å‘æ²Ÿé€š</li><li>åŒå‘æ²Ÿé€š</li><li>æ¨ªå‘æ²Ÿé€š</li><li>çºµå‘æ²Ÿé€š</li></ul><h5 id="3-æŒ‰æ²Ÿé€šå·¥å…·åˆ’åˆ†"><a href="#3-æŒ‰æ²Ÿé€šå·¥å…·åˆ’åˆ†" class="headerlink" title="3. æŒ‰æ²Ÿé€šå·¥å…·åˆ’åˆ†"></a>3. æŒ‰æ²Ÿé€šå·¥å…·åˆ’åˆ†</h5><ul><li>ä¹¦é¢æ²Ÿé€š</li><li>å£å¤´æ²Ÿé€š</li></ul><h3 id="2ã€æ²Ÿé€šæ¨¡å‹å’ŒçŠ¶æ€"><a href="#2ã€æ²Ÿé€šæ¨¡å‹å’ŒçŠ¶æ€" class="headerlink" title="2ã€æ²Ÿé€šæ¨¡å‹å’ŒçŠ¶æ€"></a>2ã€æ²Ÿé€šæ¨¡å‹å’ŒçŠ¶æ€</h3><h4 id="1ï¼‰æ¦‚å¿µ"><a href="#1ï¼‰æ¦‚å¿µ" class="headerlink" title="1ï¼‰æ¦‚å¿µ"></a>1ï¼‰æ¦‚å¿µ</h4><h5 id="1-ç¼–ç "><a href="#1-ç¼–ç " class="headerlink" title="1. ç¼–ç "></a>1. ç¼–ç </h5><p>æŠŠæ€æƒ³æˆ–æƒ³æ³•è½¬åŒ–ä¸ºä»–äººç†è§£çš„è¯­è¨€</p><h5 id="2-ä¿¡æ¯å’Œåé¦ˆä¿¡æ¯"><a href="#2-ä¿¡æ¯å’Œåé¦ˆä¿¡æ¯" class="headerlink" title="2. ä¿¡æ¯å’Œåé¦ˆä¿¡æ¯"></a>2. ä¿¡æ¯å’Œåé¦ˆä¿¡æ¯</h5><p>ç¼–ç è¿‡ç¨‹æ‰€å¾—åˆ°çš„ç»“æœ</p><h5 id="3-åª’ä»‹"><a href="#3-åª’ä»‹" class="headerlink" title="3. åª’ä»‹"></a>3. åª’ä»‹</h5><p>ç”¨æ¥ä¼ é€’ä¿¡æ¯çš„æ–¹æ³•</p><h5 id="4-å™ªå£°"><a href="#4-å™ªå£°" class="headerlink" title="4. å™ªå£°"></a>4. å™ªå£°</h5><p>å¹²æ‰°ä¿¡æ¯ä¼ è¾“å’Œç†è§£çš„ä¸€åˆ‡å› ç´ ï¼Œå¦‚è·ç¦»ã€æ–°æŠ€æœ¯ã€ç¼ºä¹èƒŒæ™¯ä¿¡æ¯ç­‰</p><h5 id="5-è§£ç "><a href="#5-è§£ç " class="headerlink" title="5. è§£ç "></a>5. è§£ç </h5><p>æŠŠä¿¡æ¯è¿˜åŸæˆæœ‰æ„ä¹‰çš„æ€æƒ³æˆ–æƒ³æ³•</p><h4 id="2ï¼‰å››ä¸ªéƒ¨åˆ†"><a href="#2ï¼‰å››ä¸ªéƒ¨åˆ†" class="headerlink" title="2ï¼‰å››ä¸ªéƒ¨åˆ†"></a>2ï¼‰å››ä¸ªéƒ¨åˆ†</h4><h5 id="1-å‘é€æ–¹"><a href="#1-å‘é€æ–¹" class="headerlink" title="1. å‘é€æ–¹"></a>1. å‘é€æ–¹</h5><h5 id="2-æ¥æ”¶æ–¹"><a href="#2-æ¥æ”¶æ–¹" class="headerlink" title="2. æ¥æ”¶æ–¹"></a>2. æ¥æ”¶æ–¹</h5><h5 id="3-åª’ä»‹-1"><a href="#3-åª’ä»‹-1" class="headerlink" title="3. åª’ä»‹"></a>3. åª’ä»‹</h5><h5 id="4-æ¶ˆæ¯"><a href="#4-æ¶ˆæ¯" class="headerlink" title="4. æ¶ˆæ¯"></a>4. æ¶ˆæ¯</h5><h4 id="3ï¼‰äº”ä¸ªåŸºæœ¬çŠ¶æ€ï¼ˆå‘æ”¶ç†è®¤è½¬ï¼‰"><a href="#3ï¼‰äº”ä¸ªåŸºæœ¬çŠ¶æ€ï¼ˆå‘æ”¶ç†è®¤è½¬ï¼‰" class="headerlink" title="3ï¼‰äº”ä¸ªåŸºæœ¬çŠ¶æ€ï¼ˆå‘æ”¶ç†è®¤è½¬ï¼‰"></a>3ï¼‰äº”ä¸ªåŸºæœ¬çŠ¶æ€ï¼ˆå‘æ”¶ç†è®¤è½¬ï¼‰</h4><ul><li>å·²å‘é€</li><li>å·²æ”¶åˆ°</li><li>å·²ç†è§£</li><li>å·²è®¤å¯</li><li>å·²è½¬åŒ–</li></ul><h4 id="4ï¼‰æ¨¡å‹å›¾"><a href="#4ï¼‰æ¨¡å‹å›¾" class="headerlink" title="4ï¼‰æ¨¡å‹å›¾"></a>4ï¼‰æ¨¡å‹å›¾</h4><h5 id="1-æ²Ÿé€šæ¨¡å‹"><a href="#1-æ²Ÿé€šæ¨¡å‹" class="headerlink" title="1. æ²Ÿé€šæ¨¡å‹"></a>1. æ²Ÿé€šæ¨¡å‹</h5><p>![image-20210904175737131](/Users/shenlei/Library/Application Support/typora-user-images/image-20210904175737131.png)</p><h5 id="2-æ²Ÿé€šä¿¡æ¯å‡†ç¡®åº¦é€çº§é€’å‡æ¼æ–—æ¨¡å‹"><a href="#2-æ²Ÿé€šä¿¡æ¯å‡†ç¡®åº¦é€çº§é€’å‡æ¼æ–—æ¨¡å‹" class="headerlink" title="2. æ²Ÿé€šä¿¡æ¯å‡†ç¡®åº¦é€çº§é€’å‡æ¼æ–—æ¨¡å‹"></a>2. æ²Ÿé€šä¿¡æ¯å‡†ç¡®åº¦é€çº§é€’å‡æ¼æ–—æ¨¡å‹</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210905114830233.png" alt="image-20210905114830233"></p><h3 id="3ã€æ²Ÿé€šæ¸ é“å’ŒæŠ€å·§"><a href="#3ã€æ²Ÿé€šæ¸ é“å’ŒæŠ€å·§" class="headerlink" title="3ã€æ²Ÿé€šæ¸ é“å’ŒæŠ€å·§"></a>3ã€æ²Ÿé€šæ¸ é“å’ŒæŠ€å·§</h3><h4 id="1ï¼‰æ²Ÿé€šæ¸ é“ç±»å‹"><a href="#1ï¼‰æ²Ÿé€šæ¸ é“ç±»å‹" class="headerlink" title="1ï¼‰æ²Ÿé€šæ¸ é“ç±»å‹"></a>1ï¼‰æ²Ÿé€šæ¸ é“ç±»å‹</h4><h5 id="1-æ–‡å­—"><a href="#1-æ–‡å­—" class="headerlink" title="1. æ–‡å­—"></a>1. æ–‡å­—</h5><h6 id="ä¼˜ç‚¹ï¼š"><a href="#ä¼˜ç‚¹ï¼š" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><ul><li><strong>å¯æ°¸ä¹…ä¿å­˜</strong>ï¼Œå®¹æ˜“æŸ¥è¯¢</li><li>èŠ‚çº¦æ—¶é—´ï¼Œé˜…è¯»é€Ÿåº¦é«˜äºè¯­è¨€é€Ÿåº¦</li><li>è¯»è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„é€Ÿåº¦è¿›è¡Œè°ƒæ•´</li><li>æ— åœ°ç†ä½ç½®éœ€æ±‚</li><li>æ›´ä¸ºç²¾å‡†</li><li>ç†è®ºä¸Šå¯å¤šæ¬¡æ— æŸå¤åˆ¶ä¼ æ’­</li></ul><h6 id="ç¼ºç‚¹ï¼š"><a href="#ç¼ºç‚¹ï¼š" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><ul><li>çº¯æ–‡å­—èµ„æ–™æŸå¤±äº†å¤§é‡éè¯­è¨€ç¬¦å·ï¼Œ<strong>ä¸åˆ©äºæƒ…æ„Ÿçš„ä¼ é€’</strong></li><li>å¯¹äºé˜…è¯»è€…çš„é€‰æ‹©æ— æ§åˆ¶åŠ›</li><li>æ— æ³•æ§åˆ¶ä½•æ—¶ï¼Œä»¥åŠæ˜¯å¦è¢«é˜…è¯»</li></ul><h5 id="2-è¯­è¨€"><a href="#2-è¯­è¨€" class="headerlink" title="2. è¯­è¨€"></a>2. è¯­è¨€</h5><h6 id="ä¼˜ç‚¹ï¼š-1"><a href="#ä¼˜ç‚¹ï¼š-1" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><ul><li><strong>å¯ä¼ é€’æƒ…æ„Ÿ</strong></li><li>å¯åŒæ—¶è·¨åœ°åŸŸæ²Ÿé€š</li><li>æ¯”é‚®ä»¶æ›´å¿«</li><li>ä¸éœ€è¦ä¿å­˜ä¼ é€’ä¿¡æ¯çš„ä¼˜å…ˆé€‰æ‹©æ¸ é“</li></ul><h6 id="ç¼ºç‚¹ï¼š-1"><a href="#ç¼ºç‚¹ï¼š-1" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><ul><li>ä¸åˆ©äºå»ºç«‹ä¿ƒè¿›ä¸ªäººå…³ç³»</li><li>æ— æ³•è¡¨ç°è‚¢ä½“è¯­è¨€</li><li>åšä¸åˆ°æ–‡å­—èµ„æ–™çš„ç²¾å‡†æ€§ï¼ŒæŠŠ<strong>æ¡ç»†èŠ‚èƒ½åŠ›ä¸è¶³</strong></li><li>è¯´ çš„é€Ÿåº¦æ¯”é˜…è¯»é€Ÿåº¦ç›¸å¯¹æ…¢</li></ul><h5 id="3-æ··åˆ"><a href="#3-æ··åˆ" class="headerlink" title="3. æ··åˆ"></a>3. æ··åˆ</h5><h6 id="ä¼˜ç‚¹ï¼š-2"><a href="#ä¼˜ç‚¹ï¼š-2" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><ul><li>åŒ…æ‹¬è¯­è¨€ä¿¡æ¯å’Œéè¯­è¨€ä¿¡æ¯ï¼Œ<strong>æ²Ÿé€šä¿¡æ¯å«é‡æœ€ä¸°å¯Œ</strong></li><li>æ˜¯å»ºç«‹é›†ä½“å…³ç³»å’Œåœ°ä½æœ€å¥½çš„æ¸ é“</li><li><strong>å®æ—¶æ€§æœ€å¥½</strong>ï¼Œå¯ä»¥å®æ—¶çš„åšå‡ºååº”å’Œå›å¤</li><li>å¯¹æ¥æ”¶å¯¹è±¡çš„é€‰æ‹©æœ‰ä¸€å®šæ§åˆ¶åŠ›</li></ul><h6 id="ç¼ºç‚¹ï¼š-2"><a href="#ç¼ºç‚¹ï¼š-2" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><ul><li>ä¸è¯­è¨€æ–¹å¼ç›¸åŒï¼Œ<strong>éæ–‡å­—ä¿¡æ¯é€Ÿåº¦æ…¢</strong></li><li>åˆ©ç”¨è¯­è¨€æ²Ÿé€šçš„æ—¶å€™ï¼Œ<strong>ç»†èŠ‚æŠŠæ¡æ€§ä¸å¼º</strong></li></ul><h4 id="2ï¼‰é€‰æ‹©çš„ç»´åº¦"><a href="#2ï¼‰é€‰æ‹©çš„ç»´åº¦" class="headerlink" title="2ï¼‰é€‰æ‹©çš„ç»´åº¦"></a>2ï¼‰é€‰æ‹©çš„ç»´åº¦</h4><h5 id="1-å³æ—¶æ€§ç»´åº¦"><a href="#1-å³æ—¶æ€§ç»´åº¦" class="headerlink" title="1. å³æ—¶æ€§ç»´åº¦"></a>1. å³æ—¶æ€§ç»´åº¦</h5><h5 id="2-è¡¨è¾¾æ–¹å¼ç»´åº¦"><a href="#2-è¡¨è¾¾æ–¹å¼ç»´åº¦" class="headerlink" title="2. è¡¨è¾¾æ–¹å¼ç»´åº¦"></a>2. è¡¨è¾¾æ–¹å¼ç»´åº¦</h5><h4 id="3ï¼‰æ²Ÿé€šå­˜åœ¨çš„é—®é¢˜"><a href="#3ï¼‰æ²Ÿé€šå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="3ï¼‰æ²Ÿé€šå­˜åœ¨çš„é—®é¢˜"></a>3ï¼‰æ²Ÿé€šå­˜åœ¨çš„é—®é¢˜</h4><h5 id="1-è¯­è¨€è¡¨è¾¾èƒ½åŠ›ä¸ä½³æˆ–æ¬ ç¼º"><a href="#1-è¯­è¨€è¡¨è¾¾èƒ½åŠ›ä¸ä½³æˆ–æ¬ ç¼º" class="headerlink" title="1. è¯­è¨€è¡¨è¾¾èƒ½åŠ›ä¸ä½³æˆ–æ¬ ç¼º"></a>1. è¯­è¨€è¡¨è¾¾èƒ½åŠ›ä¸ä½³æˆ–æ¬ ç¼º</h5><h5 id="2-ä¸æ‡‚å¾—è¯´è¯çš„æŠ€å·§æˆ–è‰ºæœ¯"><a href="#2-ä¸æ‡‚å¾—è¯´è¯çš„æŠ€å·§æˆ–è‰ºæœ¯" class="headerlink" title="2. ä¸æ‡‚å¾—è¯´è¯çš„æŠ€å·§æˆ–è‰ºæœ¯"></a>2. ä¸æ‡‚å¾—è¯´è¯çš„æŠ€å·§æˆ–è‰ºæœ¯</h5><h5 id="3-æœªèƒ½å……åˆ†ä¼ è¾¾è‡ªå·±çš„ä¿¡æ¯"><a href="#3-æœªèƒ½å……åˆ†ä¼ è¾¾è‡ªå·±çš„ä¿¡æ¯" class="headerlink" title="3. æœªèƒ½å……åˆ†ä¼ è¾¾è‡ªå·±çš„ä¿¡æ¯"></a>3. æœªèƒ½å……åˆ†ä¼ è¾¾è‡ªå·±çš„ä¿¡æ¯</h5><h5 id="4-æœªèƒ½æœ‰æ•ˆæ§åˆ¶è‡ªå·±çš„æƒ…ç»ª"><a href="#4-æœªèƒ½æœ‰æ•ˆæ§åˆ¶è‡ªå·±çš„æƒ…ç»ª" class="headerlink" title="4. æœªèƒ½æœ‰æ•ˆæ§åˆ¶è‡ªå·±çš„æƒ…ç»ª"></a>4. æœªèƒ½æœ‰æ•ˆæ§åˆ¶è‡ªå·±çš„æƒ…ç»ª</h5><h4 id="4ï¼‰æ²Ÿé€šçš„æœ‰æ•ˆæ€§"><a href="#4ï¼‰æ²Ÿé€šçš„æœ‰æ•ˆæ€§" class="headerlink" title="4ï¼‰æ²Ÿé€šçš„æœ‰æ•ˆæ€§"></a>4ï¼‰æ²Ÿé€šçš„æœ‰æ•ˆæ€§</h4><h5 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h5><p>æ‰€æœ‰çš„æ²Ÿé€šæ´»åŠ¨æœ€ç»ˆè¦å…³æ³¨çš„å°±æ˜¯æœ‰æ•ˆçš„æ²Ÿé€šç»“æœ</p><h5 id="2-è¦ç´ "><a href="#2-è¦ç´ " class="headerlink" title="2. è¦ç´ "></a>2. è¦ç´ </h5><h6 id="æ•ˆæœï¼ˆå‡†ç¡®æ€§ï¼‰"><a href="#æ•ˆæœï¼ˆå‡†ç¡®æ€§ï¼‰" class="headerlink" title="æ•ˆæœï¼ˆå‡†ç¡®æ€§ï¼‰"></a>æ•ˆæœï¼ˆå‡†ç¡®æ€§ï¼‰</h6><p>å¼ºè°ƒåœ¨é€‚å½“çš„æ—¶é—´ã€é€‚å½“çš„æ–¹å¼ã€ä¿¡æ¯è¢«å‡†ç¡®çš„å‘é€ç»™é€‚å½“çš„æ²Ÿé€šå‚ä¸æ–¹ï¼ˆä¿¡æ¯çš„æ¥æ”¶æ–¹ï¼‰ï¼Œå¹¶ä¸”èƒ½è¢«æ­£ç¡®ç†è§£</p><h6 id="æ•ˆç‡ï¼ˆåŠæ—¶æ€§ï¼‰"><a href="#æ•ˆç‡ï¼ˆåŠæ—¶æ€§ï¼‰" class="headerlink" title="æ•ˆç‡ï¼ˆåŠæ—¶æ€§ï¼‰"></a>æ•ˆç‡ï¼ˆåŠæ—¶æ€§ï¼‰</h6><p>å¼ºè°ƒåŠæ—¶æä¾›æ‰€éœ€çš„ä¿¡æ¯</p><h5 id="3-æé«˜æ²Ÿé€šæ•ˆç‡çš„åŸåˆ™"><a href="#3-æé«˜æ²Ÿé€šæ•ˆç‡çš„åŸåˆ™" class="headerlink" title="3. æé«˜æ²Ÿé€šæ•ˆç‡çš„åŸåˆ™"></a>3. æé«˜æ²Ÿé€šæ•ˆç‡çš„åŸåˆ™</h5><ul><li>æ²Ÿé€šå†…å¤–æœ‰åˆ«</li><li>é‡‡ç”¨å¯¹æ–¹èƒ½å¤Ÿæ¥å—çš„é£æ ¼</li><li>éæ­£å¼çš„æ²Ÿé€šæœ‰åŠ©äºå…³ç³»çš„èæ´½</li><li>æ‰«é™¤æ²Ÿé€šçš„éšœç¢</li><li>æ²Ÿé€šçš„å‡çº§åŸåˆ™</li></ul><h5 id="4-é˜»ç¢å› ç´ "><a href="#4-é˜»ç¢å› ç´ " class="headerlink" title="4. é˜»ç¢å› ç´ "></a>4. é˜»ç¢å› ç´ </h5><ul><li>æ²Ÿé€šåŒæ–¹çš„ç‰©ç†è·ç¦»</li><li>æ²Ÿé€šçš„ç¯å¢ƒå› ç´ </li><li>ç¼ºä¹æ¸…æ™°çš„æ²Ÿé€šæ¸ é“</li><li>å¤æ‚çš„ç»„ç»‡ç»“æ„</li><li>å¤æ‚çš„æŠ€æœ¯æœ¯è¯­</li><li>æœ‰å®³çš„æ€åº¦</li></ul><h5 id="5-å¦‚ä½•æœ‰æ•ˆçš„ç»„ç»‡é¡¹ç›®ä¼šè®®"><a href="#5-å¦‚ä½•æœ‰æ•ˆçš„ç»„ç»‡é¡¹ç›®ä¼šè®®" class="headerlink" title="5. å¦‚ä½•æœ‰æ•ˆçš„ç»„ç»‡é¡¹ç›®ä¼šè®®"></a>5. å¦‚ä½•æœ‰æ•ˆçš„ç»„ç»‡é¡¹ç›®ä¼šè®®</h5><ul><li>æ˜ç¡®ä¼šè®®çš„ç›®çš„å’ŒæœŸæœ›çš„ç»“æœï¼ˆåªåœ¨ç¡®å®šéœ€è¦æ—¶æ‰å¬å¼€ä¼šè®®ï¼‰</li><li>ç¡®å®šå‚åŠ ä¼šè®®çš„äººå‘˜</li><li>åœ¨ä¼šè®®å¬å¼€å‰å‘å‚åŠ è€…æä¾›ä¼šè®®è®®ç¨‹ï¼ˆæ˜ç¡®è®®é¢˜ï¼Œæå‰åˆ†å‘è¯„å®¡èµ„æ–™ã€ä¼šè®®é€šçŸ¥ï¼‰</li><li>ä½¿ä¼šè®®ä¸“ä¸šåŒ–ï¼ˆæŒ‡å®šä¸“é—¨çš„ä¸»æŒäºº â€”â€” æ§åˆ¶æ—¶é—´æ–¹å‘ï¼‰</li><li>ä»¥ç§¯æã€æ­£é¢çš„æ€åº¦è§£å†³é—®é¢˜</li><li>é‡è§†ä¼šè®®ä¹‹åçš„è®°å½•ï¼ˆä¼šè®®è¦å½¢æˆç»“è®ºã€å‘å¸ƒç»å®¡æ ¸çš„ä¼šè®®çºªè¦ï¼‰</li><li>é‡è§†ä¼šè®®ç»“æœçš„å‘ŠçŸ¥ï¼ˆä¼šè®®çºªè¦è¦è½å®åˆ°è´£ä»»äººã€æ—¶é—´ï¼‰</li></ul><h3 id="4ã€ç®¡ç†è¿‡ç¨‹"><a href="#4ã€ç®¡ç†è¿‡ç¨‹" class="headerlink" title="4ã€ç®¡ç†è¿‡ç¨‹"></a>4ã€ç®¡ç†è¿‡ç¨‹</h3><h4 id="1ï¼‰è§„åˆ’æ²Ÿé€šç®¡ç†"><a href="#1ï¼‰è§„åˆ’æ²Ÿé€šç®¡ç†" class="headerlink" title="1ï¼‰è§„åˆ’æ²Ÿé€šç®¡ç†"></a>1ï¼‰è§„åˆ’æ²Ÿé€šç®¡ç†</h4><h5 id="1-æ¦‚å¿µ-1"><a href="#1-æ¦‚å¿µ-1" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h5><ul><li><p><strong>è¯†åˆ«å’Œè®°å½•ä¸å¹²ç³»äººæœ€æœ‰æ•ˆç‡å’Œæ•ˆæœçš„æ²Ÿé€šæ–¹å¼</strong></p></li><li><p>åŸºäºå¹²ç³»äººç›¸å…³ä¿¡æ¯éœ€æ±‚ã€å¯ç”¨ç»„ç»‡èµ„äº§å’Œå…·ä½“é¡¹ç›®éœ€æ±‚ï¼Œä¸ºé¡¹ç›®æ²Ÿé€šæ´»åŠ¨åˆ¶å®šæ°å½“ã€æœ‰æ•ˆçš„æ–¹æ³•å’Œè®¡åˆ’</p></li></ul><h5 id="2-å…³æ³¨é‡ç‚¹"><a href="#2-å…³æ³¨é‡ç‚¹" class="headerlink" title="2. å…³æ³¨é‡ç‚¹"></a>2. å…³æ³¨é‡ç‚¹</h5><p>åˆ¶å®šæœ‰æ•ˆæ€§çš„æ²Ÿé€šç®¡ç†è®¡åˆ’</p><h5 id="3-æ²Ÿé€šç®¡ç†è®¡åˆ’çš„ä¸»è¦å†…å®¹"><a href="#3-æ²Ÿé€šç®¡ç†è®¡åˆ’çš„ä¸»è¦å†…å®¹" class="headerlink" title="3. æ²Ÿé€šç®¡ç†è®¡åˆ’çš„ä¸»è¦å†…å®¹"></a>3. æ²Ÿé€šç®¡ç†è®¡åˆ’çš„ä¸»è¦å†…å®¹</h5><ul><li>é¡¹ç›®å¹²ç³»äººçš„æ²Ÿé€šéœ€è¦ï¼ˆä¸åŒçš„å¹²ç³»äººçš„éœ€æ±‚ä¸åŒï¼‰</li><li>å¯¹è¦å‘å¸ƒçš„ä¿¡æ¯è¿›è¡Œæè¿°ï¼ˆå†…å®¹ã€æè¿°ã€è¯¦å°½ç¨‹åº¦ï¼‰</li><li>ä¿¡æ¯æ¥æ”¶çš„ä¸ªäººæˆ–ç»„ç»‡</li><li>ä¼ è¾¾ä¿¡æ¯æ‰€éœ€çš„æŠ€æœ¯æˆ–æ–¹æ³•ï¼ˆ</li><li>æ²Ÿé€šæ•ˆç‡</li><li>ä¸ŠæŠ¥è¿‡ç¨‹</li><li>éšé¡¹ç›®è¿›å±•å¯¹æ²Ÿé€šç®¡ç†è®¡åˆ’æ›´æ–°ä¸ç»†åŒ–çš„æ–¹æ³•</li><li>é€šç”¨è¯è¯­ç»„</li></ul><h5 id="4-è¾“å…¥"><a href="#4-è¾“å…¥" class="headerlink" title="4. è¾“å…¥"></a>4. è¾“å…¥</h5><ul><li><strong>é¡¹ç›®ç®¡ç†è®¡åˆ’</strong></li><li><h2 id="å¹²ç³»äººç™»è®°å†Œ"><a href="#å¹²ç³»äººç™»è®°å†Œ" class="headerlink" title="å¹²ç³»äººç™»è®°å†Œ"></a>å¹²ç³»äººç™»è®°å†Œ</h2></li><li>äº‹ä¸šç¯å¢ƒå› ç´ </li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§</li></ul><h5 id="5-å·¥å…·å’ŒæŠ€æœ¯"><a href="#5-å·¥å…·å’ŒæŠ€æœ¯" class="headerlink" title="5. å·¥å…·å’ŒæŠ€æœ¯"></a>5. å·¥å…·å’ŒæŠ€æœ¯</h5><ul><li>åˆ†ææ²Ÿé€šéœ€æ±‚</li><li>ä¿¡æ¯ä¼ é€’æ–¹æ³•çš„é€‰æ‹©</li></ul><h5 id="6-è¾“å‡º"><a href="#6-è¾“å‡º" class="headerlink" title="6. è¾“å‡º"></a>6. è¾“å‡º</h5><ul><li>é¡¹ç›®æ–‡ä»¶æ›´æ–°</li><li><strong>æ²Ÿé€šç®¡ç†è®¡åˆ’</strong></li></ul><h4 id="2ï¼‰ç®¡ç†æ²Ÿé€š"><a href="#2ï¼‰ç®¡ç†æ²Ÿé€š" class="headerlink" title="2ï¼‰ç®¡ç†æ²Ÿé€š"></a>2ï¼‰ç®¡ç†æ²Ÿé€š</h4><h5 id="1-æ¦‚å¿µ-2"><a href="#1-æ¦‚å¿µ-2" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h5><ul><li><p><strong>ä¿ƒè¿›å¹²ç³»äººä¹‹é—´å®ç°æœ‰æ•ˆç‡å’Œæ•ˆæœçš„æ²Ÿé€š</strong></p></li><li><p>ç¡®ä¿é¡¹ç›®ä¿¡æ¯åŠæ—¶æ°å½“åœ°æ”¶é›†ã€ç”Ÿæˆã€å‘å¸ƒã€å­˜å‚¨ã€æ£€ç´¢ã€ç®¡ç†ã€ç›‘ç£å’Œæœ€ç»ˆå¤„ç½®</p></li></ul><h5 id="2-å…³æ³¨é‡ç‚¹-1"><a href="#2-å…³æ³¨é‡ç‚¹-1" class="headerlink" title="2. å…³æ³¨é‡ç‚¹"></a>2. å…³æ³¨é‡ç‚¹</h5><p>ç¡®ä¿æ²Ÿé€šçš„æ•ˆæœ</p><h5 id="3-è¾“å…¥"><a href="#3-è¾“å…¥" class="headerlink" title="3. è¾“å…¥"></a>3. è¾“å…¥</h5><ul><li>æ²Ÿé€šç®¡ç†è®¡åˆ’</li><li>å·¥ä½œç»©æ•ˆæŠ¥å‘Š</li><li>äº‹ä¸šç¯å¢ƒå› ç´ </li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§</li></ul><h5 id="4-å·¥å…·å’ŒæŠ€æœ¯"><a href="#4-å·¥å…·å’ŒæŠ€æœ¯" class="headerlink" title="4. å·¥å…·å’ŒæŠ€æœ¯"></a>4. å·¥å…·å’ŒæŠ€æœ¯</h5><ul><li>æ²Ÿé€šæ¸ é“çš„é€‰æ‹©</li><li>ä¿¡æ¯ä¼ é€’æ–¹æ³•çš„é€‰æ‹©</li><li>ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</li><li>ç»©æ•ˆæŠ¥å‘Š</li></ul><h5 id="5-è¾“å‡º"><a href="#5-è¾“å‡º" class="headerlink" title="5. è¾“å‡º"></a>5. è¾“å‡º</h5><ul><li>é¡¹ç›®æ²Ÿé€š</li><li>é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</li><li>é¡¹ç›®æ–‡ä»¶æ›´æ–°</li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°</li></ul><h4 id="3ï¼‰æ§åˆ¶æ²Ÿé€š"><a href="#3ï¼‰æ§åˆ¶æ²Ÿé€š" class="headerlink" title="3ï¼‰æ§åˆ¶æ²Ÿé€š"></a>3ï¼‰æ§åˆ¶æ²Ÿé€š</h4><h5 id="1-æ¦‚å¿µ-3"><a href="#1-æ¦‚å¿µ-3" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h5><ul><li><p><strong>éšæ—¶ç¡®ä¿æ‰€æœ‰å‚ä¸è€…ä¹‹é—´ä¿¡æ¯æµåŠ¨æœ€ä¼˜åŒ–</strong></p></li><li><p>ç¡®ä¿æ»¡è¶³é¡¹ç›®åŠå…¶ç›¸å…³æ–¹çš„ä¿¡æ¯éœ€æ±‚</p></li></ul><h5 id="2-å…³æ³¨é‡ç‚¹-2"><a href="#2-å…³æ³¨é‡ç‚¹-2" class="headerlink" title="2.å…³æ³¨é‡ç‚¹"></a>2.å…³æ³¨é‡ç‚¹</h5><p>æŒç»­æ”¹è¿›</p><h5 id="3-è¾“å…¥-1"><a href="#3-è¾“å…¥-1" class="headerlink" title="3. è¾“å…¥"></a>3. è¾“å…¥</h5><ul><li>é¡¹ç›®ç®¡ç†è®¡åˆ’</li><li>é¡¹ç›®æ²Ÿé€š</li><li>é—®é¢˜æ—¥å¿—</li><li>å·¥ä½œç»©æ•ˆæ•°æ®</li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§</li></ul><h5 id="4-å·¥å…·å’ŒæŠ€æœ¯-1"><a href="#4-å·¥å…·å’ŒæŠ€æœ¯-1" class="headerlink" title="4. å·¥å…·å’ŒæŠ€æœ¯"></a>4. å·¥å…·å’ŒæŠ€æœ¯</h5><ul><li>ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</li><li>ä¸“å®¶åˆ¤æ–­</li><li>ä¼šè®®</li></ul><h5 id="5-è¾“å‡º-1"><a href="#5-è¾“å‡º-1" class="headerlink" title="5. è¾“å‡º"></a>5. è¾“å‡º</h5><ul><li>å·¥ä½œç»©æ•ˆä¿¡æ¯</li><li>å˜æ›´è¯·æ±‚</li><li>é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</li><li>é¡¹ç›®æ–‡ä»¶æ›´æ–°</li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°</li></ul><h3 id="5ã€æŠ€æœ¯ä¸å·¥å…·"><a href="#5ã€æŠ€æœ¯ä¸å·¥å…·" class="headerlink" title="5ã€æŠ€æœ¯ä¸å·¥å…·"></a>5ã€æŠ€æœ¯ä¸å·¥å…·</h3><h4 id="1ï¼‰å¹²ç³»äººç™»è®°å†Œ"><a href="#1ï¼‰å¹²ç³»äººç™»è®°å†Œ" class="headerlink" title="1ï¼‰å¹²ç³»äººç™»è®°å†Œ"></a>1ï¼‰å¹²ç³»äººç™»è®°å†Œ</h4><p>ä¸»è¦æ²Ÿé€šå¯¹è±¡ã€å…³é”®å½±å“äººã€æ¬¡è¦æ²Ÿé€šå¯¹è±¡</p><h4 id="2ï¼‰æ²Ÿé€šæ¸ é“è®¡ç®—"><a href="#2ï¼‰æ²Ÿé€šæ¸ é“è®¡ç®—" class="headerlink" title="2ï¼‰æ²Ÿé€šæ¸ é“è®¡ç®—"></a>2ï¼‰æ²Ÿé€šæ¸ é“è®¡ç®—</h4><h5 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210905094859736.png" alt="image-20210905094859736"></p><blockquote><p>ä¸¤è€…ä¹‹é—´æ²Ÿé€šè¦å»æ‰æ²Ÿé€šçš„å‡ºå‘ç‚¹ï¼ˆè‡ªå·±ä¸èƒ½å’Œè‡ªå·±æ²Ÿé€šï¼‰ï¼Œæ‰€ä»¥æ˜¯ n * (n-1)</p><p>ä¸¤è€…ä¹‹é—´æ²Ÿé€šæ˜¯ä¸€æ¡æ¸ é“ï¼Œæ‰€ä»¥ /2</p></blockquote><h4 id="3ï¼‰ä¿¡æ¯ä¼ é€’æ–¹å¼çš„é€‰æ‹©"><a href="#3ï¼‰ä¿¡æ¯ä¼ é€’æ–¹å¼çš„é€‰æ‹©" class="headerlink" title="3ï¼‰ä¿¡æ¯ä¼ é€’æ–¹å¼çš„é€‰æ‹©"></a>3ï¼‰ä¿¡æ¯ä¼ é€’æ–¹å¼çš„é€‰æ‹©</h4><h5 id="1-äº¤äº’å¼æ²Ÿé€š"><a href="#1-äº¤äº’å¼æ²Ÿé€š" class="headerlink" title="1. äº¤äº’å¼æ²Ÿé€š"></a>1. äº¤äº’å¼æ²Ÿé€š</h5><h6 id="ä¼˜ç‚¹ï¼š-3"><a href="#ä¼˜ç‚¹ï¼š-3" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><ul><li>æœ€æœ‰æ•ˆçš„æ–¹æ³•</li><li>å¿«é€Ÿä¼ é€’</li><li>å¿«é€Ÿåé¦ˆ</li><li>ä¿¡æ¯é‡å¤§</li></ul><h6 id="ç¼ºç‚¹ï¼š-3"><a href="#ç¼ºç‚¹ï¼š-3" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><ul><li>ä¼ é€’ä¸­ç»è¿‡å±‚æ¬¡è¶Šå¤šï¼Œä¿¡æ¯å¤±çœŸå¯èƒ½æ€§è¶Šå¤§ã€æ ¸å®çš„éš¾åº¦è¶Šå¤§</li></ul><h6 id="ä¸¾ä¾‹ï¼š"><a href="#ä¸¾ä¾‹ï¼š" class="headerlink" title="ä¸¾ä¾‹ï¼š"></a>ä¸¾ä¾‹ï¼š</h6><ul><li>å³æ—¶é€šä¿¡</li><li>ç”µè¯</li><li>è§†é¢‘ä¼š</li></ul><h5 id="2-æ¨å¼æ²Ÿé€š"><a href="#2-æ¨å¼æ²Ÿé€š" class="headerlink" title="2. æ¨å¼æ²Ÿé€š"></a>2. æ¨å¼æ²Ÿé€š</h5><h6 id="ä¼˜ç‚¹ï¼š-4"><a href="#ä¼˜ç‚¹ï¼š-4" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><ul><li>æŒä¹…</li><li>æœ‰å½¢</li><li>å¯æ ¸å®</li></ul><h6 id="ç¼ºç‚¹ï¼š-4"><a href="#ç¼ºç‚¹ï¼š-4" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><ul><li>æ•ˆç‡ä½</li><li>ç¼ºä¹åé¦ˆ</li></ul><h6 id="ä¸¾ä¾‹ï¼š-1"><a href="#ä¸¾ä¾‹ï¼š-1" class="headerlink" title="ä¸¾ä¾‹ï¼š"></a>ä¸¾ä¾‹ï¼š</h6><ul><li>ä¿¡ä»¶</li><li>æŠ¥å‘Š</li><li>ç”µå­é‚®ä»¶</li><li>ä¼ çœŸ</li><li>æ—¥å¿—</li><li>æ–°é—»ç¨¿</li></ul><h5 id="3-æ‹‰å¼æ²Ÿé€š"><a href="#3-æ‹‰å¼æ²Ÿé€š" class="headerlink" title="3. æ‹‰å¼æ²Ÿé€š"></a>3. æ‹‰å¼æ²Ÿé€š</h5><h6 id="ä¼˜ç‚¹ï¼š-5"><a href="#ä¼˜ç‚¹ï¼š-5" class="headerlink" title="ä¼˜ç‚¹ï¼š"></a>ä¼˜ç‚¹ï¼š</h6><ul><li>ä¿¡æ¯æ„ä¹‰ååˆ†æ˜ç¡®ï¼Œå†…æ¶µä¸°å¯Œ</li></ul><h6 id="ç¼ºç‚¹ï¼š-5"><a href="#ç¼ºç‚¹ï¼š-5" class="headerlink" title="ç¼ºç‚¹ï¼š"></a>ç¼ºç‚¹ï¼š</h6><ul><li>ä¼ é€’è·ç¦»æœ‰é™ï¼Œç•Œé™æ¨¡ç³Š</li></ul><h6 id="ä¸¾ä¾‹ï¼š-2"><a href="#ä¸¾ä¾‹ï¼š-2" class="headerlink" title="ä¸¾ä¾‹ï¼š"></a>ä¸¾ä¾‹ï¼š</h6><ul><li>ä¼ä¸šå†…ç½‘</li><li>ç”µå­åœ¨çº¿é€‰è¯¾</li><li>ç»éªŒæ•™è®­æ•°æ®åº“</li><li>çŸ¥è¯†åº“</li></ul><h4 id="3ï¼‰æ²Ÿé€šçš„æ–¹å¼"><a href="#3ï¼‰æ²Ÿé€šçš„æ–¹å¼" class="headerlink" title="3ï¼‰æ²Ÿé€šçš„æ–¹å¼"></a>3ï¼‰æ²Ÿé€šçš„æ–¹å¼</h4><h5 id="1-æ–¹å¼"><a href="#1-æ–¹å¼" class="headerlink" title="1. æ–¹å¼"></a>1. æ–¹å¼</h5><ul><li>å‚ä¸è®¨è®º<ul><li>å¦‚ï¼šå¤´è„‘é£æš´</li></ul></li><li>å¾è¯¢æ–¹å¼<ul><li>å¦‚ï¼šé—®å·è°ƒæŸ¥</li></ul></li><li>æ¨é”€æ–¹å¼ï¼ˆè¯´æ˜ï¼‰<ul><li>å¦‚ï¼šå™è¿°è§£é‡Š</li></ul></li><li>å™è¿°æ–¹å¼<ul><li>å¦‚ï¼šåŠè¯´é¼“åŠ¨</li></ul></li></ul><h5 id="2-å‚ä¸å’Œæ§åˆ¶çš„å…³ç³»"><a href="#2-å‚ä¸å’Œæ§åˆ¶çš„å…³ç³»" class="headerlink" title="2. å‚ä¸å’Œæ§åˆ¶çš„å…³ç³»"></a>2. å‚ä¸å’Œæ§åˆ¶çš„å…³ç³»</h5><blockquote><p>ğŸš© å‚ä¸ç¨‹åº¦å’Œæ§åˆ¶ç¨‹åº¦æˆåæ¯”ã€‚</p></blockquote><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210905100339854.png" alt="image-20210905100339854"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210905100506504.png" alt="image-20210905100506504"></p><h5 id="3-å¦‚ä½•é€‰æ‹©"><a href="#3-å¦‚ä½•é€‰æ‹©" class="headerlink" title="3. å¦‚ä½•é€‰æ‹©"></a>3. å¦‚ä½•é€‰æ‹©</h5><ul><li>å·²æŒæ¡è¶³å¤Ÿä¿¡æ¯ï¼Œä¸éœ€è¦è¿›ä¸€æ­¥å¬å–æ„è§ï¼Œé€‰æ‹©å™è¿°æ–¹å¼ï¼Œå…¶æ¬¡é€‰æ‹©æ¨é”€æ–¹å¼</li><li>æŒæ¡ä¿¡æ¯ä¸è¶³ï¼Œæ²¡æœ‰å®Œæ•´æˆå‹æ„è§ï¼Œé€‰æ‹©è®¨è®ºæˆ–å¾è¯¢æ–¹å¼</li></ul><h4 id="4ï¼‰æ²Ÿé€šå¸¸ç”¨æŠ€å·§"><a href="#4ï¼‰æ²Ÿé€šå¸¸ç”¨æŠ€å·§" class="headerlink" title="4ï¼‰æ²Ÿé€šå¸¸ç”¨æŠ€å·§"></a>4ï¼‰æ²Ÿé€šå¸¸ç”¨æŠ€å·§</h4><ul><li><p>ä¸»åŠ¨å€¾å¬</p></li><li><p>æœ‰æ•ˆåˆ©ç”¨å¤šç§æ‰‹æ®µï¼Œå°½æœ€å¤§å¯èƒ½å¸®åŠ©è‡ªå·±ç†è§£ä¿¡æ¯å†…å®¹</p></li><li><p>æœ‰æ•ˆåˆ©ç”¨å¤šç§æ‰‹æ®µï¼ŒåŠ å¼ºå›¢ä½“æ²Ÿé€šæŠ€èƒ½</p></li><li><p>ä¸å›é¿é—®é¢˜ï¼Œå°½é‡äº†è§£äº‹å®çœŸç›¸</p></li><li><p>è®¾å®šç›®æ ‡ï¼Œé‡‡å–å¿…è¦çš„è¿½è¸ªã€éªŒè¯æ‰‹æ®µç¡®å®šæ˜¯å¦è¾¾åˆ°æ²Ÿé€šç›®æ ‡</p></li><li><p>æœ‰å¤šå±‚æ¬¡æ²Ÿé€šåå•†èƒ½åŠ›ï¼Œä¿è¯æœ€å¤§ç¨‹åº¦æ»¡è¶³å¤šæ–¹åˆ©ç›Š</p></li><li><p>å¼ºå¤§çš„äººæ ¼é­…åŠ›å’Œä¿¡ç”¨ï¼Œå¸®åŠ©å…¶ä»–äººæ ‘ç«‹ä¿¡å¿ƒ</p></li><li><p>å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›ï¼Œå¸®åŠ©ä»–äººæå‡å£«æ°”ï¼Œå¢åŠ å›¢é˜Ÿæ‰§è¡ŒåŠ›</p></li></ul><h4 id="5ï¼‰æ²Ÿé€šç®¡ç†è®¡åˆ’"><a href="#5ï¼‰æ²Ÿé€šç®¡ç†è®¡åˆ’" class="headerlink" title="5ï¼‰æ²Ÿé€šç®¡ç†è®¡åˆ’"></a>5ï¼‰æ²Ÿé€šç®¡ç†è®¡åˆ’</h4><ul><li>é€šç”¨æœ¯è¯­è¡¨</li><li>å¹²ç³»äººçš„æ²Ÿé€šéœ€æ±‚</li><li>éœ€è¦æ²Ÿé€šçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯­è¨€ã€æ ¼å¼ã€å†…å®¹ã€è¯¦ç»†ç¨‹åº¦</li><li>å‘å¸ƒä¿¡æ¯çš„åŸå› </li><li>å‘å¸ƒä¿¡æ¯ä»¥åŠå‘ŠçŸ¥æ”¶æ‚‰æˆ–åšå‡ºå›åº”ï¼ˆå¦‚é€‚ç”¨ï¼‰çš„æ—¶é™å’Œé¢‘ç‡</li><li>è´Ÿè´£æ²Ÿé€šç›¸å…³ä¿¡æ¯çš„äººå‘˜</li><li>è´Ÿè´£æˆæƒä¿å¯†ä¿¡æ¯å‘å¸ƒçš„äººå‘˜</li><li>å°†è¦æ¥æ”¶ä¿¡æ¯ä¸ªäººæˆ–å°ç»„</li><li>ä¼ é€’ä¿¡æ¯çš„æŠ€æœ¯æˆ–æ–¹æ³•</li><li>ä¸ºæ²Ÿé€šæ´»åŠ¨åˆ†é…çš„èµ„æºï¼ŒåŒ…æ‹¬æ—¶é—´å’Œé¢„ç®—</li><li>é—®é¢˜å‡çº§ç¨‹åºï¼Œç”¨äºè§„å®šä¸‹å±‚å‘˜å·¥æ— æ³•è§£å†³é—®é¢˜çš„ä¸ŠæŠ¥æ—¶é™å’Œä¸ŠæŠ¥è·¯å¾„</li><li>éšé¡¹ç›®è¿›å±•ï¼Œå¯¹æ²Ÿé€šç®¡ç†è®¡åˆ’è¿›è¡Œæ›´æ–°ä¸ä¼˜åŒ–çš„æ–¹æ³•</li><li>é¡¹ç›®ä¿¡æ¯æµå‘å›¾ã€‘å·¥ä½œæµç¨‹ï¼ˆå…¼æœ‰æˆæƒé¡ºåºï¼‰ã€æŠ¥å‘Šæ¸…å•ã€ä¼šè®®è®¡åˆ’</li><li>æ²Ÿé€šåˆ¶çº¦å› ç´ ï¼Œé€šå¸¸æ¥è‡ªç‰¹å®šçš„æ³•å¾‹æ³•è§„ã€æŠ€æœ¯è¦æ±‚å’Œç»„ç»‡æ”¿ç­–</li><li>é¡¹ç›®çŠ¶æ€ä¼šè®®ã€é¡¹ç›®å›¢é˜Ÿä¼šè®®ã€ç½‘ç»œä¼šè®®å’Œç”µå­é‚®ä»¶ä¿¡æ¯ç­‰çš„æŒ‡å—å’Œæ¨¡ç‰ˆ</li><li>é¡¹ç›®æ‰€ç”¨ç½‘ç«™å’Œé¡¹ç›®ç®¡ç†è½¯ä»¶çš„ä½¿ç”¨è¯´æ˜</li></ul><h3 id="6ã€ç®¡ç†æ²Ÿé€š-VS-æ§åˆ¶æ²Ÿé€š"><a href="#6ã€ç®¡ç†æ²Ÿé€š-VS-æ§åˆ¶æ²Ÿé€š" class="headerlink" title="6ã€ç®¡ç†æ²Ÿé€š VS æ§åˆ¶æ²Ÿé€š"></a>6ã€ç®¡ç†æ²Ÿé€š VS æ§åˆ¶æ²Ÿé€š</h3><h4 id="1ï¼‰å…±æ€§"><a href="#1ï¼‰å…±æ€§" class="headerlink" title="1ï¼‰å…±æ€§"></a>1ï¼‰å…±æ€§</h4><ul><li>éƒ½éœ€è¦æ ¹æ®æ²Ÿé€šç®¡ç†è®¡åˆ’æ¥å±•å¼€</li><li>éƒ½æ˜¯é¡¹ç›®æ²Ÿé€šç®¡ç†çš„è¿‡ç¨‹</li></ul><h4 id="2ï¼‰è”ç³»"><a href="#2ï¼‰è”ç³»" class="headerlink" title="2ï¼‰è”ç³»"></a>2ï¼‰è”ç³»</h4><ul><li>ç®¡ç†æ²Ÿé€šçš„è¾“å‡ºæ˜¯ <strong>é¡¹ç›®æ²Ÿé€š</strong>ï¼Œæ˜¯æ§åˆ¶æ²Ÿé€šçš„è¾“å…¥ï¼ˆ<strong>é¡¹ç›®æ²Ÿé€šå³å·²å®é™…å±•å¼€çš„æ²Ÿé€šï¼Œå¦‚å·²å¬å¼€çš„é¡¹ç›®ä¼šè®®</strong>ï¼‰</li><li>æ§åˆ¶æ²Ÿé€šçš„è¾“å‡ºæ—¶ <strong>å˜æ›´ç”³è¯·</strong>ï¼Œä¼šå¼•å‘é‡æ–°å±•å¼€è§„æ²Ÿé€šç®¡ç†è¿‡ç¨‹æˆ–ç®¡ç†æ²Ÿé€šè¿‡ç¨‹</li></ul><h4 id="3ï¼‰åŒºåˆ«"><a href="#3ï¼‰åŒºåˆ«" class="headerlink" title="3ï¼‰åŒºåˆ«"></a>3ï¼‰åŒºåˆ«</h4><ul><li><strong>ä¸¤è€…ä½œç”¨å„ä¸ç›¸åŒ</strong>ã€‚ç®¡ç†æ²Ÿé€šåœ¨æ‰§è¡Œè¿‡ç¨‹ç»„ï¼Œæ˜¯è¦å±•å¼€æœ‰æ•ˆçš„æ²Ÿé€šï¼›æ§åˆ¶æ²Ÿé€šæ—¶åœ¨ç›‘æ§è¿‡ç¨‹ç»„ï¼Œæ˜¯è¦æ£€æŸ¥æ²Ÿé€šæƒ…å†µï¼ŒåŠæ—¶æå‡ºå˜æ›´ç”³è¯·</li></ul><h2 id="äºŒã€å¹²ç³»äººç®¡ç†"><a href="#äºŒã€å¹²ç³»äººç®¡ç†" class="headerlink" title="äºŒã€å¹²ç³»äººç®¡ç†"></a>äºŒã€å¹²ç³»äººç®¡ç†</h2><h3 id="1ã€åŸºç¡€çŸ¥è¯†-1"><a href="#1ã€åŸºç¡€çŸ¥è¯†-1" class="headerlink" title="1ã€åŸºç¡€çŸ¥è¯†"></a>1ã€åŸºç¡€çŸ¥è¯†</h3><h4 id="1ï¼‰æ¦‚å¿µ-1"><a href="#1ï¼‰æ¦‚å¿µ-1" class="headerlink" title="1ï¼‰æ¦‚å¿µ"></a>1ï¼‰æ¦‚å¿µ</h4><ul><li>è¯†åˆ«å¹²ç³»äººçš„éœ€æ±‚ï¼Œå¹¶é€šè¿‡æ²Ÿé€šç®¡ç†æ»¡è¶³å…¶éœ€æ±‚ã€è§£å†³å…¶é—®é¢˜çš„è¿‡ç¨‹</li><li>ç›®å‰æ˜¯è·å¾—æ›´å¤šäººçš„æ”¯æŒï¼Œç¡®ä¿é¡¹ç›®æˆåŠŸ</li></ul><h4 id="2ï¼‰é¡¹ç›®å¹²ç³»äºº"><a href="#2ï¼‰é¡¹ç›®å¹²ç³»äºº" class="headerlink" title="2ï¼‰é¡¹ç›®å¹²ç³»äºº"></a>2ï¼‰é¡¹ç›®å¹²ç³»äºº</h4><ul><li>èƒ½å½±å“é¡¹ç›®å†³ç­–ã€æ´»åŠ¨æˆ–ç»“æœçš„ä¸ªäººã€ç¾¤ä½“æˆ–ç»„ç»‡</li><li>ä¼šå—æˆ–è‡ªè®¤ä¸ºä¼šå—é¡¹ç›®å†³ç­–ã€æ´»åŠ¨æˆ–ç»“æœçš„ä¸ªäººã€ç¾¤ä½“æˆ–ç»„ç»‡</li><li>å®¢æˆ·ã€å‘èµ·äººã€æ‰§è¡Œç»„ç»‡å’Œæœ‰å…³å…¬ä¼—ç­‰</li></ul><h3 id="2ã€ç®¡ç†è¿‡ç¨‹"><a href="#2ã€ç®¡ç†è¿‡ç¨‹" class="headerlink" title="2ã€ç®¡ç†è¿‡ç¨‹"></a>2ã€ç®¡ç†è¿‡ç¨‹</h3><h4 id="1ï¼‰è¯†åˆ«å¹²ç³»äºº"><a href="#1ï¼‰è¯†åˆ«å¹²ç³»äºº" class="headerlink" title="1ï¼‰è¯†åˆ«å¹²ç³»äºº"></a>1ï¼‰è¯†åˆ«å¹²ç³»äºº</h4><h5 id="1-ç›®çš„"><a href="#1-ç›®çš„" class="headerlink" title="1. ç›®çš„"></a>1. ç›®çš„</h5><p>å¸®åŠ©é¡¹ç›®ç»ç†å»ºç«‹å¯¹æ›´å¹²ç³»äººæˆ–å¹²ç³»äººç¾¤ä½“çš„é€‚åº¦å…³æ³¨</p><h5 id="2-åŸåˆ™"><a href="#2-åŸåˆ™" class="headerlink" title="2. åŸåˆ™"></a>2. åŸåˆ™</h5><p>è¯†åˆ«å¹²ç³»äººè¦å…¨é¢ã€è¦å°½æ—©ã€è¦è¿­ä»£å¼€å±•ï¼Œå…³æ³¨å˜åŒ–ï¼Œå¼•å¯¼å‚ä¸</p><h5 id="3-è¾“å…¥-2"><a href="#3-è¾“å…¥-2" class="headerlink" title="3. è¾“å…¥"></a>3. è¾“å…¥</h5><ul><li><strong>é¡¹ç›®ç« ç¨‹</strong></li><li><strong>é‡‡è´­æ–‡ä»¶</strong></li><li>äº‹ä¸šç¯å¢ƒå› ç´ </li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§</li></ul><h5 id="4-å·¥å…·å’ŒæŠ€æœ¯-2"><a href="#4-å·¥å…·å’ŒæŠ€æœ¯-2" class="headerlink" title="4. å·¥å…·å’ŒæŠ€æœ¯"></a>4. å·¥å…·å’ŒæŠ€æœ¯</h5><ul><li>ç»„ç»‡ç›¸å…³ä¼šè®®</li><li>ä¸“å®¶åˆ¤æ–­</li><li><strong>å¹²ç³»äººåˆ†æ</strong> â€”â€” æƒåˆ©/åˆ©ç›Šæ–¹æ ¼</li></ul><h5 id="5-è¾“å‡º-2"><a href="#5-è¾“å‡º-2" class="headerlink" title="5. è¾“å‡º"></a>5. è¾“å‡º</h5><ul><li><strong>å¹²ç³»äººç™»è®°å†Œ</strong></li></ul><h4 id="2ï¼‰è§„åˆ’å¹²ç³»äººç®¡ç†"><a href="#2ï¼‰è§„åˆ’å¹²ç³»äººç®¡ç†" class="headerlink" title="2ï¼‰è§„åˆ’å¹²ç³»äººç®¡ç†"></a>2ï¼‰è§„åˆ’å¹²ç³»äººç®¡ç†</h4><h5 id="1-ç›®çš„-1"><a href="#1-ç›®çš„-1" class="headerlink" title="1. ç›®çš„"></a>1. ç›®çš„</h5><p>ä¸ºä¸é¡¹ç›®å¹²ç³»äººçš„äº’åŠ¨æä¾›æ¸…æ™°ä¸”å¯æ“ä½œçš„è®¡åˆ’ï¼Œä¸€æ”¯æŒé¡¹ç›®åˆ©ç›Š</p><h5 id="2-è¾“å…¥"><a href="#2-è¾“å…¥" class="headerlink" title="2. è¾“å…¥"></a>2. è¾“å…¥</h5><ul><li><strong>é¡¹ç›®ç®¡ç†è®¡åˆ’</strong></li><li><strong>å¹²ç³»äººç™»è®°å†Œ</strong></li><li>äº‹ä¸šç¯å¢ƒå› ç´ </li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§</li></ul><h5 id="3-å·¥å…·å’ŒæŠ€æœ¯"><a href="#3-å·¥å…·å’ŒæŠ€æœ¯" class="headerlink" title="3. å·¥å…·å’ŒæŠ€æœ¯"></a>3. å·¥å…·å’ŒæŠ€æœ¯</h5><ul><li>ç»„ç»‡ç›¸å…³ä¼šè®®</li><li>ä¸“å®¶åˆ¤æ–­</li><li><strong>å¹²ç³»äººåˆ†æ</strong></li></ul><h5 id="4-è¾“å‡º"><a href="#4-è¾“å‡º" class="headerlink" title="4. è¾“å‡º"></a>4. è¾“å‡º</h5><ul><li><strong>å¹²ç³»äººç®¡ç†è®¡åˆ’</strong></li><li>é¡¹ç›®æ–‡ä»¶æ›´æ–°</li></ul><h4 id="3ï¼‰ç®¡ç†å¹²ç³»äºº"><a href="#3ï¼‰ç®¡ç†å¹²ç³»äºº" class="headerlink" title="3ï¼‰ç®¡ç†å¹²ç³»äºº"></a>3ï¼‰ç®¡ç†å¹²ç³»äºº</h4><h5 id="1-ç›®çš„-2"><a href="#1-ç›®çš„-2" class="headerlink" title="1. ç›®çš„"></a>1. ç›®çš„</h5><p>å¸®åŠ©é¡¹ç›®ç»ç†æå‡æ¥è‡ªå¹²ç³»äººçš„æ”¯æŒï¼Œå¹¶æŠŠå¹²ç³»äººçš„æŠµåˆ¶é™åˆ°æœ€ä½</p><h5 id="2-è¾“å…¥-1"><a href="#2-è¾“å…¥-1" class="headerlink" title="2. è¾“å…¥"></a>2. è¾“å…¥</h5><ul><li><strong>å¹²ç³»äººç®¡ç†è®¡åˆ’</strong></li><li><strong>æ²Ÿé€šç®¡ç†è®¡åˆ’</strong></li><li>å˜æ›´æ—¥å¿—</li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§</li></ul><h5 id="3-å·¥å…·å’ŒæŠ€æœ¯-1"><a href="#3-å·¥å…·å’ŒæŠ€æœ¯-1" class="headerlink" title="3. å·¥å…·å’ŒæŠ€æœ¯"></a>3. å·¥å…·å’ŒæŠ€æœ¯</h5><ul><li>æ²Ÿé€šæ–¹æ³•</li><li>äººé™…å…³ç³»æŠ€èƒ½</li><li>ç®¡ç†æŠ€èƒ½</li></ul><h5 id="4-è¾“å‡º-1"><a href="#4-è¾“å‡º-1" class="headerlink" title="4. è¾“å‡º"></a>4. è¾“å‡º</h5><ul><li>é—®é¢˜æ—¥å¿—</li><li>å˜æ›´è¯·æ±‚</li><li>é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</li><li>é¡¹ç›®æ–‡ä»¶æ›´æ–°</li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°</li></ul><h4 id="4ï¼‰æ§åˆ¶å¹²ç³»äººå‚ä¸"><a href="#4ï¼‰æ§åˆ¶å¹²ç³»äººå‚ä¸" class="headerlink" title="4ï¼‰æ§åˆ¶å¹²ç³»äººå‚ä¸"></a>4ï¼‰æ§åˆ¶å¹²ç³»äººå‚ä¸</h4><h5 id="1-ç›®çš„-3"><a href="#1-ç›®çš„-3" class="headerlink" title="1. ç›®çš„"></a>1. ç›®çš„</h5><p>æ˜¾è‘—æé«˜é¡¹ç›®æˆåŠŸçš„æœºä¼š</p><h5 id="2-è¾“å…¥-2"><a href="#2-è¾“å…¥-2" class="headerlink" title="2. è¾“å…¥"></a>2. è¾“å…¥</h5><ul><li>é¡¹ç›®ç®¡ç†è®¡åˆ’</li><li>é—®é¢˜æ—¥å¿—</li><li>å·¥ä½œç»©æ•ˆæ•°æ®</li><li>é¡¹ç›®æ–‡ä»¶</li></ul><h5 id="3-å·¥å…·å’ŒæŠ€æœ¯-2"><a href="#3-å·¥å…·å’ŒæŠ€æœ¯-2" class="headerlink" title="3. å·¥å…·å’ŒæŠ€æœ¯"></a>3. å·¥å…·å’ŒæŠ€æœ¯</h5><ul><li>ä¿¡æ¯ç®¡ç†ç³»ç»Ÿ</li><li>ä¸“å®¶åˆ¤æ–­</li><li>ä¼šè®®</li></ul><h5 id="4-è¾“å‡º-2"><a href="#4-è¾“å‡º-2" class="headerlink" title="4. è¾“å‡º"></a>4. è¾“å‡º</h5><ul><li>å·¥ä½œç»©æ•ˆä¿¡æ¯</li><li>å˜æ›´è¯·æ±‚</li><li>é¡¹ç›®æ–‡ä»¶æ›´æ–°</li><li>ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°</li></ul><h3 id="3ã€æŠ€æœ¯ä¸å·¥å…·"><a href="#3ã€æŠ€æœ¯ä¸å·¥å…·" class="headerlink" title="3ã€æŠ€æœ¯ä¸å·¥å…·"></a>3ã€æŠ€æœ¯ä¸å·¥å…·</h3><h4 id="1ï¼‰å¹²ç³»äººåˆ†ææŠ€æœ¯-â€”â€”-æƒåˆ©-åˆ©ç›Šæ–¹æ ¼ï¼ˆ-ï¼‰"><a href="#1ï¼‰å¹²ç³»äººåˆ†ææŠ€æœ¯-â€”â€”-æƒåˆ©-åˆ©ç›Šæ–¹æ ¼ï¼ˆ-ï¼‰" class="headerlink" title="1ï¼‰å¹²ç³»äººåˆ†ææŠ€æœ¯ â€”â€” æƒåˆ©/åˆ©ç›Šæ–¹æ ¼ï¼ˆ***ï¼‰"></a>1ï¼‰å¹²ç³»äººåˆ†ææŠ€æœ¯ â€”â€” æƒåˆ©/åˆ©ç›Šæ–¹æ ¼ï¼ˆ***ï¼‰</h4><h5 id="1-æ¦‚å¿µ-4"><a href="#1-æ¦‚å¿µ-4" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h5><ul><li>æ ¹æ®å¹²ç³»äººçš„æƒåˆ©å¤§å°å’Œåˆ©ç›Šå¯¹å…¶åˆ†ç±»</li><li>æŒ‡æ˜é¡¹ç›®éœ€è¦å»ºç«‹çš„ä¸å„å¹²ç³»äººä¹‹é—´çš„å…³ç³»å’Œç§ç±»</li></ul><h5 id="2-æ–¹æ ¼è§£æ"><a href="#2-æ–¹æ ¼è§£æ" class="headerlink" title="2. æ–¹æ ¼è§£æ"></a>2. æ–¹æ ¼è§£æ</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210905111918554.png" alt="image-20210905111918554"></p><blockquote><ul><li><p>B åŒºçš„å¹²ç³»äºº</p><ul><li>é¡¹ç›®çš„å®¢æˆ·ã€é¡¹ç›®çš„é¢†å¯¼</li><li>æƒåˆ©é«˜ã€åˆ©ç›Šé«˜ï¼Œå¯¹é¡¹ç›®ç»“æœå…³æ³¨åº¦é«˜ â€”â€” é‡ç‚¹ç®¡ç†ï¼ŒåŠæ—¶æŠ¥å‘Š</li></ul></li><li><p>A åŒºçš„å¹²ç³»äºº</p><ul><li>æƒåˆ©å¤§ã€åˆ©ç›Šä½ï¼Œä½†å¯¹é¡¹ç›®ç»“æœå…³æ³¨åº¦ä½ â€”â€” ä»¤å…¶æ»¡æ„ï¼Œäº‰å–æ”¯æŒ</li></ul></li><li><p>C åŒºçš„å¹²ç³»äºº</p><ul><li><p>é¡¹ç›®ç»„æˆå‘˜</p></li><li><p>åˆ©ç›Šé«˜ï¼Œä½†æƒåˆ©ä½ï¼Œä¹Ÿå…³æ³¨ç»“æœ â€”â€” éšæ—¶å‘ŠçŸ¥é¡¹ç›®çŠ¶æ€ï¼Œä¿æŒåŠæ—¶æ²Ÿé€š</p></li></ul></li><li><p>D åŒºçš„å¹²ç³»äºº</p><ul><li>æ²¡æƒåŠ›ï¼Œå¯¹é¡¹ç›®çš„å…³æ³¨åº¦ä½ â€”â€” èŠ±å°‘é‡ç²¾åŠ›ç›‘ç£ç®¡ç†</li><li>å¯èƒ½å‘æŒ¥é—´æ¥ä½œç”¨ï¼Œæ€åº¦è¦å¥½ä¸€äº›ï¼Œäº‰å–æ”¯æŒ</li></ul></li></ul></blockquote><h4 id="2ï¼‰é¡¹ç›®å¹²ç³»äººç™»è®°å†Œ"><a href="#2ï¼‰é¡¹ç›®å¹²ç³»äººç™»è®°å†Œ" class="headerlink" title="2ï¼‰é¡¹ç›®å¹²ç³»äººç™»è®°å†Œ"></a>2ï¼‰é¡¹ç›®å¹²ç³»äººç™»è®°å†Œ</h4><h5 id="1-å†…å®¹"><a href="#1-å†…å®¹" class="headerlink" title="1. å†…å®¹"></a>1. å†…å®¹</h5><h6 id="èº«ä»½è¯†åˆ«ï¼š"><a href="#èº«ä»½è¯†åˆ«ï¼š" class="headerlink" title="èº«ä»½è¯†åˆ«ï¼š"></a>èº«ä»½è¯†åˆ«ï¼š</h6><ul><li>å§“å</li><li>ç»„ç»‡èŒä½</li><li>åœ°ç‚¹</li><li>è”ç³»æ–¹å¼</li><li>åœ¨é¡¹ç›®ä¸­æ‰®æ¼”çš„è§’è‰²</li></ul><h6 id="è¯„ä¼°ä¿¡æ¯ï¼š"><a href="#è¯„ä¼°ä¿¡æ¯ï¼š" class="headerlink" title="è¯„ä¼°ä¿¡æ¯ï¼š"></a>è¯„ä¼°ä¿¡æ¯ï¼š</h6><ul><li>ä¸»è¦éœ€æ±‚ã€æœŸæœ›</li><li>å½±å“é¡¹ç›®çš„æ½œåŠ›</li><li>æœ€èƒ½å½±å“çš„é¡¹ç›®ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ</li></ul><h6 id="åˆ†ç±»ï¼š"><a href="#åˆ†ç±»ï¼š" class="headerlink" title="åˆ†ç±»ï¼š"></a>åˆ†ç±»ï¼š</h6><ul><li>å†…éƒ¨/å¤–éƒ¨</li><li>ä½œç”¨ã€å½±å“</li><li>æƒåˆ©åˆ©ç›Šæ¨¡å‹</li><li>ä¸Šçº§ã€ä¸‹çº§ã€å¤–å›´æˆ–æ¨ªå‘åˆ†ç±»æ¨¡å‹</li></ul><h5 id="2-è¡¨æ ¼å½¢å¼"><a href="#2-è¡¨æ ¼å½¢å¼" class="headerlink" title="2. è¡¨æ ¼å½¢å¼"></a>2. è¡¨æ ¼å½¢å¼</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210905153453102.png" alt="image-20210905153453102"></p><h4 id="3ï¼‰å¹²ç³»äººå‚ä¸åº¦è¯„ä¼°çŸ©é˜µ"><a href="#3ï¼‰å¹²ç³»äººå‚ä¸åº¦è¯„ä¼°çŸ©é˜µ" class="headerlink" title="3ï¼‰å¹²ç³»äººå‚ä¸åº¦è¯„ä¼°çŸ©é˜µ"></a>3ï¼‰å¹²ç³»äººå‚ä¸åº¦è¯„ä¼°çŸ©é˜µ</h4><h5 id="1-åˆ†ç±»"><a href="#1-åˆ†ç±»" class="headerlink" title="1. åˆ†ç±»"></a>1. åˆ†ç±»</h5><h6 id="ä¸äº†è§£å‹ï¼š"><a href="#ä¸äº†è§£å‹ï¼š" class="headerlink" title="ä¸äº†è§£å‹ï¼š"></a>ä¸äº†è§£å‹ï¼š</h6><ul><li>ä¸çŸ¥é“é¡¹ç›®åŠå…¶æ½œåœ¨å½±å“</li></ul><h6 id="æŠµåˆ¶å‹ï¼š"><a href="#æŠµåˆ¶å‹ï¼š" class="headerlink" title="æŠµåˆ¶å‹ï¼š"></a>æŠµåˆ¶å‹ï¼š</h6><ul><li>çŸ¥é“é¡¹ç›®åŠå…¶æ½œåœ¨å½±å“ï¼Œä½†æŠµåˆ¶é¡¹ç›®å·¥ä½œæˆ–æˆæœå¼•å‘çš„å˜æ›´</li></ul><h6 id="ä¸­ç«‹å‹ï¼š"><a href="#ä¸­ç«‹å‹ï¼š" class="headerlink" title="ä¸­ç«‹å‹ï¼š"></a>ä¸­ç«‹å‹ï¼š</h6><ul><li>äº†è§£é¡¹ç›®ï¼Œä½†å³ä¸æ”¯æŒï¼Œä¹Ÿä¸åå¯¹</li></ul><h6 id="æ”¯æŒå‹ï¼š"><a href="#æ”¯æŒå‹ï¼š" class="headerlink" title="æ”¯æŒå‹ï¼š"></a>æ”¯æŒå‹ï¼š</h6><ul><li>äº†è§£é¡¹ç›®åŠå…¶æ½œåœ¨å½±å“ï¼Œå¹¶ä¸”æ”¯æŒé¡¹ç›®å·¥ä½œåŠå…¶æˆæœ</li></ul><h6 id="é¢†å¯¼å‹ï¼š"><a href="#é¢†å¯¼å‹ï¼š" class="headerlink" title="é¢†å¯¼å‹ï¼š"></a>é¢†å¯¼å‹ï¼š</h6><ul><li>äº†è§£é¡¹ç›®åŠå…¶æ½œåœ¨å½±å“ï¼Œå¹¶ä¸”ç§¯æå‚ä¸ä»¥ç¡®ä¿é¡¹ç›®å–å¾—æˆåŠŸ</li></ul><h5 id="2-ç¤ºä¾‹"><a href="#2-ç¤ºä¾‹" class="headerlink" title="2. ç¤ºä¾‹"></a>2. ç¤ºä¾‹</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210905154754430.png" alt="image-20210905154754430"></p><blockquote><p>å¹²ç³»äºº1 éœ€è¦ä»ä¸çŸ¥æ™“åˆ°æ”¯æŒã€‚é‡ç‚¹å…³æ³¨è·å–æ”¯æŒ</p><p>å¹²ç³»äºº2 éœ€è¦ä»ä¸­ç«‹åˆ°æ”¯æŒï¼Œä½¿å…¶æ»¡æ„è·å–æ”¯æŒ</p><p>å¹²ç³»äºº3 æœ¬æ¥å°±æ”¯æŒï¼Œç›‘ç£å³å¯</p></blockquote><h4 id="4ï¼‰å¹²ç³»äººç®¡ç†è®¡åˆ’"><a href="#4ï¼‰å¹²ç³»äººç®¡ç†è®¡åˆ’" class="headerlink" title="4ï¼‰å¹²ç³»äººç®¡ç†è®¡åˆ’"></a>4ï¼‰å¹²ç³»äººç®¡ç†è®¡åˆ’</h4><h5 id="1-ä¸»è¦å†…å®¹"><a href="#1-ä¸»è¦å†…å®¹" class="headerlink" title="1. ä¸»è¦å†…å®¹"></a>1. ä¸»è¦å†…å®¹</h5><ul><li>é¡¹ç›®æˆå‘˜å¯ä»¥çœ‹åˆ°å“ªäº›ä¿¡æ¯</li><li>é¡¹ç›®ç»ç†éœ€è¦å“ªäº›ä¿¡æ¯</li><li>é«˜å±‚ç®¡ç†è€…éœ€è¦å“ªäº›ä¿¡æ¯</li><li>å®¢æˆ·éœ€è¦å“ªäº›ä¿¡æ¯</li><li>æ–‡ä»¶çš„è®¿é—®æƒé™ã€è®¿é—®è·¯å¾„ä»¥åŠæ–‡ä»¶çš„æ¥å—æ ¼å¼ç­‰</li></ul><h5 id="2-å¹²ç³»äººç®¡ç†è®¡åˆ’è¡¨ç¤ºä¾‹"><a href="#2-å¹²ç³»äººç®¡ç†è®¡åˆ’è¡¨ç¤ºä¾‹" class="headerlink" title="2. å¹²ç³»äººç®¡ç†è®¡åˆ’è¡¨ç¤ºä¾‹"></a>2. å¹²ç³»äººç®¡ç†è®¡åˆ’è¡¨ç¤ºä¾‹</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210905154915693.png" alt="image-20210905154915693"></p><h3 id="4ã€ç®¡ç†å¹²ç³»äººå‚ä¸-VS-æ§åˆ¶å¹²ç³»äººå‚ä¸"><a href="#4ã€ç®¡ç†å¹²ç³»äººå‚ä¸-VS-æ§åˆ¶å¹²ç³»äººå‚ä¸" class="headerlink" title="4ã€ç®¡ç†å¹²ç³»äººå‚ä¸ VS æ§åˆ¶å¹²ç³»äººå‚ä¸"></a>4ã€ç®¡ç†å¹²ç³»äººå‚ä¸ VS æ§åˆ¶å¹²ç³»äººå‚ä¸</h3><h4 id="1ï¼‰å…±æ€§-1"><a href="#1ï¼‰å…±æ€§-1" class="headerlink" title="1ï¼‰å…±æ€§"></a>1ï¼‰å…±æ€§</h4><ul><li>éƒ½æ˜¯ä¸ºäº†ç¡®ä¿å¹²ç³»äººå®é™…å‚ä¸é¡¹ç›®çš„ç¨‹åº¦ç¬¦åˆæ‰€éœ€çš„å‚ä¸ç¨‹åº¦</li><li>éƒ½å¯èƒ½å¯¹å¹²ç³»äººç®¡ç†å·¥ä½œæå‡ºå˜æ›´ç”³è¯·</li></ul><h4 id="2ï¼‰è”ç³»-1"><a href="#2ï¼‰è”ç³»-1" class="headerlink" title="2ï¼‰è”ç³»"></a>2ï¼‰è”ç³»</h4><ul><li>ç®¡ç†å¹²ç³»äººå‚ä¸è¿‡ç¨‹çš„è¾“å‡ºæ—¶ <strong>é—®é¢˜æ—¥å¿—</strong>ï¼Œæ˜¯æ§åˆ¶å¹²ç³»äººå‚ä¸çš„è¾“å…¥</li><li>åœ¨é¡¹ç›®ç®¡ç†å®æˆ˜ä¸­ï¼Œç®¡ç†å¹²ç³»äººå‚ä¸å’Œæ§åˆ¶å¹²ç³»äººå‚ä¸ä¸¤è€…å¾€å¾€æ— æ³•æ‹†å¼€</li></ul><h4 id="3ï¼‰åŒºåˆ«-1"><a href="#3ï¼‰åŒºåˆ«-1" class="headerlink" title="3ï¼‰åŒºåˆ«"></a>3ï¼‰åŒºåˆ«</h4><ul><li>ç®¡ç†å¹²ç³»äººå‚ä¸åœ¨æ‰§è¡Œè¿‡ç¨‹ç»„ï¼Œæ§åˆ¶å¹²ç³»äººå‚ä¸åœ¨ç›‘æ§è¿‡ç¨‹ç»„</li><li><strong>ç®¡ç†å¹²ç³»äººå‚ä¸ï¼Œæ˜¯åŸºäºå¯¹ä»€ä¹ˆåšæ³•æœ‰åˆ©äºæå‡å’Œç»´æŒå¹²ç³»äººå‚ä¸çš„é¢„æœŸï¼Œä»è€Œé‡‡å–å“ªäº›åšæ³•æ¥å®ç°è¿™ä¸ªé¢„æœŸ</strong></li><li>æ§åˆ¶å¹²ç³»äººå‚ä¸ï¼Œæ˜¯åŸºäºå¯¹å¹²ç³»äººå‚ä¸ç¨‹åº¦å’Œæ‰€éœ€ç¨‹åº¦çš„å·®è·ï¼Œä»è€Œé‡‡å–æªæ–½ä½¿å®é™…å‚ä¸ç¨‹åº¦å’Œé¢„æœŸç¨‹åº¦ç›¸åŒ¹é…</li></ul><h2 id="ä¸‰ã€ä½œä¸š"><a href="#ä¸‰ã€ä½œä¸š" class="headerlink" title="ä¸‰ã€ä½œä¸š"></a>ä¸‰ã€ä½œä¸š</h2><h3 id="1ã€æ²Ÿé€šè¿‡ç¨‹æœ‰å‚ä¸è®¨è®ºã€å¾è¯¢ã€è¯´æ˜ã€å™è¿°æ–¹å¼ï¼Œæ§åˆ¶ç¨‹åº¦ä»å¼±åˆ°å¼ºå¦‚ä½•æ’åˆ—ï¼Ÿ"><a href="#1ã€æ²Ÿé€šè¿‡ç¨‹æœ‰å‚ä¸è®¨è®ºã€å¾è¯¢ã€è¯´æ˜ã€å™è¿°æ–¹å¼ï¼Œæ§åˆ¶ç¨‹åº¦ä»å¼±åˆ°å¼ºå¦‚ä½•æ’åˆ—ï¼Ÿ" class="headerlink" title="1ã€æ²Ÿé€šè¿‡ç¨‹æœ‰å‚ä¸è®¨è®ºã€å¾è¯¢ã€è¯´æ˜ã€å™è¿°æ–¹å¼ï¼Œæ§åˆ¶ç¨‹åº¦ä»å¼±åˆ°å¼ºå¦‚ä½•æ’åˆ—ï¼Ÿ"></a>1ã€æ²Ÿé€šè¿‡ç¨‹æœ‰å‚ä¸è®¨è®ºã€å¾è¯¢ã€è¯´æ˜ã€å™è¿°æ–¹å¼ï¼Œæ§åˆ¶ç¨‹åº¦ä»å¼±åˆ°å¼ºå¦‚ä½•æ’åˆ—ï¼Ÿ</h3><h3 id="2ã€æ²Ÿé€šç®¡ç†è®¡åˆ’çš„å†…å®¹ï¼Ÿï¼ˆå‰6æ¡ï¼‰"><a href="#2ã€æ²Ÿé€šç®¡ç†è®¡åˆ’çš„å†…å®¹ï¼Ÿï¼ˆå‰6æ¡ï¼‰" class="headerlink" title="2ã€æ²Ÿé€šç®¡ç†è®¡åˆ’çš„å†…å®¹ï¼Ÿï¼ˆå‰6æ¡ï¼‰"></a>2ã€æ²Ÿé€šç®¡ç†è®¡åˆ’çš„å†…å®¹ï¼Ÿï¼ˆå‰6æ¡ï¼‰</h3><h3 id="3ã€æ‰“ç”µè¯æ—¶äº¤äº’å¼æ²Ÿé€šï¼Œä¸Šä¼ å…è´¹èµ„æ–™åˆ°ç™¾åº¦äº‘ï¼Œæ˜¯æ¨å¼æ²Ÿé€šï¼Œè¿˜æ˜¯æ¥å¼æ²Ÿé€šï¼Ÿ"><a href="#3ã€æ‰“ç”µè¯æ—¶äº¤äº’å¼æ²Ÿé€šï¼Œä¸Šä¼ å…è´¹èµ„æ–™åˆ°ç™¾åº¦äº‘ï¼Œæ˜¯æ¨å¼æ²Ÿé€šï¼Œè¿˜æ˜¯æ¥å¼æ²Ÿé€šï¼Ÿ" class="headerlink" title="3ã€æ‰“ç”µè¯æ—¶äº¤äº’å¼æ²Ÿé€šï¼Œä¸Šä¼ å…è´¹èµ„æ–™åˆ°ç™¾åº¦äº‘ï¼Œæ˜¯æ¨å¼æ²Ÿé€šï¼Œè¿˜æ˜¯æ¥å¼æ²Ÿé€šï¼Ÿ"></a>3ã€æ‰“ç”µè¯æ—¶äº¤äº’å¼æ²Ÿé€šï¼Œä¸Šä¼ å…è´¹èµ„æ–™åˆ°ç™¾åº¦äº‘ï¼Œæ˜¯æ¨å¼æ²Ÿé€šï¼Œè¿˜æ˜¯æ¥å¼æ²Ÿé€šï¼Ÿ</h3><h3 id="4ã€ä¸€ä¸ªé¡¹ç›®åŸæœ‰5åæˆå‘˜ï¼Œç”±äºå·¥ä½œéœ€è¦ï¼Œå¢åŠ äº†3åæ–°æˆå‘˜ï¼Œé—®æ­¤æ—¶é¡¹ç›®çš„æ²Ÿé€šæ¸ é“æ•°æ¯”åŸæ¥å¢åŠ äº†å¤šå°‘å€ï¼Ÿæ˜¯åŸæ¥çš„å¤šå°‘å€ï¼Ÿ"><a href="#4ã€ä¸€ä¸ªé¡¹ç›®åŸæœ‰5åæˆå‘˜ï¼Œç”±äºå·¥ä½œéœ€è¦ï¼Œå¢åŠ äº†3åæ–°æˆå‘˜ï¼Œé—®æ­¤æ—¶é¡¹ç›®çš„æ²Ÿé€šæ¸ é“æ•°æ¯”åŸæ¥å¢åŠ äº†å¤šå°‘å€ï¼Ÿæ˜¯åŸæ¥çš„å¤šå°‘å€ï¼Ÿ" class="headerlink" title="4ã€ä¸€ä¸ªé¡¹ç›®åŸæœ‰5åæˆå‘˜ï¼Œç”±äºå·¥ä½œéœ€è¦ï¼Œå¢åŠ äº†3åæ–°æˆå‘˜ï¼Œé—®æ­¤æ—¶é¡¹ç›®çš„æ²Ÿé€šæ¸ é“æ•°æ¯”åŸæ¥å¢åŠ äº†å¤šå°‘å€ï¼Ÿæ˜¯åŸæ¥çš„å¤šå°‘å€ï¼Ÿ"></a>4ã€ä¸€ä¸ªé¡¹ç›®åŸæœ‰5åæˆå‘˜ï¼Œç”±äºå·¥ä½œéœ€è¦ï¼Œå¢åŠ äº†3åæ–°æˆå‘˜ï¼Œé—®æ­¤æ—¶é¡¹ç›®çš„æ²Ÿé€šæ¸ é“æ•°æ¯”åŸæ¥å¢åŠ äº†å¤šå°‘å€ï¼Ÿæ˜¯åŸæ¥çš„å¤šå°‘å€ï¼Ÿ</h3><h3 id="5ã€å¹²ç³»äººç®¡ç†æœ‰å“ªå››ä¸ªè¿‡ç¨‹ï¼Ÿ"><a href="#5ã€å¹²ç³»äººç®¡ç†æœ‰å“ªå››ä¸ªè¿‡ç¨‹ï¼Ÿ" class="headerlink" title="5ã€å¹²ç³»äººç®¡ç†æœ‰å“ªå››ä¸ªè¿‡ç¨‹ï¼Ÿ"></a>5ã€å¹²ç³»äººç®¡ç†æœ‰å“ªå››ä¸ªè¿‡ç¨‹ï¼Ÿ</h3><h3 id="6ã€è¯·ç»˜åˆ¶å¹²ç³»äººæƒåˆ©-åˆ©ç›Šæ–¹æ ¼"><a href="#6ã€è¯·ç»˜åˆ¶å¹²ç³»äººæƒåˆ©-åˆ©ç›Šæ–¹æ ¼" class="headerlink" title="6ã€è¯·ç»˜åˆ¶å¹²ç³»äººæƒåˆ©/åˆ©ç›Šæ–¹æ ¼"></a>6ã€è¯·ç»˜åˆ¶å¹²ç³»äººæƒåˆ©/åˆ©ç›Šæ–¹æ ¼</h3>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬6ç« ã€é¡¹ç›®çš„é‡‡è´­ç®¡ç†å’Œé£é™©ç®¡ç†</title>
    <link href="/2021/08/31/%E7%AC%AC6%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%87%87%E8%B4%AD%E7%AE%A1%E7%90%86%E5%92%8C%E9%A3%8E%E9%99%A9%E7%AE%A1%E7%90%86/"/>
    <url>/2021/08/31/%E7%AC%AC6%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%87%87%E8%B4%AD%E7%AE%A1%E7%90%86%E5%92%8C%E9%A3%8E%E9%99%A9%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬6ç« ã€é¡¹ç›®çš„é‡‡è´­ç®¡ç†å’Œé£é™©ç®¡ç†"><a href="#ç¬¬6ç« ã€é¡¹ç›®çš„é‡‡è´­ç®¡ç†å’Œé£é™©ç®¡ç†" class="headerlink" title="ç¬¬6ç« ã€é¡¹ç›®çš„é‡‡è´­ç®¡ç†å’Œé£é™©ç®¡ç†"></a>ç¬¬6ç« ã€é¡¹ç›®çš„é‡‡è´­ç®¡ç†å’Œé£é™©ç®¡ç†</h1><span id="more"></span><h2 id="ä¸€ã€é£é™©ç®¡ç†"><a href="#ä¸€ã€é£é™©ç®¡ç†" class="headerlink" title="ä¸€ã€é£é™©ç®¡ç†"></a>ä¸€ã€é£é™©ç®¡ç†</h2><h3 id="1ã€åŸºç¡€çŸ¥è¯†"><a href="#1ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="1ã€åŸºç¡€çŸ¥è¯†"></a>1ã€åŸºç¡€çŸ¥è¯†</h3><h4 id="1ï¼‰é£é™©å’Œé¡¹ç›®é£é™©ç®¡ç†å®šä¹‰"><a href="#1ï¼‰é£é™©å’Œé¡¹ç›®é£é™©ç®¡ç†å®šä¹‰" class="headerlink" title="1ï¼‰é£é™©å’Œé¡¹ç›®é£é™©ç®¡ç†å®šä¹‰"></a>1ï¼‰é£é™©å’Œé¡¹ç›®é£é™©ç®¡ç†å®šä¹‰</h4><h5 id="1-é£é™©çš„æ¦‚å¿µ"><a href="#1-é£é™©çš„æ¦‚å¿µ" class="headerlink" title="1. é£é™©çš„æ¦‚å¿µ"></a>1. é£é™©çš„æ¦‚å¿µ</h5><ul><li>æŒ‡ä¸é¡¹ç›®ç›¸å…³çš„è‹¥å¹²<strong>ä¸ç¡®å®šæ€§</strong>äº‹ä»¶æˆ–æ¡ä»¶</li><li>ä¼šå¯¹é¡¹ç›®ç›®æ ‡çš„å®ç°äº§ç”Ÿ<strong>æ­£é¢æˆ–è´Ÿé¢çš„å½±å“</strong></li></ul><h5 id="2-é£é™©çš„è®¡ç®—å…¬å¼"><a href="#2-é£é™©çš„è®¡ç®—å…¬å¼" class="headerlink" title="2. é£é™©çš„è®¡ç®—å…¬å¼"></a>2. é£é™©çš„è®¡ç®—å…¬å¼</h5><h5 id="3-é¡¹ç›®é£é™©ç®¡ç†çš„ç›®çš„"><a href="#3-é¡¹ç›®é£é™©ç®¡ç†çš„ç›®çš„" class="headerlink" title="3. é¡¹ç›®é£é™©ç®¡ç†çš„ç›®çš„"></a>3. é¡¹ç›®é£é™©ç®¡ç†çš„ç›®çš„</h5><ul><li>é™ä½æ¶ˆæé£é™©çš„å‘ç”Ÿæ¦‚ç‡å’Œå½±å“</li><li>æé«˜ç§¯æé£é™©çš„å‘ç”Ÿæ¦‚ç‡å’Œå½±å“</li></ul><h4 id="2ï¼‰é¡¹ç›®é£é™©çš„ç‰¹ç‚¹"><a href="#2ï¼‰é¡¹ç›®é£é™©çš„ç‰¹ç‚¹" class="headerlink" title="2ï¼‰é¡¹ç›®é£é™©çš„ç‰¹ç‚¹"></a>2ï¼‰é¡¹ç›®é£é™©çš„ç‰¹ç‚¹</h4><h4 id="3ï¼‰é£é™©çš„åˆ†ç±»"><a href="#3ï¼‰é£é™©çš„åˆ†ç±»" class="headerlink" title="3ï¼‰é£é™©çš„åˆ†ç±»"></a>3ï¼‰é£é™©çš„åˆ†ç±»</h4><h5 id="1-é£é™©åˆ†ç±»çš„ç›®çš„"><a href="#1-é£é™©åˆ†ç±»çš„ç›®çš„" class="headerlink" title="1. é£é™©åˆ†ç±»çš„ç›®çš„"></a>1. é£é™©åˆ†ç±»çš„ç›®çš„</h5><ul><li>ä¸ºç¡®ä¿ç³»ç»Ÿåœ°ã€æŒç»­ä¸€è‡´åœ°ã€æœ‰æ•ˆåœ°è¿›è¡Œé£é™©è¯†åˆ«æä¾›äº†åŸºç¡€</li><li>ä¸ºé£é™©ç®¡ç†å·¥ä½œæä¾›äº†ä¸€ä¸ªæ¡†æ¶</li></ul><h5 id="2-æŒ‰æ€§è´¨åˆ’åˆ†"><a href="#2-æŒ‰æ€§è´¨åˆ’åˆ†" class="headerlink" title="2. æŒ‰æ€§è´¨åˆ’åˆ†"></a>2. æŒ‰æ€§è´¨åˆ’åˆ†</h5><ul><li>çº¯ç²¹é£é™©</li><li>æŠ•æœºé£é™©<ul><li>åæœ<ul><li>æ²¡æœ‰æŸå¤±</li><li>æœ‰æŸå¤±</li><li>æ”¶ç›Š</li></ul></li></ul></li></ul><h5 id="3-æŒ‰äº§ç”ŸåŸå› åˆ’åˆ†"><a href="#3-æŒ‰äº§ç”ŸåŸå› åˆ’åˆ†" class="headerlink" title="3. æŒ‰äº§ç”ŸåŸå› åˆ’åˆ†"></a>3. æŒ‰äº§ç”ŸåŸå› åˆ’åˆ†</h5><ul><li>è‡ªç„¶é£é™©<ul><li>ç‰¹å¾<ul><li>ä¸å¯æ§æ€§</li><li>å‘¨æœŸæ€§</li><li>å…±æ²¾æ€§</li></ul></li></ul></li><li>ç¤¾ä¼šé£é™©</li><li>æ”¿æ²»é£é™©ï¼ˆå›½å®¶é£é™©ï¼‰</li><li>ç»æµé£é™©</li><li>æŠ€æœ¯é£é™©</li></ul><h5 id="4-æŒ‰æ ‡çš„ç‰©åˆ’åˆ†"><a href="#4-æŒ‰æ ‡çš„ç‰©åˆ’åˆ†" class="headerlink" title="4. æŒ‰æ ‡çš„ç‰©åˆ’åˆ†"></a>4. æŒ‰æ ‡çš„ç‰©åˆ’åˆ†</h5><ul><li>è´¢äº§é£é™©</li><li>è´£ä»»é£é™©</li><li>äººèº«é£é™©</li><li>ä¿¡ç”¨é£é™©</li></ul><h5 id="5-æŒ‰è¡Œä¸ºåˆ’åˆ†"><a href="#5-æŒ‰è¡Œä¸ºåˆ’åˆ†" class="headerlink" title="5. æŒ‰è¡Œä¸ºåˆ’åˆ†"></a>5. æŒ‰è¡Œä¸ºåˆ’åˆ†</h5><ul><li>ç‰¹å®šé£é™©</li><li>åŸºæœ¬é£é™©</li></ul><h5 id="6-æŒ‰ç¯å¢ƒåˆ’åˆ†"><a href="#6-æŒ‰ç¯å¢ƒåˆ’åˆ†" class="headerlink" title="6. æŒ‰ç¯å¢ƒåˆ’åˆ†"></a>6. æŒ‰ç¯å¢ƒåˆ’åˆ†</h5><ul><li>é™æ€é£é™©</li><li>åŠ¨æ€é£é™©</li></ul><h4 id="4ï¼‰é£é™©çš„åº”å¯¹"><a href="#4ï¼‰é£é™©çš„åº”å¯¹" class="headerlink" title="4ï¼‰é£é™©çš„åº”å¯¹"></a>4ï¼‰é£é™©çš„åº”å¯¹</h4><h5 id="1-å·²çŸ¥å·²çŸ¥é£é™©"><a href="#1-å·²çŸ¥å·²çŸ¥é£é™©" class="headerlink" title="1. å·²çŸ¥å·²çŸ¥é£é™©"></a>1. å·²çŸ¥å·²çŸ¥é£é™©</h5><h6 id="æ¦‚å¿µï¼š"><a href="#æ¦‚å¿µï¼š" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h6><ul><li>é£é™©çš„å‘ç”Ÿå¯é¢„çŸ¥ï¼Œä¸”é£é™©çš„åæœå’Œå½±å“å¯é¢„çŸ¥</li></ul><h6 id="åº”å¯¹ï¼š"><a href="#åº”å¯¹ï¼š" class="headerlink" title="åº”å¯¹ï¼š"></a>åº”å¯¹ï¼š</h6><ul><li>å¿…é¡»åŠ ç®¡ç†ï¼Œä»¥é™ä½å¨èƒ</li><li>ç”¨æˆæœ¬åŸºå‡†ä¸­çš„ç›´æ¥æˆæœ¬åº”å¯¹å·²çŸ¥å·²çŸ¥é£é™©</li></ul><h5 id="2-å·²çŸ¥æœªçŸ¥é£é™©"><a href="#2-å·²çŸ¥æœªçŸ¥é£é™©" class="headerlink" title="2. å·²çŸ¥æœªçŸ¥é£é™©"></a>2. å·²çŸ¥æœªçŸ¥é£é™©</h5><h6 id="æ¦‚å¿µï¼š-1"><a href="#æ¦‚å¿µï¼š-1" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h6><ul><li>é£é™©çš„å‘ç”Ÿå¯é¢„çŸ¥ï¼Œä¸”é£é™©çš„åæœå’Œå½±å“ä¸å¯çŸ¥</li></ul><h6 id="åº”å¯¹ï¼š-1"><a href="#åº”å¯¹ï¼š-1" class="headerlink" title="åº”å¯¹ï¼š"></a>åº”å¯¹ï¼š</h6><ul><li></li><li>ç”¨æˆæœ¬åŸºå‡†ä¸­çš„åº”æ€¥è®¡åˆ’å’Œåº”æ€¥å‚¨å¤‡åº”å¯¹</li></ul><h5 id="3-æœªçŸ¥æœªçŸ¥é£é™©"><a href="#3-æœªçŸ¥æœªçŸ¥é£é™©" class="headerlink" title="3. æœªçŸ¥æœªçŸ¥é£é™©"></a>3. æœªçŸ¥æœªçŸ¥é£é™©</h5><h6 id="æ¦‚å¿µï¼š-2"><a href="#æ¦‚å¿µï¼š-2" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h6><ul><li>é£é™©çš„å‘ç”Ÿå’Œåæœéƒ½ä¸å¯çŸ¥</li></ul><h6 id="åº”å¯¹ï¼š-2"><a href="#åº”å¯¹ï¼š-2" class="headerlink" title="åº”å¯¹ï¼š"></a>åº”å¯¹ï¼š</h6><ul><li>åªèƒ½å®é™…å‘ç”Ÿåå†å¤„ç†</li><li>éæˆæœ¬åŸºå‡†ï¼Œé€‚ç”¨æƒå˜æªæ–½å’Œç®¡ç†å‚¨å¤‡</li></ul><h4 id="5ï¼‰é¡¹ç›®é£é™©ç®¡ç†ä¸å…¶ä»–ç®¡ç†çš„å…³ç³»"><a href="#5ï¼‰é¡¹ç›®é£é™©ç®¡ç†ä¸å…¶ä»–ç®¡ç†çš„å…³ç³»" class="headerlink" title="5ï¼‰é¡¹ç›®é£é™©ç®¡ç†ä¸å…¶ä»–ç®¡ç†çš„å…³ç³»"></a>5ï¼‰é¡¹ç›®é£é™©ç®¡ç†ä¸å…¶ä»–ç®¡ç†çš„å…³ç³»</h4><h4 id="6ï¼‰é£é™©çš„å¯é¢„æµ‹æ€§"><a href="#6ï¼‰é£é™©çš„å¯é¢„æµ‹æ€§" class="headerlink" title="6ï¼‰é£é™©çš„å¯é¢„æµ‹æ€§"></a>6ï¼‰é£é™©çš„å¯é¢„æµ‹æ€§</h4><h5 id="1-å·²çŸ¥é£é™©"><a href="#1-å·²çŸ¥é£é™©" class="headerlink" title="1. å·²çŸ¥é£é™©"></a>1. å·²çŸ¥é£é™©</h5><ul><li>å¯ä»¥æ˜ç¡®é£é™©çš„å‘ç”Ÿï¼Œå¹¶ä¸”å…¶åæœä¹Ÿå¯é¢„è§</li><li>ä¾‹å¦‚ï¼šé¡¹ç›®ç›®æ ‡ä¸æ˜ç¡®ã€è¿‡åˆ†ä¹è§‚çš„è¿›åº¦è®¡åˆ’ç­‰</li></ul><h5 id="2-å¯é¢„æµ‹é£é™©"><a href="#2-å¯é¢„æµ‹é£é™©" class="headerlink" title="2. å¯é¢„æµ‹é£é™©"></a>2. å¯é¢„æµ‹é£é™©</h5><ul><li>å¯ä»¥é¢„è§é£é™©çš„å‘ç”Ÿï¼Œä½†å…¶åæœä¸å¯é¢„è§</li><li>ä¾‹å¦‚ï¼šä¸šä¸»ä¸èƒ½åŠæ—¶å®¡æ‰¹ã€åˆ†åŒ…å•†ä¸èƒ½åŠæ—¶äº¤ä»˜ç­‰</li></ul><h5 id="3-ä¸å¯é¢„æµ‹é£é™©"><a href="#3-ä¸å¯é¢„æµ‹é£é™©" class="headerlink" title="3. ä¸å¯é¢„æµ‹é£é™©"></a>3. ä¸å¯é¢„æµ‹é£é™©</h5><ul><li>é£é™©çš„å‘ç”Ÿå’Œåæœéƒ½ä¸å¯ä»¥é¢„è§ï¼Œä¸€èˆ¬æ˜¯å¤–éƒ¨å› ç´ ä½œç”¨çš„ç»“æœ</li><li>ä¾‹å¦‚ï¼šè‡ªç„¶ç¾å®³ã€é€šè´§è†¨èƒ€ã€æ”¿ç­–å˜åŒ–ç­‰</li></ul><h4 id="7ï¼‰é£é™©ç®¡ç†çš„é‡è¦æ¦‚å¿µ"><a href="#7ï¼‰é£é™©ç®¡ç†çš„é‡è¦æ¦‚å¿µ" class="headerlink" title="7ï¼‰é£é™©ç®¡ç†çš„é‡è¦æ¦‚å¿µ"></a>7ï¼‰é£é™©ç®¡ç†çš„é‡è¦æ¦‚å¿µ</h4><h5 id=""><a href="#" class="headerlink" title=""></a><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210907125512861.png" alt="image-20210907125512861"></h5><h3 id="2ã€è§„åˆ’é£é™©ç®¡ç†"><a href="#2ã€è§„åˆ’é£é™©ç®¡ç†" class="headerlink" title="2ã€è§„åˆ’é£é™©ç®¡ç†"></a>2ã€è§„åˆ’é£é™©ç®¡ç†</h3><h4 id="1ï¼‰æ¦‚å¿µ"><a href="#1ï¼‰æ¦‚å¿µ" class="headerlink" title="1ï¼‰æ¦‚å¿µ"></a>1ï¼‰æ¦‚å¿µ</h4><p>å†³å®šå¦‚ä½•è¿›è¡Œè§„åˆ’å’Œå®æ–½é¡¹ç›®é£é™©ç®¡ç†æ´»åŠ¨</p><h4 id="2ï¼‰è§„åˆ’é£é™©ç®¡ç†çš„è¿‡ç¨‹"><a href="#2ï¼‰è§„åˆ’é£é™©ç®¡ç†çš„è¿‡ç¨‹" class="headerlink" title="2ï¼‰è§„åˆ’é£é™©ç®¡ç†çš„è¿‡ç¨‹"></a>2ï¼‰è§„åˆ’é£é™©ç®¡ç†çš„è¿‡ç¨‹</h4><h4 id="3ï¼‰è¾“å…¥"><a href="#3ï¼‰è¾“å…¥" class="headerlink" title="3ï¼‰è¾“å…¥"></a>3ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-é¡¹ç›®ç« ç¨‹"><a href="#2-é¡¹ç›®ç« ç¨‹" class="headerlink" title="2. é¡¹ç›®ç« ç¨‹"></a>2. é¡¹ç›®ç« ç¨‹</h5><h5 id="3-å¹²ç³»äººç™»è®°å†Œ"><a href="#3-å¹²ç³»äººç™»è®°å†Œ" class="headerlink" title="3. å¹²ç³»äººç™»è®°å†Œ"></a>3. å¹²ç³»äººç™»è®°å†Œ</h5><h5 id="4-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#4-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="4. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>4. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h5 id="5-äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#5-äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="5. äº‹ä¸šç¯å¢ƒå› ç´ "></a>5. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h4 id="4ï¼‰å·¥å…·ä¸æŠ€æœ¯"><a href="#4ï¼‰å·¥å…·ä¸æŠ€æœ¯" class="headerlink" title="4ï¼‰å·¥å…·ä¸æŠ€æœ¯"></a>4ï¼‰å·¥å…·ä¸æŠ€æœ¯</h4><h5 id="1-åˆ†ææŠ€æœ¯"><a href="#1-åˆ†ææŠ€æœ¯" class="headerlink" title="1. åˆ†ææŠ€æœ¯"></a>1. åˆ†ææŠ€æœ¯</h5><h5 id="2-ä¸“å®¶åˆ¤æ–­"><a href="#2-ä¸“å®¶åˆ¤æ–­" class="headerlink" title="2. ä¸“å®¶åˆ¤æ–­"></a>2. ä¸“å®¶åˆ¤æ–­</h5><h5 id="3-ä¼šè®®"><a href="#3-ä¼šè®®" class="headerlink" title="3. ä¼šè®®"></a>3. ä¼šè®®</h5><h4 id="5ï¼‰è¾“å‡º"><a href="#5ï¼‰è¾“å‡º" class="headerlink" title="5ï¼‰è¾“å‡º"></a>5ï¼‰è¾“å‡º</h4><h5 id="1-é£é™©ç®¡ç†è®¡åˆ’çš„å†…å®¹ï¼ˆ-ï¼‰"><a href="#1-é£é™©ç®¡ç†è®¡åˆ’çš„å†…å®¹ï¼ˆ-ï¼‰" class="headerlink" title="1. é£é™©ç®¡ç†è®¡åˆ’çš„å†…å®¹ï¼ˆ***ï¼‰"></a>1. é£é™©ç®¡ç†è®¡åˆ’çš„å†…å®¹ï¼ˆ***ï¼‰</h5><ul><li>æ–¹æ³•è®º</li><li>è§’è‰²ä¸èŒè´£</li><li>é¢„ç®—</li><li>æ—¶é—´å®‰æ’</li><li>é£é™©ç±»åˆ«</li><li>é£é™©æ¦‚ç‡å’Œå½±å“çš„å®šä¹‰</li><li>æ¦‚ç‡å’Œå½±å“çŸ©é˜µ</li><li>ä¿®è®¢çš„å¹²ç³»äººæ‰¿å—èƒ½åŠ›</li><li>æŠ¥å‘Šæ ¼å¼</li><li>è·Ÿè¸ª</li></ul><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210907124331831.png" alt="image-20210907124331831"></p><h5 id="2-é£é™©æ¦‚ç‡å’Œå½±å“çš„å®šä¹‰"><a href="#2-é£é™©æ¦‚ç‡å’Œå½±å“çš„å®šä¹‰" class="headerlink" title="2. é£é™©æ¦‚ç‡å’Œå½±å“çš„å®šä¹‰"></a>2. é£é™©æ¦‚ç‡å’Œå½±å“çš„å®šä¹‰</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210906125226848.png" alt="image-20210906125226848"></p><h5 id="3-é£é™©åˆ†è§£ç»“æ„ï¼ˆRBSï¼‰"><a href="#3-é£é™©åˆ†è§£ç»“æ„ï¼ˆRBSï¼‰" class="headerlink" title="3. é£é™©åˆ†è§£ç»“æ„ï¼ˆRBSï¼‰"></a>3. é£é™©åˆ†è§£ç»“æ„ï¼ˆRBSï¼‰</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210906125409870.png" alt="image-20210906125409870"></p><h3 id="3ã€è¯†åˆ«é£é™©"><a href="#3ã€è¯†åˆ«é£é™©" class="headerlink" title="3ã€è¯†åˆ«é£é™©"></a>3ã€è¯†åˆ«é£é™©</h3><h4 id="1ï¼‰åŸºæœ¬çŸ¥è¯†"><a href="#1ï¼‰åŸºæœ¬çŸ¥è¯†" class="headerlink" title="1ï¼‰åŸºæœ¬çŸ¥è¯†"></a>1ï¼‰åŸºæœ¬çŸ¥è¯†</h4><h5 id="1-æ¦‚å¿µ"><a href="#1-æ¦‚å¿µ" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h5><ul><li>åˆ¤æ–­å“ªäº›é£é™©ä¼šå½±å“é¡¹ç›®ï¼Œå¹¶ä»¥ä¹¦é¢å½¢å¼è®°å½•å…¶ç‰¹ç‚¹</li><li>é£é™©è¯†åˆ«æ˜¯ä¸€ä¸ªåå¤çš„è¿‡ç¨‹ï¼Œè´¯å½»æ•´ä¸ªé¡¹ç›®ç”Ÿå‘½å‘¨æœŸï¼Œå³ä½¿é¡¹ç›®å¿«è¦ç»“æŸäº†ï¼Œä¹Ÿå¯èƒ½å‡ºç°æ–°çš„é£é™©ï¼Œæ‰€ä»¥è¦ä¸æ–­çš„è¯†åˆ«é£é™©</li></ul><h5 id="2-é£é™©è¯†åˆ«çš„ç‰¹ç‚¹ï¼š"><a href="#2-é£é™©è¯†åˆ«çš„ç‰¹ç‚¹ï¼š" class="headerlink" title="2. é£é™©è¯†åˆ«çš„ç‰¹ç‚¹ï¼š"></a>2. é£é™©è¯†åˆ«çš„ç‰¹ç‚¹ï¼š</h5><ul><li>å…¨å‘˜æ€§</li><li>ç³»ç»Ÿæ€§</li><li>åŠ¨æ€æ€§</li><li>ä¿¡æ¯ä¾èµ–æ€§</li><li>ç»¼åˆæ€§</li></ul><h5 id="3-é‡è¦æ³¨æ„äº‹é¡¹"><a href="#3-é‡è¦æ³¨æ„äº‹é¡¹" class="headerlink" title="3. é‡è¦æ³¨æ„äº‹é¡¹"></a>3. é‡è¦æ³¨æ„äº‹é¡¹</h5><ul><li>ä¸è¦é—æ¼é‡è¦é£é™©</li><li>ä¸å¯èƒ½è¯†åˆ«æ‰€æœ‰é£é™©</li><li>é£é™©è¯†åˆ«çš„è¯¦å°½ç¨‹åº¦ä¸é¡¹ç›®çš„é¢„ç®—æœ‰å…³</li><li>é£é™©è¯†åˆ«çš„è¯¦å°½ç¨‹åº¦ä¸é¡¹ç›®çš„é‡è¦æ€§æœ‰å…³</li></ul><h4 id="2ï¼‰è¾“å…¥"><a href="#2ï¼‰è¾“å…¥" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é£é™©ã€æˆæœ¬ã€è¿›åº¦ã€äººåŠ›èµ„æºç®¡ç†è®¡åˆ’"><a href="#1-é£é™©ã€æˆæœ¬ã€è¿›åº¦ã€äººåŠ›èµ„æºç®¡ç†è®¡åˆ’" class="headerlink" title="1. é£é™©ã€æˆæœ¬ã€è¿›åº¦ã€äººåŠ›èµ„æºç®¡ç†è®¡åˆ’"></a>1. é£é™©ã€æˆæœ¬ã€è¿›åº¦ã€äººåŠ›èµ„æºç®¡ç†è®¡åˆ’</h5><h5 id="2-èŒƒå›´åŸºå‡†"><a href="#2-èŒƒå›´åŸºå‡†" class="headerlink" title="2. èŒƒå›´åŸºå‡†"></a>2. èŒƒå›´åŸºå‡†</h5><h5 id="3-æ´»åŠ¨æˆæœ¬ä¼°ç®—å’Œæ´»åŠ¨æ—¶é—´ä¼°ç®—"><a href="#3-æ´»åŠ¨æˆæœ¬ä¼°ç®—å’Œæ´»åŠ¨æ—¶é—´ä¼°ç®—" class="headerlink" title="3. æ´»åŠ¨æˆæœ¬ä¼°ç®—å’Œæ´»åŠ¨æ—¶é—´ä¼°ç®—"></a>3. æ´»åŠ¨æˆæœ¬ä¼°ç®—å’Œæ´»åŠ¨æ—¶é—´ä¼°ç®—</h5><h5 id="4-å¹²ç³»äººç™»è®°å†Œ"><a href="#4-å¹²ç³»äººç™»è®°å†Œ" class="headerlink" title="4. å¹²ç³»äººç™»è®°å†Œ"></a>4. å¹²ç³»äººç™»è®°å†Œ</h5><h5 id="5-é¡¹ç›®æ–‡ä»¶"><a href="#5-é¡¹ç›®æ–‡ä»¶" class="headerlink" title="5. é¡¹ç›®æ–‡ä»¶"></a>5. é¡¹ç›®æ–‡ä»¶</h5><h5 id="6-é‡‡è´­æ–‡ä»¶"><a href="#6-é‡‡è´­æ–‡ä»¶" class="headerlink" title="6. é‡‡è´­æ–‡ä»¶"></a>6. é‡‡è´­æ–‡ä»¶</h5><h5 id="7-äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#7-äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="7. äº‹ä¸šç¯å¢ƒå› ç´ "></a>7. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="8-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#8-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="8. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>8. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·ä¸æŠ€æœ¯"><a href="#3ï¼‰å·¥å…·ä¸æŠ€æœ¯" class="headerlink" title="3ï¼‰å·¥å…·ä¸æŠ€æœ¯"></a>3ï¼‰å·¥å…·ä¸æŠ€æœ¯</h4><h5 id="1-æ–‡æ¡£å®¡æŸ¥"><a href="#1-æ–‡æ¡£å®¡æŸ¥" class="headerlink" title="1. æ–‡æ¡£å®¡æŸ¥"></a>1. æ–‡æ¡£å®¡æŸ¥</h5><h5 id="2-ä¿¡æ¯æ”¶é›†æŠ€æœ¯"><a href="#2-ä¿¡æ¯æ”¶é›†æŠ€æœ¯" class="headerlink" title="2. ä¿¡æ¯æ”¶é›†æŠ€æœ¯"></a>2. ä¿¡æ¯æ”¶é›†æŠ€æœ¯</h5><ul><li>å¾·å°”è²æŠ€æœ¯ï¼ˆåŒ¿åæŠ•ç¥¨ï¼‰</li><li>å¤´è„‘é£æš´</li><li>è®¿è°ˆ</li><li>æ ¹æœ¬åŸå› è¯†åˆ«</li></ul><h5 id="3-æ ¸å¯¹è¡¨åˆ†æ"><a href="#3-æ ¸å¯¹è¡¨åˆ†æ" class="headerlink" title="3. æ ¸å¯¹è¡¨åˆ†æ"></a>3. æ ¸å¯¹è¡¨åˆ†æ</h5><h5 id="4-å‡è®¾åˆ†æ"><a href="#4-å‡è®¾åˆ†æ" class="headerlink" title="4. å‡è®¾åˆ†æ"></a>4. å‡è®¾åˆ†æ</h5><h5 id="5-å›¾è¡¨åˆ†æ"><a href="#5-å›¾è¡¨åˆ†æ" class="headerlink" title="5. å›¾è¡¨åˆ†æ"></a>5. å›¾è¡¨åˆ†æ</h5><ul><li>å› æœå›¾</li><li>ç³»ç»Ÿæˆ–è¿‡ç¨‹æµç¨‹å›¾</li><li>å½±å“å›¾</li></ul><h5 id="6-SWOT-åˆ†æï¼ˆâš ï¸æ˜¯é£é™©è¯†åˆ«çš„æ–¹æ³•ï¼‰"><a href="#6-SWOT-åˆ†æï¼ˆâš ï¸æ˜¯é£é™©è¯†åˆ«çš„æ–¹æ³•ï¼‰" class="headerlink" title="6. SWOT åˆ†æï¼ˆâš ï¸æ˜¯é£é™©è¯†åˆ«çš„æ–¹æ³•ï¼‰"></a>6. SWOT åˆ†æï¼ˆâš ï¸æ˜¯é£é™©è¯†åˆ«çš„æ–¹æ³•ï¼‰</h5><ul><li>å†…éƒ¨å› ç´ <ul><li>Sï¼šä¼˜åŠ¿</li><li>Wï¼šåŠ£åŠ¿</li></ul></li><li>å¤–éƒ¨å› ç´ <ul><li>Oï¼šæœºé‡</li><li>Tï¼šå¨èƒ</li></ul></li></ul><h5 id="7-ä¸“å®¶åˆ¤æ–­"><a href="#7-ä¸“å®¶åˆ¤æ–­" class="headerlink" title="7. ä¸“å®¶åˆ¤æ–­"></a>7. ä¸“å®¶åˆ¤æ–­</h5><h4 id="4ï¼‰è¾“å‡º"><a href="#4ï¼‰è¾“å‡º" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-é£é™©ç™»è®°å†Œ"><a href="#1-é£é™©ç™»è®°å†Œ" class="headerlink" title="1. é£é™©ç™»è®°å†Œ"></a>1. é£é™©ç™»è®°å†Œ</h5><h4 id="5ï¼‰é£é™©ç™»è®°å†Œ"><a href="#5ï¼‰é£é™©ç™»è®°å†Œ" class="headerlink" title="5ï¼‰é£é™©ç™»è®°å†Œ"></a>5ï¼‰é£é™©ç™»è®°å†Œ</h4><h5 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210907125036468.png" alt="image-20210907125036468"></p><h3 id="3ã€é£é™©çš„å®šæ€§åˆ†æ"><a href="#3ã€é£é™©çš„å®šæ€§åˆ†æ" class="headerlink" title="3ã€é£é™©çš„å®šæ€§åˆ†æ"></a>3ã€é£é™©çš„å®šæ€§åˆ†æ</h3><h4 id="1ï¼‰æ¦‚å¿µ-1"><a href="#1ï¼‰æ¦‚å¿µ-1" class="headerlink" title="1ï¼‰æ¦‚å¿µ"></a>1ï¼‰æ¦‚å¿µ</h4><ul><li><p>å¯¹é£é™©æ¦‚ç‡å’Œå½±å“è¿›è¡Œè¯„ä¼°å’Œæ±‡æ€»ï¼Œå¹¶è¿›è¡Œæ’åºï¼Œä»¥ä¾¿éšåè¿›ä¸€æ­¥åˆ†ææˆ–è¡ŒåŠ¨</p></li><li><p>è¦å¯¹æ‰€æœ‰è¯†åˆ«å‡ºçš„é£é™©è¿›è¡Œå®šæ€§åˆ†æ</p></li></ul><h4 id="2ï¼‰è¾“å…¥-1"><a href="#2ï¼‰è¾“å…¥-1" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é£é™©ç®¡ç†è®¡åˆ’"><a href="#1-é£é™©ç®¡ç†è®¡åˆ’" class="headerlink" title="1. é£é™©ç®¡ç†è®¡åˆ’"></a>1. é£é™©ç®¡ç†è®¡åˆ’</h5><h5 id="2-èŒƒå›´åŸºå‡†-1"><a href="#2-èŒƒå›´åŸºå‡†-1" class="headerlink" title="2. èŒƒå›´åŸºå‡†"></a>2. èŒƒå›´åŸºå‡†</h5><h5 id="3-é£é™©ç™»è®°å†Œ"><a href="#3-é£é™©ç™»è®°å†Œ" class="headerlink" title="3. é£é™©ç™»è®°å†Œ"></a>3. é£é™©ç™»è®°å†Œ</h5><h5 id="4-äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#4-äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="4. äº‹ä¸šç¯å¢ƒå› ç´ "></a>4. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="5-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#5-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="5. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>5. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·ä¸æŠ€æœ¯-1"><a href="#3ï¼‰å·¥å…·ä¸æŠ€æœ¯-1" class="headerlink" title="3ï¼‰å·¥å…·ä¸æŠ€æœ¯"></a>3ï¼‰å·¥å…·ä¸æŠ€æœ¯</h4><h5 id="1-é£é™©æ¦‚ç‡å½±å“è¯„ä¼°"><a href="#1-é£é™©æ¦‚ç‡å½±å“è¯„ä¼°" class="headerlink" title="1. é£é™©æ¦‚ç‡å½±å“è¯„ä¼°"></a>1. é£é™©æ¦‚ç‡å½±å“è¯„ä¼°</h5><ul><li>å°†é£é™©è¯†åˆ«ä¸ºé«˜ä¸­ä½</li></ul><h5 id="2-æ¦‚ç‡å’Œå½±å“çŸ©é˜µ"><a href="#2-æ¦‚ç‡å’Œå½±å“çŸ©é˜µ" class="headerlink" title="2. æ¦‚ç‡å’Œå½±å“çŸ©é˜µ"></a>2. æ¦‚ç‡å’Œå½±å“çŸ©é˜µ</h5><ul><li>æ·±ç°ï¼šé«˜é£é™©</li><li>æµ…ç°ï¼šä¸­é£é™©</li><li>æ— è‰²ï¼šä½é£é™©</li></ul><h5 id="3-é£é™©æ•°æ®è´¨é‡è¯„ä¼°"><a href="#3-é£é™©æ•°æ®è´¨é‡è¯„ä¼°" class="headerlink" title="3. é£é™©æ•°æ®è´¨é‡è¯„ä¼°"></a>3. é£é™©æ•°æ®è´¨é‡è¯„ä¼°</h5><h5 id="4-é£é™©åˆ†ç±»"><a href="#4-é£é™©åˆ†ç±»" class="headerlink" title="4. é£é™©åˆ†ç±»"></a>4. é£é™©åˆ†ç±»</h5><h5 id="5-é£é™©ç´§è¿«æ€§è¯„ä¼°"><a href="#5-é£é™©ç´§è¿«æ€§è¯„ä¼°" class="headerlink" title="5. é£é™©ç´§è¿«æ€§è¯„ä¼°"></a>5. é£é™©ç´§è¿«æ€§è¯„ä¼°</h5><h5 id="6-ä¸“å®¶åˆ¤æ–­"><a href="#6-ä¸“å®¶åˆ¤æ–­" class="headerlink" title="6. ä¸“å®¶åˆ¤æ–­"></a>6. ä¸“å®¶åˆ¤æ–­</h5><h4 id="4ï¼‰è¾“å‡º-1"><a href="#4ï¼‰è¾“å‡º-1" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-é¡¹ç›®æ–‡ä»¶æ›´æ–°"><a href="#1-é¡¹ç›®æ–‡ä»¶æ›´æ–°" class="headerlink" title="1. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>1. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><ul><li>é£é™©ç™»è®°å†Œï¼ˆå°†å·²è¯†åˆ«çš„é£é™©è¿›è¡Œé«˜ä¸­ä½æ’åºï¼‰</li><li>å‡è®¾æ¡ä»¶æ—¥å¿—</li></ul><h4 id="5ï¼‰é£é™©çš„æ¦‚ç‡å’Œå½±å“çŸ©é˜µ"><a href="#5ï¼‰é£é™©çš„æ¦‚ç‡å’Œå½±å“çŸ©é˜µ" class="headerlink" title="5ï¼‰é£é™©çš„æ¦‚ç‡å’Œå½±å“çŸ©é˜µ"></a>5ï¼‰é£é™©çš„æ¦‚ç‡å’Œå½±å“çŸ©é˜µ</h4><h5 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li><p>æ ¹æ®é£é™©å¯èƒ½å¯¹å®ç°é¡¹ç›®ç›®æ ‡äº§ç”Ÿçš„å½±å“ï¼Œè¿›è¡Œ<strong>é£é™©ä¼˜å…ˆæ’åº</strong>ã€‚</p></li><li><p>é£é™©å€¼ = é£é™©å‘ç”Ÿçš„æ¦‚ç‡ * é£é™©å‘ç”Ÿçš„åæœ</p></li><li><p><strong>è™½ç„¶çŸ©é˜µä¸­æœ‰æ•°å­—ï¼Œä½†æ˜¯è¦è¡¨é¢çš„æ˜¯é£é™©çš„é«˜ä½ç¨‹åº¦ï¼Œæ•…æ˜¯é£é™©çš„å®šæ€§åˆ†æ</strong></p></li></ul><h5 id="2-çŸ©é˜µå›¾ç¤ºä¾‹"><a href="#2-çŸ©é˜µå›¾ç¤ºä¾‹" class="headerlink" title="2. çŸ©é˜µå›¾ç¤ºä¾‹"></a>2. çŸ©é˜µå›¾ç¤ºä¾‹</h5><h5 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210907124751275.png" alt="image-20210907124751275"></h5><h5 id="3-åº”å¯¹ç­–ç•¥"><a href="#3-åº”å¯¹ç­–ç•¥" class="headerlink" title="3. åº”å¯¹ç­–ç•¥"></a>3. åº”å¯¹ç­–ç•¥</h5><h6 id="é«˜é£é™©ï¼š"><a href="#é«˜é£é™©ï¼š" class="headerlink" title="é«˜é£é™©ï¼š"></a>é«˜é£é™©ï¼š</h6><ul><li>é‡‡å–ç§¯æç­–ç•¥ï¼Œä¸»åŠ¨æ€§æµ‹è¯•ï¼Œä»£ä»·å¤§äºå¯æ¥å—ï¼Œæ”¾å¼ƒ</li></ul><h6 id="ä¸­é£é™©ï¼š"><a href="#ä¸­é£é™©ï¼š" class="headerlink" title="ä¸­é£é™©ï¼š"></a>ä¸­é£é™©ï¼š</h6><ul><li>é‡‡å–ç§¯æç­–ç•¥ï¼Œä¸»åŠ¨æ€§æµ‹è¯•ï¼Œä»£ä»·å¤§äºå¯æ¥å—ï¼Œæ¥å—</li></ul><h6 id="ä½é£é™©ï¼š"><a href="#ä½é£é™©ï¼š" class="headerlink" title="ä½é£é™©ï¼š"></a>ä½é£é™©ï¼š</h6><ul><li>æ”¾å…¥å¾…è§‚å¯Ÿæ¸…å•ï¼Œå¢åŠ ä¸€å®šçš„åº”æ€¥å‚¨å¤‡</li></ul><h4 id="6ï¼‰é£é™©æ•°æ®è´¨é‡è¯„ä¼°"><a href="#6ï¼‰é£é™©æ•°æ®è´¨é‡è¯„ä¼°" class="headerlink" title="6ï¼‰é£é™©æ•°æ®è´¨é‡è¯„ä¼°"></a>6ï¼‰é£é™©æ•°æ®è´¨é‡è¯„ä¼°</h4><h5 id="1-å®šä¹‰-1"><a href="#1-å®šä¹‰-1" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><p>è¯„ä¼°æœ‰å…³é£é™©çš„æ•°æ®å¯¹é£é™©ç®¡ç†æœ‰ç”¨ç¨‹åº¦çš„ä¸€ç§æŠ€æœ¯ï¼Œ</p><h5 id="2-å†…å®¹"><a href="#2-å†…å®¹" class="headerlink" title="2. å†…å®¹"></a>2. å†…å®¹</h5><p>æ£€æŸ¥å¯¹é£é™©ç†è§£ç¨‹åº¦ä»¥åŠé£é™©æ•°æ®çš„å‡†ç¡®æ€§ã€è´¨é‡ã€å¯é æ€§å’Œå®Œæ•´æ€§</p><h4 id="7ï¼‰é£é™©ç´§è¿«æ€§è¯„ä¼°"><a href="#7ï¼‰é£é™©ç´§è¿«æ€§è¯„ä¼°" class="headerlink" title="7ï¼‰é£é™©ç´§è¿«æ€§è¯„ä¼°"></a>7ï¼‰é£é™©ç´§è¿«æ€§è¯„ä¼°</h4><h5 id="1-å®šä¹‰-2"><a href="#1-å®šä¹‰-2" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><p>è¯†åˆ«æ€¥éœ€è§£å†³çš„é£é™©ï¼ˆéœ€è¦è¿‘æœŸé‡‡å–åº”å¯¹æªæ–½çš„é£é™©ï¼‰</p><h5 id="2-æŒ‡æ ‡"><a href="#2-æŒ‡æ ‡" class="headerlink" title="2. æŒ‡æ ‡"></a>2. æŒ‡æ ‡</h5><ul><li>é£é™©åº”å¯¹æªæ–½æ‰€éœ€çš„æ—¶é—´</li><li>é£é™©å¾å…†</li><li>è­¦å‘Š</li><li>é£é™©ç­‰çº§</li></ul><h3 id="4ã€é£é™©çš„å®šé‡åˆ†æ"><a href="#4ã€é£é™©çš„å®šé‡åˆ†æ" class="headerlink" title="4ã€é£é™©çš„å®šé‡åˆ†æ"></a>4ã€é£é™©çš„å®šé‡åˆ†æ</h3><h4 id="1ï¼‰æ¦‚å¿µ-2"><a href="#1ï¼‰æ¦‚å¿µ-2" class="headerlink" title="1ï¼‰æ¦‚å¿µ"></a>1ï¼‰æ¦‚å¿µ</h4><ul><li>å°±è¯†åˆ«çš„é£é™©å¯¹é¡¹ç›®æ€»ä½“ç›®æ ‡çš„å½±å“è¿›è¡Œé‡åŒ–</li><li>å°†å®šæ€§åˆ†æå‡ºé£é™©è¾ƒé«˜ä¸”æœ‰æ•°å­—çš„é£é™©è¿›è¡Œå®šé‡åˆ†æ</li></ul><h4 id="2ï¼‰è¾“å…¥-2"><a href="#2ï¼‰è¾“å…¥-2" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é£é™©ã€æˆæœ¬ã€è¿›åº¦ç®¡ç†è®¡åˆ’"><a href="#1-é£é™©ã€æˆæœ¬ã€è¿›åº¦ç®¡ç†è®¡åˆ’" class="headerlink" title="1. é£é™©ã€æˆæœ¬ã€è¿›åº¦ç®¡ç†è®¡åˆ’"></a>1. é£é™©ã€æˆæœ¬ã€è¿›åº¦ç®¡ç†è®¡åˆ’</h5><h5 id="2-é£é™©ç™»è®°å†Œ"><a href="#2-é£é™©ç™»è®°å†Œ" class="headerlink" title="2. é£é™©ç™»è®°å†Œ"></a>2. é£é™©ç™»è®°å†Œ</h5><h5 id="3-äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#3-äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="3. äº‹ä¸šç¯å¢ƒå› ç´ "></a>3. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="4-ç»„ç»‡è¿‡ç¨‹èµ„äº§-1"><a href="#4-ç»„ç»‡è¿‡ç¨‹èµ„äº§-1" class="headerlink" title="4. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>4. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·ä¸æŠ€æœ¯-2"><a href="#3ï¼‰å·¥å…·ä¸æŠ€æœ¯-2" class="headerlink" title="3ï¼‰å·¥å…·ä¸æŠ€æœ¯"></a>3ï¼‰å·¥å…·ä¸æŠ€æœ¯</h4><h5 id="1-æ•°æ®æ”¶é›†å’Œå±•ç¤ºæŠ€æœ¯"><a href="#1-æ•°æ®æ”¶é›†å’Œå±•ç¤ºæŠ€æœ¯" class="headerlink" title="1. æ•°æ®æ”¶é›†å’Œå±•ç¤ºæŠ€æœ¯"></a>1. æ•°æ®æ”¶é›†å’Œå±•ç¤ºæŠ€æœ¯</h5><h5 id="2-é£é™©å®šé‡åˆ†æå’Œå»ºæ¨¡æŠ€æœ¯"><a href="#2-é£é™©å®šé‡åˆ†æå’Œå»ºæ¨¡æŠ€æœ¯" class="headerlink" title="2. é£é™©å®šé‡åˆ†æå’Œå»ºæ¨¡æŠ€æœ¯"></a>2. é£é™©å®šé‡åˆ†æå’Œå»ºæ¨¡æŠ€æœ¯</h5><h5 id="3-ä¸“å®¶åˆ¤æ–­"><a href="#3-ä¸“å®¶åˆ¤æ–­" class="headerlink" title="3. ä¸“å®¶åˆ¤æ–­"></a>3. ä¸“å®¶åˆ¤æ–­</h5><h4 id="4ï¼‰è¾“å‡º-2"><a href="#4ï¼‰è¾“å‡º-2" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-é¡¹ç›®æ–‡ä»¶æ›´æ–°-1"><a href="#1-é¡¹ç›®æ–‡ä»¶æ›´æ–°-1" class="headerlink" title="1. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>1. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><ul><li>é£é™©ç™»è®°å†Œï¼ˆå°†é£é™©æŒ‰ç…§æ•°å€¼å¤§å°è¿›è¡Œæ’åºï¼‰</li></ul><h4 id="5ï¼‰æ•°æ®æ”¶é›†å’Œå±•ç¤ºæŠ€æœ¯"><a href="#5ï¼‰æ•°æ®æ”¶é›†å’Œå±•ç¤ºæŠ€æœ¯" class="headerlink" title="5ï¼‰æ•°æ®æ”¶é›†å’Œå±•ç¤ºæŠ€æœ¯"></a>5ï¼‰æ•°æ®æ”¶é›†å’Œå±•ç¤ºæŠ€æœ¯</h4><h5 id="1-è®¿è°ˆ"><a href="#1-è®¿è°ˆ" class="headerlink" title="1. è®¿è°ˆ"></a>1. è®¿è°ˆ</h5><p>é€šè¿‡è°ˆè¯ç¡®è®¤æœ‰å¤šå°‘äººè®¤ä¸ºè¯¥é£é™©ä¸ºé«˜ï¼Œæœ‰å¤šå°‘äººè®¤ä¸ºè¯¥åˆ†æä¸ºä½</p><h5 id="2-æ¦‚ç‡åˆ†å¸ƒ"><a href="#2-æ¦‚ç‡åˆ†å¸ƒ" class="headerlink" title="2. æ¦‚ç‡åˆ†å¸ƒ"></a>2. æ¦‚ç‡åˆ†å¸ƒ</h5><p>ä¸‰ç‚¹ä¼°ç®—æ³•</p><h4 id="6ï¼‰é£é™©å®šé‡åˆ†æå’Œå»ºæ¨¡æŠ€æœ¯"><a href="#6ï¼‰é£é™©å®šé‡åˆ†æå’Œå»ºæ¨¡æŠ€æœ¯" class="headerlink" title="6ï¼‰é£é™©å®šé‡åˆ†æå’Œå»ºæ¨¡æŠ€æœ¯"></a>6ï¼‰é£é™©å®šé‡åˆ†æå’Œå»ºæ¨¡æŠ€æœ¯</h4><h5 id="1-é¢„æœŸè´§å¸ä»·å€¼åˆ†æï¼ˆEMVï¼‰"><a href="#1-é¢„æœŸè´§å¸ä»·å€¼åˆ†æï¼ˆEMVï¼‰" class="headerlink" title="1. é¢„æœŸè´§å¸ä»·å€¼åˆ†æï¼ˆEMVï¼‰"></a>1. é¢„æœŸè´§å¸ä»·å€¼åˆ†æï¼ˆEMVï¼‰</h5><ul><li>æ˜¯ä¸€ä¸ªç»Ÿè®¡æ¦‚å¿µï¼Œæ˜¯å¯¹ä¸ç¡®å®šæ€§çš„åˆ†æ</li><li>ç”¨äºè®¡ç®—åœ¨å°†æ¥æŸç§æƒ…å†µå‘ç”Ÿæˆ–ä¸å‘ç”Ÿçš„æƒ…å†µä¸‹çš„å¹³å‡ç»“æœ</li></ul><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210906225858597.png" alt="image-20210906225858597"></p><blockquote><p>ğŸš© ç™¾åˆ†æ¯” * æ”¶ç›Š + ç™¾åˆ†æ¯” * æŸå¤±ï¼Œç„¶åé€‰æ‹©æ”¶ç›Šåšé«˜æˆ–è€…æŸå¤±æœ€ä½çš„æ–¹æ¡ˆ </p></blockquote><h5 id="2-æ•æ„Ÿæ€§åˆ†æ"><a href="#2-æ•æ„Ÿæ€§åˆ†æ" class="headerlink" title="2. æ•æ„Ÿæ€§åˆ†æ"></a>2. æ•æ„Ÿæ€§åˆ†æ</h5><ul><li>ç¡®å®šå“ªäº›é£é™©å¯¹é¡¹ç›®å…·æœ‰æœ€å¤§çš„æ½œåœ¨å½±å“ï¼Œ </li></ul><h5 id="3-æ¨¡æ‹Ÿå’Œå»ºæ¨¡-â€”â€”-è’™ç‰¹å¡æ´›æŠ€æœ¯"><a href="#3-æ¨¡æ‹Ÿå’Œå»ºæ¨¡-â€”â€”-è’™ç‰¹å¡æ´›æŠ€æœ¯" class="headerlink" title="3. æ¨¡æ‹Ÿå’Œå»ºæ¨¡ â€”â€” è’™ç‰¹å¡æ´›æŠ€æœ¯"></a>3. æ¨¡æ‹Ÿå’Œå»ºæ¨¡ â€”â€” è’™ç‰¹å¡æ´›æŠ€æœ¯</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210906225630661.png" alt="image-20210906225630661"></p><h3 id="4ã€è§„åˆ’é£é™©åº”å¯¹"><a href="#4ã€è§„åˆ’é£é™©åº”å¯¹" class="headerlink" title="4ã€è§„åˆ’é£é™©åº”å¯¹"></a>4ã€è§„åˆ’é£é™©åº”å¯¹</h3><h4 id="1ï¼‰æ¦‚å¿µ-3"><a href="#1ï¼‰æ¦‚å¿µ-3" class="headerlink" title="1ï¼‰æ¦‚å¿µ"></a>1ï¼‰æ¦‚å¿µ</h4><p>é’ˆå¯¹é¡¹ç›®ç›®æ ‡åˆ¶è®¢æé«˜æœºä¼šã€é™ä½å¨èƒçš„æ–¹æ¡ˆå’Œè¡ŒåŠ¨</p><h4 id="2ï¼‰è¾“å…¥-3"><a href="#2ï¼‰è¾“å…¥-3" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é£é™©ç®¡ç†è®¡åˆ’-1"><a href="#1-é£é™©ç®¡ç†è®¡åˆ’-1" class="headerlink" title="1. é£é™©ç®¡ç†è®¡åˆ’"></a>1. é£é™©ç®¡ç†è®¡åˆ’</h5><h5 id="2-é£é™©ç­‰çº§å†Œ"><a href="#2-é£é™©ç­‰çº§å†Œ" class="headerlink" title="2. é£é™©ç­‰çº§å†Œ"></a>2. é£é™©ç­‰çº§å†Œ</h5><h4 id="3ï¼‰å·¥å…·ä¸æŠ€æœ¯-3"><a href="#3ï¼‰å·¥å…·ä¸æŠ€æœ¯-3" class="headerlink" title="3ï¼‰å·¥å…·ä¸æŠ€æœ¯"></a>3ï¼‰å·¥å…·ä¸æŠ€æœ¯</h4><h5 id="1-æ¶ˆæé£é™©æˆ–å¨èƒåº”å¯¹ç­–ç•¥"><a href="#1-æ¶ˆæé£é™©æˆ–å¨èƒåº”å¯¹ç­–ç•¥" class="headerlink" title="1. æ¶ˆæé£é™©æˆ–å¨èƒåº”å¯¹ç­–ç•¥"></a>1. æ¶ˆæé£é™©æˆ–å¨èƒåº”å¯¹ç­–ç•¥</h5><h5 id="2-ç§¯æé£é™©æˆ–æœºä¼šåº”å¯¹ç­–ç•¥"><a href="#2-ç§¯æé£é™©æˆ–æœºä¼šåº”å¯¹ç­–ç•¥" class="headerlink" title="2. ç§¯æé£é™©æˆ–æœºä¼šåº”å¯¹ç­–ç•¥"></a>2. ç§¯æé£é™©æˆ–æœºä¼šåº”å¯¹ç­–ç•¥</h5><h5 id="3-åº”æ€¥åº”å¯¹ç­–ç•¥"><a href="#3-åº”æ€¥åº”å¯¹ç­–ç•¥" class="headerlink" title="3. åº”æ€¥åº”å¯¹ç­–ç•¥"></a>3. åº”æ€¥åº”å¯¹ç­–ç•¥</h5><h5 id="4-ä¸“å®¶åˆ¤æ–­"><a href="#4-ä¸“å®¶åˆ¤æ–­" class="headerlink" title="4. ä¸“å®¶åˆ¤æ–­"></a>4. ä¸“å®¶åˆ¤æ–­</h5><h4 id="4ï¼‰è¾“å‡º-3"><a href="#4ï¼‰è¾“å‡º-3" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</h5><h5 id="2-é¡¹ç›®æ–‡ä»¶æ›´æ–°"><a href="#2-é¡¹ç›®æ–‡ä»¶æ›´æ–°" class="headerlink" title="2. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>2. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h4 id="5ï¼‰æ¶ˆæé£é™©æˆ–å¨èƒçš„åº”å¯¹ç­–ç•¥ï¼ˆ-ï¼‰"><a href="#5ï¼‰æ¶ˆæé£é™©æˆ–å¨èƒçš„åº”å¯¹ç­–ç•¥ï¼ˆ-ï¼‰" class="headerlink" title="5ï¼‰æ¶ˆæé£é™©æˆ–å¨èƒçš„åº”å¯¹ç­–ç•¥ï¼ˆ***ï¼‰"></a>5ï¼‰æ¶ˆæé£é™©æˆ–å¨èƒçš„åº”å¯¹ç­–ç•¥ï¼ˆ***ï¼‰</h4><h5 id="1-å›é¿"><a href="#1-å›é¿" class="headerlink" title="1. å›é¿"></a>1. å›é¿</h5><ul><li>æ”¹è®¡åˆ’ã€ä¿ç›®æ ‡ã€æ”¾æ¾è¦æ±‚</li><li>ä¾‹å¦‚ï¼š<strong>å»¶é•¿è¿›åº¦ã€å‡å°‘èŒƒå›´</strong>ï¼ˆå»æ‰WBSä¸­æœ‰é£é™©é¢å·¥ä½œåŒ…æˆ–ç”±ç¬¬ä¸‰æ–¹æ¥æ¶ˆé™¤ï¼‰</li></ul><h5 id="2-è½¬ç§»"><a href="#2-è½¬ç§»" class="headerlink" title="2. è½¬ç§»"></a>2. è½¬ç§»</h5><ul><li>è½¬ç»™ç¬¬ä¸‰æ–¹</li><li>ä¾‹å¦‚ï¼š<strong>ä¿é™©ã€ä¿è¯ä¹¦ã€æˆæœ¬åŠ é…¬é‡‘ã€å›ºå®šæ€»ä»·åˆåŒ</strong></li></ul><h5 id="3-å‡è½»"><a href="#3-å‡è½»" class="headerlink" title="3. å‡è½»"></a>3. å‡è½»</h5><ul><li>é™ä½åˆ°ä¸´ç•Œå€¼</li><li>ä¾‹å¦‚ï¼š<strong>å†—ä½™ã€æµ‹è¯•</strong>ï¼ˆé›‡ä½£æœ‰ç»éªŒçš„é›‡å‘˜ï¼Œæ›´å¤šçš„æµ‹è¯•ï¼‰</li></ul><h5 id="4-æ¥å—"><a href="#4-æ¥å—" class="headerlink" title="4. æ¥å—"></a>4. æ¥å—</h5><ul><li><strong>è¢«åŠ¨æ¥å—ï¼Œä¸é‡‡å–è¡ŒåŠ¨</strong></li></ul><h4 id="6ï¼‰ç§¯æé£é™©æˆ–å¨èƒçš„åº”å¯¹ç­–ç•¥ï¼ˆ-ï¼‰"><a href="#6ï¼‰ç§¯æé£é™©æˆ–å¨èƒçš„åº”å¯¹ç­–ç•¥ï¼ˆ-ï¼‰" class="headerlink" title="6ï¼‰ç§¯æé£é™©æˆ–å¨èƒçš„åº”å¯¹ç­–ç•¥ï¼ˆ***ï¼‰"></a>6ï¼‰ç§¯æé£é™©æˆ–å¨èƒçš„åº”å¯¹ç­–ç•¥ï¼ˆ***ï¼‰</h4><h5 id="1-å¼€æ‹“"><a href="#1-å¼€æ‹“" class="headerlink" title="1. å¼€æ‹“"></a>1. å¼€æ‹“</h5><ul><li>ç¡®ä¿æœºä¼šå®ç°</li><li>ä¾‹å¦‚: <strong>ä¸ºé¡¹ç›®åˆ†é…æ›´å¤šèµ„æº</strong>ï¼ˆåˆ†é…ç»„ç»‡ä¸­æœ€å¥½çš„èµ„æºï¼‰</li></ul><h5 id="2-åˆ†äº«"><a href="#2-åˆ†äº«" class="headerlink" title="2. åˆ†äº«"></a>2. åˆ†äº«</h5><ul><li>åˆ†äº«ç»™æœ€ä¼˜èƒ½åŠ›çš„ç¬¬ä¸‰æ–¹</li><li>ä¾‹å¦‚ï¼š<strong>åˆä½œã€åˆèµ„</strong>ï¼ˆæˆç«‹è”åˆä½“è¿›è¡ŒæŠ•æ ‡æˆ–ç»„å»ºåˆèµ„å…¬å¸ï¼‰</li></ul><h5 id="3-æé«˜"><a href="#3-æé«˜" class="headerlink" title="3. æé«˜"></a>3. æé«˜</h5><ul><li><strong>æé«˜å‡ ç‡ï¼Œè§¦å‘æ¦‚ç‡</strong>ï¼ˆä¸ºå°½æ—©å®Œæˆæ´»åŠ¨è€Œå¢åŠ èµ„æºï¼‰</li></ul><h5 id="4-æ¥å—-1"><a href="#4-æ¥å—-1" class="headerlink" title="4. æ¥å—"></a>4. æ¥å—</h5><ul><li><strong>ä¸»åŠ¨æ¥å—ï¼Œ åº”æ€¥å‚¨å¤‡</strong>ï¼ˆå®‰æ’èµ„æºï¼‰</li></ul><h3 id="5ã€æ§åˆ¶é£é™©"><a href="#5ã€æ§åˆ¶é£é™©" class="headerlink" title="5ã€æ§åˆ¶é£é™©"></a>5ã€æ§åˆ¶é£é™©</h3><h4 id="1ï¼‰æ¦‚å¿µ-4"><a href="#1ï¼‰æ¦‚å¿µ-4" class="headerlink" title="1ï¼‰æ¦‚å¿µ"></a>1ï¼‰æ¦‚å¿µ</h4><p>åœ¨æ•´ä¸ªé¡¹ç›®å‘¨æœŸå†…ï¼Œè·Ÿè¸ªå·²è¯†åˆ«çš„é£é™©ã€ç›‘æµ‹æ®‹ä½™é£é™©ã€è¯†åˆ«æ–°é£é™©å’Œå®æ–½é£é™©åº”å¯¹è®¡åˆ’ï¼Œå¹¶å¯¹å…¶æœ‰æ•ˆæ€§è¿›è¡Œè¯„ä¼°</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210907125633066.png" alt="image-20210907125633066"></p><h4 id="2ï¼‰è¾“å…¥-4"><a href="#2ï¼‰è¾“å…¥-4" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é£é™©ç®¡ç†è®¡åˆ’-2"><a href="#1-é£é™©ç®¡ç†è®¡åˆ’-2" class="headerlink" title="1. é£é™©ç®¡ç†è®¡åˆ’"></a>1. é£é™©ç®¡ç†è®¡åˆ’</h5><h5 id="2-é£é™©ç™»è®°å†Œ-1"><a href="#2-é£é™©ç™»è®°å†Œ-1" class="headerlink" title="2. é£é™©ç™»è®°å†Œ"></a>2. é£é™©ç™»è®°å†Œ</h5><h5 id="3-å·¥ä½œç»©æ•ˆæ•°æ®"><a href="#3-å·¥ä½œç»©æ•ˆæ•°æ®" class="headerlink" title="3. å·¥ä½œç»©æ•ˆæ•°æ®"></a>3. å·¥ä½œç»©æ•ˆæ•°æ®</h5><h5 id="4-å·¥ä½œç»©æ•ˆæŠ¥å‘Š"><a href="#4-å·¥ä½œç»©æ•ˆæŠ¥å‘Š" class="headerlink" title="4. å·¥ä½œç»©æ•ˆæŠ¥å‘Š"></a>4. å·¥ä½œç»©æ•ˆæŠ¥å‘Š</h5><h4 id="3ï¼‰å·¥å…·ä¸æŠ€æœ¯-4"><a href="#3ï¼‰å·¥å…·ä¸æŠ€æœ¯-4" class="headerlink" title="3ï¼‰å·¥å…·ä¸æŠ€æœ¯"></a>3ï¼‰å·¥å…·ä¸æŠ€æœ¯</h4><h5 id="1-é£é™©å†è¯„ä¼°"><a href="#1-é£é™©å†è¯„ä¼°" class="headerlink" title="1. é£é™©å†è¯„ä¼°"></a>1. é£é™©å†è¯„ä¼°</h5><h5 id="2-é£é™©å®¡è®¡"><a href="#2-é£é™©å®¡è®¡" class="headerlink" title="2. é£é™©å®¡è®¡"></a>2. é£é™©å®¡è®¡</h5><h5 id="3-åå·®å’Œè¶‹åŠ¿åˆ†æ"><a href="#3-åå·®å’Œè¶‹åŠ¿åˆ†æ" class="headerlink" title="3. åå·®å’Œè¶‹åŠ¿åˆ†æ"></a>3. åå·®å’Œè¶‹åŠ¿åˆ†æ</h5><h5 id="4-æŠ€æœ¯ç»©æ•ˆæµ‹é‡"><a href="#4-æŠ€æœ¯ç»©æ•ˆæµ‹é‡" class="headerlink" title="4. æŠ€æœ¯ç»©æ•ˆæµ‹é‡"></a>4. æŠ€æœ¯ç»©æ•ˆæµ‹é‡</h5><h5 id="5-å‚¨å¤‡åˆ†æ"><a href="#5-å‚¨å¤‡åˆ†æ" class="headerlink" title="5. å‚¨å¤‡åˆ†æ"></a>5. å‚¨å¤‡åˆ†æ</h5><h5 id="6-ä¼šè®®"><a href="#6-ä¼šè®®" class="headerlink" title="6. ä¼šè®®"></a>6. ä¼šè®®</h5><h4 id="4ï¼‰è¾“å‡º-4"><a href="#4ï¼‰è¾“å‡º-4" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°-1"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°-1" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</h5><h5 id="2-é¡¹ç›®æ–‡ä»¶æ›´æ–°-1"><a href="#2-é¡¹ç›®æ–‡ä»¶æ›´æ–°-1" class="headerlink" title="2. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>2. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h4 id="5ï¼‰é£é™©å®¡è®¡"><a href="#5ï¼‰é£é™©å®¡è®¡" class="headerlink" title="5ï¼‰é£é™©å®¡è®¡"></a>5ï¼‰é£é™©å®¡è®¡</h4><h5 id="1-å†…å®¹"><a href="#1-å†…å®¹" class="headerlink" title="1. å†…å®¹"></a>1. å†…å®¹</h5><ul><li><p>ç›‘æ§è¿‡ç¨‹ç»„</p></li><li><p>å®¡è®¡é£é™©ç®¡ç†è¿‡ç¨‹æ˜¯å¦æœ‰æ•ˆ</p></li><li><p>å®¡è®¡é£é™©åº”å¯¹æªæ–½æ˜¯å¦æœ‰æ•ˆ</p></li></ul><h5 id="2-ä½œç”¨"><a href="#2-ä½œç”¨" class="headerlink" title="2. ä½œç”¨"></a>2. ä½œç”¨</h5><ul><li>ä¸ºä¹‹åçš„é¡¹ç›®èµ·åˆ°å€Ÿé‰´ä½œç”¨ï¼ˆç»éªŒæ•™è®­ï¼‰</li></ul><h2 id="äºŒã€é‡‡è´­ç®¡ç†"><a href="#äºŒã€é‡‡è´­ç®¡ç†" class="headerlink" title="äºŒã€é‡‡è´­ç®¡ç†"></a>äºŒã€é‡‡è´­ç®¡ç†</h2><h3 id="1ã€è§„åˆ’é‡‡è´­ï¼ˆç¼–åˆ¶é‡‡è´­è®¡åˆ’ï¼‰"><a href="#1ã€è§„åˆ’é‡‡è´­ï¼ˆç¼–åˆ¶é‡‡è´­è®¡åˆ’ï¼‰" class="headerlink" title="1ã€è§„åˆ’é‡‡è´­ï¼ˆç¼–åˆ¶é‡‡è´­è®¡åˆ’ï¼‰"></a>1ã€è§„åˆ’é‡‡è´­ï¼ˆç¼–åˆ¶é‡‡è´­è®¡åˆ’ï¼‰</h3><h4 id="1ï¼‰åŸºç¡€çŸ¥è¯†"><a href="#1ï¼‰åŸºç¡€çŸ¥è¯†" class="headerlink" title="1ï¼‰åŸºç¡€çŸ¥è¯†"></a>1ï¼‰åŸºç¡€çŸ¥è¯†</h4><h5 id="1-è§„åˆ’ä»€ä¹ˆï¼Ÿ"><a href="#1-è§„åˆ’ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. è§„åˆ’ä»€ä¹ˆï¼Ÿ"></a>1. è§„åˆ’ä»€ä¹ˆï¼Ÿ</h5><ul><li>æ˜¯å¦éœ€è¦é‡‡è´­</li><li>é‡‡è´­ä»€ä¹ˆ</li><li>ä½•æ—¶é‡‡è´­</li></ul><h5 id="2-å·¥ä½œå†…å®¹"><a href="#2-å·¥ä½œå†…å®¹" class="headerlink" title="2. å·¥ä½œå†…å®¹"></a>2. å·¥ä½œå†…å®¹</h5><ul><li>è§„åˆ’é‡‡è´­</li><li>è¿›è¡Œè‡ªåˆ¶æˆ–å¤–è´­åˆ†æ</li><li>ç¼–åˆ¶é‡‡è´­æ–‡ä»¶</li><li>ç¼–åˆ¶ä¾›æ–¹é€‰æ‹©æ ‡å‡†</li></ul><h4 id="2ï¼‰è¾“å…¥-5"><a href="#2ï¼‰è¾“å…¥-5" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’-1"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’-1" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-éœ€æ±‚æ–‡æ¡£"><a href="#2-éœ€æ±‚æ–‡æ¡£" class="headerlink" title="2. éœ€æ±‚æ–‡æ¡£"></a>2. éœ€æ±‚æ–‡æ¡£</h5><h5 id="3-é£é™©ç™»è®°å†Œ-1"><a href="#3-é£é™©ç™»è®°å†Œ-1" class="headerlink" title="3. é£é™©ç™»è®°å†Œ"></a>3. é£é™©ç™»è®°å†Œ</h5><h5 id="4-æ´»åŠ¨èµ„æºè¦æ±‚"><a href="#4-æ´»åŠ¨èµ„æºè¦æ±‚" class="headerlink" title="4. æ´»åŠ¨èµ„æºè¦æ±‚"></a>4. æ´»åŠ¨èµ„æºè¦æ±‚</h5><h5 id="5-é¡¹ç›®è¿›åº¦"><a href="#5-é¡¹ç›®è¿›åº¦" class="headerlink" title="5. é¡¹ç›®è¿›åº¦"></a>5. é¡¹ç›®è¿›åº¦</h5><h5 id="6-æ´»åŠ¨æˆæœ¬ä¼°ç®—"><a href="#6-æ´»åŠ¨æˆæœ¬ä¼°ç®—" class="headerlink" title="6. æ´»åŠ¨æˆæœ¬ä¼°ç®—"></a>6. æ´»åŠ¨æˆæœ¬ä¼°ç®—</h5><h5 id="7-å¹²ç³»äººç™»è®°å†Œ"><a href="#7-å¹²ç³»äººç™»è®°å†Œ" class="headerlink" title="7. å¹²ç³»äººç™»è®°å†Œ"></a>7. å¹²ç³»äººç™»è®°å†Œ</h5><h5 id="8-äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#8-äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="8. äº‹ä¸šç¯å¢ƒå› ç´ "></a>8. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="9-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#9-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="9. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>9. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-è‡ªåˆ¶-å¤–è´­åˆ†æ"><a href="#1-è‡ªåˆ¶-å¤–è´­åˆ†æ" class="headerlink" title="1. è‡ªåˆ¶/å¤–è´­åˆ†æ"></a>1. è‡ªåˆ¶/å¤–è´­åˆ†æ</h5><h5 id="2-ä¸“å®¶åˆ¤æ–­-1"><a href="#2-ä¸“å®¶åˆ¤æ–­-1" class="headerlink" title="2. ä¸“å®¶åˆ¤æ–­"></a>2. ä¸“å®¶åˆ¤æ–­</h5><h5 id="3-å¸‚åœºè°ƒç ”"><a href="#3-å¸‚åœºè°ƒç ”" class="headerlink" title="3. å¸‚åœºè°ƒç ”"></a>3. å¸‚åœºè°ƒç ”</h5><h5 id="4-ä¼šè®®"><a href="#4-ä¼šè®®" class="headerlink" title="4. ä¼šè®®"></a>4. ä¼šè®®</h5><h5 id="5-åˆåŒç±»å‹"><a href="#5-åˆåŒç±»å‹" class="headerlink" title="5. åˆåŒç±»å‹"></a>5. åˆåŒç±»å‹</h5><h4 id="4ï¼‰è¾“å‡º-5"><a href="#4ï¼‰è¾“å‡º-5" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-é‡‡è´­è®¡åˆ’"><a href="#1-é‡‡è´­è®¡åˆ’" class="headerlink" title="1. é‡‡è´­è®¡åˆ’"></a>1. é‡‡è´­è®¡åˆ’</h5><ul><li>é‡‡è´­è®¡åˆ’æè¿°<strong>ä»å½¢æˆé‡‡è´­æ–‡ä»¶åˆ°åˆåŒæ”¶å°¾</strong>çš„é‡‡è´­è¿‡ç¨‹</li><li>å…·ä½“çš„é‡‡è´­æ´»åŠ¨å°†ä¾æ®é‡‡è´­è®¡åˆ’è¿›è¡Œ</li></ul><h5 id="2-é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦"><a href="#2-é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦" class="headerlink" title="2. é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦"></a>2. é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦</h5><ul><li>é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦å®šä¹‰äº†ä¸é‡‡è´­åˆåŒç›¸å…³çš„é¡¹ç›®èŒƒå›´</li><li><strong>æ¯ä¸ªé‡‡è´­å·¥ä½œè¯´æ˜ä¹¦éƒ½æ¥è‡ªäºé¡¹ç›®çš„èŒƒå›´åŸºå‡†</strong></li></ul><h5 id="3-é‡‡è´­æ–‡ä»¶"><a href="#3-é‡‡è´­æ–‡ä»¶" class="headerlink" title="3. é‡‡è´­æ–‡ä»¶"></a>3. é‡‡è´­æ–‡ä»¶</h5><h6 id="æ¦‚å¿µï¼š-3"><a href="#æ¦‚å¿µï¼š-3" class="headerlink" title="æ¦‚å¿µï¼š"></a>æ¦‚å¿µï¼š</h6><ul><li>é‡‡è´­æ–‡ä»¶æ˜¯ç”¨æ¥å¾—åˆ°æ½œåœ¨å–æ–¹çš„æŠ¥ä»·å»ºè®®ä¹¦</li><li>å½“è´­ä¹°å•†ä¸šäº§å“æˆ–æ ‡å‡†äº§å“æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨æ ‡ä¹¦ã€æŠ•æ ‡æˆ–æŠ¥ä»·ç­‰æœ¯è¯­</li></ul><h6 id="å¸¸è§çš„é‡‡è´­æ–‡ä»¶ï¼š"><a href="#å¸¸è§çš„é‡‡è´­æ–‡ä»¶ï¼š" class="headerlink" title="å¸¸è§çš„é‡‡è´­æ–‡ä»¶ï¼š"></a>å¸¸è§çš„é‡‡è´­æ–‡ä»¶ï¼š</h6><ul><li>æ–¹æ¡ˆé‚€è¯·ä¹¦RFPï¼ˆéœ€æ±‚æ˜ç¡®ï¼‰</li><li>æŠ¥ä»·ç”³è¯·ä¹¦RFQï¼ˆæ‹›æ ‡ï¼‰</li><li>å¾æ±‚ä¾›åº”å•†æ„è§ä¹¦RFIï¼ˆéœ€æ±‚ä¸æ˜ç¡®ï¼‰</li><li>æŠ•æ ‡é‚€è¯·ä¹¦IFB</li><li>æ‹›æ ‡é€šçŸ¥ä¹¦</li><li>æ´½è°ˆé‚€è¯·</li><li>æ‰¿åŒ…å•†åˆå§‹å»ºè®®å¾æ±‚ä¹¦</li></ul><h5 id="4-ä¾›æ–¹é€‰æ‹©æ ‡å‡†"><a href="#4-ä¾›æ–¹é€‰æ‹©æ ‡å‡†" class="headerlink" title="4. ä¾›æ–¹é€‰æ‹©æ ‡å‡†"></a>4. ä¾›æ–¹é€‰æ‹©æ ‡å‡†</h5><ul><li>ç”¨äºä»æ½œåœ¨çš„å–æ–¹ä¸­é€‰ä¸­ç¬¦åˆè¦æ±‚çš„ã€åˆæ ¼çš„å–æ–¹</li></ul><h5 id="5-è‡ªåˆ¶-å¤–è´­å†³ç­–"><a href="#5-è‡ªåˆ¶-å¤–è´­å†³ç­–" class="headerlink" title="5. è‡ªåˆ¶/å¤–è´­å†³ç­–"></a>5. è‡ªåˆ¶/å¤–è´­å†³ç­–</h5><ul><li>ä»»ä½•é¢„ç®—é™åˆ¶éƒ½å¯èƒ½å½±å“â€œè‡ªåˆ¶/å¤–è´­â€çš„å†³ç­–</li><li>â€œè‡ªåˆ¶/å¤–è´­â€åˆ†æåº”è€ƒè™‘æ‰€æœ‰ç›¸å…³çš„æˆæœ¬ï¼ˆç›´æ¥æˆæœ¬/é—´æ¥æˆæœ¬ï¼Œå¦‚å‡çº§è´¹ç”¨ã€æŠ˜æ—§è´¹ç”¨ï¼‰</li><li><strong>å¦‚æœå†³ç­–ç»“æœä¸ºå¤–è´­ï¼Œè¿˜è¦è¿›ä¸€æ­¥å†³å®šæ—¶è´­ä¹°è¿˜æ˜¯ç§Ÿå€Ÿ</strong></li></ul><h5 id="6-å˜æ›´ç”³è¯·"><a href="#6-å˜æ›´ç”³è¯·" class="headerlink" title="6. å˜æ›´ç”³è¯·"></a>6. å˜æ›´ç”³è¯·</h5><h5 id="7-å¯èƒ½çš„é¡¹ç›®æ–‡ä»¶æ›´æ–°"><a href="#7-å¯èƒ½çš„é¡¹ç›®æ–‡ä»¶æ›´æ–°" class="headerlink" title="7. å¯èƒ½çš„é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>7. å¯èƒ½çš„é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h4 id="-2"><a href="#-2" class="headerlink" title=""></a></h4><h4 id="4ï¼‰é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦ï¼ˆSOWï¼‰ï¼ˆ-ï¼‰"><a href="#4ï¼‰é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦ï¼ˆSOWï¼‰ï¼ˆ-ï¼‰" class="headerlink" title="4ï¼‰é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦ï¼ˆSOWï¼‰ï¼ˆ***ï¼‰"></a>4ï¼‰é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦ï¼ˆSOWï¼‰ï¼ˆ***ï¼‰</h4><h5 id="1-å†…å®¹-1"><a href="#1-å†…å®¹-1" class="headerlink" title="1. å†…å®¹"></a>1. å†…å®¹</h5><ul><li>å‰è¨€</li><li>æœåŠ¡èŒƒå›´</li><li>æ–¹æ³•</li><li>å‡å®š</li><li>æœåŠ¡æœŸé™</li><li>å·¥ä½œé‡ä¼°è®¡</li><li>åŒæ–¹è§’è‰²å’Œè´£ä»»</li><li>äº¤ä»˜èµ„æ–™</li><li>å®Œæˆæ ‡å‡†</li><li>é¡¾é—®ç»„äººå‘˜</li><li><strong>æ”¶è´¹å’Œä»˜æ¬¾æ–¹å¼</strong></li><li>å˜æ›´ç®¡ç†</li></ul><h5 id="2-æ³¨æ„äº‹é¡¹"><a href="#2-æ³¨æ„äº‹é¡¹" class="headerlink" title="2. æ³¨æ„äº‹é¡¹"></a>2. æ³¨æ„äº‹é¡¹</h5><ul><li><strong>æ¯æ¬¡è¿›è¡Œé‡‡è´­ï¼Œéƒ½éœ€è¦ç¼–åˆ¶ SOW</strong>ï¼ˆç”±é¡¹ç›®ç»ç†ï¼‰</li><li>å¯ä»¥å°†å¤šä¸ªäº§å“æˆ–æœåŠ¡çš„çš„é‡‡è´­ç»„åˆæˆä¸€ä¸ªé‡‡è´­åŒ…ï¼Œç”±ä¸€ä¸ªSOWå…¨éƒ¨è¦†ç›–</li></ul><h5 id="3-ä¸é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦çš„åŒºåˆ«ï¼ˆ-ï¼‰"><a href="#3-ä¸é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦çš„åŒºåˆ«ï¼ˆ-ï¼‰" class="headerlink" title="3. ä¸é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦çš„åŒºåˆ«ï¼ˆ***ï¼‰"></a>3. ä¸é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦çš„åŒºåˆ«ï¼ˆ***ï¼‰</h5><ul><li>é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦æ—¶å¯¹é¡¹ç›®æ‰€æœ‰è¦æä¾›çš„äº§å“æˆ–æœåŠ¡çš„å™è¿°æ€§æè¿°</li><li>é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦æ˜¯é€šè¿‡æ˜ç¡®é¡¹ç›®åº”è¯¥å®Œæˆçš„å·¥ä½œè€Œç¡®å®šé¡¹ç›®çš„èŒƒå›´</li></ul><h5 id="4-é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦æ ·æœ¬"><a href="#4-é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦æ ·æœ¬" class="headerlink" title="4. é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦æ ·æœ¬"></a>4. é‡‡è´­å·¥ä½œè¯´æ˜ä¹¦æ ·æœ¬</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210910124740756.png" alt="image-20210910124740756"></p><h3 id="2ã€å®æ–½é‡‡è´­"><a href="#2ã€å®æ–½é‡‡è´­" class="headerlink" title="2ã€å®æ–½é‡‡è´­"></a>2ã€å®æ–½é‡‡è´­</h3><h4 id="1ï¼‰å®æ–½é‡‡è´­çš„å·¥ä½œå†…å®¹"><a href="#1ï¼‰å®æ–½é‡‡è´­çš„å·¥ä½œå†…å®¹" class="headerlink" title="1ï¼‰å®æ–½é‡‡è´­çš„å·¥ä½œå†…å®¹"></a>1ï¼‰å®æ–½é‡‡è´­çš„å·¥ä½œå†…å®¹</h4><ul><li><p>å‘å¸ƒé‡‡è´­æ–‡ä»¶</p></li><li><p>ä»æ½œåœ¨å–å®¶è·å¾—ç›¸å…³ä¿¡æ¯ã€æŠ¥ä»·ã€æŠ•æ ‡æˆ–å»ºè®®ä¹¦</p></li><li><p>å¯¹æ½œåœ¨å–æ–¹æäº¤çš„ç›¸å…³ææ–™è¿›è¡Œè¯„å®¡ï¼ˆè¯„æ ‡ï¼‰</p></li><li><p>ä»ä¸­é€‰æ‹©ä¸€å®¶å–æ–¹ï¼ˆå¼€æ ‡ï¼‰</p></li><li><p>ä¸å–æ–¹æ´½è°ˆå’Œç­¾è®¢ä¹¦é¢åˆåŒ</p></li></ul><h4 id="2ï¼‰è¾“å…¥-6"><a href="#2ï¼‰è¾“å…¥-6" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é‡‡è´­è®¡åˆ’-1"><a href="#1-é‡‡è´­è®¡åˆ’-1" class="headerlink" title="1. é‡‡è´­è®¡åˆ’"></a>1. é‡‡è´­è®¡åˆ’</h5><h5 id="2-é‡‡è´­æ–‡ä»¶"><a href="#2-é‡‡è´­æ–‡ä»¶" class="headerlink" title="2. é‡‡è´­æ–‡ä»¶"></a>2. é‡‡è´­æ–‡ä»¶</h5><h5 id="3-å–æ–¹å»ºè®®ä¹¦"><a href="#3-å–æ–¹å»ºè®®ä¹¦" class="headerlink" title="3. å–æ–¹å»ºè®®ä¹¦"></a>3. å–æ–¹å»ºè®®ä¹¦</h5><h5 id="4-é¡¹ç›®æ–‡ä»¶"><a href="#4-é¡¹ç›®æ–‡ä»¶" class="headerlink" title="4. é¡¹ç›®æ–‡ä»¶"></a>4. é¡¹ç›®æ–‡ä»¶</h5><h5 id="5-é‡‡è´­å·¥ä½œè¯´æ˜"><a href="#5-é‡‡è´­å·¥ä½œè¯´æ˜" class="headerlink" title="5. é‡‡è´­å·¥ä½œè¯´æ˜"></a>5. é‡‡è´­å·¥ä½œè¯´æ˜</h5><h5 id="6-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#6-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="6. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>6. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-1"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-1" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-æŠ•æ ‡äººä¼šè®®"><a href="#1-æŠ•æ ‡äººä¼šè®®" class="headerlink" title="1. æŠ•æ ‡äººä¼šè®®"></a>1. æŠ•æ ‡äººä¼šè®®</h5><h5 id="2-å»ºè®®è¯„ä»·æŠ€æœ¯"><a href="#2-å»ºè®®è¯„ä»·æŠ€æœ¯" class="headerlink" title="2. å»ºè®®è¯„ä»·æŠ€æœ¯"></a>2. å»ºè®®è¯„ä»·æŠ€æœ¯</h5><h5 id="3-ç‹¬ç«‹ä¼°ç®—"><a href="#3-ç‹¬ç«‹ä¼°ç®—" class="headerlink" title="3. ç‹¬ç«‹ä¼°ç®—"></a>3. ç‹¬ç«‹ä¼°ç®—</h5><h5 id="4-ä¸“å®¶åˆ¤æ–­-1"><a href="#4-ä¸“å®¶åˆ¤æ–­-1" class="headerlink" title="4. ä¸“å®¶åˆ¤æ–­"></a>4. ä¸“å®¶åˆ¤æ–­</h5><h5 id="5-åˆŠç™»å¹¿å‘Š"><a href="#5-åˆŠç™»å¹¿å‘Š" class="headerlink" title="5. åˆŠç™»å¹¿å‘Š"></a>5. åˆŠç™»å¹¿å‘Š</h5><h5 id="6-åˆ†ææŠ€æœ¯"><a href="#6-åˆ†ææŠ€æœ¯" class="headerlink" title="6. åˆ†ææŠ€æœ¯"></a>6. åˆ†ææŠ€æœ¯</h5><h5 id="7-é‡‡è´­è°ˆåˆ¤"><a href="#7-é‡‡è´­è°ˆåˆ¤" class="headerlink" title="7. é‡‡è´­è°ˆåˆ¤"></a>7. é‡‡è´­è°ˆåˆ¤</h5><h4 id="4ï¼‰è¾“å‡º-6"><a href="#4ï¼‰è¾“å‡º-6" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-é€‰ä¸­çš„å–æ–¹"><a href="#1-é€‰ä¸­çš„å–æ–¹" class="headerlink" title="1. é€‰ä¸­çš„å–æ–¹"></a>1. é€‰ä¸­çš„å–æ–¹</h5><h5 id="2-åˆåŒ"><a href="#2-åˆåŒ" class="headerlink" title="2. åˆåŒ"></a>2. åˆåŒ</h5><h5 id="3-èµ„æºæ—¥å†"><a href="#3-èµ„æºæ—¥å†" class="headerlink" title="3. èµ„æºæ—¥å†"></a>3. èµ„æºæ—¥å†</h5><h5 id="4-å˜æ›´è¯·æ±‚"><a href="#4-å˜æ›´è¯·æ±‚" class="headerlink" title="4. å˜æ›´è¯·æ±‚"></a>4. å˜æ›´è¯·æ±‚</h5><h5 id="5-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"><a href="#5-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°" class="headerlink" title="5. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"></a>5. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</h5><h4 id="5ï¼‰è¯¢ä»·æ¯”ä»·-vs-ä¸è¯¢ä»·æ¯”ä»·"><a href="#5ï¼‰è¯¢ä»·æ¯”ä»·-vs-ä¸è¯¢ä»·æ¯”ä»·" class="headerlink" title="5ï¼‰è¯¢ä»·æ¯”ä»· vs ä¸è¯¢ä»·æ¯”ä»·"></a>5ï¼‰è¯¢ä»·æ¯”ä»· vs ä¸è¯¢ä»·æ¯”ä»·</h4><h5 id="1-é€‚ç”¨è¯¢ä»·æ¯”ä»·çš„é‡‡è´­äº§å“"><a href="#1-é€‚ç”¨è¯¢ä»·æ¯”ä»·çš„é‡‡è´­äº§å“" class="headerlink" title="1. é€‚ç”¨è¯¢ä»·æ¯”ä»·çš„é‡‡è´­äº§å“"></a>1. é€‚ç”¨è¯¢ä»·æ¯”ä»·çš„é‡‡è´­äº§å“</h5><ul><li>å¸‚åœºåŒ–ç¨‹åº¦é«˜çš„äº§å“</li><li>éä¸“åˆ©ä¸“æœ‰æŠ€æœ¯äº§å“</li><li>å……åˆ†ç«äº‰æ€§äº§å“</li><li>å¯æ›¿ä»£æ€§å¼ºçš„äº§å“</li><li>ä¾›åº”å•†ä¸å”¯ä¸€çš„äº§å“</li></ul><h5 id="2-ä¸é€‚ç”¨è¯¢ä»·æ¯”ä»·çš„é‡‡è´­äº§å“"><a href="#2-ä¸é€‚ç”¨è¯¢ä»·æ¯”ä»·çš„é‡‡è´­äº§å“" class="headerlink" title="2. ä¸é€‚ç”¨è¯¢ä»·æ¯”ä»·çš„é‡‡è´­äº§å“"></a>2. ä¸é€‚ç”¨è¯¢ä»·æ¯”ä»·çš„é‡‡è´­äº§å“</h5><ul><li>æŒ‡å®šé‡‡è´­ã€åŸå‚æˆ–ä»£ç†æœ‰ç›¸å…³åè®®çš„é‡‡è´­</li><li>å•ä¸ªä¾›åº”å•†ä¾›è´§ï¼ŒåˆåŒåœ¨ä¸€å®šé‡‘é¢ä¸€ä¸‹çš„é‡‡è´­</li></ul><blockquote><p>ğŸš© <strong>æˆ‘å›½ã€Šæ‹›æŠ•æ ‡æ³•ã€‹è§„å®š:</strong></p><p>å·¥ç¨‹æ–½å·¥400wä»¥ä¸Šï¼Œè®¾å¤‡é‡‡è´­200wä»¥ä¸Šï¼ŒæœåŠ¡100wä»¥ä¸Šï¼Œå¿…é¡»æ‹›æŠ•æ ‡ã€‚</p></blockquote><h4 id="6ï¼‰ä¸€ä¸ªå®Œæ•´çš„é‡‡è´­åˆåŒ"><a href="#6ï¼‰ä¸€ä¸ªå®Œæ•´çš„é‡‡è´­åˆåŒ" class="headerlink" title="6ï¼‰ä¸€ä¸ªå®Œæ•´çš„é‡‡è´­åˆåŒ"></a>6ï¼‰ä¸€ä¸ªå®Œæ•´çš„é‡‡è´­åˆåŒ</h4><h5 id="1-ç»„æˆéƒ¨åˆ†"><a href="#1-ç»„æˆéƒ¨åˆ†" class="headerlink" title="1. ç»„æˆéƒ¨åˆ†"></a>1. ç»„æˆéƒ¨åˆ†</h5><ul><li>å¼€å¤´</li><li>æ­£æ–‡</li><li>ç»“å°¾</li><li>é™„ä»¶</li></ul><h5 id="2-å¿…å¤‡æ¡æ¬¾ï¼ˆ-ï¼‰"><a href="#2-å¿…å¤‡æ¡æ¬¾ï¼ˆ-ï¼‰" class="headerlink" title="2. å¿…å¤‡æ¡æ¬¾ï¼ˆ***ï¼‰"></a>2. å¿…å¤‡æ¡æ¬¾ï¼ˆ***ï¼‰</h5><ul><li>å•†å“åç§°</li><li>è´¨é‡æ¡æ¬¾</li><li>æ•°é‡å’Œè®¡é‡å•ä½</li><li>å•†å“çš„ä»·æ ¼</li><li>äº¤è´§çš„æœŸé™ã€åœ°ç‚¹å’Œæ–¹å¼</li><li>äº§å“çš„åŒ…è£…æ ‡å‡†å’ŒåŒ…è£…ç‰©çš„ä¾›åº”å•†ä¸å›æ”¶</li><li>äº§å“çš„éªŒæ”¶æ–¹å¼</li><li>è¿çº¦è´£ä»»</li><li>ç»“ç®—æ–¹å¼</li></ul><h4 id="7ï¼‰é‡‡è´­åˆåŒç­¾è®¢"><a href="#7ï¼‰é‡‡è´­åˆåŒç­¾è®¢" class="headerlink" title="7ï¼‰é‡‡è´­åˆåŒç­¾è®¢"></a>7ï¼‰é‡‡è´­åˆåŒç­¾è®¢</h4><ul><li>å¯¹å·¥ç¨‹å½±å“ä¸å¤§çš„è¾…æï¼Œå¯ä»¥å°†æ­£è§„çš„è´­è´§å‘ç¥¨è§†ä½œé‡‡è´­åˆåŒ</li><li> é™¤æ­¤ä¹‹å¤–éƒ½éœ€è¦ç­¾è®¢æ­£è§„çš„é‡‡è´­åˆåŒï¼ˆåè®®ï¼‰</li><li>é‡‡è´­åˆåŒåº”æ¸…æ¥šè¡¨è¿°è®¢è´­äº§å“çš„æœ‰å…³ä¿¡æ¯å’Œè¦æ±‚</li></ul><h4 id="8ï¼‰é‡‡è´­è°ˆåˆ¤"><a href="#8ï¼‰é‡‡è´­è°ˆåˆ¤" class="headerlink" title="8ï¼‰é‡‡è´­è°ˆåˆ¤"></a>8ï¼‰é‡‡è´­è°ˆåˆ¤</h4><h5 id="1-æ¦‚å¿µ-1"><a href="#1-æ¦‚å¿µ-1" class="headerlink" title="1. æ¦‚å¿µ"></a>1. æ¦‚å¿µ</h5><ul><li>é‡‡è´­è°ˆåˆ¤æ˜¯æŒ‡åœ¨åˆåŒç­¾ç½²å‰ï¼Œå¯¹åˆåŒçš„ç»“æ„ã€è¦æ±‚ä»¥åŠå…¶ä»–æ¡æ¬¾åŠ ä»¥æ¾„æ¸…ï¼Œä»¥å–å¾—ä¸€è‡´æ„è§ã€‚</li><li>æœ€ç»ˆçš„åˆåŒæªæ–½åº”è¯¥åæ˜ åŒæ–¹è¾¾æˆçš„å…¨éƒ¨ä¸€è‡´æ„è§</li></ul><h5 id="2-è°ˆåˆ¤å†…å®¹ï¼ˆ-ï¼‰"><a href="#2-è°ˆåˆ¤å†…å®¹ï¼ˆ-ï¼‰" class="headerlink" title="2. è°ˆåˆ¤å†…å®¹ï¼ˆ***ï¼‰"></a>2. è°ˆåˆ¤å†…å®¹ï¼ˆ***ï¼‰</h5><ul><li>è´£ä»»</li><li>è¿›è¡Œå˜æ›´çš„æƒé™</li><li>ä½¿ç”¨çš„æ¡æ¬¾å’Œæ³•å¾‹</li><li>æŠ€æœ¯å’Œå•†åŠ¡è¦æ±‚</li><li>æ‰€æœ‰æƒ</li><li>åˆåŒèèµ„</li><li>æŠ€æœ¯è§£å†³æ–¹æ¡ˆ</li><li>æ€»ä½“è¿›åº¦è®¡åˆ’</li><li>ä»˜æ¬¾ä»¥åŠä»·æ ¼</li></ul><h3 id="3ã€æ§åˆ¶é‡‡è´­"><a href="#3ã€æ§åˆ¶é‡‡è´­" class="headerlink" title="3ã€æ§åˆ¶é‡‡è´­"></a>3ã€æ§åˆ¶é‡‡è´­</h3><h4 id="1ï¼‰æ§åˆ¶é‡‡è´­çš„å·¥ä½œå†…å®¹"><a href="#1ï¼‰æ§åˆ¶é‡‡è´­çš„å·¥ä½œå†…å®¹" class="headerlink" title="1ï¼‰æ§åˆ¶é‡‡è´­çš„å·¥ä½œå†…å®¹"></a>1ï¼‰æ§åˆ¶é‡‡è´­çš„å·¥ä½œå†…å®¹</h4><ul><li>ç®¡ç†é‡‡è´­å…³ç³»</li><li>ç›‘ç£åˆåŒç»©æ•ˆ</li><li>å®æ–½å˜æ›´å’Œçº å</li><li>å…³é—­åˆåŒ</li></ul><h4 id="2ï¼‰è¾“å…¥-7"><a href="#2ï¼‰è¾“å…¥-7" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’-2"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’-2" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-é‡‡è´­æ–‡ä»¶-1"><a href="#2-é‡‡è´­æ–‡ä»¶-1" class="headerlink" title="2. é‡‡è´­æ–‡ä»¶"></a>2. é‡‡è´­æ–‡ä»¶</h5><h5 id="3-åˆåŒ"><a href="#3-åˆåŒ" class="headerlink" title="3. åˆåŒ"></a>3. åˆåŒ</h5><h5 id="4-æ‰¹å‡†çš„å˜æ›´è¯·æ±‚"><a href="#4-æ‰¹å‡†çš„å˜æ›´è¯·æ±‚" class="headerlink" title="4. æ‰¹å‡†çš„å˜æ›´è¯·æ±‚"></a>4. æ‰¹å‡†çš„å˜æ›´è¯·æ±‚</h5><h5 id="5-å·¥ä½œç»©æ•ˆæŠ¥å‘Š"><a href="#5-å·¥ä½œç»©æ•ˆæŠ¥å‘Š" class="headerlink" title="5. å·¥ä½œç»©æ•ˆæŠ¥å‘Š"></a>5. å·¥ä½œç»©æ•ˆæŠ¥å‘Š</h5><h5 id="6-å·¥ä½œç»©æ•ˆæ•°æ®"><a href="#6-å·¥ä½œç»©æ•ˆæ•°æ®" class="headerlink" title="6. å·¥ä½œç»©æ•ˆæ•°æ®"></a>6. å·¥ä½œç»©æ•ˆæ•°æ®</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-2"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-2" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-åˆåŒå˜æ›´æ§åˆ¶ç³»ç»Ÿ"><a href="#1-åˆåŒå˜æ›´æ§åˆ¶ç³»ç»Ÿ" class="headerlink" title="1. åˆåŒå˜æ›´æ§åˆ¶ç³»ç»Ÿ"></a>1. åˆåŒå˜æ›´æ§åˆ¶ç³»ç»Ÿ</h5><h5 id="2-æ£€æŸ¥ä¸å®¡è®¡"><a href="#2-æ£€æŸ¥ä¸å®¡è®¡" class="headerlink" title="2. æ£€æŸ¥ä¸å®¡è®¡"></a>2. æ£€æŸ¥ä¸å®¡è®¡</h5><h5 id="3-é‡‡è´­ç»©æ•ˆå®¡æŸ¥"><a href="#3-é‡‡è´­ç»©æ•ˆå®¡æŸ¥" class="headerlink" title="3. é‡‡è´­ç»©æ•ˆå®¡æŸ¥"></a>3. é‡‡è´­ç»©æ•ˆå®¡æŸ¥</h5><h5 id="4-æŠ¥å‘Šç»©æ•ˆ"><a href="#4-æŠ¥å‘Šç»©æ•ˆ" class="headerlink" title="4. æŠ¥å‘Šç»©æ•ˆ"></a>4. æŠ¥å‘Šç»©æ•ˆ</h5><h5 id="5-æ”¯ä»˜ç³»ç»Ÿ"><a href="#5-æ”¯ä»˜ç³»ç»Ÿ" class="headerlink" title="5. æ”¯ä»˜ç³»ç»Ÿ"></a>5. æ”¯ä»˜ç³»ç»Ÿ</h5><h5 id="6-ç´¢èµ”ç®¡ç†"><a href="#6-ç´¢èµ”ç®¡ç†" class="headerlink" title="6. ç´¢èµ”ç®¡ç†"></a>6. ç´¢èµ”ç®¡ç†</h5><h5 id="7-è®°å½•ç®¡ç†ç³»ç»Ÿ"><a href="#7-è®°å½•ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="7. è®°å½•ç®¡ç†ç³»ç»Ÿ"></a>7. è®°å½•ç®¡ç†ç³»ç»Ÿ</h5><h4 id="4ï¼‰è¾“å‡º-7"><a href="#4ï¼‰è¾“å‡º-7" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-å·¥ä½œç»©æ•ˆä¿¡æ¯"><a href="#1-å·¥ä½œç»©æ•ˆä¿¡æ¯" class="headerlink" title="1. å·¥ä½œç»©æ•ˆä¿¡æ¯"></a>1. å·¥ä½œç»©æ•ˆä¿¡æ¯</h5><h5 id="2-å˜æ›´è¯·æ±‚"><a href="#2-å˜æ›´è¯·æ±‚" class="headerlink" title="2. å˜æ›´è¯·æ±‚"></a>2. å˜æ›´è¯·æ±‚</h5><h5 id="3-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"><a href="#3-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°" class="headerlink" title="3. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"></a>3. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</h5><h5 id="4-é¡¹ç›®æ–‡ä»¶æ›´æ–°"><a href="#4-é¡¹ç›®æ–‡ä»¶æ›´æ–°" class="headerlink" title="4. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>4. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h5 id="5-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"><a href="#5-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°" class="headerlink" title="5. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"></a>5. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°</h5><h3 id="4ã€ç»“æŸé‡‡è´­"><a href="#4ã€ç»“æŸé‡‡è´­" class="headerlink" title="4ã€ç»“æŸé‡‡è´­"></a>4ã€ç»“æŸé‡‡è´­</h3><h4 id="1ï¼‰è¾“å…¥"><a href="#1ï¼‰è¾“å…¥" class="headerlink" title="1ï¼‰è¾“å…¥"></a>1ï¼‰è¾“å…¥</h4><h5 id="1-åˆåŒ"><a href="#1-åˆåŒ" class="headerlink" title="1. åˆåŒ"></a>1. åˆåŒ</h5><h5 id="2-åˆåŒæ”¶å°¾ç¨‹åº"><a href="#2-åˆåŒæ”¶å°¾ç¨‹åº" class="headerlink" title="2. åˆåŒæ”¶å°¾ç¨‹åº"></a>2. åˆåŒæ”¶å°¾ç¨‹åº</h5><h5 id="3-é¡¹ç›®ç®¡ç†è®¡åˆ’"><a href="#3-é¡¹ç›®ç®¡ç†è®¡åˆ’" class="headerlink" title="3. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>3. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="4-é‡‡è´­æ–‡ä»¶"><a href="#4-é‡‡è´­æ–‡ä»¶" class="headerlink" title="4. é‡‡è´­æ–‡ä»¶"></a>4. é‡‡è´­æ–‡ä»¶</h5><h4 id="2ï¼‰æŠ€æœ¯å’Œå·¥å…·"><a href="#2ï¼‰æŠ€æœ¯å’Œå·¥å…·" class="headerlink" title="2ï¼‰æŠ€æœ¯å’Œå·¥å…·"></a>2ï¼‰æŠ€æœ¯å’Œå·¥å…·</h4><h5 id="1-é‡‡è´­å®¡è®¡"><a href="#1-é‡‡è´­å®¡è®¡" class="headerlink" title="1. é‡‡è´­å®¡è®¡"></a>1. é‡‡è´­å®¡è®¡</h5><h5 id="2-é‡‡è´­è°ˆåˆ¤"><a href="#2-é‡‡è´­è°ˆåˆ¤" class="headerlink" title="2. é‡‡è´­è°ˆåˆ¤"></a>2. é‡‡è´­è°ˆåˆ¤</h5><h5 id="3-è®°å½•ç®¡ç†ç³»ç»Ÿ"><a href="#3-è®°å½•ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="3. è®°å½•ç®¡ç†ç³»ç»Ÿ"></a>3. è®°å½•ç®¡ç†ç³»ç»Ÿ</h5><h4 id="3ï¼‰è¾“å‡º"><a href="#3ï¼‰è¾“å‡º" class="headerlink" title="3ï¼‰è¾“å‡º"></a>3ï¼‰è¾“å‡º</h4><h5 id="1-åˆåŒæ”¶å°¾"><a href="#1-åˆåŒæ”¶å°¾" class="headerlink" title="1. åˆåŒæ”¶å°¾"></a>1. åˆåŒæ”¶å°¾</h5><h5 id="2-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"><a href="#2-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°" class="headerlink" title="2. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"></a>2. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°</h5><h4 id="4ï¼‰åˆåŒæ”¶å°¾-vs-è¡Œæ”¿æ”¶å°¾"><a href="#4ï¼‰åˆåŒæ”¶å°¾-vs-è¡Œæ”¿æ”¶å°¾" class="headerlink" title="4ï¼‰åˆåŒæ”¶å°¾ vs è¡Œæ”¿æ”¶å°¾"></a>4ï¼‰åˆåŒæ”¶å°¾ vs è¡Œæ”¿æ”¶å°¾</h4><table><thead><tr><th></th><th>åˆåŒæ”¶å°¾</th><th>è¡Œæ”¿æ”¶å°¾ï¼ˆç®¡ç†æ”¶å°¾ï¼‰</th></tr></thead><tbody><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>ä¸€ä¸ªåˆåŒåªæœ‰ä¸€æ¬¡ï¼Œå°±æ˜¯åˆåŒç­¾ç½²çš„æ—¶å€™</td><td>æ•´ä¸ªé¡¹ç›®å‘¨æœŸçš„å„ä¸ªé˜¶æ®µ</td></tr><tr><td>æ„ä¹‰</td><td>åˆåŒæ”¶å°¾è¡¨æ˜ç”²ä¹™åŒæ–¹ä¸å†æœ‰åˆåŒå…³ç³»</td><td>è¡Œæ”¿æ”¶å°¾å¸¸ç”¨äºåç»­æµç¨‹ä»¥åŠç»éªŒæ€»ç»“ï¼ˆæ‰€ä»¥åˆåŒæ”¶å°¾åœ¨å‰è¡Œæ”¿æ”¶å°¾åœ¨åï¼‰</td></tr><tr><td>è´Ÿè´£äºº</td><td>ç®¡ç†å‘˜ï¼ˆé¡¹ç›®ç»ç†ï¼‰</td><td>é¡¹ç›®å‘èµ·äººæˆ–é«˜å±‚</td></tr></tbody></table><h4 id="5ï¼‰é‡‡è´­å®¡è®¡"><a href="#5ï¼‰é‡‡è´­å®¡è®¡" class="headerlink" title="5ï¼‰é‡‡è´­å®¡è®¡"></a>5ï¼‰é‡‡è´­å®¡è®¡</h4><h5 id="1-åŸåˆ™"><a href="#1-åŸåˆ™" class="headerlink" title="1. åŸåˆ™"></a>1. åŸåˆ™</h5><ul><li>ä»é‡‡è´­è®¡åˆ’ç¼–åˆ¶åˆ°åˆåŒç®¡ç†çš„æ•´ä¸ªé‡‡è´­è¿‡ç¨‹è¿›è¡Œç³»ç»Ÿçš„å®¡æŸ¥</li></ul><h5 id="2-ç›®çš„"><a href="#2-ç›®çš„" class="headerlink" title="2. ç›®çš„"></a>2. ç›®çš„</h5><ul><li><strong>æ‰¾å‡ºå¯ä¾›æœ¬é¡¹ç›®å…¶ä»–é‡‡è´­åˆåŒç»„ç»‡å†…å…¶ä»–é¡¹ç›®å€Ÿé‰´çš„æˆåŠŸæˆ–å¤±è´¥çš„ç»éªŒ</strong></li></ul><h4 id="6ï¼‰åˆåŒç»“æŸ-vs-ç´¢èµ”ç®¡ç†"><a href="#6ï¼‰åˆåŒç»“æŸ-vs-ç´¢èµ”ç®¡ç†" class="headerlink" title="6ï¼‰åˆåŒç»“æŸ vs ç´¢èµ”ç®¡ç†"></a>6ï¼‰åˆåŒç»“æŸ vs ç´¢èµ”ç®¡ç†</h4><h5 id="1-åˆåŒç»“æŸçš„å‡ ç§æ–¹å¼"><a href="#1-åˆåŒç»“æŸçš„å‡ ç§æ–¹å¼" class="headerlink" title="1. åˆåŒç»“æŸçš„å‡ ç§æ–¹å¼"></a>1. åˆåŒç»“æŸçš„å‡ ç§æ–¹å¼</h5><h6 id="æˆåŠŸå®Œæˆï¼š"><a href="#æˆåŠŸå®Œæˆï¼š" class="headerlink" title="æˆåŠŸå®Œæˆï¼š"></a>æˆåŠŸå®Œæˆï¼š</h6><ul><li>ä¸€æ‰‹äº¤é’±ï¼Œä¸€æ‰‹äº¤è´§ï¼Œçš†å¤§æ¬¢å–œï¼Œä¸‹æ¬¡å†æ¥</li></ul><h6 id="åŒæ–¹åå•†ç»ˆæ­¢åˆåŒï¼š"><a href="#åŒæ–¹åå•†ç»ˆæ­¢åˆåŒï¼š" class="headerlink" title="åŒæ–¹åå•†ç»ˆæ­¢åˆåŒï¼š"></a>åŒæ–¹åå•†ç»ˆæ­¢åˆåŒï¼š</h6><ul><li>å¥½èšå¥½æ•£ï¼Œåä¼šæœ‰æœŸ</li></ul><h6 id="é‡å¤§è¿çº¦ï¼šï¼ˆ-ï¼‰"><a href="#é‡å¤§è¿çº¦ï¼šï¼ˆ-ï¼‰" class="headerlink" title="é‡å¤§è¿çº¦ï¼šï¼ˆ***ï¼‰"></a>é‡å¤§è¿çº¦ï¼šï¼ˆ***ï¼‰</h6><ul><li><strong>å¯èƒ½å‡ºç°ç½šæ¬¾äº‰è®®ï¼Œä»²è£ç”šè‡³è¯‰è®¼</strong></li></ul><h5 id="2-ç´¢èµ”ç®¡ç†"><a href="#2-ç´¢èµ”ç®¡ç†" class="headerlink" title="2. ç´¢èµ”ç®¡ç†"></a>2. ç´¢èµ”ç®¡ç†</h5><h6 id="ä¼ ç»Ÿäº‰è®®çš„è§£å†³æ–¹æ³•ï¼š"><a href="#ä¼ ç»Ÿäº‰è®®çš„è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="ä¼ ç»Ÿäº‰è®®çš„è§£å†³æ–¹æ³•ï¼š"></a>ä¼ ç»Ÿäº‰è®®çš„è§£å†³æ–¹æ³•ï¼š</h6><ul><li>è°ˆåˆ¤ã€è¯‰è®¼</li><li><strong>è°ˆåˆ¤æ˜¯è§£å†³æ‰€æœ‰ç´¢èµ”å’Œäº‰è®®çš„é¦–é€‰æ–¹æ³•</strong></li></ul><h6 id="æ›¿ä»£äº‰è®®çš„è§£å†³æ–¹æ³•ï¼ˆADRï¼‰ï¼š"><a href="#æ›¿ä»£äº‰è®®çš„è§£å†³æ–¹æ³•ï¼ˆADRï¼‰ï¼š" class="headerlink" title="æ›¿ä»£äº‰è®®çš„è§£å†³æ–¹æ³•ï¼ˆADRï¼‰ï¼š"></a>æ›¿ä»£äº‰è®®çš„è§£å†³æ–¹æ³•ï¼ˆADRï¼‰ï¼š</h6><ul><li>è°ƒè§£ã€ä»²è£</li></ul><h6 id="å¤„ç†è¿‡ç¨‹ï¼š"><a href="#å¤„ç†è¿‡ç¨‹ï¼š" class="headerlink" title="å¤„ç†è¿‡ç¨‹ï¼š"></a>å¤„ç†è¿‡ç¨‹ï¼š</h6><ul><li>é€šå¸¸ä¼šæŒ‰ç…§åˆåŒæ¡æ¬¾å¯¹ç´¢èµ”è¿›è¡Œè®°å½•ã€å¤„ç†ã€ç›‘ç£å’Œç®¡ç†</li><li>å¦‚æœåˆåŒåŒæ–¹æ— æ³•è‡ªè¡Œè§£å†³ç´¢èµ”é—®é¢˜ï¼Œåˆ™æŒ‰åˆåŒä¸­è§„å®šçš„ ADR å»å¤„ç†</li></ul><h3 id="5ã€æ‹›æŠ•æ ‡ç›¸å…³çŸ¥è¯†"><a href="#5ã€æ‹›æŠ•æ ‡ç›¸å…³çŸ¥è¯†" class="headerlink" title="5ã€æ‹›æŠ•æ ‡ç›¸å…³çŸ¥è¯†"></a>5ã€æ‹›æŠ•æ ‡ç›¸å…³çŸ¥è¯†</h3><h4 id="1ï¼‰æ‹›æŠ•æ ‡çš„å‚ä¸è€…"><a href="#1ï¼‰æ‹›æŠ•æ ‡çš„å‚ä¸è€…" class="headerlink" title="1ï¼‰æ‹›æŠ•æ ‡çš„å‚ä¸è€…"></a>1ï¼‰æ‹›æŠ•æ ‡çš„å‚ä¸è€…</h4><ul><li><p>æ‹›æ ‡äººã€æ‹›æ ‡ä»£ç†æœºæ„ã€æŠ•æ ‡äººæ„æˆæ‹›æŠ•æ ‡çš„å‚ä¸è€…</p></li><li><p>æ‹›æ ‡äººæœ‰æƒè‡ªè¡Œé€‰æ‹©æ‹›æ ‡ä»£ç†æœºæ„ï¼Œå§”æ‰˜å…¶åŠç†æ‹›æ ‡äº‹å®œ</p></li><li><p><strong>æ‹›æ ‡äººå…·æœ‰ç¼–åˆ¶æ‹›æ ‡æ–‡ä»¶å’Œç»„ç»‡è¯„æ ‡çš„èƒ½åŠ›ï¼Œåˆ™å¯ä»¥è‡ªè¡ŒåŠç†æ‹›æ ‡äº‹å®œ</strong></p></li><li><p>åœ¨æ‹›æ ‡æ–‡ä»¶è¦æ±‚<strong>æäº¤æŠ•æ ‡æ–‡ä»¶æˆªæ­¢æ—¶é—´è‡³å°‘15å¤©å‰</strong>ï¼Œæ‹›æ ‡äººå¯ä»¥ä»¥ä¹¦é¢çš„å½¢å¼å¯¹å·²å‘å‡ºçš„æ‹›æ ‡æ–‡ä»¶è¿›è¡Œå¿…è¦çš„æ¾„æ¸…å’Œä¿®æ”¹</p></li><li><p>æ‹›æ ‡äººä¸å¾—ä»¥ä¸åˆç†çš„æ¡ä»¶é™åˆ¶æˆ–æ’æ–¥æ½œåœ¨çš„æŠ•æ ‡äººï¼Œä¸å¾—æœ‰æ­§è§†å¾…é‡ï¼Œä¸€åˆ‡éœ€éµå¾ªå…¬å¹³å…¬æ­£åŸåˆ™</p></li><li><p><strong>ä¾æ³•å¿…é¡»è¿›è¡Œæ‹›æŠ•æ ‡çš„é¡¹ç›®ï¼Œè‡ªæ‹›æ ‡æ–‡ä»¶å‘å‡ºä¹‹æ—¥èµ·åˆ°æäº¤æŠ•æ ‡æ–‡ä»¶æˆªæ­¢æ—¥ä¸ºæ­¢ï¼ŒæœŸé—´æœ€çŸ­ä¸å¾—å°‘äº20å¤©</strong></p></li></ul><h4 id="2ï¼‰æ‹›æŠ•æ ‡ç¨‹åºï¼ˆ-ï¼‰"><a href="#2ï¼‰æ‹›æŠ•æ ‡ç¨‹åºï¼ˆ-ï¼‰" class="headerlink" title="2ï¼‰æ‹›æŠ•æ ‡ç¨‹åºï¼ˆ***ï¼‰"></a>2ï¼‰æ‹›æŠ•æ ‡ç¨‹åºï¼ˆ***ï¼‰</h4><h5 id="1-æ‹›æŠ•æ ‡é¡ºåº"><a href="#1-æ‹›æŠ•æ ‡é¡ºåº" class="headerlink" title="1. æ‹›æŠ•æ ‡é¡ºåº"></a>1. æ‹›æŠ•æ ‡é¡ºåº</h5><ul><li>å…¬å¼€æ‹›æ ‡ï¼Œåº”å½“å‘å¸ƒæ‹›æ ‡å…¬å‘Š</li><li>é‚€è¯·æ‹›æ ‡ï¼Œåº”å½“å‘ä¸‰ä¸ªä»¥ä¸Šå…·å¤‡æ‰¿æ‹…æ‹›æ ‡é¡¹ç›®èƒ½åŠ›ã€èµ„ä¿¡è‰¯å¥½çš„ç‰¹å®šæ³•äººæˆ–ç»„ç»‡å‘å‡ºæŠ•æ ‡é‚€è¯·ä¹¦</li><li>æ‹›æ ‡äººæ ¹æ®æ‹›æ ‡é¡¹ç›®çš„å…·ä½“æƒ…å†µï¼Œå¯ä»¥ç»„ç»‡æ½œåœ¨æŠ•æ ‡äººå‹˜æ¢é¡¹ç›®ç°åœº</li><li>æŠ•æ ‡äººæŠ•æ ‡</li><li>å¼€æ ‡</li><li>è¯„æ ‡</li><li>ç¡®å®šä¸­æ ‡äºº</li><li>è®¢ç«‹åˆåŒ</li></ul><h5 id="2-å›¾è§£"><a href="#2-å›¾è§£" class="headerlink" title="2. å›¾è§£"></a>2. å›¾è§£</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210911182949480.png" alt="image-20210911182949480"></p><h5 id="3-å·¥ç¨‹æ–½å·¥æ‹›æ ‡ç¨‹åº"><a href="#3-å·¥ç¨‹æ–½å·¥æ‹›æ ‡ç¨‹åº" class="headerlink" title="3. å·¥ç¨‹æ–½å·¥æ‹›æ ‡ç¨‹åº"></a>3. å·¥ç¨‹æ–½å·¥æ‹›æ ‡ç¨‹åº</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210911192432587.png" alt="image-20210911192432587"></p><h4 id="2ï¼‰æ‹›æŠ•"><a href="#2ï¼‰æ‹›æŠ•" class="headerlink" title="2ï¼‰æ‹›æŠ•"></a>2ï¼‰æ‹›æŠ•</h4><h5 id="1-å…¬å¼€æ‹›æ ‡"><a href="#1-å…¬å¼€æ‹›æ ‡" class="headerlink" title="1. å…¬å¼€æ‹›æ ‡"></a>1. å…¬å¼€æ‹›æ ‡</h5><ul><li>æŒ‡æ‹›æ ‡äººä»¥<strong>æ‹›æ ‡å…¬å‘Š</strong>çš„æ–¹å¼é‚€è¯·ä¸ç‰¹å®šçš„æ³•äººæˆ–å…¶ä»–ç»„ç»‡æŠ•æ ‡</li></ul><h5 id="2-é‚€è¯·æ‹›æ ‡"><a href="#2-é‚€è¯·æ‹›æ ‡" class="headerlink" title="2. é‚€è¯·æ‹›æ ‡"></a>2. é‚€è¯·æ‹›æ ‡</h5><ul><li>æŒ‡æ‹›æ ‡äººä»¥<strong>æŠ•æ ‡é‚€è¯·ä¹¦</strong>çš„æ–¹å¼é‚€è¯·ç‰¹å®šçš„æ³•äººæˆ–å…¶ä»–ç»„ç»‡æŠ•æ ‡</li></ul><h4 id="3ï¼‰æŠ•æ ‡"><a href="#3ï¼‰æŠ•æ ‡" class="headerlink" title="3ï¼‰æŠ•æ ‡"></a>3ï¼‰æŠ•æ ‡</h4><h5 id="1-æŠ•æ ‡äºº"><a href="#1-æŠ•æ ‡äºº" class="headerlink" title="1. æŠ•æ ‡äºº"></a>1. æŠ•æ ‡äºº</h5><ul><li><strong>ä¸¤ä¸ªä»¥ä¸Šæ³•äººæˆ–å…¶ä»–ç»„ç»‡å¯ä»¥ç»„æˆä¸€ä¸ªè”åˆä½“</strong>ï¼Œä»¥ä¸€ä¸ªæŠ•æ ‡äººçš„èº«ä»½å…±åŒæŠ•æ ‡</li></ul><h5 id="2-æŠ•æ ‡æ–‡ä»¶çš„ä¿®æ”¹"><a href="#2-æŠ•æ ‡æ–‡ä»¶çš„ä¿®æ”¹" class="headerlink" title="2. æŠ•æ ‡æ–‡ä»¶çš„ä¿®æ”¹"></a>2. æŠ•æ ‡æ–‡ä»¶çš„ä¿®æ”¹</h5><ul><li>æŠ•æ ‡äººåœ¨æŠ•æ ‡æ–‡ä»¶è¦æ±‚æäº¤æŠ•æ ‡æ–‡ä»¶çš„æˆªæ­¢æ—¶é—´å‰ï¼Œå¯ä»¥è¡¥å……ã€ä¿®æ”¹æˆ–æ’¤å›å·²æäº¤çš„æŠ•æ ‡æ–‡ä»¶ï¼Œå¹¶ä¹¦é¢é€šçŸ¥æ‹›æ ‡äºº</li></ul><h5 id="3-æŠ•æ ‡è¿è§„çš„æƒ…å†µ"><a href="#3-æŠ•æ ‡è¿è§„çš„æƒ…å†µ" class="headerlink" title="3. æŠ•æ ‡è¿è§„çš„æƒ…å†µ"></a>3. æŠ•æ ‡è¿è§„çš„æƒ…å†µ</h5><ul><li>æŠ•æ ‡äººä»¥ä»–äººåä¹‰æŠ•æ ‡æˆ–ä»¥å…¶ä»–æ–¹å¼å¼„è™šä½œå‡ï¼Œéª—å–ä¸­æ ‡çš„ï¼Œåˆ™è§†ä½œä¸­æ ‡æ— æ•ˆï¼Œç»™æ‹›æ ‡äººé€ æˆçš„æŸå¤±ï¼Œä¾æ³•æ‰¿æ‹…èµ”å¿è´£ä»»ï¼Œå¦‚æ„æˆçŠ¯ç½ªï¼Œåˆ™ä¾æ³•è¿½ç©¶åˆ‘äº‹è´£ä»»</li></ul><h4 id="4ï¼‰å¼€æ ‡"><a href="#4ï¼‰å¼€æ ‡" class="headerlink" title="4ï¼‰å¼€æ ‡"></a>4ï¼‰å¼€æ ‡</h4><h5 id="1-å¼€æ ‡æ—¶é—´"><a href="#1-å¼€æ ‡æ—¶é—´" class="headerlink" title="1. å¼€æ ‡æ—¶é—´"></a>1. å¼€æ ‡æ—¶é—´</h5><ul><li>å¼€æ ‡åº”å½“åœ¨æ‹›æ ‡æ–‡ä»¶ç¡®å®šçš„æäº¤æŠ•æ ‡æ–‡ä»¶ç¡®å®šçš„æäº¤æŠ•æ ‡æ–‡ä»¶æˆªæ­¢æ—¶é—´çš„åŒä¸€æ—¶é—´å…¬å¼€è¿›è¡Œ</li></ul><h5 id="2-å¼€æ ‡åœ°ç‚¹"><a href="#2-å¼€æ ‡åœ°ç‚¹" class="headerlink" title="2. å¼€æ ‡åœ°ç‚¹"></a>2. å¼€æ ‡åœ°ç‚¹</h5><ul><li>å¼€æ ‡åœ°ç‚¹åº”å½“ä¸ºæ‹›æ ‡æ–‡ä»¶ä¸­é¢„å…ˆç¡®å®šçš„åœ°ç‚¹</li></ul><h5 id="3-ä¸»æŒäºº"><a href="#3-ä¸»æŒäºº" class="headerlink" title="3. ä¸»æŒäºº"></a>3. ä¸»æŒäºº</h5><ul><li>å¼€æ ‡æœ‰æ‹›æ ‡äººä¸»æŒï¼Œé‚€è¯·æ‰€æœ‰æŠ•æ ‡äººå‚åŠ </li></ul><h5 id="4-æ£€æŸ¥å…¬è¯"><a href="#4-æ£€æŸ¥å…¬è¯" class="headerlink" title="4. æ£€æŸ¥å…¬è¯"></a>4. æ£€æŸ¥å…¬è¯</h5><ul><li>å¼€æ ‡æ—¶ï¼Œç”±æŠ•æ ‡äººæˆ–å…¶æ¨é€‰çš„ä»£è¡¨æ£€æŸ¥æŠ•æ ‡æ–‡ä»¶çš„å¯†å°æƒ…å†µï¼›ä¹Ÿå¯ä»¥ç”±æ‹›æ ‡äººå§”æ‰˜çš„å…¬è¯æœºæ„æ£€æŸ¥å…¬è¯</li></ul><h4 id="5ï¼‰è¯„æ ‡"><a href="#5ï¼‰è¯„æ ‡" class="headerlink" title="5ï¼‰è¯„æ ‡"></a>5ï¼‰è¯„æ ‡</h4><h5 id="1-è´Ÿè´£æ–¹"><a href="#1-è´Ÿè´£æ–¹" class="headerlink" title="1. è´Ÿè´£æ–¹"></a>1. è´Ÿè´£æ–¹</h5><ul><li>è¯„æ ‡ç”±æ‹›æ ‡äººä¾æ³•ç»„å»ºçš„è¯„æ ‡å§”å‘˜ä¼šè´Ÿè´£</li></ul><h5 id="2-è¯„æ ‡å§”å‘˜ä¼š"><a href="#2-è¯„æ ‡å§”å‘˜ä¼š" class="headerlink" title="2. è¯„æ ‡å§”å‘˜ä¼š"></a>2. è¯„æ ‡å§”å‘˜ä¼š</h5><ul><li>è¯„æ ‡å§”å‘˜ä¼šç”±æ‹›æ ‡äººä»£è¡¨å’Œæœ‰å…³æŠ€æœ¯ã€ç»æµç­‰æ–¹é¢çš„ä¸“å®¶ç»„æˆ</li></ul><h5 id="3-è¯„æ ‡å§”å‘˜ä¼šçš„æƒèƒ½"><a href="#3-è¯„æ ‡å§”å‘˜ä¼šçš„æƒèƒ½" class="headerlink" title="3. è¯„æ ‡å§”å‘˜ä¼šçš„æƒèƒ½"></a>3. è¯„æ ‡å§”å‘˜ä¼šçš„æƒèƒ½</h5><ul><li>è¯„æ ‡å§”å‘˜ä¼šå¯ä»¥è¦æ±‚æŠ•æ ‡äººå¯¹æŠ•æ ‡æ–‡ä»¶ä¸­å«ä¹‰ä¸æ˜ç¡®çš„å†…å®¹åšå‡ºå¿…è¦çš„æ¾„æ¸…è¯´æ˜ï¼Œä½†ä¸å¾—è¶…å‡ºæŠ•æ ‡æ–‡ä»¶çš„èŒƒå›´æˆ–æ”¹å˜æŠ•æ ‡æ–‡ä»¶çš„å®è´¨æ€§å†…å®¹</li><li>æ‹›æ ‡äººå¯ä»¥æˆæƒè¯„æ ‡å§”å‘˜ä¼šç›´æ¥ç¡®å®šä¸­æ ‡äºº</li></ul><h4 id="6ï¼‰ä¸­æ ‡"><a href="#6ï¼‰ä¸­æ ‡" class="headerlink" title="6ï¼‰ä¸­æ ‡"></a>6ï¼‰ä¸­æ ‡</h4><h5 id="1-ä¸­æ ‡å¿…è¦æ¡ä»¶"><a href="#1-ä¸­æ ‡å¿…è¦æ¡ä»¶" class="headerlink" title="1. ä¸­æ ‡å¿…è¦æ¡ä»¶"></a>1. ä¸­æ ‡å¿…è¦æ¡ä»¶</h5><ul><li>èƒ½å¤Ÿæœ€å¤§é™åº¦åœ°æ»¡è¶³æ‹›æ ‡æ–‡ä»¶ä¸­è§„å®šçš„å„é¡¹ç»¼åˆè¯„æ ‡æ ‡å‡†</li><li>èƒ½å¤Ÿæ»¡è¶³æ‹›æ ‡æ–‡ä»¶çš„å®è´¨æ€§è¦æ±‚ï¼Œä¸”ç»è¯„å®¡çš„æŠ•æ ‡ä»·æ ¼æœ€ä½ï¼ˆæŠ•æ ‡ä»·æ ¼ä½äºæˆæœ¬é™¤å¤–ï¼‰</li></ul><h5 id="2-åˆåŒç­¾è®¢"><a href="#2-åˆåŒç­¾è®¢" class="headerlink" title="2. åˆåŒç­¾è®¢"></a>2. åˆåŒç­¾è®¢</h5><ul><li>æ‹›æ ‡äººå’Œä¸­æ ‡äººåº”å½“è‡ª<strong>ä¸­æ ‡é€šçŸ¥ä¹¦å‘å‡ºæ—¥èµ·30å¤©å†…</strong>ï¼ŒæŒ‰æ‹›æ ‡æ–‡ä»¶å’Œä¸­æ ‡äººçš„æŠ•æ ‡æ–‡ä»¶<strong>è®¢ç«‹ä¹¦é¢åˆåŒ</strong></li></ul><h2 id="ä¸‰ã€ä½œä¸š"><a href="#ä¸‰ã€ä½œä¸š" class="headerlink" title="ä¸‰ã€ä½œä¸š"></a>ä¸‰ã€ä½œä¸š</h2><h3 id="1ã€é‡‡è´­ç®¡ç†åŒ…æ‹¬å“ªå››ä¸ªè¿‡ç¨‹ï¼Ÿ"><a href="#1ã€é‡‡è´­ç®¡ç†åŒ…æ‹¬å“ªå››ä¸ªè¿‡ç¨‹ï¼Ÿ" class="headerlink" title="1ã€é‡‡è´­ç®¡ç†åŒ…æ‹¬å“ªå››ä¸ªè¿‡ç¨‹ï¼Ÿ"></a>1ã€é‡‡è´­ç®¡ç†åŒ…æ‹¬å“ªå››ä¸ªè¿‡ç¨‹ï¼Ÿ</h3><ul><li>è§„åˆ’é‡‡è´­</li><li>å®æ–½é‡‡è´­</li><li>æ§åˆ¶é‡‡è´­</li><li>ç»“æŸé‡‡è´­</li></ul><h3 id="2ã€æ”¿åºœé‡‡è´­æ³•è§„å®šçš„6ç§é‡‡è´­æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2ã€æ”¿åºœé‡‡è´­æ³•è§„å®šçš„6ç§é‡‡è´­æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€æ”¿åºœé‡‡è´­æ³•è§„å®šçš„6ç§é‡‡è´­æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2ã€æ”¿åºœé‡‡è´­æ³•è§„å®šçš„6ç§é‡‡è´­æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><p><strong>å…¬å¼€æ‹›æ ‡</strong></p></li><li><p><strong>é‚€è¯·æ‹›æ ‡</strong></p></li><li><p>ç«äº‰æ€§è°ˆåˆ¤</p></li><li><p>å•ä¸€æ¥æºé‡‡è´­</p></li><li><p>è¯¢ä»·</p></li><li><p>å…¶ä»–æ–¹å¼</p></li></ul><h3 id="3ã€è¯„æ ‡å§”å‘˜ä¼šç”±å‡ äººä»¥ä¸Šå•æ•°ç»„æˆï¼Ÿå…¶ä¸­ç»æµæŠ€æœ¯ä¸“å®¶ä¸å¾—å°‘äºå¤šå°‘ï¼Ÿ"><a href="#3ã€è¯„æ ‡å§”å‘˜ä¼šç”±å‡ äººä»¥ä¸Šå•æ•°ç»„æˆï¼Ÿå…¶ä¸­ç»æµæŠ€æœ¯ä¸“å®¶ä¸å¾—å°‘äºå¤šå°‘ï¼Ÿ" class="headerlink" title="3ã€è¯„æ ‡å§”å‘˜ä¼šç”±å‡ äººä»¥ä¸Šå•æ•°ç»„æˆï¼Ÿå…¶ä¸­ç»æµæŠ€æœ¯ä¸“å®¶ä¸å¾—å°‘äºå¤šå°‘ï¼Ÿ"></a>3ã€è¯„æ ‡å§”å‘˜ä¼šç”±å‡ äººä»¥ä¸Šå•æ•°ç»„æˆï¼Ÿå…¶ä¸­ç»æµæŠ€æœ¯ä¸“å®¶ä¸å¾—å°‘äºå¤šå°‘ï¼Ÿ</h3><ul><li>è¯„æ ‡å§”å‘˜ä¼šç”±5äººåŠä»¥ä¸Šå•æ•°ç»„æˆï¼ˆé¿å…æ„è§æŒå¹³ï¼‰</li><li>å…¶ä¸­ç»æµæŠ€æœ¯ä¸“å®¶ä¸å¾—å°‘äºæ€»äººæ•°çš„ä¸‰åˆ†ä¹‹äºŒ</li></ul><h3 id="4ã€è´¨é‡å®¡è®¡ã€é£é™©å®¡è®¡ã€é‡‡è´­å®¡è®¡ï¼Œåˆ†åˆ«åœ¨é‚£ä¸ªè¿‡ç¨‹ç»„ï¼Ÿ"><a href="#4ã€è´¨é‡å®¡è®¡ã€é£é™©å®¡è®¡ã€é‡‡è´­å®¡è®¡ï¼Œåˆ†åˆ«åœ¨é‚£ä¸ªè¿‡ç¨‹ç»„ï¼Ÿ" class="headerlink" title="4ã€è´¨é‡å®¡è®¡ã€é£é™©å®¡è®¡ã€é‡‡è´­å®¡è®¡ï¼Œåˆ†åˆ«åœ¨é‚£ä¸ªè¿‡ç¨‹ç»„ï¼Ÿ"></a>4ã€è´¨é‡å®¡è®¡ã€é£é™©å®¡è®¡ã€é‡‡è´­å®¡è®¡ï¼Œåˆ†åˆ«åœ¨é‚£ä¸ªè¿‡ç¨‹ç»„ï¼Ÿ</h3><ul><li>è´¨é‡å®¡è®¡åœ¨æ‰§è¡Œè¿‡ç¨‹ç»„ï¼ˆåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç°è´¨é‡é—®é¢˜è¦åŠæ—¶çº åï¼‰</li><li>é£é™©å®¡è®¡åœ¨ç›‘æ§è¿‡ç¨‹ç»„ï¼ˆé£é™©ä¼´éšé¡¹ç›®çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œéœ€è¦å®æ—¶ç›‘æ§ï¼‰</li><li>é‡‡è´­å®¡è®¡åœ¨æ”¶å°¾è¿‡ç¨‹ç»„ï¼ˆé‡‡è´­å®Œæˆè¦åˆåŒæ”¶å°¾ã€è¡Œæ”¿æ”¶å°¾ï¼‰</li></ul><h3 id="5ã€ç§¯æé£é™©ã€æ¶ˆæé£é™©ã€åŒæ—¶é€‚ç”¨äºç§¯æå’Œæ¶ˆæé£é™©çš„åº”å¯¹æªæ–½æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5ã€ç§¯æé£é™©ã€æ¶ˆæé£é™©ã€åŒæ—¶é€‚ç”¨äºç§¯æå’Œæ¶ˆæé£é™©çš„åº”å¯¹æªæ–½æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5ã€ç§¯æé£é™©ã€æ¶ˆæé£é™©ã€åŒæ—¶é€‚ç”¨äºç§¯æå’Œæ¶ˆæé£é™©çš„åº”å¯¹æªæ–½æ˜¯ä»€ä¹ˆï¼Ÿ"></a>5ã€ç§¯æé£é™©ã€æ¶ˆæé£é™©ã€åŒæ—¶é€‚ç”¨äºç§¯æå’Œæ¶ˆæé£é™©çš„åº”å¯¹æªæ–½æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul><li><p>ç§¯æé£é™©çš„åº”å¯¹æªæ–½</p><ul><li>å¼€æ‹“</li><li>åˆ†äº«</li><li>æé«˜</li></ul></li><li><p>æ¶ˆæé£é™©çš„åº”å¯¹æªæ–½</p><ul><li>å›é¿</li><li>è½¬ç§»</li><li>å‡è½»</li></ul></li><li><p>åŒæ—¶é€‚çš„åº”å¯¹æªæ–½ â€”â€” æ¥å—</p><ul><li>æ¶ˆæ â€”â€” è¢«åŠ¨æ¥å—</li><li>ç§¯æ â€”â€” ä¸»åŠ¨æ¥å—</li></ul></li></ul><h3 id="6ã€å¢åŠ å†—ä½™ã€å¢åŠ åº”æ€¥å‚¨å¤‡åˆ†åˆ«å±äºå“ªç§åº”å¯¹æªæ–½ï¼Ÿ"><a href="#6ã€å¢åŠ å†—ä½™ã€å¢åŠ åº”æ€¥å‚¨å¤‡åˆ†åˆ«å±äºå“ªç§åº”å¯¹æªæ–½ï¼Ÿ" class="headerlink" title="6ã€å¢åŠ å†—ä½™ã€å¢åŠ åº”æ€¥å‚¨å¤‡åˆ†åˆ«å±äºå“ªç§åº”å¯¹æªæ–½ï¼Ÿ"></a>6ã€å¢åŠ å†—ä½™ã€å¢åŠ åº”æ€¥å‚¨å¤‡åˆ†åˆ«å±äºå“ªç§åº”å¯¹æªæ–½ï¼Ÿ</h3><ul><li>å¢åŠ å†—ä½™ â€”â€” å‡è½»é£é™©</li><li>å¢åŠ åº”æ€¥å‚¨å¤‡ â€”â€” æ¥å—é£é™©</li></ul><h3 id="7ã€é£é™©ç®¡ç†åŒ…æ‹¬å“ª6ä¸ªè¿‡ç¨‹ï¼Ÿ"><a href="#7ã€é£é™©ç®¡ç†åŒ…æ‹¬å“ª6ä¸ªè¿‡ç¨‹ï¼Ÿ" class="headerlink" title="7ã€é£é™©ç®¡ç†åŒ…æ‹¬å“ª6ä¸ªè¿‡ç¨‹ï¼Ÿ"></a>7ã€é£é™©ç®¡ç†åŒ…æ‹¬å“ª6ä¸ªè¿‡ç¨‹ï¼Ÿ</h3><ul><li>åˆ¶å®šé£é™©ç®¡ç†è®¡åˆ’</li><li>é£é™©è¯†åˆ«</li><li>é£é™©å®šæ€§åˆ†æ</li><li>é£é™©å®šé‡åˆ†æ</li><li>åˆ¶è®¢é£é™©åº”å¯¹è®¡åˆ’</li><li>é£é™©ç›‘æ§</li></ul><h3 id="8ã€é£é™©å®¡è®¡è¦æ˜¯å®¡è®¡å“ªä¸¤ä¸ªæœ‰æ•ˆæ€§ï¼Ÿ"><a href="#8ã€é£é™©å®¡è®¡è¦æ˜¯å®¡è®¡å“ªä¸¤ä¸ªæœ‰æ•ˆæ€§ï¼Ÿ" class="headerlink" title="8ã€é£é™©å®¡è®¡è¦æ˜¯å®¡è®¡å“ªä¸¤ä¸ªæœ‰æ•ˆæ€§ï¼Ÿ"></a>8ã€é£é™©å®¡è®¡è¦æ˜¯å®¡è®¡å“ªä¸¤ä¸ªæœ‰æ•ˆæ€§ï¼Ÿ</h3><ul><li>é£é™©ç®¡ç†è¿‡ç¨‹çš„æœ‰æ•ˆæ€§</li><li>é£é™©åº”å¯¹æªæ–½çš„æœ‰æ•ˆæ€§</li></ul><h2 id="å››ã€é”™é¢˜å›é¡¾"><a href="#å››ã€é”™é¢˜å›é¡¾" class="headerlink" title="å››ã€é”™é¢˜å›é¡¾"></a>å››ã€é”™é¢˜å›é¡¾</h2><h4 id="1ã€é£é™©ç®¡ç†"><a href="#1ã€é£é™©ç®¡ç†" class="headerlink" title="1ã€é£é™©ç®¡ç†"></a>1ã€é£é™©ç®¡ç†</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913151501746.png" alt="image-20210913151501746"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913151717167.png" alt="image-20210913151717167"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913151736950.png" alt="image-20210913151736950"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913151750564.png" alt="image-20210913151750564"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913151836990.png" alt="image-20210913151836990"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913151855663.png" alt="image-20210913151855663"></p><h3 id="2ã€é‡‡è´­ç®¡ç†"><a href="#2ã€é‡‡è´­ç®¡ç†" class="headerlink" title="2ã€é‡‡è´­ç®¡ç†"></a>2ã€é‡‡è´­ç®¡ç†</h3>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬5ç« ã€é¡¹ç›®çš„è´¨é‡ç®¡ç†å’ŒäººåŠ›ç®¡ç†</title>
    <link href="/2021/08/31/%E7%AC%AC5%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%B4%A8%E9%87%8F%E7%AE%A1%E7%90%86%E5%92%8C%E4%BA%BA%E5%8A%9B%E7%AE%A1%E7%90%86/"/>
    <url>/2021/08/31/%E7%AC%AC5%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%B4%A8%E9%87%8F%E7%AE%A1%E7%90%86%E5%92%8C%E4%BA%BA%E5%8A%9B%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬5ç« ã€é¡¹ç›®çš„è´¨é‡ç®¡ç†å’ŒäººåŠ›ç®¡ç†"><a href="#ç¬¬5ç« ã€é¡¹ç›®çš„è´¨é‡ç®¡ç†å’ŒäººåŠ›ç®¡ç†" class="headerlink" title="ç¬¬5ç« ã€é¡¹ç›®çš„è´¨é‡ç®¡ç†å’ŒäººåŠ›ç®¡ç†"></a>ç¬¬5ç« ã€é¡¹ç›®çš„è´¨é‡ç®¡ç†å’ŒäººåŠ›ç®¡ç†</h1><span id="more"></span><h2 id="ä¸€ã€è´¨é‡ç®¡ç†"><a href="#ä¸€ã€è´¨é‡ç®¡ç†" class="headerlink" title="ä¸€ã€è´¨é‡ç®¡ç†"></a>ä¸€ã€è´¨é‡ç®¡ç†</h2><h3 id="1ã€è´¨é‡ç®¡ç†æ¦‚è¿°"><a href="#1ã€è´¨é‡ç®¡ç†æ¦‚è¿°" class="headerlink" title="1ã€è´¨é‡ç®¡ç†æ¦‚è¿°"></a>1ã€è´¨é‡ç®¡ç†æ¦‚è¿°</h3><h4 id="1ï¼‰åŸºç¡€çŸ¥è¯†"><a href="#1ï¼‰åŸºç¡€çŸ¥è¯†" class="headerlink" title="1ï¼‰åŸºç¡€çŸ¥è¯†"></a>1ï¼‰åŸºç¡€çŸ¥è¯†</h4><h5 id="1-è´¨é‡"><a href="#1-è´¨é‡" class="headerlink" title="1. è´¨é‡"></a>1. è´¨é‡</h5><ul><li>åæ˜ å®ä½“æ»¡è¶³ä¸»ä½“æ˜ç¡®å’Œéšå«éœ€æ±‚çš„èƒ½åŠ›çš„ç‰¹æ€§çš„æ€»å’Œ</li></ul><h5 id="2-è´¨é‡ç®¡ç†"><a href="#2-è´¨é‡ç®¡ç†" class="headerlink" title="2. è´¨é‡ç®¡ç†"></a>2. è´¨é‡ç®¡ç†</h5><ul><li>ç¡®å®šè´¨é‡æ–¹é’ˆã€ç›®æ ‡å’ŒèŒè´£ï¼Œå¹¶é€šè¿‡è´¨é‡ä½“ç³»ä¸­çš„è´¨é‡è§„åˆ’ã€è´¨é‡ä¿è¯ã€è´¨é‡æ§åˆ¶ä»¥åŠè´¨é‡æ”¹è¿›æ¥ä½¿å…¶å®ç°æ‰€æœ‰ç®¡ç†èŒèƒ½çš„å…¨éƒ¨æ´»åŠ¨</li></ul><h5 id="3-è´¨é‡æ–¹é’ˆ"><a href="#3-è´¨é‡æ–¹é’ˆ" class="headerlink" title="3. è´¨é‡æ–¹é’ˆ"></a>3. è´¨é‡æ–¹é’ˆ</h5><ul><li>ç”±ç»„ç»‡çš„æœ€é«˜ç®¡ç†è€…æ­£å¼å‘å¸ƒçš„è¯¥ç»„ç»‡æ€»çš„è´¨é‡å®—æ—¨å’Œæ–¹å‘</li></ul><h5 id="4-è´¨é‡ç›®æ ‡"><a href="#4-è´¨é‡ç›®æ ‡" class="headerlink" title="4. è´¨é‡ç›®æ ‡"></a>4. è´¨é‡ç›®æ ‡</h5><ul><li>åœ¨è´¨é‡æ–¹é¢æ‰€è¿½æ±‚çš„ç›®çš„</li><li><strong>æ˜¯è½å®è´¨é‡æ–¹é’ˆçš„å…·ä½“éœ€æ±‚</strong></li></ul><h4 id="2ï¼‰è´¨é‡ç®¡ç†ä½“ç³»"><a href="#2ï¼‰è´¨é‡ç®¡ç†ä½“ç³»" class="headerlink" title="2ï¼‰è´¨é‡ç®¡ç†ä½“ç³»"></a>2ï¼‰è´¨é‡ç®¡ç†ä½“ç³»</h4><h5 id="1-ISO9000ç³»åˆ—ï¼Œ8-é¡¹åŸºæœ¬åŸåˆ™"><a href="#1-ISO9000ç³»åˆ—ï¼Œ8-é¡¹åŸºæœ¬åŸåˆ™" class="headerlink" title="1. ISO9000ç³»åˆ—ï¼Œ8 é¡¹åŸºæœ¬åŸåˆ™"></a>1. ISO9000ç³»åˆ—ï¼Œ8 é¡¹åŸºæœ¬åŸåˆ™</h5><ul><li>ä»¥é¡¾å®¢ä¸ºä¸­å¿ƒ</li><li>é¢†å¯¼ä½œç”¨</li><li>å…¨å‘˜å‚ä¸</li><li>è¿‡ç¨‹æ–¹æ³•</li><li>ç®¡ç†çš„ç³»ç»Ÿæ–¹æ³•</li><li>æŒç»­æ”¹è¿›</li><li>åŸºäºäº‹å®çš„å†³ç­–æ–¹æ³•</li><li>ä¸ä¾›æ–¹äº’åˆ©çš„å…³ç³»</li></ul><h4 id="3ï¼‰å…¨é¢è´¨é‡ç®¡ç†"><a href="#3ï¼‰å…¨é¢è´¨é‡ç®¡ç†" class="headerlink" title="3ï¼‰å…¨é¢è´¨é‡ç®¡ç†"></a>3ï¼‰å…¨é¢è´¨é‡ç®¡ç†</h4><h4 id="4ï¼‰å…­è¥¿æ ¼ç›"><a href="#4ï¼‰å…­è¥¿æ ¼ç›" class="headerlink" title="4ï¼‰å…­è¥¿æ ¼ç›"></a>4ï¼‰å…­è¥¿æ ¼ç›</h4><h3 id="2ã€è§„åˆ’è´¨é‡ç®¡ç†"><a href="#2ã€è§„åˆ’è´¨é‡ç®¡ç†" class="headerlink" title="2ã€è§„åˆ’è´¨é‡ç®¡ç†"></a>2ã€è§„åˆ’è´¨é‡ç®¡ç†</h3><h4 id="1ï¼‰è¾“å…¥"><a href="#1ï¼‰è¾“å…¥" class="headerlink" title="1ï¼‰è¾“å…¥"></a>1ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-å¹²ç³»äººç™»è®°å†Œ"><a href="#2-å¹²ç³»äººç™»è®°å†Œ" class="headerlink" title="2. å¹²ç³»äººç™»è®°å†Œ"></a>2. å¹²ç³»äººç™»è®°å†Œ</h5><h5 id="3-é£é™©ç™»è®°å†Œ"><a href="#3-é£é™©ç™»è®°å†Œ" class="headerlink" title="3. é£é™©ç™»è®°å†Œ"></a>3. é£é™©ç™»è®°å†Œ</h5><h5 id="4-éœ€æ±‚æ–‡ä»¶"><a href="#4-éœ€æ±‚æ–‡ä»¶" class="headerlink" title="4. éœ€æ±‚æ–‡ä»¶"></a>4. éœ€æ±‚æ–‡ä»¶</h5><h5 id="5-äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#5-äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="5. äº‹ä¸šç¯å¢ƒå› ç´ "></a>5. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="6-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#6-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="6. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>6. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="2ï¼‰å·¥å…·å’ŒæŠ€æœ¯"><a href="#2ï¼‰å·¥å…·å’ŒæŠ€æœ¯" class="headerlink" title="2ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>2ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-æˆæœ¬æ•ˆç›Šåˆ†æ"><a href="#1-æˆæœ¬æ•ˆç›Šåˆ†æ" class="headerlink" title="1. æˆæœ¬æ•ˆç›Šåˆ†æ"></a>1. æˆæœ¬æ•ˆç›Šåˆ†æ</h5><h5 id="2-è´¨é‡æˆæœ¬"><a href="#2-è´¨é‡æˆæœ¬" class="headerlink" title="2. è´¨é‡æˆæœ¬"></a>2. è´¨é‡æˆæœ¬</h5><h5 id="3-å…¶ä¸­åŸºæœ¬è´¨é‡å·¥å…·"><a href="#3-å…¶ä¸­åŸºæœ¬è´¨é‡å·¥å…·" class="headerlink" title="3. å…¶ä¸­åŸºæœ¬è´¨é‡å·¥å…·"></a>3. å…¶ä¸­åŸºæœ¬è´¨é‡å·¥å…·</h5><h5 id="4-æ ‡æ†å¯¹ç…§"><a href="#4-æ ‡æ†å¯¹ç…§" class="headerlink" title="4. æ ‡æ†å¯¹ç…§"></a>4. æ ‡æ†å¯¹ç…§</h5><h5 id="5-å®éªŒè®¾è®¡"><a href="#5-å®éªŒè®¾è®¡" class="headerlink" title="5. å®éªŒè®¾è®¡"></a>5. å®éªŒè®¾è®¡</h5><h5 id="6-ç»Ÿè®¡æŠ½æ ·"><a href="#6-ç»Ÿè®¡æŠ½æ ·" class="headerlink" title="6. ç»Ÿè®¡æŠ½æ ·"></a>6. ç»Ÿè®¡æŠ½æ ·</h5><h5 id="7-å…¶ä»–è´¨é‡ç®¡ç†å·¥å…·"><a href="#7-å…¶ä»–è´¨é‡ç®¡ç†å·¥å…·" class="headerlink" title="7. å…¶ä»–è´¨é‡ç®¡ç†å·¥å…·"></a>7. å…¶ä»–è´¨é‡ç®¡ç†å·¥å…·</h5><h5 id="8-ä¼šè®®"><a href="#8-ä¼šè®®" class="headerlink" title="8. ä¼šè®®"></a>8. ä¼šè®®</h5><h4 id="3ï¼‰è¾“å‡º"><a href="#3ï¼‰è¾“å‡º" class="headerlink" title="3ï¼‰è¾“å‡º"></a>3ï¼‰è¾“å‡º</h4><h5 id="1-è´¨é‡ç®¡ç†è®¡åˆ’"><a href="#1-è´¨é‡ç®¡ç†è®¡åˆ’" class="headerlink" title="1. è´¨é‡ç®¡ç†è®¡åˆ’"></a>1. è´¨é‡ç®¡ç†è®¡åˆ’</h5><h5 id="2-è¿‡ç¨‹æ”¹è¿›è®¡åˆ’"><a href="#2-è¿‡ç¨‹æ”¹è¿›è®¡åˆ’" class="headerlink" title="2. è¿‡ç¨‹æ”¹è¿›è®¡åˆ’"></a>2. è¿‡ç¨‹æ”¹è¿›è®¡åˆ’</h5><h5 id="3-è´¨é‡æµ‹é‡æŒ‡æ ‡"><a href="#3-è´¨é‡æµ‹é‡æŒ‡æ ‡" class="headerlink" title="3. è´¨é‡æµ‹é‡æŒ‡æ ‡"></a>3. è´¨é‡æµ‹é‡æŒ‡æ ‡</h5><h5 id="4-è´¨é‡æ ¸å¯¹å•"><a href="#4-è´¨é‡æ ¸å¯¹å•" class="headerlink" title="4. è´¨é‡æ ¸å¯¹å•"></a>4. è´¨é‡æ ¸å¯¹å•</h5><h5 id="5-é¡¹ç›®æ–‡ä»¶æ›´æ–°"><a href="#5-é¡¹ç›®æ–‡ä»¶æ›´æ–°" class="headerlink" title="5. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>5. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h3 id="3ã€å®æ–½è´¨é‡ä¿è¯"><a href="#3ã€å®æ–½è´¨é‡ä¿è¯" class="headerlink" title="3ã€å®æ–½è´¨é‡ä¿è¯"></a>3ã€å®æ–½è´¨é‡ä¿è¯</h3><h4 id="1ï¼‰è¾“å…¥-1"><a href="#1ï¼‰è¾“å…¥-1" class="headerlink" title="1ï¼‰è¾“å…¥"></a>1ï¼‰è¾“å…¥</h4><h5 id="1-è´¨é‡ç®¡ç†è®¡åˆ’-1"><a href="#1-è´¨é‡ç®¡ç†è®¡åˆ’-1" class="headerlink" title="1. è´¨é‡ç®¡ç†è®¡åˆ’"></a>1. è´¨é‡ç®¡ç†è®¡åˆ’</h5><h5 id="2-è¿‡ç¨‹æ”¹è¿›è®¡åˆ’-1"><a href="#2-è¿‡ç¨‹æ”¹è¿›è®¡åˆ’-1" class="headerlink" title="2. è¿‡ç¨‹æ”¹è¿›è®¡åˆ’"></a>2. è¿‡ç¨‹æ”¹è¿›è®¡åˆ’</h5><h5 id="3-è´¨é‡æµ‹é‡æŒ‡æ ‡-1"><a href="#3-è´¨é‡æµ‹é‡æŒ‡æ ‡-1" class="headerlink" title="3. è´¨é‡æµ‹é‡æŒ‡æ ‡"></a>3. è´¨é‡æµ‹é‡æŒ‡æ ‡</h5><h5 id="4-è´¨é‡æ§åˆ¶æµ‹é‡ç»“æœ"><a href="#4-è´¨é‡æ§åˆ¶æµ‹é‡ç»“æœ" class="headerlink" title="4. è´¨é‡æ§åˆ¶æµ‹é‡ç»“æœ"></a>4. è´¨é‡æ§åˆ¶æµ‹é‡ç»“æœ</h5><h5 id="5-é¡¹ç›®æ–‡ä»¶"><a href="#5-é¡¹ç›®æ–‡ä»¶" class="headerlink" title="5. é¡¹ç›®æ–‡ä»¶"></a>5. é¡¹ç›®æ–‡ä»¶</h5><h4 id="2ï¼‰å·¥å…·å’ŒæŠ€æœ¯-1"><a href="#2ï¼‰å·¥å…·å’ŒæŠ€æœ¯-1" class="headerlink" title="2ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>2ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-è´¨é‡ç®¡ç†ä¸æ§åˆ¶å·¥å…·"><a href="#1-è´¨é‡ç®¡ç†ä¸æ§åˆ¶å·¥å…·" class="headerlink" title="1. è´¨é‡ç®¡ç†ä¸æ§åˆ¶å·¥å…·"></a>1. è´¨é‡ç®¡ç†ä¸æ§åˆ¶å·¥å…·</h5><h5 id="2-è´¨é‡å®¡è®¡"><a href="#2-è´¨é‡å®¡è®¡" class="headerlink" title="2. è´¨é‡å®¡è®¡"></a>2. è´¨é‡å®¡è®¡</h5><h5 id="3-è¿‡ç¨‹åˆ†æ"><a href="#3-è¿‡ç¨‹åˆ†æ" class="headerlink" title="3. è¿‡ç¨‹åˆ†æ"></a>3. è¿‡ç¨‹åˆ†æ</h5><h4 id="3ï¼‰è¾“å‡º-1"><a href="#3ï¼‰è¾“å‡º-1" class="headerlink" title="3ï¼‰è¾“å‡º"></a>3ï¼‰è¾“å‡º</h4><h5 id="1-å˜æ›´è¯·æ±‚"><a href="#1-å˜æ›´è¯·æ±‚" class="headerlink" title="1. å˜æ›´è¯·æ±‚"></a>1. å˜æ›´è¯·æ±‚</h5><h5 id="2-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"><a href="#2-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°" class="headerlink" title="2. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"></a>2. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</h5><h5 id="3-é¡¹ç›®æ–‡ä»¶æ›´æ–°"><a href="#3-é¡¹ç›®æ–‡ä»¶æ›´æ–°" class="headerlink" title="3. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>3. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h5 id="4-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"><a href="#4-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°" class="headerlink" title="4. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"></a>4. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°</h5><h3 id="4ã€æ§åˆ¶è´¨é‡"><a href="#4ã€æ§åˆ¶è´¨é‡" class="headerlink" title="4ã€æ§åˆ¶è´¨é‡"></a>4ã€æ§åˆ¶è´¨é‡</h3><h4 id="1ï¼‰è¾“å…¥-2"><a href="#1ï¼‰è¾“å…¥-2" class="headerlink" title="1ï¼‰è¾“å…¥"></a>1ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’-1"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’-1" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-è´¨é‡æµ‹é‡æŒ‡æ ‡"><a href="#2-è´¨é‡æµ‹é‡æŒ‡æ ‡" class="headerlink" title="2. è´¨é‡æµ‹é‡æŒ‡æ ‡"></a>2. è´¨é‡æµ‹é‡æŒ‡æ ‡</h5><h5 id="3-è´¨é‡æ ¸å¯¹å•"><a href="#3-è´¨é‡æ ¸å¯¹å•" class="headerlink" title="3. è´¨é‡æ ¸å¯¹å•"></a>3. è´¨é‡æ ¸å¯¹å•</h5><h5 id="4-å·¥ä½œç»©æ•ˆæ•°æ®"><a href="#4-å·¥ä½œç»©æ•ˆæ•°æ®" class="headerlink" title="4. å·¥ä½œç»©æ•ˆæ•°æ®"></a>4. å·¥ä½œç»©æ•ˆæ•°æ®</h5><h5 id="5-æ‰¹å‡†çš„å˜æ›´è¯·æ±‚"><a href="#5-æ‰¹å‡†çš„å˜æ›´è¯·æ±‚" class="headerlink" title="5. æ‰¹å‡†çš„å˜æ›´è¯·æ±‚"></a>5. æ‰¹å‡†çš„å˜æ›´è¯·æ±‚</h5><h5 id="6-å¯äº¤ä»˜æˆæœ"><a href="#6-å¯äº¤ä»˜æˆæœ" class="headerlink" title="6. å¯äº¤ä»˜æˆæœ"></a>6. å¯äº¤ä»˜æˆæœ</h5><h5 id="7-é¡¹ç›®æ–‡ä»¶"><a href="#7-é¡¹ç›®æ–‡ä»¶" class="headerlink" title="7. é¡¹ç›®æ–‡ä»¶"></a>7. é¡¹ç›®æ–‡ä»¶</h5><h5 id="8-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#8-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="8. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>8. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="2ï¼‰å·¥å…·å’ŒæŠ€æœ¯-2"><a href="#2ï¼‰å·¥å…·å’ŒæŠ€æœ¯-2" class="headerlink" title="2ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>2ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-ä¸ƒç§åŸºæœ¬è´¨é‡å·¥å…·"><a href="#1-ä¸ƒç§åŸºæœ¬è´¨é‡å·¥å…·" class="headerlink" title="1. ä¸ƒç§åŸºæœ¬è´¨é‡å·¥å…·"></a>1. ä¸ƒç§åŸºæœ¬è´¨é‡å·¥å…·</h5><h5 id="2-ç»Ÿè®¡æŠ½æ ·"><a href="#2-ç»Ÿè®¡æŠ½æ ·" class="headerlink" title="2. ç»Ÿè®¡æŠ½æ ·"></a>2. ç»Ÿè®¡æŠ½æ ·</h5><h5 id="3-æ£€æŸ¥"><a href="#3-æ£€æŸ¥" class="headerlink" title="3. æ£€æŸ¥"></a>3. æ£€æŸ¥</h5><h5 id="4-å®¡è®¡å·²æ‰¹å‡†çš„å˜æ›´è¯·æ±‚"><a href="#4-å®¡è®¡å·²æ‰¹å‡†çš„å˜æ›´è¯·æ±‚" class="headerlink" title="4. å®¡è®¡å·²æ‰¹å‡†çš„å˜æ›´è¯·æ±‚"></a>4. å®¡è®¡å·²æ‰¹å‡†çš„å˜æ›´è¯·æ±‚</h5><h4 id="3ï¼‰è¾“å‡º-2"><a href="#3ï¼‰è¾“å‡º-2" class="headerlink" title="3ï¼‰è¾“å‡º"></a>3ï¼‰è¾“å‡º</h4><h5 id="1-è´¨é‡æ§åˆ¶æµ‹é‡ç»“æœ"><a href="#1-è´¨é‡æ§åˆ¶æµ‹é‡ç»“æœ" class="headerlink" title="1. è´¨é‡æ§åˆ¶æµ‹é‡ç»“æœ"></a>1. è´¨é‡æ§åˆ¶æµ‹é‡ç»“æœ</h5><h5 id="2-ç¡®è®¤çš„å˜æ›´"><a href="#2-ç¡®è®¤çš„å˜æ›´" class="headerlink" title="2. ç¡®è®¤çš„å˜æ›´"></a>2. ç¡®è®¤çš„å˜æ›´</h5><h5 id="3-æ ¸å®çš„å¯äº¤ä»˜æˆæœ"><a href="#3-æ ¸å®çš„å¯äº¤ä»˜æˆæœ" class="headerlink" title="3. æ ¸å®çš„å¯äº¤ä»˜æˆæœ"></a>3. æ ¸å®çš„å¯äº¤ä»˜æˆæœ</h5><h5 id="4-å·¥ä½œç»©æ•ˆä¿¡æ¯"><a href="#4-å·¥ä½œç»©æ•ˆä¿¡æ¯" class="headerlink" title="4. å·¥ä½œç»©æ•ˆä¿¡æ¯"></a>4. å·¥ä½œç»©æ•ˆä¿¡æ¯</h5><h5 id="5-å˜æ›´è¯·æ±‚"><a href="#5-å˜æ›´è¯·æ±‚" class="headerlink" title="5. å˜æ›´è¯·æ±‚"></a>5. å˜æ›´è¯·æ±‚</h5><h5 id="6-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"><a href="#6-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°" class="headerlink" title="6. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"></a>6. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</h5><h5 id="7-é¡¹ç›®æ–‡ä»¶æ›´æ–°"><a href="#7-é¡¹ç›®æ–‡ä»¶æ›´æ–°" class="headerlink" title="7. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>7. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h5 id="8-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"><a href="#8-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°" class="headerlink" title="8. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"></a>8. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°</h5><h2 id="äºŒã€äººåŠ›èµ„æºç®¡ç†"><a href="#äºŒã€äººåŠ›èµ„æºç®¡ç†" class="headerlink" title="äºŒã€äººåŠ›èµ„æºç®¡ç†"></a>äºŒã€äººåŠ›èµ„æºç®¡ç†</h2>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬4ç« ã€é¡¹ç›®çš„è¿›åº¦ç®¡ç†å’Œæˆæœ¬ç®¡ç†</title>
    <link href="/2021/08/31/%E7%AC%AC4%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9B%E5%BA%A6%E7%AE%A1%E7%90%86%E5%92%8C%E6%88%90%E6%9C%AC%E7%AE%A1%E7%90%86/"/>
    <url>/2021/08/31/%E7%AC%AC4%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%BF%9B%E5%BA%A6%E7%AE%A1%E7%90%86%E5%92%8C%E6%88%90%E6%9C%AC%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬4ç« ã€é¡¹ç›®çš„è¿›åº¦ç®¡ç†å’Œæˆæœ¬ç®¡ç†"><a href="#ç¬¬4ç« ã€é¡¹ç›®çš„è¿›åº¦ç®¡ç†å’Œæˆæœ¬ç®¡ç†" class="headerlink" title="ç¬¬4ç« ã€é¡¹ç›®çš„è¿›åº¦ç®¡ç†å’Œæˆæœ¬ç®¡ç†"></a>ç¬¬4ç« ã€é¡¹ç›®çš„è¿›åº¦ç®¡ç†å’Œæˆæœ¬ç®¡ç†</h1><span id="more"></span><h2 id="ä¸€ã€è¿›åº¦ç®¡ç†"><a href="#ä¸€ã€è¿›åº¦ç®¡ç†" class="headerlink" title="ä¸€ã€è¿›åº¦ç®¡ç†"></a>ä¸€ã€è¿›åº¦ç®¡ç†</h2><h2 id="äºŒã€æˆæœ¬ç®¡ç†"><a href="#äºŒã€æˆæœ¬ç®¡ç†" class="headerlink" title="äºŒã€æˆæœ¬ç®¡ç†"></a>äºŒã€æˆæœ¬ç®¡ç†</h2>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬3ç« ã€é¡¹ç›®çš„æ•´ä½“ç®¡ç†å’ŒèŒƒå›´ç®¡ç†</title>
    <link href="/2021/08/31/%E7%AC%AC3%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%95%B4%E4%BD%93%E7%AE%A1%E7%90%86%E5%92%8C%E8%8C%83%E5%9B%B4%E7%AE%A1%E7%90%86/"/>
    <url>/2021/08/31/%E7%AC%AC3%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%95%B4%E4%BD%93%E7%AE%A1%E7%90%86%E5%92%8C%E8%8C%83%E5%9B%B4%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬3ç« ã€é¡¹ç›®çš„æ•´ä½“ç®¡ç†å’ŒèŒƒå›´ç®¡ç†"><a href="#ç¬¬3ç« ã€é¡¹ç›®çš„æ•´ä½“ç®¡ç†å’ŒèŒƒå›´ç®¡ç†" class="headerlink" title="ç¬¬3ç« ã€é¡¹ç›®çš„æ•´ä½“ç®¡ç†å’ŒèŒƒå›´ç®¡ç†"></a>ç¬¬3ç« ã€é¡¹ç›®çš„æ•´ä½“ç®¡ç†å’ŒèŒƒå›´ç®¡ç†</h1><span id="more"></span><h2 id="ä¸€ã€æ•´ä½“ç®¡ç†"><a href="#ä¸€ã€æ•´ä½“ç®¡ç†" class="headerlink" title="ä¸€ã€æ•´ä½“ç®¡ç†"></a>ä¸€ã€æ•´ä½“ç®¡ç†</h2><h3 id="1ã€æ•´ä½“ç®¡ç†æ¦‚è¿°"><a href="#1ã€æ•´ä½“ç®¡ç†æ¦‚è¿°" class="headerlink" title="1ã€æ•´ä½“ç®¡ç†æ¦‚è¿°"></a>1ã€æ•´ä½“ç®¡ç†æ¦‚è¿°</h3><h4 id="1ï¼‰åŸºç¡€çŸ¥è¯†"><a href="#1ï¼‰åŸºç¡€çŸ¥è¯†" class="headerlink" title="1ï¼‰åŸºç¡€çŸ¥è¯†"></a>1ï¼‰åŸºç¡€çŸ¥è¯†</h4><h5 id="1-æ•´ä½“ç®¡ç†çš„æ¦‚å¿µ"><a href="#1-æ•´ä½“ç®¡ç†çš„æ¦‚å¿µ" class="headerlink" title="1. æ•´ä½“ç®¡ç†çš„æ¦‚å¿µ"></a>1. æ•´ä½“ç®¡ç†çš„æ¦‚å¿µ</h5><p>é¡¹ç›®æ•´ä½“ç®¡ç†çŸ¥è¯†é¢†åŸŸåŒ…æ‹¬è¯†åˆ«ã€ç¡®å®šã€ç»“åˆã€ç»Ÿä¸€ä¸åè°ƒå„é¡¹ç›®ç®¡ç†è¿‡ç¨‹ç»„ä¸­ä¸åŒè¿‡ç¨‹çš„æ´»åŠ¨ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„ã€ç»¼åˆæ€§çš„ç®¡ç†</p><h5 id="2-é¡¹ç›®ç®¡ç†çš„ç›®æ ‡"><a href="#2-é¡¹ç›®ç®¡ç†çš„ç›®æ ‡" class="headerlink" title="2. é¡¹ç›®ç®¡ç†çš„ç›®æ ‡"></a>2. é¡¹ç›®ç®¡ç†çš„ç›®æ ‡</h5><h6 id="èŒƒå›´ç®¡ç†ï¼š"><a href="#èŒƒå›´ç®¡ç†ï¼š" class="headerlink" title="èŒƒå›´ç®¡ç†ï¼š"></a>èŒƒå›´ç®¡ç†ï¼š</h6><ul><li><p>åšä¸”åªåš</p></li><li><p>æ¡†å®šè¾¹ç•Œï¼Œæ˜ç¡®è¡Œä¸šï¼Œç»“åˆä»¥å¾€ç»éªŒï¼Œæœ‰æ‰€çªç ´</p></li></ul><h6 id="è¿›åº¦ç®¡ç†ï¼š"><a href="#è¿›åº¦ç®¡ç†ï¼š" class="headerlink" title="è¿›åº¦ç®¡ç†ï¼š"></a>è¿›åº¦ç®¡ç†ï¼š</h6><ul><li><p>æŒ‰éƒ¨å°±ç­</p></li><li><p>ç¨³æ­¥æ¨è¿›ï¼Œç¨³æ‰ç¨³æ‰“</p></li></ul><h6 id="æˆæœ¬ç®¡ç†ï¼š"><a href="#æˆæœ¬ç®¡ç†ï¼š" class="headerlink" title="æˆæœ¬ç®¡ç†ï¼š"></a>æˆæœ¬ç®¡ç†ï¼š</h6><ul><li><p>ç²¾æ‰“ç»†ç®—</p></li><li><p>æœºä¼šæˆæœ¬</p></li></ul><h6 id="è´¨é‡ç®¡ç†ï¼š"><a href="#è´¨é‡ç®¡ç†ï¼š" class="headerlink" title="è´¨é‡ç®¡ç†ï¼š"></a>è´¨é‡ç®¡ç†ï¼š</h6><ul><li>æ°åˆ°å¥½å¤„</li></ul><h6 id="äººåŠ›èµ„æºç®¡ç†ï¼š"><a href="#äººåŠ›èµ„æºç®¡ç†ï¼š" class="headerlink" title="äººåŠ›èµ„æºç®¡ç†ï¼š"></a>äººåŠ›èµ„æºç®¡ç†ï¼š</h6><ul><li>äººå°½å…¶æ‰</li></ul><h6 id="æ²Ÿé€šç®¡ç†ï¼š"><a href="#æ²Ÿé€šç®¡ç†ï¼š" class="headerlink" title="æ²Ÿé€šç®¡ç†ï¼š"></a>æ²Ÿé€šç®¡ç†ï¼š</h6><ul><li>äº’é€šæœ‰æ— </li><li>ç§¯æä¸»åŠ¨ã€æœ‰æ•ˆæ²Ÿé€š</li></ul><h6 id="é£é™©ç®¡ç†ï¼š"><a href="#é£é™©ç®¡ç†ï¼š" class="headerlink" title="é£é™©ç®¡ç†ï¼š"></a>é£é™©ç®¡ç†ï¼š</h6><ul><li>æœªé›¨ç»¸ç¼ª</li></ul><h6 id="é‡‡è´­ç®¡ç†ï¼š"><a href="#é‡‡è´­ç®¡ç†ï¼š" class="headerlink" title="é‡‡è´­ç®¡ç†ï¼š"></a>é‡‡è´­ç®¡ç†ï¼š</h6><ul><li>åˆä½œå…±èµ¢</li></ul><h6 id="å¹²ç³»äººç®¡ç†ï¼š"><a href="#å¹²ç³»äººç®¡ç†ï¼š" class="headerlink" title="å¹²ç³»äººç®¡ç†ï¼š"></a>å¹²ç³»äººç®¡ç†ï¼š</h6><ul><li>åŒ–æ•Œä¸ºå‹ </li></ul><h6 id="æ•´ä½“ç®¡ç†ï¼š"><a href="#æ•´ä½“ç®¡ç†ï¼š" class="headerlink" title="æ•´ä½“ç®¡ç†ï¼š"></a>æ•´ä½“ç®¡ç†ï¼š</h6><ul><li>è¿ç­¹å¸·å¹„ï¼Œå†³èƒœåƒé‡Œ</li></ul><h4 id="2ï¼‰é¡¹ç›®å¯åŠ¨ä¼š"><a href="#2ï¼‰é¡¹ç›®å¯åŠ¨ä¼š" class="headerlink" title="2ï¼‰é¡¹ç›®å¯åŠ¨ä¼š"></a>2ï¼‰é¡¹ç›®å¯åŠ¨ä¼š</h4><h5 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><p>é¡¹ç›®å¯åŠ¨ä¼šæ˜¯ä¸€ä¸ªé¡¹ç›®çš„å¼€å§‹</p><h5 id="2-ç›®çš„"><a href="#2-ç›®çš„" class="headerlink" title="2. ç›®çš„"></a>2. ç›®çš„</h5><p>ä½¿é¡¹ç›®çš„ä¸»è¦å¹²ç³»äººæ˜ç¡®é¡¹ç›®çš„ç›®æ ‡ã€èŒƒå›´ã€éœ€æ±‚ã€èƒŒæ™¯ä»¥åŠå„è‡ªçš„èŒè´£å’Œæƒé™</p><h5 id="3-ä¸é¡¹ç›®å¼€å·¥ä¼šçš„åŒºåˆ«"><a href="#3-ä¸é¡¹ç›®å¼€å·¥ä¼šçš„åŒºåˆ«" class="headerlink" title="3. ä¸é¡¹ç›®å¼€å·¥ä¼šçš„åŒºåˆ«"></a>3. ä¸é¡¹ç›®å¼€å·¥ä¼šçš„åŒºåˆ«</h5><table><thead><tr><th></th><th>é¡¹ç›®å¯åŠ¨ä¼š</th><th>é¡¹ç›®å¼€å·¥ä¼š</th></tr></thead><tbody><tr><td>ç»„ç»‡è€…</td><td>é¡¹ç›®å‘èµ·äºº</td><td>é¡¹ç›®ç»ç†</td></tr><tr><td>ä½œç”¨</td><td>å†³å®šé¡¹ç›®è¦ä¸è¦åš</td><td>ä»‹ç»é¡¹ç›®æ€ä¹ˆåš</td></tr><tr><td>ç»“æœ</td><td>å®£å¸ƒé¡¹ç›®æ­£å¼æˆç«‹</td><td>ä»‹ç»å’Œåˆ†å‘é¡¹ç›®è®¡åˆ’ï¼Œå®£å¸ƒé¡¹ç›®è¿›å…¥æ‰§è¡Œé˜¶æ®µ</td></tr></tbody></table><h4 id="3ï¼‰äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#3ï¼‰äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="3ï¼‰äº‹ä¸šç¯å¢ƒå› ç´ "></a>3ï¼‰äº‹ä¸šç¯å¢ƒå› ç´ </h4><p>äº‹ä¸šç¯å¢ƒå› ç´ åŒ…æ‹¬ï¼Œä½†ä¸é™äºå¦‚ä¸‹äº‹é¡¹:</p><ul><li>ç»„ç»‡æˆ–å…¬å¸çš„æ–‡åŒ–ä¸ç»„æˆç»“æ„</li><li>æ”¿åºœæˆ–è¡Œä¸šæ ‡å‡†ï¼ˆå¦‚ç›‘ç®¡éƒ¨é—¨çš„è§„ç« åˆ¶åº¦ã€äº§å“æ ‡å‡†ã€è´¨é‡æ ‡å‡†å’Œå·¥è‰ºæ ‡å‡†ï¼‰</li><li>åŸºç¡€è®¾æ–½ï¼ˆå¦‚ç°æœ‰çš„è½¯ä»¶ä¸ç¡¬ä»¶åŸºç¡€è®¾æ–½ï¼‰</li><li>ç°æœ‰çš„äººåŠ›èµ„æºï¼ˆå¦‚æŠ€èƒ½ã€ä¸“ä¸šä¸çŸ¥è¯†ï¼‰</li><li>äººäº‹ç®¡ç†ï¼ˆå¦‚é›‡ä½£ä¸è§£é›‡æŒ‡å¯¼æ–¹é’ˆã€å‘˜å·¥ä¸šç»©è¯„ä»·ä¸åŸ¹è®­è®°å½•ï¼‰</li><li>å…¬å¸å·¥ä½œæ ¸å‡†åˆ¶åº¦</li><li>å¸‚åœºæƒ…å†µ</li><li>å•†ä¸šæ•°æ®åº“ï¼ˆå¦‚æ ‡å‡†çš„æˆæœ¬ä¼°ç®—æ•°æ®ã€è¡Œä¸šé£é™©ç ”ç©¶ä¿¡æ¯ä¸é£é™©æ•°æ®åº“ï¼‰</li><li>é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ</li></ul><h4 id="4ï¼‰ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#4ï¼‰ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="4ï¼‰ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>4ï¼‰ç»„ç»‡è¿‡ç¨‹èµ„äº§</h4><h5 id="1-å®šä¹‰-1"><a href="#1-å®šä¹‰-1" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><p>ç»„ç»‡è¿‡ç¨‹èµ„äº§æŒ‡ç»„ç»‡ä»ä»¥å‰é¡¹ç›®ä¸­å¸å–çš„æ•™è®­å’Œå­¦ä¹ åˆ°çš„çŸ¥è¯†ï¼Œå¦‚å®Œæˆçš„è¿›åº¦è¡¨ã€é£é™©æ•°æ®å’Œå®ç°ä»·å€¼æ•°æ®</p><h5 id="2-åˆ†ç±»"><a href="#2-åˆ†ç±»" class="headerlink" title="2. åˆ†ç±»"></a>2. åˆ†ç±»</h5><ul><li>ç»„ç»‡è¿›è¡Œå·¥ä½œçš„è¿‡ç¨‹å’Œç¨‹åº</li><li>ç»„ç»‡æ•´ä½“ä¿¡æ¯å­˜å‚¨æ£€ç´¢çŸ¥è¯†åº“</li></ul><h4 id="5ï¼‰æˆæœçº¿"><a href="#5ï¼‰æˆæœçº¿" class="headerlink" title="5ï¼‰æˆæœçº¿"></a>5ï¼‰æˆæœçº¿</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913222801242.png" alt="image-20210913222801242"></p><h4 id="6ï¼‰æ•°æ®çº¿"><a href="#6ï¼‰æ•°æ®çº¿" class="headerlink" title="6ï¼‰æ•°æ®çº¿"></a>6ï¼‰æ•°æ®çº¿</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913223227534.png" alt="image-20210913223227534"></p><h3 id="2ã€åˆ¶å®šé¡¹ç›®ç« ç¨‹"><a href="#2ã€åˆ¶å®šé¡¹ç›®ç« ç¨‹" class="headerlink" title="2ã€åˆ¶å®šé¡¹ç›®ç« ç¨‹"></a>2ã€åˆ¶å®šé¡¹ç›®ç« ç¨‹</h3><h4 id="1ï¼‰é¡¹ç›®ç« ç¨‹åŸºæœ¬æ¦‚å¿µ"><a href="#1ï¼‰é¡¹ç›®ç« ç¨‹åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1ï¼‰é¡¹ç›®ç« ç¨‹åŸºæœ¬æ¦‚å¿µ"></a>1ï¼‰é¡¹ç›®ç« ç¨‹åŸºæœ¬æ¦‚å¿µ</h4><h5 id="1-å®šä¹‰-2"><a href="#1-å®šä¹‰-2" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>é¡¹ç›®ç« ç¨‹æ˜¯æ­£å¼æ‰¹å‡†é¡¹ç›®çš„æ–‡ä»¶</li><li>è¯¥æ–‡ä»¶æ­£å¼è¡¨æ˜é¡¹ç›®å‘èµ·æ–¹å’Œé¡¹ç›®æ‰¿å»ºæ–¹ä¹‹é—´çš„ä¼™ä¼´å…³ç³»ï¼Œå¹¶è®°å½•äº†å¹²ç³»äººçš„éœ€è¦å’ŒæœŸæœ›çš„åˆæ­¥è¦æ±‚</li><li>é¡¹ç›®ç« ç¨‹å¯ä»¥ç”±å‘èµ·äººç¼–åˆ¶ï¼Œä¹Ÿå¯ä»¥ç”±é¡¹ç›®ç»ç†ä¸å‘èµ·æœºæ„åˆä½œç¼–åˆ¶ï¼ˆé¡¹ç›®ç»ç†åº”è¯¥å‚ä¸åˆ°ç¼–åˆ¶ç« ç¨‹çš„è¿‡ç¨‹ä¸­ï¼‰</li><li><strong>é¡¹ç›®ç”±é¡¹ç›®ç»„ä»¥å¤–çš„æœºæ„æ¥å¯åŠ¨</strong></li><li>é¡¹ç›®å¯åŠ¨è€…æˆ–å‘èµ·äººåº”è¯¥å…·æœ‰ä¸€å®šçš„èŒæƒï¼Œèƒ½ä¸ºé¡¹ç›®è·å–èµ„é‡‘å¹¶æä¾›èµ„æº</li><li>é¡¹ç›®ç« ç¨‹ä¸ç­‰åŒäºåˆåŒï¼Œå…¶ä¸­ä¸ä¼šæœ‰é‡‘é’±æŠ¥é…¬ç›¸å…³çš„å†…å®¹</li></ul><h5 id="2-ä½œç”¨ï¼ˆ-ï¼‰"><a href="#2-ä½œç”¨ï¼ˆ-ï¼‰" class="headerlink" title="2. ä½œç”¨ï¼ˆ***ï¼‰"></a>2. ä½œç”¨ï¼ˆ***ï¼‰</h5><ul><li>ç¡®å®šé¡¹ç›®å­˜åœ¨ï¼Œæ²¡æœ‰ç« ç¨‹å°±æ²¡æœ‰é¡¹ç›®çš„å­˜åœ¨</li><li>ç­¾å­—åçš„é¡¹ç›®ç« ç¨‹ï¼Œæ ‡å¿—ç€é¡¹ç›®çš„æ­£å¼å¯åŠ¨ï¼ˆ<strong>ç­¾åéœ€ç”±é¡¹ç›®ç»„æˆå‘˜å¤–çš„äººè¿›è¡Œ</strong>ï¼Œå¦‚é¡¹ç›®å‘èµ·äººã€CCBç­‰ï¼‰</li><li>ä»»å‘½é¡¹ç›®ç»ç†ï¼Œå¹¶ç»™é¡¹ç›®ç»ç†æˆæƒ</li><li>æ˜ç¡®äº†é¡¹ç›®çš„ç²—ç•¥è¦æ±‚ï¼ˆèŒƒå›´ã€è¿›åº¦ã€æˆæœ¬ã€è´¨é‡ï¼‰</li><li>å°†é¡¹ç›®ä¸å…¬å¸æ—¥å¸¸è¿ä½œç»“åˆèµ·æ¥</li></ul><h5 id="3-å†…å®¹ï¼ˆ-ï¼‰"><a href="#3-å†…å®¹ï¼ˆ-ï¼‰" class="headerlink" title="3. å†…å®¹ï¼ˆ***ï¼‰"></a>3. å†…å®¹ï¼ˆ***ï¼‰</h5><ul><li>é¡¹ç›®ç›®çš„æˆ–æ‰¹å‡†é¡¹ç›®çš„åŸå› ï¼ˆé¡¹ç›®ä»å“ªæ¥ï¼‰</li><li>å¯æµ‹é‡çš„é¡¹ç›®ç›®æ ‡å’Œç›¸å…³çš„æˆåŠŸæ ‡å‡†ï¼ˆé¡¹ç›®åˆ°å“ªå»ï¼‰</li><li>æ¦‚æ‹¬æ€§çš„é¡¹ç›®æè¿°ï¼ˆåˆæ­¥çš„èŒƒå›´ï¼‰</li><li>é¡¹ç›®çš„æ€»ä½“è¦æ±‚ï¼ˆåˆæ­¥çš„è´¨é‡ï¼‰</li><li>é¡¹ç›®çš„ä¸»è¦é£é™©ï¼ˆä¸»è¦çš„é£é™©ï¼‰</li><li>æ€»ä½“é‡Œç¨‹ç¢‘è¿›åº¦è®¡åˆ’ï¼ˆåˆæ­¥çš„è¿›åº¦ï¼‰</li><li>æ€»ä½“é¢„ç®—ï¼ˆåˆæ­¥çš„æˆæœ¬ï¼‰</li><li>é¡¹ç›®å®¡æ‰¹è¦æ±‚ï¼ˆç”¨ä»€ä¹ˆæ ‡å‡†è¯„ä»·æˆåŠŸã€ç”±è°å¯¹è¡Œå—æˆåŠŸä¸‹ç»“è®ºã€ç”±è°æ¥ç­¾ç½²é¡¹ç›®ç»“æŸï¼‰ï¼ˆæ”¶å°¾ï¼‰</li><li>å§”æ´¾çš„é¡¹ç›®ç»ç†åŠå…¶èŒè´£å’ŒèŒæƒï¼ˆå§”ä»»ï¼‰</li><li>å‘èµ·äººæˆ–å…¶ä»–æ‰¹å‡†é¡¹ç›®ç« ç¨‹çš„äººå‘˜çš„å§“åå’ŒèŒæƒï¼ˆå¹²ç³»äººï¼‰</li></ul><h4 id="2ï¼‰è¾“å…¥"><a href="#2ï¼‰è¾“å…¥" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®å·¥ä½œè¯´æ˜ä¹¦"><a href="#1-é¡¹ç›®å·¥ä½œè¯´æ˜ä¹¦" class="headerlink" title="1. é¡¹ç›®å·¥ä½œè¯´æ˜ä¹¦"></a>1. é¡¹ç›®å·¥ä½œè¯´æ˜ä¹¦</h5><h5 id="2-å•†ä¸šè®ºè¯"><a href="#2-å•†ä¸šè®ºè¯" class="headerlink" title="2. å•†ä¸šè®ºè¯"></a>2. å•†ä¸šè®ºè¯</h5><h5 id="3-åè®®"><a href="#3-åè®®" class="headerlink" title="3. åè®®"></a>3. åè®®</h5><h5 id="4-äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#4-äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="4. äº‹ä¸šç¯å¢ƒå› ç´ "></a>4. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="5-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#5-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="5. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>5. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-ä¸“å®¶åˆ¤æ–­"><a href="#1-ä¸“å®¶åˆ¤æ–­" class="headerlink" title="1. ä¸“å®¶åˆ¤æ–­"></a>1. ä¸“å®¶åˆ¤æ–­</h5><h5 id="2-å¼•å¯¼æŠ€æœ¯"><a href="#2-å¼•å¯¼æŠ€æœ¯" class="headerlink" title="2. å¼•å¯¼æŠ€æœ¯"></a>2. å¼•å¯¼æŠ€æœ¯</h5><h4 id="4ï¼‰è¾“å‡º"><a href="#4ï¼‰è¾“å‡º" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-é¡¹ç›®ç« ç¨‹"><a href="#1-é¡¹ç›®ç« ç¨‹" class="headerlink" title="1. é¡¹ç›®ç« ç¨‹"></a>1. é¡¹ç›®ç« ç¨‹</h5><h4 id="5ï¼‰é¡¹ç›®å·¥ä½œè¯´æ˜ä¹¦"><a href="#5ï¼‰é¡¹ç›®å·¥ä½œè¯´æ˜ä¹¦" class="headerlink" title="5ï¼‰é¡¹ç›®å·¥ä½œè¯´æ˜ä¹¦"></a>5ï¼‰é¡¹ç›®å·¥ä½œè¯´æ˜ä¹¦</h4><h5 id="1-å®šä¹‰-3"><a href="#1-å®šä¹‰-3" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>é¡¹ç›®å·¥ä½œè¯´æ˜ä¹¦æ˜¯åº”è¯¥ç”±é¡¹ç›®æä¾›çš„äº§å“æˆ–æœåŠ¡çš„æ–‡å­—è¯´æ˜</li><li>å¯¹äºå†…éƒ¨é¡¹ç›®ï¼Œå«å·¥ä½œè¯´æ˜ä¹¦</li><li>å¯¹äºå¤–éƒ¨é¡¹ç›®ï¼Œå±äºæ‹›æ ‡æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚å»ºè®®é‚€è¯·ä¹¦ã€ä¿¡æ¯è¯·æ±‚ã€æ‹›æ ‡é‚€è¯·ä¹¦ç­‰</li></ul><h5 id="2-å†…å®¹"><a href="#2-å†…å®¹" class="headerlink" title="2. å†…å®¹"></a>2. å†…å®¹</h5><ul><li>ä¸šåŠ¡éœ€æ±‚<ul><li>å¯èƒ½æ¥è‡ªäºåŸ¹è®­éœ€æ±‚ã€å¸‚åœºéœ€æ±‚ã€æŠ€æœ¯è¿›æ­¥ã€æ³•å¾‹è¦æ±‚æˆ–æ”¿åºœæ ‡å‡†</li></ul></li><li>äº§å“èŒƒå›´è¯´æ˜ä¹¦<ul><li>é¡¹ç›®åˆ›é€ çš„äº§å“æˆ–æœåŠ¡çš„è¦æ±‚ä¸ç‰¹å¾çš„è¯´æ˜æ–‡ä»¶</li></ul></li><li>æˆ˜ç•¥è®¡åˆ’<ul><li>æ‰€æœ‰é¡¹ç›®éƒ½åº”è¯¥æ”¯æŒç»„ç»‡çš„æˆ˜ç•¥ç›®æ ‡</li></ul></li></ul><h3 id="3ã€åˆ¶å®šé¡¹ç›®ç®¡ç†è®¡åˆ’"><a href="#3ã€åˆ¶å®šé¡¹ç›®ç®¡ç†è®¡åˆ’" class="headerlink" title="3ã€åˆ¶å®šé¡¹ç›®ç®¡ç†è®¡åˆ’"></a>3ã€åˆ¶å®šé¡¹ç›®ç®¡ç†è®¡åˆ’</h3><h4 id="1ï¼‰é¡¹ç›®ç®¡ç†è®¡åˆ’"><a href="#1ï¼‰é¡¹ç›®ç®¡ç†è®¡åˆ’" class="headerlink" title="1ï¼‰é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1ï¼‰é¡¹ç›®ç®¡ç†è®¡åˆ’</h4><h5 id="1-å­è®¡åˆ’"><a href="#1-å­è®¡åˆ’" class="headerlink" title="1. å­è®¡åˆ’"></a>1. å­è®¡åˆ’</h5><ul><li>èŒƒå›´ç®¡ç†è®¡åˆ’</li><li>éœ€æ±‚ç®¡ç†è®¡åˆ’</li><li>è¿›åº¦ç®¡ç†è®¡åˆ’</li><li>æˆæœ¬ç®¡ç†è®¡åˆ’</li><li>è´¨é‡ç®¡ç†è®¡åˆ’</li><li>è¿‡ç¨‹æ”¹è¿›è®¡åˆ’</li><li>äººåŠ›èµ„æºè®¡åˆ’</li><li>æ²Ÿé€šç®¡ç†è®¡åˆ’</li><li>é£é™©ç®¡ç†è®¡åˆ’</li><li>é‡‡è´­ç®¡ç†è®¡åˆ’</li></ul><h5 id="2-å…·ä½“å†…å®¹"><a href="#2-å…·ä½“å†…å®¹" class="headerlink" title="2. å…·ä½“å†…å®¹"></a>2. å…·ä½“å†…å®¹</h5><ul><li>é¡¹ç›®ç®¡ç†å›¢é˜Ÿé€‰æ‹©çš„å„ä¸ªé¡¹ç›®ç®¡ç†è¿‡ç¨‹</li><li>æ¯ä¸€é€‰å®šè¿‡ç¨‹çš„å®æ–½æ°´å¹³</li><li>å¯¹å®æ–½è¿™äº›è¿‡ç¨‹æ—¶ä½¿ç”¨çš„å·¥å…·å’ŒæŠ€æœ¯æ‰€åšçš„è¯´æ˜</li><li>åœ¨ç®¡ç†å…·ä½“é¡¹ç›®ä¸­ä½¿ç”¨é€‰å®šè¿‡ç¨‹çš„æ–¹å¼å’Œæ–¹æ³•ï¼ŒåŒ…æ‹¬è¿‡ç¨‹ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œç›¸å…³ä½œç”¨ï¼Œä»¥åŠé‡è¦çš„ä¾æ®å’Œæˆæœ</li><li>ä¸ºäº†å®ç°é¡¹ç›®ç›®æ ‡æ‰€æ‰§è¡Œå·¥ä½œçš„æ–¹å¼ã€æ–¹æ³•</li><li>ç›‘æ§å˜æ›´çš„æ–¹å¼ã€æ–¹æ³•</li><li>å®æ–½é…ç½®ç®¡ç†çš„æ–¹å¼ã€æ–¹æ³•</li><li>ä½¿ç”¨å®æ–½æ•ˆæœæµ‹é‡åŸºå‡†å¹¶ä½¿ä¹‹ä¿æŒå®Œæ•´çš„æ–¹å¼ã€æ–¹æ³•</li><li>é¡¹ç›®å¹²ç³»äººä¹‹é—´çš„æ²Ÿé€šéœ€æ±‚ä¸æŠ€æœ¯</li><li>é€‰å®šçš„é¡¹ç›®ç”Ÿå‘½å‘¨æœŸå’Œå¤šé˜¶æ®µé¡¹ç›®çš„é¡¹ç›®é˜¶æ®µ</li><li>é«˜å±‚ç®¡ç†äººå‘˜ä¸ºäº†åŠ å¿«è§£å†³æœªè§£å†³é—®é¢˜å’Œå¤„ç†ä¸ºåšå‡ºçš„å†³ç­–ï¼Œå¯¹å†…å®¹ã€èŒƒå›´å’Œæ—¶é—´å®‰æ’çš„ç›¸å…³å®¡æŸ¥</li></ul><h4 id="2ï¼‰é¡¹ç›®ç®¡ç†è®¡åˆ’ç¼–åˆ¶ï¼ˆ-ï¼‰"><a href="#2ï¼‰é¡¹ç›®ç®¡ç†è®¡åˆ’ç¼–åˆ¶ï¼ˆ-ï¼‰" class="headerlink" title="2ï¼‰é¡¹ç›®ç®¡ç†è®¡åˆ’ç¼–åˆ¶ï¼ˆ***ï¼‰"></a>2ï¼‰é¡¹ç›®ç®¡ç†è®¡åˆ’ç¼–åˆ¶ï¼ˆ***ï¼‰</h4><h5 id="1-å·¥ä½œæµç¨‹"><a href="#1-å·¥ä½œæµç¨‹" class="headerlink" title="1. å·¥ä½œæµç¨‹"></a>1. å·¥ä½œæµç¨‹</h5><ul><li>æ˜ç¡®é¡¹ç›®ç›®æ ‡</li><li>æˆç«‹åˆæ­¥çš„é¡¹ç›®å›¢é˜Ÿ</li><li>å·¥ä½œå‡†å¤‡ä¸ä¿¡æ¯æ”¶é›†</li><li>ä¾æ®æ¨¡æ¿ã€æ ‡å‡†ç¼–å†™åˆæ­¥çš„ã€æ¦‚è¦çš„é¡¹ç›®è®¡åˆ’</li><li>å°†ä¸Šè¿°è®¡åˆ’çº³å…¥é¡¹ç›®è®¡åˆ’ï¼Œç„¶åå¯¹é¡¹ç›®è®¡åˆ’è¿›è¡Œç»¼åˆå¹³è¡¡ã€ä¼˜åŒ–</li><li>é¡¹ç›®ç»ç†è´Ÿè´£ç»„ç»‡ç¼–å†™é¡¹ç›®è®¡åˆ’</li><li>è¯„å®¡å’Œæ‰¹å‡†é¡¹ç›®è®¡åˆ’</li><li><strong>è·å¾—æ‰¹å‡†çš„é¡¹ç›®è®¡åˆ’å°±æ˜¯é¡¹ç›®çš„åŸºå‡†</strong></li></ul><h5 id="2-åŸºæœ¬åŸåˆ™"><a href="#2-åŸºæœ¬åŸåˆ™" class="headerlink" title="2. åŸºæœ¬åŸåˆ™"></a>2. åŸºæœ¬åŸåˆ™</h5><ul><li>ç›®æ ‡çš„ç»Ÿä¸€ç®¡ç†</li><li>æ–¹æ¡ˆçš„ç»Ÿä¸€ç®¡ç†</li><li>è¿‡ç¨‹çš„ç»Ÿä¸€ç®¡ç†</li><li>æŠ€æœ¯å·¥ä½œä¸ç®¡ç†å·¥ä½œçš„ç»Ÿä¸€åè°ƒ</li><li>è®¡åˆ’çš„ç»Ÿä¸€ç®¡ç†</li><li>äººåŠ›èµ„æºçš„ç»Ÿä¸€ç®¡ç†</li><li>å„å¹²ç³»äººçš„å‚ä¸</li><li>é€æ­¥ç²¾ç¡®</li></ul><h5 id="3-æ­¥éª¤"><a href="#3-æ­¥éª¤" class="headerlink" title="3. æ­¥éª¤"></a>3. æ­¥éª¤</h5><ul><li>å„å…·ä½“çŸ¥è¯†é¢†åŸŸåˆ¶è®¢ä¸ªå­—çš„åˆ†é¡¹è®¡åˆ’</li><li>æ•´ä½“ç®¡ç†çŸ¥è¯†é¢†åŸŸæ”¶é›†å„åˆ†é¡¹è®¡åˆ’ï¼Œæ•´åˆæˆé¡¹ç›®ç®¡ç†è®¡åˆ’</li><li>ç”¨é¡¹ç›®ç®¡ç†è®¡åˆ’æŒ‡å¯¼é¡¹ç›®çš„æ‰§è¡Œå’Œç›‘æ§å·¥ä½œ</li><li>å¯¹æå‡ºçš„å¿…è¦å˜æ›´è¯·æ±‚ï¼ŒæŠ¥å®æ–½æ•´ä½“å˜æ›´æ§åˆ¶è¿‡ç¨‹å®¡æ‰¹</li><li>æ ¹æ®ç»æ‰¹å‡†çš„å˜æ›´è¯·æ±‚ï¼Œæ›´æ–°é¡¹ç›®ç®¡ç†è®¡åˆ’</li></ul><h4 id="3ï¼‰è¾“å…¥"><a href="#3ï¼‰è¾“å…¥" class="headerlink" title="3ï¼‰è¾“å…¥"></a>3ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç« ç¨‹-1"><a href="#1-é¡¹ç›®ç« ç¨‹-1" class="headerlink" title="1. é¡¹ç›®ç« ç¨‹"></a>1. é¡¹ç›®ç« ç¨‹</h5><h5 id="2-å…¶ä»–è¿‡ç¨‹çš„è¾“å‡º"><a href="#2-å…¶ä»–è¿‡ç¨‹çš„è¾“å‡º" class="headerlink" title="2. å…¶ä»–è¿‡ç¨‹çš„è¾“å‡º"></a>2. å…¶ä»–è¿‡ç¨‹çš„è¾“å‡º</h5><h5 id="3-äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#3-äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="3. äº‹ä¸šç¯å¢ƒå› ç´ "></a>3. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="4-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#4-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="4. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>4. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="4ï¼‰å·¥å…·å’ŒæŠ€æœ¯"><a href="#4ï¼‰å·¥å…·å’ŒæŠ€æœ¯" class="headerlink" title="4ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>4ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-ä¸“å®¶åˆ¤æ–­-1"><a href="#1-ä¸“å®¶åˆ¤æ–­-1" class="headerlink" title="1. ä¸“å®¶åˆ¤æ–­"></a>1. ä¸“å®¶åˆ¤æ–­</h5><h5 id="2-å¼•å¯¼æŠ€æœ¯-1"><a href="#2-å¼•å¯¼æŠ€æœ¯-1" class="headerlink" title="2. å¼•å¯¼æŠ€æœ¯"></a>2. å¼•å¯¼æŠ€æœ¯</h5><h4 id="5ï¼‰è¾“å‡º"><a href="#5ï¼‰è¾“å‡º" class="headerlink" title="5ï¼‰è¾“å‡º"></a>5ï¼‰è¾“å‡º</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h3 id="4ã€æŒ‡å¯¼ç®¡ç†é¡¹ç›®æ‰§è¡Œ"><a href="#4ã€æŒ‡å¯¼ç®¡ç†é¡¹ç›®æ‰§è¡Œ" class="headerlink" title="4ã€æŒ‡å¯¼ç®¡ç†é¡¹ç›®æ‰§è¡Œ"></a>4ã€æŒ‡å¯¼ç®¡ç†é¡¹ç›®æ‰§è¡Œ</h3><h4 id="1ï¼‰åŸºæœ¬æ¦‚å¿µ"><a href="#1ï¼‰åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1ï¼‰åŸºæœ¬æ¦‚å¿µ"></a>1ï¼‰åŸºæœ¬æ¦‚å¿µ</h4><h5 id="1-å·¥ä½œè¦æ±‚"><a href="#1-å·¥ä½œè¦æ±‚" class="headerlink" title="1. å·¥ä½œè¦æ±‚"></a>1. å·¥ä½œè¦æ±‚</h5><ul><li>è¦æ±‚é¡¹ç›®ç»ç†å’Œé¡¹ç›®å›¢é˜Ÿé‡‡å–å¤šç§è¡ŒåŠ¨æ‰§è¡Œé¡¹ç›®ç®¡ç†è®¡åˆ’ï¼Œå®Œæˆé¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦ä¸­æ˜ç¡®çš„å·¥ä½œ</li></ul><h5 id="2-å·¥ä½œå†…å®¹"><a href="#2-å·¥ä½œå†…å®¹" class="headerlink" title="2. å·¥ä½œå†…å®¹"></a>2. å·¥ä½œå†…å®¹</h5><h6 id="äººåŠ›èµ„æºç®¡ç†ï¼š-1"><a href="#äººåŠ›èµ„æºç®¡ç†ï¼š-1" class="headerlink" title="äººåŠ›èµ„æºç®¡ç†ï¼š"></a>äººåŠ›èµ„æºç®¡ç†ï¼š</h6><ul><li>ç»„å»ºé¡¹ç›®å›¢é˜Ÿ</li><li>å»ºè®¾é¡¹ç›®å›¢é˜Ÿ</li><li>ç®¡ç†é¡¹ç›®å›¢é˜Ÿ</li></ul><h6 id="é¡¹ç›®è´¨é‡ç®¡ç†ï¼š"><a href="#é¡¹ç›®è´¨é‡ç®¡ç†ï¼š" class="headerlink" title="é¡¹ç›®è´¨é‡ç®¡ç†ï¼š"></a>é¡¹ç›®è´¨é‡ç®¡ç†ï¼š</h6><ul><li>å®æ–½è´¨é‡ä¿è¯</li></ul><h6 id="é¡¹ç›®é‡‡è´­ç®¡ç†ï¼š"><a href="#é¡¹ç›®é‡‡è´­ç®¡ç†ï¼š" class="headerlink" title="é¡¹ç›®é‡‡è´­ç®¡ç†ï¼š"></a>é¡¹ç›®é‡‡è´­ç®¡ç†ï¼š</h6><ul><li>å®æ–½é‡‡è´­</li></ul><h6 id="é¡¹ç›®æ²Ÿé€šç®¡ç†ï¼š"><a href="#é¡¹ç›®æ²Ÿé€šç®¡ç†ï¼š" class="headerlink" title="é¡¹ç›®æ²Ÿé€šç®¡ç†ï¼š"></a>é¡¹ç›®æ²Ÿé€šç®¡ç†ï¼š</h6><ul><li>å‘å¸ƒä¿¡æ¯</li><li>ç®¡ç†å¹²ç³»äººæœŸæœ›</li></ul><h6 id="å¹²ç³»äººç®¡ç†ï¼š-1"><a href="#å¹²ç³»äººç®¡ç†ï¼š-1" class="headerlink" title="å¹²ç³»äººç®¡ç†ï¼š"></a>å¹²ç³»äººç®¡ç†ï¼š</h6><ul><li>ç®¡ç†ç›¸å…³å¹²ç³»äºº</li></ul><h4 id="2ï¼‰è¾“å…¥-1"><a href="#2ï¼‰è¾“å…¥-1" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’-1"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’-1" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-æ‰¹å‡†çš„å˜æ›´ç”³è¯·"><a href="#2-æ‰¹å‡†çš„å˜æ›´ç”³è¯·" class="headerlink" title="2. æ‰¹å‡†çš„å˜æ›´ç”³è¯·"></a>2. æ‰¹å‡†çš„å˜æ›´ç”³è¯·</h5><h5 id="3-äº‹ä¸šç¯å¢ƒå› ç´ -1"><a href="#3-äº‹ä¸šç¯å¢ƒå› ç´ -1" class="headerlink" title="3. äº‹ä¸šç¯å¢ƒå› ç´ "></a>3. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="4-ç»„ç»‡è¿‡ç¨‹èµ„äº§-1"><a href="#4-ç»„ç»‡è¿‡ç¨‹èµ„äº§-1" class="headerlink" title="4. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>4. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-1"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-1" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-ä¸“å®¶åˆ¤æ–­-2"><a href="#1-ä¸“å®¶åˆ¤æ–­-2" class="headerlink" title="1. ä¸“å®¶åˆ¤æ–­"></a>1. ä¸“å®¶åˆ¤æ–­</h5><h5 id="2-é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ"><a href="#2-é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ" class="headerlink" title="2. é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ"></a>2. é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ</h5><h5 id="3-ä¼šè®®"><a href="#3-ä¼šè®®" class="headerlink" title="3. ä¼šè®®"></a>3. ä¼šè®®</h5><h4 id="4ï¼‰è¾“å‡º-1"><a href="#4ï¼‰è¾“å‡º-1" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-å¯äº¤ä»˜æˆæœ"><a href="#1-å¯äº¤ä»˜æˆæœ" class="headerlink" title="1. å¯äº¤ä»˜æˆæœ"></a>1. å¯äº¤ä»˜æˆæœ</h5><h5 id="2-å·¥ä½œç»©æ•ˆæ•°æ®"><a href="#2-å·¥ä½œç»©æ•ˆæ•°æ®" class="headerlink" title="2. å·¥ä½œç»©æ•ˆæ•°æ®"></a>2. å·¥ä½œç»©æ•ˆæ•°æ®</h5><h5 id="3-å˜æ›´è¯·æ±‚"><a href="#3-å˜æ›´è¯·æ±‚" class="headerlink" title="3. å˜æ›´è¯·æ±‚"></a>3. å˜æ›´è¯·æ±‚</h5><h5 id="4-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"><a href="#4-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°" class="headerlink" title="4. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"></a>4. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</h5><h5 id="5-é¡¹ç›®æ–‡ä»¶æ›´æ–°"><a href="#5-é¡¹ç›®æ–‡ä»¶æ›´æ–°" class="headerlink" title="5. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>5. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h4 id="5ï¼‰é¡¹ç›®ä¿¡æ¯ç³»ç»Ÿ"><a href="#5ï¼‰é¡¹ç›®ä¿¡æ¯ç³»ç»Ÿ" class="headerlink" title="5ï¼‰é¡¹ç›®ä¿¡æ¯ç³»ç»Ÿ"></a>5ï¼‰é¡¹ç›®ä¿¡æ¯ç³»ç»Ÿ</h4><h5 id="1-å®šä¹‰-4"><a href="#1-å®šä¹‰-4" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿæ˜¯ç”±ç”¨äºå½’çº³ã€ç»¼åˆå’Œä¼ æ’­é¡¹ç›®ç®¡ç†ç¨‹åºè¾“å‡ºçš„å·¥å…·å’ŒæŠ€æœ¯ç»„æˆçš„</li><li><strong>ä¸€ä¸ªé¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆ â€”â€” è®¡åˆ’ç³»ç»Ÿ å’Œ æ§åˆ¶ç³»ç»Ÿ</strong></li></ul><h5 id="2-è®¡åˆ’ç³»ç»Ÿï¼ˆé…ç½®ç®¡ç†ç³»ç»Ÿï¼‰"><a href="#2-è®¡åˆ’ç³»ç»Ÿï¼ˆé…ç½®ç®¡ç†ç³»ç»Ÿï¼‰" class="headerlink" title="2. è®¡åˆ’ç³»ç»Ÿï¼ˆé…ç½®ç®¡ç†ç³»ç»Ÿï¼‰"></a>2. è®¡åˆ’ç³»ç»Ÿï¼ˆé…ç½®ç®¡ç†ç³»ç»Ÿï¼‰</h5><ul><li>ç”¨äºæäº¤å˜æ›´å»ºè®®ã€è¿½è¸ªå˜æ›´å»ºè®®çš„å®¡æŸ¥ä¸æ‰¹å‡†åˆ¶åº¦ã€ç¡®å®šå˜æ›´çš„æ‰¹å‡†çº§åˆ«ã€ç¡®è®¤æ‰¹å‡†çš„å˜æ›´æ–¹æ³•</li><li><strong>å¸¸ç”¨çš„é…ç½®ç®¡ç†è½¯ä»¶ç”± CVSã€VSSã€ClearCase ç­‰</strong></li></ul><h5 id="3-æ§åˆ¶ç³»ç»Ÿï¼ˆå˜æ›´æ§åˆ¶ç³»ç»Ÿï¼‰"><a href="#3-æ§åˆ¶ç³»ç»Ÿï¼ˆå˜æ›´æ§åˆ¶ç³»ç»Ÿï¼‰" class="headerlink" title="3. æ§åˆ¶ç³»ç»Ÿï¼ˆå˜æ›´æ§åˆ¶ç³»ç»Ÿï¼‰"></a>3. æ§åˆ¶ç³»ç»Ÿï¼ˆå˜æ›´æ§åˆ¶ç³»ç»Ÿï¼‰</h5><ul><li>ç”¨äºç¡®å®šæ§åˆ¶ã€æ”¹å˜å’Œæ‰¹å‡†é¡¹ç›®å¯äº¤ä»˜æˆæœå’Œæ–‡ä»¶çš„æ–¹å¼ã€æ–¹æ³•</li></ul><h4 id="6ï¼‰å·¥ä½œç»©æ•ˆæ•°æ®"><a href="#6ï¼‰å·¥ä½œç»©æ•ˆæ•°æ®" class="headerlink" title="6ï¼‰å·¥ä½œç»©æ•ˆæ•°æ®"></a>6ï¼‰å·¥ä½œç»©æ•ˆæ•°æ®</h4><h5 id="1-å®šä¹‰-5"><a href="#1-å®šä¹‰-5" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>å·¥ä½œç»©æ•ˆæ•°æ®æ˜¯åœ¨æ‰§è¡Œé¡¹ç›®å·¥ä½œçš„è¿‡ç¨‹ä¸­ï¼Œä»æ¯ä¸ªæ­£åœ¨æ‰§è¡Œçš„æ´»åŠ¨ä¸­æ”¶é›†åˆ°çš„åŸå§‹è§‚å¯Ÿç»“æœå’Œæµ‹é‡å€¼</li></ul><h5 id="2-ä¸»è¦å†…å®¹"><a href="#2-ä¸»è¦å†…å®¹" class="headerlink" title="2. ä¸»è¦å†…å®¹"></a>2. ä¸»è¦å†…å®¹</h5><ul><li>è¡¨æ˜è¿›åº¦ç»©æ•ˆçš„çŠ¶æ€ä¿¡æ¯</li><li>å·²å®Œæˆå’Œå°šæœªå®Œæˆçš„å¯äº¤ä»˜æˆæœ</li><li>å·²ç»å¼€å§‹ä¸å·²ç»å®Œæˆçš„è®¡åˆ’æ´»åŠ¨</li><li>è´¨é‡æ ‡å‡†æ»¡è¶³çš„ç¨‹åº¦</li><li>æ‰¹å‡†ä¸å·²ç»å¼€é”€çš„è´¹ç”¨</li><li>å¯¹äºå®Œæˆå·²ç»å¼€å§‹çš„è®¡åˆ’æ´»åŠ¨çš„ä¼°ç®—</li><li>ç»©æ•ˆè¿‡ç¨‹ä¸­çš„è®¡åˆ’æ´»åŠ¨å®é™…å®Œæˆçš„ç™¾åˆ†æ¯”</li><li>å¸å–å¹¶å·²è®°å½•ä¸”è½¬å…¥ç»éªŒæ•™è®­çŸ¥è¯†åº“çš„æ•™è®­</li><li>èµ„æºåˆ©ç”¨çš„ç»†èŠ‚</li></ul><h3 id="5ã€ç›‘æ§é¡¹ç›®å·¥ä½œ"><a href="#5ã€ç›‘æ§é¡¹ç›®å·¥ä½œ" class="headerlink" title="5ã€ç›‘æ§é¡¹ç›®å·¥ä½œ"></a>5ã€ç›‘æ§é¡¹ç›®å·¥ä½œ</h3><h4 id="1ï¼‰åŸºæœ¬æ¦‚å¿µ-1"><a href="#1ï¼‰åŸºæœ¬æ¦‚å¿µ-1" class="headerlink" title="1ï¼‰åŸºæœ¬æ¦‚å¿µ"></a>1ï¼‰åŸºæœ¬æ¦‚å¿µ</h4><h5 id="1-å®šä¹‰-6"><a href="#1-å®šä¹‰-6" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>ç›‘æ§å·¥ä½œå±äºç›‘æ§è¿‡ç¨‹ç»„ï¼Œä¸»è¦å·¥ä½œæ˜¯ç›‘æ§å’Œæ§åˆ¶å¯åŠ¨ã€è§„åˆ’ã€æ‰§è¡Œå’Œç»“æŸè¿‡ç¨‹ç»„ä¸­é¡¹ç›®æ‰€éœ€çš„å„ä¸ªè¿‡ç¨‹ï¼Œå¹¶é‡‡å–çº æ­£æˆ–é¢„é˜²æªæ–½æ¥æ§åˆ¶é¡¹ç›®çš„å®æ–½æ•ˆæœï¼Œä½¿å…¶ç¬¦åˆåŸºå‡†è¦æ±‚</li><li>ç›‘æ§æ˜¯ä¸€ä¸ªè´¯ç©¿é¡¹ç›®æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„è¿‡ç¨‹</li></ul><h5 id="2-å·¥ä½œå†…å®¹-1"><a href="#2-å·¥ä½œå†…å®¹-1" class="headerlink" title="2. å·¥ä½œå†…å®¹"></a>2. å·¥ä½œå†…å®¹</h5><ul><li>ç¡®è®¤èŒƒå›´</li><li>æ§åˆ¶èŒƒå›´</li><li>æ§åˆ¶è¿›åº¦</li><li>æ§åˆ¶æˆæœ¬</li><li>æ§åˆ¶è´¨é‡</li><li>æ§åˆ¶æ²Ÿé€š</li><li>ç›‘æ§é£é™©</li><li>æ§åˆ¶é‡‡è´­</li><li>ç›‘ç£å¹²ç³»äººå‚ä¸</li></ul><h5 id="3-ä½œç”¨"><a href="#3-ä½œç”¨" class="headerlink" title="3. ä½œç”¨"></a>3. ä½œç”¨</h5><ul><li>è®©é¡¹ç›®ç®¡ç†å›¢é˜Ÿèƒ½å¤Ÿè¯†åˆ«é¡¹ç›®çš„çŠ¶æ€æ˜¯å¦æ­£å¸¸ï¼Œå¹¶è¯†åˆ«ä»»ä½•å¯èƒ½è¦æ±‚ç»™äºˆç‰¹åˆ«å…³æ³¨çš„æ–¹é¢</li></ul><h4 id="2ï¼‰è¾“å…¥-2"><a href="#2ï¼‰è¾“å…¥-2" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’-2"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’-2" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-è¿›åº¦é¢„æµ‹ï¼ˆå®Œå·¥å°šéœ€æ—¶é—´ä¼°ç®—ï¼‰"><a href="#2-è¿›åº¦é¢„æµ‹ï¼ˆå®Œå·¥å°šéœ€æ—¶é—´ä¼°ç®—ï¼‰" class="headerlink" title="2. è¿›åº¦é¢„æµ‹ï¼ˆå®Œå·¥å°šéœ€æ—¶é—´ä¼°ç®—ï¼‰"></a>2. è¿›åº¦é¢„æµ‹ï¼ˆå®Œå·¥å°šéœ€æ—¶é—´ä¼°ç®—ï¼‰</h5><ul><li>åŸºäºå®é™…è¿›å±•ä¸è¿›åº¦åŸºå‡†çš„æ¯”è¾ƒè€Œè®¡ç®—å‡ºçš„å¯¹äºè¿›åº¦çš„é¢„æµ‹ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºè¿›åº¦åå·®å’Œè¿›åº¦ç»©æ•ˆæŒ‡æ•°</li></ul><h5 id="3-æˆæœ¬é¢„æµ‹ï¼ˆå®Œå·¥å°šéœ€ä¼°ç®—ï¼‰"><a href="#3-æˆæœ¬é¢„æµ‹ï¼ˆå®Œå·¥å°šéœ€ä¼°ç®—ï¼‰" class="headerlink" title="3. æˆæœ¬é¢„æµ‹ï¼ˆå®Œå·¥å°šéœ€ä¼°ç®—ï¼‰"></a>3. æˆæœ¬é¢„æµ‹ï¼ˆå®Œå·¥å°šéœ€ä¼°ç®—ï¼‰</h5><ul><li>åŸºäºå®é™…è¿›å±•ä¸æˆæœ¬åŸºå‡†çš„æ¯”è¾ƒè€Œè®¡ç®—å‡ºçš„å®Œå·¥å°šéœ€ï¼ˆæŠ•èµ„ï¼‰ä¼°ç®—ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºæˆæœ¬åå·®å’Œæˆæœ¬ç»©æ•ˆæŒ‡æ•°</li></ul><h5 id="4-ç¡®è®¤çš„å˜æ›´"><a href="#4-ç¡®è®¤çš„å˜æ›´" class="headerlink" title="4. ç¡®è®¤çš„å˜æ›´"></a>4. ç¡®è®¤çš„å˜æ›´</h5><ul><li>æ‰¹å‡†çš„å˜æ›´æ˜¯å®æ–½æ•´ä½“å˜æ›´æ§åˆ¶è¿‡ç¨‹çš„ç»“æœ</li><li>éœ€è¦å¯¹å…¶æ‰§è¡Œæƒ…å†µè¿›è¡Œç¡®è®¤ï¼Œä»¥ä¿è¯æ­£ç¡®è½å®</li><li>ç¡®è®¤çš„å˜æ›´ç”¨æ•°æ®æ¥è¯´æ˜å˜æ›´å·²å¾—åˆ°æ­£ç¡®çš„è½å®</li></ul><h5 id="5-å·¥ä½œç»©æ•ˆä¿¡æ¯"><a href="#5-å·¥ä½œç»©æ•ˆä¿¡æ¯" class="headerlink" title="5. å·¥ä½œç»©æ•ˆä¿¡æ¯"></a>5. å·¥ä½œç»©æ•ˆä¿¡æ¯</h5><h5 id="6-äº‹ä¸šç¯å¢ƒå› ç´ "><a href="#6-äº‹ä¸šç¯å¢ƒå› ç´ " class="headerlink" title="6. äº‹ä¸šç¯å¢ƒå› ç´ "></a>6. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="7-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#7-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="7. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>7. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-2"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-2" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-ä¸“å®¶åˆ¤æ–­-3"><a href="#1-ä¸“å®¶åˆ¤æ–­-3" class="headerlink" title="1. ä¸“å®¶åˆ¤æ–­"></a>1. ä¸“å®¶åˆ¤æ–­</h5><h5 id="2-åˆ†ææŠ€æœ¯"><a href="#2-åˆ†ææŠ€æœ¯" class="headerlink" title="2. åˆ†ææŠ€æœ¯"></a>2. åˆ†ææŠ€æœ¯</h5><h5 id="3-é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ"><a href="#3-é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ" class="headerlink" title="3. é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ"></a>3. é¡¹ç›®ç®¡ç†ä¿¡æ¯ç³»ç»Ÿ</h5><h5 id="4-ä¼šè®®"><a href="#4-ä¼šè®®" class="headerlink" title="4. ä¼šè®®"></a>4. ä¼šè®®</h5><h4 id="4ï¼‰è¾“å‡º-2"><a href="#4ï¼‰è¾“å‡º-2" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-å˜æ›´ç”³è¯·"><a href="#1-å˜æ›´ç”³è¯·" class="headerlink" title="1. å˜æ›´ç”³è¯·"></a>1. å˜æ›´ç”³è¯·</h5><h5 id="2-å·¥ä½œç»©æ•ˆæŠ¥å‘Š"><a href="#2-å·¥ä½œç»©æ•ˆæŠ¥å‘Š" class="headerlink" title="2. å·¥ä½œç»©æ•ˆæŠ¥å‘Š"></a>2. å·¥ä½œç»©æ•ˆæŠ¥å‘Š</h5><ul><li>ä¸ºåˆ¶å®šå†³ç­–ã€é‡‡å–è¡ŒåŠ¨æˆ–å¼•èµ·å…³æ³¨è€Œæ±‡ç¼–å·¥ä½œç»©æ•ˆä¿¡æ¯æ‰€å½¢æˆçš„å®ç‰©æˆ–ç”µå­é¡¹ç›®æ–‡ä»¶</li></ul><h5 id="3-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"><a href="#3-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°" class="headerlink" title="3. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"></a>3. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</h5><h5 id="4-é¡¹ç›®æ–‡ä»¶æ›´æ–°"><a href="#4-é¡¹ç›®æ–‡ä»¶æ›´æ–°" class="headerlink" title="4. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>4. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h4 id="5ï¼‰åˆ†ææŠ€æœ¯"><a href="#5ï¼‰åˆ†ææŠ€æœ¯" class="headerlink" title="5ï¼‰åˆ†ææŠ€æœ¯"></a>5ï¼‰åˆ†ææŠ€æœ¯</h4><h5 id="1-å®šä¹‰-7"><a href="#1-å®šä¹‰-7" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>æ ¹æ®å¯èƒ½çš„é¡¹ç›®æˆ–ç¯å¢ƒå˜é‡çš„å˜åŒ–ï¼Œä»¥åŠå®ƒä»¬ä¸å…¶ä»–å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œé‡‡ç”¨åˆ†ææŠ€æœ¯æ¥é¢„æµ‹æ½œåœ¨çš„åæœ</li></ul><h5 id="2-å…·ä½“åˆ†ææŠ€æœ¯æ–¹æ³•"><a href="#2-å…·ä½“åˆ†ææŠ€æœ¯æ–¹æ³•" class="headerlink" title="2. å…·ä½“åˆ†ææŠ€æœ¯æ–¹æ³•"></a>2. å…·ä½“åˆ†ææŠ€æœ¯æ–¹æ³•</h5><ul><li>å›å½’åˆ†æ</li><li>åˆ†ç»„æ–¹æ³•</li><li>å› æœåˆ†æ</li><li>æ ¹æœ¬åŸå› åˆ†æ</li><li>é¢„æµ‹æ–¹æ³•ï¼ˆå¦‚æ—¶é—´åºåˆ—ã€æƒ…æ™¯æ„å»ºã€æ¨¡æ‹Ÿç­‰ï¼‰</li><li>å¤±æ•ˆæ¨¡å¼ä¸å½±å“åˆ†æ</li><li>æ•…éšœæ ‘åˆ†æ</li><li>å‚¨å¤‡åˆ†æ</li><li>è¶‹åŠ¿åˆ†æ</li><li><strong>æŒ£å€¼ç®¡ç†</strong></li><li>å·®å¼‚åˆ†æ</li></ul><h3 id="6ã€å®æ–½æ•´ä½“å˜æ›´æ§åˆ¶"><a href="#6ã€å®æ–½æ•´ä½“å˜æ›´æ§åˆ¶" class="headerlink" title="6ã€å®æ–½æ•´ä½“å˜æ›´æ§åˆ¶"></a>6ã€å®æ–½æ•´ä½“å˜æ›´æ§åˆ¶</h3><h4 id="1ï¼‰åŸºç¡€æ¦‚å¿µ"><a href="#1ï¼‰åŸºç¡€æ¦‚å¿µ" class="headerlink" title="1ï¼‰åŸºç¡€æ¦‚å¿µ"></a>1ï¼‰åŸºç¡€æ¦‚å¿µ</h4><h5 id="1-å®šä¹‰-8"><a href="#1-å®šä¹‰-8" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>æ•´ä½“å˜æ›´æ§åˆ¶è¿‡ç¨‹è´¯å½»æ•´ä¸ªé¡¹ç›®ç”Ÿå‘½å‘¨æœŸ</li><li>é¡¹ç›®å¾ˆå°‘ä¼šå‡†ç¡®æŒ‰é¡¹ç›®ç®¡ç†è®¡åˆ’è¿›è¡Œï¼Œå˜æ›´æ§åˆ¶å¿…ä¸å¯å°‘</li></ul><h5 id="2-å˜æ›´æ§åˆ¶è¿‡ç¨‹ä¸­çš„é…ç½®ç®¡ç†æ´»åŠ¨"><a href="#2-å˜æ›´æ§åˆ¶è¿‡ç¨‹ä¸­çš„é…ç½®ç®¡ç†æ´»åŠ¨" class="headerlink" title="2. å˜æ›´æ§åˆ¶è¿‡ç¨‹ä¸­çš„é…ç½®ç®¡ç†æ´»åŠ¨"></a>2. å˜æ›´æ§åˆ¶è¿‡ç¨‹ä¸­çš„é…ç½®ç®¡ç†æ´»åŠ¨</h5><ul><li>é…ç½®è¯†åˆ«<ul><li>æ˜¯ç¡®å®šä¸æ ¸å®äº§å“é…ç½®ã€æ ‡è¯†äº§å“ä¸æ–‡ä»¶ã€ç®¡ç†å˜æ›´ã€ä¿æŒä¿¡æ¯å…¬å¼€çš„åŸºç¡€</li></ul></li><li>é…ç½®çŠ¶æ€è®°å½•<ul><li>æ•æ‰ã€å­˜å‚¨å’Œè¯„ä»·æœ‰æ•ˆçš„ç®¡ç†äº§å“å’Œäº§å“ä¿¡æ¯æ‰€éœ€çš„é…ç½®ä¿¡æ¯</li></ul></li><li>é…ç½®æ ¸å®ä¸å®¡è®¡<ul><li>æŸ¥æ˜é…ç½®æ–‡ä»¶ä¸­ç¡®å®šçš„æ€§èƒ½å’ŒåŠŸèƒ½å·²è¾¾åˆ°è¦æ±‚</li></ul></li></ul><h5 id="3-å…·ä½“å·¥ä½œ"><a href="#3-å…·ä½“å·¥ä½œ" class="headerlink" title="3. å…·ä½“å·¥ä½œ"></a>3. å…·ä½“å·¥ä½œ</h5><ul><li>æ¯”ç…§è®¡åˆ’ï¼ˆåŸºå‡†ï¼‰</li><li>åˆ†æç°çŠ¶</li><li>è®¡ç®—åå·®</li><li>åšå‡ºé¢„æµ‹</li><li>å†³å®šè¡ŒåŠ¨</li><li>ç›‘ç£å˜æ›´</li></ul><h5 id="3-å˜æ›´æ§åˆ¶å§”å‘˜ä¼šï¼ˆCCBï¼‰"><a href="#3-å˜æ›´æ§åˆ¶å§”å‘˜ä¼šï¼ˆCCBï¼‰" class="headerlink" title="3. å˜æ›´æ§åˆ¶å§”å‘˜ä¼šï¼ˆCCBï¼‰"></a>3. å˜æ›´æ§åˆ¶å§”å‘˜ä¼šï¼ˆCCBï¼‰</h5><ul><li>CCB æ˜¯<strong>å†³ç­–æœºæ„</strong>ï¼Œä¸æ˜¯ä½œä¸šæœºæ„ã€‚å…¶å·¥ä½œæ˜¯è¯„å®¡å’Œå†³å®šå˜æ›´æ˜¯å¦å®è¡Œï¼Œä½†ä¸æå‡ºå˜æ›´æ–¹æ¡ˆï¼ˆé¡¹ç›®ç»ç†æˆ–å¹²ç³»äººæå‡ºï¼‰</li></ul><h5 id="4-é¡¹ç›®ç»ç†çš„èŒè´£"><a href="#4-é¡¹ç›®ç»ç†çš„èŒè´£" class="headerlink" title="4. é¡¹ç›®ç»ç†çš„èŒè´£"></a>4. é¡¹ç›®ç»ç†çš„èŒè´£</h5><ul><li>ç›¸åº”å˜æ›´æå‡ºè€…çš„è¦æ±‚ï¼Œè¯„ä¼°å˜æ›´å¯¹é¡¹ç›®çš„å½±å“ï¼Œåˆ¶å®šåº”å¯¹æ–¹æ¡ˆï¼Œå°†æŠ€æœ¯éœ€æ±‚è½¬åŒ–æˆèµ„æºéœ€æ±‚ï¼Œå†ä¾›æˆæƒäººå†³ç­–</li><li>æŒ‰ç…§å˜æ›´ç”³è¯·çš„è¯„å®¡ç»“æœè°ƒæ•´é¡¹ç›®åŸºå‡†ï¼Œç¡®ä¿å§“åçš„åŸºå‡†èƒ½å¤Ÿåæ˜ é¡¹ç›®çš„å®æ–½æƒ…å†µ</li></ul><h4 id="2ï¼‰è¾“å…¥-3"><a href="#2ï¼‰è¾“å…¥-3" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’-3"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’-3" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-å·¥ä½œç»©æ•ˆæŠ¥å‘Š-1"><a href="#2-å·¥ä½œç»©æ•ˆæŠ¥å‘Š-1" class="headerlink" title="2. å·¥ä½œç»©æ•ˆæŠ¥å‘Š"></a>2. å·¥ä½œç»©æ•ˆæŠ¥å‘Š</h5><h5 id="3-å˜æ›´ç”³è¯·"><a href="#3-å˜æ›´ç”³è¯·" class="headerlink" title="3. å˜æ›´ç”³è¯·"></a>3. å˜æ›´ç”³è¯·</h5><h5 id="4-äº‹ä¸šç¯å¢ƒå› ç´ -1"><a href="#4-äº‹ä¸šç¯å¢ƒå› ç´ -1" class="headerlink" title="4. äº‹ä¸šç¯å¢ƒå› ç´ "></a>4. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="5-ç»„ç»‡è¿‡ç¨‹èµ„äº§-1"><a href="#5-ç»„ç»‡è¿‡ç¨‹èµ„äº§-1" class="headerlink" title="5. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>5. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-3"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-3" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-ä¸“å®¶åˆ¤æ–­-4"><a href="#1-ä¸“å®¶åˆ¤æ–­-4" class="headerlink" title="1. ä¸“å®¶åˆ¤æ–­"></a>1. ä¸“å®¶åˆ¤æ–­</h5><h5 id="2-ä¼šè®®"><a href="#2-ä¼šè®®" class="headerlink" title="2. ä¼šè®®"></a>2. ä¼šè®®</h5><h5 id="3-å˜æ›´æ§åˆ¶å·¥å…·"><a href="#3-å˜æ›´æ§åˆ¶å·¥å…·" class="headerlink" title="3. å˜æ›´æ§åˆ¶å·¥å…·"></a>3. å˜æ›´æ§åˆ¶å·¥å…·</h5><h4 id="4ï¼‰è¾“å‡º-3"><a href="#4ï¼‰è¾“å‡º-3" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-æ‰¹å‡†çš„å˜æ›´è¯·æ±‚"><a href="#1-æ‰¹å‡†çš„å˜æ›´è¯·æ±‚" class="headerlink" title="1. æ‰¹å‡†çš„å˜æ›´è¯·æ±‚"></a>1. æ‰¹å‡†çš„å˜æ›´è¯·æ±‚</h5><h5 id="2-å˜æ›´æ—¥å¿—"><a href="#2-å˜æ›´æ—¥å¿—" class="headerlink" title="2. å˜æ›´æ—¥å¿—"></a>2. å˜æ›´æ—¥å¿—</h5><ul><li>ç”¨äºè®°å½•é¡¹ç›®è¿‡ç¨‹ä¸­å‡ºç°çš„å˜æ›´</li><li>åº”ä¸ç›¸å…³å¹²ç³»äººæ²Ÿé€šè¿™äº›å˜æ›´ï¼Œä»¥åŠå…¶å¯¹é¡¹ç›®è¿›åº¦ã€æˆæœ¬å’Œé£é™©çš„å½±å“</li><li>è¢«å¦å†³çš„å˜æ›´ç”³è¯·ä¹Ÿåº”è¯¥è®°å½•åœ¨å˜æ›´æ—¥å¿—ä¸­</li></ul><h5 id="3-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°-1"><a href="#3-é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°-1" class="headerlink" title="3. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°"></a>3. é¡¹ç›®ç®¡ç†è®¡åˆ’æ›´æ–°</h5><h5 id="4-é¡¹ç›®æ–‡ä»¶æ›´æ–°-1"><a href="#4-é¡¹ç›®æ–‡ä»¶æ›´æ–°-1" class="headerlink" title="4. é¡¹ç›®æ–‡ä»¶æ›´æ–°"></a>4. é¡¹ç›®æ–‡ä»¶æ›´æ–°</h5><h3 id="7ã€ç»“æŸé¡¹ç›®æˆ–é˜¶æ®µ"><a href="#7ã€ç»“æŸé¡¹ç›®æˆ–é˜¶æ®µ" class="headerlink" title="7ã€ç»“æŸé¡¹ç›®æˆ–é˜¶æ®µ"></a>7ã€ç»“æŸé¡¹ç›®æˆ–é˜¶æ®µ</h3><h4 id="1ï¼‰åŸºæœ¬æ¦‚å¿µ-2"><a href="#1ï¼‰åŸºæœ¬æ¦‚å¿µ-2" class="headerlink" title="1ï¼‰åŸºæœ¬æ¦‚å¿µ"></a>1ï¼‰åŸºæœ¬æ¦‚å¿µ</h4><h5 id="1-å®šä¹‰-9"><a href="#1-å®šä¹‰-9" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>ç»“æŸé¡¹ç›®æˆ–é˜¶æ®µæ˜¯å®Œç»“æ‰€æœ‰é™¤æ”¶å°¾è¿‡ç¨‹ç»„å¤–çš„å…¶ä»–è¿‡ç¨‹ç»„çš„æ´»åŠ¨ï¼Œæ­£å¼ç»“æŸé¡¹ç›®æˆ–é˜¶æ®µçš„è¿‡ç¨‹</li></ul><h5 id="2-ä½œç”¨"><a href="#2-ä½œç”¨" class="headerlink" title="2. ä½œç”¨"></a>2. ä½œç”¨</h5><ul><li>æ€»ç»“ç»éªŒæ•™è®­ï¼Œæ­£å¼ç»“æŸé¡¹ç›®å·¥ä½œï¼Œä¸ºå±•å¼€æ–°çš„å·¥ä½œé‡Šæ”¾èµ„æº</li></ul><h4 id="2ï¼‰è¾“å…¥-4"><a href="#2ï¼‰è¾“å…¥-4" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’-4"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’-4" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-éªŒæ”¶çš„å¯äº¤ä»˜æˆæœ"><a href="#2-éªŒæ”¶çš„å¯äº¤ä»˜æˆæœ" class="headerlink" title="2. éªŒæ”¶çš„å¯äº¤ä»˜æˆæœ"></a>2. éªŒæ”¶çš„å¯äº¤ä»˜æˆæœ</h5><ul><li>åŒ…æ‹¬æ‰¹å‡†çš„äº§å“è§„èŒƒã€äº¤è´§æ”¶æ®å’Œå·¥ä½œç»©æ•ˆæ–‡ä»¶</li><li>åœ¨åˆ†é˜¶æ®µå®æ–½çš„é¡¹ç›®æˆ–è¢«å–æ¶ˆçš„é¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¼šåŒ…æ‹¬æœªå…¨éƒ¨å®Œæˆçš„å¯äº¤ä»˜æˆæœæˆ–ä¸­é—´å¯äº¤ä»˜æˆæœ</li></ul><h5 id="3-ç»„ç»‡è¿‡ç¨‹èµ„äº§"><a href="#3-ç»„ç»‡è¿‡ç¨‹èµ„äº§" class="headerlink" title="3 ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>3 ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-4"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-4" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-ä¸“å®¶åˆ¤æ–­-5"><a href="#1-ä¸“å®¶åˆ¤æ–­-5" class="headerlink" title="1. ä¸“å®¶åˆ¤æ–­"></a>1. ä¸“å®¶åˆ¤æ–­</h5><h5 id="2-åˆ†ææŠ€æœ¯-1"><a href="#2-åˆ†ææŠ€æœ¯-1" class="headerlink" title="2. åˆ†ææŠ€æœ¯"></a>2. åˆ†ææŠ€æœ¯</h5><h5 id="3-ä¼šè®®-1"><a href="#3-ä¼šè®®-1" class="headerlink" title="3. ä¼šè®®"></a>3. ä¼šè®®</h5><h4 id="4ï¼‰è¾“å‡º-4"><a href="#4ï¼‰è¾“å‡º-4" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-æœ€ç»ˆäº§å“ã€æœåŠ¡æˆ–æˆæœç§»äº¤"><a href="#1-æœ€ç»ˆäº§å“ã€æœåŠ¡æˆ–æˆæœç§»äº¤" class="headerlink" title="1. æœ€ç»ˆäº§å“ã€æœåŠ¡æˆ–æˆæœç§»äº¤"></a>1. æœ€ç»ˆäº§å“ã€æœåŠ¡æˆ–æˆæœç§»äº¤</h5><h5 id="2-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"><a href="#2-ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°" class="headerlink" title="2. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°"></a>2. ç»„ç»‡è¿‡ç¨‹èµ„äº§æ›´æ–°</h5><h4 id="5ï¼‰åˆåŒæ”¶å°¾-vs-è¡Œæ”¿æ”¶å°¾"><a href="#5ï¼‰åˆåŒæ”¶å°¾-vs-è¡Œæ”¿æ”¶å°¾" class="headerlink" title="5ï¼‰åˆåŒæ”¶å°¾ vs è¡Œæ”¿æ”¶å°¾"></a>5ï¼‰åˆåŒæ”¶å°¾ vs è¡Œæ”¿æ”¶å°¾</h4><h5 id="1-åˆåŒæ”¶å°¾"><a href="#1-åˆåŒæ”¶å°¾" class="headerlink" title="1. åˆåŒæ”¶å°¾"></a>1. åˆåŒæ”¶å°¾</h5><ul><li>åœ¨åˆåŒåŒæ–¹å®è´¨æ€§å±¥è¡Œæˆ‘é‚£åˆåŒè§„å®šçš„æƒåˆ©ä¹‰åŠ¡åï¼Œå¯¹å•ä¸ªåˆåŒè¿›è¡Œæ­£å¼å…³é—­</li><li>å¤–éƒ¨çš„ã€åœ¨è¡Œæ”¿æ”¶å°¾ä¹‹å‰ã€ä»¥åˆåŒç­¾æ”¶ä¸ºæ­¢çš„ä¸€æ¬¡</li></ul><h5 id="2-è¡Œæ”¿æ”¶å°¾"><a href="#2-è¡Œæ”¿æ”¶å°¾" class="headerlink" title="2. è¡Œæ”¿æ”¶å°¾"></a>2. è¡Œæ”¿æ”¶å°¾</h5><ul><li><p>åœ¨é¡¹ç›®å®è´¨æ€§å®Œå·¥ï¼ˆå…¨éƒ¨æŠ€æœ¯å·¥ä½œå®Œæˆï¼‰ä»¥åå¯¹é¡¹ç›®è¿›è¡Œæ­£å¼å…³é—­</p></li><li><p>å†…éƒ¨çš„ã€åœ¨åˆåŒæ”¶å°¾ä¹‹åã€é¡¹ç›®çš„æ¯ä¸ªé˜¶æ®µéƒ½è¦è¡Œæ”¿æ”¶å°¾ï¼ˆæ€»ç»“ç»éªŒæ•™è®­ï¼‰</p></li></ul><h2 id="äºŒã€èŒƒå›´ç®¡ç†"><a href="#äºŒã€èŒƒå›´ç®¡ç†" class="headerlink" title="äºŒã€èŒƒå›´ç®¡ç†"></a>äºŒã€èŒƒå›´ç®¡ç†</h2><h3 id="1ã€èŒƒå›´ç®¡ç†æ¦‚è¿°"><a href="#1ã€èŒƒå›´ç®¡ç†æ¦‚è¿°" class="headerlink" title="1ã€èŒƒå›´ç®¡ç†æ¦‚è¿°"></a>1ã€èŒƒå›´ç®¡ç†æ¦‚è¿°</h3><h4 id="1ï¼‰èŒƒå›´ç®¡ç†çš„æ¦‚å¿µ"><a href="#1ï¼‰èŒƒå›´ç®¡ç†çš„æ¦‚å¿µ" class="headerlink" title="1ï¼‰èŒƒå›´ç®¡ç†çš„æ¦‚å¿µ"></a>1ï¼‰èŒƒå›´ç®¡ç†çš„æ¦‚å¿µ</h4><h5 id="1-å®šä¹‰-10"><a href="#1-å®šä¹‰-10" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>é¡¹ç›®èŒƒå›´ç®¡ç†å°±æ˜¯è¦åšèŒƒå›´å†…çš„äº‹ï¼Œä¸”åªåšèŒƒå›´å†…çš„äº‹ï¼Œå³ä¸å°‘åšä¹Ÿä¸å¤šåš</li><li>æ ¹æ®çº¦æŸé™åˆ¶é€æ­¥ç¼©å‡èŒƒå›´ï¼Œå…¼é¡¾ä¸‰æ¡çº¦æŸè¾¹ç•Œçš„äº’åŠ¨å…³ç³»ï¼Œ<strong>æœ€ç»ˆå½¢æˆå¿…é¡»äº¤ä»˜çš„å·¥ä½œæˆ–æœåŠ¡</strong></li></ul><h5 id="2-é¡¹ç›®èŒƒå›´çš„ä¸‰å¤§çº¦æŸ"><a href="#2-é¡¹ç›®èŒƒå›´çš„ä¸‰å¤§çº¦æŸ" class="headerlink" title="2. é¡¹ç›®èŒƒå›´çš„ä¸‰å¤§çº¦æŸ"></a>2. é¡¹ç›®èŒƒå›´çš„ä¸‰å¤§çº¦æŸ</h5><ul><li>è´¨é‡æ ‡å‡†çº¦æŸ</li><li>æˆæœ¬çº¦æŸ</li><li>è¿›åº¦çº¦æŸ</li></ul><h5 id="3-å·¥ä½œå†…å®¹"><a href="#3-å·¥ä½œå†…å®¹" class="headerlink" title="3. å·¥ä½œå†…å®¹"></a>3. å·¥ä½œå†…å®¹</h5><ul><li>æ˜ç¡®é¡¹ç›®è¾¹ç•Œ</li><li>å¯¹é¡¹ç›®æ‰§è¡Œå·¥ä½œè¿›è¡Œç›‘æ§</li><li>é˜²æ­¢é¡¹ç›®èŒƒå›´å‘ç”Ÿè”“å»¶</li></ul><h4 id="3ï¼‰èŒƒå›´ç®¡ç†çš„æ„ä¹‰"><a href="#3ï¼‰èŒƒå›´ç®¡ç†çš„æ„ä¹‰" class="headerlink" title="3ï¼‰èŒƒå›´ç®¡ç†çš„æ„ä¹‰"></a>3ï¼‰èŒƒå›´ç®¡ç†çš„æ„ä¹‰</h4><ul><li><p>é¡¹ç›®èŒƒå›´<strong>å®šä¹‰ä¸æ¸…</strong>ï¼Œå¾€å¾€æ˜¯<strong>å¯¼è‡´é¡¹ç›®å¤±è´¥çš„é¦–è¦åŸå› </strong></p></li><li><p>é¡¹ç›®èŒƒå›´ç®¡ç†æ˜¯é¡¹ç›®<strong>å„é¡¹è®¡åˆ’ã€æ§åˆ¶çš„åŸºç¡€</strong></p></li><li><p>é¡¹ç›®èŒƒå›´ç®¡ç†ç¡®å®šäº†é¡¹ç›®çš„<strong>å…·ä½“å·¥ä½œä»»åŠ¡</strong>ï¼Œæœ‰åŠ©äºæ¸…æ¥šçš„<strong>è´£ä»»åˆ’åˆ†</strong>å’Œ<strong>ä»»åŠ¡åˆ†æ´¾</strong></p></li><li><p>æ¸…æ¥šé¡¹ç›®çš„å·¥ä½œå…·ä½“èŒƒå›´å’Œå…·ä½“å†…å®¹ï¼Œæ˜¯<strong>æé«˜æˆæœ¬ã€è¿›åº¦å’Œèµ„æºä¼°ç®—çš„ç²¾å‡†æ€§çš„åŸºç¡€</strong></p></li></ul><h4 id="4ï¼‰èŒƒå›´åŸºå‡†"><a href="#4ï¼‰èŒƒå›´åŸºå‡†" class="headerlink" title="4ï¼‰èŒƒå›´åŸºå‡†"></a>4ï¼‰èŒƒå›´åŸºå‡†</h4><ul><li>é¡¹ç›®çš„èŒƒå›´åŸºå‡†å°±æ˜¯ç»è¿‡æ‰¹å‡†çš„é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦ã€WBS å’Œ WBSè¯å…¸</li></ul><h4 id="5ï¼‰äº§å“èŒƒå›´"><a href="#5ï¼‰äº§å“èŒƒå›´" class="headerlink" title="5ï¼‰äº§å“èŒƒå›´"></a>5ï¼‰äº§å“èŒƒå›´</h4><h5 id="1-å®šä¹‰-11"><a href="#1-å®šä¹‰-11" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>äº§å“èŒƒå›´æŒ‡<strong>äº§å“æˆ–æœåŠ¡æ‰€åº”è¯¥åŒ…å«çš„åŠŸèƒ½</strong></li></ul><h5 id="2-ä½œç”¨-1"><a href="#2-ä½œç”¨-1" class="headerlink" title="2. ä½œç”¨"></a>2. ä½œç”¨</h5><ul><li>äº§å“èŒƒå›´æ˜¯é¡¹ç›®èŒƒå›´çš„åŸºç¡€ï¼Œäº§å“èŒƒå›´çš„å®šä¹‰å°±æ˜¯äº§å“è¦æ±‚çš„æè¿°</li></ul><h5 id="3-å®Œæˆçš„åˆ¤æ–­ä¾æ®"><a href="#3-å®Œæˆçš„åˆ¤æ–­ä¾æ®" class="headerlink" title="3. å®Œæˆçš„åˆ¤æ–­ä¾æ®"></a>3. å®Œæˆçš„åˆ¤æ–­ä¾æ®</h5><ul><li>äº§å“èŒƒå›´æ˜¯å¦å®Œæˆï¼Œæ ¹æ®äº§å“æ˜¯å¦æ»¡è¶³äº§å“æè¿°æ¥åˆ¤æ–­</li></ul><h5 id="4-å˜æ›´çš„å½±å“"><a href="#4-å˜æ›´çš„å½±å“" class="headerlink" title="4. å˜æ›´çš„å½±å“"></a>4. å˜æ›´çš„å½±å“</h5><ul><li>äº§å“å˜æ›´åï¼Œé¦–å…ˆå—åˆ°å½±å“çš„å°±æ˜¯é¡¹ç›®èŒƒå›´</li></ul><h4 id="6ï¼‰é¡¹ç›®èŒƒå›´ï¼ˆé¡¹ç›®å·¥ä½œèŒƒå›´ï¼‰"><a href="#6ï¼‰é¡¹ç›®èŒƒå›´ï¼ˆé¡¹ç›®å·¥ä½œèŒƒå›´ï¼‰" class="headerlink" title="6ï¼‰é¡¹ç›®èŒƒå›´ï¼ˆé¡¹ç›®å·¥ä½œèŒƒå›´ï¼‰"></a>6ï¼‰é¡¹ç›®èŒƒå›´ï¼ˆé¡¹ç›®å·¥ä½œèŒƒå›´ï¼‰</h4><h5 id="1-å®šä¹‰-12"><a href="#1-å®šä¹‰-12" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>é¡¹ç›®èŒƒå›´æ˜¯æŒ‡ä¸ºäº†èƒ½å¤Ÿäº¤ä»˜äº§å“ï¼Œé¡¹ç›®æ‰€<strong>å¿…é¡»åšçš„å·¥ä½œ</strong></li></ul><h5 id="2-ä½œç”¨-2"><a href="#2-ä½œç”¨-2" class="headerlink" title="2. ä½œç”¨"></a>2. ä½œç”¨</h5><ul><li>é¡¹ç›®èŒƒå›´çš„å®šä¹‰æ˜¯äº§ç”Ÿé¡¹ç›®ç®¡ç†è®¡åˆ’çš„åŸºç¡€</li></ul><h5 id="3-å®Œæˆçš„åˆ¤æ–­ä¾æ®-1"><a href="#3-å®Œæˆçš„åˆ¤æ–­ä¾æ®-1" class="headerlink" title="3. å®Œæˆçš„åˆ¤æ–­ä¾æ®"></a>3. å®Œæˆçš„åˆ¤æ–­ä¾æ®</h5><ul><li>åˆ¤æ–­é¡¹ç›®èŒƒå›´æ˜¯å¦å®Œæˆï¼Œè¦<strong>ä»¥èŒƒå›´åŸºå‡†æ¥è¡¡é‡</strong></li></ul><h3 id="2ã€è§„åˆ’èŒƒå›´ç®¡ç†"><a href="#2ã€è§„åˆ’èŒƒå›´ç®¡ç†" class="headerlink" title="2ã€è§„åˆ’èŒƒå›´ç®¡ç†"></a>2ã€è§„åˆ’èŒƒå›´ç®¡ç†</h3><blockquote><p>ç¼–å†™èŒƒå›´ç®¡ç†è®¡åˆ’</p></blockquote><h4 id="1ï¼‰åŸºç¡€çŸ¥è¯†-1"><a href="#1ï¼‰åŸºç¡€çŸ¥è¯†-1" class="headerlink" title="1ï¼‰åŸºç¡€çŸ¥è¯†"></a>1ï¼‰åŸºç¡€çŸ¥è¯†</h4><h5 id="1-å®šä¹‰-13"><a href="#1-å®šä¹‰-13" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>è§„åˆ’èŒƒå›´ç®¡ç†å°±æ˜¯ç¼–å†™èŒƒå›´ç®¡ç†è®¡åˆ’ï¼Œä»¥ä¹¦é¢çš„æ–¹å¼æè¿°å¦‚ä½•å®šä¹‰ã€ç¡®è®¤å’Œæ§åˆ¶é¡¹ç›®èŒƒå›´çš„è¿‡ç¨‹</li></ul><h5 id="2-ä½œç”¨-3"><a href="#2-ä½œç”¨-3" class="headerlink" title="2. ä½œç”¨"></a>2. ä½œç”¨</h5><ul><li>åœ¨æ•´ä¸ªé¡¹ç›®ç”Ÿå‘½å‘¨æœŸå†…ä¸ºå¦‚ä½•ç®¡ç†èŒƒå›´æä¾›æŒ‡å—å’Œæ–¹å‘</li></ul><h4 id="2ï¼‰è¾“å…¥-5"><a href="#2ï¼‰è¾“å…¥-5" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-é¡¹ç›®ç®¡ç†è®¡åˆ’-5"><a href="#1-é¡¹ç›®ç®¡ç†è®¡åˆ’-5" class="headerlink" title="1. é¡¹ç›®ç®¡ç†è®¡åˆ’"></a>1. é¡¹ç›®ç®¡ç†è®¡åˆ’</h5><h5 id="2-é¡¹ç›®ç« ç¨‹"><a href="#2-é¡¹ç›®ç« ç¨‹" class="headerlink" title="2. é¡¹ç›®ç« ç¨‹"></a>2. é¡¹ç›®ç« ç¨‹</h5><h5 id="3-äº‹ä¸šç¯å¢ƒå› ç´ -2"><a href="#3-äº‹ä¸šç¯å¢ƒå› ç´ -2" class="headerlink" title="3. äº‹ä¸šç¯å¢ƒå› ç´ "></a>3. äº‹ä¸šç¯å¢ƒå› ç´ </h5><h5 id="4-ç»„ç»‡è¿‡ç¨‹èµ„äº§-2"><a href="#4-ç»„ç»‡è¿‡ç¨‹èµ„äº§-2" class="headerlink" title="4. ç»„ç»‡è¿‡ç¨‹èµ„äº§"></a>4. ç»„ç»‡è¿‡ç¨‹èµ„äº§</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-5"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-5" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-ä¸“å®¶åˆ¤æ–­-6"><a href="#1-ä¸“å®¶åˆ¤æ–­-6" class="headerlink" title="1. ä¸“å®¶åˆ¤æ–­"></a>1. ä¸“å®¶åˆ¤æ–­</h5><h5 id="2-ä¼šè®®-1"><a href="#2-ä¼šè®®-1" class="headerlink" title="2. ä¼šè®®"></a>2. ä¼šè®®</h5><h4 id="4ï¼‰è¾“å‡º-5"><a href="#4ï¼‰è¾“å‡º-5" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-èŒƒå›´ç®¡ç†è®¡åˆ’"><a href="#1-èŒƒå›´ç®¡ç†è®¡åˆ’" class="headerlink" title="1. èŒƒå›´ç®¡ç†è®¡åˆ’"></a>1. èŒƒå›´ç®¡ç†è®¡åˆ’</h5><h5 id="2-éœ€æ±‚ç®¡ç†è®¡åˆ’"><a href="#2-éœ€æ±‚ç®¡ç†è®¡åˆ’" class="headerlink" title="2. éœ€æ±‚ç®¡ç†è®¡åˆ’"></a>2. éœ€æ±‚ç®¡ç†è®¡åˆ’</h5><h4 id="5ï¼‰èŒƒå›´ç®¡ç†è®¡åˆ’"><a href="#5ï¼‰èŒƒå›´ç®¡ç†è®¡åˆ’" class="headerlink" title="5ï¼‰èŒƒå›´ç®¡ç†è®¡åˆ’"></a>5ï¼‰èŒƒå›´ç®¡ç†è®¡åˆ’</h4><h5 id="1-å†…å®¹"><a href="#1-å†…å®¹" class="headerlink" title="1. å†…å®¹"></a>1. å†…å®¹</h5><ul><li>å¦‚ä½•åˆ¶è®¢é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦</li><li>å¦‚ä½•æ ¹æ®èŒƒå›´è¯´æ˜ä¹¦åˆ›å»º WBS </li><li>å¦‚ä½•ç»´æŠ¤å’Œæ‰¹å‡† WBS</li><li>å¦‚ä½•ç¡®è®¤å’Œæ­£å¼éªŒæ”¶å·²å®Œæˆçš„é¡¹ç›®å¯äº¤ä»˜æˆæœ</li><li>å¦‚ä½•å¤„ç†é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦çš„å˜æ›´ï¼Œè¯¥å·¥ä½œä¸å®æ–½æ•´ä½“å˜æ›´æ§åˆ¶è¿‡ç¨‹ç›´æ¥ç›¸è”</li></ul><h5 id="2-ç‰¹ç‚¹"><a href="#2-ç‰¹ç‚¹" class="headerlink" title="2. ç‰¹ç‚¹"></a>2. ç‰¹ç‚¹</h5><ul><li>å¯ä»¥åŒ…å«åœ¨é¡¹ç›®ç®¡ç†è®¡åˆ’ä¹‹ä¸­ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå•ç‹¬çš„ä¸€é¡¹ç‹¬ç«‹å­˜åœ¨</li><li>æ ¹æ®ä¸åŒçš„é¡¹ç›®è¦æ±‚ï¼Œ<strong>å¯ä»¥æ˜¯è¯¦ç»†çš„ä¹Ÿå¯ä»¥æ˜¯æ¦‚æ‹¬çš„ï¼Œå¯ä»¥æ˜¯æ­£å¼çš„ä¹Ÿå¯ä»¥æ˜¯éæ­£å¼çš„</strong></li></ul><h4 id="6ï¼‰éœ€æ±‚ç®¡ç†è®¡åˆ’"><a href="#6ï¼‰éœ€æ±‚ç®¡ç†è®¡åˆ’" class="headerlink" title="6ï¼‰éœ€æ±‚ç®¡ç†è®¡åˆ’"></a>6ï¼‰éœ€æ±‚ç®¡ç†è®¡åˆ’</h4><h5 id="1-ä½œç”¨"><a href="#1-ä½œç”¨" class="headerlink" title="1. ä½œç”¨"></a>1. ä½œç”¨</h5><ul><li><p><strong>æ˜ç¡®éœ€æ±‚ï¼Œå»ºç«‹éœ€æ±‚åŸºçº¿</strong>ï¼Œä½¿é¡¹ç›®ç»„å’Œç”¨æˆ·è¾¾æˆå…±è¯†</p></li><li><p>å»ºç«‹éœ€æ±‚è·Ÿè¸ªè”ç³»é“¾ï¼Œç›‘æ§æ§åˆ¶ç”¨æˆ·éœ€æ±‚æ˜¯å¦è¢«æ­£ç¡®æ‰§è¡Œï¼Œä½¿æœ€ç»ˆäº§å“ä¸ç”¨æˆ·éœ€æ±‚ä¸€è‡´</p></li></ul><h5 id="2-å†…å®¹-1"><a href="#2-å†…å®¹-1" class="headerlink" title="2. å†…å®¹"></a>2. å†…å®¹</h5><ul><li>å¦‚ä½•è§„åˆ’ã€è·Ÿè¸ªå’Œæ±‡æŠ¥å„ç§éœ€æ±‚æ´»åŠ¨</li><li>éœ€æ±‚ç®¡ç†éœ€è¦ä½¿ç”¨çš„èµ„æº</li><li>åŸ¹è®­è®¡åˆ’</li><li>é¡¹ç›®å¹²ç³»äººå‚ä¸éœ€æ±‚ç®¡ç†çš„ç­–ç•¥</li><li>åˆ¤æ–­é¡¹ç›®èŒƒå›´ä¸éœ€æ±‚ä¸ä¸€è‡´çš„å‡†åˆ™å’Œçº æ­£è§„åˆ™</li><li>éœ€æ±‚è·Ÿè¸ªç»“æ„ï¼ˆå“ªäº›éœ€æ±‚å±æ€§è¢«åˆ—å…¥è·Ÿè¸ªçŸ©é˜µï¼‰</li><li>å¯åœ¨å…¶ä»–å“ªäº›é¡¹ç›®æ–‡ä»¶ä¸­è¿½è¸ªåˆ°è¿™äº›éœ€æ±‚</li><li>é…ç½®ç®¡ç†æ´»åŠ¨</li></ul><h3 id="3ã€æ”¶é›†éœ€æ±‚"><a href="#3ã€æ”¶é›†éœ€æ±‚" class="headerlink" title="3ã€æ”¶é›†éœ€æ±‚"></a>3ã€æ”¶é›†éœ€æ±‚</h3><blockquote><p>ç¡®å®šéœ€æ±‚</p></blockquote><h4 id="1ï¼‰åŸºç¡€çŸ¥è¯†-2"><a href="#1ï¼‰åŸºç¡€çŸ¥è¯†-2" class="headerlink" title="1ï¼‰åŸºç¡€çŸ¥è¯†"></a>1ï¼‰åŸºç¡€çŸ¥è¯†</h4><h5 id="1-éœ€æ±‚çš„åˆ†ç±»"><a href="#1-éœ€æ±‚çš„åˆ†ç±»" class="headerlink" title="1. éœ€æ±‚çš„åˆ†ç±»"></a>1. éœ€æ±‚çš„åˆ†ç±»</h5><ul><li><p>ä¸šåŠ¡éœ€æ±‚</p><ul><li>æ•´ä¸ªç»„ç»‡çš„é«˜å±‚çº§éœ€è¦ï¼Œå¦‚ï¼Œè§£å†³ä¸šåŠ¡é—®é¢˜æˆ–æŠ“ä½ä¸šåŠ¡æœºä¼šï¼Œå®æ–½é¡¹ç›®çš„åŸå› </li></ul></li><li><p>å¹²ç³»äººéœ€æ±‚</p><ul><li>å¹²ç³»äººæˆ–å¹²ç³»äººç¾¤ä½“çš„éœ€æ±‚</li></ul></li><li><p>è§£å†³æ–¹æ¡ˆéœ€æ±‚</p><ul><li>ä¸ºäº†æ»¡è¶³ä¸šåŠ¡éœ€æ±‚å’Œå¹²ç³»äººéœ€æ±‚ï¼Œäº§å“ã€æœåŠ¡æˆ–æˆæœå¿…é¡»å…·å¤‡çš„ç‰¹æ€§ã€åŠŸèƒ½å’Œç‰¹å¾</li><li>åŠŸèƒ½éœ€æ±‚<ul><li>å…³äºäº§å“èƒ½å¼€å±•çš„è¡Œä¸ºï¼Œå¦‚ï¼Œæµç¨‹ã€æ•°æ®ï¼Œä»¥åŠä¸äº§å“çš„äº’åŠ¨ç­‰</li></ul></li><li>éåŠŸèƒ½éœ€æ±‚<ul><li>å¯¹åŠŸèƒ½éœ€æ±‚çš„è¡¥å……ï¼Œæ˜¯äº§å“æ­£å¸¸è¿è¡Œæ‰€éœ€çš„ç¯å¢ƒæ¡ä»¶æˆ–è´¨é‡ï¼Œå¦‚ï¼Œå¯é æ€§ã€å®‰å…¨æ€§ã€æ€§èƒ½ã€æœåŠ¡æ°´å¹³ç­‰</li></ul></li></ul></li><li><p>è¿‡æ¸¡éœ€æ±‚</p><ul><li>ä»å½“å‰çŠ¶æ€è¿‡æ¸¡åˆ°å°†æ¥çŠ¶æ€æ‰€éœ€çš„ä¸´æ—¶èƒ½åŠ›ï¼Œå¦‚ï¼Œæ•°æ®è½¬æ¢å’ŒåŸ¹è®­éœ€æ±‚</li></ul></li><li><p>é¡¹ç›®éœ€æ±‚</p><ul><li>é¡¹ç›®éœ€è¦æ»¡è¶³çš„è¡ŒåŠ¨ã€è¿‡ç¨‹æˆ–å…¶ä»–æ¡ä»¶</li></ul></li><li><p>è´¨é‡éœ€æ±‚</p><ul><li><p>ç”¨äºç¡®å®šé¡¹ç›®å¯äº¤ä»˜æˆæœçš„æˆåŠŸå®Œæˆæˆ–å…¶ä»–é¡¹ç›®éœ€æ±‚çš„å®ç°æ¡ä»¶æˆ–æ ‡å‡†ã€‚</p></li><li><p>QFD å¯¹äºè´¨é‡éœ€æ±‚è¿›è¡Œäº†ç»†åˆ†</p><ul><li>åŸºæœ¬éœ€æ±‚</li><li>æœŸæœ›éœ€æ±‚</li><li>æ„å¤–éœ€æ±‚</li></ul></li></ul></li></ul><h4 id="2ï¼‰è¾“å…¥-6"><a href="#2ï¼‰è¾“å…¥-6" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h5 id="1-èŒƒå›´ç®¡ç†è®¡åˆ’-1"><a href="#1-èŒƒå›´ç®¡ç†è®¡åˆ’-1" class="headerlink" title="1. èŒƒå›´ç®¡ç†è®¡åˆ’"></a>1. èŒƒå›´ç®¡ç†è®¡åˆ’</h5><h5 id="2-éœ€æ±‚ç®¡ç†è®¡åˆ’-1"><a href="#2-éœ€æ±‚ç®¡ç†è®¡åˆ’-1" class="headerlink" title="2. éœ€æ±‚ç®¡ç†è®¡åˆ’"></a>2. éœ€æ±‚ç®¡ç†è®¡åˆ’</h5><h5 id="3-å¹²ç³»äººç®¡ç†è®¡åˆ’"><a href="#3-å¹²ç³»äººç®¡ç†è®¡åˆ’" class="headerlink" title="3. å¹²ç³»äººç®¡ç†è®¡åˆ’"></a>3. å¹²ç³»äººç®¡ç†è®¡åˆ’</h5><h5 id="4-é¡¹ç›®ç« ç¨‹"><a href="#4-é¡¹ç›®ç« ç¨‹" class="headerlink" title="4. é¡¹ç›®ç« ç¨‹"></a>4. é¡¹ç›®ç« ç¨‹</h5><h5 id="5-å¹²ç³»äººç™»è®°å†Œ"><a href="#5-å¹²ç³»äººç™»è®°å†Œ" class="headerlink" title="5. å¹²ç³»äººç™»è®°å†Œ"></a>5. å¹²ç³»äººç™»è®°å†Œ</h5><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-6"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-6" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h5 id="1-è®¿è°ˆ"><a href="#1-è®¿è°ˆ" class="headerlink" title="1. è®¿è°ˆ"></a>1. è®¿è°ˆ</h5><ul><li>ç›´æ¥äº¤è°ˆ</li></ul><h5 id="2-ç„¦ç‚¹å°ç»„"><a href="#2-ç„¦ç‚¹å°ç»„" class="headerlink" title="2. ç„¦ç‚¹å°ç»„"></a>2. ç„¦ç‚¹å°ç»„</h5><ul><li>ç¾¤ä½“è®¿è°ˆï¼Œé¢„å…ˆé€‰å®šçš„å¹²ç³»äººå’Œä¸»é¢˜ä¸“å®¶</li></ul><h5 id="3-å¼•å¯¼å¼ç ”è®¨ä¼š"><a href="#3-å¼•å¯¼å¼ç ”è®¨ä¼š" class="headerlink" title="3. å¼•å¯¼å¼ç ”è®¨ä¼š"></a>3. å¼•å¯¼å¼ç ”è®¨ä¼š</h5><ul><li>è·¨èŒèƒ½å¹²ç³»äººï¼Œèƒ½æ¯”å•é¡¹ä¼šè®®æ›´å¿«åœ°å‘ç°å’Œè§£å†³é—®é¢˜</li></ul><h5 id="4-ç¾¤ä½“åˆ›æ–°æŠ€æœ¯"><a href="#4-ç¾¤ä½“åˆ›æ–°æŠ€æœ¯" class="headerlink" title="4. ç¾¤ä½“åˆ›æ–°æŠ€æœ¯"></a>4. ç¾¤ä½“åˆ›æ–°æŠ€æœ¯</h5><ul><li>å¤´è„‘é£æš´<ul><li>å„æŠ’å·±è§</li></ul></li><li>åä¹‰å°ç»„æŠ€æœ¯<ul><li>å¤´è„‘é£æš´æ³•çš„æ·±åŒ–åº”ç”¨</li></ul></li><li><strong>å¾·å°”æ–æŠ€æœ¯</strong><ul><li>ä¸“å®¶èƒŒé èƒŒï¼ˆåŒ¿åæŠ•ç¥¨ï¼‰</li></ul></li><li>æ¦‚å¿µ/æ€ç»´å¯¼å›¾<ul><li>å¼•å¯¼æ–°çš„åˆ›æ„</li></ul></li><li>äº²å’Œå›¾ï¼ˆKJæ³•ï¼‰<ul><li>æ ¸å¿ƒæ˜¯å¤´è„‘é£æš´æ³•ï¼Œæ˜¯æ ¹æ®ç»“æœå»æ‰¾åŸå› </li></ul></li><li>å¤šæ ‡å‡†å†³ç­–åˆ†æ<ul><li>å€ŸåŠ©å†³ç­–çŸ©é˜µ</li></ul></li></ul><h5 id="5-ç¾¤ä½“å†³ç­–æŠ€æœ¯"><a href="#5-ç¾¤ä½“å†³ç­–æŠ€æœ¯" class="headerlink" title="5. ç¾¤ä½“å†³ç­–æŠ€æœ¯"></a>5. ç¾¤ä½“å†³ç­–æŠ€æœ¯</h5><ul><li>å¯¹å¤šä¸ªæœªæ¥è¡ŒåŠ¨æ–¹æ¡ˆè¿›è¡Œè¯„ä¼°</li></ul><h5 id="6-é—®å·è°ƒæŸ¥"><a href="#6-é—®å·è°ƒæŸ¥" class="headerlink" title="6. é—®å·è°ƒæŸ¥"></a>6. é—®å·è°ƒæŸ¥</h5><ul><li>è®¾è®¡ä¹¦é¢é—®é¢˜</li></ul><h5 id="7-è§‚å¯Ÿ"><a href="#7-è§‚å¯Ÿ" class="headerlink" title="7. è§‚å¯Ÿ"></a>7. è§‚å¯Ÿ</h5><ul><li>ç›´æ¥è§‚å¯Ÿå·¥ä½œå’Œå®æ–½æµç¨‹</li></ul><h5 id="8-åŸå‹æ³•"><a href="#8-åŸå‹æ³•" class="headerlink" title="8. åŸå‹æ³•"></a>8. åŸå‹æ³•</h5><ul><li>æŒ‡å¹²ç³»äººæˆ–å¹²ç³»äººç¾¤ä½“çš„éœ€æ±‚</li></ul><h5 id="9-æ ‡æ†å¯¹ç…§"><a href="#9-æ ‡æ†å¯¹ç…§" class="headerlink" title="9. æ ‡æ†å¯¹ç…§"></a>9. æ ‡æ†å¯¹ç…§</h5><ul><li>ä¸å…¶ä»–ç±»ä¼¼ç»„ç»‡æ¯”è¾ƒï¼Œ<strong>è¯†åˆ«æœ€ä½³å®è·µ</strong></li></ul><h5 id="10-ç³»ç»Ÿäº¤äº’å›¾"><a href="#10-ç³»ç»Ÿäº¤äº’å›¾" class="headerlink" title="10. ç³»ç»Ÿäº¤äº’å›¾"></a>10. ç³»ç»Ÿäº¤äº’å›¾</h5><ul><li>å¯è§†åŒ–æè¿°ï¼Œç³»ç»Ÿä¸å‚ä¸è€…ä¹‹é—´çš„äº¤äº’</li></ul><h5 id="11-æ–‡ä»¶åˆ†æ"><a href="#11-æ–‡ä»¶åˆ†æ" class="headerlink" title="11. æ–‡ä»¶åˆ†æ"></a>11. æ–‡ä»¶åˆ†æ</h5><ul><li>åˆ†ææ–‡æ¡£ï¼ŒæŒ–æ˜éœ€æ±‚</li></ul><h4 id="4ï¼‰è¾“å‡º-6"><a href="#4ï¼‰è¾“å‡º-6" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h5 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h5><h5 id="2-éœ€æ±‚è·Ÿè¸ªçŸ©é˜µ"><a href="#2-éœ€æ±‚è·Ÿè¸ªçŸ©é˜µ" class="headerlink" title="2. éœ€æ±‚è·Ÿè¸ªçŸ©é˜µ"></a>2. éœ€æ±‚è·Ÿè¸ªçŸ©é˜µ</h5><h4 id="5ï¼‰éœ€æ±‚æ–‡ä»¶"><a href="#5ï¼‰éœ€æ±‚æ–‡ä»¶" class="headerlink" title="5ï¼‰éœ€æ±‚æ–‡ä»¶"></a>5ï¼‰éœ€æ±‚æ–‡ä»¶</h4><h5 id="1-å®šä¹‰-14"><a href="#1-å®šä¹‰-14" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>æè¿°å„ç§å•ä¸€éœ€æ±‚å°†å¦‚ä½•æ»¡è¶³ä¸é¡¹ç›®ç›¸å…³çš„ä¸šåŠ¡éœ€æ±‚</li></ul><h5 id="2-å†…å®¹-2"><a href="#2-å†…å®¹-2" class="headerlink" title="2. å†…å®¹"></a>2. å†…å®¹</h5><ul><li>ä¸šåŠ¡éœ€æ±‚</li><li>å¹²ç³»äººéœ€æ±‚</li><li>è§£å†³æ–¹æ¡ˆéœ€æ±‚</li><li>é¡¹ç›®éœ€æ±‚</li><li>è¿‡æ¸¡éœ€æ±‚</li><li>ä¸éœ€æ±‚ç›¸å…³çš„å‡è®¾æ¡ä»¶ã€ä¾èµ–å…³ç³»å’Œåˆ¶çº¦å› ç´ </li></ul><h4 id="6ï¼‰éœ€æ±‚ç®¡ç†"><a href="#6ï¼‰éœ€æ±‚ç®¡ç†" class="headerlink" title="6ï¼‰éœ€æ±‚ç®¡ç†"></a>6ï¼‰éœ€æ±‚ç®¡ç†</h4><h5 id="1-å®šä¹‰-15"><a href="#1-å®šä¹‰-15" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>åœ¨äº§å“å¼€å‘è¿‡ç¨‹ä¸­ç»´æŒéœ€æ±‚ä¸€è‡´æ€§å’Œç²¾ç¡®æ€§çš„æ‰€æœ‰æ´»åŠ¨</li></ul><h5 id="2-å†…å®¹-3"><a href="#2-å†…å®¹-3" class="headerlink" title="2. å†…å®¹"></a>2. å†…å®¹</h5><ul><li>æ§åˆ¶éœ€æ±‚åŸºçº¿ï¼Œä¿æŒé¡¹ç›®è®¡åˆ’ä¸éœ€æ±‚ä¸€è‡´</li><li>æ§åˆ¶å•ä¸ªéœ€æ±‚å’Œéœ€æ±‚æ–‡æ¡£çš„ç‰ˆæœ¬æƒ…å†µ</li><li>ç®¡ç†éœ€æ±‚å’Œè”ç³»é“¾ä¹‹é—´çš„è”ç³»</li><li>ç®¡ç†å•ä¸ªéœ€æ±‚å’Œé¡¹ç›®å…¶ä»–å¯äº¤ä»˜ç‰©ä¹‹é—´çš„ä¾èµ–å…³ç³»</li><li>è·Ÿè¸ªåŸºçº¿ä¸­éœ€æ±‚çš„çŠ¶æ€</li></ul><h5 id="3-ç‰¹å¾"><a href="#3-ç‰¹å¾" class="headerlink" title="3. ç‰¹å¾"></a>3. ç‰¹å¾</h5><ul><li>å¯è·Ÿè¸ªæ€§ï¼ˆåŒå‘å¯è·Ÿè¸ªï¼‰</li><li><strong>å¯éªŒè¯æ€§</strong>ï¼ˆåŸºæœ¬ç‰¹æ€§ï¼‰</li></ul><h4 id="7ï¼‰éœ€æ±‚è·Ÿè¸ª"><a href="#7ï¼‰éœ€æ±‚è·Ÿè¸ª" class="headerlink" title="7ï¼‰éœ€æ±‚è·Ÿè¸ª"></a>7ï¼‰éœ€æ±‚è·Ÿè¸ª</h4><h5 id="1-å®šä¹‰-16"><a href="#1-å®šä¹‰-16" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h5><ul><li>éœ€æ±‚è·Ÿè¸ªå°±æ˜¯å°†å•ä¸ªéœ€æ±‚å’Œå…¶ä»–å…ƒç´ ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œé€»è¾‘è”ç³»å»ºç«‹è·Ÿè¸ªï¼Œè¿™äº›å…ƒç´ åŒ…æ‹¬å„ç§ç±»å‹çš„éœ€æ±‚ã€ã€ä¸šåŠ¡è§„åˆ™ã€ç³»ç»Ÿç»„ä»¶ä»¥åŠå¸®åŠ©æ–‡ä»¶ç­‰</li></ul><h5 id="2-åŒå‘è·Ÿè¸ª"><a href="#2-åŒå‘è·Ÿè¸ª" class="headerlink" title="2. åŒå‘è·Ÿè¸ª"></a>2. åŒå‘è·Ÿè¸ª</h5><ul><li></li></ul><h3 id="4ã€å®šä¹‰èŒƒå›´"><a href="#4ã€å®šä¹‰èŒƒå›´" class="headerlink" title="4ã€å®šä¹‰èŒƒå›´"></a>4ã€å®šä¹‰èŒƒå›´</h3><blockquote><p>åˆ¶è®¢é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦</p></blockquote><h4 id="1ï¼‰åŸºç¡€çŸ¥è¯†-3"><a href="#1ï¼‰åŸºç¡€çŸ¥è¯†-3" class="headerlink" title="1ï¼‰åŸºç¡€çŸ¥è¯†"></a>1ï¼‰åŸºç¡€çŸ¥è¯†</h4><h4 id="2ï¼‰è¾“å…¥-7"><a href="#2ï¼‰è¾“å…¥-7" class="headerlink" title="2ï¼‰è¾“å…¥"></a>2ï¼‰è¾“å…¥</h4><h4 id="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-7"><a href="#3ï¼‰å·¥å…·å’ŒæŠ€æœ¯-7" class="headerlink" title="3ï¼‰å·¥å…·å’ŒæŠ€æœ¯"></a>3ï¼‰å·¥å…·å’ŒæŠ€æœ¯</h4><h4 id="4ï¼‰è¾“å‡º-7"><a href="#4ï¼‰è¾“å‡º-7" class="headerlink" title="4ï¼‰è¾“å‡º"></a>4ï¼‰è¾“å‡º</h4><h3 id="5ã€åˆ›å»ºå·¥ä½œåˆ†è§£ç»“æ„"><a href="#5ã€åˆ›å»ºå·¥ä½œåˆ†è§£ç»“æ„" class="headerlink" title="5ã€åˆ›å»ºå·¥ä½œåˆ†è§£ç»“æ„"></a>5ã€åˆ›å»ºå·¥ä½œåˆ†è§£ç»“æ„</h3><blockquote><p>å°†é¡¹ç›®èŒƒå›´åˆ†è§£æˆè¾ƒå°çš„ã€æ›´å®¹æ˜“ç®¡ç†çš„å•å…ƒ</p></blockquote><h3 id="6ã€ç¡®è®¤èŒƒå›´"><a href="#6ã€ç¡®è®¤èŒƒå›´" class="headerlink" title="6ã€ç¡®è®¤èŒƒå›´"></a>6ã€ç¡®è®¤èŒƒå›´</h3><blockquote><p>æ­£å¼éªŒæ”¶é¡¹ç›®å·²å®Œæˆçš„å¯äº¤ä»˜æˆæœ</p></blockquote><h3 id="7ã€æ§åˆ¶èŒƒå›´"><a href="#7ã€æ§åˆ¶èŒƒå›´" class="headerlink" title="7ã€æ§åˆ¶èŒƒå›´"></a>7ã€æ§åˆ¶èŒƒå›´</h3><blockquote><p>ç›‘ç£é¡¹ç›®å’Œäº§å“çš„èŒƒå›´çŠ¶æ€ã€ç®¡ç†èŒƒå›´åŸºå‡†å˜æ›´</p></blockquote><h2 id="ä¸‰ã€ä½œä¸š"><a href="#ä¸‰ã€ä½œä¸š" class="headerlink" title="ä¸‰ã€ä½œä¸š"></a>ä¸‰ã€ä½œä¸š</h2><h3 id="1ã€åˆ¤æ–­é¢˜"><a href="#1ã€åˆ¤æ–­é¢˜" class="headerlink" title="1ã€åˆ¤æ–­é¢˜"></a>1ã€åˆ¤æ–­é¢˜</h3><h4 id="1ï¼‰é¡¹ç›®ç« ç¨‹ç”±é¡¹ç›®ç»ç†å‘å¸ƒ"><a href="#1ï¼‰é¡¹ç›®ç« ç¨‹ç”±é¡¹ç›®ç»ç†å‘å¸ƒ" class="headerlink" title="1ï¼‰é¡¹ç›®ç« ç¨‹ç”±é¡¹ç›®ç»ç†å‘å¸ƒ"></a>1ï¼‰é¡¹ç›®ç« ç¨‹ç”±é¡¹ç›®ç»ç†å‘å¸ƒ</h4><blockquote><p>é”™ï¼Œé¡¹ç›®ç« ç¨‹ä¸€èˆ¬ç”±é¡¹ç›®å‘èµ·äººå‘å¸ƒï¼Œé¡¹ç›®å‘èµ·äººæ˜¯é¡¹ç›®ç»„æˆå‘˜å¤–çš„å…¶ä»–äºº</p></blockquote><h4 id="2ï¼‰é¡¹ç›®å¯åŠ¨ä¼šç”±é¡¹ç›®ç»ç†ç»„ç»‡ï¼Œé¡¹ç›®å¼€å·¥ä¼šç”±å‘èµ·äººç»„ç»‡"><a href="#2ï¼‰é¡¹ç›®å¯åŠ¨ä¼šç”±é¡¹ç›®ç»ç†ç»„ç»‡ï¼Œé¡¹ç›®å¼€å·¥ä¼šç”±å‘èµ·äººç»„ç»‡" class="headerlink" title="2ï¼‰é¡¹ç›®å¯åŠ¨ä¼šç”±é¡¹ç›®ç»ç†ç»„ç»‡ï¼Œé¡¹ç›®å¼€å·¥ä¼šç”±å‘èµ·äººç»„ç»‡"></a>2ï¼‰é¡¹ç›®å¯åŠ¨ä¼šç”±é¡¹ç›®ç»ç†ç»„ç»‡ï¼Œé¡¹ç›®å¼€å·¥ä¼šç”±å‘èµ·äººç»„ç»‡</h4><blockquote><p>é”™ï¼Œé¡¹ç›®å¯åŠ¨ä¼šä¸€èˆ¬ç”±é¡¹ç›®å‘èµ·äººç»„ç»‡ï¼Œè¡¨ç¤ºé¡¹ç›®æ­£å¼å¯åŠ¨ï¼›é¡¹ç›®å¼€å·¥ä¼šç”±é¡¹ç›®ç»ç†ç»„ç»‡ï¼Œå®‰æ’å…·ä½“è®¡åˆ’</p></blockquote><h4 id="3ï¼‰é¡¹ç›®ç»ç†ä¸åº”è¯¥è¿›å…¥CCB"><a href="#3ï¼‰é¡¹ç›®ç»ç†ä¸åº”è¯¥è¿›å…¥CCB" class="headerlink" title="3ï¼‰é¡¹ç›®ç»ç†ä¸åº”è¯¥è¿›å…¥CCB"></a>3ï¼‰é¡¹ç›®ç»ç†ä¸åº”è¯¥è¿›å…¥CCB</h4><blockquote><p>é”™</p></blockquote><h4 id="4ï¼‰æ‰€æœ‰çš„å˜æ›´ï¼Œå‡åº”è¯¥ç”±-CCB-å®¡æ‰¹"><a href="#4ï¼‰æ‰€æœ‰çš„å˜æ›´ï¼Œå‡åº”è¯¥ç”±-CCB-å®¡æ‰¹" class="headerlink" title="4ï¼‰æ‰€æœ‰çš„å˜æ›´ï¼Œå‡åº”è¯¥ç”± CCB å®¡æ‰¹"></a>4ï¼‰æ‰€æœ‰çš„å˜æ›´ï¼Œå‡åº”è¯¥ç”± CCB å®¡æ‰¹</h4><blockquote><p>é”™</p></blockquote><h4 id="5ï¼‰é¡¹ç›®æ”¶å°¾åŒ…æ‹¬ç®¡ç†æ”¶å°¾-è¡Œæ”¿æ”¶å°¾"><a href="#5ï¼‰é¡¹ç›®æ”¶å°¾åŒ…æ‹¬ç®¡ç†æ”¶å°¾-è¡Œæ”¿æ”¶å°¾" class="headerlink" title="5ï¼‰é¡¹ç›®æ”¶å°¾åŒ…æ‹¬ç®¡ç†æ”¶å°¾ + è¡Œæ”¿æ”¶å°¾"></a>5ï¼‰é¡¹ç›®æ”¶å°¾åŒ…æ‹¬ç®¡ç†æ”¶å°¾ + è¡Œæ”¿æ”¶å°¾</h4><blockquote><p>é”™ï¼Œé¡¹ç›®æ”¶å°¾åŒ…æ‹¬åˆåŒå·¥æ”¶å°¾å’Œè¡Œæ”¿æ”¶å°¾ï¼ˆç®¡ç†æ”¶å°¾ï¼‰</p></blockquote><h3 id="2ã€é—®ç­”é¢˜"><a href="#2ã€é—®ç­”é¢˜" class="headerlink" title="2ã€é—®ç­”é¢˜"></a>2ã€é—®ç­”é¢˜</h3><h4 id="1ï¼‰é¡¹ç›®ç« ç¨‹åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ"><a href="#1ï¼‰é¡¹ç›®ç« ç¨‹åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ" class="headerlink" title="1ï¼‰é¡¹ç›®ç« ç¨‹åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ"></a>1ï¼‰é¡¹ç›®ç« ç¨‹åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ</h4><ul><li><p>é¡¹ç›®ç›®çš„æˆ–æ‰¹å‡†é¡¹ç›®çš„åŸå› ï¼ˆé¡¹ç›®ä»å“ªæ¥ï¼‰</p></li><li><p>å¯æµ‹é‡çš„é¡¹ç›®ç›®æ ‡å’Œç›¸å…³çš„æˆåŠŸæ ‡å‡†ï¼ˆé¡¹ç›®åˆ°å“ªå»ï¼‰</p></li><li><p>æ¦‚æ‹¬æ€§çš„é¡¹ç›®æè¿°ï¼ˆåˆæ­¥çš„é¡¹ç›®èŒƒå›´ï¼‰</p></li><li><p>é¡¹ç›®çš„æ€»ä½“è¦æ±‚ï¼ˆåˆæ­¥çš„é¡¹ç›®è´¨é‡ï¼‰</p></li><li><p>é¡¹ç›®çš„ä¸»è¦é£é™©ï¼ˆä¸»è¦çš„é¡¹ç›®é£é™©ï¼‰</p></li><li><p>æ€»ä½“é‡Œç¨‹ç¢‘è¿›åº¦è®¡åˆ’ï¼ˆåˆæ­¥çš„é¡¹ç›®è¿›åº¦ï¼‰</p></li><li><p>æ€»ä½“é¢„ç®—ï¼ˆåˆæ­¥çš„é¡¹ç›®æŠ•èµ„ï¼‰</p></li><li><p>é¡¹ç›®å®¡æ‰¹è¦æ±‚ï¼ˆå¦‚ä½•æ”¶å°¾ï¼Œé¡¹ç›®æˆåŠŸçš„è¯„åˆ¤æ ‡å‡†ã€ç”±è°è¯„å®¡é¡¹ç›®æˆåŠŸã€ç”±è°ç­¾ç½²é¡¹ç›®ç»“æŸï¼‰</p></li><li><p>å§”æ´¾é¡¹ç›®ç»ç†å¹¶ä¸ºå…¶æˆæƒï¼ˆå§”ä»»ï¼‰</p></li><li><p>é¡¹ç›®ç›¸å…³å¹²ç³»äººçš„å§“åå’ŒèŒæƒï¼ˆå¹²ç³»äººï¼‰</p></li></ul><h4 id="2ï¼‰é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ"><a href="#2ï¼‰é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ" class="headerlink" title="2ï¼‰é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ"></a>2ï¼‰é¡¹ç›®èŒƒå›´è¯´æ˜ä¹¦åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ</h4><h4 id="3ï¼‰èŒƒå›´åŸºå‡†åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ"><a href="#3ï¼‰èŒƒå›´åŸºå‡†åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ" class="headerlink" title="3ï¼‰èŒƒå›´åŸºå‡†åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ"></a>3ï¼‰èŒƒå›´åŸºå‡†åŒ…æ‹¬å“ªäº›å†…å®¹ï¼Ÿ</h4><h2 id="å››ã€é”™é¢˜å›é¡¾"><a href="#å››ã€é”™é¢˜å›é¡¾" class="headerlink" title="å››ã€é”™é¢˜å›é¡¾"></a>å››ã€é”™é¢˜å›é¡¾</h2><h3 id="1ã€æ•´ä½“ç®¡ç†"><a href="#1ã€æ•´ä½“ç®¡ç†" class="headerlink" title="1ã€æ•´ä½“ç®¡ç†"></a>1ã€æ•´ä½“ç®¡ç†</h3><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913232407692.png" alt="image-20210913232407692"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210913232504410.png" alt="image-20210913232504410"></p><h3 id="2ã€èŒƒå›´ç®¡ç†"><a href="#2ã€èŒƒå›´ç®¡ç†" class="headerlink" title="2ã€èŒƒå›´ç®¡ç†"></a>2ã€èŒƒå›´ç®¡ç†</h3>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬1ç« ã€ä¿¡æ¯ç³»ç»ŸåŸºç¡€</title>
    <link href="/2021/08/30/%E7%AC%AC1%E7%AB%A0%E3%80%81%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80/"/>
    <url>/2021/08/30/%E7%AC%AC1%E7%AB%A0%E3%80%81%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€ä¿¡æ¯ç³»ç»ŸåŸºç¡€"><a href="#ç¬¬1ç« ã€ä¿¡æ¯ç³»ç»ŸåŸºç¡€" class="headerlink" title="ç¬¬1ç« ã€ä¿¡æ¯ç³»ç»ŸåŸºç¡€"></a>ç¬¬1ç« ã€ä¿¡æ¯ç³»ç»ŸåŸºç¡€</h1><span id="more"></span><h2 id="ä¸€ã€ä¿¡æ¯ç³»ç»Ÿç»¼åˆçŸ¥è¯†"><a href="#ä¸€ã€ä¿¡æ¯ç³»ç»Ÿç»¼åˆçŸ¥è¯†" class="headerlink" title="ä¸€ã€ä¿¡æ¯ç³»ç»Ÿç»¼åˆçŸ¥è¯†"></a>ä¸€ã€ä¿¡æ¯ç³»ç»Ÿç»¼åˆçŸ¥è¯†</h2><h3 id="1ã€ä¿¡æ¯çš„åŸºæœ¬æ¦‚å¿µ"><a href="#1ã€ä¿¡æ¯çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1ã€ä¿¡æ¯çš„åŸºæœ¬æ¦‚å¿µ"></a>1ã€ä¿¡æ¯çš„åŸºæœ¬æ¦‚å¿µ</h3><h2 id="äºŒã€"><a href="#äºŒã€" class="headerlink" title="äºŒã€"></a>äºŒã€</h2>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2021/08/30/%E7%AC%AC1%E7%AB%A0%E3%80%81%E9%80%9A%E8%BF%87-http-%E8%B0%83%E7%94%A8-k8s-api/"/>
    <url>/2021/08/30/%E7%AC%AC1%E7%AB%A0%E3%80%81%E9%80%9A%E8%BF%87-http-%E8%B0%83%E7%94%A8-k8s-api/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€é€šè¿‡-http-è°ƒç”¨-k8s-api"><a href="#ç¬¬1ç« ã€é€šè¿‡-http-è°ƒç”¨-k8s-api" class="headerlink" title="ç¬¬1ç« ã€é€šè¿‡ http è°ƒç”¨ k8s api"></a>ç¬¬1ç« ã€é€šè¿‡ http è°ƒç”¨ k8s api</h1><span id="more"></span><h2 id="ä¸€ã€K8S-API-è®¤è¯æ¦‚è¿°"><a href="#ä¸€ã€K8S-API-è®¤è¯æ¦‚è¿°" class="headerlink" title="ä¸€ã€K8S API è®¤è¯æ¦‚è¿°"></a>ä¸€ã€K8S API è®¤è¯æ¦‚è¿°</h2><p>åœ¨Kubernetesé›†ç¾¤ä¸­ï¼ŒKubernetes çš„ API Server æä¾›äº†å¯¹ K8S å„ç±»èµ„æºçš„å¢åˆ æ”¹æŸ¥ä»¥åŠ watch çš„ Http Rest æ¥å£ã€‚API Serveræ˜¯é›†ç¾¤ç®¡ç†APIçš„å…¥å£ï¼Œä¹Ÿæ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ•°æ®æ€»çº¿å’Œæ•°æ®ä¸­å¿ƒã€‚å®ƒç”±è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªåä¸º <code>kube-apiserver</code> çš„è¿›ç¨‹æä¾›çš„æœåŠ¡ã€‚</p><p>ç”¨æˆ·å¯ä»¥é€šè¿‡kubectlã€å®¢æˆ·ç«¯åº“ã€http restï¼ŒUser æˆ–è€… ServiceAccount çš„å½¢å¼è®¿é—® API Serverï¼Œä½†æ˜¯æ— è®ºæ˜¯å“ªç§å½¢å¼ï¼Œåªæœ‰è¢«æˆæƒäº†æ‰èƒ½è®¿é—®è¿™æ˜¯ä¸å˜çš„ã€‚å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾APIæ—¶ï¼Œ å¾€å¾€è¦ç»è¿‡å‡ ä¸ªé˜¶æ®µçš„å®‰å…¨æ§åˆ¶ï¼Œåœ¨ä¸€ä¸ªå…¸å‹çš„åº”ç”¨é›†ç¾¤ä¸­ï¼ŒAPI Serveré€šå¸¸ä¼šä½¿ç”¨è‡ªç­¾åçš„CAè¯ä¹¦æä¾›HTTPSæœåŠ¡ï¼ŒåŒæ—¶å¼€å¯è®¤è¯ä¸æˆæƒç­‰å®‰å…¨æœºåˆ¶ã€‚</p><p>é€šå¸¸ï¼Œåœ¨Kubernetesé›†ç¾¤æ­å»ºä¹‹åï¼Œé™¤äº†ä½¿ç”¨å®˜æ–¹çš„ kubectl å·¥å…·ä¸API Serverè¿›è¡Œäº¤äº’å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ K8S æä¾›çš„å„è¯­è¨€çš„ client è¿›è¡Œäº¤äº’ï¼Œç”šè‡³è¿˜å¯ä»¥ä½¿ç”¨Postmanæˆ–è€…curlï¼Œæœ‰äº›æ—¶å€™ç›´æ¥ä½¿ç”¨curl ä¼šæœ‰æ›´å¥½çš„æ•ˆæœã€‚</p><p>å½“ç„¶ï¼Œä¸Šé¢æˆ‘ä»¬ç®€å•çš„è¯´äº†ä¸€ä¸‹ K8S çš„ API å­˜åœ¨é‰´æƒæœºåˆ¶ï¼Œæ‰€ä»¥ä¸API Serveräº¤äº’ä¹‹å‰ï¼Œé€šå¸¸éœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ªæœ‰æ­£ç¡®æƒé™çš„ServiceAccountï¼Œè¿™ä¸ª ServiceAccount é€šè¿‡ ClusterRole/Roleã€ClusterRoleBinding/RoleBinding ç­‰ç»™å…¶èµ‹äºˆç›¸å…³èµ„æºçš„æ“ä½œæƒé™ï¼Œ è€ŒService Account å¯¹åº”çš„ Token åˆ™ç”¨äºAPI Serverè¿›è¡ŒåŸºæœ¬çš„è®¤è¯ã€‚ä¸API Serverçš„äº¤äº’æ˜¯åŸºäº TLS å®‰å…¨åŠ å¯†çš„ï¼Œæ‰€ä»¥è¯·æ±‚çš„æ—¶å€™è¿˜éœ€è¦è‡ªç­¾åçš„è¯ä¹¦ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥éå®‰å…¨æ–¹å¼è¿æ¥API Serverï¼Œ ä½†æ˜¯ä¸æ¨èè¿™ä¹ˆåšã€‚</p><p>å…·ä½“çš„ K8S API è®¿é—®æ§åˆ¶æœºåˆ¶å‚è€ƒ: <a href="http://docs.kubernetes.org.cn/27.html">Kubernetes API è®¿é—®æ§åˆ¶</a></p><h2 id="äºŒã€å‡†å¤‡å·¥ä½œ"><a href="#äºŒã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="äºŒã€å‡†å¤‡å·¥ä½œ"></a>äºŒã€å‡†å¤‡å·¥ä½œ</h2><h3 id="1ã€å‡†å¤‡-API-è°ƒç”¨ä½¿ç”¨çš„-ServiceAccountï¼ˆå¯é€‰ï¼‰"><a href="#1ã€å‡†å¤‡-API-è°ƒç”¨ä½¿ç”¨çš„-ServiceAccountï¼ˆå¯é€‰ï¼‰" class="headerlink" title="1ã€å‡†å¤‡ API è°ƒç”¨ä½¿ç”¨çš„ ServiceAccountï¼ˆå¯é€‰ï¼‰"></a>1ã€å‡†å¤‡ API è°ƒç”¨ä½¿ç”¨çš„ ServiceAccountï¼ˆå¯é€‰ï¼‰</h3><h4 id="1ï¼‰åˆ›å»º-ServiceAccount"><a href="#1ï¼‰åˆ›å»º-ServiceAccount" class="headerlink" title="1ï¼‰åˆ›å»º ServiceAccount"></a>1ï¼‰åˆ›å»º ServiceAccount</h4><blockquote><p>ğŸš©å®é™…ä¸Šï¼Œ æˆ‘ä»¬æ‰€æœ‰å¯¹äº K8S èµ„æºçš„æ“ä½œéƒ½éœ€è¦ç”±ä¸€ä¸ª â€œç”¨æˆ·â€ æ¥è¿›è¡Œï¼Œè¿™ä¸ª â€œç”¨æˆ·â€ å°±æ˜¯ ServiceAccountï¼Œå®ƒç›¸å½“äºä¼ ç»Ÿæ“ä½œç³»ç»Ÿä¸­çš„ç³»ç»Ÿç”¨æˆ·æ¦‚å¿µï¼Œè¿™æ ·çš„æ¦‚å¿µå¹¿æ³›è¿ç”¨äºå„ç±»ç¨‹åºä»¥åŠæ“ä½œç³»ç»Ÿä¸­ã€‚å¹¶ä¸”ï¼Œç›¸è¾ƒäºæ“ä½œç³»ç»Ÿæ›´åŠ ä¾¿æ·çš„æ˜¯ï¼Œå½“æˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ª ServiceAccount çš„æ—¶å€™ï¼ŒK8S å°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªä¸å…¶å…³è”çš„ secretï¼Œè€Œæ— éœ€è‡ªè¡Œå†å»åˆ›å»ºã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create sa apiviewer<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ›å»º-RoleBinding"><a href="#2ï¼‰åˆ›å»º-RoleBinding" class="headerlink" title="2ï¼‰åˆ›å»º RoleBinding"></a>2ï¼‰åˆ›å»º RoleBinding</h4><blockquote><p>ğŸš© æˆ‘ä»¬å¯ä»¥é‡æ–°åˆ›å»ºä¸€ä¸ª ClusterRoleï¼Œè¿›è¡Œ RBAC æˆæƒï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ K8S é›†ç¾¤åŸæœ¬å·²å­˜åœ¨çš„ ClusterRoleï¼Œè¿™æ ·å¯ä»¥å…å»è¾ƒä¸ºå¤æ‚çš„èµ„æºæˆæƒè§„åˆ™ï¼Œé€šè¿‡ <code>kubectl get clusterrole</code> å¯ä»¥æŸ¥çœ‹é›†ç¾¤ä¸­å·²ç»å­˜åœ¨çš„ ClusterRoleï¼Œç”±äºæˆ‘ä»¬éœ€è¦å¯¹API è¿›è¡Œå…¨æ–¹ä½çš„æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨æƒé™è¾ƒé«˜çš„ <code>cluster-admin</code> æ¥äº ServiceAccount ç»‘å®šï¼ˆè¿™ä¼šå­˜åœ¨ä¸€å®šçš„å®‰å…¨é£é™©ï¼Œæ­£å¼ç¯å¢ƒä½¿ç”¨å»ºè®®é‡æ–°åˆ›å»º ClusterRole å¹¶æœ€å°åŒ–æˆæƒï¼‰ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl create rolebinding apiadmin --clusterrole cluster-admin --serviceaccount default:apiviewer<br></code></pre></td></tr></table></figure><h3 id="2ã€è·å–Bearer-Tokenã€Certificateã€API-Server-URL"><a href="#2ã€è·å–Bearer-Tokenã€Certificateã€API-Server-URL" class="headerlink" title="2ã€è·å–Bearer Tokenã€Certificateã€API Server URL"></a>2ã€è·å–Bearer Tokenã€Certificateã€API Server URL</h3><h4 id="1ï¼‰è·å–-ServiceAccount-çš„-Secret"><a href="#1ï¼‰è·å–-ServiceAccount-çš„-Secret" class="headerlink" title="1ï¼‰è·å– ServiceAccount çš„ Secret"></a>1ï¼‰è·å– ServiceAccount çš„ Secret</h4><blockquote><p>ğŸŒˆ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>jsonpath</code> çš„æ–¹å¼æˆªå–å¯¹åº” json ç»“æ„ä½“å†…çš„æ•°æ®ï¼Œå…¶ä½¿ç”¨æ–¹æ³•å’Œ jq å‘½ä»¤è¾ƒä¸ºç±»ä¼¼ï¼Œä½†æ˜¯å‰ææ˜¯éœ€è¦é¢„å…ˆçŸ¥é“ json çš„å…·ä½“ç»“æ„ï¼Œ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SECRET=$(kubectl get serviceaccount apiviewer -ojsonpath=&#x27;&#123;.secrets[0].name&#125;&#x27;)<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰è·å–-Bearer-Token"><a href="#2ï¼‰è·å–-Bearer-Token" class="headerlink" title="2ï¼‰è·å– Bearer Token"></a>2ï¼‰è·å– Bearer Token</h4><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>Token æ˜¯ç»è¿‡ base64 ç¼–ç åŠ å¯†è¿‡çš„ï¼Œéœ€è¦ç”¨ base64 åç¼–ç å¤„ç†</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">TOKEN=$(kubectl get secret $&#123;SECRET&#125; -ojsonpath=&#x27;&#123;.data.token&#125;&#x27;|base64 -d)<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰è·å–-Secret-ä½¿ç”¨-CA-è¯ä¹¦"><a href="#3ï¼‰è·å–-Secret-ä½¿ç”¨-CA-è¯ä¹¦" class="headerlink" title="3ï¼‰è·å– Secret ä½¿ç”¨ CA è¯ä¹¦"></a>3ï¼‰è·å– Secret ä½¿ç”¨ CA è¯ä¹¦</h4><blockquote><p>ğŸš© ServiceAccount çš„ Secret éƒ½æ˜¯ç”± kube-apiserver çš„ ca è¯ä¹¦ç­¾å‘çš„</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get secret $&#123;SECRET&#125; -o jsonpath=&quot;&#123;.data[&#x27;ca\.crt&#x27;]&#125;&quot; | base64 -d &gt; /tmp/ca.crt<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰è·å–-API-Server-URL"><a href="#4ï¼‰è·å–-API-Server-URL" class="headerlink" title="4ï¼‰è·å– API Server URL"></a>4ï¼‰è·å– API Server URL</h4><blockquote><p>ğŸš© å¦‚æœAPI Serveréƒ¨ç½²åœ¨å¤šå°Masterä¸Šï¼Œåªéœ€è®¿é—®å…¶ä¸­ä¸€å°å³å¯</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">APISERVER=https://$(kubectl -n default get endpoints kubernetes --no-headers | awk -F &quot;[, ]+&quot; &#x27;&#123;print $2&#125;&#x27;)<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€ä½¿ç”¨-Token-é€šè¿‡-HTTP-æ–¹å¼è®¿é—®-K8S-é›†ç¾¤"><a href="#ä¸‰ã€ä½¿ç”¨-Token-é€šè¿‡-HTTP-æ–¹å¼è®¿é—®-K8S-é›†ç¾¤" class="headerlink" title="ä¸‰ã€ä½¿ç”¨ Token é€šè¿‡ HTTP æ–¹å¼è®¿é—® K8S é›†ç¾¤"></a>ä¸‰ã€ä½¿ç”¨ Token é€šè¿‡ HTTP æ–¹å¼è®¿é—® K8S é›†ç¾¤</h2><h3 id="1ã€è·å–-K8S-çš„ç‰ˆæœ¬ä¿¡æ¯-â€”-version"><a href="#1ã€è·å–-K8S-çš„ç‰ˆæœ¬ä¿¡æ¯-â€”-version" class="headerlink" title="1ã€è·å– K8S çš„ç‰ˆæœ¬ä¿¡æ¯ â€”/version"></a>1ã€è·å– K8S çš„ç‰ˆæœ¬ä¿¡æ¯ â€”<code>/version</code></h3><blockquote><p>ğŸŒˆ <code>jq</code> æ˜¯ä¸€ä¸ª shell å‘½ä»¤è¡Œè§£æ json ç»“æ„ä½“çš„ç¥å™¨ï¼ŒLinux ç³»ç»Ÿä½¿ç”¨å¯¹åº”çš„åŒ…ç®¡ç†å™¨å°±å¯ä»¥ç›´æ¥å®‰è£…ï¼ˆbrewã€yumã€apt-getï¼‰</p><p>ä½¿ç”¨ <code>-r</code> å‚æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²ï¼Œä¸ä½¿ç”¨çš„åˆ™è¿”å›çš„æ˜¯ json ç»“æ„ä½“çš„ä¸€éƒ¨åˆ†ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -s  $APISERVER/version --header &quot;Authorization: Bearer $TOKEN&quot; --cacert /tmp/ca.crt | jq -r &#x27;.gitVersion&#x27;<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830173521373.png" alt="image-20210830173521373"></p><h3 id="2ã€è·å–æ‰€æœ‰-pod-çš„åç§°-â€”-api-v1-namespaces-NAMESPACE-pods"><a href="#2ã€è·å–æ‰€æœ‰-pod-çš„åç§°-â€”-api-v1-namespaces-NAMESPACE-pods" class="headerlink" title="2ã€è·å–æ‰€æœ‰ pod çš„åç§° â€” /api/v1/namespaces/${NAMESPACE}/pods"></a>2ã€è·å–æ‰€æœ‰ pod çš„åç§° â€” <code>/api/v1/namespaces/$&#123;NAMESPACE&#125;/pods</code></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -s  $APISERVER/api/v1/namespaces/default/pods/ --header &quot;Authorization: Bearer $TOKEN&quot; --cacert /tmp/ca.crt | jq &#x27;.items[].metadata.name&#x27;<br></code></pre></td></tr></table></figure><p>æ­£å¸¸çš„ json è¿”å›ï¼Œç±»ä¼¼ä¸‹å›¾ï¼Œä½†æ˜¯ç”±äºå½“å‰é›†ç¾¤çš„ default å‘½åç©ºé—´ä¸‹å¹¶æ²¡ pod èµ„æºï¼Œæ‰€ä»¥å®é™…è¿”å›å€¼ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830181237353.png" alt="image-20210830181237353"></p><h3 id="3ã€é—®é¢˜è®°å½•-è°ƒç”¨-K8S-API-è¿”å›-cannot-list-resource-æŠ¥é”™"><a href="#3ã€é—®é¢˜è®°å½•-è°ƒç”¨-K8S-API-è¿”å›-cannot-list-resource-æŠ¥é”™" class="headerlink" title="3ã€é—®é¢˜è®°å½•: è°ƒç”¨ K8S API è¿”å› cannot list resource æŠ¥é”™"></a>3ã€é—®é¢˜è®°å½•: è°ƒç”¨ K8S API è¿”å› cannot list resource æŠ¥é”™</h3><h4 id="1ï¼‰æŠ¥é”™ä¿¡æ¯ç±»ä¼¼ä¸‹å›¾"><a href="#1ï¼‰æŠ¥é”™ä¿¡æ¯ç±»ä¼¼ä¸‹å›¾" class="headerlink" title="1ï¼‰æŠ¥é”™ä¿¡æ¯ç±»ä¼¼ä¸‹å›¾:"></a>1ï¼‰æŠ¥é”™ä¿¡æ¯ç±»ä¼¼ä¸‹å›¾:</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830181304648.png" alt="image-20210830181304648"></p><h4 id="2ï¼‰é—®é¢˜åŸå› "><a href="#2ï¼‰é—®é¢˜åŸå› " class="headerlink" title="2ï¼‰é—®é¢˜åŸå› :"></a>2ï¼‰é—®é¢˜åŸå› :</h4><p>è¿™æ˜¯å…¸å‹çš„RBACæƒé™æ§åˆ¶åçš„ç»“æœï¼Œä¹Ÿå°±è¯´æˆ‘ä»¬çš„ <code>apiviewer</code> å¹¶æ²¡æœ‰æ“ä½œ kube-system å‘½åç©ºé—´ä¸‹èµ„æºçš„æƒé™ï¼Œå› ä¸º ServiceAccount æ˜¯æ ¹æ® namespace éš”ç¦»çš„ï¼Œè™½ç„¶ <code>cluster-admin</code> å…·æœ‰è¾ƒé«˜çš„æƒé™ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ <code>apiviewer</code> å´åªæœ‰ default å‘½åç©ºé—´çš„æ“ä½œæƒé™ã€‚è€Œä¸å…·å¤‡å…¶ä»– namespace çš„æƒé™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl describe rolebinding apiadmin<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830175553457.png" alt="image-20210830175553457"></p><h4 id="3ï¼‰è§£å†³æ–¹æ¡ˆ"><a href="#3ï¼‰è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3ï¼‰è§£å†³æ–¹æ¡ˆ:"></a>3ï¼‰è§£å†³æ–¹æ¡ˆ:</h4><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº†é—®é¢˜çš„åŸå› ï¼Œè§£å†³èµ·æ¥å°±æ¯”è¾ƒç®€å•äº†ï¼Œå¦‚æœæˆ‘ä»¬è¦é€šè¿‡ API æ“ä½œ <code>kube-system</code> å‘½åç©ºé—´ä¸‹çš„èµ„æºï¼Œé‚£ä¹ˆåªè¦é‡æ–°åˆ›å»ºä¸€ä¸ªå…·æœ‰è¯¥å‘½åç©ºé—´æ“ä½œæƒé™çš„ ServiceAccount å°±å¯ä»¥äº†ã€‚å…¶ä»–å‘½åç©ºé—´ä¹Ÿæ˜¯åŒç†çš„ï¼Œç”šè‡³åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸‹æˆ‘ä»¬å¯ä»¥ç”¨åŒä¸€ä¸ª ServiceAccount çš„åç§°ã€‚</p><p>æˆ‘ä»¬åœ¨æ–‡ç« å¼€å¤´è¯´è¿‡ï¼Œåœ¨ K8S ä¸­å¯¹ API èµ„æºçš„æƒé™åˆ’åˆ†ä¸»è¦å¯ç”¨é€šè¿‡ <code>Role</code> æˆ–è€… <code>ClusterRole</code> æ¥ç»‘å®š <code>ServiceAccount</code>ã€‚ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨é‡Œç³»ç»Ÿé»˜è®¤çš„ ClusterRole è¿›è¡Œäº† RBAC æˆæƒï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ä»æ–°åˆ›å»º Role-RoleBinding çš„æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h5 id="1-åˆ›å»º-RBAC-æˆæƒè§„åˆ™"><a href="#1-åˆ›å»º-RBAC-æˆæƒè§„åˆ™" class="headerlink" title="1. åˆ›å»º RBAC æˆæƒè§„åˆ™"></a>1. åˆ›å»º RBAC æˆæƒè§„åˆ™</h5><p>å…·ä½“çš„ yaml å£°æ˜æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Role</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-role</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">rules:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">configmaps</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">secrets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">nodes</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">pods</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">services</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">resourcequotas</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">replicationcontrollers</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">limitranges</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">persistentvolumeclaims</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">persistentvolumes</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">namespaces</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">endpoints</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">extensions</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">daemonsets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">deployments</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">replicasets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ingresses</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">apps</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">statefulsets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">daemonsets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">deployments</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">replicasets</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">batch</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">cronjobs</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">jobs</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">autoscaling</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">horizontalpodautoscalers</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">authentication.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">tokenreviews</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">authorization.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">subjectaccessreviews</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">policy</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">poddisruptionbudgets</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">certificates.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">certificatesigningrequests</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">storage.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">storageclasses</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">volumeattachments</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">admissionregistration.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">mutatingwebhookconfigurations</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">validatingwebhookconfigurations</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">networking.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">networkpolicies</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-crb</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">subjects:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>      <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">roleRef:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">Role</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-role</span><br>    <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong> è¿™é‡Œå¤„äºåæœŸå­¦ä¹ ç›®çš„ï¼Œæˆæƒæ˜¯è¿‡å¤§çš„ï¼Œå¤§å¤šæ•°æƒé™å¯¹äºéç³»ç»Ÿå±‚é¢çš„å‘½åç©ºé—´æ¥è¯´å¹¶ä¸éœ€è¦ï¼Œå®é™…æƒ…å†µä¸‹ï¼Œå»ºè®®æŒ‰éœ€æœ€å°åŒ–æˆæƒã€‚</p></blockquote><h5 id="2-è·å–å¿…è¦çš„ä¿¡æ¯"><a href="#2-è·å–å¿…è¦çš„ä¿¡æ¯" class="headerlink" title="2. è·å–å¿…è¦çš„ä¿¡æ¯"></a>2. è·å–å¿…è¦çš„ä¿¡æ¯</h5><p>æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ï¼Œå†æ˜¯è·å–æˆ‘ä»¬æ–°åˆ›å»ºçš„ ServiceAccount çš„ç›¸å…³ä¿¡æ¯ï¼ˆæ³¨æ„ namespace çš„åŒºåˆ«ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">SECRET=$(kubectl get serviceaccount apiadmin -n kube-system -ojsonpath=&#x27;&#123;.secrets[0].name&#125;&#x27;)<br>TOKEN=$(kubectl get secret $&#123;SECRET&#125; -n kube-system -ojsonpath=&#x27;&#123;.data.token&#125;&#x27;|base64 -d)<br>kubectl get secret $&#123;SECRET&#125; -n kube-system -o jsonpath=&quot;&#123;.data[&#x27;ca\.crt&#x27;]&#125;&quot; | base64 -d &gt; /tmp/ca.crt<br>APISERVER=https://$(kubectl -n default get endpoints kubernetes --no-headers | awk -F &quot;[, ]+&quot; &#x27;&#123;print $2&#125;&#x27;)<br></code></pre></td></tr></table></figure><h5 id="3-å†æ¬¡è®¿é—®éªŒè¯"><a href="#3-å†æ¬¡è®¿é—®éªŒè¯" class="headerlink" title="3. å†æ¬¡è®¿é—®éªŒè¯"></a>3. å†æ¬¡è®¿é—®éªŒè¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -s $APISERVER/api/v1/namespaces/kube-system/pods/ --header &quot;Authorization: Bearer $TOKEN&quot; --cacert /tmp/ca.crt | jq -r &#x27;.items[].metadata.name&#x27;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°æ­£å¸¸è¿”å›äº† kube-system ä¸‹çš„ pod åˆ—è¡¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831104138845.png" alt="image-20210831104138845"></p><h2 id="å››ã€æ‹“å±•çŸ¥è¯†ï¼šRBAC-æƒé™å®¡è®¡"><a href="#å››ã€æ‹“å±•çŸ¥è¯†ï¼šRBAC-æƒé™å®¡è®¡" class="headerlink" title="å››ã€æ‹“å±•çŸ¥è¯†ï¼šRBAC æƒé™å®¡è®¡"></a>å››ã€æ‹“å±•çŸ¥è¯†ï¼šRBAC æƒé™å®¡è®¡</h2><blockquote><p>ğŸš© </p><p>æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­åå¤å¼ºè°ƒäº†æˆæƒè¦æŒ‰ç…§æœ€å°åŒ–åŸåˆ™æ¥åšï¼Œå› ä¸ºæƒé™è¶Šå¤§ï¼Œè´£ä»»ä¹Ÿè¶Šå¤§ï¼Œæƒé™çš„æ³›æ»¥ï¼Œå¯èƒ½ä¼šå¯¹æ•´ä¸ªä½“ç»Ÿå¯¼è‡´ä¸å¯æŒ½å›çš„åæœï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªè´¦å·ä¸å°å¿ƒæ³„éœ²ï¼Œå¦‚æœè¯¥è´¦å·çš„æƒé™è¾ƒå¤§ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½è¯¥è´¦å·æ‰€èƒ½è°ƒé…çš„èµ„æºéƒ½ä¼šå—åˆ°å¨èƒã€‚å› æ­¤ï¼Œæˆæƒæ—¶å®‰è£…æœ€å°åŒ–åŸåˆ™è¿™å¾ˆé‡è¦ï¼Œå½“ç„¶åŒæ ·é‡è¦çš„è¿˜æœ‰æƒé™çš„å®¡è®¡ã€‚</p><p>äº‹å®ä¸Šï¼ŒK8S å®˜æ–¹çš„ Kubectl å·¥å…·ä¸­å·²ç»ä¸ºç”¨æˆ·æä¾›äº†è¿™æ ·çš„å®¡è®¡å‘½ä»¤ â€”â€” <code>Kubectl Can-I</code>ï¼Œå¯ä»¥é€šè¿‡å¸®åŠ©èœå•å¤§æ¦‚äº†è§£å…¶ç”¨æ³•ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831111150021.png" alt="image-20210831111150021"></p></blockquote><h3 id="1ã€åŸºç¡€ä½¿ç”¨"><a href="#1ã€åŸºç¡€ä½¿ç”¨" class="headerlink" title="1ã€åŸºç¡€ä½¿ç”¨"></a>1ã€åŸºç¡€ä½¿ç”¨</h3><h4 id="1ï¼‰æŸ¥çœ‹ä½ æ˜¯å¦æ‹¥æœ‰-get-pod-çš„æƒé™"><a href="#1ï¼‰æŸ¥çœ‹ä½ æ˜¯å¦æ‹¥æœ‰-get-pod-çš„æƒé™" class="headerlink" title="1ï¼‰æŸ¥çœ‹ä½ æ˜¯å¦æ‹¥æœ‰ get pod çš„æƒé™"></a>1ï¼‰æŸ¥çœ‹ä½ æ˜¯å¦æ‹¥æœ‰ get pod çš„æƒé™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl auth can-i get pods<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831113515080.png" alt="image-20210831113515080"></p><h4 id="2ï¼‰æŸ¥çœ‹ä½ æ˜¯å¦æ‹¥æœ‰-cluster-admin-çš„æƒé™"><a href="#2ï¼‰æŸ¥çœ‹ä½ æ˜¯å¦æ‹¥æœ‰-cluster-admin-çš„æƒé™" class="headerlink" title="2ï¼‰æŸ¥çœ‹ä½ æ˜¯å¦æ‹¥æœ‰ cluster-admin çš„æƒé™"></a>2ï¼‰æŸ¥çœ‹ä½ æ˜¯å¦æ‹¥æœ‰ cluster-admin çš„æƒé™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl auth can-i &quot;*&quot; &quot;*&quot;<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831113615960.png" alt="image-20210831113615960"></p><h4 id="3ï¼‰åˆ—å‡ºä½ åœ¨æŸä¸ª-namesapce-ä¸­æ‹¥æœ‰çš„æ‰€æœ‰æƒé™"><a href="#3ï¼‰åˆ—å‡ºä½ åœ¨æŸä¸ª-namesapce-ä¸­æ‹¥æœ‰çš„æ‰€æœ‰æƒé™" class="headerlink" title="3ï¼‰åˆ—å‡ºä½ åœ¨æŸä¸ª namesapce ä¸­æ‹¥æœ‰çš„æ‰€æœ‰æƒé™"></a>3ï¼‰åˆ—å‡ºä½ åœ¨æŸä¸ª namesapce ä¸­æ‹¥æœ‰çš„æ‰€æœ‰æƒé™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl auth can-i --list --namespace=kube-system<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831113700788.png" alt="image-20210831113700788"></p><h3 id="2ã€ç»“åˆä¸Šé¢å†…å®¹ç»ƒä¹ ä¸€ä¸‹ï¼š"><a href="#2ã€ç»“åˆä¸Šé¢å†…å®¹ç»ƒä¹ ä¸€ä¸‹ï¼š" class="headerlink" title="2ã€ç»“åˆä¸Šé¢å†…å®¹ç»ƒä¹ ä¸€ä¸‹ï¼š"></a>2ã€ç»“åˆä¸Šé¢å†…å®¹ç»ƒä¹ ä¸€ä¸‹ï¼š</h3><h4 id="1ï¼‰default-ä¸‹-çš„-apiviewer"><a href="#1ï¼‰default-ä¸‹-çš„-apiviewer" class="headerlink" title="1ï¼‰default ä¸‹ çš„ apiviewer"></a>1ï¼‰default ä¸‹ çš„ apiviewer</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl auth can-i list pods --as=system:serviceaccount:default:apiviewer -n kube-system <br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831112734259.png" alt="image-20210831112734259"></p><h4 id="2ï¼‰kube-system-ä¸‹çš„-apiadmin"><a href="#2ï¼‰kube-system-ä¸‹çš„-apiadmin" class="headerlink" title="2ï¼‰kube-system ä¸‹çš„ apiadmin"></a>2ï¼‰kube-system ä¸‹çš„ apiadmin</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl auth can-i list pods --as=system:serviceaccount:kube-system:apiadmin -n kube-system <br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210831112746463.png" alt="image-20210831112746463"></p><h2 id="äº”ã€æ€è€ƒä¸ç»ƒä¹ "><a href="#äº”ã€æ€è€ƒä¸ç»ƒä¹ " class="headerlink" title="äº”ã€æ€è€ƒä¸ç»ƒä¹ "></a>äº”ã€æ€è€ƒä¸ç»ƒä¹ </h2><h3 id="å¦‚æœæˆ‘è¿™è¾¹éœ€è¦æ–°å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œå¹¶æœŸæœ›é€šè¿‡-HTTP-REST-API-å¯¹è¯¥å‘½åç©ºé—´çš„èµ„æºè¿›è¡Œæ“ä½œï¼Œä½ ä¼šäº†å—ï¼Ÿ"><a href="#å¦‚æœæˆ‘è¿™è¾¹éœ€è¦æ–°å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œå¹¶æœŸæœ›é€šè¿‡-HTTP-REST-API-å¯¹è¯¥å‘½åç©ºé—´çš„èµ„æºè¿›è¡Œæ“ä½œï¼Œä½ ä¼šäº†å—ï¼Ÿ" class="headerlink" title="å¦‚æœæˆ‘è¿™è¾¹éœ€è¦æ–°å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œå¹¶æœŸæœ›é€šè¿‡ HTTP REST API å¯¹è¯¥å‘½åç©ºé—´çš„èµ„æºè¿›è¡Œæ“ä½œï¼Œä½ ä¼šäº†å—ï¼Ÿ"></a>å¦‚æœæˆ‘è¿™è¾¹éœ€è¦æ–°å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œå¹¶æœŸæœ›é€šè¿‡ HTTP REST API å¯¹è¯¥å‘½åç©ºé—´çš„èµ„æºè¿›è¡Œæ“ä½œï¼Œä½ ä¼šäº†å—ï¼Ÿ</h3><h4 id="æ€è·¯æç¤º"><a href="#æ€è·¯æç¤º" class="headerlink" title="æ€è·¯æç¤º:"></a>æ€è·¯æç¤º:</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span><br><span class="hljs-attr">metadata:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">xxx</span><br>    <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">xxx</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># ...</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Golang K8S API å¿«é€Ÿå…¥é—¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è…¾è®¯è“é²¸ï¼ˆGoç‰ˆï¼‰ å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</title>
    <link href="/2021/08/30/%E8%85%BE%E8%AE%AF%E8%93%9D%E9%B2%B8%EF%BC%88Go%E7%89%88%EF%BC%89-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C/"/>
    <url>/2021/08/30/%E8%85%BE%E8%AE%AF%E8%93%9D%E9%B2%B8%EF%BC%88Go%E7%89%88%EF%BC%89-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="è…¾è®¯è“é²¸ï¼ˆGoç‰ˆï¼‰-å¿«é€Ÿå…¥é—¨æ‰‹å†Œ"><a href="#è…¾è®¯è“é²¸ï¼ˆGoç‰ˆï¼‰-å¿«é€Ÿå…¥é—¨æ‰‹å†Œ" class="headerlink" title="è…¾è®¯è“é²¸ï¼ˆGoç‰ˆï¼‰ å¿«é€Ÿå…¥é—¨æ‰‹å†Œ"></a>è…¾è®¯è“é²¸ï¼ˆGoç‰ˆï¼‰ å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</h1><span id="more"></span><h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/bk-cmdb.png" alt="bk-cmdb"></p><p><a href="https://bk.tencent.com/">è“é²¸å®˜ç½‘</a></p><p><a href="https://github.com/Tencent/bk-cmdb">å®˜æ–¹github</a></p><h3 id="1ã€è“é²¸ç®€ä»‹"><a href="#1ã€è“é²¸ç®€ä»‹" class="headerlink" title="1ã€è“é²¸ç®€ä»‹"></a>1ã€è“é²¸ç®€ä»‹</h3><p>è“é²¸é…ç½®å¹³å°ï¼ˆè“é²¸CMDBï¼‰æ˜¯ä¸€ä¸ªé¢å‘èµ„äº§åŠåº”ç”¨çš„ä¼ä¸šçº§é…ç½®ç®¡ç†å¹³å°ã€‚</p><p>è“é²¸é…ç½®å¹³å°æä¾›äº†å…¨æ–°è‡ªå®šä¹‰æ¨¡å‹ç®¡ç†ï¼Œç”¨æˆ·ä¸ä»…å¯ä»¥æ–¹ä¾¿åœ°å®ç°å†…ç½®æ¨¡å‹å±æ€§çš„æ‹“å±•ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿæ ¹æ®ä¸åŒçš„ä¼ä¸šéœ€æ±‚éšæ—¶æ–°å¢æ¨¡å‹å’Œå…³è”å…³ç³»ï¼ŒæŠŠç½‘ç»œã€ä¸­é—´ä»¶ã€è™šæ‹Ÿèµ„æºç­‰çº³å…¥åˆ°CMDBçš„ç®¡ç†ä¸­ã€‚é™¤æ­¤ä¹‹å¤–è¿˜å¢åŠ äº†æ›´å¤šç¬¦åˆåœºæ™¯éœ€è¦çš„æ–°åŠŸèƒ½ï¼šæœºå™¨æ•°æ®å¿«ç…§ã€æ•°æ®è‡ªåŠ¨å‘ç°ã€å˜æ›´äº‹ä»¶ä¸»åŠ¨æ¨é€ã€æ›´åŠ ç²¾ç»†çš„æƒé™ç®¡ç†ã€å¯æ‹“å±•çš„ä¸šåŠ¡æ‹“æ‰‘ç­‰åŠŸèƒ½ã€‚</p><p>åœ¨æŠ€æœ¯æ„å»ºä¸Šï¼Œæ¶æ„çš„æ ¸å¿ƒèšç„¦äºèµ„æºï¼Œæˆ‘ä»¬æŠŠCMDBç®¡ç†çš„åŸå­èµ„æºåˆ†ä¸ºä¸»æœºã€è¿›ç¨‹å’Œé€šç”¨å¯¹è±¡ä¸‰ç§ç±»å‹ï¼Œå¹¶æ„å»ºäº†å¯¹è¿™äº›èµ„æºçš„åŸå­æ“ä½œå±‚ã€‚åœ¨è¿™äº›åŸå­æ“ä½œä¹‹ä¸Šï¼Œæˆ‘ä»¬æ„å»ºäº†æ›´è´´è¿‘ç”¨æˆ·æ“ä½œçš„åœºæ™¯å±‚ï¼Œåœºæ™¯å±‚é€šè¿‡å¯¹ä¸åŒèµ„æºçš„ç»„åˆæ“ä½œæ¥å®Œæˆç”¨æˆ·çš„è¯·æ±‚ã€‚</p><h3 id="2ã€å…·ä½“åŠŸèƒ½"><a href="#2ã€å…·ä½“åŠŸèƒ½" class="headerlink" title="2ã€å…·ä½“åŠŸèƒ½"></a>2ã€å…·ä½“åŠŸèƒ½</h3><ul><li>æ‹“æ‰‘åŒ–çš„ä¸»æœºç®¡ç†ï¼šä¸»æœºåŸºç¡€å±æ€§ã€ä¸»æœºå¿«ç…§æ•°æ®ã€ä¸»æœºå½’å±å…³ç³»ç®¡ç†</li><li>ç»„ç»‡æ¶æ„ç®¡ç†ï¼šå¯æ‰©å±•çš„åŸºäºä¸šåŠ¡çš„ç»„ç»‡æ¶æ„ç®¡ç†</li><li>æ¨¡å‹ç®¡ç†ï¼šæ—¢èƒ½ç®¡ç†ä¸šåŠ¡ã€é›†ç¾¤ã€ä¸»æœºç­‰å†…ç½®æ¨¡å‹ï¼Œä¹Ÿèƒ½è‡ªå®šä¹‰æ¨¡å‹</li><li>è¿›ç¨‹ç®¡ç†ï¼šåŸºäºæ¨¡å—çš„ä¸»æœºè¿›ç¨‹ç®¡ç†</li><li>äº‹ä»¶æ³¨å†Œä¸æ¨é€ï¼šæä¾›åŸºäºå›è°ƒæ–¹å¼çš„äº‹ä»¶æ³¨å†Œä¸æ¨é€</li><li>é€šç”¨æƒé™ç®¡ç†ï¼šçµæ´»çš„åŸºäºç”¨æˆ·ç»„çš„æƒé™ç®¡ç†</li><li>æ“ä½œå®¡è®¡ï¼šç”¨æˆ·æ“ä½œè¡Œä¸ºçš„å®¡è®¡ä¸å›æº¯</li></ul><h3 id="3ã€æ¶æ„è®¾è®¡"><a href="#3ã€æ¶æ„è®¾è®¡" class="headerlink" title="3ã€æ¶æ„è®¾è®¡"></a>3ã€æ¶æ„è®¾è®¡</h3><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826102802263.png" alt="Goè“é²¸æ¶æ„è®¾è®¡"></p><h3 id="4ã€æœåŠ¡è¿›ç¨‹æ¸…å•"><a href="#4ã€æœåŠ¡è¿›ç¨‹æ¸…å•" class="headerlink" title="4ã€æœåŠ¡è¿›ç¨‹æ¸…å•"></a>4ã€æœåŠ¡è¿›ç¨‹æ¸…å•</h3><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>cmdb_webserver</td><td>web server æœåŠ¡å­ç›®å½•</td></tr><tr><td>cmdb_apiserver</td><td>åœºæ™¯å±‚æœåŠ¡ï¼Œapi æœåŠ¡</td></tr><tr><td>cmdb_coreservice</td><td>èµ„æºç®¡ç†å±‚ï¼Œæä¾›åŸå­æ¥å£æœåŠ¡</td></tr><tr><td>cmdb_adminserver</td><td>è´Ÿè´£ç³»ç»Ÿæ•°æ®çš„åˆå§‹åŒ–ä»¥åŠé…ç½®ç®¡ç†å·¥ä½œ</td></tr><tr><td>cmdb_authserver</td><td>é‰´æƒè®¤è¯æœåŠ¡</td></tr><tr><td>cmdb_cloudserver</td><td>äº‘æ•°æ®ç®¡ç†æœåŠ¡</td></tr><tr><td>cmdb_datacollection</td><td>åœºæ™¯å±‚æœåŠ¡ï¼Œæ•°æ®é‡‡é›†æœåŠ¡</td></tr><tr><td>cmdb_eventserver</td><td>åœºæ™¯å±‚æœåŠ¡ï¼Œäº‹ä»¶æ¨é€æœåŠ¡</td></tr><tr><td>cmdb_hostserver</td><td>åœºæ™¯å±‚æœåŠ¡ï¼Œä¸»æœºæ•°æ®ç»´æŠ¤</td></tr><tr><td>cmdb_operationserver</td><td>åœºæ™¯å±‚æœåŠ¡ï¼Œæä¾›ä¸è¿è¥ç»Ÿè®¡ç›¸å…³åŠŸèƒ½æœåŠ¡</td></tr><tr><td>cmdb_procserver</td><td>åœºæ™¯å±‚æœåŠ¡ï¼Œè´Ÿè´£è¿›ç¨‹æ•°æ®çš„ç»´æŠ¤</td></tr><tr><td>cmdb_synchronizeserver</td><td>åœºæ™¯å±‚æœåŠ¡ï¼Œæ•°æ®åŒæ­¥æœåŠ¡</td></tr><tr><td>cmdb_toposerver</td><td>åœºæ™¯å±‚æœåŠ¡ï¼Œè´Ÿè´£æ¨¡å‹çš„å®šä¹‰ä»¥åŠä¸»æœºã€ä¸šåŠ¡ã€æ¨¡å—åŠè¿›ç¨‹ç­‰å®ä¾‹æ•°æ®çš„ç»´æŠ¤</td></tr><tr><td>cmdb_taskserver</td><td>åœºæ™¯å±‚æœåŠ¡ï¼Œå¼‚æ­¥ä»»åŠ¡ç®¡ç†æœåŠ¡</td></tr></tbody></table><h3 id="5ã€ä»£ç ç»“æ„"><a href="#5ã€ä»£ç ç»“æ„" class="headerlink" title="5ã€ä»£ç ç»“æ„"></a>5ã€ä»£ç ç»“æ„</h3><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826103025159.png" alt="Goè“é²¸ä»£ç ç»“æ„"></p><h4 id="ç›®å½•ç»“æ„è¯´æ˜ï¼š"><a href="#ç›®å½•ç»“æ„è¯´æ˜ï¼š" class="headerlink" title="ç›®å½•ç»“æ„è¯´æ˜ï¼š"></a>ç›®å½•ç»“æ„è¯´æ˜ï¼š</h4><table><thead><tr><th>ç›®å½•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>web-server</td><td>webå±‚æœåŠ¡åç«¯ï¼ŒåŸºäº golang çš„ ginæ¡†æ¶</td></tr><tr><td>ui</td><td>webå±‚æœåŠ¡å‰ç«¯ï¼ŒåŸºäº vue.js</td></tr><tr><td>test</td><td>ç³»ç»ŸæœåŠ¡çš„æµ‹è¯•ç”¨ä¾‹ï¼ŒåŸºäº golang åŸç”Ÿ</td></tr><tr><td>tools</td><td>å®¢æˆ·ç«¯ç®¡ç†å·¥å…·ï¼ˆåŸºäº golangï¼‰ä»¥åŠè¾…åŠ©è„šæœ¬å·¥å…·ï¼ˆåŸºäº Javascriptï¼‰</td></tr><tr><td>apiserver</td><td>æ¥å…¥å±‚ api æœåŠ¡å±‚ï¼ŒåŸºäº golang çš„ go-restful æ¡†æ¶</td></tr><tr><td>scene_server</td><td>æ¥å…¥å±‚ åœºæ™¯å¾®æœåŠ¡å±‚ï¼ŒåŸºäº golang çš„ go-restful æ¡†æ¶</td></tr><tr><td>source_controller</td><td>æ¥å…¥å±‚ èµ„æºè°ƒåº¦å±‚ï¼ŒåŸºäº golang çš„ go-restful æ¡†æ¶ï¼Œæä¾›åŸå­æ¥å£æœåŠ¡</td></tr><tr><td>common</td><td>é¡¹ç›®å…¬å…±ä¾èµ–åº“ï¼ŒåŸºäº golang åŸç”Ÿ</td></tr><tr><td>storage</td><td>å­˜å‚¨æ¥å…¥å°è£…ï¼ŒåŸºäº golang åŸç”Ÿ</td></tr><tr><td>thirdpartyclient</td><td>ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯æ¥å…¥å°è£…ï¼ŒåŸºäº golang åŸç”Ÿ</td></tr></tbody></table><h2 id="äºŒã€ç¼–è¯‘"><a href="#äºŒã€ç¼–è¯‘" class="headerlink" title="äºŒã€ç¼–è¯‘"></a>äºŒã€ç¼–è¯‘</h2><h3 id="1ã€ç¼–è¯‘ç¯å¢ƒå‡†å¤‡"><a href="#1ã€ç¼–è¯‘ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1ã€ç¼–è¯‘ç¯å¢ƒå‡†å¤‡"></a>1ã€ç¼–è¯‘ç¯å¢ƒå‡†å¤‡</h3><h4 id="1ï¼‰ç¯å¢ƒéœ€æ±‚"><a href="#1ï¼‰ç¯å¢ƒéœ€æ±‚" class="headerlink" title="1ï¼‰ç¯å¢ƒéœ€æ±‚"></a>1ï¼‰ç¯å¢ƒéœ€æ±‚</h4><ul><li>golang &gt;= 1.8</li><li>python &gt;= 2.7.5</li><li>nodejs &gt;= 4.0.0ï¼ˆç¼–è¯‘è¿‡ç¨‹ä¸­éœ€è¦å¯ä»¥è¿å…¬ç½‘ä¸‹è½½ä¾èµ–åŒ…ï¼‰</li></ul><h4 id="2ï¼‰å®‰è£…-Go"><a href="#2ï¼‰å®‰è£…-Go" class="headerlink" title="2ï¼‰å®‰è£… Go"></a>2ï¼‰å®‰è£… Go</h4><p>æ¨èä½¿ç”¨ g è¿›è¡Œ Go çš„ç‰ˆæœ¬ç®¡ç†ï¼Œå‚è€ƒå¦‚ä¸‹æ–‡æ¡£</p><p><a href="https://tareya.github.io/2021/08/25/golang-%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-%E2%80%94-g/#golang-%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-%E2%80%94-g">golang å¤šç‰ˆæœ¬ç®¡ç†å·¥å…· â€” g</a></p><h4 id="3ï¼‰å®‰è£…-node-js"><a href="#3ï¼‰å®‰è£…-node-js" class="headerlink" title="3ï¼‰å®‰è£… node.js"></a>3ï¼‰å®‰è£… node.js</h4><h5 id="1-ä¸‹è½½æºç åŒ…"><a href="#1-ä¸‹è½½æºç åŒ…" class="headerlink" title="1. ä¸‹è½½æºç åŒ…"></a>1. ä¸‹è½½æºç åŒ…</h5><p><a href="https://nodejs.org/zh-cn/download/">å®˜ç½‘ä¸‹è½½åœ°å€</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget -c https://nodejs.org/dist/v14.17.5/node-v14.17.5-linux-x64.tar.xz\<br></code></pre></td></tr></table></figure><h5 id="2-è§£å‹å¹¶è®¾ç½®è·¯å¾„"><a href="#2-è§£å‹å¹¶è®¾ç½®è·¯å¾„" class="headerlink" title="2. è§£å‹å¹¶è®¾ç½®è·¯å¾„"></a>2. è§£å‹å¹¶è®¾ç½®è·¯å¾„</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xf node-v14.17.5-linux-x64.tar.xz -C /data/applications/ &amp;&amp; \<br>cd /data/applications &amp;&amp; \<br>ln -s node-v14.17.5-linux-x64 node &amp;&amp; \<br>ln -s /data/applications/node/bin/* /usr/local/bin/<br></code></pre></td></tr></table></figure><p>éªŒè¯:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">node -v <br>npm -v<br></code></pre></td></tr></table></figure><h5 id="3-å®‰è£…-cnpm"><a href="#3-å®‰è£…-cnpm" class="headerlink" title="3. å®‰è£… cnpm"></a>3. å®‰è£… cnpm</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g cnpm --registry=https://registry.npm.taobao.org<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210825165451698.png" alt="image-20210825165451698"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s /data/applications/node/bin/cnpm /usr/local/bin/<br></code></pre></td></tr></table></figure><p>éªŒè¯:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cnpm -v<br></code></pre></td></tr></table></figure><h3 id="2ã€æºç ç¼–è¯‘"><a href="#2ã€æºç ç¼–è¯‘" class="headerlink" title="2ã€æºç ç¼–è¯‘"></a>2ã€æºç ç¼–è¯‘</h3><h4 id="1ï¼‰æºç ä¸‹è½½"><a href="#1ï¼‰æºç ä¸‹è½½" class="headerlink" title="1ï¼‰æºç ä¸‹è½½"></a>1ï¼‰æºç ä¸‹è½½</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir ~/go/src &amp;&amp; \<br>export GOPATH=~/go &amp;&amp; \<br>cd $GOPATH/src &amp;&amp; \<br>git clone git@github.com:Tareya/configcenter.git<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰æ•´ä½“ç¼–è¯‘"><a href="#2ï¼‰æ•´ä½“ç¼–è¯‘" class="headerlink" title="2ï¼‰æ•´ä½“ç¼–è¯‘"></a>2ï¼‰æ•´ä½“ç¼–è¯‘</h4><blockquote><p>ğŸš© <strong>ä¸‰ç§ç¼–è¯‘æ¨¡å¼</strong></p><p>å®˜æ–¹æä¾›çš„ Makefile æä¾›äº†å¤šç§ç¼–è¯‘æ¨¡å¼</p><p>1âƒ£ï¸ <strong>æŒ‡å®šç‰ˆæœ¬å·çš„ç¼–è¯‘</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">VERSION=xxxx make<br></code></pre></td></tr></table></figure><p>2âƒ£ï¸ <strong>æœ¬åœ°ä»£ç åˆ†æ”¯ç¼–è¯‘</strong></p><p>Makefile é»˜è®¤ä¸ºæ”¯æŒ darwin å¹³å°ï¼Œä¸” é»˜è®¤æƒ…å†µæ˜¯å‰åç«¯ä¸€èµ·ç¼–è¯‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make <br></code></pre></td></tr></table></figure><p>3âƒ£ï¸ <strong>ç¼–è¯‘å‚æ•°</strong></p><p>æ”¯æŒ linux å¹³å°ç¼–è¯‘ï¼Œéœ€è¦æŒ‡å®š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make linux<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ cnpm ä»£æ›¿ npm ç¼–è¯‘å‰ç«¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make NPM=cnpm<br></code></pre></td></tr></table></figure></blockquote><h5 id="æ”¯æŒ-Linux-å¹³å°ç¼–è¯‘"><a href="#æ”¯æŒ-Linux-å¹³å°ç¼–è¯‘" class="headerlink" title="æ”¯æŒ Linux å¹³å°ç¼–è¯‘"></a>æ”¯æŒ Linux å¹³å°ç¼–è¯‘</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd $GOPATH/src/configcenter/src &amp;&amp; \<br>export GOPATH=~/go &amp;&amp; \<br>make linux NPM=cnpm<br></code></pre></td></tr></table></figure><h5 id="é—®é¢˜è®°å½•-è§£å†³ç¯å¢ƒå˜é‡è¯†åˆ«é—®é¢˜"><a href="#é—®é¢˜è®°å½•-è§£å†³ç¯å¢ƒå˜é‡è¯†åˆ«é—®é¢˜" class="headerlink" title="é—®é¢˜è®°å½•: è§£å†³ç¯å¢ƒå˜é‡è¯†åˆ«é—®é¢˜"></a>é—®é¢˜è®°å½•: è§£å†³ç¯å¢ƒå˜é‡è¯†åˆ«é—®é¢˜</h5><h6 id="é”™è¯¯ä¿¡æ¯ï¼š"><a href="#é”™è¯¯ä¿¡æ¯ï¼š" class="headerlink" title="é”™è¯¯ä¿¡æ¯ï¼š"></a>é”™è¯¯ä¿¡æ¯ï¼š</h6><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210825172030664.png" alt="image-20210825172030664"></p><h6 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› :"></a>é—®é¢˜åŸå› :</h6><p>åœ¨å®˜æ–¹æä¾›çš„ Makefile ä¸­ï¼Œè·¯å¾„æ˜¯å†™æ­»çš„ï¼Œæ‰€ä»¥å¦‚æœè·¯å¾„ä¸ä¸€è‡´ï¼Œä¼šæ— æ³•è¯»å–åˆ°å¯¹åº”çš„æ–‡ä»¶</p><h6 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ:"></a>è§£å†³æ–¹æ¡ˆ:</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export GOPATH=~/go<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰åç«¯ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰"><a href="#3ï¼‰åç«¯ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="3ï¼‰åç«¯ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰"></a>3ï¼‰åç«¯ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make server <br></code></pre></td></tr></table></figure><h4 id="4ï¼‰å‰ç«¯ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰"><a href="#4ï¼‰å‰ç«¯ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="4ï¼‰å‰ç«¯ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰"></a>4ï¼‰å‰ç«¯ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make ui NPM=cnpm<br></code></pre></td></tr></table></figure><h5 id="é—®é¢˜è®°å½•-è§£å†³nodeç¼–è¯‘oomé—®é¢˜"><a href="#é—®é¢˜è®°å½•-è§£å†³nodeç¼–è¯‘oomé—®é¢˜" class="headerlink" title="é—®é¢˜è®°å½•: è§£å†³nodeç¼–è¯‘oomé—®é¢˜"></a>é—®é¢˜è®°å½•: è§£å†³nodeç¼–è¯‘oomé—®é¢˜</h5><h6 id="é”™è¯¯ä¿¡æ¯"><a href="#é”™è¯¯ä¿¡æ¯" class="headerlink" title="é”™è¯¯ä¿¡æ¯:"></a>é”™è¯¯ä¿¡æ¯:</h6><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210825172156810.png" alt="image-20210825172156810"></p><h6 id="é—®é¢˜åŸå› -1"><a href="#é—®é¢˜åŸå› -1" class="headerlink" title="é—®é¢˜åŸå› :"></a>é—®é¢˜åŸå› :</h6><p>è¯¥é—®é¢˜æ˜¯ç”±äºå‰ç«¯ä»£ç é—®é¢˜å¯¼è‡´çš„ node ç¼–è¯‘ OOM ï¼Œæ—§ç‰ˆæœ¬æš‚æ—¶æ²¡æœ‰æ­¤ç±»é—®é¢˜ï¼Œæ•…æ¨èä½¿ç”¨ release <a href="https://github.com/Tencent/bk-cmdb/releases/tag/release-v3.9.5">v3.9.5</a> çš„æºç </p><p><a href="https://github.com/Tencent/bk-cmdb/issues/5341">å®˜æ–¹ github issue è®°å½•</a></p><p><a href="https://tareya.github.io/2021/08/26/node-%E7%BC%96%E8%AF%91-JavaScript-heap-out-of-memory-%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">ç±»ä¼¼é—®é¢˜è§£å†³æ–¹æ³•</a></p><h3 id="3ã€æ‰“åŒ…é•œåƒ"><a href="#3ã€æ‰“åŒ…é•œåƒ" class="headerlink" title="3ã€æ‰“åŒ…é•œåƒ"></a>3ã€æ‰“åŒ…é•œåƒ</h3><h4 id="1ï¼‰æ‰“åŒ…å‰åç«¯ç¼–è¯‘ç»“æœ"><a href="#1ï¼‰æ‰“åŒ…å‰åç«¯ç¼–è¯‘ç»“æœ" class="headerlink" title="1ï¼‰æ‰“åŒ…å‰åç«¯ç¼–è¯‘ç»“æœ"></a>1ï¼‰æ‰“åŒ…å‰åç«¯ç¼–è¯‘ç»“æœ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">make package<br></code></pre></td></tr></table></figure><p>å½’æ¡£åŒ…å­˜æ”¾ä½ç½®ï¼š<code>~/go/src/configcenter/src/bin/pub/cmdb.tar.gz</code></p><h4 id="2ï¼‰é•œåƒåˆ¶ä½œ"><a href="#2ï¼‰é•œåƒåˆ¶ä½œ" class="headerlink" title="2ï¼‰é•œåƒåˆ¶ä½œ"></a>2ï¼‰é•œåƒåˆ¶ä½œ</h4><p>è§£å‹cmdb.tar.gzï¼Œè¿›å…¥cmdbç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> -i å‚æ•°åé¢é…ç½®çš„å‚æ•°æ˜¯åŸºç¡€é•œåƒï¼ŒåŸºç¡€é•œåƒå¯ä»¥è‡ªå·±åˆ¶ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¬å…±é•œåƒã€‚v</span><br>./image.sh -i &lt;base_image&gt;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€éƒ¨ç½²"><a href="#ä¸‰ã€éƒ¨ç½²" class="headerlink" title="ä¸‰ã€éƒ¨ç½²"></a>ä¸‰ã€éƒ¨ç½²</h2><h3 id="1ã€ä¾èµ–çš„ä¸‰æ–¹ç»„ä»¶æ¸…å•"><a href="#1ã€ä¾èµ–çš„ä¸‰æ–¹ç»„ä»¶æ¸…å•" class="headerlink" title="1ã€ä¾èµ–çš„ä¸‰æ–¹ç»„ä»¶æ¸…å•"></a>1ã€ä¾èµ–çš„ä¸‰æ–¹ç»„ä»¶æ¸…å•</h3><ul><li>ZooKeeper &gt;= 3.4.11</li><li>Redis &gt;= 3.2.11</li><li>MongoDB &gt;= 4.2</li><li>Elasticsearch &gt;= 7.0.0 (ç”¨äºå…¨æ–‡æ£€ç´¢åŠŸèƒ½)</li><li>Monstache &gt;= 6.0.0 (ç”¨äºå…¨æ–‡æ£€ç´¢åŠŸèƒ½)</li></ul><h3 id="2ã€Docker-éƒ¨ç½²-Zookeeperï¼ˆå•æœºï¼‰"><a href="#2ã€Docker-éƒ¨ç½²-Zookeeperï¼ˆå•æœºï¼‰" class="headerlink" title="2ã€Docker éƒ¨ç½² Zookeeperï¼ˆå•æœºï¼‰"></a>2ã€Docker éƒ¨ç½² Zookeeperï¼ˆå•æœºï¼‰</h3><p><a href="https://zookeeper.apache.org/">Zookeeper å®˜ç½‘åœ°å€</a></p><h4 id="1ï¼‰ç¯å¢ƒå‡†å¤‡"><a href="#1ï¼‰ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1ï¼‰ç¯å¢ƒå‡†å¤‡"></a>1ï¼‰ç¯å¢ƒå‡†å¤‡</h4><h5 id="1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-3-4-12-ç‰ˆæœ¬ï¼‰"><a href="#1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-3-4-12-ç‰ˆæœ¬ï¼‰" class="headerlink" title="1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è 3.4.12 ç‰ˆæœ¬ï¼‰"></a>1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è 3.4.12 ç‰ˆæœ¬ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull zookeeper:3.4.12<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•"><a href="#2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•" class="headerlink" title="2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•"></a>2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /data/bk-cmdb/zookeepr/&#123;conf,data,log&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶"><a href="#2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶" class="headerlink" title="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶</h4><h5 id="1-æ–°å»ºé…ç½®æ–‡ä»¶"><a href="#1-æ–°å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="1. æ–°å»ºé…ç½®æ–‡ä»¶"></a>1. æ–°å»ºé…ç½®æ–‡ä»¶</h5><p>æ–‡ä»¶è·¯å¾„: <code>/data/bk-cmdb/zookeepr/conf/zoo.cfg</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">clientPort=2181<br>dataDir=/data<br>dataLogDir=/datalog<br>tickTime=2000<br></code></pre></td></tr></table></figure><h5 id="2-å‚æ•°è¯´æ˜"><a href="#2-å‚æ•°è¯´æ˜" class="headerlink" title="2. å‚æ•°è¯´æ˜"></a>2. å‚æ•°è¯´æ˜</h5><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>clientPort</td><td>zookeeper ç›‘å¬ç«¯å£</td></tr><tr><td>dataDir</td><td>Zookeeper ä¿å­˜æ•°æ®çš„ç›®å½•</td></tr><tr><td>dataLogDir</td><td>Zookeeper ä¿å­˜æ—¥å¿—çš„ç›®å½•</td></tr><tr><td>tickTime</td><td>Zookeeper æœåŠ¡ä¹‹é—´æˆ–ä¸å®¢æˆ·ç«¯ä¹‹é—´å¿ƒè·³æ£€æµ‹çš„é—´éš”æ—¶é—´</td></tr></tbody></table><h4 id="3ï¼‰å¯åŠ¨å®¹å™¨"><a href="#3ï¼‰å¯åŠ¨å®¹å™¨" class="headerlink" title="3ï¼‰å¯åŠ¨å®¹å™¨"></a>3ï¼‰å¯åŠ¨å®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --name zookeeper -p 2181:2181 -v /data/bk-cmdb/zookeepr/data:/data -v /data/bk-cmdb/zookeepr/log:/datalog -v /etc/localtime:/etc/localtime --restart=always zookeeper:3.4.12<br></code></pre></td></tr></table></figure><h3 id="3ã€éƒ¨ç½²-Redis"><a href="#3ã€éƒ¨ç½²-Redis" class="headerlink" title="3ã€éƒ¨ç½² Redis"></a>3ã€éƒ¨ç½² Redis</h3><h4 id="1ï¼‰ç¯å¢ƒå‡†å¤‡-1"><a href="#1ï¼‰ç¯å¢ƒå‡†å¤‡-1" class="headerlink" title="1ï¼‰ç¯å¢ƒå‡†å¤‡"></a>1ï¼‰ç¯å¢ƒå‡†å¤‡</h4><h5 id="1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-3-2-11-ç‰ˆæœ¬ï¼‰"><a href="#1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-3-2-11-ç‰ˆæœ¬ï¼‰" class="headerlink" title="1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è 3.2.11 ç‰ˆæœ¬ï¼‰"></a>1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è 3.2.11 ç‰ˆæœ¬ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull redis:3.2.11-alpine<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•-1"><a href="#2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•-1" class="headerlink" title="2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•"></a>2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /data/bk-cmdb/redis/&#123;conf,data,log&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶-1"><a href="#2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶-1" class="headerlink" title="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶</h4><h5 id="1-æ–°å»ºé…ç½®æ–‡ä»¶-1"><a href="#1-æ–°å»ºé…ç½®æ–‡ä»¶-1" class="headerlink" title="1. æ–°å»ºé…ç½®æ–‡ä»¶"></a>1. æ–°å»ºé…ç½®æ–‡ä»¶</h5><p>æ–‡ä»¶è·¯å¾„: <code>/data/bk-cmdb/redis/conf/redis.conf</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">port 6379<br>bind 0.0.0.0<br>loglevel notice<br>logfile &quot;/tmp/redis.log&quot;<br><br>dbfilename dump.rdb<br>dir ./<br>save 900 1<br>stop-writes-on-bgsave-error yes<br>rdbcompression yes<br>rdbchecksum yes<br><br>daemonize no<br>protected-mode no<br>requirepass &#x27;PassWord@123&#x27;<br><br>maxmemory 1g<br>maxmemory-policy volatile-lru<br></code></pre></td></tr></table></figure><h5 id="2-å‚æ•°è¯´æ˜-1"><a href="#2-å‚æ•°è¯´æ˜-1" class="headerlink" title="2. å‚æ•°è¯´æ˜"></a>2. å‚æ•°è¯´æ˜</h5><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>port</td><td>redis ç›‘å¬ç«¯å£</td></tr><tr><td>bind</td><td>redis ç›‘å¬åœ°å€ï¼Œç”±äºå®¹å™¨å¯åŠ¨ï¼Œæ•…ä½¿ç”¨ 0.0.0.0</td></tr><tr><td>loglevel</td><td>æ—¥å¿—çº§åˆ«</td></tr><tr><td>logfile</td><td>redis æ—¥å¿—æ–‡ä»¶ä¿å­˜è·¯å¾„</td></tr><tr><td>dbfilename</td><td>å¼€å¯ rdb æŒä¹…åŒ–</td></tr><tr><td>dir</td><td>æŒä¹…åŒ–æ–‡ä»¶ä¿å­˜è·¯å¾„</td></tr><tr><td>save</td><td>æ»¡è¶³æ¡ä»¶åˆ™åˆ·å…¥æŒä¹…åŒ–æ–‡ä»¶</td></tr><tr><td>stop-writes-on-bgsave-error</td><td>åå°saveå‡ºé”™,å‰å°è¦åœæ­¢å†™æ“ä½œ</td></tr><tr><td>rdbcompression</td><td>æ˜¯å¦å¯¹ rdb æŒä¹…åŒ–è¿›è¡Œæ•°æ®å‹ç¼©</td></tr><tr><td>rdbchecksum</td><td>æ˜¯å¦å¯¹ rdb æŒä¹…åŒ–è¿›è¡Œæ•°æ®æ ¡éªŒ</td></tr><tr><td>daemonize</td><td>æ˜¯å¦ä»¥åå°æ–¹å¼å¯åŠ¨ï¼Œå®¹å™¨å¯åŠ¨é€‰æ‹© no</td></tr><tr><td>protected-mode</td><td>å…³é—­ä¿æŠ¤æ¨¡å¼ï¼Œå…è®¸æ‰€æœ‰ IP è®¿é—®</td></tr><tr><td>requirepass</td><td>å¼€å¯è®¤è¯ï¼Œè®¾ç½®è®¤è¯å¯†ç </td></tr><tr><td>maxmemory</td><td>å…è®¸ä½¿ç”¨çš„æœ€å¤§å†…å­˜</td></tr><tr><td>maxmemory-policy</td><td>å†…å­˜åˆ°è¾¾æœ€å¤§å€¼æ—¶ï¼Œkey å›æ”¶çš„æœºåˆ¶</td></tr></tbody></table><h4 id="3ã€å¯åŠ¨å®¹å™¨"><a href="#3ã€å¯åŠ¨å®¹å™¨" class="headerlink" title="3ã€å¯åŠ¨å®¹å™¨"></a>3ã€å¯åŠ¨å®¹å™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shel">docker run -itd --name redis -p 6379:6379 -v /data/bk-cmdb/redis/conf/redis.conf:/etc/redis/redis.conf -v /data/bk-cmdb/redis/data:/data -v /data/bk-cmdb/redis/log:/tmp -v /etc/localtime:/etc/localtime --restart=always redis:3.2.11-alpine <br></code></pre></td></tr></table></figure><h3 id="4ã€éƒ¨ç½²-MongoDB"><a href="#4ã€éƒ¨ç½²-MongoDB" class="headerlink" title="4ã€éƒ¨ç½² MongoDB"></a>4ã€éƒ¨ç½² MongoDB</h3><h4 id="1ï¼‰ç¯å¢ƒå‡†å¤‡-2"><a href="#1ï¼‰ç¯å¢ƒå‡†å¤‡-2" class="headerlink" title="1ï¼‰ç¯å¢ƒå‡†å¤‡"></a>1ï¼‰ç¯å¢ƒå‡†å¤‡</h4><h5 id="1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-4-2-8-ç‰ˆæœ¬ï¼‰"><a href="#1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-4-2-8-ç‰ˆæœ¬ï¼‰" class="headerlink" title="1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è 4.2.8 ç‰ˆæœ¬ï¼‰"></a>1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è 4.2.8 ç‰ˆæœ¬ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull mongo:4.2.8<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•-2"><a href="#2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•-2" class="headerlink" title="2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•"></a>2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /data/bk-cmdb/mongodb/&#123;conf,data,log&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶-2"><a href="#2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶-2" class="headerlink" title="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶</h4><h5 id="1-æ–°å»ºé…ç½®æ–‡ä»¶-2"><a href="#1-æ–°å»ºé…ç½®æ–‡ä»¶-2" class="headerlink" title="1. æ–°å»ºé…ç½®æ–‡ä»¶"></a>1. æ–°å»ºé…ç½®æ–‡ä»¶</h5><p>æ–‡ä»¶è·¯å¾„: <code>/data/bk-cmdb/mongodb/conf/mongod.conf.orig</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">storage:</span><br>  <span class="hljs-attr">dbPath:</span> <span class="hljs-string">/data/db</span><br>  <span class="hljs-attr">journal:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment">#  engine:</span><br><span class="hljs-comment">#  mmapv1:</span><br><span class="hljs-comment">#  wiredTiger:</span><br><br><span class="hljs-comment"># where to write logging data.</span><br><span class="hljs-comment">#systemLog:</span><br><span class="hljs-comment">#  destination: file</span><br><span class="hljs-comment">#  logAppend: true</span><br><span class="hljs-comment">#  path: /var/log/mongodb/mongod.log</span><br><br><span class="hljs-comment"># network interfaces</span><br><span class="hljs-attr">net:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">27017</span><br><span class="hljs-comment">#å¼€å¯è¿œç¨‹è®¿é—®</span><br>  <span class="hljs-attr">bindIp:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br><br><br><span class="hljs-comment"># how the process runs</span><br><span class="hljs-attr">processManagement:</span><br>  <span class="hljs-attr">timeZoneInfo:</span> <span class="hljs-string">/usr/share/zoneinfo</span><br><br><span class="hljs-attr">setParameter:</span><br>   <span class="hljs-attr">enableLocalhostAuthBypass:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment">#security:</span><br><span class="hljs-comment">#  authorization: enable</span><br>  <br><span class="hljs-comment">#operationProfiling:</span><br><span class="hljs-comment">#å‰¯æœ¬é›†é…ç½®å†…å®¹ã€‚</span><br><span class="hljs-attr">replication:</span><br>  <span class="hljs-attr">replSetName:</span> <span class="hljs-string">es</span><br>  <span class="hljs-attr">oplogSizeMB:</span> <span class="hljs-number">10240</span><br></code></pre></td></tr></table></figure><h5 id="2-å‚æ•°è¯´æ˜-2"><a href="#2-å‚æ•°è¯´æ˜-2" class="headerlink" title="2. å‚æ•°è¯´æ˜"></a>2. å‚æ•°è¯´æ˜</h5><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>storage.dbPath</td><td>mongodbæ•°æ®æ–‡ä»¶ä¿å­˜è·¯å¾„</td></tr><tr><td>storage.journal.enabled</td><td>è®°å½•æ“ä½œæ—¥å¿—ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±</td></tr><tr><td>systemLog.destination</td><td>æ—¥å¿—è¾“å‡ºç›®æ ‡ï¼Œfile æˆ– syslog; ä¸é…ç½®åˆ™æ ‡å‡†è¾“å‡ºï¼ˆå®¹å™¨æ¨èï¼‰</td></tr><tr><td>net.port</td><td>ç›‘å¬ç«¯å£</td></tr><tr><td>net.bindIp</td><td>ç›‘å¬IPåœ°å€</td></tr><tr><td>processManagement.timeZoneInfo</td><td>æ—¶åŒºé…ç½®</td></tr><tr><td>security.authorization</td><td>å¼€å¯ auth è®¤è¯</td></tr><tr><td>replication.replSetName</td><td>å‰¯æœ¬é›†é…ç½®ï¼Œå‰¯æœ¬é›†åç§°</td></tr><tr><td>replication.oplogSizeMB</td><td>å‰¯æœ¬é›†é…ç½®ï¼ŒæŒ‡å®šoplogçš„æœ€å¤§å°ºå¯¸</td></tr><tr><td>enableLocalhostAuthBypass</td><td>é™åˆ¶ç¬¬ä¸€ä¸ªç”¨æˆ·ä¹Ÿå— auth è®¤è¯æ§åˆ¶</td></tr></tbody></table><h4 id="3ï¼‰å¯åŠ¨å®¹å™¨-1"><a href="#3ï¼‰å¯åŠ¨å®¹å™¨-1" class="headerlink" title="3ï¼‰å¯åŠ¨å®¹å™¨"></a>3ï¼‰å¯åŠ¨å®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --name mongodb -p 27017:27017 -e &quot;TZ=Asia/Shanghai&quot; -v /data/bk-cmdb/mongodb/conf/mongod.conf.orig:/etc/mongod.conf.orig -v /data/bk-cmdb/mongodb/data:/data/db -v /etc/localtime:/etc/localtime --restart=always mongo:4.2.8 --config /etc/mongod.conf.orig<br></code></pre></td></tr></table></figure><h3 id="5ã€é…ç½®æ•°æ®åº“"><a href="#5ã€é…ç½®æ•°æ®åº“" class="headerlink" title="5ã€é…ç½®æ•°æ®åº“"></a>5ã€é…ç½®æ•°æ®åº“</h3><h4 id="1ï¼‰åˆ›å»ºç®¡ç†ç”¨æˆ·"><a href="#1ï¼‰åˆ›å»ºç®¡ç†ç”¨æˆ·" class="headerlink" title="1ï¼‰åˆ›å»ºç®¡ç†ç”¨æˆ·"></a>1ï¼‰åˆ›å»ºç®¡ç†ç”¨æˆ·</h4><h5 id="1-è¿›å…¥å®¹å™¨"><a href="#1-è¿›å…¥å®¹å™¨" class="headerlink" title="1. è¿›å…¥å®¹å™¨"></a>1. è¿›å…¥å®¹å™¨</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -it mongodb /bin/bash<br></code></pre></td></tr></table></figure><h5 id="2-è¿æ¥-mongo"><a href="#2-è¿æ¥-mongo" class="headerlink" title="2. è¿æ¥ mongo"></a>2. è¿æ¥ mongo</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mongo<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826165034092.png" alt="image-20210826165034092"></p><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong> </p><p>åœ¨å¯åŠ¨ mongo å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬æ³¨é‡Šæ‰äº† auth è®¤è¯ï¼Œè¿™æ˜¯ä¸ºäº†åˆ›å»ºç®¡ç†ç”¨æˆ·ï¼Œå¦åˆ™æˆ‘ä»¬æ— æ³•è¿›è¡Œè®¤è¯ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µä¼šå¯¼è‡´é£é™©æŠ¥è­¦ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºå®Œç®¡ç†ç”¨æˆ·åï¼Œè¦å°†è®¤è¯é…ç½®æ‰“å¼€ã€‚</p></blockquote><h5 id="3-åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·"><a href="#3-åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·" class="headerlink" title="3. åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·"></a>3. åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨å¹¶è¿æ¥ mongo åï¼Œæ‰§è¡Œ</span><br>use admin<br>db.createUser(&#123;user:&#x27;admin&#x27;, pwd:&#x27;admin&#x27;, roles:[&#123;role:&#x27;root&#x27;,db:&#x27;admin&#x27;&#125;]&#125;)<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826165251592.png" alt="image-20210826165251592"></p><h5 id="4-æ‰“å¼€-auth-é…ç½®"><a href="#4-æ‰“å¼€-auth-é…ç½®" class="headerlink" title="4. æ‰“å¼€ auth é…ç½®"></a>4. æ‰“å¼€ auth é…ç½®</h5><p>æ–‡ä»¶è·¯å¾„: <code>/data/bk-cmdb/mongodb/conf/mongod.conf.orig</code>ï¼Œå–æ¶ˆ auth çš„æ³¨é‡Š:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ...</span><br><br>security:<br>  authorization: enabled<br><span class="hljs-meta">  </span><br><span class="hljs-meta">#</span><span class="bash"> ...</span><br></code></pre></td></tr></table></figure><h5 id="5-é‡å¯mongoå®¹å™¨"><a href="#5-é‡å¯mongoå®¹å™¨" class="headerlink" title="5. é‡å¯mongoå®¹å™¨"></a>5. é‡å¯mongoå®¹å™¨</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker restart mongodb<br></code></pre></td></tr></table></figure><h5 id="6-å†æ¬¡è¿›å…¥å®¹å™¨å¹¶è¿æ¥-mongoï¼Œå¹¶è®¤è¯"><a href="#6-å†æ¬¡è¿›å…¥å®¹å™¨å¹¶è¿æ¥-mongoï¼Œå¹¶è®¤è¯" class="headerlink" title="6. å†æ¬¡è¿›å…¥å®¹å™¨å¹¶è¿æ¥ mongoï¼Œå¹¶è®¤è¯"></a>6. å†æ¬¡è¿›å…¥å®¹å™¨å¹¶è¿æ¥ mongoï¼Œå¹¶è®¤è¯</h5><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826161721885.png" alt="image-20210826161721885"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">use admin<br>db.auth(&#x27;admin&#x27;,&#x27;admin&#x27;)<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826165917027.png" alt="image-20210826165917027"></p><h4 id="2ï¼‰é…ç½®-mongo-å‰¯æœ¬é›†"><a href="#2ï¼‰é…ç½®-mongo-å‰¯æœ¬é›†" class="headerlink" title="2ï¼‰é…ç½® mongo å‰¯æœ¬é›†"></a>2ï¼‰é…ç½® mongo å‰¯æœ¬é›†</h4><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>å¦‚æœ mongo æ˜¯ä»¥å‰¯æœ¬é›†çš„æ–¹å¼å¯åŠ¨çš„ï¼Œéœ€è¦å¯¹å‰¯æœ¬é›†è¿›è¡Œåˆå§‹åŒ–</p><p><code>replSetName</code> å³å‰¯æœ¬é›†çš„åç§° </p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨å¹¶è¿æ¥mongoï¼Œå¹¶è®¤è¯åæ‰§è¡Œ</span><br><span class="hljs-meta">#</span><span class="bash"> _id å³ä½¿ç”¨ replSetName, host ä¸ºå®ä¾‹çš„ IP:Port</span><br>rs.initiate(&#123; _id : &quot;es&quot;,members: [&#123; _id: 0, host: &quot;192.168.3.206:27017&quot; &#125;]&#125;)<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826171334054.png" alt="image-20210826171334054"></p><h4 id="3ï¼‰åˆ›å»º-cmdb-åº“å’Œç”¨æˆ·"><a href="#3ï¼‰åˆ›å»º-cmdb-åº“å’Œç”¨æˆ·" class="headerlink" title="3ï¼‰åˆ›å»º cmdb åº“å’Œç”¨æˆ·"></a>3ï¼‰åˆ›å»º cmdb åº“å’Œç”¨æˆ·</h4><h5 id="1-ä¸ä½¿ç”¨-es-åšå…¨æ–‡æ£€ç´¢"><a href="#1-ä¸ä½¿ç”¨-es-åšå…¨æ–‡æ£€ç´¢" class="headerlink" title="1. ä¸ä½¿ç”¨ es åšå…¨æ–‡æ£€ç´¢"></a>1. ä¸ä½¿ç”¨ es åšå…¨æ–‡æ£€ç´¢</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨å¹¶è¿æ¥mongoï¼Œå¹¶è®¤è¯åæ‰§è¡Œ</span><br>use cmdb<br>db.createUser(&#123;user: &quot;cc&quot;,pwd: &quot;cc&quot;,roles: [ &#123; role: &quot;readWrite&quot;, db: &quot;cmdb&quot; &#125; ]&#125;)<br></code></pre></td></tr></table></figure><h5 id="2-ä½¿ç”¨-mongo-monstache-es-åšå…¨æ–‡æ£€ç´¢ï¼ˆæœ¬æ–‡é€‰æ‹©ï¼‰"><a href="#2-ä½¿ç”¨-mongo-monstache-es-åšå…¨æ–‡æ£€ç´¢ï¼ˆæœ¬æ–‡é€‰æ‹©ï¼‰" class="headerlink" title="2. ä½¿ç”¨ mongo + monstache + es åšå…¨æ–‡æ£€ç´¢ï¼ˆæœ¬æ–‡é€‰æ‹©ï¼‰"></a>2. ä½¿ç”¨ mongo + monstache + es åšå…¨æ–‡æ£€ç´¢ï¼ˆæœ¬æ–‡é€‰æ‹©ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨å¹¶è¿æ¥mongoï¼Œå¹¶è®¤è¯åæ‰§è¡Œ</span><br>use cmdb<br>db.createUser(&#123;user: &quot;cc&quot;,pwd: &quot;cc&quot;,roles: [ &#123; role: &quot;readWrite&quot;, db: &quot;cmdb&quot; &#125;,&#123; role: &quot;readWrite&quot;, db: &quot;monstache&quot; &#125; ]&#125;)<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826170838042.png" alt="image-20210826170838042"></p><h3 id="6ã€éƒ¨ç½²-Elasticsearchï¼ˆå¯é€‰ï¼‰"><a href="#6ã€éƒ¨ç½²-Elasticsearchï¼ˆå¯é€‰ï¼‰" class="headerlink" title="6ã€éƒ¨ç½² Elasticsearchï¼ˆå¯é€‰ï¼‰"></a>6ã€éƒ¨ç½² Elasticsearchï¼ˆå¯é€‰ï¼‰</h3><h4 id="1ï¼‰ç¯å¢ƒå‡†å¤‡-3"><a href="#1ï¼‰ç¯å¢ƒå‡†å¤‡-3" class="headerlink" title="1ï¼‰ç¯å¢ƒå‡†å¤‡"></a>1ï¼‰ç¯å¢ƒå‡†å¤‡</h4><h5 id="1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-7-0-0-ç‰ˆæœ¬ï¼‰"><a href="#1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-7-0-0-ç‰ˆæœ¬ï¼‰" class="headerlink" title="1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è 7.0.0 ç‰ˆæœ¬ï¼‰"></a>1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è 7.0.0 ç‰ˆæœ¬ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull elasticsearch:7.0.0<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•-3"><a href="#2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•-3" class="headerlink" title="2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•"></a>2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /data/bk-cmdb/elasticsearch/&#123;conf,data,log,plugins&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶-3"><a href="#2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶-3" class="headerlink" title="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶</h4><h5 id="1-æ–°å»ºé…ç½®æ–‡ä»¶-3"><a href="#1-æ–°å»ºé…ç½®æ–‡ä»¶-3" class="headerlink" title="1. æ–°å»ºé…ç½®æ–‡ä»¶"></a>1. æ–°å»ºé…ç½®æ–‡ä»¶</h5><p>æ–‡ä»¶è·¯å¾„: <code>/data/bk-cmdb/elasticsearch/conf/elasticsearch.yml</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;network.host: 0.0.0.0&quot; &gt;&gt; /data/bk-cmdb/elasticsearch/conf/elasticsearch.yml<br></code></pre></td></tr></table></figure><h5 id="2-å‚æ•°è¯´æ˜-3"><a href="#2-å‚æ•°è¯´æ˜-3" class="headerlink" title="2. å‚æ•°è¯´æ˜"></a>2. å‚æ•°è¯´æ˜</h5><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>network.host</td><td>es ç›‘å¬ç«¯å£</td></tr></tbody></table><h4 id="3ï¼‰è¿è¡Œå®¹å™¨"><a href="#3ï¼‰è¿è¡Œå®¹å™¨" class="headerlink" title="3ï¼‰è¿è¡Œå®¹å™¨"></a>3ï¼‰è¿è¡Œå®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --name elasticsearch -p 9200:9200 -p 9300:9300  -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot; -v /data/bk-cmdb/elasticsearch/conf/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /data/bk-cmdb/elasticsearch/data:/usr/share/elasticsearch/data -v /data/bk-cmdb/elasticsearch/plugins:/usr/share/elasticsearch/plugins -v /etc/localtime:/etc/localtime  elasticsearch:7.0.0 <br></code></pre></td></tr></table></figure><h3 id="7ã€éƒ¨ç½²-Monstacheï¼ˆå¯é€‰ï¼‰"><a href="#7ã€éƒ¨ç½²-Monstacheï¼ˆå¯é€‰ï¼‰" class="headerlink" title="7ã€éƒ¨ç½² Monstacheï¼ˆå¯é€‰ï¼‰"></a>7ã€éƒ¨ç½² Monstacheï¼ˆå¯é€‰ï¼‰</h3><h4 id="1ï¼‰ç¯å¢ƒå‡†å¤‡-4"><a href="#1ï¼‰ç¯å¢ƒå‡†å¤‡-4" class="headerlink" title="1ï¼‰ç¯å¢ƒå‡†å¤‡"></a>1ï¼‰ç¯å¢ƒå‡†å¤‡</h4><h5 id="Monstache-Mongodb-Es-ç‰ˆæœ¬é€‰æ‹©"><a href="#Monstache-Mongodb-Es-ç‰ˆæœ¬é€‰æ‹©" class="headerlink" title="Monstache-Mongodb-Es ç‰ˆæœ¬é€‰æ‹©:"></a><strong>Monstache-Mongodb-Es ç‰ˆæœ¬é€‰æ‹©:</strong></h5><table><thead><tr><th>Monstache version</th><th>Git branch (used to build plugin)</th><th>Docker tag</th><th>Description</th><th>Elasticsearch</th><th>MongoDB</th></tr></thead><tbody><tr><td>3</td><td>rel3</td><td>rel3</td><td>mgo community go driver</td><td>Versions 2 and 5</td><td>Version 3</td></tr><tr><td>4</td><td>master</td><td>rel4 (note this used to be latest)</td><td>mgo community go driver</td><td>Version 6</td><td>Version 3</td></tr><tr><td>5</td><td>rel5</td><td>rel5</td><td>MongoDB, Inc. go driver</td><td>Version 6</td><td>Version 4</td></tr><tr><td>6</td><td>rel6</td><td>rel6, latest</td><td>MongoDB, Inc. go driver</td><td>Version 7</td><td>Version 4</td></tr></tbody></table><h5 id="1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-rel6-ç‰ˆæœ¬ï¼‰"><a href="#1-æ‹‰å–é•œåƒ-ï¼ˆå®˜æ–¹æ¨è-rel6-ç‰ˆæœ¬ï¼‰" class="headerlink" title="1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è rel6 ç‰ˆæœ¬ï¼‰"></a>1. æ‹‰å–é•œåƒ ï¼ˆå®˜æ–¹æ¨è rel6 ç‰ˆæœ¬ï¼‰</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull rwynn/monstache:rel6<br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•-4"><a href="#2-åˆ›å»ºæŒä¹…åŒ–ç›®å½•-4" class="headerlink" title="2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•"></a>2. åˆ›å»ºæŒä¹…åŒ–ç›®å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /data/bk-cmdb/monstache/&#123;conf,data,log&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶-4"><a href="#2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶-4" class="headerlink" title="2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>2ï¼‰ç¼–è¾‘é…ç½®æ–‡ä»¶</h4><h5 id="1-æ–°å»ºé…ç½®æ–‡ä»¶-4"><a href="#1-æ–°å»ºé…ç½®æ–‡ä»¶-4" class="headerlink" title="1. æ–°å»ºé…ç½®æ–‡ä»¶"></a>1. æ–°å»ºé…ç½®æ–‡ä»¶</h5><p>æ–‡ä»¶è·¯å¾„: <code>/data/bk-cmdb/monstache/conf/config.toml</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs toml"><span class="hljs-comment"># cmdb connection settings</span><br><br><span class="hljs-comment"># connect to MongoDB using the following URL</span><br><span class="hljs-attr">mongo-url</span> =  <span class="hljs-string">&quot;mongodb://cc:cc@192.168.3.206:27017/cmdb&quot;</span><br><span class="hljs-comment"># connect to the Elasticsearch REST API at the following node URLs</span><br><span class="hljs-attr">elasticsearch-urls</span> = [<span class="hljs-string">&quot;http://192.168.3.206:9200&quot;</span>]<br><br><span class="hljs-comment"># frequently required settings</span><br><br><span class="hljs-comment"># if you need to seed an index from a collection and not just listen and sync changes events</span><br><span class="hljs-comment"># you can copy entire collections or views from MongoDB to Elasticsearch</span><br><span class="hljs-attr">direct-read-namespaces</span> = [<span class="hljs-string">&quot;cmdb.cc_ApplicationBase&quot;</span>,<span class="hljs-string">&quot;cmdb.cc_HostBase&quot;</span>,<span class="hljs-string">&quot;cmdb.cc_ObjectBase&quot;</span>,<span class="hljs-string">&quot;cmdb.cc_ObjDes&quot;</span>]<br><br><span class="hljs-comment"># if you want to use MongoDB change streams instead of legacy oplog tailing use change-stream-namespaces</span><br><span class="hljs-comment"># change streams require at least MongoDB API 3.6+</span><br><span class="hljs-comment"># if you have MongoDB 4+ you can listen for changes to an entire database or entire deployment</span><br><span class="hljs-comment"># in this case you usually don&#x27;t need regexes in your config to filter collections unless you target the deployment.</span><br><span class="hljs-comment"># to listen to an entire db use only the database name.  For a deployment use an empty string.</span><br><span class="hljs-attr">change-stream-namespaces</span> = [<span class="hljs-string">&quot;cmdb.cc_ApplicationBase&quot;</span>,<span class="hljs-string">&quot;cmdb.cc_HostBase&quot;</span>,<span class="hljs-string">&quot;cmdb.cc_ObjectBase&quot;</span>,<span class="hljs-string">&quot;cmdb.cc_ObjDes&quot;</span>]<br><br><span class="hljs-comment"># additional settings</span><br><br><span class="hljs-comment"># compress requests to Elasticsearch</span><br><span class="hljs-attr">gzip</span> = <span class="hljs-literal">true</span><br><span class="hljs-comment"># use the following user name for Elasticsearch basic auth</span><br><span class="hljs-attr">elasticsearch-user</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment"># use the following password for Elasticsearch basic auth</span><br><span class="hljs-attr">elasticsearch-password</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment"># use 4 go routines concurrently pushing documents to Elasticsearch</span><br><span class="hljs-attr">elasticsearch-max-conns</span> = <span class="hljs-number">4</span> <br><span class="hljs-comment"># propagate dropped collections in MongoDB as index deletes in Elasticsearch</span><br><span class="hljs-attr">dropped-collections</span> = <span class="hljs-literal">true</span><br><span class="hljs-comment"># propagate dropped databases in MongoDB as index deletes in Elasticsearch</span><br><span class="hljs-attr">dropped-databases</span> = <span class="hljs-literal">true</span><br><span class="hljs-comment"># resume processing from a timestamp saved in a previous run</span><br><span class="hljs-attr">resume</span> = <span class="hljs-literal">true</span><br><span class="hljs-comment"># do not validate that progress timestamps have been saved</span><br><span class="hljs-attr">resume-write-unsafe</span> = <span class="hljs-literal">false</span><br><span class="hljs-comment"># override the name under which resume state is saved</span><br><span class="hljs-attr">resume-name</span> = <span class="hljs-string">&quot;default&quot;</span><br><span class="hljs-comment"># use a custom resume strategy (tokens) instead of the default strategy (timestamps)</span><br><span class="hljs-comment"># tokens work with MongoDB API 3.6+ while timestamps work only with MongoDB API 4.0+</span><br><span class="hljs-attr">resume-strategy</span> = <span class="hljs-number">0</span><br><span class="hljs-comment"># print detailed information including request traces</span><br><span class="hljs-attr">verbose</span> = <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># mapping settings</span><br><br><span class="hljs-section">[[mapping]]</span><br><span class="hljs-attr">namespace</span> = <span class="hljs-string">&quot;cmdb.cc_ApplicationBase&quot;</span><br><span class="hljs-attr">index</span> = <span class="hljs-string">&quot;cmdb.cc_applicationbase&quot;</span><br><br><span class="hljs-section">[[mapping]]</span><br><span class="hljs-attr">namespace</span> = <span class="hljs-string">&quot;cmdb.cc_HostBase&quot;</span><br><span class="hljs-attr">index</span> = <span class="hljs-string">&quot;cmdb.cc_hostbase&quot;</span><br><br><span class="hljs-section">[[mapping]]</span><br><span class="hljs-attr">namespace</span> = <span class="hljs-string">&quot;cmdb.cc_ObjectBase&quot;</span><br><span class="hljs-attr">index</span> = <span class="hljs-string">&quot;cmdb.cc_objectbase&quot;</span><br><br><span class="hljs-section">[[mapping]]</span><br><span class="hljs-attr">namespace</span> = <span class="hljs-string">&quot;cmdb.cc_ObjDes&quot;</span><br><span class="hljs-attr">index</span> = <span class="hljs-string">&quot;cmdb.cc_objdes&quot;</span><br></code></pre></td></tr></table></figure><h5 id="2-å‚æ•°è¯´æ˜-4"><a href="#2-å‚æ•°è¯´æ˜-4" class="headerlink" title="2. å‚æ•°è¯´æ˜"></a>2. å‚æ•°è¯´æ˜</h5><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>mongo-url</td><td>MongoDBå®ä¾‹çš„ä¸»èŠ‚ç‚¹è®¿é—®åœ°å€ã€‚è¯¦æƒ…è¯·å‚è§ã€‚<a href="https://rwynn.github.io/monstache-site/config/#mongo-url">mongo-url</a>ï¼Œå¼€å¯è®¤è¯åé…ç½®ä¸º <code>mongodb://user:password@host/dbname</code></td></tr><tr><td>elasticsearch-urls</td><td>Elasticsearchçš„è®¿é—®åœ°å€ã€‚è¯¦æƒ…è¯·å‚è§ <a href="https://rwynn.github.io/monstache-site/config/#elasticsearch-urls">elasticsearch-urls</a></td></tr><tr><td>direct-read-namespaces</td><td>æŒ‡å®šå¾…åŒæ­¥çš„é›†åˆï¼Œè¯¦æƒ…è¯·å‚è§<a href="https://rwynn.github.io/monstache-site/config/#direct-read-namespaces">direct-read-namespaces</a>ã€‚</td></tr><tr><td>change-stream-namespaces</td><td>å¦‚æœè¦ä½¿ç”¨MongoDBå˜æ›´æµåŠŸèƒ½ï¼Œéœ€è¦æŒ‡å®šæ­¤å‚æ•°ã€‚å¯ç”¨æ­¤å‚æ•°åï¼Œoplogè¿½è¸ªä¼šè¢«è®¾ç½®ä¸ºæ— æ•ˆï¼Œè¯¦æƒ…è¯·å‚è§<a href="https://rwynn.github.io/monstache-site/config/#change-stream-namespaces">change-stream-namespaces</a>ã€‚</td></tr><tr><td>namespace-regex</td><td>é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æŒ‡å®šéœ€è¦ç›‘å¬çš„é›†åˆã€‚æ­¤è®¾ç½®å¯ä»¥ç”¨æ¥ç›‘æ§ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„é›†åˆä¸­æ•°æ®çš„å˜åŒ–ã€‚</td></tr><tr><td>elasticsearch-user</td><td>è®¿é—®Elasticsearchçš„ç”¨æˆ·åã€‚</td></tr><tr><td>elasticsearch-password</td><td>è®¿é—®Elasticsearchçš„ç”¨æˆ·å¯†ç ã€‚</td></tr><tr><td>elasticsearch-max-conns</td><td>å®šä¹‰è¿æ¥ESçš„çº¿ç¨‹æ•°ã€‚é»˜è®¤ä¸º4ï¼Œå³ä½¿ç”¨4ä¸ªGoçº¿ç¨‹åŒæ—¶å°†æ•°æ®åŒæ­¥åˆ°ESã€‚</td></tr><tr><td>dropped-collections</td><td>é»˜è®¤ä¸ºtrueï¼Œè¡¨ç¤ºå½“åˆ é™¤MongoDBé›†åˆæ—¶ï¼Œä¼šåŒæ—¶åˆ é™¤ESä¸­å¯¹åº”çš„ç´¢å¼•ã€‚</td></tr><tr><td>dropped-databases</td><td>é»˜è®¤ä¸ºtrueï¼Œè¡¨ç¤ºå½“åˆ é™¤MongoDBæ•°æ®åº“æ—¶ï¼Œä¼šåŒæ—¶åˆ é™¤ESä¸­å¯¹åº”çš„ç´¢å¼•ã€‚</td></tr><tr><td>resume</td><td>é»˜è®¤ä¸ºfalseã€‚è®¾ç½®ä¸ºtrueï¼ŒMonstacheä¼šå°†å·²æˆåŠŸåŒæ­¥åˆ°ESçš„MongoDBæ“ä½œçš„æ—¶é—´æˆ³å†™å…¥monstache.monstacheé›†åˆä¸­ã€‚å½“Monstacheå› ä¸ºæ„å¤–åœæ­¢æ—¶ï¼Œå¯é€šè¿‡è¯¥æ—¶é—´æˆ³æ¢å¤åŒæ­¥ä»»åŠ¡ï¼Œé¿å…æ•°æ®ä¸¢å¤±ã€‚å¦‚æœæŒ‡å®šäº†cluster-nameï¼Œè¯¥å‚æ•°å°†è‡ªåŠ¨å¼€å¯ï¼Œè¯¦æƒ…è¯·å‚è§<a href="https://rwynn.github.io/monstache-site/config/#resume">resume</a>ã€‚</td></tr><tr><td>resume-strategy</td><td>æŒ‡å®šæ¢å¤ç­–ç•¥ã€‚ä»…å½“resumeä¸ºtrueæ—¶ç”Ÿæ•ˆï¼Œè¯¦æƒ…è¯·å‚è§<a href="https://rwynn.github.io/monstache-site/config/#resume-strategy">resume-strategy</a>ã€‚</td></tr><tr><td>verbose</td><td>é»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºä¸å¯ç”¨è°ƒè¯•æ—¥å¿—ã€‚</td></tr><tr><td>cluster-name</td><td>æŒ‡å®šé›†ç¾¤åç§°ã€‚æŒ‡å®šåï¼ŒMonstacheå°†è¿›å…¥é«˜å¯ç”¨æ¨¡å¼ï¼Œé›†ç¾¤åç§°ç›¸åŒçš„è¿›ç¨‹å°†è¿›è¡Œåè°ƒï¼Œè¯¦æƒ…è¯·å‚è§<a href="https://rwynn.github.io/monstache-site/config/#cluster-name">cluster-name</a>ã€‚</td></tr><tr><td>mapping</td><td>æŒ‡å®šESç´¢å¼•æ˜ å°„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®ä»MongoDBåŒæ­¥åˆ°ESæ—¶ï¼Œç´¢å¼•ä¼šè‡ªåŠ¨æ˜ å°„ä¸º<code>æ•°æ®åº“å.é›†åˆå</code>ã€‚å¦‚æœéœ€è¦ä¿®æ”¹ç´¢å¼•åç§°ï¼Œå¯é€šè¿‡è¯¥å‚æ•°è®¾ç½®ï¼Œè¯¦æƒ…è¯·å‚è§<a href="https://rwynn.github.io/monstache-site/advanced/#index-mapping">Index Mapping</a>ã€‚</td></tr></tbody></table><h4 id="3ï¼‰å¯åŠ¨å®¹å™¨-2"><a href="#3ï¼‰å¯åŠ¨å®¹å™¨-2" class="headerlink" title="3ï¼‰å¯åŠ¨å®¹å™¨"></a>3ï¼‰å¯åŠ¨å®¹å™¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -itd --name monstache -v /data/bk-cmdb/monstache/conf/config.toml:/app/monstache.config.toml -v /etc/localtime:/etc/localtime --restart=always rwynn/monstache:rel6 -f /app/monstache.config.toml<br></code></pre></td></tr></table></figure><h3 id="8ã€éƒ¨ç½²è“é²¸"><a href="#8ã€éƒ¨ç½²è“é²¸" class="headerlink" title="8ã€éƒ¨ç½²è“é²¸"></a>8ã€éƒ¨ç½²è“é²¸</h3><h4 id="1ï¼‰è§£å‹ç¼–è¯‘åçš„-cmdb-tar-gz"><a href="#1ï¼‰è§£å‹ç¼–è¯‘åçš„-cmdb-tar-gz" class="headerlink" title="1ï¼‰è§£å‹ç¼–è¯‘åçš„ cmdb.tar.gz"></a>1ï¼‰è§£å‹ç¼–è¯‘åçš„ <code>cmdb.tar.gz</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xf ~/go/src/configcenter/src/bin/pub/cmdb.tar.gz -C /data/softwares &amp;&amp; \<br>cd /data/softwares/cmdb<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆå§‹åŒ–é…ç½®"><a href="#2ï¼‰åˆå§‹åŒ–é…ç½®" class="headerlink" title="2ï¼‰åˆå§‹åŒ–é…ç½®"></a>2ï¼‰åˆå§‹åŒ–é…ç½®</h4><h5 id="1-åˆå§‹åŒ–"><a href="#1-åˆå§‹åŒ–" class="headerlink" title="1. åˆå§‹åŒ–"></a>1. åˆå§‹åŒ–</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">python init.py  \<br>      --discovery          192.168.3.206:2181 \<br>      --database           cmdb \<br>      --redis_ip           192.168.3.206 \<br>      --redis_port         6379 \<br>      --redis_pass         PassWord@123 \<br>      --mongo_ip           192.168.3.206 \<br>      --mongo_port         27017 \<br>      --mongo_user         cc \<br>      --mongo_pass         cc \<br>      --rs_name            es \<br>      --blueking_cmdb_url  http://bk-cmdb.example.com:80 \<br>      --listen_port        8083 \<br>      --auth_scheme        internal \<br>      --auth_enabled       false \<br>      --auth_sync_workers  1 \<br>      --auth_sync_interval_minutes  45 \<br>      --full_text_search   on \<br>      --es_url             http://192.168.3.206:9200 \<br>      --es_user            cc \<br>      --es_pass            cc \<br>      --log_level          3 \<br>      --register_ip        192.168.3.206 \<br>      --user_info          admin:admin<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826175509596.png" alt="image-20210826175509596"></p><p>ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210826175651688.png" alt="image-20210826175651688"></p><h5 id="2-init-py-å‚æ•°è¯¦è§£ï¼š"><a href="#2-init-py-å‚æ•°è¯¦è§£ï¼š" class="headerlink" title="2. init.py å‚æ•°è¯¦è§£ï¼š"></a>2. init.py å‚æ•°è¯¦è§£ï¼š</h5><table><thead><tr><th>å‚æ•°</th><th>ç”¨é€”è¯´æ˜</th><th>å¿…å¡«</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>â€“discovery</td><td>æœåŠ¡å‘ç°ç»„ä»¶ï¼ŒZooKeeper æœåŠ¡åœ°å€</td><td>æ˜¯</td><td>æ— </td></tr><tr><td>â€“database</td><td>æ•°æ®åº“åå­—</td><td>mongodb ä¸­æ•°æ®åº“å</td><td>å¦</td></tr><tr><td>â€“redis_ip</td><td>Redisç›‘å¬çš„IP</td><td>æ˜¯</td><td>æ— </td></tr><tr><td>â€“redis_port</td><td>Redisç›‘å¬çš„ç«¯å£</td><td>å¦</td><td>6379</td></tr><tr><td>â€“redis_pass</td><td>Redisç™»é™†å¯†ç </td><td>æ˜¯</td><td>æ— </td></tr><tr><td>â€“mongo_ip</td><td>MongoDBæœåŠ¡ç›‘å¬çš„IP</td><td>æ˜¯</td><td>æ— </td></tr><tr><td>â€“mongo_port</td><td>MongoDBç«¯å£</td><td>å¦</td><td>27017</td></tr><tr><td>â€“mongo_user</td><td>MongoDBä¸­CMDBæ•°æ®åº“ç”¨æˆ·å</td><td>æ˜¯</td><td>æ— </td></tr><tr><td>â€“mongo_pass</td><td>MongoDBä¸­CMDBæ•°æ®åº“ç”¨æˆ·åå¯†ç </td><td>æ˜¯</td><td>æ— </td></tr><tr><td>â€“blueking_cmdb_url</td><td>è¯¥å€¼è¡¨ç¤ºéƒ¨ç½²å®Œæˆå,è¾“å…¥åˆ°æµè§ˆå™¨ä¸­è®¿é—®çš„cmdb ç½‘å€, æ ¼å¼: <a href="http://xx.xxx.com/">http://xx.xxx.com:80</a>, ç”¨æˆ·è‡ªå®šä¹‰å¡«å†™;åœ¨æ²¡æœ‰é…ç½® DNS è§£æçš„æƒ…å†µä¸‹, å¡«å†™æœåŠ¡å™¨çš„ IP:PORTã€‚ç«¯å£ä¸ºå½“å‰cmdb_webserverç›‘å¬çš„ç«¯å£ã€‚</td><td>æ˜¯</td><td>æ— </td></tr><tr><td>â€“blueking_paas_url</td><td>è“é²¸PAAS å¹³å°çš„åœ°å€ï¼Œå¯¹äºç‹¬ç«‹éƒ¨ç½²çš„CCç‰ˆæœ¬å¯ä»¥ä¸é…ç½®</td><td>å¦</td><td>æ— </td></tr><tr><td>â€“listen_port</td><td>cmdb_webserveræœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯8083</td><td>æ˜¯</td><td>8083</td></tr><tr><td>â€“full_text_search</td><td>å…¨æ–‡æ£€ç´¢åŠŸèƒ½å¼€å…³(å–å€¼ï¼šoff/on)ï¼Œé»˜è®¤æ˜¯offï¼Œå¼€å¯æ˜¯on</td><td>å¦</td><td>off</td></tr><tr><td>â€“es_url</td><td>elasticsearchæœåŠ¡ç›‘å¬urlï¼Œé»˜è®¤æ˜¯<a href="http://192.168.3.206:9200/">http://192.168.3.206:9200</a></td><td>å¦</td><td><a href="http://192.168.3.206:9200/">http://192.168.3.206:9200</a></td></tr><tr><td>â€“auth_scheme</td><td>æƒé™æ¨¡å¼ï¼Œwebé¡µé¢ä½¿ç”¨ï¼Œå¯é€‰å€¼: internal, iam</td><td>å¦</td><td>internal</td></tr><tr><td>â€“auth_enabled</td><td>æ˜¯å¦é‡‡ç”¨è“é²¸æƒé™ä¸­å¿ƒé‰´æƒ</td><td>å¦</td><td>false</td></tr><tr><td>â€“auth_address</td><td>è“é²¸æƒé™ä¸­å¿ƒåœ°å€</td><td>auth_enabled ä¸ºçœŸæ—¶å¿…å¡«</td><td><a href="https://iam.domain.com/">https://iam.domain.com/</a></td></tr><tr><td>â€“auth_app_code</td><td>cmdbé¡¹ç›®åœ¨è“é²¸æƒé™ä¸­å¿ƒçš„åº”ç”¨ç¼–ç </td><td>auth_enabled ä¸ºçœŸæ—¶å¿…å¡«</td><td>bk_cmdb</td></tr><tr><td>â€“auth_app_secret</td><td>cmdbé¡¹ç›®åœ¨è“é²¸æƒé™ä¸­å¿ƒçš„åº”ç”¨å¯†é’¥</td><td>auth_enabled ä¸ºçœŸæ—¶å¿…å¡«</td><td>xxxxxxx</td></tr><tr><td>â€“log_level</td><td>æ—¥å¿—çº§åˆ«0-9, 9æ—¥å¿—æœ€è¯¦ç»†</td><td>å¦</td><td>3</td></tr><tr><td>â€“register_ip</td><td>è¿›ç¨‹æ³¨å†Œåˆ°zookeeperä¸Šçš„IPåœ°å€ï¼Œå¯ä»¥æ˜¯åŸŸå</td><td>å¦</td><td>æ— </td></tr><tr><td>â€“user_info</td><td>ç™»é™† web é¡µé¢çš„è´¦å·å¯†ç </td><td>å¦</td><td>æ— </td></tr></tbody></table><blockquote><p>ğŸš© init.py æ‰§è¡ŒæˆåŠŸåä¼šè‡ªåŠ¨ç”Ÿæˆcmdbå„æœåŠ¡è¿›ç¨‹æ‰€éœ€è¦çš„é…ç½®ã€‚</p></blockquote><h4 id="3ï¼‰å¯åŠ¨æœåŠ¡"><a href="#3ï¼‰å¯åŠ¨æœåŠ¡" class="headerlink" title="3ï¼‰å¯åŠ¨æœåŠ¡"></a>3ï¼‰å¯åŠ¨æœåŠ¡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /data/softwares/cmdb &amp;&amp; \<br>./start.sh<br></code></pre></td></tr></table></figure><h5 id="é—®é¢˜è®°å½•-adminserver-redis-è®¤è¯é—®é¢˜"><a href="#é—®é¢˜è®°å½•-adminserver-redis-è®¤è¯é—®é¢˜" class="headerlink" title="é—®é¢˜è®°å½•: adminserver redis è®¤è¯é—®é¢˜"></a>é—®é¢˜è®°å½•: adminserver redis è®¤è¯é—®é¢˜</h5><h6 id="é”™è¯¯ä¿¡æ¯-1"><a href="#é”™è¯¯ä¿¡æ¯-1" class="headerlink" title="é”™è¯¯ä¿¡æ¯:"></a>é”™è¯¯ä¿¡æ¯:</h6><p>å¯åŠ¨æœåŠ¡æ—¶ï¼Œéƒ¨åˆ†æœåŠ¡æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œç‰¹åˆ«æ˜¯ç®¡ç†é…ç½®çš„ adminserver</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210827130549678.png" alt="image-20210827130549678"></p><p>æŸ¥çœ‹æ—¥å¿—åï¼Œé—®é¢˜çš„åŸå› åœ¨äº redis çš„è®¤è¯ä¸Š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210827130612873.png" alt="image-20210827130612873"></p><h6 id="é—®é¢˜åŸå› -2"><a href="#é—®é¢˜åŸå› -2" class="headerlink" title="é—®é¢˜åŸå› :"></a>é—®é¢˜åŸå› :</h6><p>redis å¼€å¯è®¤è¯åï¼Œåœ¨å†…å­˜ä¸­å¹¶æ²¡æœ‰ç¡®å®çš„ç”Ÿæˆå¯¹åº”çš„keyï¼Œå¯¼è‡´ç¨‹åºåœ¨åŠ è½½é…ç½®æ—¶ï¼Œæ— æ³•æ­£ç¡®åŠ è½½è®¤è¯é…ç½®ï¼ˆç¨‹åºè¯»å–çš„æ˜¯æœ¬åœ° redis çš„ config ä¸­çš„ key <code>requirepass</code>ï¼‰</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210827130902618.png" alt="image-20210827130902618"></p><h6 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ:"></a>è§£å†³æ–¹æ¡ˆ:</h6><p>å› æ­¤åªè¦å°† key å¯¹åº”çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„å¯†ç ï¼‰ set åˆ° redis ä¸­ï¼Œå³å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">CONFIG SET requirepass myPassword<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰åˆå§‹åŒ–æ•°æ®åº“"><a href="#4ï¼‰åˆå§‹åŒ–æ•°æ®åº“" class="headerlink" title="4ï¼‰åˆå§‹åŒ–æ•°æ®åº“"></a>4ï¼‰åˆå§‹åŒ–æ•°æ®åº“</h4><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong>  <strong>æ­¤æ­¥éª¤å¿…éœ€è¦æ‰€æœ‰cmdbè¿›ç¨‹æˆåŠŸå¯åŠ¨åæ‰§è¡Œã€‚</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /data/softwares/cmdb &amp;&amp; \<br>./init_db.sh<br></code></pre></td></tr></table></figure><p>è¿”å›å€¼ä¸­è¿”å› <code>migrate_success</code>ï¼Œå³æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210827131349118.png" alt="image-20210827131349118"></p><h4 id="5ï¼‰åœæ­¢æœåŠ¡"><a href="#5ï¼‰åœæ­¢æœåŠ¡" class="headerlink" title="5ï¼‰åœæ­¢æœåŠ¡"></a>5ï¼‰åœæ­¢æœåŠ¡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /data/softwares/cmdb &amp;&amp; \<br>./stop.sh<br></code></pre></td></tr></table></figure><h2 id="å››ã€æ•ˆæœå±•ç¤º"><a href="#å››ã€æ•ˆæœå±•ç¤º" class="headerlink" title="å››ã€æ•ˆæœå±•ç¤º"></a>å››ã€æ•ˆæœå±•ç¤º</h2><p><strong>æ‰“å¼€æµè§ˆå™¨:</strong> è¾“å…¥ cmdb_webserver ç›‘å¬çš„åœ°å€ï¼Œå¦‚æœ¬æ–‡æ¡£ä¸­ç¤ºä¾‹æœåŠ¡ç›‘å¬çš„åœ°å€: <a href="http://bk-cmdb.example.com/">http://bk-cmdb.example.com</a></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210827141908936.png" alt="image-20210827141908936"></p>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CMDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å°†é…ç½®æ–‡ä»¶åå‘æŒä¹…åŒ–è‡³ Kubernetes Configmap è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2021/08/30/%E5%B0%86%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%8D%E5%90%91%E6%8C%81%E4%B9%85%E5%8C%96%E8%87%B3-Kubernetes-Configmap-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2021/08/30/%E5%B0%86%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%8D%E5%90%91%E6%8C%81%E4%B9%85%E5%8C%96%E8%87%B3-Kubernetes-Configmap-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="å°†é…ç½®æ–‡ä»¶åå‘æŒä¹…åŒ–è‡³-Kubernetes-Configmap-è§£å†³æ–¹æ¡ˆ"><a href="#å°†é…ç½®æ–‡ä»¶åå‘æŒä¹…åŒ–è‡³-Kubernetes-Configmap-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å°†é…ç½®æ–‡ä»¶åå‘æŒä¹…åŒ–è‡³ Kubernetes Configmap è§£å†³æ–¹æ¡ˆ"></a>å°†é…ç½®æ–‡ä»¶åå‘æŒä¹…åŒ–è‡³ Kubernetes Configmap è§£å†³æ–¹æ¡ˆ</h1><span id="more"></span><h2 id="ä¸€ã€èƒŒæ™¯ä»‹ç»"><a href="#ä¸€ã€èƒŒæ™¯ä»‹ç»" class="headerlink" title="ä¸€ã€èƒŒæ™¯ä»‹ç»"></a>ä¸€ã€èƒŒæ™¯ä»‹ç»</h2><p>è¿‘æœŸäº§çº¿ç¯å¢ƒå‘ç”Ÿçš„ä¸€èµ·ç¨‹åºå¯¼è‡´çš„ç¦»å¥‡é—®é¢˜ï¼Œç›¸åº”æ¨¡å—ç”± PHP å¼€å‘ï¼Œä½¿ç”¨ consul ä½œä¸ºé…ç®¡ä¸­å¿ƒï¼Œç»Ÿä¸€ç®¡ç†ä¸€äº›é€šç”¨æ€§é…ç½®ï¼Œå…¬å¸ç ”å‘è‡ªå·±é€ è½®å­äºŒå¼€çš„ swoole æ¡†æ¶ï¼Œä¼šä»¥å¾ªç¯çš„æ–¹å¼è¯»å– consul çš„å…¬å…±é…ç½®ï¼ˆä¸»è¦æ˜¯ä¸€äº›è¿æ¥æ•°æ®åº“ã€ä¸­é—´ä»¶ä¿¡æ¯çš„é…ç½®ï¼‰ï¼Œå¹¶ç»“åˆæœ¬åœ°æºç ä¸­çš„é…ç½®ä¿¡æ¯ç”Ÿæˆæœ€ç»ˆä½¿ç”¨ç‰ˆæœ¬çš„é…ç½®ï¼Œè®°å½•åœ¨ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¹¶æœ€ç»ˆåŠ è½½è‡³å†…å­˜ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­è®°å½•ç€å½“å‰æœåŠ¡è¿›ç¨‹å®é™…ä½¿ç”¨çš„é…ç½®ï¼Œæ˜¯å¦å­˜åœ¨é—®é¢˜ï¼Œä¸€å®šç¨‹åº¦ä¸Šæ˜¯å¯ä»¥ä»ä¸­äº†è§£åˆ°çš„ã€‚ä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œè¯¥æ–‡ä»¶ä»…ä¸ºä¸€ä¸´æ—¶æ–‡ä»¶å¹¶ä¸æ°¸ä¹…æ€§ä¿ç•™ï¼Œä¸”ç¨‹åºå¯åŠ¨è®¾å®šä¸ºä¸€æ—¦é‡å¯å°±ä¼šé‡æ–°æ‹‰å– consul çš„é…ç½®å¹¶ç”Ÿæˆæ–°çš„ä¸´æ—¶æ–‡ä»¶è¦†ç›–æ‰åŸæ¥çš„æ–‡ä»¶ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ç§å‡å°‘ä»£ç å‘å¸ƒï¼Œè®¨å·§å–æ‡’çš„æ–¹æ³•ï¼Œå› ä¸ºä¹‹å‰å¯¹å…¬å¸çš„ç‰ˆæœ¬å‘å¸ƒåšäº†è¾ƒä¸¥æ ¼çš„è§„èŒƒï¼Œä½†æ˜¯ä¹Ÿç®—æ˜¯ä¸€ç§é…ç½®ç®¡ç†æ–¹å¼ï¼Œå½“ç„¶ä¸ªäººæ¯”è¾ƒæ¨èå°†ä¸šåŠ¡ç›¸å…³é…ç½®ä½œä¸ºæ•°æ®åº“é…ç½®é¡¹ï¼Œè€Œéä»¥é…ç®¡è¿™ç±»å¹¶ç®—ä¸ä¸Šå®‰å…¨çš„æ–¹å¼è¿›è¡Œï¼‰ã€‚</p><p>å›å½’æ­£é¢˜ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œä¸´æ—¶æ–‡ä»¶è®°å½•è¿™æœåŠ¡è¿›ç¨‹å½“å‰å®é™…åœ¨ä½¿ç”¨çš„é…ç½®ä¿¡æ¯ï¼Œè¿™åœ¨æ’æŸ¥é—®é¢˜çš„æ—¶å€™æœ‰ä¸€å®šçš„å¸®åŠ©ï¼Œä½†æ˜¯ä¸´æ—¶æ–‡ä»¶åˆæ²¡æœ‰æŒä¹…åŒ–ï¼Œä¸€æ—¦é‡å¯å°±ä¼šè¢«è¦†ç›–ï¼ˆæ— è®ºæ˜¯è‡ªæ„ˆè¿˜æ˜¯å‘ç‰ˆï¼‰ï¼Œè¿™ä¹Ÿå¯¼è‡´å®é™…åœ¨ä½¿ç”¨çš„é…ç½®ä¿¡æ¯å¹¶ä¸å­˜åœ¨ç‰ˆæœ¬æ¦‚å¿µï¼Œé‚£ä¹ˆä¸€æ—¦å‡ºç°è¦è¿½æº¯ç‰ˆæœ¬çš„æƒ…å†µå°±åªèƒ½æŠ“çäº†ã€‚</p><p>å®é™…ä¸Šï¼Œç›®å‰äº§çº¿å‡ºç°çš„é—®é¢˜å°±æ˜¯å‡ºç°äº†è¿™æ ·çš„æƒ…å†µï¼Œå› æ­¤å‡ºäº SRE çš„éœ€æ±‚ï¼Œæå‡ºäº†æœ¬æ–¹æ¡ˆï¼Œå¯¹åç»­ç±»ä¼¼çš„é—®é¢˜ï¼Œå¯ä»¥èƒ½æœ‰ä¸€ä¸ªè¿½æº¯é—®é¢˜çš„æœºä¼šã€‚</p><h2 id="äºŒã€åŸå› è¿½æº¯"><a href="#äºŒã€åŸå› è¿½æº¯" class="headerlink" title="äºŒã€åŸå› è¿½æº¯"></a>äºŒã€åŸå› è¿½æº¯</h2><h3 id="1ã€é…ç½®è®°å½•"><a href="#1ã€é…ç½®è®°å½•" class="headerlink" title="1ã€é…ç½®è®°å½•"></a>1ã€é…ç½®è®°å½•</h3><h4 id="1ï¼‰consul-ä¸­å¯¹åº”çš„é¡¹ç›®é…ç½®"><a href="#1ï¼‰consul-ä¸­å¯¹åº”çš„é¡¹ç›®é…ç½®" class="headerlink" title="1ï¼‰consul ä¸­å¯¹åº”çš„é¡¹ç›®é…ç½®"></a>1ï¼‰consul ä¸­å¯¹åº”çš„é¡¹ç›®é…ç½®</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830104627124.png" alt="image-20210830104627124"></p><h4 id="2ï¼‰consul-ä¸­-redis-ç›¸å…³çš„é€šç”¨é…ç½®ï¼ˆPHPç”¨ï¼‰"><a href="#2ï¼‰consul-ä¸­-redis-ç›¸å…³çš„é€šç”¨é…ç½®ï¼ˆPHPç”¨ï¼‰" class="headerlink" title="2ï¼‰consul ä¸­ redis ç›¸å…³çš„é€šç”¨é…ç½®ï¼ˆPHPç”¨ï¼‰"></a>2ï¼‰consul ä¸­ redis ç›¸å…³çš„é€šç”¨é…ç½®ï¼ˆPHPç”¨ï¼‰</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830103827383.png" alt="image-20210830103827383"></p><h4 id="3ï¼‰é¡¹ç›®ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ä¸­-redis-ç›¸å…³é…ç½®ï¼ˆå®é™…ä½¿ç”¨ï¼‰"><a href="#3ï¼‰é¡¹ç›®ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ä¸­-redis-ç›¸å…³é…ç½®ï¼ˆå®é™…ä½¿ç”¨ï¼‰" class="headerlink" title="3ï¼‰é¡¹ç›®ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ä¸­ redis ç›¸å…³é…ç½®ï¼ˆå®é™…ä½¿ç”¨ï¼‰"></a>3ï¼‰é¡¹ç›®ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ä¸­ redis ç›¸å…³é…ç½®ï¼ˆå®é™…ä½¿ç”¨ï¼‰</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830103639172.png" alt="image-20210830103639172"></p><h3 id="2ã€é—®é¢˜è¯´æ˜"><a href="#2ã€é—®é¢˜è¯´æ˜" class="headerlink" title="2ã€é—®é¢˜è¯´æ˜"></a>2ã€é—®é¢˜è¯´æ˜</h3><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œå…¬å¸çš„ php é¡¹ç›®å®é™…åŠ è½½è¿›å†…å­˜çš„é…ç½®ï¼Œä¸ºç»“åˆå’Œ consul global é…ç½®å’Œæœ¬åœ°ä»£ç é…ç½®æ‰€ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶çš„é…ç½®ï¼Œä¸Šé¢æœ¬åœ°ä¸»è¦å‡ºç°é—®é¢˜çš„ redis çš„é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥æ˜æ˜¾å‘ç°åœ¨ json ç»“æ„ä½“ä¸­ï¼Œå®é™…ä¸Šå­˜åœ¨äº†2 ç§ redis çš„é…ç½®ï¼Œä¸€ä¸ªæ˜¯ <code>value</code> ä¸­ç›´æ¥ç”±æœ¬åœ°ä»£ç ç”Ÿæˆçš„ redis é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œé‡Œé¢è®¾ç½®äº† redis ç”¨ 14 åº“ï¼ˆ<code>&quot;index&quot;: 14</code>ï¼‰ï¼Œå¦‚ä¸‹:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"># ...<br><span class="hljs-string">&quot;auth&quot;</span>: xxx,<br><span class="hljs-string">&quot;host&quot;</span>: xxx,<br><span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">14</span>,<br><span class="hljs-string">&quot;lock&quot;</span>: &#123;<br>  <span class="hljs-attr">&quot;retryCount&quot;</span>: <span class="hljs-number">10</span>,<br>  <span class="hljs-attr">&quot;retryDelay&quot;</span>: <span class="hljs-number">1000</span><br>&#125;<br># ...<br></code></pre></td></tr></table></figure><p>å¦ä¸€ä¸ª redis çš„é…ç½®æ˜¯ <code>options</code> ä¸­è¯»å– consul global é…ç½®ç”Ÿæˆçš„é…ç½®ä¿¡æ¯ï¼Œå…¶ä¸­æ²¡æœ‰å®šä¹‰åˆ†ç‰‡ï¼Œé»˜è®¤å°±ä¼šä½¿ç”¨ 0 åº“ã€‚</p><p>æœ¬æ¬¡çš„é—®é¢˜ç‚¹å°±æ˜¯æŒ‡å®šäº† 14åº“ï¼Œä½†æ˜¯æ•°æ®è¢«å†™åˆ°äº† 0 åº“ï¼Œç”±äºæœåŠ¡å®é™…ä½¿ç”¨çš„é…ç½®æ–‡ä»¶æ˜¯é€šè¿‡è¿™ç§æ‹¼æ¥çš„æ–¹å¼å½¢æˆçš„ï¼Œæ˜¯å¦ä¼šå‘ç”Ÿè¦†ç›–æ•ˆæœä¸å¯è€ŒçŸ¥ï¼Œå¹¶ä¸”ç”±äºä¸´æ—¶æ–‡ä»¶æ²¡æœ‰è®°å½•ç‰ˆæœ¬ï¼Œå½“å‡ºç°é—®é¢˜æ—¶ï¼Œè¿æº¯æºçš„æ ¹æœ¬éƒ½æ²¡æœ‰ã€‚</p><h2 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h2><h3 id="1ã€åŸç†è®²è§£"><a href="#1ã€åŸç†è®²è§£" class="headerlink" title="1ã€åŸç†è®²è§£"></a>1ã€åŸç†è®²è§£</h3><p>å¯ä»¥çœ‹ä¹‹å‰çš„æ–‡ç« : <a href="https://tareya.github.io/2021/08/30/%E7%AC%AC1%E7%AB%A0%E3%80%81%E9%80%9A%E8%BF%87-http-%E8%B0%83%E7%94%A8-k8s-api/">é€šè¿‡ http è°ƒç”¨ k8s api</a>ï¼Œé‡Œé¢ç®€å•è¯´æ˜äº† K8S API çš„è®¿é—®æ§åˆ¶æœºåˆ¶å’Œ HTTP REST è®¿é—®æ–¹æ³•ï¼Œæ˜¯æœ€åŸºæœ¬çš„åŸç†ã€‚</p><p>å½“ç„¶æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ client-go è‡ªåˆ¶çš„æ’ä»¶åå‘åˆ›å»º configmap èµ„æºçš„æ–¹æ³•ï¼ŒåŸç†æ˜¯ç±»ä¼¼çš„ï¼Œä½†æ˜¯éœ€è¦å¯¹ client-go æœ‰ä¸€å®šçš„äº†è§£ï¼Œä¸‹æ–‡ä¼šç®€å•ä»‹ç»æ’ä»¶çš„å®ç°åŸºæœ¬åŸç†ã€‚</p><h3 id="2ã€æ–¹æ¡ˆå®æ–½"><a href="#2ã€æ–¹æ¡ˆå®æ–½" class="headerlink" title="2ã€æ–¹æ¡ˆå®æ–½"></a>2ã€æ–¹æ¡ˆå®æ–½</h3><h4 id="1ï¼‰åˆ›å»º-ServiceAccountï¼Œå¹¶è¿›è¡Œ-RBAC-æˆæƒ"><a href="#1ï¼‰åˆ›å»º-ServiceAccountï¼Œå¹¶è¿›è¡Œ-RBAC-æˆæƒ" class="headerlink" title="1ï¼‰åˆ›å»º ServiceAccountï¼Œå¹¶è¿›è¡Œ RBAC æˆæƒ"></a>1ï¼‰åˆ›å»º ServiceAccountï¼Œå¹¶è¿›è¡Œ RBAC æˆæƒ</h4><h5 id="1-æ–°å»º-rbac-å£°æ˜æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š"><a href="#1-æ–°å»º-rbac-å£°æ˜æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š" class="headerlink" title="1. æ–°å»º rbac å£°æ˜æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š"></a>1. æ–°å»º rbac å£°æ˜æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-clusterrole</span><br><span class="hljs-attr">rules:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;configmaps&quot;</span>, <span class="hljs-string">&quot;secrets&quot;</span>, <span class="hljs-string">&quot;nodes&quot;</span>, <span class="hljs-string">&quot;pods&quot;</span>, <span class="hljs-string">&quot;services&quot;</span>, <span class="hljs-string">&quot;resourcequotas&quot;</span>, <span class="hljs-string">&quot;replicationcontrollers&quot;</span>, <span class="hljs-string">&quot;limitranges&quot;</span>, <span class="hljs-string">&quot;persistentvolumeclaims&quot;</span>, <span class="hljs-string">&quot;persistentvolumes&quot;</span>, <span class="hljs-string">&quot;namespaces&quot;</span>, <span class="hljs-string">&quot;endpoints&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;extensions&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;daemonsets&quot;</span>, <span class="hljs-string">&quot;deployments&quot;</span>, <span class="hljs-string">&quot;replicasets&quot;</span>, <span class="hljs-string">&quot;ingresses&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;apps&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;statefulsets&quot;</span>, <span class="hljs-string">&quot;daemonsets&quot;</span>, <span class="hljs-string">&quot;deployments&quot;</span>, <span class="hljs-string">&quot;replicasets&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;batch&quot;</span>]<br>  <span class="hljs-attr">resources:</span> [<span class="hljs-string">&quot;cronjobs&quot;</span>, <span class="hljs-string">&quot;jobs&quot;</span>]<br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>, <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;patch&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-clusterrole-binding</span><br><span class="hljs-attr">subjects:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin-clusterrole</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br></code></pre></td></tr></table></figure><h5 id="2-åˆ›å»ºèµ„æº"><a href="#2-åˆ›å»ºèµ„æº" class="headerlink" title="2. åˆ›å»ºèµ„æº"></a>2. åˆ›å»ºèµ„æº</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl apply -f apiadmin-rbac.yaml<br></code></pre></td></tr></table></figure><h5 id="3-å®¡è®¡æƒé™"><a href="#3-å®¡è®¡æƒé™" class="headerlink" title="3. å®¡è®¡æƒé™"></a>3. å®¡è®¡æƒé™</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl auth can-i create configmaps --as=system:serviceaccount:default:apiadmin -n testing-app<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç®¡ç†-kubeconfig"><a href="#2ï¼‰ç®¡ç†-kubeconfig" class="headerlink" title="2ï¼‰ç®¡ç† kubeconfig"></a>2ï¼‰ç®¡ç† kubeconfig</h4><h5 id="1-åŸºç¡€æ–‡ä»¶è®²è§£"><a href="#1-åŸºç¡€æ–‡ä»¶è®²è§£" class="headerlink" title="1. åŸºç¡€æ–‡ä»¶è®²è§£"></a>1. åŸºç¡€æ–‡ä»¶è®²è§£</h5><p>æœ¬æ–‡ä½¿ç”¨çš„ k8s é›†ç¾¤ä¸ºäºŒè¿›åˆ¶åŒ…æ–¹å¼éƒ¨ç½²ï¼Œç›®å½•æœºæ„å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell">/data/application/kubernetes<br>â”œâ”€â”€ bin<br>â”‚Â Â  â”œâ”€â”€ kube-apiserver<br>â”‚Â Â  â”œâ”€â”€ kube-controller-manager<br>â”‚Â Â  â”œâ”€â”€ kubectl<br>â”‚Â Â  â”œâ”€â”€ kubelet<br>â”‚Â Â  â”œâ”€â”€ kube-proxy<br>â”‚Â Â  â””â”€â”€ kube-scheduler<br>â”œâ”€â”€ cfg<br>â”‚Â Â  â”œâ”€â”€ bootstrap.kubeconfig<br>â”‚Â Â  â”œâ”€â”€ kube-apiserver.conf<br>â”‚Â Â  â”œâ”€â”€ kube-controller-manager.conf<br>â”‚Â Â  â”œâ”€â”€ kubelet.conf<br>â”‚Â Â  â”œâ”€â”€ kubelet-config.yml<br>â”‚Â Â  â”œâ”€â”€ kubelet.kubeconfig<br>â”‚Â Â  â”œâ”€â”€ kube-proxy.conf<br>â”‚Â Â  â”œâ”€â”€ kube-proxy-config.yml<br>â”‚Â Â  â”œâ”€â”€ kube-proxy.kubeconfig<br>â”‚Â Â  â”œâ”€â”€ kube-scheduler.conf<br>â”‚Â Â  â””â”€â”€ token.csv<br>â”œâ”€â”€ logs<br>â””â”€â”€ ssl<br>    â”œâ”€â”€ ca-key.pem<br>    â”œâ”€â”€ ca.pem<br>    â”œâ”€â”€ kubelet-client-2021-07-20-21-52-21.pem<br>    â”œâ”€â”€ kubelet-client-current.pem -&gt; /data/application/kubernetes/ssl/kubelet-client-2021-07-20-21-52-21.pem<br>    â”œâ”€â”€ kubelet-server-2021-07-20-21-53-06.pem<br>    â”œâ”€â”€ kubelet-server-current.pem -&gt; /data/application/kubernetes/ssl/kubelet-server-2021-07-20-21-53-06.pem<br>    â”œâ”€â”€ kube-proxy-key.pem<br>    â”œâ”€â”€ kube-proxy.pem<br>    â”œâ”€â”€ metrics-server-key.pem<br>    â”œâ”€â”€ metrics-server.pem<br>    â”œâ”€â”€ server-key.pem<br>    â””â”€â”€ server.pem<br><br></code></pre></td></tr></table></figure><p>æœ¬é›†ç¾¤æ˜¯é‡‡ç”¨ bootstrap æ–¹å¼ç®¡ç†ï¼Œbootstrap.kubeconfig å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority:</span> <span class="hljs-string">/data/application/kubernetes/ssl/ca.pem</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://172.16.84.140:6443</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes</span><br><span class="hljs-attr">contexts:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">context:</span><br>    <span class="hljs-attr">cluster:</span> <span class="hljs-string">kubernetes</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">kubelet-bootstrap</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">current-context:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span><br><span class="hljs-attr">preferences:</span> &#123;&#125;<br><span class="hljs-attr">users:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">kubelet-bootstrap</span><br>  <span class="hljs-attr">user:</span><br>    <span class="hljs-attr">token:</span> <span class="hljs-string">c47ffb939f5ca36231d9e3121a252940</span><br></code></pre></td></tr></table></figure><blockquote><p>ğŸš© <strong>å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ kubeconfig çš„æ¨¡æ¿ï¼Œclusterã€contextã€userçš„ä¿¡æ¯éƒ½æœ‰äº†ï¼Œä½†æ˜¯ä»–æ˜¯é€šè¿‡ ca è¯ä¹¦æ–‡ä»¶è¿›è¡Œè®¤è¯çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ’ä»¶æ˜¯è¿è¡Œåœ¨å®¹å™¨å†…çš„ï¼Œå½“ç„¶ä¸å¯èƒ½æœ‰ ca æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦ç”¨è§£ç å‡ºçš„ <code>certificate-authority-data</code> çš„æ–¹å¼æ¥è¿›è¡Œè®¤è¯ã€‚</strong></p></blockquote><h5 id="2-ç”Ÿæˆ-kubeconfig-åŸºç¡€é€šä¿¡ä¿¡æ¯"><a href="#2-ç”Ÿæˆ-kubeconfig-åŸºç¡€é€šä¿¡ä¿¡æ¯" class="headerlink" title="2. ç”Ÿæˆ kubeconfig åŸºç¡€é€šä¿¡ä¿¡æ¯"></a>2. ç”Ÿæˆ kubeconfig åŸºç¡€é€šä¿¡ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl config set-cluster kubernetes --certificate-authority=/data/application/kubernetes/ssl/ca.pem --embed-certs=true --server=https://$&#123;MASTER_IP&#125;:6443<br></code></pre></td></tr></table></figure><p>ç”Ÿäº§æ–‡ä»¶è·¯å¾„: <code>~/.kube/config</code>ï¼Œæ–‡ä»¶å†…å®¹ç±»ä¼¼ä¸‹é¢çš„å½¢å¼:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority-data:</span> <span class="hljs-string">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR2akNDQXFhZ0F3SUJBZ0lVSXpFZW1aNVFwMG5ZT3h3LzdlVG02ckcwdG5vd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1pURUxNQWtHQTFVRUJoTUNRMDR4RURBT0JnTlZCQWdUQjBKbGFXcHBibWN4RURBT0JnTlZCQWNUQjBKbAphV3BwYm1jeEREQUtCZ05WQkFvVEEyczRjekVQTUEwR0ExVUVDeE1HVTNsemRHVnRNUk13RVFZRFZRUURFd3ByCmRXSmxjbTVsZEdWek1CNFhEVEl3TURRd016QTNNemt3TUZvWERUSTFNRFF3TWpBM016a3dNRm93WlRFTE1Ba0cKQTFVRUJoTUNRMDR4RURBT0JnTlZCQWdUQjBKbGFXcHBibWN4RURBT0JnTlZCQWNUQjBKbGFXcHBibWN4RERBSwpCZ05WQkFvVEEyczRjekVQTUEwR0ExVUVDeE1HVTNsemRHVnRNUk13RVFZRFZRUURFd3ByZFdKbGNtNWxkR1Z6Ck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdVZBcDZ2NWVFOGZHTTZ3SEtheTgKZFJZZnp5NVdRZjlnczlqZ3JxMjBCUkxDNTlUclJaWjlaNGRhb1RJRWtISityZDRGTENDaTVnNXNudklTeU1NTQpENW15M3RLZElQM3l4dWx1Y3hnS1RlSXdWdXFXa3Rlc0hoWWo5blBtWmM4dDJMNUlqYjhaVVU5dlJHbEpmNmhjCkRPR1VjaWwvOUhNaEtXN3ZGeEhPQit4TUtBeDloaDNkT1dmTFFYTE9mcitEbm51M0ZyQzJXRUpOQm8xNjA3a2wKMEJncUZCaEQzdUlqQnlZNG5HYWFJazBSaHgycmRWaEhXY0NualNndExia05tWDV4VThPWXVFSjVlckl1VzA1agprMUYyeXlIOGVFc3U4OXhHTzZPZVVybHNndWJjNWZHQkN0S0U3TGE1TEQ1bnFPeGNJUWFPeVd0UlBUaFFsOEMyCndRSURBUUFCbzJZd1pEQU9CZ05WSFE4QkFmOEVCQU1DQVFZd0VnWURWUjBUQVFIL0JBZ3dCZ0VCL3dJQkFqQWQKQmdOVkhRNEVGZ1FVK0krZHlXU014TU5mbzlrYzVHODFUb0JEcWF3d0h3WURWUjBqQkJnd0ZvQVUrSStkeVdTTQp4TU5mbzlrYzVHODFUb0JEcWF3d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFIYXBsdFhEVHJBVHJhR2FyU2xvCnJzT3dybUtzN3l5elkyNDFHc0RETFM3Vldhc3VSY3VYUGpaaUcxN2kxb3kyRHBnNzJNWXRGS0lMVmtmTjhBVmkKZ21WclY4ZkRlUjE3eldGMHM2YXRLUGVNRDg2OE1ISWhHdUNjbVJYVk0rSFBUNzBYTkl4REpmMk9NdEQ5ZGRIVApIMlVIQkhQTUJhaVpOa2VjOUNjV1hZQlVLYUJHL3Nab1dILzhWSktKK3JNT1Y3NjFObzkxa2VRQnNWalFtQ211CkI3UUJJYlFFaWUzUGdTazlYR3RWV2ZxVmVYSHM1ck5DZGJsSzdkT08zTXZxcTRtMTBDbDlZd2lUZjZ0cFlreFcKS2l2WjZ0ZkJqR2g5aFRIZ09ka3pTcitHKzF1azFJSDRlNWVGZForYVVVRkFpSVEzU2dzZ2x6S2VkckkrMFloZApZcnM9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://172.16.84.140:6443</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes</span><br><span class="hljs-attr">contexts:</span> []<br><span class="hljs-attr">current-context:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span><br><span class="hljs-attr">preferences:</span> &#123;&#125;<br><span class="hljs-attr">users:</span> []<br></code></pre></td></tr></table></figure><blockquote><p>æ¥ä¸‹æ¥ï¼Œä½œä¸ºä¸€ä¸ª kubeconfig æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ <code>context</code>  å’Œ <code>user</code> çš„ä¿¡æ¯æ‰èƒ½å®ç°ç®¡ç†åŠŸèƒ½</p></blockquote><h5 id="3-ç¼–å†™-kubeconfig"><a href="#3-ç¼–å†™-kubeconfig" class="headerlink" title="3. ç¼–å†™ kubeconfig"></a>3. ç¼–å†™ kubeconfig</h5><p>ä¿®æ”¹æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ <code>~/.kube/config</code>ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹: </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">clusters:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">cluster:</span><br>    <span class="hljs-attr">certificate-authority-data:</span> <span class="hljs-string">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR2akNDQXFhZ0F3SUJBZ0lVSXpFZW1aNVFwMG5ZT3h3LzdlVG02ckcwdG5vd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1pURUxNQWtHQTFVRUJoTUNRMDR4RURBT0JnTlZCQWdUQjBKbGFXcHBibWN4RURBT0JnTlZCQWNUQjBKbAphV3BwYm1jeEREQUtCZ05WQkFvVEEyczRjekVQTUEwR0ExVUVDeE1HVTNsemRHVnRNUk13RVFZRFZRUURFd3ByCmRXSmxjbTVsZEdWek1CNFhEVEl3TURRd016QTNNemt3TUZvWERUSTFNRFF3TWpBM016a3dNRm93WlRFTE1Ba0cKQTFVRUJoTUNRMDR4RURBT0JnTlZCQWdUQjBKbGFXcHBibWN4RURBT0JnTlZCQWNUQjBKbGFXcHBibWN4RERBSwpCZ05WQkFvVEEyczRjekVQTUEwR0ExVUVDeE1HVTNsemRHVnRNUk13RVFZRFZRUURFd3ByZFdKbGNtNWxkR1Z6Ck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdVZBcDZ2NWVFOGZHTTZ3SEtheTgKZFJZZnp5NVdRZjlnczlqZ3JxMjBCUkxDNTlUclJaWjlaNGRhb1RJRWtISityZDRGTENDaTVnNXNudklTeU1NTQpENW15M3RLZElQM3l4dWx1Y3hnS1RlSXdWdXFXa3Rlc0hoWWo5blBtWmM4dDJMNUlqYjhaVVU5dlJHbEpmNmhjCkRPR1VjaWwvOUhNaEtXN3ZGeEhPQit4TUtBeDloaDNkT1dmTFFYTE9mcitEbm51M0ZyQzJXRUpOQm8xNjA3a2wKMEJncUZCaEQzdUlqQnlZNG5HYWFJazBSaHgycmRWaEhXY0NualNndExia05tWDV4VThPWXVFSjVlckl1VzA1agprMUYyeXlIOGVFc3U4OXhHTzZPZVVybHNndWJjNWZHQkN0S0U3TGE1TEQ1bnFPeGNJUWFPeVd0UlBUaFFsOEMyCndRSURBUUFCbzJZd1pEQU9CZ05WSFE4QkFmOEVCQU1DQVFZd0VnWURWUjBUQVFIL0JBZ3dCZ0VCL3dJQkFqQWQKQmdOVkhRNEVGZ1FVK0krZHlXU014TU5mbzlrYzVHODFUb0JEcWF3d0h3WURWUjBqQkJnd0ZvQVUrSStkeVdTTQp4TU5mbzlrYzVHODFUb0JEcWF3d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFIYXBsdFhEVHJBVHJhR2FyU2xvCnJzT3dybUtzN3l5elkyNDFHc0RETFM3Vldhc3VSY3VYUGpaaUcxN2kxb3kyRHBnNzJNWXRGS0lMVmtmTjhBVmkKZ21WclY4ZkRlUjE3eldGMHM2YXRLUGVNRDg2OE1ISWhHdUNjbVJYVk0rSFBUNzBYTkl4REpmMk9NdEQ5ZGRIVApIMlVIQkhQTUJhaVpOa2VjOUNjV1hZQlVLYUJHL3Nab1dILzhWSktKK3JNT1Y3NjFObzkxa2VRQnNWalFtQ211CkI3UUJJYlFFaWUzUGdTazlYR3RWV2ZxVmVYSHM1ck5DZGJsSzdkT08zTXZxcTRtMTBDbDlZd2lUZjZ0cFlreFcKS2l2WjZ0ZkJqR2g5aFRIZ09ka3pTcitHKzF1azFJSDRlNWVGZForYVVVRkFpSVEzU2dzZ2x6S2VkckkrMFloZApZcnM9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><br>    <span class="hljs-attr">server:</span> <span class="hljs-string">https://172.16.84.140:6443</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes</span><br><span class="hljs-attr">contexts:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">context:</span><br>    <span class="hljs-attr">cluster:</span> <span class="hljs-string">kubernetes</span><br>    <span class="hljs-attr">user:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">current-context:</span> <span class="hljs-string">default</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Config</span><br><span class="hljs-attr">preferences:</span> &#123;&#125;<br><span class="hljs-attr">users:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">apiadmin</span><br>  <span class="hljs-attr">user:</span><br>    <span class="hljs-attr">token:</span> <span class="hljs-string">$&#123;TOKEN&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>ğŸŒˆ è¿™é‡Œæˆ‘ä»¬ç”¨æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ ServiceAccount ä½œä¸ºè®¤è¯å¯¹è±¡ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ user æˆ–è€… group çš„æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚æ›´æ”¹ï¼‰</p><p>è®¤è¯å¯¹è±¡çš„è®¤è¯å‡­è¯æˆ‘ä»¬é‡‡ç”¨ä¹‹å‰ rbac æˆæƒç”Ÿæˆçš„ token çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ kubectl è½¬æ¢è·å¾—ï¼Œè·å–æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">SECRET=$(kubectl get serviceaccount apiadmin -ojsonpath=&#x27;&#123;.secrets[0].name&#125;&#x27;)<br>TOKEN=$(kubectl get secret $&#123;SECRET&#125; -ojsonpath=&#x27;&#123;.data.token&#125;&#x27;|base64 -d)<br></code></pre></td></tr></table></figure><p>å½“ç„¶åœ¨é›†ç¾¤å¤–ä¹Ÿå¯ä»¥é‡‡ç”¨ kubelet client çš„ crt å’Œ key æ–‡ä»¶è¿›è¡Œè®¤è¯ï¼Œå½¢å¼å°±ä¼šå˜æˆç±»ä¼¼ä¸‹é¢è¿™æ ·çš„å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">users:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">minikube</span><br>  <span class="hljs-attr">user:</span><br>    <span class="hljs-attr">client-certificate:</span> <span class="hljs-string">/Users/shenlei/.minikube/profiles/minikube/client.crt</span><br>    <span class="hljs-attr">client-key:</span> <span class="hljs-string">/Users/shenlei/.minikube/profiles/minikube/client.key</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥å°†å¯¹åº”çš„æ–‡ä»¶è¿›è¡Œå¦‚ä¸Šè¿° ca æ–‡ä»¶é‚£æ ·çš„è½¬ç ï¼Œä½¿ç”¨ <code>client-certificate-data</code> å’Œ <code>client-key-data</code>çš„æ–¹å¼ï¼Œä½†æ˜¯è¿˜æ˜¯å»ºè®®ä½¿ç”¨ rbac æˆæƒçš„æ–¹å¼ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ç²¾å‡†çš„æˆæƒèµ„æºï¼Œè€Œä¸ä¼šå¯¼è‡´æƒé™è¿‡å‰©ã€‚</p></blockquote><h4 id="3ï¼‰client-go-è¯»å–-kubeconfig"><a href="#3ï¼‰client-go-è¯»å–-kubeconfig" class="headerlink" title="3ï¼‰client-go è¯»å– kubeconfig"></a>3ï¼‰client-go è¯»å– kubeconfig</h4><h5 id="ä»£ç ç¤ºä¾‹ï¼š"><a href="#ä»£ç ç¤ºä¾‹ï¼š" class="headerlink" title="ä»£ç ç¤ºä¾‹ï¼š"></a>ä»£ç ç¤ºä¾‹ï¼š</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// load the kubeconfig file</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadConfig</span><span class="hljs-params">()</span> *<span class="hljs-title">rest</span>.<span class="hljs-title">Config</span></span> &#123;<br><br>config, err := clientcmd.BuildConfigFromFlags(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;./config&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>  <span class="hljs-keyword">return</span> config<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰åˆ›å»º-clientset"><a href="#4ï¼‰åˆ›å»º-clientset" class="headerlink" title="4ï¼‰åˆ›å»º clientset"></a>4ï¼‰åˆ›å»º clientset</h4><h5 id="ä»£ç ç¤ºä¾‹ï¼š-1"><a href="#ä»£ç ç¤ºä¾‹ï¼š-1" class="headerlink" title="ä»£ç ç¤ºä¾‹ï¼š"></a>ä»£ç ç¤ºä¾‹ï¼š</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// init the rest client</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitClient</span><span class="hljs-params">()</span> *<span class="hljs-title">kubernetes</span>.<span class="hljs-title">Clientset</span></span> &#123;<br><span class="hljs-comment">// create a kubeconfig instance</span><br>c := LoadConfig()<br><br><span class="hljs-comment">// init the rest client</span><br>clientset, err := kubernetes.NewForConfig(c)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-keyword">return</span> clientset<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5ï¼‰è¯»å–æ–‡ä»¶è½¬æ¢-configmap-çš„æ•°æ®ç»“æ„"><a href="#5ï¼‰è¯»å–æ–‡ä»¶è½¬æ¢-configmap-çš„æ•°æ®ç»“æ„" class="headerlink" title="5ï¼‰è¯»å–æ–‡ä»¶è½¬æ¢ configmap çš„æ•°æ®ç»“æ„"></a>5ï¼‰è¯»å–æ–‡ä»¶è½¬æ¢ configmap çš„æ•°æ®ç»“æ„</h4><h5 id="ä»£ç ç¤ºä¾‹ï¼š-2"><a href="#ä»£ç ç¤ºä¾‹ï¼š-2" class="headerlink" title="ä»£ç ç¤ºä¾‹ï¼š"></a>ä»£ç ç¤ºä¾‹ï¼š</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// generate the configmap struct body</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ConfigmapGenerate</span><span class="hljs-params">(namespace <span class="hljs-keyword">string</span>, name <span class="hljs-keyword">string</span>, filepath <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">corev1</span>.<span class="hljs-title">ConfigMap</span></span> &#123;<br><br><span class="hljs-comment">// define the configmap necessary metadata</span><br><span class="hljs-keyword">type</span> ConfigMap <span class="hljs-keyword">struct</span> &#123;<br>Metadata <span class="hljs-keyword">interface</span>&#123;&#125;<br>Data     <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span><br>&#125; <span class="hljs-comment">// *corev1.ConfigMap</span><br><br><span class="hljs-keyword">type</span> ObjectMeta <span class="hljs-keyword">struct</span> &#123;<br>Name      <span class="hljs-keyword">string</span><br>Namespace <span class="hljs-keyword">string</span><br>&#125; <span class="hljs-comment">// *metav1.ObjectMeta</span><br><br><span class="hljs-comment">// read the tmp json config file</span><br>f, e := ioutil.ReadFile(filepath)<br><span class="hljs-keyword">if</span> e != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(e)<br>&#125;<br><br>jsonStr := <span class="hljs-keyword">string</span>(f)<br><br><span class="hljs-comment">// convert the json string to map</span><br>m := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>)<br>m[<span class="hljs-string">&quot;config.json&quot;</span>] = jsonStr<br><br>metadata := ObjectMeta&#123;<br>Name:      name,<br>Namespace: namespace,<br>&#125;<br><br><span class="hljs-comment">// generate the k8s configmap data</span><br>result := &amp;corev1.ConfigMap&#123;<br>ObjectMeta: metav1.ObjectMeta&#123;<br>Name:      metadata.Name,<br>Namespace: metadata.Namespace,<br>&#125;,<br>Data: m,<br>&#125;<br><br><span class="hljs-keyword">return</span> result<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6ï¼‰åˆ›å»º-configmap-å¯¹è±¡"><a href="#6ï¼‰åˆ›å»º-configmap-å¯¹è±¡" class="headerlink" title="6ï¼‰åˆ›å»º configmap å¯¹è±¡"></a>6ï¼‰åˆ›å»º configmap å¯¹è±¡</h4><h5 id="ä»£ç ç¤ºä¾‹ï¼š-3"><a href="#ä»£ç ç¤ºä¾‹ï¼š-3" class="headerlink" title="ä»£ç ç¤ºä¾‹ï¼š"></a>ä»£ç ç¤ºä¾‹ï¼š</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// create the configmap</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ConfigmapCreate</span><span class="hljs-params">(namespace <span class="hljs-keyword">string</span>, c *corev1.ConfigMap)</span> *<span class="hljs-title">corev1</span>.<span class="hljs-title">ConfigMap</span></span> &#123;<br><span class="hljs-comment">// init the clientset instance</span><br>client := InitClient()<br><br><span class="hljs-comment">// define the api interface</span><br>api := client.CoreV1()<br>opts := metav1.CreateOptions&#123;&#125;<br><br><span class="hljs-comment">// create configmap operation</span><br>configmapCreate, err := api.ConfigMaps(namespace).Create(context.TODO(), c, opts)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-keyword">return</span> configmapCreate<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é—®é¢˜è§£å†³æ–¹æ¡ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬2ç« ã€é¡¹ç›®ç®¡ç†åŸºç¡€</title>
    <link href="/2021/08/27/%E7%AC%AC2%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80/"/>
    <url>/2021/08/27/%E7%AC%AC2%E7%AB%A0%E3%80%81%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2ç« ã€é¡¹ç›®ç®¡ç†åŸºç¡€"><a href="#ç¬¬2ç« ã€é¡¹ç›®ç®¡ç†åŸºç¡€" class="headerlink" title="ç¬¬2ç« ã€é¡¹ç›®ç®¡ç†åŸºç¡€"></a>ç¬¬2ç« ã€é¡¹ç›®ç®¡ç†åŸºç¡€</h1><span id="more"></span><h2 id="ä¸€ã€é¡¹ç›®ç®¡ç†åŸºç¡€ç†è®º"><a href="#ä¸€ã€é¡¹ç›®ç®¡ç†åŸºç¡€ç†è®º" class="headerlink" title="ä¸€ã€é¡¹ç›®ç®¡ç†åŸºç¡€ç†è®º"></a>ä¸€ã€é¡¹ç›®ç®¡ç†åŸºç¡€ç†è®º</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯é¡¹ç›®ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯é¡¹ç›®ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯é¡¹ç›®ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯é¡¹ç›®ï¼Ÿ</h3><h4 id="1ï¼‰æ¦‚å¿µ"><a href="#1ï¼‰æ¦‚å¿µ" class="headerlink" title="1ï¼‰æ¦‚å¿µ"></a>1ï¼‰æ¦‚å¿µ</h4><p>é¡¹ç›®æ˜¯ä¸ºåˆ›å»ºæŸä¸€é¡¹ç‹¬ç‰¹äº§å“ã€æœåŠ¡æˆ–æˆæœæ‰€åšçš„ä¸´æ—¶æ€§ï¼ˆä¸€æ¬¡æ€§ï¼‰åŠªåŠ›ï¼Œæœ‰ç‰¹å®šçš„ç¯å¢ƒå’Œè¦æ±‚</p><h4 id="2ï¼‰ç‰¹ç‚¹"><a href="#2ï¼‰ç‰¹ç‚¹" class="headerlink" title="2ï¼‰ç‰¹ç‚¹"></a>2ï¼‰ç‰¹ç‚¹</h4><h5 id="1-ä¸´æ—¶æ€§ï¼ˆä¸€æ¬¡æ€§ï¼‰"><a href="#1-ä¸´æ—¶æ€§ï¼ˆä¸€æ¬¡æ€§ï¼‰" class="headerlink" title="1. ä¸´æ—¶æ€§ï¼ˆä¸€æ¬¡æ€§ï¼‰"></a>1. ä¸´æ—¶æ€§ï¼ˆä¸€æ¬¡æ€§ï¼‰</h5><ul><li>ä¸´æ—¶æ€§å¹¶ä¸è¡¨ç¤ºæ—¶é—´çŸ­</li><li>é¡¹ç›®æœ‰æ˜ç¡®çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´</li></ul><h5 id="2-ç‹¬ç‰¹æ€§"><a href="#2-ç‹¬ç‰¹æ€§" class="headerlink" title="2. ç‹¬ç‰¹æ€§"></a>2. ç‹¬ç‰¹æ€§</h5><ul><li>å¯èƒ½æœ‰ä¸€æ ·çš„äº§å“ï¼Œä½†ä¸å¯èƒ½æœ‰ä¸€æ ·çš„é¡¹ç›®</li><li>ä¸å¯èƒ½æœ‰ä¸¤æ ‹å®Œå…¨ä¸€æ ·çš„æ¥¼</li></ul><h5 id="3-ç›®çš„æ€§"><a href="#3-ç›®çš„æ€§" class="headerlink" title="3. ç›®çš„æ€§"></a>3. ç›®çš„æ€§</h5><p>é¡¹ç›®éœ€è¦æœ‰æ˜ç¡®çš„ç›®çš„æ€§</p><h5 id="4-èµ„æºçº¦æŸ"><a href="#4-èµ„æºçº¦æŸ" class="headerlink" title="4. èµ„æºçº¦æŸ"></a>4. èµ„æºçº¦æŸ</h5><ul><li>è¿›åº¦ã€æˆæœ¬ã€è´¨é‡</li><li>ä¸‰è€…ç›¸è¾…ç›¸æˆåˆäº’ç›¸åˆ¶çº¦</li></ul><h4 id="3ï¼‰ç›®æ ‡ã€çº¦æŸã€å˜é‡ã€æ ¸å¿ƒ"><a href="#3ï¼‰ç›®æ ‡ã€çº¦æŸã€å˜é‡ã€æ ¸å¿ƒ" class="headerlink" title="3ï¼‰ç›®æ ‡ã€çº¦æŸã€å˜é‡ã€æ ¸å¿ƒ"></a>3ï¼‰ç›®æ ‡ã€çº¦æŸã€å˜é‡ã€æ ¸å¿ƒ</h4><h5 id="1-ä¸‰å¤§ç›®æ ‡"><a href="#1-ä¸‰å¤§ç›®æ ‡" class="headerlink" title="1. ä¸‰å¤§ç›®æ ‡"></a>1. ä¸‰å¤§ç›®æ ‡</h5><ul><li>æ—¶é—´ï¼ˆè¿›åº¦ï¼‰ã€æˆæœ¬ï¼ˆæŠ•èµ„ï¼‰ã€è´¨é‡</li></ul><h5 id="2-å››å¤§çº¦æŸ"><a href="#2-å››å¤§çº¦æŸ" class="headerlink" title="2. å››å¤§çº¦æŸ"></a>2. å››å¤§çº¦æŸ</h5><p>èŒƒå›´ã€è´¨é‡ã€è¿›åº¦ã€æŠ•èµ„</p><h5 id="3-äº”å¤§å˜é‡"><a href="#3-äº”å¤§å˜é‡" class="headerlink" title="3. äº”å¤§å˜é‡"></a>3. äº”å¤§å˜é‡</h5><p>èŒƒå›´ã€è´¨é‡ã€è¿›åº¦ã€æŠ•èµ„ã€å®‰å…¨</p><h5 id="4-å…­å¤§æ ¸å¿ƒ"><a href="#4-å…­å¤§æ ¸å¿ƒ" class="headerlink" title="4. å…­å¤§æ ¸å¿ƒ"></a>4. å…­å¤§æ ¸å¿ƒ</h5><p>èŒƒå›´ã€è´¨é‡ã€è¿›åº¦ã€æŠ•èµ„ã€å®‰å…¨ã€æ•´ä½“</p><h4 id="3ï¼‰é¡¹ç›®ç®¡ç†è¿‡ç¨‹"><a href="#3ï¼‰é¡¹ç›®ç®¡ç†è¿‡ç¨‹" class="headerlink" title="3ï¼‰é¡¹ç›®ç®¡ç†è¿‡ç¨‹"></a>3ï¼‰é¡¹ç›®ç®¡ç†è¿‡ç¨‹</h4><h5 id="1-æ ¸å¿ƒçŸ¥è¯†åŸŸ"><a href="#1-æ ¸å¿ƒçŸ¥è¯†åŸŸ" class="headerlink" title="1. æ ¸å¿ƒçŸ¥è¯†åŸŸ"></a>1. æ ¸å¿ƒçŸ¥è¯†åŸŸ</h5><ul><li>èŒƒå›´ç®¡ç†</li><li>è´¨é‡ç®¡ç†</li><li>è¿›åº¦ç®¡ç†</li><li>æˆæœ¬ç®¡ç†</li><li>ä¿¡æ¯å®‰å…¨ç®¡ç†</li><li>æ•´ä½“ç®¡ç†</li></ul><h5 id="2-è¿‡ç¨‹åŸŸ"><a href="#2-è¿‡ç¨‹åŸŸ" class="headerlink" title="2. è¿‡ç¨‹åŸŸ"></a>2. è¿‡ç¨‹åŸŸ</h5><ul><li>å¯ç ”ä¸ç«‹é¡¹</li><li>å¯åŠ¨</li><li>è®¡åˆ’</li><li>å®æ–½</li><li>ç›‘æ§</li><li>æ”¶å°¾</li></ul><h5 id="3-ä¼´éšåŸŸ"><a href="#3-ä¼´éšåŸŸ" class="headerlink" title="3. ä¼´éšåŸŸ"></a>3. ä¼´éšåŸŸ</h5><ul><li>å˜æ›´ç®¡ç†</li><li>æ²Ÿé€šç®¡ç†</li></ul><h5 id="4-ä¿éšœåŸŸ"><a href="#4-ä¿éšœåŸŸ" class="headerlink" title="4. ä¿éšœåŸŸ"></a>4. ä¿éšœåŸŸ</h5><ul><li>äººåŠ›èµ„æºç®¡ç†</li><li>åˆåŒç®¡ç†</li><li>é‡‡è´­ç®¡ç†</li><li>é£é™©ç®¡ç†</li><li>ä¿¡æ¯ä¸é…ç½®ç®¡ç†</li><li>çŸ¥è¯†äº§æƒç®¡ç†</li><li>æ³•å¾‹æ³•è§„ã€æ ‡å‡†è§„èŒƒå’ŒèŒä¸šé“å¾·è§„èŒƒ</li></ul><h4 id="4ï¼‰é¡¹ç›®å’Œæ—¥å¸¸è¿ä½œçš„åŒºåˆ«"><a href="#4ï¼‰é¡¹ç›®å’Œæ—¥å¸¸è¿ä½œçš„åŒºåˆ«" class="headerlink" title="4ï¼‰é¡¹ç›®å’Œæ—¥å¸¸è¿ä½œçš„åŒºåˆ«"></a>4ï¼‰é¡¹ç›®å’Œæ—¥å¸¸è¿ä½œçš„åŒºåˆ«</h4><h2 id="äºŒã€åå¤§çŸ¥è¯†é¢†åŸŸå’Œäº”å¤§è¿‡ç¨‹ç»„"><a href="#äºŒã€åå¤§çŸ¥è¯†é¢†åŸŸå’Œäº”å¤§è¿‡ç¨‹ç»„" class="headerlink" title="äºŒã€åå¤§çŸ¥è¯†é¢†åŸŸå’Œäº”å¤§è¿‡ç¨‹ç»„"></a>äºŒã€åå¤§çŸ¥è¯†é¢†åŸŸå’Œäº”å¤§è¿‡ç¨‹ç»„</h2><h3 id="1ã€åå¤§çŸ¥è¯†é¢†åŸŸ"><a href="#1ã€åå¤§çŸ¥è¯†é¢†åŸŸ" class="headerlink" title="1ã€åå¤§çŸ¥è¯†é¢†åŸŸ"></a>1ã€åå¤§çŸ¥è¯†é¢†åŸŸ</h3><blockquote><p>ğŸŒˆ <strong>é€Ÿè®°è¯ï¼š</strong></p></blockquote><table><thead><tr><th>é€Ÿè®°è¯</th><th>çŸ¥è¯†ç‚¹</th><th>è§£é‡Šè¯´æ˜</th></tr></thead><tbody><tr><td>èŒƒ</td><td>èŒƒå›´ç®¡ç†</td><td>å“ªäº›å·¥ä½œå¿…é¡»åšï¼ˆWBSï¼‰</td></tr><tr><td>è¿›</td><td>è¿›åº¦ç®¡ç†</td><td>ä»€ä¹ˆæ—¶å€™åšï¼ˆè¿›åº¦åŸºå‡†ï¼‰</td></tr><tr><td>æ•´</td><td>æ•´ä½“ç®¡ç†</td><td>ç»Ÿä¸€å¹¶åè°ƒï¼ˆæˆ˜ç•¥ï¼‰</td></tr><tr><td>ç‹—</td><td>æ²Ÿé€šç®¡ç†</td><td>å¦‚ä½•ä¼ é€’ä¿¡æ¯ï¼ˆç»„ç»‡ï¼‰</td></tr><tr><td>å­</td><td>è´¨é‡ç®¡ç†</td><td>åšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼ˆæˆ˜æœ¯æŒ‡å¯¼ï¼‰</td></tr><tr><td>æˆ</td><td>æˆæœ¬ç®¡ç†</td><td>èŠ±å¤šå°‘é’±åšï¼ˆæˆæœ¬åŸºå‡†ï¼‰</td></tr><tr><td>äºº</td><td>äººåŠ›èµ„æºç®¡ç†</td><td>ç”¨ä»€ä¹ˆäººåšï¼ˆç»„ç»‡ï¼‰</td></tr><tr><td>é£</td><td>é£é™©ç®¡ç†</td><td>å¨èƒå’Œæœºä¼šï¼ˆä¾‹å¤–ï¼‰</td></tr><tr><td>é‡‡</td><td>é‡‡è´­ç®¡ç†</td><td>ä¹°ä»€ä¹ˆèµ„æºï¼ˆå¤–åŒ…äººæˆ–ç‰©ï¼‰</td></tr><tr><td>å¹²æ¯</td><td>å¹²ç³»äººç®¡ç†</td><td>å¦‚ä½•è·å¾—æ”¯æŒï¼ˆå½±å“å¹²ç³»äººï¼‰</td></tr></tbody></table><p>â€“</p><h3 id="2ã€äº”å¤§è¿‡ç¨‹ç»„"><a href="#2ã€äº”å¤§è¿‡ç¨‹ç»„" class="headerlink" title="2ã€äº”å¤§è¿‡ç¨‹ç»„"></a>2ã€äº”å¤§è¿‡ç¨‹ç»„</h3><table><thead><tr><th>è¿‡ç¨‹</th><th>æè¿°</th><th>è¦æ±‚</th></tr></thead><tbody><tr><td>å¯åŠ¨</td><td>ç¡®å®šç›®æ ‡</td><td>åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹</td></tr><tr><td>è§„åˆ’</td><td>åˆ¶å®šè®¡åˆ’</td><td>è¿ç­¹å¸·å¹„ï¼Œå†³èƒœåƒé‡Œ</td></tr><tr><td>æ‰§è¡Œ</td><td>å®æ–½è®¡åˆ’</td><td>è¨€å‡ºå¿…è¡Œï¼Œè¡Œå¿…ç»“æœ</td></tr><tr><td>ç›‘æ§</td><td>ä¼˜åŒ–è¿­ä»£è®¡åˆ’</td><td>å®¡æ—¶åº¦åŠ¿ï¼Œæ²‰ç€åº”å¯¹</td></tr><tr><td>æ”¶å°¾</td><td>äº¤ä»˜æˆæœï¼Œæ€»ç»“å›é¡¾</td><td>æœ‰å§‹æœ‰ç»ˆï¼Œå¦‚å±¥è–„å†°</td></tr></tbody></table><h3 id="3ã€æ±‡æ€»è¡¨"><a href="#3ã€æ±‡æ€»è¡¨" class="headerlink" title="3ã€æ±‡æ€»è¡¨"></a>3ã€æ±‡æ€»è¡¨</h3><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210903124206118.png" alt="image-20210903124206118"></p><h3 id="4ã€è¿‡ç¨‹å›¾"><a href="#4ã€è¿‡ç¨‹å›¾" class="headerlink" title="4ã€è¿‡ç¨‹å›¾"></a>4ã€è¿‡ç¨‹å›¾</h3><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830231327420.png" alt="image-20210830231327420"></p><h3 id="5ã€å¯äº¤ä»˜æˆæœçš„æ—¶é—´çº¿"><a href="#5ã€å¯äº¤ä»˜æˆæœçš„æ—¶é—´çº¿" class="headerlink" title="5ã€å¯äº¤ä»˜æˆæœçš„æ—¶é—´çº¿"></a>5ã€å¯äº¤ä»˜æˆæœçš„æ—¶é—´çº¿</h3><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830232525128.png" alt="image-20210830232525128"></p><h3 id="6ã€æˆæœçº¿"><a href="#6ã€æˆæœçº¿" class="headerlink" title="6ã€æˆæœçº¿"></a>6ã€æˆæœçº¿</h3><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830232851574.png" alt="image-20210830232851574"></p><h3 id="7ã€æ•°æ®çº¿"><a href="#7ã€æ•°æ®çº¿" class="headerlink" title="7ã€æ•°æ®çº¿"></a>7ã€æ•°æ®çº¿</h3><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210830232954544.png" alt="image-20210830232954544"> </p>]]></content>
    
    
    <categories>
      
      <category>è½¯è€ƒé«˜é¡¹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¡¹ç›®ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>node ç¼–è¯‘ JavaScript heap out of memory å†…å­˜æº¢å‡ºé—®é¢˜è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2021/08/26/node-%E7%BC%96%E8%AF%91-JavaScript-heap-out-of-memory-%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2021/08/26/node-%E7%BC%96%E8%AF%91-JavaScript-heap-out-of-memory-%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="node-ç¼–è¯‘-JavaScript-heap-out-of-memory-å†…å­˜æº¢å‡ºé—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#node-ç¼–è¯‘-JavaScript-heap-out-of-memory-å†…å­˜æº¢å‡ºé—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="node ç¼–è¯‘ JavaScript heap out of memory å†…å­˜æº¢å‡ºé—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>node ç¼–è¯‘ JavaScript heap out of memory å†…å­˜æº¢å‡ºé—®é¢˜è§£å†³æ–¹æ¡ˆ</h1><span id="more"></span><h2 id="ä¸€ã€èƒŒæ™¯ä»‹ç»"><a href="#ä¸€ã€èƒŒæ™¯ä»‹ç»" class="headerlink" title="ä¸€ã€èƒŒæ™¯ä»‹ç»"></a>ä¸€ã€èƒŒæ™¯ä»‹ç»</h2><p>æœ€è¿‘åœ¨ä½¿ç”¨nodeç¼–è¯‘é¡¹ç›®æ—¶ï¼Œé‡åˆ°äº†è¿™æ ·çš„é”™è¯¯ï¼ŒæŒ‰ç…§å­—é¢æ„æ€ç†è§£ï¼Œå°±æ˜¯å†…å­˜æº¢å‡ºäº†ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210825172156810.png" alt="image-20210825172156810"></p><h2 id="äºŒã€æ ¹å› è¿½æº¯"><a href="#äºŒã€æ ¹å› è¿½æº¯" class="headerlink" title="äºŒã€æ ¹å› è¿½æº¯"></a>äºŒã€æ ¹å› è¿½æº¯</h2><blockquote><p><a href="https://github.com/nodejs/node/wiki/FAQ">å®˜æ–¹FAQ</a></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">What <span class="hljs-keyword">is</span> the memory <span class="hljs-keyword">limit</span> <span class="hljs-keyword">on</span> a node process?Currently, <span class="hljs-keyword">by</span> <span class="hljs-keyword">default</span> v8 has a memory <span class="hljs-keyword">limit</span> <span class="hljs-keyword">of</span> <span class="hljs-number">512</span>MB <span class="hljs-keyword">on</span> <span class="hljs-number">32</span>-<span class="hljs-type">bit</span> systems, <span class="hljs-keyword">and</span> <span class="hljs-number">1.4</span>GB <span class="hljs-keyword">on</span> <span class="hljs-number">64</span>-<span class="hljs-type">bit</span> systems. The <span class="hljs-keyword">limit</span> can be raised <span class="hljs-keyword">by</span> setting <span class="hljs-comment">--max_old_space_size to a maximum of ~1024 (~1 GB) (32-bit) and ~4096 (~4GB) (64-bit), but it is recommended that you split your single process into several workers if you are hitting memory limits.</span><br></code></pre></td></tr></table></figure></blockquote><p>åœ¨å®˜æ–¹ç»™å‡ºçš„ä»‹ç»ä¸­å¯ä»¥äº†è§£åˆ°ï¼Œnodejs çš„ v8 å¼•æ“é»˜è®¤ç»™çš„å†…å­˜é…ç½®æ¯”è¾ƒå°ï¼ˆ64ä½ç³»ç»Ÿï¼š1.4 GBï¼Œ32ä½ç³»ç»Ÿï¼š0.7 GBï¼‰å¹¶ä¸”å†…å­˜å¤§å°æœ€å¤§ä¸º 4gï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå‰ç«¯é¡¹ç›®éå¸¸çš„åºå¤§ï¼ŒWebpackç¼–è¯‘æ—¶å°±ä¼šå ç”¨å¾ˆå¤šçš„ç³»ç»Ÿèµ„æºï¼Œå¦‚æœè¶…å‡ºäº†V8å¼•æ“å¯¹Nodeé»˜è®¤çš„å†…å­˜é™åˆ¶å¤§å°æ—¶ï¼Œå°±ä¼šäº§ç”Ÿå†…å­˜æ³„éœ²(JavaScript heap out of memory)çš„é”™è¯¯ã€‚</p><h2 id="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‰ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è§£å†³æ–¹æ¡ˆ"></a>ä¸‰ã€è§£å†³æ–¹æ¡ˆ</h2><p>æ—¢ç„¶é—®é¢˜å·²ç»éå¸¸æ˜ç¡®äº†ï¼Œé‚£ä¹ˆè§£å†³èµ·æ¥ä¹Ÿå°±æ¯”è¾ƒå®¹æ˜“äº†ï¼Œè§£å†³çš„æ–¹æ¡ˆæœ‰ä»¥ä¸‹ä¸‰ç§:</p><h3 id="1ã€ä¿®æ”¹-bin-ä¸‹çš„å‘½ä»¤"><a href="#1ã€ä¿®æ”¹-bin-ä¸‹çš„å‘½ä»¤" class="headerlink" title="1ã€ä¿®æ”¹ ./bin ä¸‹çš„å‘½ä»¤"></a>1ã€ä¿®æ”¹ ./bin ä¸‹çš„å‘½ä»¤</h3><p><a href="https://www.cnblogs.com/liugang-vip/p/6857595.html">æ–¹æ¡ˆå‚è€ƒ</a></p><h3 id="2ã€ä¿®æ”¹-node-å‚æ•°-â€“max-old-space-size"><a href="#2ã€ä¿®æ”¹-node-å‚æ•°-â€“max-old-space-size" class="headerlink" title="2ã€ä¿®æ”¹ node å‚æ•° â€“max-old-space-size"></a>2ã€ä¿®æ”¹ node å‚æ•° â€“max-old-space-size</h3><p>åœ¨é¡¹ç›®çš„ package.json æ–‡ä»¶çš„ script æ¨¡å—ä¸­çš„ build æŒ‡ä»¤ä¸­æ·»åŠ  <code>--max-old-space-size=8192</code>ï¼Œæ„æ€æ˜¯å°†å†…å­˜å¯ä½¿ç”¨å†…å­˜è°ƒæ•´åˆ° 8Gï¼Œè¶³å¤Ÿä½¿ç”¨äº†ï¼ˆè™½ç„¶å®˜æ–¹å»ºè®®å¦‚æœä½¿ç”¨è¾ƒå¤§å†…å­˜çš„è¯åˆ™éœ€è¦åˆ†æˆå¤šä¸ªå­ worker è¿™æ ·æ¥è§„é¿å¤§å†…å­˜çš„ä½¿ç”¨ï¼‰</p><p>å¦‚ä¸‹:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br><span class="hljs-comment">// ...</span><br>  <span class="hljs-attr">&quot;private&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">&quot;scripts&quot;</span>: &#123;<br><span class="hljs-comment">// ...</span><br>    <span class="hljs-attr">&quot;build&quot;</span>: <span class="hljs-string">&quot;node --max-old-space-size=8192 build/build.js&quot;</span>,<br>   <span class="hljs-comment">// ...</span><br>  &#125;,<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€ä½¿ç”¨-increase-memory-limit"><a href="#3ã€ä½¿ç”¨-increase-memory-limit" class="headerlink" title="3ã€ä½¿ç”¨ increase-memory-limit"></a>3ã€ä½¿ç”¨ increase-memory-limit</h3><h4 id="1ï¼‰ä¸‹è½½-increase-memory-limit"><a href="#1ï¼‰ä¸‹è½½-increase-memory-limit" class="headerlink" title="1ï¼‰ä¸‹è½½ increase-memory-limit"></a>1ï¼‰ä¸‹è½½ <code>increase-memory-limit</code></h4><p><a href="https://www.npmjs.com/package/increase-memory-limit">npmåŒ…åœ°å€</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cnpm install increase-memory-limit<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ä¿®æ”¹å‰ç«¯é¡¹ç›®çš„-package-josn"><a href="#2ï¼‰ä¿®æ”¹å‰ç«¯é¡¹ç›®çš„-package-josn" class="headerlink" title="2ï¼‰ä¿®æ”¹å‰ç«¯é¡¹ç›®çš„ package.josn"></a>2ï¼‰ä¿®æ”¹å‰ç«¯é¡¹ç›®çš„ <code>package.josn</code></h4><p>æ–‡ä»¶è·¯å¾„: <code>~/go/src/configcenter/src/ui/package.json</code>ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// ...</span><br>  <span class="hljs-string">&quot;scripts&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;fix-memory-limit&quot;</span>: <span class="hljs-string">&quot;cross-env LIMIT=16384 increase-memory-limit&quot;</span>,<br>    <span class="hljs-comment">// ...</span><br>  &#125;,<br><span class="hljs-comment">// ...</span><br>  <span class="hljs-string">&quot;devDependencies&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;increase-memory-limit&quot;</span>: <span class="hljs-string">&quot;^1.0.3&quot;</span>,<br>    <span class="hljs-attr">&quot;cross-env&quot;</span>: <span class="hljs-string">&quot;^5.0.5&quot;</span><br>  &#125;<br><span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰è¿è¡Œä¿®å¤å†…å­˜é™åˆ¶ä»»åŠ¡"><a href="#3ï¼‰è¿è¡Œä¿®å¤å†…å­˜é™åˆ¶ä»»åŠ¡" class="headerlink" title="3ï¼‰è¿è¡Œä¿®å¤å†…å­˜é™åˆ¶ä»»åŠ¡"></a>3ï¼‰è¿è¡Œä¿®å¤å†…å­˜é™åˆ¶ä»»åŠ¡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm run fix-memory-limit<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210825171914179.png" alt="image-20210825171914179"></p><p>å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªåŒ…å®é™…ä¸Šå°±æ˜¯è‡ªåŠ¨å¤„ç†æ–¹æ¡ˆä¸€çš„è¿‡ç¨‹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯æŠ€æœ¯æ ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é—®é¢˜è§£å†³æ–¹æ¡ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>golang å¤šç‰ˆæœ¬ç®¡ç†å·¥å…· â€” g</title>
    <link href="/2021/08/25/golang-%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-%E2%80%94-g/"/>
    <url>/2021/08/25/golang-%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-%E2%80%94-g/</url>
    
    <content type="html"><![CDATA[<h1 id="golang-å¤šç‰ˆæœ¬ç®¡ç†å·¥å…·-â€”-g"><a href="#golang-å¤šç‰ˆæœ¬ç®¡ç†å·¥å…·-â€”-g" class="headerlink" title="golang å¤šç‰ˆæœ¬ç®¡ç†å·¥å…· â€” g"></a>golang å¤šç‰ˆæœ¬ç®¡ç†å·¥å…· â€” g</h1><span id="more"></span><h2 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯-g-ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯-g-ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯ g ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯ g ï¼Ÿ</h3><p>GVMæ˜¯ä¸€ä¸ªgolangè™šæ‹Ÿç¯å¢ƒé…ç½®å·¥å…·ï¼Œå…¶å…è®¸ä¸€å°æœºå™¨ä¸Šå®‰è£…å¤šä¸ªgolangç‰ˆæœ¬ï¼Œgvmæ˜¯ç¬¬ä¸‰æ–¹å¼€å‘çš„Goå¤šç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼rubyé‡Œé¢çš„rvmå·¥å…·ï¼Œæˆ–è€…nodejsçš„ç‰ˆæœ¬ç®¡ç†å·¥å…·nvmã€‚å®ƒæ˜¯ä»¥shellè„šæœ¬å¼€å‘çš„å·¥å…·ï¼ŒåŒæ—¶å…¼å®¹bashå’Œzshï¼Œç”¨æ³•å’Œrubyçš„rvmå¾ˆåƒï¼Œèƒ½åšåˆ°Goè¯­è¨€ç‰ˆæœ¬çš„åˆ‡æ¢ä»¥åŠGOPATHçš„ä¿®æ”¹ã€‚</p><h3 id="2ã€g-çš„ç‰¹æ€§"><a href="#2ã€g-çš„ç‰¹æ€§" class="headerlink" title="2ã€g çš„ç‰¹æ€§"></a>2ã€g çš„ç‰¹æ€§</h3><ul><li>æ”¯æŒåˆ—å‡ºå¯ä¾›å®‰è£…çš„goç‰ˆæœ¬å·</li><li>æ”¯æŒåˆ—å‡ºå·²å®‰è£…çš„goç‰ˆæœ¬å·</li><li>æ”¯æŒåœ¨æœ¬åœ°å®‰è£…å¤šä¸ªgoç‰ˆæœ¬</li><li>æ”¯æŒå¸è½½å·²å®‰è£…çš„goç‰ˆæœ¬</li><li>æ”¯æŒåœ¨å·²å®‰è£…çš„goç‰ˆæœ¬ä¹‹é—´è‡ªç”±åˆ‡æ¢</li></ul><h2 id="äºŒã€å®‰è£…"><a href="#äºŒã€å®‰è£…" class="headerlink" title="äºŒã€å®‰è£…"></a>äºŒã€å®‰è£…</h2><h3 id="1ã€Linux-macOS-ä¸‹è‡ªåŠ¨å®‰è£…ï¼ˆä½¿ç”¨äº-bashã€zsh-ç»ˆç«¯ï¼‰"><a href="#1ã€Linux-macOS-ä¸‹è‡ªåŠ¨å®‰è£…ï¼ˆä½¿ç”¨äº-bashã€zsh-ç»ˆç«¯ï¼‰" class="headerlink" title="1ã€Linux / macOS ä¸‹è‡ªåŠ¨å®‰è£…ï¼ˆä½¿ç”¨äº bashã€zsh ç»ˆç«¯ï¼‰"></a>1ã€Linux / macOS ä¸‹è‡ªåŠ¨å®‰è£…ï¼ˆä½¿ç”¨äº bashã€zsh ç»ˆç«¯ï¼‰</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å»ºè®®å®‰è£…å‰æ¸…ç©º`GOROOT`ã€`GOBIN`ç­‰ç¯å¢ƒå˜é‡</span><br>wget -qO- https://raw.githubusercontent.com/voidint/g/master/install.sh | bash<br></code></pre></td></tr></table></figure><blockquote><p>ğŸš© å¦‚æœæœ‰å…¶ä»–ç¨‹åºçš„åˆ«åå ç”¨äº† <code>g</code>ï¼Œæ¯”å¦‚ gitï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œæ¸…é™¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">unalias g<br></code></pre></td></tr></table></figure></blockquote><h3 id="2ã€æ‰‹åŠ¨å®‰è£…-ï¼ˆå¯é€‰ï¼‰"><a href="#2ã€æ‰‹åŠ¨å®‰è£…-ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="2ã€æ‰‹åŠ¨å®‰è£… ï¼ˆå¯é€‰ï¼‰"></a>2ã€æ‰‹åŠ¨å®‰è£… ï¼ˆå¯é€‰ï¼‰</h3><h4 id="1ï¼‰ä¸‹è½½å¯¹åº”å¹³å°çš„äºŒè¿›åˆ¶å‹ç¼©åŒ…"><a href="#1ï¼‰ä¸‹è½½å¯¹åº”å¹³å°çš„äºŒè¿›åˆ¶å‹ç¼©åŒ…" class="headerlink" title="1ï¼‰ä¸‹è½½å¯¹åº”å¹³å°çš„äºŒè¿›åˆ¶å‹ç¼©åŒ…"></a>1ï¼‰ä¸‹è½½å¯¹åº”å¹³å°çš„äºŒè¿›åˆ¶å‹ç¼©åŒ…</h4><p><a href="https://github.com/voidint/g/releases">ä¸‹è½½åœ°å€</a></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210825160732431.png" alt="image-20210825160732431"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä»¥å½“å‰æœ€æ–°ç‰ˆæœ¬ä¸ºä¾‹</span><br>wget -c https://github.com/voidint/g/releases/download/v1.2.0/g1.2.0.linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰è§£å‹ç¼©"><a href="#2ï¼‰è§£å‹ç¼©" class="headerlink" title="2ï¼‰è§£å‹ç¼©"></a>2ï¼‰è§£å‹ç¼©</h4><p>å°†å‹ç¼©åŒ…è§£å‹è‡³<code>PATH</code>ç¯å¢ƒå˜é‡ç›®å½•ä¸‹ï¼Œå¦‚<code>/usr/local/bin</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xf g1.2.0.linux-amd64.tar.gz -C /usr/local/bin/<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰éªŒè¯"><a href="#3ï¼‰éªŒè¯" class="headerlink" title="3ï¼‰éªŒè¯"></a>3ï¼‰éªŒè¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">g -h<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210825162431942.png" alt="image-20210825162431942"></p><h3 id="3ã€é…ç½®ç¯å¢ƒå˜é‡"><a href="#3ã€é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="3ã€é…ç½®ç¯å¢ƒå˜é‡"></a>3ã€é…ç½®ç¯å¢ƒå˜é‡</h3><h4 id="1ï¼‰ç¼–è¾‘ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶"><a href="#1ï¼‰ç¼–è¾‘ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶" class="headerlink" title="1ï¼‰ç¼–è¾‘ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶"></a>1ï¼‰ç¼–è¾‘ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶</h4><p>æ–°å»ºæ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„: <code>/etc/profile.d/g.sh</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">export G_MIRROR=https://golang.google.cn/dl/<br>export G_HOME=~/.g<br>export GOROOT=$G_HOME/go<br>export PATH=$GOROOT/bin:$PATH<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åŠ è½½ç¯å¢ƒå˜é‡é…ç½®"><a href="#2ï¼‰åŠ è½½ç¯å¢ƒå˜é‡é…ç½®" class="headerlink" title="2ï¼‰åŠ è½½ç¯å¢ƒå˜é‡é…ç½®"></a>2ï¼‰åŠ è½½ç¯å¢ƒå˜é‡é…ç½®</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source /etc/profile.d/g.sh<br></code></pre></td></tr></table></figure><blockquote><p>ğŸŒˆ <code>G_MIRROR</code> çš„ä½œç”¨:</p><p>ç”±äºä¸­å›½å¤§é™†æ— æ³•è‡ªç”±è®¿é—® Golangå®˜ç½‘ï¼Œå¯¼è‡´æŸ¥è¯¢åŠä¸‹è½½goç‰ˆæœ¬éƒ½å˜å¾—å›°éš¾ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è¯¥ç¯å¢ƒå˜é‡æŒ‡å®šä¸€ä¸ªé•œåƒç«™ç‚¹ï¼ˆå¦‚<code>https://golang.google.cn/dl/</code>ï¼‰ï¼Œgå°†ä»è¯¥ç«™ç‚¹æŸ¥è¯¢ã€ä¸‹è½½å¯ç”¨çš„goç‰ˆæœ¬ï¼Œå…¶ä½œç”¨ç›¸å½“äº <code>GOPROXY</code> ä¹‹äº Go çš„ä¾èµ–åŒ…ã€‚</p></blockquote><h2 id="ä¸‰ã€ä½¿ç”¨"><a href="#ä¸‰ã€ä½¿ç”¨" class="headerlink" title="ä¸‰ã€ä½¿ç”¨"></a>ä¸‰ã€ä½¿ç”¨</h2><h3 id="1ã€å®‰è£…-go-ç‰ˆæœ¬"><a href="#1ã€å®‰è£…-go-ç‰ˆæœ¬" class="headerlink" title="1ã€å®‰è£… go ç‰ˆæœ¬"></a>1ã€å®‰è£… go ç‰ˆæœ¬</h3><h4 id="1ï¼‰æŸ¥è¯¢å½“å‰ç¨³å®šç‰ˆæœ¬çš„-go"><a href="#1ï¼‰æŸ¥è¯¢å½“å‰ç¨³å®šç‰ˆæœ¬çš„-go" class="headerlink" title="1ï¼‰æŸ¥è¯¢å½“å‰ç¨³å®šç‰ˆæœ¬çš„ go"></a>1ï¼‰æŸ¥è¯¢å½“å‰ç¨³å®šç‰ˆæœ¬çš„ go</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">g ls-remote stable<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210825162918755.png" alt="image-20210825162918755"></p><h4 id="2ï¼‰å®‰è£…ç›®æ ‡-go-ç‰ˆæœ¬-1-16-7"><a href="#2ï¼‰å®‰è£…ç›®æ ‡-go-ç‰ˆæœ¬-1-16-7" class="headerlink" title="2ï¼‰å®‰è£…ç›®æ ‡ go ç‰ˆæœ¬ 1.16.7"></a>2ï¼‰å®‰è£…ç›®æ ‡ go ç‰ˆæœ¬ <code>1.16.7</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">g install 1.16.7<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210825163148164.png" alt="image-20210825163148164"></p><h4 id="3ï¼‰éªŒè¯-1"><a href="#3ï¼‰éªŒè¯-1" class="headerlink" title="3ï¼‰éªŒè¯"></a>3ï¼‰éªŒè¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">g ls<br></code></pre></td></tr></table></figure><blockquote><p>ğŸš© å¸¦ <code>*</code> çš„å°±è¡¨ç¤ºå½“å‰æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬</p></blockquote><h3 id="2ã€å¸¸ç”¨å‘½ä»¤è¯¦è§£"><a href="#2ã€å¸¸ç”¨å‘½ä»¤è¯¦è§£" class="headerlink" title="2ã€å¸¸ç”¨å‘½ä»¤è¯¦è§£"></a>2ã€å¸¸ç”¨å‘½ä»¤è¯¦è§£</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">g ls # æŸ¥è¯¢å·²å®‰è£…çš„goç‰ˆæœ¬<br>g ls-remote # æŸ¥è¯¢å¯ä¾›å®‰è£…çš„æ‰€æœ‰goç‰ˆæœ¬<br>g ls-remote stable # æŸ¥è¯¢å½“å‰å¯ä¾›å®‰è£…çš„stableçŠ¶æ€çš„goç‰ˆæœ¬<br>g install 1.16.7# å®‰è£…ç›®æ ‡goç‰ˆæœ¬1.16.7<br>g use 1.15.15 # åˆ‡æ¢è‡³1.15.15ç‰ˆæœ¬<br>g uninstall 1.15.15 # å¸è½½ä¸€ä¸ªå·²å®‰è£…çš„goç‰ˆæœ¬<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬1ç« ã€åˆè¯† GoAdmin</title>
    <link href="/2021/08/24/%E7%AC%AC1%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-GoAdmin/"/>
    <url>/2021/08/24/%E7%AC%AC1%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-GoAdmin/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€åˆè¯†-GoAdmin"><a href="#ç¬¬1ç« ã€åˆè¯†-GoAdmin" class="headerlink" title="ç¬¬1ç« ã€åˆè¯† GoAdmin"></a>ç¬¬1ç« ã€åˆè¯† GoAdmin</h1><span id="more"></span><h2 id="ä¸€ã€GoAdmin-ç®€ä»‹"><a href="#ä¸€ã€GoAdmin-ç®€ä»‹" class="headerlink" title="ä¸€ã€GoAdmin ç®€ä»‹"></a>ä¸€ã€GoAdmin ç®€ä»‹</h2><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210824171658211.png" alt="GoAdmin Logo"></p><p><a href="https://github.com/go-admin-team/go-admin">GoAdmin å®˜æ–¹github</a></p><p><a href="https://doc.zhangwj.com/">GoAdmin å®˜ç½‘æ–‡æ¡£</a></p><h3 id="1ã€GoAdmin-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€GoAdmin-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€GoAdmin æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€GoAdmin æ˜¯ä»€ä¹ˆï¼Ÿ</h3><h4 id="1ï¼‰é¡¹ç›®ç‰¹æ€§"><a href="#1ï¼‰é¡¹ç›®ç‰¹æ€§" class="headerlink" title="1ï¼‰é¡¹ç›®ç‰¹æ€§"></a>1ï¼‰é¡¹ç›®ç‰¹æ€§</h4><h4 id="2ï¼‰å†…ç½®åŠŸèƒ½"><a href="#2ï¼‰å†…ç½®åŠŸèƒ½" class="headerlink" title="2ï¼‰å†…ç½®åŠŸèƒ½"></a>2ï¼‰å†…ç½®åŠŸèƒ½</h4><h3 id="2ã€GoAdmin-å¯ä»¥å®ç°ä»€ä¹ˆï¼Ÿ"><a href="#2ã€GoAdmin-å¯ä»¥å®ç°ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€GoAdmin å¯ä»¥å®ç°ä»€ä¹ˆï¼Ÿ"></a>2ã€GoAdmin å¯ä»¥å®ç°ä»€ä¹ˆï¼Ÿ</h3><h2 id="äºŒã€æœ¬åœ°å¼€å‘ç¯å¢ƒè°ƒè¯•"><a href="#äºŒã€æœ¬åœ°å¼€å‘ç¯å¢ƒè°ƒè¯•" class="headerlink" title="äºŒã€æœ¬åœ°å¼€å‘ç¯å¢ƒè°ƒè¯•"></a>äºŒã€æœ¬åœ°å¼€å‘ç¯å¢ƒè°ƒè¯•</h2><h3 id="1ã€å®ç°å‡†å¤‡"><a href="#1ã€å®ç°å‡†å¤‡" class="headerlink" title="1ã€å®ç°å‡†å¤‡"></a>1ã€å®ç°å‡†å¤‡</h3><h3 id="2ã€æœ¬åœ°è°ƒè¯•"><a href="#2ã€æœ¬åœ°è°ƒè¯•" class="headerlink" title="2ã€æœ¬åœ°è°ƒè¯•"></a>2ã€æœ¬åœ°è°ƒè¯•</h3>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GoAdmin å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitlab SSL è¯ä¹¦è‡ªåŠ¨åŒ–ç»­æœŸè§£å†³æ–¹æ¡ˆ</title>
    <link href="/2021/08/24/Gitlab-SSL-%E8%AF%81%E4%B9%A6%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2021/08/24/Gitlab-SSL-%E8%AF%81%E4%B9%A6%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="Gitlab-SSL-è¯ä¹¦è‡ªåŠ¨ç»­æœŸè§£å†³æ–¹æ¡ˆ"><a href="#Gitlab-SSL-è¯ä¹¦è‡ªåŠ¨ç»­æœŸè§£å†³æ–¹æ¡ˆ" class="headerlink" title="Gitlab SSL è¯ä¹¦è‡ªåŠ¨ç»­æœŸè§£å†³æ–¹æ¡ˆ"></a>Gitlab SSL è¯ä¹¦è‡ªåŠ¨ç»­æœŸè§£å†³æ–¹æ¡ˆ</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Gitlab</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬1ç« ã€åˆè¯† Golang</title>
    <link href="/2021/08/21/%E7%AC%AC1%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Golang/"/>
    <url>/2021/08/21/%E7%AC%AC1%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Golang/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€åˆè¯†-Golang"><a href="#ç¬¬1ç« ã€åˆè¯†-Golang" class="headerlink" title="ç¬¬1ç« ã€åˆè¯† Golang"></a>ç¬¬1ç« ã€åˆè¯† Golang</h1><span id="more"></span><h2 id="ä¸€-ã€Golang-ç®€ä»‹"><a href="#ä¸€-ã€Golang-ç®€ä»‹" class="headerlink" title="ä¸€ ã€Golang  ç®€ä»‹"></a>ä¸€ ã€Golang  ç®€ä»‹</h2><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/golang.jpeg" alt="golang"></p><h3 id="1ã€ä»€ä¹ˆæ˜¯-Golang-ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯-Golang-ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯ Golang ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯ Golang ï¼Ÿ</h3><p>Golang æ˜¯ä¸€é—¨é«˜å¹¶å‘æ”¯æŒã€åƒåœ¾å›æ”¶çš„<strong>ç¼–è¯‘å‹</strong>ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œæ—¨åœ¨åˆ›é€ ä¸€é—¨å³å…·æœ‰ C/C++ è¿™ç±»é™æ€ç¼–è¯‘è¯­è¨€çš„<strong>é«˜æ€§èƒ½</strong>ï¼Œåˆå…·å¤‡ Python è¿™ç±»åŠ¨æ€è¯­è¨€çš„<strong>å¼€å‘æ•ˆç‡</strong>ï¼Œå¹¶åœ¨ä¸¤è€…ä¹‹é—´è·å¾—è‰¯å¥½å¹³è¡¡çš„ç¼–ç¨‹è¯­è¨€ã€‚</p><p>ç›¸è¾ƒäºå…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼ŒGo æ— ç–‘æ˜¯éå¸¸å¹´è½»çš„ï¼Œå®ƒè¯ç”Ÿäº 2006å¹´1æœˆ2æ—¥ä¸‹åˆ15ç‚¹4ä»½5ç§’ï¼Œç”±Googleå…¬å¸å¼€å‘ï¼Œå¹¶äº 2009å¹´11æœˆå¼€æºï¼Œ2012å¹´å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬ã€‚</p><p>å®ƒåœ¨å¤šæ ¸å¹¶å‘ä¸Šæ‹¥æœ‰åŸç”Ÿçš„è®¾è®¡ä¼˜åŠ¿ï¼Œå°†å¤šçº¿ç¨‹å¹¶å‘ã€çº¿ç¨‹é—´é€šä¿¡çš„èƒ½åŠ›å†…ç½®åœ¨è¯­æ³•å±‚é¢ï¼Œæ— éœ€åƒ C/C++ æˆ–è€… java é‚£èˆ¬å€ŸåŠ©å„ç§ç¬¬ä¸‰æ–¹æ¡†æ¶æˆ–è€…åº“å»å®ç°ï¼Œå¤§å¤§å‡è½»äº†åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘äººå‘˜åœ¨å®ç°åº•å±‚åŠŸèƒ½ä¸Šçš„è´Ÿæ‹…ã€‚</p><p>ç›®å‰ä¸–ç•Œä¸Šå¾ˆå¤šå…¬å¸ï¼Œç‰¹åˆ«æ˜¯ä¸­å›½çš„äº’è”ç½‘å…¬å¸ï¼Œå³å°†æˆ–è€…å·²ç»å®Œæˆäº†ä½¿ç”¨ Go è¯­è¨€æ”¹é€ æ—§ç³»ç»Ÿçš„è¿‡ç¨‹ï¼ˆæ²¡é”™ï¼Œå’Œ Java ä¸€æ ·ï¼ŒGo åœ¨ä¸­å›½å¯èƒ½ç›¸äº¤äºå…¶å‡ºèº«åœ°ç¾å›½æ›´ç«ï¼‰ã€‚ç»è¿‡ Go è¯­è¨€é‡æ„çš„ç³»ç»Ÿèƒ½ä½¿ç”¨æ›´å°‘çš„ç¡¬ä»¶èµ„æºè·å¾—æ›´é«˜çš„å¹¶å‘å’ŒI/Oååè¡¨ç°ã€‚å°¤å…¶æ˜¯ç›®å‰å¹¿æ³›è¿ç”¨çš„å®¹å™¨æŠ€æœ¯ï¼Œè¯¸å¦‚ dockerã€Kubernetes ç­‰çš†æ˜¯åŸºäº Golang å¼€å‘ï¼Œè¿™ä¸€ç±»æŠ€æœ¯å¯ä»¥å……åˆ†æŒ–æ˜ç¡¬ä»¶è®¾å¤‡çš„æ½œåŠ›ï¼Œä»¥æ›´å°çš„æˆæœ¬ï¼Œå®ç°åŒæ ·çš„æ€§èƒ½éœ€æ±‚ï¼Œè¿™æ›´åŠ èƒ½éƒ½æ»¡è¶³å½“å‰ç²¾ç»†åŒ–è¿è¥çš„å¸‚åœºå¤§ç¯å¢ƒã€‚</p><h3 id="2ã€Golang-çš„ä¸»è¦ç‰¹æ€§ä»‹ç»"><a href="#2ã€Golang-çš„ä¸»è¦ç‰¹æ€§ä»‹ç»" class="headerlink" title="2ã€Golang  çš„ä¸»è¦ç‰¹æ€§ä»‹ç»"></a>2ã€Golang  çš„ä¸»è¦ç‰¹æ€§ä»‹ç»</h3><ul><li>æ•°æ®ç±»å‹å®‰å…¨  å’Œ å†…å­˜å®‰å…¨</li><li>é«˜æ•ˆç‡çš„åƒåœ¾å›æ”¶æœºåˆ¶</li><li>ä»¥éå¸¸ç›´è§‚å’Œæä½ä»£ä»·çš„æ–¹æ¡ˆå®ç°é«˜å¹¶å‘</li><li>å¿«é€Ÿç¼–è¯‘ï¼ˆåŒæ—¶è§£å†³ Cè¯­è¨€ä¸­å¤´æ–‡ä»¶å¤ªå¤šçš„é—®é¢˜ï¼‰</li><li>è·¨å¹³å°æ€§ï¼Œæ”¯æŒäº¤å‰ç¼–è¯‘</li><li>ä¸ºå¤šæ ¸è®¡ç®—æœºæä¾›é«˜æ€§èƒ½æå‡çš„æ–¹æ¡ˆ</li><li>æ”¯æŒ UTF-8 ç¼–ç </li></ul>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go ç¼–ç¨‹åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬1ç« ã€éƒ¨ç½² prometheus-operator</title>
    <link href="/2021/08/17/%E7%AC%AC1%E7%AB%A0%E3%80%81%E9%83%A8%E7%BD%B2-prometheus-operator/"/>
    <url>/2021/08/17/%E7%AC%AC1%E7%AB%A0%E3%80%81%E9%83%A8%E7%BD%B2-prometheus-operator/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€éƒ¨ç½²-prometheus-operator"><a href="#ç¬¬1ç« ã€éƒ¨ç½²-prometheus-operator" class="headerlink" title="ç¬¬1ç« ã€éƒ¨ç½² prometheus-operator"></a>ç¬¬1ç« ã€éƒ¨ç½² prometheus-operator</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>K8S ç›‘æ§å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬2ç« ã€k8s éƒ¨ç½² prometheus</title>
    <link href="/2021/08/17/%E7%AC%AC2%E7%AB%A0%E3%80%81k8s-%E9%83%A8%E7%BD%B2-prometheus/"/>
    <url>/2021/08/17/%E7%AC%AC2%E7%AB%A0%E3%80%81k8s-%E9%83%A8%E7%BD%B2-prometheus/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2ç« ã€k8s-éƒ¨ç½²-prometheus"><a href="#ç¬¬2ç« ã€k8s-éƒ¨ç½²-prometheus" class="headerlink" title="ç¬¬2ç« ã€k8s éƒ¨ç½² prometheus"></a>ç¬¬2ç« ã€k8s éƒ¨ç½² prometheus</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>K8S ç›‘æ§å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬4ç« ã€k8s éƒ¨ç½² metrics-server</title>
    <link href="/2021/08/17/%E7%AC%AC4%E7%AB%A0%E3%80%81k8s-%E9%83%A8%E7%BD%B2-metrics-server/"/>
    <url>/2021/08/17/%E7%AC%AC4%E7%AB%A0%E3%80%81k8s-%E9%83%A8%E7%BD%B2-metrics-server/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬4ç« ã€k8s-éƒ¨ç½²-metrics-server"><a href="#ç¬¬4ç« ã€k8s-éƒ¨ç½²-metrics-server" class="headerlink" title="ç¬¬4ç« ã€k8s éƒ¨ç½² metrics-server"></a>ç¬¬4ç« ã€k8s éƒ¨ç½² metrics-server</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>K8S ç›‘æ§å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬3ç« ã€k8s éƒ¨ç½² kube-state-metrics</title>
    <link href="/2021/08/16/%E7%AC%AC3%E7%AB%A0%E3%80%81k8s-%E9%83%A8%E7%BD%B2-kube-state-metrics/"/>
    <url>/2021/08/16/%E7%AC%AC3%E7%AB%A0%E3%80%81k8s-%E9%83%A8%E7%BD%B2-kube-state-metrics/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬3ç« ã€k8s-éƒ¨ç½²-kube-state-metrics"><a href="#ç¬¬3ç« ã€k8s-éƒ¨ç½²-kube-state-metrics" class="headerlink" title="ç¬¬3ç« ã€k8s éƒ¨ç½² kube-state-metrics"></a>ç¬¬3ç« ã€k8s éƒ¨ç½² kube-state-metrics</h1><span id="more"></span><h2 id="ä¸€ã€K8s-yaml-å®‰è£…-kube-state-metrics"><a href="#ä¸€ã€K8s-yaml-å®‰è£…-kube-state-metrics" class="headerlink" title="ä¸€ã€K8s yaml å®‰è£… kube-state-metrics"></a>ä¸€ã€K8s yaml å®‰è£… kube-state-metrics</h2><h3 id="1ã€ç‰ˆæœ¬é€‰æ‹©"><a href="#1ã€ç‰ˆæœ¬é€‰æ‹©" class="headerlink" title="1ã€ç‰ˆæœ¬é€‰æ‹©"></a>1ã€ç‰ˆæœ¬é€‰æ‹©</h3><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210816153327662.png" alt="image-20210816153327662"></p><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>æ ¹æ®å®˜æ–¹ç‰ˆæœ¬çš„æç¤ºï¼Œå½“å‰æœ€æ–°ç‰ˆçš„ metrics ç‰ˆæœ¬<code>(v2.0.0+)</code>æ”¯æŒçš„ä¸º <code>V1.17</code> å’Œ <code>V1.18</code> ä»¥åçš„ k8s ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯ä¹‹å‰çš„ k8s ç‰ˆæœ¬åˆ™é€‰ç”¨ <code>v1.9.8</code> çš„ metrics ç‰ˆæœ¬ï¼Œå¹¶ä¸”å½“å‰ 1.9.x çš„å‘å¸ƒç‰ˆæœ¬å·²ç»å‡çº§åˆ°äº†æœ€æ–°çš„ v1.9.8 çš„æœ€æ–°ç‰ˆæœ¬äº†ã€‚</p><p><a href="https://github.com/kubernetes/kube-state-metrics/tree/release-1.9/examples/standard">yaml æ–‡ä»¶ä¸‹è½½åœ°å€</a></p><p>ç”±äºæœ¬æ–‡æ‰€å± k8s ç‰ˆæœ¬ä¸º <code>V1.15</code> ï¼Œ <code>v1.9.8</code> çš„ kube-state-metricsï¼Œå¯¹äºå…¶å¹¶ä¸èƒ½å…¼å®¹ï¼Œå› ä¸º v1.15 ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æŸäº› API å°šå±äº Beta ç‰ˆæœ¬ï¼Œä¾‹å¦‚: <strong><code>admissionregistration</code></strong> </p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210823162144898.png" alt="v1.9.7ç‰ˆæœ¬çš„æ¦‚å¿µ"></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210823145521128.png" alt="image-20210823145521128"></p><p>è€Œ v1.9.8 è°ƒç”¨æ—¶ä½¿ç”¨çš„æ˜¯æ­£å¼ç‰ˆæœ¬ï¼Œå› æ­¤å°±å°±ä¼šå¯¼è‡´é—®é¢˜ï¼Œå› æ­¤éœ€è¦å¯¹è¯¥APIè¿›è¡Œä¸€å®šçš„ä¿®æ”¹ï¼Œä»¥å…¼å®¹ 1.15 è€ç‰ˆæœ¬çš„ K8S APIã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210823145901994.png" alt="kube-state-metrics 1.9.8 æºç "></p><p><strong>ç¬”è€…ä¿®æ”¹å®Œåçš„docker é•œåƒåœ°å€:</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull tareya/kube-state-metrics:v1.9.8-for-k8s1.15<br></code></pre></td></tr></table></figure></blockquote><h3 id="2ã€ä¸‹è½½-yaml"><a href="#2ã€ä¸‹è½½-yaml" class="headerlink" title="2ã€ä¸‹è½½ yaml"></a>2ã€ä¸‹è½½ yaml</h3><h4 id="1ï¼‰åˆ›å»ºç›®å½•"><a href="#1ï¼‰åˆ›å»ºç›®å½•" class="headerlink" title="1ï¼‰åˆ›å»ºç›®å½•"></a>1ï¼‰åˆ›å»ºç›®å½•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /data/sofeware/kube-state-metrics<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰æ‰¹é‡ä¸‹è½½"><a href="#2ï¼‰æ‰¹é‡ä¸‹è½½" class="headerlink" title="2ï¼‰æ‰¹é‡ä¸‹è½½"></a>2ï¼‰æ‰¹é‡ä¸‹è½½</h4><blockquote><p>ğŸš© ä½¿ç”¨ cdn åŠ é€Ÿåœ°å€ä¸‹è½½</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">for file in cluster-role-binding.yaml cluster-role.yaml deployment.yaml service-account.yaml service.yaml;do wget -c https://cdn.jsdelivr.net/gh/kubernetes/kube-state-metrics@release-1.9/examples/standard/$file -O /data/softwares/kube-state-metrics/$file;done<br></code></pre></td></tr></table></figure><p>ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶ç›®å½•ç»“æ„å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">/data/softwares/kube-state-metrics/<br>â”œâ”€â”€ cluster-role-binding.yaml<br>â”œâ”€â”€ cluster-role.yaml<br>â”œâ”€â”€ deployment.yaml<br>â”œâ”€â”€ service-account.yaml<br>â””â”€â”€ service.yaml<br></code></pre></td></tr></table></figure><h3 id="3ã€å…·ä½“é…ç½®"><a href="#3ã€å…·ä½“é…ç½®" class="headerlink" title="3ã€å…·ä½“é…ç½®"></a>3ã€å…·ä½“é…ç½®</h3><h4 id="1ï¼‰service-account-yaml"><a href="#1ï¼‰service-account-yaml" class="headerlink" title="1ï¼‰service-account.yaml"></a>1ï¼‰service-account.yaml</h4><p>æ–‡ä»¶è·¯å¾„:<code> /data/softwares/kube-state-metrics/service-account.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kube-state-metrics</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kube-state-metrics</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v1.9.8</span><br></code></pre></td></tr></table></figure><h4 id="2ï¼‰cluster-role-yaml"><a href="#2ï¼‰cluster-role-yaml" class="headerlink" title="2ï¼‰cluster-role.yaml"></a>2ï¼‰cluster-role.yaml</h4><p>æ–‡ä»¶è·¯å¾„:<code> /data/softwares/kube-state-metrics/cluster-role.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kube-state-metrics</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kube-state-metrics</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v1.9.8</span><br><span class="hljs-attr">rules:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">configmaps</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">secrets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">nodes</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">pods</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">services</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">resourcequotas</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">replicationcontrollers</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">limitranges</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">persistentvolumeclaims</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">persistentvolumes</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">namespaces</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">endpoints</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">extensions</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">daemonsets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">deployments</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">replicasets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ingresses</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">apps</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">statefulsets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">daemonsets</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">deployments</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">replicasets</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">batch</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">cronjobs</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">jobs</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">autoscaling</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">horizontalpodautoscalers</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">authentication.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">tokenreviews</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">authorization.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">subjectaccessreviews</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">policy</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">poddisruptionbudgets</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">certificates.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">certificatesigningrequests</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">storage.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">storageclasses</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">volumeattachments</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">admissionregistration.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">mutatingwebhookconfigurations</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">validatingwebhookconfigurations</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">networking.k8s.io</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">networkpolicies</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰cluster-role-binding-yaml"><a href="#3ï¼‰cluster-role-binding-yaml" class="headerlink" title="3ï¼‰cluster-role-binding.yaml"></a>3ï¼‰cluster-role-binding.yaml</h4><p>æ–‡ä»¶è·¯å¾„:<code> /data/softwares/kube-state-metrics/cluster-role-binding.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kube-state-metrics</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kube-state-metrics</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v1.9.8</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kube-state-metrics</span><br><span class="hljs-attr">subjects:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">kube-state-metrics</span><br>    <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br></code></pre></td></tr></table></figure><h4 id="4ï¼‰service-yaml"><a href="#4ï¼‰service-yaml" class="headerlink" title="4ï¼‰service.yaml"></a>4ï¼‰service.yaml</h4><blockquote><p>ğŸš© å¦‚æœ prometheus éƒ¨ç½²åœ¨ k8s å†…éƒ¨ï¼Œåˆ™éœ€è¦å¼€å¯ prometheus è‡ªåŠ¨å‘ç°åŠŸèƒ½ã€‚</p></blockquote><p>æ–‡ä»¶è·¯å¾„: <code>/data/softwares/kube-state-metrics/service.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kube-state-metrics</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kube-state-metrics</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v1.9.8</span><br>  <span class="hljs-attr">annotations:</span>  <br>   <span class="hljs-attr">prometheus.io/scrape:</span> <span class="hljs-string">&quot;true&quot;</span>       <span class="hljs-comment">##æ·»åŠ æ­¤å‚æ•°ï¼Œå…è®¸prometheusè‡ªåŠ¨å‘ç°</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">ports:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http-metrics</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-string">http-metrics</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">telemetry</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br>    <span class="hljs-attr">targetPort:</span> <span class="hljs-string">telemetry</span><br>    <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kube-state-metrics</span><br></code></pre></td></tr></table></figure><h4 id="5ï¼‰deployment-yaml"><a href="#5ï¼‰deployment-yaml" class="headerlink" title="5ï¼‰deployment.yaml"></a>5ï¼‰deployment.yaml</h4><p>æ–‡ä»¶è·¯å¾„:<code> /data/softwares/kube-state-metrics/deployment.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kube-state-metrics</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kube-state-metrics</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v1.9.8</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kube-state-metrics</span><br>  <span class="hljs-attr">strategy:</span><br>    <span class="hljs-attr">rollingUpdate:</span><br>      <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">25</span><span class="hljs-string">%</span><br>      <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">25</span><span class="hljs-string">%</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">kube-state-metrics</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">kube-state-metrics</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">tareya/kube-state-metrics:v1.9.8-for-k8s1.15</span><br>        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">http-metrics</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8081</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">telemetry</span><br>        <span class="hljs-attr">livenessProbe:</span><br>          <span class="hljs-attr">httpGet:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/healthz</span><br>            <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span><br>          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span><br>        <span class="hljs-attr">readinessProbe:</span><br>          <span class="hljs-attr">httpGet:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>            <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br>          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span><br>          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span><br>        <span class="hljs-attr">resources:</span><br>          <span class="hljs-attr">limits:</span><br>            <span class="hljs-attr">cpu:</span> <span class="hljs-string">2048m</span><br>            <span class="hljs-attr">memory:</span> <span class="hljs-string">2048Mi</span><br>          <span class="hljs-attr">requests:</span><br>            <span class="hljs-attr">cpu:</span> <span class="hljs-string">2048Mim</span><br>            <span class="hljs-attr">memory:</span> <span class="hljs-string">2048MiMi</span><br>      <span class="hljs-attr">nodeSelector:</span><br>        <span class="hljs-attr">kubernetes.io/os:</span> <span class="hljs-string">linux</span><br>      <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">kube-state-metrics</span><br></code></pre></td></tr></table></figure><h3 id="4ã€å‘å¸ƒåº”ç”¨"><a href="#4ã€å‘å¸ƒåº”ç”¨" class="headerlink" title="4ã€å‘å¸ƒåº”ç”¨"></a>4ã€å‘å¸ƒåº”ç”¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /data/sofeware/kube-state-metrics &amp;&amp; \<br>kubectl apply -f ./<br></code></pre></td></tr></table></figure><h3 id="5ã€grafana-é¢æ¿é›†æˆ"><a href="#5ã€grafana-é¢æ¿é›†æˆ" class="headerlink" title="5ã€grafana é¢æ¿é›†æˆ"></a>5ã€grafana é¢æ¿é›†æˆ</h3><blockquote><p>Create ==&gt; Import ==&gt; 8588</p></blockquote><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210823152852054.png" alt="image-20210823152852054"></p><h4 id="1ï¼‰æ•´ä½“ä½¿ç”¨ç‡å’Œ-nodeã€pod-CPU-ä½¿ç”¨æƒ…å†µ"><a href="#1ï¼‰æ•´ä½“ä½¿ç”¨ç‡å’Œ-nodeã€pod-CPU-ä½¿ç”¨æƒ…å†µ" class="headerlink" title="1ï¼‰æ•´ä½“ä½¿ç”¨ç‡å’Œ nodeã€pod CPU ä½¿ç”¨æƒ…å†µ"></a>1ï¼‰æ•´ä½“ä½¿ç”¨ç‡å’Œ nodeã€pod CPU ä½¿ç”¨æƒ…å†µ</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210823153053012.png" alt="image-20210823153053012"></p><h4 id="2ï¼‰nodeã€pod-å†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#2ï¼‰nodeã€pod-å†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="2ï¼‰nodeã€pod å†…å­˜ä½¿ç”¨æƒ…å†µ"></a>2ï¼‰nodeã€pod å†…å­˜ä½¿ç”¨æƒ…å†µ</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210823153252971.png" alt="image-20210823153252971"></p><h4 id="3ï¼‰nodeã€pod-ç½‘ç»œ-I-O-ä½¿ç”¨æƒ…å†µ"><a href="#3ï¼‰nodeã€pod-ç½‘ç»œ-I-O-ä½¿ç”¨æƒ…å†µ" class="headerlink" title="3ï¼‰nodeã€pod ç½‘ç»œ I/O ä½¿ç”¨æƒ…å†µ"></a>3ï¼‰nodeã€pod ç½‘ç»œ I/O ä½¿ç”¨æƒ…å†µ</h4><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210823155409078.png" alt="image-20210823155409078"></p><h2 id="äºŒã€Helm3-å®‰è£…-kube-state-metrics"><a href="#äºŒã€Helm3-å®‰è£…-kube-state-metrics" class="headerlink" title="äºŒã€Helm3 å®‰è£… kube-state-metrics"></a>äºŒã€Helm3 å®‰è£… kube-state-metrics</h2><p><a href="https://github.com/Tareya/kube-state-metrics-helm">chart githubåœ°å€</a></p><h3 id="1ã€è‡ªå®šä¹‰-chart"><a href="#1ã€è‡ªå®šä¹‰-chart" class="headerlink" title="1ã€è‡ªå®šä¹‰ chart"></a>1ã€è‡ªå®šä¹‰ chart</h3><h4 id="1ï¼‰åˆ›å»º-chart"><a href="#1ï¼‰åˆ›å»º-chart" class="headerlink" title="1ï¼‰åˆ›å»º chart"></a>1ï¼‰åˆ›å»º chart</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /data/softwares &amp;&amp; \<br>helm create kube-state-metrics<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ é™¤æ— ç”¨æ¨¡ç‰ˆ"><a href="#2ï¼‰åˆ é™¤æ— ç”¨æ¨¡ç‰ˆ" class="headerlink" title="2ï¼‰åˆ é™¤æ— ç”¨æ¨¡ç‰ˆ"></a>2ï¼‰åˆ é™¤æ— ç”¨æ¨¡ç‰ˆ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /data/softwares/kube-state-metrics &amp;&amp; \<br>rm templates/&#123;hpa.yaml,ingress.yaml&#125;<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰è‡ªå®šä¹‰æ¨¡ç‰ˆæ–‡ä»¶"><a href="#3ï¼‰è‡ªå®šä¹‰æ¨¡ç‰ˆæ–‡ä»¶" class="headerlink" title="3ï¼‰è‡ªå®šä¹‰æ¨¡ç‰ˆæ–‡ä»¶"></a>3ï¼‰è‡ªå®šä¹‰æ¨¡ç‰ˆæ–‡ä»¶</h4><h5 id="1-ServiceAccount"><a href="#1-ServiceAccount" class="headerlink" title="1. ServiceAccount"></a>1. ServiceAccount</h5><p>ä¿®æ”¹æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„: <code>/data/softwares/kube-state-metrics/templates/serviceaccount.yaml </code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml">&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.serviceAccount.create</span> <span class="hljs-string">-</span>&#125;&#125;<br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.serviceAccountName&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>  <span class="hljs-attr">namespace:</span> &#123;&#123; <span class="hljs-string">.Values.namespace</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.labels</span> &#125;&#125;<br>  <span class="hljs-attr">labels:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.serviceAccount.annotations</span> &#125;&#125;<br>  <span class="hljs-attr">annotations:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="2-ClusterRole"><a href="#2-ClusterRole" class="headerlink" title="2. ClusterRole"></a>2. ClusterRole</h5><p>æ–°å»ºæ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„: <code>/data/softwares/kube-state-metrics/templates/clusterrole.yaml</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span>&#125;&#125;<br>  <span class="hljs-attr">namespace:</span> &#123;&#123; <span class="hljs-string">.Values.namespace</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.labels</span> &#125;&#125;<br>  <span class="hljs-attr">labels:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><span class="hljs-attr">rules:</span><br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.certificatesigningrequests</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;certificates.k8s.io&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">certificatesigningrequests</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.configmaps</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">configmaps</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.cronjobs</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;batch&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">cronjobs</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.daemonsets</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;extensions&quot;</span>, <span class="hljs-string">&quot;apps&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">daemonsets</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.deployments</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;extensions&quot;</span>, <span class="hljs-string">&quot;apps&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">deployments</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.endpoints</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">endpoints</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.horizontalpodautoscalers</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;autoscaling&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">horizontalpodautoscalers</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.ingresses</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;extensions&quot;</span>, <span class="hljs-string">&quot;networking.k8s.io&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">ingresses</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.jobs</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;batch&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">jobs</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.limitranges</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">limitranges</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.mutatingwebhookconfigurations</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;admissionregistration.k8s.io&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">mutatingwebhookconfigurations</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.namespaces</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">namespaces</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.networkpolicies</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;networking.k8s.io&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">networkpolicies</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.nodes</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">nodes</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.persistentvolumeclaims</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">persistentvolumeclaims</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.persistentvolumes</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">persistentvolumes</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.poddisruptionbudgets</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;policy&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">poddisruptionbudgets</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.pods</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">pods</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.replicasets</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;extensions&quot;</span>, <span class="hljs-string">&quot;apps&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">replicasets</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.replicationcontrollers</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">replicationcontrollers</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.resourcequotas</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">resourcequotas</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.secrets</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">secrets</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.services</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">services</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.statefulsets</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;apps&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">statefulsets</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.storageclasses</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;storage.k8s.io&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">storageclasses</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.validatingwebhookconfigurations</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;admissionregistration.k8s.io&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">validatingwebhookconfigurations</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.volumeattachments</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;storage.k8s.io&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">volumeattachments</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.verticalpodautoscalers</span> &#125;&#125;<br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;autoscaling.k8s.io&quot;</span>]<br>  <span class="hljs-attr">resources:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">verticalpodautoscalers</span><br>  <span class="hljs-attr">verbs:</span> [<span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>]<br>&#123;&#123; <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="3-ClusterRoleBinding"><a href="#3-ClusterRoleBinding" class="headerlink" title="3. ClusterRoleBinding"></a>3. ClusterRoleBinding</h5><p>æ–°å»ºæ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„: <code>/data/softwares/kube-state-metrics/templates/clusterrolebinding.yaml</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml">&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">and</span> <span class="hljs-string">.Values.rbac.create</span> <span class="hljs-string">.Values.rbac.useClusterRole</span> <span class="hljs-string">-</span>&#125;&#125;<br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span>&#125;&#125;<br>  <span class="hljs-attr">namespace:</span> &#123;&#123; <span class="hljs-string">.Values.namespace</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.labels</span> &#125;&#125;<br>  <span class="hljs-attr">labels:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.rbac.useExistingRole</span> &#125;&#125;<br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.rbac.useExistingRole</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">else</span> &#125;&#125;<br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><span class="hljs-attr">subjects:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>  <span class="hljs-attr">namespace:</span> &#123;&#123; <span class="hljs-string">.Values.namespace</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> <span class="hljs-string">-</span>&#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="4-Service"><a href="#4-Service" class="headerlink" title="4. Service"></a>4. Service</h5><p>ä¿®æ”¹æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„:  <code>/data/softwares/kube-state-metrics/templates/service.yaml </code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>  <span class="hljs-attr">namespace:</span> &#123;&#123; <span class="hljs-string">.Values.namespace</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.labels</span> &#125;&#125;<br>  <span class="hljs-attr">labels:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.service.annotations</span> &#125;&#125;<br>  <span class="hljs-attr">annotations:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> &#123;&#123; <span class="hljs-string">.Values.service.type</span> &#125;&#125;<br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.service.http.name</span> &#125;&#125;<br>      <span class="hljs-attr">port:</span> &#123;&#123; <span class="hljs-string">.Values.service.http.port</span> &#125;&#125;<br>      <span class="hljs-attr">targetPort:</span> &#123;&#123; <span class="hljs-string">.Values.service.http.name</span> &#125;&#125;<br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.service.telemetry.name</span> &#125;&#125;<br>      <span class="hljs-attr">port:</span> &#123;&#123; <span class="hljs-string">.Values.service.telemetry.port</span> &#125;&#125;<br>      <span class="hljs-attr">targetPort:</span> &#123;&#123; <span class="hljs-string">.Values.service.telemetry.name</span> &#125;&#125;<br>      <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">k8s-app:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="5-Deployment"><a href="#5-Deployment" class="headerlink" title="5. Deployment"></a>5. Deployment</h5><p>ä¿®æ”¹æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„:  <code>/data/softwares/kube-state-metrics/templates/deployment.yaml </code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.autosharding.enabled</span> &#125;&#125;<br><span class="hljs-attr">kind:</span> <span class="hljs-string">StatefulSet</span><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">else</span> &#125;&#125;<br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>  <span class="hljs-attr">namespace:</span> &#123;&#123; <span class="hljs-string">.Values.namespace</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.labels</span> &#125;&#125;<br>  <span class="hljs-attr">labels:</span><br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">4</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.customLabels</span> &#125;&#125;<br>&#123;&#123; <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.customLabels</span> <span class="hljs-string">|</span> <span class="hljs-string">indent</span> <span class="hljs-number">4</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> &#123;&#123; <span class="hljs-string">.Values.replicas</span> &#125;&#125;<br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">k8s-app:</span> &#123;&#123; <span class="hljs-string">template</span> <span class="hljs-string">&quot;kube-state-metrics.name&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>  <span class="hljs-attr">strategy:</span><br>    <span class="hljs-attr">rollingUpdate:</span><br>      <span class="hljs-attr">maxSurge:</span> <span class="hljs-number">25</span><span class="hljs-string">%</span><br>      <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">25</span><span class="hljs-string">%</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.autosharding.enabled</span> &#125;&#125;<br>  <span class="hljs-attr">serviceName:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.fullname&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>  <span class="hljs-attr">volumeClaimTemplates:</span> []<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">k8s-app:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.name&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.customLabels</span> &#125;&#125;<br>&#123;&#123; <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.customLabels</span> <span class="hljs-string">|</span> <span class="hljs-string">indent</span> <span class="hljs-number">8</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.podAnnotations</span> &#125;&#125;<br>      <span class="hljs-attr">annotations:</span><br>&#123;&#123; <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.podAnnotations</span> <span class="hljs-string">|</span> <span class="hljs-string">indent</span> <span class="hljs-number">8</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">serviceAccountName:</span> &#123;&#123; <span class="hljs-string">include</span> <span class="hljs-string">&quot;kube-state-metrics.serviceAccountName&quot;</span> <span class="hljs-string">.</span> &#125;&#125;<br>      <span class="hljs-attr">nodeSelector:</span><br>        <span class="hljs-attr">kubernetes.io/os:</span> <span class="hljs-string">linux</span><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.imagePullSecrets</span> &#125;&#125;<br>      <span class="hljs-attr">imagePullSecrets:</span><br>&#123;&#123; <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.imagePullSecrets</span> <span class="hljs-string">|</span> <span class="hljs-string">indent</span> <span class="hljs-number">8</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;        <br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.securityContext.enabled</span> &#125;&#125;<br>      <span class="hljs-attr">securityContext:</span><br>        <span class="hljs-attr">fsGroup:</span> &#123;&#123; <span class="hljs-string">.Values.securityContext.fsGroup</span> &#125;&#125;<br>        <span class="hljs-attr">runAsGroup:</span> &#123;&#123; <span class="hljs-string">.Values.securityContext.runAsGroup</span> &#125;&#125;<br>        <span class="hljs-attr">runAsUser:</span> &#123;&#123; <span class="hljs-string">.Values.securityContext.runAsUser</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.priorityClassName</span> &#125;&#125;<br>      <span class="hljs-attr">priorityClassName:</span> &#123;&#123; <span class="hljs-string">.Values.priorityClassName</span> &#125;&#125;<br>    &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span> &#125;&#125;<br>        <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; .Values.image.repository &#125;&#125;</span>:<span class="hljs-template-variable">&#123;&#123; .Values.image.tag &#125;&#125;</span>&quot;</span><br>        <span class="hljs-attr">imagePullPolicy:</span> &#123;&#123; <span class="hljs-string">.Values.image.pullPolicy</span> &#125;&#125;<br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> &#123;&#123; <span class="hljs-string">.Values.service.http.port</span> &#125;&#125;<br>          <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.service.http.name</span> &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> &#123;&#123; <span class="hljs-string">.Values.service.telemetry.port</span> &#125;&#125;<br>          <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.service.telemetry.name</span> &#125;&#125;<br>        <span class="hljs-attr">livenessProbe:</span><br>          <span class="hljs-attr">httpGet:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/healthz</span><br>            <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span><br>          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span><br>        <span class="hljs-attr">readinessProbe:</span><br>          <span class="hljs-attr">httpGet:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>            <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span><br>          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span>      <br><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.autosharding.enabled</span> &#125;&#125;<br>        <span class="hljs-attr">env:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">POD_NAME</span><br>          <span class="hljs-attr">valueFrom:</span><br>            <span class="hljs-attr">fieldRef:</span><br>              <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">metadata.name</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">POD_NAMESPACE</span><br>          <span class="hljs-attr">valueFrom:</span><br>            <span class="hljs-attr">fieldRef:</span><br>              <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">metadata.namespace</span><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>        <span class="hljs-attr">args:</span><br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.extraArgs</span>  &#125;&#125;<br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">range</span> <span class="hljs-string">.Values.extraArgs</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> &#123;&#123; <span class="hljs-string">.</span> &#125;&#125;<br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.certificatesigningrequests</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=certificatesigningrequests</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.configmaps</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=configmaps</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.cronjobs</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=cronjobs</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.daemonsets</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=daemonsets</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.deployments</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=deployments</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.endpoints</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=endpoints</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.horizontalpodautoscalers</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=horizontalpodautoscalers</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.ingresses</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=ingresses</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.jobs</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=jobs</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.limitranges</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=limitranges</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.mutatingwebhookconfigurations</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=mutatingwebhookconfigurations</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.namespaces</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=namespaces</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.networkpolicies</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=networkpolicies</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.nodes</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=nodes</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.persistentvolumeclaims</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=persistentvolumeclaims</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.persistentvolumes</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=persistentvolumes</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.poddisruptionbudgets</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=poddisruptionbudgets</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.pods</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=pods</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.replicasets</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=replicasets</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.replicationcontrollers</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=replicationcontrollers</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.resourcequotas</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=resourcequotas</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.secrets</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=secrets</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.services</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=services</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.statefulsets</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=statefulsets</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.storageclasses</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=storageclasses</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.validatingwebhookconfigurations</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=validatingwebhookconfigurations</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.verticalpodautoscalers</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=verticalpodautoscalers</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123;  <span class="hljs-string">if</span> <span class="hljs-string">.Values.collectors.volumeattachments</span>  &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--collectors=volumeattachments</span><br>&#123;&#123;  <span class="hljs-string">end</span>  &#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.namespace</span> &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--namespace=&#123;&#123;</span> <span class="hljs-string">.Values.namespace</span> <span class="hljs-string">|</span> <span class="hljs-string">join</span> <span class="hljs-string">&quot;,&quot;</span> <span class="hljs-string">&#125;&#125;</span><br>&#123;&#123; <span class="hljs-string">end</span> &#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.autosharding.enabled</span> &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--pod=$(POD_NAME)</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--pod-namespace=$(POD_NAMESPACE)</span><br>&#123;&#123; <span class="hljs-string">end</span> &#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.kubeconfig.enabled</span> &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--kubeconfig=/opt/k8s/.kube/config</span><br>&#123;&#123; <span class="hljs-string">end</span> &#125;&#125;<br>&#123;&#123; <span class="hljs-string">if</span> <span class="hljs-string">.Values.selfMonitor.telemetryHost</span> &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--telemetry-host=&#123;&#123;</span> <span class="hljs-string">.Values.selfMonitor.telemetryHost</span> <span class="hljs-string">&#125;&#125;</span><br>&#123;&#123; <span class="hljs-string">end</span> &#125;&#125;<br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--telemetry-port=8081</span><br><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.resources</span> &#125;&#125;<br>        <span class="hljs-attr">resources:</span><br>&#123;&#123; <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.resources</span> <span class="hljs-string">|</span> <span class="hljs-string">indent</span> <span class="hljs-number">10</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.affinity</span> &#125;&#125;<br>      <span class="hljs-attr">affinity:</span><br>&#123;&#123; <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.affinity</span> <span class="hljs-string">|</span> <span class="hljs-string">indent</span> <span class="hljs-number">8</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br><br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">.Values.tolerations</span> &#125;&#125;<br>      <span class="hljs-attr">tolerations:</span><br>&#123;&#123; <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.tolerations</span> <span class="hljs-string">|</span> <span class="hljs-string">indent</span> <span class="hljs-number">8</span> &#125;&#125;<br>&#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="6-Chart-yaml"><a href="#6-Chart-yaml" class="headerlink" title="6. Chart.yaml"></a>6. Chart.yaml</h5><p>ä¿®æ”¹æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„:  <code>/data/softwares/kube-state-metrics/Chart.yaml </code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">apiVersion: v2<br>name: kube-state-metrics<br>type: application<br>version: 1.0.0<br>appVersion: &quot;1.9.8&quot;<br></code></pre></td></tr></table></figure><h5 id="7-values-yaml"><a href="#7-values-yaml" class="headerlink" title="7. values.yaml"></a>7. values.yaml</h5><p>ä¿®æ”¹æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„:  <code>/data/softwares/kube-state-metrics/values.yaml </code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">replicaCount:</span> <span class="hljs-number">1</span><br><br><span class="hljs-attr">image:</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">tareya/kube-state-metrics</span><br>  <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>  <span class="hljs-comment"># Overrides the image tag whose default is the chart appVersion.</span><br>  <span class="hljs-attr">tag:</span> <span class="hljs-string">&quot;v1.9.8-for-k8s1.15&quot;</span><br><br><span class="hljs-attr">namespace:</span> <span class="hljs-string">&quot;kube-system&quot;</span><br><br><span class="hljs-attr">labels:</span> &#123;<br>  <span class="hljs-attr">&quot;k8s-app&quot;:</span> <span class="hljs-string">&quot;kube-state-metrics&quot;</span>,<br>  <span class="hljs-attr">&quot;version&quot;:</span> <span class="hljs-string">&quot;v1.9.8&quot;</span><br>&#125;<br><br><span class="hljs-attr">imagePullSecrets:</span> []<br><span class="hljs-attr">nameOverride:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">fullnameOverride:</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-attr">serviceAccount:</span><br>  <span class="hljs-comment"># Specifies whether a service account should be created</span><br>  <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># Annotations to add to the service account</span><br>  <span class="hljs-attr">annotations:</span> &#123;&#125;<br>  <span class="hljs-comment"># The name of the service account to use.</span><br>  <span class="hljs-comment"># If not set and create is true, a name is generated using the fullname template</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;kube-state-metrics&quot;</span><br><br><br><span class="hljs-attr">rbac:</span><br>  <span class="hljs-comment"># If true, create &amp; use RBAC resources</span><br>  <span class="hljs-attr">create:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">useClusterRole:</span> <span class="hljs-literal">true</span><br>  <br><span class="hljs-attr">podAnnotations:</span> &#123;&#125;<br><br><span class="hljs-attr">podSecurityContext:</span> &#123;&#125;<br>  <span class="hljs-comment"># fsGroup: 2000</span><br><br><span class="hljs-attr">securityContext:</span> &#123;&#125;<br>  <span class="hljs-comment"># capabilities:</span><br>  <span class="hljs-comment">#   drop:</span><br>  <span class="hljs-comment">#   - ALL</span><br>  <span class="hljs-comment"># readOnlyRootFilesystem: true</span><br>  <span class="hljs-comment"># runAsNonRoot: true</span><br>  <span class="hljs-comment"># runAsUser: 1000</span><br><br><span class="hljs-attr">service:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br><br>  <span class="hljs-attr">http:</span> <br>    <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;http-metrics&quot;</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>  <span class="hljs-attr">telemetry:</span> <br>    <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;telemetry&quot;</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br><br>  <span class="hljs-attr">annotations:</span> &#123;<br>    <span class="hljs-attr">&quot;prometheus.io/scrape&quot;:</span> <span class="hljs-string">&quot;true&quot;</span><br>  &#125;<br><br><span class="hljs-attr">customLabels:</span> &#123;&#125;<br><br><span class="hljs-attr">resources:</span> <br>  <span class="hljs-comment"># We usually recommend not to specify default resources and to leave this as a conscious</span><br>  <span class="hljs-comment"># choice for the user. This also increases chances charts run on environments with little</span><br>  <span class="hljs-comment"># resources, such as Minikube. If you do want to specify resources, uncomment the following</span><br>  <span class="hljs-comment"># lines, adjust them as necessary, and remove the curly braces after &#x27;resources:&#x27;.</span><br>  <span class="hljs-attr">limits:</span><br>    <span class="hljs-attr">cpu:</span> <span class="hljs-string">1024m</span><br>    <span class="hljs-attr">memory:</span> <span class="hljs-string">2048Mi</span><br>  <span class="hljs-attr">requests:</span><br>    <span class="hljs-attr">cpu:</span> <span class="hljs-string">1024m</span><br>    <span class="hljs-attr">memory:</span> <span class="hljs-string">2048Mi</span><br><br><span class="hljs-attr">autosharding:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-attr">ingress:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-attr">kubeconfig:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-attr">selfMonitor:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <br><span class="hljs-attr">tolerations:</span> []<br><br><span class="hljs-attr">affinity:</span><br>  <span class="hljs-attr">podAntiAffinity:</span><br>    <span class="hljs-attr">requiredDuringSchedulingIgnoredDuringExecution:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">labelSelector:</span><br>        <span class="hljs-attr">matchExpressions:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">app</span><br>          <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span><br>          <span class="hljs-attr">values:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">exterior-gateway</span><br>      <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">&quot;kubernetes.io/hostname&quot;</span><br><br><span class="hljs-attr">collectors:</span><br>  <span class="hljs-attr">certificatesigningrequests:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">configmaps:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">cronjobs:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">daemonsets:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">deployments:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">endpoints:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">horizontalpodautoscalers:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">ingresses:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">jobs:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">limitranges:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">mutatingwebhookconfigurations:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">namespaces:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">networkpolicies:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">nodes:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">persistentvolumeclaims:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">persistentvolumes:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">poddisruptionbudgets:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">pods:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">replicasets:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">replicationcontrollers:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">resourcequotas:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">secrets:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">services:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">statefulsets:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">storageclasses:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">validatingwebhookconfigurations:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">verticalpodautoscalers:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">volumeattachments:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="2ã€å‘å¸ƒåº”ç”¨"><a href="#2ã€å‘å¸ƒåº”ç”¨" class="headerlink" title="2ã€å‘å¸ƒåº”ç”¨"></a>2ã€å‘å¸ƒåº”ç”¨</h3><h4 id="1ï¼‰éƒ¨ç½²"><a href="#1ï¼‰éƒ¨ç½²" class="headerlink" title="1ï¼‰éƒ¨ç½²"></a>1ï¼‰éƒ¨ç½²</h4><blockquote><p>ğŸš© æœ¬æ–‡ä½¿ç”¨ helm3 è¿›è¡Œç®¡ç†ï¼Œhelm3 ä¸­ä¼šå°† release çš„åå­—ç‹¬ç«‹åœ¨å„ä¸ªå‘½åç©ºé—´ä¸­ï¼Œå¯ä»¥æ›´æ¸…æ™°çš„è¿›è¡Œç®¡ç†ï¼Œkube-state-metrics æ˜¯ K8S ç»„ä»¶ï¼Œæ•…å°†å…¶æ”¾åˆ° <code>kube-system</code> è¿™ä¸ª namespace ä¸­</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install -n kube-system kube-state-metrics /data/softwares/kube-state-metrics<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰æŸ¥çœ‹å‘å¸ƒç‰ˆæœ¬"><a href="#2ï¼‰æŸ¥çœ‹å‘å¸ƒç‰ˆæœ¬" class="headerlink" title="2ï¼‰æŸ¥çœ‹å‘å¸ƒç‰ˆæœ¬"></a>2ï¼‰æŸ¥çœ‹å‘å¸ƒç‰ˆæœ¬</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm list -n kube-system<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210824141007622.png" alt="image-20210824141007622"></p><h4 id="3ï¼‰æ£€æŸ¥å®¹å™¨æƒ…å†µ"><a href="#3ï¼‰æ£€æŸ¥å®¹å™¨æƒ…å†µ" class="headerlink" title="3ï¼‰æ£€æŸ¥å®¹å™¨æƒ…å†µ"></a>3ï¼‰æ£€æŸ¥å®¹å™¨æƒ…å†µ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl describe pod -n kube-system `kubectl get pod -n kube-system|awk &#x27;NR&gt;1&#123;print $1&#125;&#x27;|grep kube-state-metrics`<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210824141436622.png" alt="image-20210824141436622"></p>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>K8S ç›‘æ§å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitlab(Runner)+Dokcerfile+K8S(MiniKube)å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²</title>
    <link href="/2021/08/10/Gitlab-Runner-Dokcerfile-K8S-MiniKube-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/"/>
    <url>/2021/08/10/Gitlab-Runner-Dokcerfile-K8S-MiniKube-%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h1 id="Gitlab-Runner-Dockerfile-K8S-Minikube-å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#Gitlab-Runner-Dockerfile-K8S-Minikube-å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="Gitlab(Runner) + Dockerfile + K8S(Minikube) å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²"></a>Gitlab(Runner) + Dockerfile + K8S(Minikube) å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²</h1><span id="more"></span><h2 id="ä¸€ã€Minikube-é…ç½®"><a href="#ä¸€ã€Minikube-é…ç½®" class="headerlink" title="ä¸€ã€Minikube é…ç½®"></a>ä¸€ã€Minikube é…ç½®</h2><blockquote><p>ğŸŒˆ minikube å®‰è£…ä½¿ç”¨è§<br><a href="">Minikube å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</a></p></blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œminikube çš„ apiserver æ˜¯æ— æ³•é€šè¿‡å¤–éƒ¨è®¿é—®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ gitlab å¦‚æœè¦è®¿é—® minikube å°±éœ€è¦å¼€å¯ä»£ç†ï¼Œä½¿ minikube çš„ apiserver å¯ä»¥è¢«å¤–éƒ¨è®¿é—®ã€‚</p><h3 id="1ã€é…ç½®-apiserver-ä»£ç†"><a href="#1ã€é…ç½®-apiserver-ä»£ç†" class="headerlink" title="1ã€é…ç½® apiserver ä»£ç†"></a>1ã€é…ç½® apiserver ä»£ç†</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl proxy --port=45396 --address=0.0.0.0 --accept-hosts=&quot;^.*&quot;<br></code></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜:</p><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>â€“port</td><td>æœ¬åœ°ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ 8001</td></tr><tr><td>â€“address</td><td>æœ¬åœ°ç›‘å¬ç½‘å¡åœ°å€ï¼Œå¦‚æœè¦å¤–éƒ¨è®¿é—®ï¼Œå»ºè®®è®¾ä¸º 0.0.0.0ï¼Œå³ç›‘å¬æ‰€æœ‰ç½‘å¡åœ°å€</td></tr><tr><td>â€“accept-hosts</td><td>å…è®¸æ¥å—æ‰€æœ‰ä¸»æœºçš„è¯·æ±‚ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼</td></tr></tbody></table><h2 id="äºŒã€Gitlab-é…ç½®"><a href="#äºŒã€Gitlab-é…ç½®" class="headerlink" title="äºŒã€Gitlab é…ç½®"></a>äºŒã€Gitlab é…ç½®</h2><h3 id="1ã€æ·»åŠ -Kubernetes-é›†ç¾¤"><a href="#1ã€æ·»åŠ -Kubernetes-é›†ç¾¤" class="headerlink" title="1ã€æ·»åŠ  Kubernetes é›†ç¾¤"></a>1ã€æ·»åŠ  Kubernetes é›†ç¾¤</h3><p>![image-20210810170140628](/Users/shenlei/Library/Application Support/typora-user-images/image-20210810170140628.png)</p><h3 id="2ã€é…ç½®-CI-CD"><a href="#2ã€é…ç½®-CI-CD" class="headerlink" title="2ã€é…ç½® CI/CD"></a>2ã€é…ç½® CI/CD</h3><h2 id="ä¸‰ã€Dockerfile"><a href="#ä¸‰ã€Dockerfile" class="headerlink" title="ä¸‰ã€Dockerfile"></a>ä¸‰ã€Dockerfile</h2>]]></content>
    
    
    <categories>
      
      <category>Devops</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Gitlab</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MiniKube å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</title>
    <link href="/2021/08/10/MiniKube-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C/"/>
    <url>/2021/08/10/MiniKube-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E6%89%8B%E5%86%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="MiniKube-å¿«é€Ÿå…¥é—¨æ‰‹å†Œ"><a href="#MiniKube-å¿«é€Ÿå…¥é—¨æ‰‹å†Œ" class="headerlink" title="MiniKube å¿«é€Ÿå…¥é—¨æ‰‹å†Œ"></a>MiniKube å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</h1><span id="more"></span>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Minikube å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬8ç« ã€Helm ç§æœ‰ä»“åº“æ­å»º</title>
    <link href="/2021/08/10/%E7%AC%AC8%E7%AB%A0%E3%80%81Helm-%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA/"/>
    <url>/2021/08/10/%E7%AC%AC8%E7%AB%A0%E3%80%81Helm-%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬7ç« ã€Helm2 è¿ç§» Helm3</title>
    <link href="/2021/08/10/%E7%AC%AC7%E7%AB%A0%E3%80%81Helm2-%E8%BF%81%E7%A7%BB-Helm3/"/>
    <url>/2021/08/10/%E7%AC%AC7%E7%AB%A0%E3%80%81Helm2-%E8%BF%81%E7%A7%BB-Helm3/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬5ç« ã€Chart æ¨¡ç‰ˆè¿›é˜¶</title>
    <link href="/2021/08/10/%E7%AC%AC5%E7%AB%A0%E3%80%81Chart-%E6%A8%A1%E7%89%88%E8%BF%9B%E9%98%B6/"/>
    <url>/2021/08/10/%E7%AC%AC5%E7%AB%A0%E3%80%81Chart-%E6%A8%A1%E7%89%88%E8%BF%9B%E9%98%B6/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬6ç« ã€åˆè¯† Release</title>
    <link href="/2021/08/10/%E7%AC%AC6%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Release/"/>
    <url>/2021/08/10/%E7%AC%AC6%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Release/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬4ç« ã€Chart æ¨¡ç‰ˆè¯¦è§£</title>
    <link href="/2021/07/24/%E7%AC%AC4%E7%AB%A0%E3%80%81Chart-%E6%A8%A1%E7%89%88%E8%AF%A6%E8%A7%A3/"/>
    <url>/2021/07/24/%E7%AC%AC4%E7%AB%A0%E3%80%81Chart-%E6%A8%A1%E7%89%88%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬4ç« ã€Chart-æ¨¡ç‰ˆè¯¦è§£"><a href="#ç¬¬4ç« ã€Chart-æ¨¡ç‰ˆè¯¦è§£" class="headerlink" title="ç¬¬4ç« ã€Chart æ¨¡ç‰ˆè¯¦è§£"></a>ç¬¬4ç« ã€Chart æ¨¡ç‰ˆè¯¦è§£</h1><span id="more"></span><h2 id="ä¸€ã€ç¼–å†™ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆ"><a href="#ä¸€ã€ç¼–å†™ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆ" class="headerlink" title="ä¸€ã€ç¼–å†™ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆ"></a>ä¸€ã€ç¼–å†™ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆ</h2><h3 id="1ã€å‰æœŸå‡†å¤‡"><a href="#1ã€å‰æœŸå‡†å¤‡" class="headerlink" title="1ã€å‰æœŸå‡†å¤‡"></a>1ã€å‰æœŸå‡†å¤‡</h3><blockquote><p>ğŸš© <strong>å†™åœ¨å¼€å§‹ä¹‹å‰</strong></p><p>ä¸Šä¸€ç« ä¸­æˆ‘ä»¬è¯´åˆ°è¿‡ï¼ŒHelm å‡ºæ¥å¯ä»¥å®‰è£…å®˜æ–¹æˆ–è€…ä¸‰æ–¹æä¾›çš„ <em>chart</em> åŒ…å¤–ï¼Œæ›´é‡è¦çš„æ˜¯æ”¯æŒåˆ›å»ºè‡ªå·±çš„ <code>chart</code>ï¼Œå°±è¡Œ <em>docker image</em> å’Œ <em>dockerfile</em>ï¼Œé€šè¿‡è‡ªå®šä¹‰ç¼–æ’ï¼Œæ–¹èƒ½å®ç°é€šè¿‡ Helm æ¥ç®¡ç†æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ã€‚</p><p>ä»ä¹‹å‰çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾å¾—å‡º <code>chart</code> çš„æ ¸å¿ƒæ˜¯èµ„æºæ¨¡ç‰ˆ <code>templates</code> å’Œæ¸²æŸ“ <code>.Values</code>ï¼Œè€Œå…¶ä¸­çš„å…³é”®ï¼Œåˆ™æ˜¯å¦‚ä½•å†™èµ„æºæ¨¡ç‰ˆï¼Œè™½ç„¶å…¶æ•´ä½“å£°æ˜å¼å’Œ K8s çš„ <em>yaml</em> è¡¨è¾¾å¼æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ—¢ç„¶æ¨¡ç‰ˆï¼Œè‡ªç„¶å°±è¦ä¸ºéœ€è¦æ¸²æŸ“çš„åœ°æ–¹ä¿ç•™å˜é‡ï¼Œå¹¶é€šè¿‡è¯­æ³•å»è·å–å¯¹åº”çš„å€¼ï¼Œæœ€ç»ˆæ‰èƒ½å‘ç”Ÿæ¸²æŸ“çš„æ•ˆæœã€‚è¿™ä¸ªç« èŠ‚æˆ‘ä»¬å°±æ¥å­¦ä¹ å¦‚ä½•é€šè¿‡ <code>Chart æ¨¡ç‰ˆ</code> çš„è¯­æ³•æ¥å†™æˆ‘ä»¬è‡ªå·±çš„æ¨¡ç‰ˆã€‚</p></blockquote><h4 id="1ï¼‰åˆ›å»ºä¸€ä¸ªç©ºçš„-chart"><a href="#1ï¼‰åˆ›å»ºä¸€ä¸ªç©ºçš„-chart" class="headerlink" title="1ï¼‰åˆ›å»ºä¸€ä¸ªç©ºçš„ chart"></a>1ï¼‰åˆ›å»ºä¸€ä¸ªç©ºçš„ chart</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm create mychart<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ é™¤æ‰€æœ‰é»˜è®¤ç”Ÿæˆçš„æ¨¡ç‰ˆ"><a href="#2ï¼‰åˆ é™¤æ‰€æœ‰é»˜è®¤ç”Ÿæˆçš„æ¨¡ç‰ˆ" class="headerlink" title="2ï¼‰åˆ é™¤æ‰€æœ‰é»˜è®¤ç”Ÿæˆçš„æ¨¡ç‰ˆ"></a>2ï¼‰åˆ é™¤æ‰€æœ‰é»˜è®¤ç”Ÿæˆçš„æ¨¡ç‰ˆ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">\rm -rf mychart/templates/*<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è¿™ä¸€ç« çš„å­¦ä¹ ä¹‹æ—…äº†ï¼ï¼</p><h3 id="2ã€åˆ›å»º-ConfigMap-æ¨¡ç‰ˆ"><a href="#2ã€åˆ›å»º-ConfigMap-æ¨¡ç‰ˆ" class="headerlink" title="2ã€åˆ›å»º ConfigMap æ¨¡ç‰ˆ"></a>2ã€åˆ›å»º ConfigMap æ¨¡ç‰ˆ</h3><h4 id="1ï¼‰åˆ›å»ºæ–‡ä»¶"><a href="#1ï¼‰åˆ›å»ºæ–‡ä»¶" class="headerlink" title="1ï¼‰åˆ›å»ºæ–‡ä»¶"></a>1ï¼‰åˆ›å»ºæ–‡ä»¶</h4><p>æ–‡ä»¶è·¯å¾„: <code>mychart/templates/configmap.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">myvalue:</span> <span class="hljs-string">&quot;Hello World&quot;</span><br></code></pre></td></tr></table></figure><h5 id="è¡¨è¾¾å¼è¯´æ˜"><a href="#è¡¨è¾¾å¼è¯´æ˜" class="headerlink" title="è¡¨è¾¾å¼è¯´æ˜"></a>è¡¨è¾¾å¼è¯´æ˜</h5><p>1âƒ£ï¸ <code>&#123;&#123; &#125;&#125;</code> å’Œ <code>.</code> æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ç›¸è¾ƒäºç»å…¸çš„ yaml å£°æ˜å¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæœ€å¤§çš„å˜åŒ–åœ¨äº <code>&#123;&#123; .Release.Name &#125;&#125;</code>ã€‚<code>&#123;&#123; &#125;&#125;</code> å°±æ˜¯æ¨¡ç‰ˆè°ƒç”¨çš„æ–¹æ³•ï¼Œå…¶ä¸­åŠ ä¸Šè¦å¼•ç”¨çš„å…ƒç´ ï¼Œæ¨¡ç‰ˆå‘½ä»¤å°±ä¼šå°†å…¶å¯¹ç”¨çš„å€¼ä½œä¸ºä¸€ä¸ªå¯¹è±¡æ³¨å…¥æ¨¡ç‰ˆä¹‹ä¸­ï¼Œå…¶ä¸­ <code>.</code> ç”¨äºåˆ†å‰²æ¯ä¸ªå‘½ä»¤ç©ºé—´å†…éœ€è¦æœç´¢å…ƒç´ ï¼Œæœ€å‰é¢çš„ <code>.</code>è¡¨ç¤ºä»ä½œç”¨åŸŸçš„æœ€é¡¶å±‚æœç´¢å¯¹è±¡ã€‚æ¨¡ç‰ˆä¼šä»æœ€é¡¶å±‚çš„å‘½ä»¤ç©ºé—´å¼€å§‹æœç´¢ <code>.</code> æŒ‡å®šçš„å¯¹è±¡ã€‚</p><p>ç”±æ­¤ï¼Œ<code>&#123;&#123; .Release.Name &#125;&#125;</code> å°±åº”å½“è§£è¯»ä¸º â€œ<strong>ä»æœ€é¡¶å±‚çš„å‘½åç©ºé—´å¼€å§‹æœç´¢ <code>Release</code> å¯¹è±¡ï¼Œç„¶ååœ¨å…¶ä¸­æœç´¢ <code>Name</code> å¯¹è±¡</strong>â€œã€‚<code>Relase</code> æ˜¯ Helm çš„å†…ç½®å¯¹è±¡ï¼Œè¡¨ç¤ºå‘å¸ƒæœ¬èº«ã€‚</p><p>2âƒ£ï¸ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå¤„ç†ï¼Ÿ</p><p>æ¨¡ç‰ˆçš„æ„ä¹‰åœ¨äºå¤ç”¨ã€‚é€šè¿‡ä¼ å…¥ä¸åŒçš„å€¼æ¥æ¸²æŸ“å‡ºä¸åŒçš„ç»“æœï¼Œæ‰æ˜¯æ¨¡ç‰ˆå­˜åœ¨çš„æ„ä¹‰ï¼Œå› æ­¤é’ˆå¯¹æ¨¡ç‰ˆæˆ‘ä»¬åº”å½“åšæŒ â€œ<strong>å¯å˜é‡åŒ–</strong>â€œçš„åŸåˆ™ï¼Œå°†éé€šç”¨æ€§çš„å­—æ®µè¿›è¡Œå˜é‡åŒ–å¤„ç†ï¼Œè¿™æ ·æ‰èƒ½ä½¿å¾—æˆ‘ä»¬çš„æ¨¡ç‰ˆæ›´å…·å¤‡æ³›ç”¨æ€§ï¼Œå¢åŠ å¤ç”¨çš„å¯èƒ½ã€‚</p><blockquote><p>âš ï¸ <strong>æ³¨æ„: Release åç§°çš„é•¿åº¦é™åˆ¶</strong>  </p><p>DNS ç³»ç»Ÿé™åˆ¶ <code>name</code> å­—æ®µçš„é•¿åº¦ä¸èƒ½è¶…è¿‡ <strong>63</strong> ä¸ªå­—ç¬¦ï¼Œå› æ­¤ Helm å¯¹ <code>Release</code> çš„åç§°æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼Œ<strong>Helm3 å¯¹äºå…¶é•¿åº¦é™åˆ¶ä¸º 53 ä¸ªå­—ç¬¦</strong>ã€‚</p></blockquote><h4 id="2ï¼‰å‘å¸ƒ-chart"><a href="#2ï¼‰å‘å¸ƒ-chart" class="headerlink" title="2ï¼‰å‘å¸ƒ chart"></a>2ï¼‰å‘å¸ƒ chart</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install test-chart ./mychart<br></code></pre></td></tr></table></figure><p>è¿”å›å€¼å¦‚ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705160256966.png" alt="image-20210705160256966"></p><p>æŸ¥çœ‹å‘å¸ƒ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm list<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705161041080.png" alt="image-20210705161041080"></p><h4 id="3ï¼‰æŸ¥çœ‹-manifest"><a href="#3ï¼‰æŸ¥çœ‹-manifest" class="headerlink" title="3ï¼‰æŸ¥çœ‹ manifest"></a>3ï¼‰æŸ¥çœ‹ manifest</h4><blockquote><p>æ‰§è¡Œ <code>helm get manifest</code> å¯ä»¥æ‰“å°å‡º <code>release</code> å·²ç»ä¸Šä¼ åˆ° <code>api server</code> çš„èµ„æºã€‚æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šä»¥ <code>---</code> `å¼€å¤´ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆæ³¨é‡Šã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥å‘ç°æ¨¡ç‰ˆä¸­çš„ <code>&#123;&#123; .Release.Name &#125;&#125;</code> è°ƒç”¨å·²ç»æ¸²æŸ“æˆäº† Release çš„åç§°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm get manifest &lt;release_name&gt;</span><br>helm get manifest test-chart<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705160402893.png" alt="image-20210705160402893"></p><h4 id="4ï¼‰æŸ¥çœ‹æ¸²æŸ“æ•ˆæœï¼ˆä¸å‘å¸ƒï¼‰"><a href="#4ï¼‰æŸ¥çœ‹æ¸²æŸ“æ•ˆæœï¼ˆä¸å‘å¸ƒï¼‰" class="headerlink" title="4ï¼‰æŸ¥çœ‹æ¸²æŸ“æ•ˆæœï¼ˆä¸å‘å¸ƒï¼‰"></a>4ï¼‰æŸ¥çœ‹æ¸²æŸ“æ•ˆæœï¼ˆä¸å‘å¸ƒï¼‰</h4><h5 id="1-å¸è½½åº”ç”¨"><a href="#1-å¸è½½åº”ç”¨" class="headerlink" title="1. å¸è½½åº”ç”¨"></a>1. å¸è½½åº”ç”¨</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm uninstall test-chart<br></code></pre></td></tr></table></figure><h5 id="2-æ¸²æŸ“æµ‹è¯•"><a href="#2-æ¸²æŸ“æµ‹è¯•" class="headerlink" title="2. æ¸²æŸ“æµ‹è¯•"></a>2. æ¸²æŸ“æµ‹è¯•</h5><h6 id="1âƒ£ï¸-dry-run"><a href="#1âƒ£ï¸-dry-run" class="headerlink" title="1âƒ£ï¸ --dry-run"></a>1âƒ£ï¸ <code>--dry-run</code></h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run test-chart ./mychart<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705162015141.png" alt="image-20210705162015141"></p><h6 id="2âƒ£ï¸-debug"><a href="#2âƒ£ï¸-debug" class="headerlink" title="2âƒ£ï¸ --debug"></a>2âƒ£ï¸ <code>--debug</code></h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run --debug test-chart ./mychart<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705161728732.png" alt="image-20210705161728732"></p><h3 id="3ã€Values-çš„ä½¿ç”¨"><a href="#3ã€Values-çš„ä½¿ç”¨" class="headerlink" title="3ã€Values çš„ä½¿ç”¨"></a>3ã€Values çš„ä½¿ç”¨</h3><p>ç¡®åˆ‡çš„è¯´ï¼Œ<code>Values</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæä¾›äº†å¯¹äºä¼ é€’åˆ° chart æ¨¡ç‰ˆçš„å€¼çš„è®¿é—®æ–¹æ³•ã€‚å…¶å†…å®¹çš„ä¸»è¦æ¥æºå¦‚ä¸‹:</p><blockquote><ul><li>chart ä¸­é»˜è®¤çš„ <code>values.yaml</code> æ–‡ä»¶</li><li>å¦‚æœæ˜¯<em>å­ chart</em>ï¼Œåˆ™ä¸º<em>çˆ¶ chart</em> çš„ <code>values.yaml</code> æ–‡ä»¶</li><li>å‘½ä»¤è¡Œä½¿ç”¨ <code>-f</code> æŒ‡å®šçš„ values æ–‡ä»¶</li><li>å‘½ä»¤è¡Œä½¿ç”¨ <code>--set</code> ä¼ å…¥çš„å•ä¸ªå‚æ•°</li></ul><p>ğŸš©å…¶ä¼˜å…ˆçº§é¡ºåºæŒ‰ç…§ä¸Šè¿°åˆ—è¡¨è‡ªä¸‹è€Œä¸Šï¼Œä¾æ¬¡å‡å¼±ã€‚</p></blockquote><h4 id="1ï¼‰åˆ é™¤é»˜è®¤çš„-values-yaml"><a href="#1ï¼‰åˆ é™¤é»˜è®¤çš„-values-yaml" class="headerlink" title="1ï¼‰åˆ é™¤é»˜è®¤çš„ values.yaml"></a>1ï¼‰åˆ é™¤é»˜è®¤çš„ values.yaml</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rm -f mychart/values.yaml <br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åŸºæœ¬ä½¿ç”¨"><a href="#2ï¼‰åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2ï¼‰åŸºæœ¬ä½¿ç”¨"></a>2ï¼‰åŸºæœ¬ä½¿ç”¨</h4><h5 id="1-åˆ›å»º-values-yaml"><a href="#1-åˆ›å»º-values-yaml" class="headerlink" title="1. åˆ›å»º values.yaml"></a>1. åˆ›å»º values.yaml</h5><p>æ–‡ä»¶è·¯å¾„: <code>mychart/values.yaml</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">aaa:</span> <span class="hljs-string">bbb</span><br></code></pre></td></tr></table></figure><h5 id="2-åœ¨-ConfigMap-æ¨¡ç‰ˆä¸­å¼•ç”¨"><a href="#2-åœ¨-ConfigMap-æ¨¡ç‰ˆä¸­å¼•ç”¨" class="headerlink" title="2. åœ¨ ConfigMap æ¨¡ç‰ˆä¸­å¼•ç”¨"></a>2. åœ¨ <code>ConfigMap</code> æ¨¡ç‰ˆä¸­å¼•ç”¨</h5><p>æ–‡ä»¶è·¯å¾„: <code>mychart/templates/configmap.yaml </code>ï¼Œå†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">myvalue:</span> <span class="hljs-string">&quot;Hello World&quot;</span><br>  <span class="hljs-attr">aaa:</span> &#123;&#123; <span class="hljs-string">.Values.aaa</span> &#125;&#125;<span class="hljs-comment"># è¿½åŠ å†…å®¹</span><br></code></pre></td></tr></table></figure><h5 id="3-æ¸²æŸ“æ¨¡ç‰ˆ"><a href="#3-æ¸²æŸ“æ¨¡ç‰ˆ" class="headerlink" title="3. æ¸²æŸ“æ¨¡ç‰ˆ"></a>3. æ¸²æŸ“æ¨¡ç‰ˆ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run test-chart ./mychart<br></code></pre></td></tr></table></figure><p><strong>æ¸²æŸ“ç»“æœå¦‚ä¸‹ï¼š</strong></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707143605000.png" alt="image-20210707143605000"></p><h4 id="3ï¼‰å¤šç»“æ„åŒ–è¡¨è¾¾å¼"><a href="#3ï¼‰å¤šç»“æ„åŒ–è¡¨è¾¾å¼" class="headerlink" title="3ï¼‰å¤šç»“æ„åŒ–è¡¨è¾¾å¼"></a>3ï¼‰å¤šç»“æ„åŒ–è¡¨è¾¾å¼</h4><h5 id="1-åˆ›å»º-values-yaml-1"><a href="#1-åˆ›å»º-values-yaml-1" class="headerlink" title="1. åˆ›å»º values.yaml"></a>1. åˆ›å»º values.yaml</h5><p>æ–‡ä»¶è·¯å¾„ï¼š<code>mychart/other_values.yaml</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">Tareya</span><br>  <span class="hljs-attr">gender:</span> <span class="hljs-string">male</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">18</span><br></code></pre></td></tr></table></figure><h5 id="2-åœ¨æ¨¡ç‰ˆä¸­å¼•ç”¨"><a href="#2-åœ¨æ¨¡ç‰ˆä¸­å¼•ç”¨" class="headerlink" title="2. åœ¨æ¨¡ç‰ˆä¸­å¼•ç”¨"></a>2. åœ¨æ¨¡ç‰ˆä¸­å¼•ç”¨</h5><p>æ–‡ä»¶è·¯å¾„ï¼š<code>mychart/templates/configmap.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">myvalue:</span> <span class="hljs-string">&quot;Hello World&quot;</span><br>  <span class="hljs-attr">aaa:</span> &#123;&#123; <span class="hljs-string">.Values.aaa</span> &#125;&#125;<br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.person.name</span> &#125;&#125;<span class="hljs-comment"># è¿½åŠ å†…å®¹</span><br>  <span class="hljs-attr">gender:</span> &#123;&#123; <span class="hljs-string">.Values.person.gender</span> &#125;&#125;<br>  <span class="hljs-attr">age:</span> &#123;&#123; <span class="hljs-string">.Values.person.age</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="3-æ¸²æŸ“æ¨¡ç‰ˆ-1"><a href="#3-æ¸²æŸ“æ¨¡ç‰ˆ-1" class="headerlink" title="3. æ¸²æŸ“æ¨¡ç‰ˆ"></a>3. æ¸²æŸ“æ¨¡ç‰ˆ</h5><p>ä½ å¯ä»¥å‘ç°æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶åå¹¶éé»˜è®¤çš„ <code>values.yaml</code>ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œå¯ä»¥é€šè¿‡ <code>-f</code> çš„æ–¹å¼æŒ‡å®š <code>Values</code> çš„é…ç½®æ–‡ä»¶å—ï¼Ÿè¿™è¾¹æˆ‘ä»¬æ¥è¯•éªŒä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install -f mychart/other_values.yaml --dry-run test-chart ./mychart<br></code></pre></td></tr></table></figure><p><strong>æ¸²æŸ“ç»“æœå¦‚ä¸‹ï¼š</strong></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707145708150.png" alt="image-20210707145708150"></p><p>å¯ä»¥å‘ç°ï¼Œæ¸²æŸ“ç»“æœä¸ä½†è¯»å–äº†é»˜è®¤çš„ <code>values.yaml</code> ï¼Œè¿˜è¯»å–äº†æˆ‘ä»¬æŒ‡å®šçš„ <code>other_values.yaml</code>ã€‚</p><h4 id="4ï¼‰ä½¿ç”¨-set-æŒ‡å®šé…ç½®å‚æ•°"><a href="#4ï¼‰ä½¿ç”¨-set-æŒ‡å®šé…ç½®å‚æ•°" class="headerlink" title="4ï¼‰ä½¿ç”¨ --set æŒ‡å®šé…ç½®å‚æ•°"></a>4ï¼‰ä½¿ç”¨ <code>--set</code> æŒ‡å®šé…ç½®å‚æ•°</h4><p>è¿˜è®°å¾—æˆ‘ä»¬ä¸Šé¢è¯´çš„ Values çš„ä¼˜å…ˆçº§å—ï¼Ÿæˆ‘ä»¬åœ¨è¿™è¾¹åšä¸ªç®€å•çš„éªŒè¯ï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»åœ¨ <code>values.yaml</code> ä¸­è®¾ç½®äº† <code>aaa</code> çš„å€¼ä¸º <code>bbb</code>ï¼Œæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --set aaa=abcdefg --dry-run test-chart ./mychart<br></code></pre></td></tr></table></figure><p>æ¸²æŸ“ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707144128673.png" alt="image-20210707144128673"></p><p>å¯ä»¥å‘ç°ï¼ŒåŸæœ¬ <code>values.yaml</code> ä¸­çš„é»˜è®¤é…ç½®è¢«æˆ‘ä»¬å‘½ä»¤è¡ŒæŒ‡å®šçš„é…ç½®è¦†ç›–äº†ã€‚</p><h4 id="5ï¼‰é€šè¿‡è®¾ç½®-null-åˆ é™¤é»˜è®¤é…ç½®"><a href="#5ï¼‰é€šè¿‡è®¾ç½®-null-åˆ é™¤é»˜è®¤é…ç½®" class="headerlink" title="5ï¼‰é€šè¿‡è®¾ç½® null åˆ é™¤é»˜è®¤é…ç½®"></a>5ï¼‰é€šè¿‡è®¾ç½® <code>null</code> åˆ é™¤é»˜è®¤é…ç½®</h4><p>æˆ‘ä»¬çŸ¥é“ <code>Values</code> çš„é…ç½®å…¶å®å°±æ˜¯ä¸€ä¸ª Key:Vaule å¯¹ï¼Œæ‰€ä»¥å¦‚æœè¦ä»é»˜è®¤çš„ <code>Values</code> ä¸­åˆ é™¤é…ç½®ï¼Œå…¶å®åªè¦å°† Key è®¾ç½®ä¸º <code>null</code>ï¼ŒHelm åœ¨è¿›è¡Œæ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šåˆå¹¶å¹¶åˆ é™¤å¯¹åº”çš„ Keyã€‚</p><h5 id="ç¤ºä¾‹è¯´æ˜"><a href="#ç¤ºä¾‹è¯´æ˜" class="headerlink" title="ç¤ºä¾‹è¯´æ˜"></a>ç¤ºä¾‹è¯´æ˜</h5><p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜ã€‚æ¯”å¦‚ï¼Œç¨³å®šçš„ <code>Drupal</code> chart å…è®¸åœ¨é…ç½®è‡ªå®šä¹‰é•œåƒæ—¶é…ç½®åŠ¨æ€æ¢é’ˆï¼Œé»˜è®¤å€¼å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">livenessProbe:</span><br>  <span class="hljs-attr">httpGet:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/user/login</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>  <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">120</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³ç”¨ <code>exec</code> æ¥ä»£æ›¿ <code>httpGet</code> é‡å†™åŠ¨æ€æ¢é’ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>--set livenessProbe.exec.command=[cat,docroot/CHANGELOG.txt]</code> ï¼Œåœ¨è¿›è¡Œæœ€ç»ˆæ¸²æŸ“åˆå¹¶åï¼Œç”Ÿäº§çš„ manifest å†…å®¹ä¼šå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">livenessProbe:</span><br>  <span class="hljs-attr">httpGet:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/user/login</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>  <span class="hljs-attr">exec:</span><br>    <span class="hljs-attr">command:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">cat</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">docroot/CHANGELOG.txt</span><br>  <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">120</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œç”±äºåŒæ—¶å­˜åœ¨2ä¸ªåŠ¨æ€æ¢é’ˆå¥æŸ„ï¼Œæ‰€ä»¥ K8s åœ¨éƒ¨ç½²æ—¶ä¼šæŠ¥é”™ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install stable/drupal --set image=my-registry/drupal:0.1.0 --set livenessProbe.exec.command=[cat,docroot/CHANGELOG.txt] --set livenessProbe.httpGet=null<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€ç»ˆç”Ÿæˆçš„ manifest å¦‚ä¸‹ï¼Œ<code>httpGet</code> å¥æŸ„ä¼šè¢«åˆ é™¤ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">livenessProbe:</span><br>  <span class="hljs-attr">exec:</span><br>    <span class="hljs-attr">command:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">cat</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">docroot/CHANGELOG.txt</span><br>  <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">120</span><br></code></pre></td></tr></table></figure><p>å¦‚æ­¤ï¼ŒK8s æ‰èƒ½å¤Ÿæ­£å¸¸å®‰è£…ã€‚</p><hr>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬3ç« ã€åˆè¯† Chart</title>
    <link href="/2021/07/24/%E7%AC%AC3%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Chart%20/"/>
    <url>/2021/07/24/%E7%AC%AC3%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Chart%20/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬3ç« ã€åˆè¯†-Chart"><a href="#ç¬¬3ç« ã€åˆè¯†-Chart" class="headerlink" title="ç¬¬3ç« ã€åˆè¯† Chart"></a>ç¬¬3ç« ã€åˆè¯† Chart</h1><span id="more"></span><h2 id="ä¸€ã€Chart-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€Chart-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€Chart æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€Chart æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« èŠ‚æ—¶ä»‹ç» Helm çš„ä¸‰å¤§æ¦‚å¿µæ—¶æ˜¯å¦‚ä½•ä»‹ç» <code>chart</code> è¿™ä¸ªæ¦‚å¿µçš„å—ï¼Ÿæ˜¯çš„ï¼Œ<code>chart</code> å°±åƒè®¸å¤šè¯­è¨€å°è£…çš„æºç åŒ…ä¸€æ ·ï¼Œå®ƒæ˜¯ Helm ä½¿ç”¨çš„å°è£…åŒ…çš„æ€»ç§°ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼ŒKubernetes å°†å…¶ç®¡ç†çš„å¯¹è±¡ç§°ä¸ºèµ„æºï¼Œä¾‹å¦‚ deploymentã€serviceã€ingress ç­‰ã€‚è€Œ Helm ä½œä¸º K8s çš„åŒ…ç®¡ç†å™¨ï¼Œå…¶æœ€å¤§çš„ä½œç”¨å°±æ˜¯é€šè¿‡ chart çš„æ–¹å¼æ•´åˆéœ€è¦ç®¡ç†çš„ K8s ä¸­çš„èµ„æºï¼Œå†é€šè¿‡ Helm å®¢æˆ·ç«¯ <strong>ç»Ÿä¸€äº¤ç”±</strong> K8s api server å»æ‰§è¡Œã€‚</p><hr><h2 id="äºŒã€Chart-åŸºç¡€ä½¿ç”¨"><a href="#äºŒã€Chart-åŸºç¡€ä½¿ç”¨" class="headerlink" title="äºŒã€Chart åŸºç¡€ä½¿ç”¨"></a>äºŒã€Chart åŸºç¡€ä½¿ç”¨</h2><h3 id="1ã€æŸ¥æ‰¾-Chart"><a href="#1ã€æŸ¥æ‰¾-Chart" class="headerlink" title="1ã€æŸ¥æ‰¾ Chart"></a>1ã€æŸ¥æ‰¾ Chart</h3><blockquote><p>Helm æä¾›äº†2ç§æœç´¢å‘½ä»¤ï¼Œå¯ç”¨ç”¨æ¥ä»ä¸¤ç§æ¥æºä¸­è¿›è¡Œæœç´¢ï¼š</p><ul><li><code>helm search hub</code>ï¼šä» <a href="https://artifacthub.io/">Artifact Hub</a> ä¸­æŸ¥æ‰¾å¹¶åˆ—å‡º helm chartsã€‚ Artifact Hubä¸­å­˜æ”¾äº†å¤§é‡ä¸åŒçš„ä»“åº“ã€‚</li><li><code>helm search repo</code>ï¼šä»ä½ æ·»åŠ ï¼ˆä½¿ç”¨ <code>helm repo add</code>ï¼‰åˆ°æœ¬åœ° helm å®¢æˆ·ç«¯ä¸­çš„ä»“åº“ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚è¯¥å‘½ä»¤åŸºäºæœ¬åœ°æ•°æ®è¿›è¡Œæœç´¢ï¼Œæ— éœ€è¿æ¥äº’è”ç½‘ã€‚</li></ul></blockquote><h4 id="1ï¼‰æœç´¢æ‰€æœ‰å…¬å¼€å¯ç”¨çš„-charts"><a href="#1ï¼‰æœç´¢æ‰€æœ‰å…¬å¼€å¯ç”¨çš„-charts" class="headerlink" title="1ï¼‰æœç´¢æ‰€æœ‰å…¬å¼€å¯ç”¨çš„ charts"></a>1ï¼‰æœç´¢æ‰€æœ‰å…¬å¼€å¯ç”¨çš„ <code>charts</code></h4><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä» <code>Artifact Hub</code> ä¸­æœç´¢æ‰€æœ‰çš„ <code>wordpress</code> chartsï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm search hub &lt;chart_name&gt;</span> <br>helm search hub wordpress<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210629102731888.png" alt="image-20210629102731888"></p><h4 id="2ï¼‰æœç´¢æœ¬åœ°-stable-æºä¸­å¯ç”¨çš„-charts"><a href="#2ï¼‰æœç´¢æœ¬åœ°-stable-æºä¸­å¯ç”¨çš„-charts" class="headerlink" title="2ï¼‰æœç´¢æœ¬åœ° stable æºä¸­å¯ç”¨çš„ charts"></a>2ï¼‰æœç´¢æœ¬åœ° <code>stable</code> æºä¸­å¯ç”¨çš„ <code>charts</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm search repo &lt;repo_name&gt;</span><br>helm search repo stable<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210628152107519.png" alt="image-20210628152107519"></p><h4 id="3ï¼‰æ¨¡ç³ŠåŒ¹é…æœç´¢"><a href="#3ï¼‰æ¨¡ç³ŠåŒ¹é…æœç´¢" class="headerlink" title="3ï¼‰æ¨¡ç³ŠåŒ¹é…æœç´¢"></a>3ï¼‰æ¨¡ç³ŠåŒ¹é…æœç´¢</h4><p>Helm çš„æœç´ ä½¿ç”¨æ¨¡ç³Šå­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œåªéœ€è¦è¾“å…¥åå­—çš„ä¸€éƒ¨åˆ†å°±å¯ä»¥ä»æœ¬åœ°ä»“åº“è®°å½•ä¸­è¿›è¡Œæœç´¢ï¼Œå¦‚ä¸‹æœç´¢ <code>word</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm search repo &lt;string&gt;</span><br>helm search repo word<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210629103454469.png" alt="image-20210629103454469"></p><h3 id="2ã€å®‰è£…-Chart"><a href="#2ã€å®‰è£…-Chart" class="headerlink" title="2ã€å®‰è£… Chart"></a>2ã€å®‰è£… Chart</h3><blockquote><p>ä½¿ç”¨ <code>helm search</code> æ‰¾åˆ°ä½ æƒ³è¦å®‰è£…çš„ helmåŒ…åï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>helm install</code> æ¥è¿›è¡Œå®‰è£…ã€‚æœ€ç®€å•ä½¿ç”¨æ–¹æ¡ˆåªéœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š<code>releaseçš„åå­—</code> å’Œ <code>chartçš„åç§°</code>ã€‚</p></blockquote><h4 id="1ï¼‰å®‰è£…helmåŒ…"><a href="#1ï¼‰å®‰è£…helmåŒ…" class="headerlink" title="1ï¼‰å®‰è£…helmåŒ…"></a>1ï¼‰å®‰è£…helmåŒ…</h4><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå³åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <code>release</code> å¯¹è±¡ï¼Œå‘½åä¸º <code>happy-panda</code> ï¼Œå¦‚æœæƒ³è¦è‡ªåŠ¨ç”Ÿæˆä¸€ååç§°ï¼Œå¯ä»¥ä½¿ç”¨<code>--generate-name</code> å‚æ•°:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm install &lt;release_name&gt; &lt;chart_name&gt; ï¼ˆchartåç§°é¡»å…·ä½“ï¼Œå¦‚ bitnami/wordpressã€‚ä¸èƒ½åªæ˜¯å…³é”®å­—ï¼‰</span><br>helm install happy-panda bitnami/wordpress<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210629104631960.png" alt="image-20210629104631960"></p><h4 id="2ï¼‰æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"><a href="#2ï¼‰æŸ¥çœ‹è¿è¡ŒçŠ¶æ€" class="headerlink" title="2ï¼‰æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"></a>2ï¼‰æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm list<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME     NAMESPACEREVISIONUPDATED                                STATUS  CHART            APP VERSION<br>happy-pandadefault  1       2021-06-29 10:51:13.437131205 +0800 CSTdeployedwordpress-11.0.165.7.2  <br></code></pre></td></tr></table></figure><h4 id="3ï¼‰æŸ¥çœ‹å‘å¸ƒçŠ¶æ€"><a href="#3ï¼‰æŸ¥çœ‹å‘å¸ƒçŠ¶æ€" class="headerlink" title="3ï¼‰æŸ¥çœ‹å‘å¸ƒçŠ¶æ€"></a>3ï¼‰æŸ¥çœ‹å‘å¸ƒçŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm status &lt;release_name&gt;</span><br>helm status happy-panda<br></code></pre></td></tr></table></figure><p>è¿”å›å€¼å’Œå®‰è£…æ—¶çš„è¿”å›ä¸€æ ·ã€‚</p><h4 id="4ï¼‰å¸è½½helmåŒ…"><a href="#4ï¼‰å¸è½½helmåŒ…" class="headerlink" title="4ï¼‰å¸è½½helmåŒ…"></a>4ï¼‰å¸è½½helmåŒ…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm uninstall &lt;release_name&gt;</span><br>helm uninstall happy-panda<br></code></pre></td></tr></table></figure><h3 id="3ã€ä¸‹è½½-Chart"><a href="#3ã€ä¸‹è½½-Chart" class="headerlink" title="3ã€ä¸‹è½½ Chart"></a>3ã€ä¸‹è½½ Chart</h3><blockquote><p>Helm çš„ chart åŒæ—¶ä¹Ÿæ”¯æŒä¸‹è½½ï¼Œä¸‹è½½ä¸‹æ¥çš„æ˜¯ä¸€ä¸ªtaråŒ…ï¼Œè§£å‹åå³å¯è·å¾—å®˜æ–¹çš„ chart ç›®å½•ï¼ŒåŸºäºç›®å½•ä¸­æä¾›çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶ä¸­çš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œè¿›è¡Œè‡ªå®šä¹‰çš„å‘å¸ƒï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å­¦ä¹ å…¶è¯­æ³•ã€‚</p></blockquote><h4 id="1ï¼‰ä¸‹è½½"><a href="#1ï¼‰ä¸‹è½½" class="headerlink" title="1ï¼‰ä¸‹è½½"></a>1ï¼‰ä¸‹è½½</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm pull &lt;chart_name&gt; ï¼ˆchartåç§°é¡»å…·ä½“ï¼Œå¦‚ bitnami/kongã€‚ä¸èƒ½åªæ˜¯å…³é”®å­—ï¼‰</span><br>helm pull bitnami/kong<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701103804465.png" alt="image-20210701103804465"></p><h4 id="2ï¼‰è§£å‹"><a href="#2ï¼‰è§£å‹" class="headerlink" title="2ï¼‰è§£å‹"></a>2ï¼‰è§£å‹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xf kong-3.7.5.tgz <br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701103958115.png" alt="image-20210701103958115"></p><h4 id="3ï¼‰ç›®å½•ç»“æ„"><a href="#3ï¼‰ç›®å½•ç»“æ„" class="headerlink" title="3ï¼‰ç›®å½•ç»“æ„"></a>3ï¼‰ç›®å½•ç»“æ„</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell">kong<br>â”œâ”€â”€ Chart.lock<br>â”œâ”€â”€ charts# kong çš„ chart ä¾èµ–çš„å…¶ä»– chartï¼Œæ•°æ®åº“<br>â”‚Â Â  â”œâ”€â”€ cassandra<br>â”‚Â Â  â”œâ”€â”€ common<br>â”‚Â Â  â””â”€â”€ postgresql<br>â”œâ”€â”€ Chart.yaml# åŒ…å«äº†chartä¿¡æ¯çš„YAMLæ–‡ä»¶<br>â”œâ”€â”€ ci<br>â”‚Â Â  â”œâ”€â”€ values-editing-containers.yaml<br>â”‚Â Â  â”œâ”€â”€ values-external-cassandra.yaml<br>â”‚Â Â  â”œâ”€â”€ values-external-postgresql.yaml<br>â”‚Â Â  â”œâ”€â”€ values-ingress.yaml<br>â”‚Â Â  â””â”€â”€ values-metrics-hpa-pdb.yaml<br>â”œâ”€â”€ crds# è‡ªå®šä¹‰èµ„æº<br>â”‚Â Â  â””â”€â”€ custom-resource-definitions.yaml<br>â”œâ”€â”€ README.md<br>â”œâ”€â”€ templates# èµ„æºæ¨¡ç‰ˆï¼Œé…ç½® values è¿›è¡Œæ¸²æŸ“ï¼Œç”Ÿäº§æœ‰æ•ˆçš„ K8s manifest<br>â”‚Â Â  â”œâ”€â”€ dep-ds.yaml<br>â”‚Â Â  â”œâ”€â”€ external-database-secret.yaml<br>â”‚Â Â  â”œâ”€â”€ extra-list.yaml<br>â”‚Â Â  â”œâ”€â”€ _helpers.tpl<br>â”‚Â Â  â”œâ”€â”€ hpa.yaml<br>â”‚Â Â  â”œâ”€â”€ ingress-controller-rbac.yaml<br>â”‚Â Â  â”œâ”€â”€ ingress.yaml<br>â”‚Â Â  â”œâ”€â”€ kong-prometheus-rolebinding.yaml<br>â”‚Â Â  â”œâ”€â”€ kong-prometheus-role.yaml<br>â”‚Â Â  â”œâ”€â”€ kong-script-configmap.yaml<br>â”‚Â Â  â”œâ”€â”€ metrics-exporter-configmap.yaml<br>â”‚Â Â  â”œâ”€â”€ metrics-script-configmap.yaml<br>â”‚Â Â  â”œâ”€â”€ metrics-service.yaml<br>â”‚Â Â  â”œâ”€â”€ migrate-job.yaml<br>â”‚Â Â  â”œâ”€â”€ NOTES.txt<br>â”‚Â Â  â”œâ”€â”€ pdb.yaml<br>â”‚Â Â  â”œâ”€â”€ servicemonitor.yaml<br>â”‚Â Â  â”œâ”€â”€ service.yaml<br>â”‚Â Â  â””â”€â”€ tls-secrets.yaml<br>â””â”€â”€ values.yaml# chart é»˜è®¤çš„é…ç½®å€¼<br><br></code></pre></td></tr></table></figure><h3 id="4ã€è‡ªå»º-Chart"><a href="#4ã€è‡ªå»º-Chart" class="headerlink" title="4ã€è‡ªå»º Chart"></a>4ã€è‡ªå»º Chart</h3><blockquote><p>é™¤äº†ä»è¿œç¨‹ helm ä»“åº“ä¸­è·å–å®˜æ–¹æˆ–ä¸‰æ–¹çš„ chart å¤–ï¼ŒHelm æ›´åŠ é‡è¦çš„åŠŸèƒ½åœ¨äºè‡ªå»º chartï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª chart éœ€è¦çš„æœ€å°åŒ–ç›®å½•ç»“æ„ä»¥åŠå„å¿…è¦æ–‡ä»¶çš„æ¨¡ç‰ˆã€‚chart çš„æ•´ä½“æ„é€ æ¯”è¾ƒç±»ä¼¼ ansible çš„ rolesã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm create &lt;chart_name&gt;</span><br>helm create test_chart<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701180328092.png" alt="image-20210701180328092"></p><h3 id="5ã€æ£€æŸ¥-Chart"><a href="#5ã€æ£€æŸ¥-Chart" class="headerlink" title="5ã€æ£€æŸ¥ Chart"></a>5ã€æ£€æŸ¥ Chart</h3><blockquote><p>Helm è‡ªåŠ¨äº†è¯­æ³•æ£€æŸ¥å·¥å…·ï¼Œå…¶ä½œç”¨ç±»ä¼¼ <code>nginx -t</code>ï¼Œä¼šå¯¹ chart çš„æ ¼å¼æˆ–è€…ä¸€äº›ä¿¡æ¯è¿›è¡Œè‡ªæ£€ï¼Œå¹¶è¿”å›æ£€æŸ¥ç»“æœï¼Œåœ¨å‘å¸ƒå‰ï¼Œè¿›è¡Œè¯­æ³•æ£€æŸ¥æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm lint &lt;chart_name&gt;</span><br>helm lint test_chart<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705142216832.png" alt="image-20210705142216832"></p><h3 id="6ã€ä¸Šä¼ -Chart"><a href="#6ã€ä¸Šä¼ -Chart" class="headerlink" title="6ã€ä¸Šä¼  Chart"></a>6ã€ä¸Šä¼  Chart</h3><h4 id="1ï¼‰æ‰“åŒ…-Chart"><a href="#1ï¼‰æ‰“åŒ…-Chart" class="headerlink" title="1ï¼‰æ‰“åŒ… Chart"></a>1ï¼‰æ‰“åŒ… Chart</h4><blockquote><p>åœ¨ä¸Šé¢çš„ä¸€ç³»åˆ—æ“ä½œä¸­æˆ‘ä»¬çŸ¥é“ï¼ŒHelm ä»“åº“ä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ªä¸ªçš„ tar åŒ…ï¼Œè€Œä¸æ˜¯ç›®å½•ï¼Œå› æ­¤å¦‚æœä½ æƒ³ä¸Šä¼ è‡ªå»ºçš„ chartï¼Œå°±éœ€è¦å°†å…¶å…ˆè¡Œæ‰“åŒ…ã€‚Helm æä¾›äº†è¿™æ ·ä¸€ä¸ªå‘½åæ¥å°†ä½ è‡ªå»ºçš„ chart æ‰“åŒ…å‡º Helm å¯è¯†åˆ«çš„æ ¼å¼ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm package &lt;chart_name&gt;</span><br>helm package test_chart<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701111357599.png" alt="image-20210701111357599"></p><blockquote><p>ğŸš© <strong>ä¸ºä»€ä¹ˆç‰ˆæœ¬æ˜¯ 0.1.0ï¼Ÿ</strong></p><p>è¿™æ˜¯ç”± Chart.yaml ä¸­çš„ <code>version</code> å­—æ®µå†³å®šçš„ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701111524833.png" alt="image-20210701111524833"></p></blockquote><h4 id="2ï¼‰ä¸Šä¼ è‡³ç§æœ‰ä»“åº“"><a href="#2ï¼‰ä¸Šä¼ è‡³ç§æœ‰ä»“åº“" class="headerlink" title="2ï¼‰ä¸Šä¼ è‡³ç§æœ‰ä»“åº“"></a>2ï¼‰ä¸Šä¼ è‡³ç§æœ‰ä»“åº“</h4><blockquote><p><strong>å››ä¸ªæ­¥éª¤ï¼š</strong></p><p>1ï¼‰è‡ªå»ºç§æœ‰ä»“åº“</p><p>2ï¼‰ç”Ÿæˆã€æ›´æ–° chart ç´¢å¼•æ–‡ä»¶</p><p>3ï¼‰ä¸Šä¼  chart å’Œç´¢å¼•æ–‡ä»¶</p><p>4ï¼‰æ›´æ–°æœ¬åœ° chart ä»“åº“</p></blockquote><h4 id="3ï¼‰ä¸Šä¼ è‡³-Helm-Hub"><a href="#3ï¼‰ä¸Šä¼ è‡³-Helm-Hub" class="headerlink" title="3ï¼‰ä¸Šä¼ è‡³ Helm Hub"></a>3ï¼‰ä¸Šä¼ è‡³ Helm Hub</h4><blockquote><p>ğŸš© <strong>å‚è€ƒæ–‡æ¡£:</strong></p><p><a href="https://blog.csdn.net/jeffzhesi/article/details/106565173">https://blog.csdn.net/jeffzhesi/article/details/106565173</a></p></blockquote><hr><h2 id="ä¸‰ã€Chart-è¯­æ³•é‡Šä¹‰"><a href="#ä¸‰ã€Chart-è¯­æ³•é‡Šä¹‰" class="headerlink" title="ä¸‰ã€Chart è¯­æ³•é‡Šä¹‰"></a>ä¸‰ã€Chart è¯­æ³•é‡Šä¹‰</h2><h3 id="1ã€chart-åŸºæœ¬å…ƒç´ é‡Šä¹‰ï¼š"><a href="#1ã€chart-åŸºæœ¬å…ƒç´ é‡Šä¹‰ï¼š" class="headerlink" title="1ã€chart åŸºæœ¬å…ƒç´ é‡Šä¹‰ï¼š"></a>1ã€chart åŸºæœ¬å…ƒç´ é‡Šä¹‰ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">test_chart<br>â”œâ”€â”€ charts# å¯é€‰: æœ¬ chart ä¾èµ–çš„å…¶ä»– chart<br>â”œâ”€â”€ Chart.yaml# å¿…éœ€: ç”¨äºæè¿° chart ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ã€æè¿°ä¿¡æ¯ã€apiç‰ˆæœ¬ç­‰<br>â”œâ”€â”€ templates# å¿…éœ€: åšç”¨äº K8s èµ„æºçš„ yaml æ¨¡ç‰ˆ<br>â”‚Â Â  â”œâ”€â”€ deployment.yaml# ç”¨äºç”Ÿæˆ K8s deployment èµ„æºçš„ yaml æ¨¡ç‰ˆï¼Œå‘å¸ƒåº”ç”¨çš„åŸºæœ¬å…ƒç´ <br>â”‚Â Â  â”œâ”€â”€ _helpers.tpl# ç”¨äºå®šä¹‰ä¸€äº›å¯é‡ç”¨çš„æ¨¡æ¿ç‰‡æ–­ï¼Œåœ¨æ­¤æ–‡ä»¶ä¸­çš„å®šä¹‰åœ¨ä»»ä½•èµ„æºå®šä¹‰æ¨¡æ¿ä¸­éƒ½å¯ç”¨<br>â”‚Â Â  â”œâ”€â”€ hpa.yaml# ç”¨äºç”Ÿæˆ K8s hpa çš„ yaml æ¨¡ç‰ˆï¼Œå¦‚æœåŠ¡éœ€è¦å¼¹æ€§ä¼¸ç¼©ç­–ç•¥ï¼Œåˆ™åœ¨è¯¥æ¨¡ç‰ˆä¸­å®šä¹‰<br>â”‚Â Â  â”œâ”€â”€ ingress.yaml# ç”¨äºç”Ÿæˆ K8s ingress çš„ yaml æ¨¡ç‰ˆï¼Œå¦‚æœæœåŠ¡éœ€è¦å¯¹å¤–æ”¾å‡ºï¼Œåˆ™åœ¨è¯¥æ¨¡ç‰ˆä¸­å®šä¹‰ ingress<br>â”‚Â Â  â”œâ”€â”€ NOTES.txt# å¿…éœ€: ç”¨äºä»‹ç» chart éƒ¨ç½²åçš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å¦‚ä½•ä½¿ç”¨è¿™ä¸ª chartã€åˆ—å‡ºç¼ºçœè®¾ç½®ç­‰<br>â”‚Â Â  â”œâ”€â”€ serviceaccount.yaml# ç”¨äºç”Ÿæˆ K8s serviceaccount èµ„æºçš„ yaml æ¨¡ç‰ˆï¼Œå¦‚éœ€è¦åˆ›å»ºç‰¹å®šè®¤è¯å¯¹è±¡ï¼Œåˆ™åœ¨è¯¥æ¨¡ç‰ˆä¸­å®šä¹‰<br>â”‚Â Â  â”œâ”€â”€ service.yaml# ç”¨äºç”Ÿæˆ K8s service èµ„æºçš„ yaml æ¨¡ç‰ˆï¼Œå‘å¸ƒåº”ç”¨çš„åŸºæœ¬å…ƒç´ <br>â”‚Â Â  â””â”€â”€ tests# helm çš„æµ‹è¯•é’©å­<br>â”‚Â Â      â””â”€â”€ test-connection.yaml<br>â””â”€â”€ values.yaml# å¿…éœ€: ç”¨äºå­˜å‚¨è¦æ¸²æŸ“è‡³ templates/ ä¸‹æ¨¡ç‰ˆæ–‡ä»¶ä¸­çš„å€¼<br></code></pre></td></tr></table></figure><h3 id="2ã€Chart-yaml"><a href="#2ã€Chart-yaml" class="headerlink" title="2ã€Chart.yaml"></a>2ã€Chart.yaml</h3><p>ä¸€ä¸ªæ ‡å‡†çš„ Chart.yaml åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-comment"># å¿…éœ€: chart API ç‰ˆæœ¬, v2 ç‰ˆæœ¬ä¸º helm3 è¯­æ³•ï¼Œv1 ç‰ˆæœ¬ä»ç„¶ä¿ç•™ä½¿ç”¨</span><br><span class="hljs-attr">name:</span> <span class="hljs-comment"># å¿…éœ€: chartåç§°</span><br><span class="hljs-attr">version:</span> <span class="hljs-comment"># å¿…éœ€: chart çš„ç‰ˆæœ¬æ§åˆ¶æ ‡è¯†</span><br><span class="hljs-attr">kubeVersion:</span> <span class="hljs-comment"># å¯é€‰: å…¼å®¹Kubernetesç‰ˆæœ¬çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ï¼Œå½¢å¼å¦‚ &gt;= 1.13.0 &lt; 1.15.0</span><br><span class="hljs-attr">description:</span> <span class="hljs-comment"># å¯é€‰: å¯¹äºè¿™ä¸ª chart çš„æè¿°ä¿¡æ¯</span><br><span class="hljs-attr">type:</span> <span class="hljs-comment"># å¯é€‰: chartç±»å‹, æ”¯æŒ2ç§ç±»å‹ï¼Œapplication å’Œ libraryï¼Œé»˜è®¤ä½¿ç”¨ application</span><br><span class="hljs-attr">keywords:</span><span class="hljs-comment"># å¯é€‰: å…³äºé¡¹ç›®çš„ä¸€ç»„å…³é”®å­—</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br><span class="hljs-attr">home:</span> <span class="hljs-comment"># å¯é€‰: é¡¹ç›®homeé¡µé¢çš„URL</span><br><span class="hljs-attr">sources:</span><span class="hljs-comment"># å¯é€‰: é¡¹ç›®æºç çš„URLåˆ—è¡¨</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br><span class="hljs-attr">dependencies:</span> <span class="hljs-comment"># å¯é€‰: chart çš„ä¾èµ–é¡¹ï¼Œæ‰§è¡Œ `helm dep up &lt;chart_name&gt;` æ›´æ–°ä¾èµ–ï¼Œä¾èµ–çš„ chartåŒ… ä¼šä¸‹è½½è‡³ charts/ </span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-comment"># chartåç§°, å¦‚ nginx</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-comment"># chartç‰ˆæœ¬, å¦‚ &quot;1.2.3&quot;</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-comment"># å¯é€‰: ä»“åº“çš„å®Œæ•´URL (&quot;https://example.com/charts&quot;) æˆ–åˆ«å (&quot;@repo-name&quot;)</span><br>    <span class="hljs-attr">condition:</span> <span class="hljs-comment"># å¯é€‰: è§£æä¸ºå¸ƒå°”å€¼çš„yamlè·¯å¾„ï¼Œç”¨äºå¯ç”¨/ç¦ç”¨chart (e.g. subchart1.enabled )</span><br>    <span class="hljs-attr">tags:</span> <span class="hljs-comment"># å¯é€‰: ç”¨äºä¸€æ¬¡å¯ç”¨/ç¦ç”¨ ä¸€ç»„chartçš„tag</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br>    <span class="hljs-attr">import-values:</span>  <span class="hljs-comment"># å¯é€‰: ä¿å­˜æºå€¼åˆ°å¯¼å…¥çˆ¶é”®çš„æ˜ å°„ã€‚æ¯é¡¹å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…ä¸€å¯¹å­/çˆ¶åˆ—è¡¨é¡¹</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ImportValue</span>  <br>    <span class="hljs-attr">alias:</span> <span class="hljs-comment"># å¯é€‰: ä¾èµ– chart çš„åˆ«åã€‚å½“ä½ è¦å¤šæ¬¡æ·»åŠ ç›¸åŒçš„chartæ—¶ä¼šå¾ˆæœ‰ç”¨</span><br><span class="hljs-attr">maintainers:</span> <span class="hljs-comment"># å¯é€‰: ç»´æŠ¤è€…ä¿¡æ¯</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-comment"># ç»´æŠ¤è€…åå­— ï¼ˆæ¯ä¸ªç»´æŠ¤è€…éƒ½éœ€è¦ï¼‰</span><br>    <span class="hljs-attr">email:</span> <span class="hljs-comment"># ç»´æŠ¤è€…é‚®ç®± ï¼ˆæ¯ä¸ªç»´æŠ¤è€…å¯é€‰ï¼‰</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-comment"># ç»´æŠ¤è€…URL ï¼ˆæ¯ä¸ªç»´æŠ¤è€…å¯é€‰ï¼‰</span><br><span class="hljs-attr">icon:</span> <span class="hljs-comment"># å¯é€‰: ç”¨åšiconçš„SVGæˆ–PNGå›¾ç‰‡URL</span><br><span class="hljs-attr">appVersion:</span> <span class="hljs-comment"># å¯é€‰: ä¸ç‰ˆæœ¬æ§åˆ¶çš„ version æ— å…³ï¼Œç”¨äºæŒ‡å®šåº”ç”¨çš„ç‰ˆæœ¬</span><br><span class="hljs-attr">deprecated:</span> <span class="hljs-comment"># å¯é€‰: æ ‡è®°è¯¥ chart å·²åºŸå¼ƒï¼Œä½¿ç”¨æ–¹æ³•ä¸ºå¸ƒå°”å€¼</span><br><span class="hljs-attr">annotations:</span><br>  <span class="hljs-attr">example:</span> <span class="hljs-comment"># å¯é€‰: æŒ‰åç§°è¾“å…¥çš„æ‰¹æ³¨åˆ—è¡¨</span><br></code></pre></td></tr></table></figure><h4 id="1ï¼‰ä½¿ç”¨-dependencies-è¡¨è¾¾å¼ç®¡ç†ä¾èµ–"><a href="#1ï¼‰ä½¿ç”¨-dependencies-è¡¨è¾¾å¼ç®¡ç†ä¾èµ–" class="headerlink" title="1ï¼‰ä½¿ç”¨ dependencies è¡¨è¾¾å¼ç®¡ç†ä¾èµ–"></a>1ï¼‰ä½¿ç”¨ dependencies è¡¨è¾¾å¼ç®¡ç†ä¾èµ–</h4><h5 id="1-åŸºæœ¬åŸåˆ™"><a href="#1-åŸºæœ¬åŸåˆ™" class="headerlink" title="1. åŸºæœ¬åŸåˆ™"></a>1. åŸºæœ¬åŸåˆ™</h5><p>Helm3 ä¸­ï¼Œå¼ƒç”¨äº† <code>requeirements.yaml</code> ï¼Œ<code>dependencies</code> å­—æ®µè¢«åˆå¹¶è‡³äº† <code>Chart.yaml</code> ä¸­ï¼Œä½†æ˜¯å°±è¯­æ³•è¡¨è¾¾å¼æ¥è¯´ï¼Œå’Œä¹‹å‰æ²¡æœ‰å¤ªå¤§çš„å˜åŒ–ã€‚ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼ ansible çš„ playbook æˆ– docker composeï¼Œå…¶è¡¨è¾¾å¼å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">2.0</span><span class="hljs-number">.1</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">https://example.com/charts</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">3.2</span><span class="hljs-number">.1</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">https://another.example.com/charts</span><br></code></pre></td></tr></table></figure><blockquote><ul><li><p><code>name</code> å­—æ®µï¼šæ‰€éœ€ä¾èµ– chart çš„åç§°</p></li><li><p><code>version</code> å­—æ®µï¼šæ‰€éœ€ä¾èµ– chart çš„ç‰ˆæœ¬</p></li><li><p><code>repository</code> å­—æ®µï¼šchart ä»“åº“çš„å®Œæ•´ URL æˆ–è€… ä»“åº“çš„åç§°</p><p>ä½¿ç”¨ URL ï¼š<code>https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</code></p><p>ä½¿ç”¨ ä»“åº“åç§°ï¼š<code>@stable</code></p></li></ul><p>ğŸš©  ä»“åº“å¿…é¡»äº‹å…ˆä½¿ç”¨ <code>helm repo add</code> æ·»åŠ ï¼Œæ‰§è¡Œç±»ä¼¼å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo add stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts<br></code></pre></td></tr></table></figure></blockquote><h5 id="2-ç¤ºä¾‹è¯´æ˜"><a href="#2-ç¤ºä¾‹è¯´æ˜" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜"></a>2. ç¤ºä¾‹è¯´æ˜</h5><h6 id="1âƒ£ï¸-æ·»åŠ ä»“åº“"><a href="#1âƒ£ï¸-æ·»åŠ ä»“åº“" class="headerlink" title="1âƒ£ï¸ æ·»åŠ ä»“åº“"></a>1âƒ£ï¸ æ·»åŠ ä»“åº“</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo add bitnami https://charts.bitnami.com/bitnami  <br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-å†™ä¾èµ–è¡¨è¾¾å¼"><a href="#2âƒ£ï¸-å†™ä¾èµ–è¡¨è¾¾å¼" class="headerlink" title="2âƒ£ï¸ å†™ä¾èµ–è¡¨è¾¾å¼"></a>2âƒ£ï¸ å†™ä¾èµ–è¡¨è¾¾å¼</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">9.3</span><span class="hljs-number">.3</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">&quot;@bitnami&quot;</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mariadb</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">2.1</span><span class="hljs-number">.6</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">&quot;@bitnami&quot;</span><br></code></pre></td></tr></table></figure><h6 id="3âƒ£ï¸-æ›´æ–°ä¾èµ–"><a href="#3âƒ£ï¸-æ›´æ–°ä¾èµ–" class="headerlink" title="3âƒ£ï¸ æ›´æ–°ä¾èµ–"></a>3âƒ£ï¸ æ›´æ–°ä¾èµ–</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm dependency update<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210702105136710.png" alt="image-20210702105136710"></p><p>ä¾èµ–çš„ chart åŒ… ä¼šè¢«ä¸‹è½½åˆ° <code>charts/</code> ç›®å½•ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210702105157112.png" alt="image-20210702105157112"></p><h4 id="2ï¼‰é€šè¿‡-charts-ç›®å½•æ‰‹åŠ¨ç®¡ç†ä¾èµ–"><a href="#2ï¼‰é€šè¿‡-charts-ç›®å½•æ‰‹åŠ¨ç®¡ç†ä¾èµ–" class="headerlink" title="2ï¼‰é€šè¿‡ charts/ ç›®å½•æ‰‹åŠ¨ç®¡ç†ä¾èµ–"></a>2ï¼‰é€šè¿‡ charts/ ç›®å½•æ‰‹åŠ¨ç®¡ç†ä¾èµ–</h4><p>Helm æä¾›äº†ä¸¤ç§ç®¡ç†ä¾èµ–çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯å¦‚ä¸Šæ‰€è¿°çš„ <code>dependencies</code> è¡¨è¾¾å¼ï¼Œå®ƒä¼šéµå¾ªè¯­æ³•åŸåˆ™ï¼Œè‡ªåŠ¨çš„ç®¡ç†ä¾èµ–ï¼Œä¾èµ–åŒ…ä¼šè¢«ä¸‹è½½åˆ° <code>charts/</code> ä¸­ï¼›å¦ä¸€ç§æ–¹å¼å°±æ˜¯é€šè¿‡ <code>charts/</code> ç›®å½•æ¥æ‰‹åŠ¨ç®¡ç†ä¾èµ–ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å¯¹ä¾èµ–çš„ chart åšæ›´å¤šçš„è‡ªå®šä¹‰è®¾ç½®ã€‚</p><h5 id="1-åŸºæœ¬åŸåˆ™-1"><a href="#1-åŸºæœ¬åŸåˆ™-1" class="headerlink" title="1. åŸºæœ¬åŸåˆ™"></a>1. åŸºæœ¬åŸåˆ™</h5><blockquote><ul><li><code>charts/</code> ä¸‹ç®¡ç†çš„ä¾èµ–å¿…é¡»æ˜¯ä¸€ä¸ª <strong>chart åŒ…</strong> ï¼ˆ<code>xxx-1.0.1.tgz</code>ï¼‰æˆ–æ˜¯ä¸€ä¸ªè§£å‹çš„ <strong>chart ç›®å½•</strong></li><li><strong>ä¾èµ–çš„åç§°ä¸èƒ½ä»¥ <code>_</code> æˆ– <code>.</code> å¼€å¤´</strong>ï¼Œå¦åˆ™ä¼šè¢« chart åŠ è½½å™¨å¿½ç•¥</li><li>å¯ä»¥ä½¿ç”¨ <code>helm pull</code> å°†ä¾èµ–ä¸‹è½½åˆ° <code>charts/</code>ä¸‹</li></ul></blockquote><h5 id="2-ç¤ºä¾‹è¯´æ˜-1"><a href="#2-ç¤ºä¾‹è¯´æ˜-1" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜"></a>2. ç¤ºä¾‹è¯´æ˜</h5><p>æ¯”å¦‚ WordPress çš„ chart ä¾èµ– Apache å’Œ mariadbï¼Œå…¶ç›®å½•å½¢å¼åº”è¯¥å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">wordpress:<br>  Chart.yaml<br><span class="hljs-meta">  #</span><span class="bash"> ...</span><br>  charts/<br>    apache/<br>      Chart.yaml<br>      # ...<br>    mariadb/<br>      Chart.yaml<br>      # ...<br>    memcached/<br>    Chart.yaml<br>      # ...<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰dependencies-ä¸­-condition-å’Œ-tags-ä½¿ç”¨é‡Šä¹‰"><a href="#3ï¼‰dependencies-ä¸­-condition-å’Œ-tags-ä½¿ç”¨é‡Šä¹‰" class="headerlink" title="3ï¼‰dependencies ä¸­ condition å’Œ tags ä½¿ç”¨é‡Šä¹‰"></a>3ï¼‰dependencies ä¸­ condition å’Œ tags ä½¿ç”¨é‡Šä¹‰</h4><h5 id="1-åŸºæœ¬åŸåˆ™ï¼š"><a href="#1-åŸºæœ¬åŸåˆ™ï¼š" class="headerlink" title="1. åŸºæœ¬åŸåˆ™ï¼š"></a>1. åŸºæœ¬åŸåˆ™ï¼š</h5><blockquote><ul><li><p>æ¡ä»¶ï¼ˆconditionï¼‰ä¼˜å…ˆ</p><p>å½“è®¾ç½® value æ—¶ï¼Œå¦‚æœåŒæ—¶å­˜åœ¨ <code>condition</code> å’Œ <code>tags</code> çš„å€¼ï¼Œé‚£ä¹ˆ <code>condition</code> çš„æ•ˆæœä¼šè¦†ç›– <code>tags</code> çš„æ•ˆæœã€‚</p></li><li><p>æ ‡ç­¾ï¼ˆtagsï¼‰æœ€å°åŒ–å…ƒç´ </p><p>å½“ <code>tags</code> ä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ çš„å€¼è¢«è®¾ç½®ä¸º <code>true</code> æ—¶ï¼Œå¸¦æœ‰è¯¥ <code>tags</code> çš„ chart å°±ä¼šè¢«å¯ç”¨ã€‚</p></li><li><p><code>condition</code> å’Œ <code>tags</code> åœ¨ values.yaml ä¸­å¿…éœ€åœ¨ç¼©è¿›çš„æœ€é¡¶å±‚</p></li><li><p><code>tags</code> åœ¨ values.yaml ä¸­éœ€ä»¥ä»¥ä¸‹å½¢å¼:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tags:</span><br>  <span class="hljs-string">xxx</span><br>  <span class="hljs-string">xxx</span><br></code></pre></td></tr></table></figure></li></ul></blockquote><h5 id="2-ç¤ºä¾‹è¯´æ˜ï¼š"><a href="#2-ç¤ºä¾‹è¯´æ˜ï¼š" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜ï¼š"></a>2. ç¤ºä¾‹è¯´æ˜ï¼š</h5><p>æ–‡ä»¶: <code>test_chart/Chart.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart1</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">condition:</span> <span class="hljs-string">subchart1.enabled,</span> <span class="hljs-string">global.subchart1.enabled</span><br>    <span class="hljs-attr">tags:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">front-end</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">subchart1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart2</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">condition:</span> <span class="hljs-string">subchart2.enabled,global.subchart2.enabled</span><br>    <span class="hljs-attr">tags:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">back-end</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">subchart2</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶: <code>test_chart/values.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">subchart1:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¡¨è¾¾å¼è¡¨ç¤ºï¼Œ<code>condition</code> ä¸­å¸¦æœ‰ <code>subchart1</code> çš„ chart ä¼šè¢«å¯åŠ¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tags:</span><br>  <span class="hljs-attr">front-end:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">back-end:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¡¨è¾¾å¼è¡¨ç¤ºï¼Œ<code>tags</code> ä¸­å¸¦æœ‰ <code>back-end</code> çš„ chart ä¼šè¢«å¯åŠ¨ï¼Œè€Œå¸¦æœ‰ <code>front-end</code> çš„åˆ™ä¸ä¼šè¢«å¯åŠ¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">subchart1:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">tags:</span><br>  <span class="hljs-attr">front-end:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">back-end:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¡¨è¾¾å¼ï¼Œå½“ <code>condition</code> å’Œ <code>tags</code> ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæ˜¯ä¼šå‘ç”Ÿæ•ˆæœè¦†ç›–çš„ï¼Œæ¯”å¦‚ï¼Œè™½ç„¶ <code>front-end</code> è®¾ç½®ä¸ºäº† <code>false</code>ï¼Œä½†æ˜¯ç”±äº <code>subchart1.enabled</code> è®¾ç½®ä¸º <code>true</code>ï¼Œæ¡ä»¶å‘ç”Ÿè¦†ç›–ï¼Œæ‰€ä»¥ chart <code>subchart1</code> è¿˜æ˜¯ä¼šè¢«å¯ç”¨ã€‚</p><p>è€Œå½“ <code>back-end</code> è®¾ç½®ä¸º <code>true</code> çš„æ—¶å€™ï¼Œæ¡ä»¶è¯»å–çš„å°±æ˜¯ <code>back-end: true</code> ï¼Œå› æ­¤ï¼Œå³ä½¿æ²¡æœ‰è®¾ç½® <code>subchart2.enabled</code> ä¸º <code>true</code>ï¼Œchart <code>subchart2</code> ä¹Ÿä¼šè¢«å¯ç”¨ã€‚</p><h4 id="4ï¼‰dependencies-ä¸­çš„-alias-ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰"><a href="#4ï¼‰dependencies-ä¸­çš„-alias-ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰" class="headerlink" title="4ï¼‰dependencies  ä¸­çš„ alias ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰"></a>4ï¼‰dependencies  ä¸­çš„ alias ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰</h4><h5 id="1-åŸºæœ¬åŸåˆ™-2"><a href="#1-åŸºæœ¬åŸåˆ™-2" class="headerlink" title="1. åŸºæœ¬åŸåˆ™"></a>1. åŸºæœ¬åŸåˆ™</h5><p>åœ¨ <code>dependencies</code> çš„è¡¨è¾¾å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>alias</code> å¯¹éœ€æ±‚é¡¹æ·»åŠ åˆ«åï¼Œå½“å­˜åœ¨ä¾èµ–å¤šæ¬¡å¤ç”¨çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡åˆ«åçš„æ–¹å¼æ¥è®¿é—®è¯¥éœ€æ±‚é¡¹ï¼Œä»¥æ­¤åŠ ä»¥åŒºåˆ†ã€‚ï¼ˆæ¯”å¦‚ æ•°æ®åº“çš„ä¸»ä»ã€é›†ç¾¤ç­‰ä½¿ç”¨åœºæ™¯ï¼‰</p><h5 id="2-ç¤ºä¾‹è¯´æ˜-2"><a href="#2-ç¤ºä¾‹è¯´æ˜-2" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜"></a>2. ç¤ºä¾‹è¯´æ˜</h5><p>æ–‡ä»¶: <code>parent_chart/Chart.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">alias:</span> <span class="hljs-string">new-subchart-1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">alias:</span> <span class="hljs-string">new-subchart-2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šæƒ…å†µï¼Œ<code>parent_chart</code> ä¸­ç›¸å½“äºæœ‰ 3 ä¸ªä¾èµ–é¡¹ï¼Œ<code>subchart</code>ã€<code>new-subchart-1</code> ã€<code>new-subchart-2</code> ï¼Œè™½ç„¶ä»–ä»¬æ˜¯åŸºäºåŒä¸€ä¸ª chart çš„ï¼Œä½†æ˜¯å¯ä»¥è¢«åŒºåˆ«å¯¹å¾…ã€‚</p><h4 id="5ï¼‰dependencies-ä¸­çš„-import-values-ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰"><a href="#5ï¼‰dependencies-ä¸­çš„-import-values-ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰" class="headerlink" title="5ï¼‰dependencies  ä¸­çš„ import-values ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰"></a>5ï¼‰dependencies  ä¸­çš„ import-values ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰</h4><p>ä»ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ <code>charts/</code> ç›®å½•ä¸‹é¢ç®¡ç†çš„å…¶å®ä¹Ÿæ˜¯ chartï¼Œé‚£ä¹ˆå®ƒå°±ä¼šéµå¾ª chart çš„åŸåˆ™ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œç›®å½•ç»“æ„å°±æ˜¯ä¸€ç§  <code>çˆ¶-å­</code> çš„å…³ç³»ã€‚åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦è¯»å– <em>å­ char</em> çš„å€¼ï¼ŒHelm åˆ™æä¾›äº† <code>import-values</code> è¿™æ ·ä¸€ç§å®ç°æ–¹å¼ã€‚</p><h5 id="1-åŸºæœ¬åŸåˆ™-3"><a href="#1-åŸºæœ¬åŸåˆ™-3" class="headerlink" title="1. åŸºæœ¬åŸåˆ™"></a>1. åŸºæœ¬åŸåˆ™</h5><blockquote><ul><li><p>ç›®å½•ç»“æ„å’Œæ–‡ä»¶å…³ç³»å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">parent_chart:# çˆ¶ chart<br>  Chart.yaml# dependencies - child_chart - import-values - Key<br><span class="hljs-meta">  #</span><span class="bash"> ...</span><br>  charts/<br>    child_chart/# å­ chart<br>      Chart.yaml<br>      values.yaml# exports - Key - value<br>      # ...<br></code></pre></td></tr></table></figure></li><li><p>åŠ è½½å™¨ä¼šæ ¹æ® <code>dependencies - name</code> æ‰¾ <em>å­ chart</em>ï¼Œæ ¹æ® <code>dependencies - import-values</code> çš„ key è§£æ <em>å­ chart</em> ä¸­å¯¹åº”çš„å€¼</p></li><li><p>åŠ è½½å™¨é»˜è®¤è¯†åˆ« <code>exports</code></p></li><li><p>æ²¡æœ‰ <code>exports</code> ï¼Œéœ€è¦ä»¥ <code>parent-child</code> æ–¹å¼æ˜ç¡®æŒ‡æ˜è¦æ³¨å…¥çš„ <em>å­ chart</em> çš„å€¼çš„ Key å’Œ è¦è¢«æ³¨å…¥çš„ <em>çˆ¶ chart</em> çš„å€¼çš„åç§°</p></li><li><p>import <em>å­ chart</em> æ‰€å¾—çš„å€¼æœ€ç»ˆä¼šè¢«åˆå¹¶å…¥ <em>çˆ¶ chart</em> çš„ values ä¸­ï¼Œå¹¶ä¼šè¦†ç›–åŸæœ‰é”®å€¼</p></li></ul></blockquote><h5 id="2-ç¤ºä¾‹è¯´æ˜-3"><a href="#2-ç¤ºä¾‹è¯´æ˜-3" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜"></a>2. ç¤ºä¾‹è¯´æ˜</h5><h6 id="1âƒ£ï¸-ä½¿ç”¨-exports-çš„æ–¹å¼"><a href="#1âƒ£ï¸-ä½¿ç”¨-exports-çš„æ–¹å¼" class="headerlink" title="1âƒ£ï¸ ä½¿ç”¨ exports çš„æ–¹å¼"></a>1âƒ£ï¸ ä½¿ç”¨ <code>exports</code> çš„æ–¹å¼</h6><p>æ–‡ä»¶:  <code>parent_chart/Chart.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">child_chart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">import-values:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data</span><span class="hljs-comment"># å¼•ç”¨å­ chart çš„å˜é‡ - data</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶: <code>parent_chart/charts/child_chart/values.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">exports:</span><span class="hljs-comment"># å£°æ˜å˜é‡ data</span><br><span class="hljs-attr">data:</span><br><span class="hljs-attr">port:</span> <span class="hljs-number">3306</span><br></code></pre></td></tr></table></figure><p>Helm ä¼šåœ¨ <code>import-values</code> çš„åˆ—è¡¨åˆ°å…¥å†…å®¹æ—¶ï¼Œå°†å…¶ä¸­çš„å…ƒç´ ä½œä¸º Keyï¼Œå¹¶ä»¥æ­¤åˆ° <em>å­ chart</em> çš„ <code>exports</code> å­—æ®µæŸ¥æ‰¾å¯¹åº”çš„ Keyï¼Œå¹¶å°†å¯¹åº”çš„ value æ³¨å…¥ <em>çˆ¶ chart</em>  çš„ values ä¸­ï¼Œæ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬å¯ä»¥åœ¨ <em>çˆ¶ chart</em> ä¸­å¯è·å–åˆ°çš„å€¼ä¸ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">port:</span> <span class="hljs-number">3306</span><br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-ä½¿ç”¨-parent-â€”-child-çš„æ–¹å¼"><a href="#2âƒ£ï¸-ä½¿ç”¨-parent-â€”-child-çš„æ–¹å¼" class="headerlink" title="2âƒ£ï¸ ä½¿ç”¨ parent â€” child çš„æ–¹å¼"></a>2âƒ£ï¸ ä½¿ç”¨ <code>parent â€” child</code> çš„æ–¹å¼</h6><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>å¦‚æœåœ¨ <em>å­ chart</em> çš„ values.yaml ä¸­æ²¡æœ‰ä½¿ç”¨ <code>exports</code> ï¼Œå°±å¿…é¡»æŒ‡å®šè¦æ³¨å…¥çš„ <em>å­ chart</em> å€¼çš„ æºKey ä»¥åŠ è¢«æ³¨å…¥çš„ <em>çˆ¶ chart</em> çš„å€¼çš„åç§°ã€‚</p></blockquote><p>æ–‡ä»¶: <code>parent_chart/Chart.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">child_chart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-string">...</span><br>    <span class="hljs-attr">import-values:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">child:</span> <span class="hljs-string">default.data</span><br>        <span class="hljs-attr">parent:</span> <span class="hljs-string">myimports</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶: <code>parent_chart/charts/child_chart/values.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">default:</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">myint:</span> <span class="hljs-number">999</span><br>    <span class="hljs-attr">mybool:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶: <code>parent_chart/values.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">myimports:</span><br>  <span class="hljs-attr">myint:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">mybool:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">mystring:</span> <span class="hljs-string">&quot;helm tests!&quot;</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¿°ç¤ºä¾‹ï¼Œ<code>import-values</code> çš„åŠ è½½å™¨ï¼Œæ ¹æ® <code>child</code> å» child_chart çš„ values.yaml ä¸­æ‰¾ <code>default - data</code> ï¼Œå¹¶è§£æå‡ºå…¶å€¼ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ° <em>çˆ¶ chart</em> ä¸­ï¼Œå¹¶ä¼šè¦†ç›–åŸæœ‰çš„é”®å€¼ï¼Œç”±æ­¤ <em>çˆ¶ chart</em> æœ€ç»ˆçš„ values ä¼šåˆå¹¶å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">myimports:</span><br>  <span class="hljs-attr">myint:</span> <span class="hljs-number">999</span><br>  <span class="hljs-attr">mybool:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">mystring:</span> <span class="hljs-string">&quot;helm tests!&quot;</span><br></code></pre></td></tr></table></figure><h3 id="3ã€templates-å’Œ-values-yaml"><a href="#3ã€templates-å’Œ-values-yaml" class="headerlink" title="3ã€templates/ å’Œ values.yaml"></a>3ã€templates/ å’Œ values.yaml</h3><h4 id="1ï¼‰Values-çš„ç”Ÿæ•ˆæœºåˆ¶"><a href="#1ï¼‰Values-çš„ç”Ÿæ•ˆæœºåˆ¶" class="headerlink" title="1ï¼‰Values çš„ç”Ÿæ•ˆæœºåˆ¶"></a>1ï¼‰Values çš„ç”Ÿæ•ˆæœºåˆ¶</h4><p>Values é€šè¿‡æ¨¡æ¿ä¸­<code>.Values</code>å¯¹è±¡å¯è®¿é—®çš„<code>values.yaml</code>æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>.Chart</code> å¯¹è±¡å¯è®¿é—®çš„ <code>Chart.yaml</code> ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦å¤– ï¼ŒHelm ä¸­æœ‰ä¸€äº›é¢„å®šä¹‰çš„ valuesï¼Œå¯ä»¥å°†å…¶è§†ä¸ºç¯å¢ƒå˜é‡ï¼Œå…·ä½“å¦‚ä¸‹:</p><blockquote><ul><li><p><strong>Release</strong></p><p>è¯¥å¯¹è±¡æè¿°äº†ç‰ˆæœ¬å‘å¸ƒæœ¬èº«ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ<code>&#123;&#123; .Release.Name &#125;&#125;</code> (è·å– release çš„åç§°)</p></li><li><p><strong>.Values</strong></p><p>è®¿é—® <code>values.yaml</code> çš„å†…å®¹ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ<code>&#123;&#123; .Values.image.repository &#125;&#125;</code> (è·å– values.yaml ä¸­ <code>image - repository</code> çš„å€¼)</p></li><li><p><strong>.Chart</strong></p><p>è®¿é—® <code>Chart.yaml</code> çš„å†…å®¹ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ <code>&#123;&#123; .Chart.Version &#125;&#125;</code> (è·å¾— chart çš„ç‰ˆæœ¬)ã€<code>&#123;&#123; .Chart.Maintainers &#125;&#125;</code> (è·å– chart çš„ç»´æŠ¤è€…) </p><p>è¯­æ³•é£æ ¼éµå¾ª go æ¨¡ç‰ˆè§„åˆ™ï¼Œç±»ä¼¼ jinja2ã€‚æ˜¯ä¸€ç§å±‚çº§æ£€ç´¢çš„æ–¹å¼ï¼Œ<code>.</code> è¡¨ç¤ºå±‚çº§ï¼Œæœ€é¡¶å±‚çš„ <code>.</code> å³ <code>æ ¹</code> ã€‚</p></li><li><p><strong>.Files</strong></p><p>è®¿é—® chart ä¸­å­˜åœ¨çš„æ–‡ä»¶çš„å†…å®¹ (<code>.helmignore</code> é™¤å¤–)ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ<code>&#123;&#123; index .Files "file.name" &#125;&#125;</code> (è·å–è¯¥æ–‡ä»¶ä¸­ <code>name</code>çš„å€¼)ï¼Œå®ƒç­‰æ•ˆäº <code>&#123;&#123; .Files.Get name &#125;&#125;</code> æ–¹æ³•ã€‚</p><p><code>&#123;&#123; .Files.GetBytes &#125;&#125;</code> æ–¹æ³•ç­‰æ•ˆäºè®¿é—®æ–‡ä»¶ä¸­çš„ <code>[]byte</code> å¯¹è±¡</p></li><li><p><strong>.Capabilities</strong></p><p>è®¿é—® K8s çš„ <code>Capabilities</code> å¯¹è±¡ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ<code>&#123;&#123; .Capabilities.KubeVersion &#125;&#125;</code> (è·å– K8s ç‰ˆæœ¬)ã€<code>&#123;&#123; .Capabilities.APIVersions.Has "batch/v1" &#125;&#125;</code>(è·å–æ”¯æŒçš„ K8s API ç‰ˆæœ¬)</p></li></ul></blockquote><h4 id="2ï¼‰templates-ä¸­çš„æ¨¡ç‰ˆ"><a href="#2ï¼‰templates-ä¸­çš„æ¨¡ç‰ˆ" class="headerlink" title="2ï¼‰templates/ ä¸­çš„æ¨¡ç‰ˆ"></a>2ï¼‰templates/ ä¸­çš„æ¨¡ç‰ˆ</h4><p>æ¨¡æ¿æ–‡ä»¶éµå®ˆä¹¦å†™Goæ¨¡æ¿çš„æ ‡å‡†æƒ¯ä¾‹ï¼ˆæŸ¥çœ‹ <a href="https://golang.org/pkg/text/template/">æ–‡æœ¬/æ¨¡æ¿ Go åŒ…æ–‡æ¡£</a>äº†è§£æ›´å¤šï¼‰ã€‚ä»¥å‘å¸ƒä¸€ä¸ª nginx çš„ <code>templates/deployment.yaml</code> çš„ç¤ºä¾‹æ¨¡ç‰ˆä¸ºä¾‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span>  &#125;&#125;<br><span class="hljs-attr">spec:</span><br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">not</span> <span class="hljs-string">.Values.autoscaling.enabled</span> &#125;&#125;<br>  <span class="hljs-attr">replicas:</span> &#123;&#123; <span class="hljs-string">.Values.replicaCount</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span> &#125;&#125;<br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span> &#125;&#125;<br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">imagePullSecrets:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harborsecret</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span> &#125;&#125;<br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; .Values.image.repository &#125;&#125;</span>:<span class="hljs-template-variable">&#123;&#123; .Values.image.tag &#125;&#125;</span>&quot;</span><br>          <span class="hljs-attr">imagePullPolicy:</span> &#123;&#123; <span class="hljs-string">.Values.image.pullPolicy</span> &#125;&#125;<br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> &#123;&#123; <span class="hljs-string">.Values.service.port</span> &#125;&#125;<br>              <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">resources:</span><br>            &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.resources</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">12</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.nodeSelector</span> &#125;&#125;<br>      <span class="hljs-attr">nodeSelector:</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">8</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.affinity</span> &#125;&#125;<br>      <span class="hljs-attr">affinity:</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">8</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.tolerations</span> &#125;&#125;<br>      <span class="hljs-attr">tolerations:</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">8</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰å–å€¼-values-yaml-æ¸²æŸ“æ¨¡ç‰ˆ"><a href="#3ï¼‰å–å€¼-values-yaml-æ¸²æŸ“æ¨¡ç‰ˆ" class="headerlink" title="3ï¼‰å–å€¼ values.yaml æ¸²æŸ“æ¨¡ç‰ˆ"></a>3ï¼‰å–å€¼ values.yaml æ¸²æŸ“æ¨¡ç‰ˆ</h4><p>æ ¹æ®å¦‚ä¸Šæ¨¡ç‰ˆçš„å˜é‡å…³ç³»ï¼Œè¿›è¡Œå¯¹åº”æ–‡ä»¶ value çš„é…ç½®ï¼Œæ¶‰åŠåˆ° <code>Chart.yaml</code> å’Œ <code>values.yaml</code> ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><h5 id="1-Chart-yaml-çš„å¿…è¦å€¼"><a href="#1-Chart-yaml-çš„å¿…è¦å€¼" class="headerlink" title="1. Chart.yaml çš„å¿…è¦å€¼"></a>1. <code>Chart.yaml</code> çš„å¿…è¦å€¼</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v2</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">A</span> <span class="hljs-string">Helm</span> <span class="hljs-string">chart</span> <span class="hljs-string">for</span> <span class="hljs-string">Kubernetes</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">application</span><br><span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br><span class="hljs-attr">appVersion:</span> <span class="hljs-string">&quot;1.16.0&quot;</span><br></code></pre></td></tr></table></figure><h5 id="2-values-yaml-çš„å¿…è¦å€¼"><a href="#2-values-yaml-çš„å¿…è¦å€¼" class="headerlink" title="2. values.yaml çš„å¿…è¦å€¼"></a>2. <code>values.yaml</code> çš„å¿…è¦å€¼</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">replicaCount:</span> <span class="hljs-number">1</span><br><br><span class="hljs-attr">image:</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">tag:</span> <span class="hljs-string">&quot;stable&quot;</span><br>  <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br><br><span class="hljs-attr">service:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br><br><span class="hljs-attr">resources:</span><br>  <span class="hljs-attr">limits:</span><br>    <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>    <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br>  <span class="hljs-attr">requests:</span><br>    <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>    <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br><br><span class="hljs-attr">autoscaling:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">minReplicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">100</span><br>  <span class="hljs-attr">targetCPUUtilizationPercentage:</span> <span class="hljs-number">80</span><br>  <span class="hljs-comment"># targetMemoryUtilizationPercentage: 80</span><br><br><span class="hljs-attr">nodeSelector:</span> &#123;&#125;<br><br><span class="hljs-attr">tolerations:</span> []<br><br><span class="hljs-attr">affinity:</span> &#123;&#125;<br></code></pre></td></tr></table></figure><h5 id="3-éªŒè¯æ¸²æŸ“æ•ˆæœ"><a href="#3-éªŒè¯æ¸²æŸ“æ•ˆæœ" class="headerlink" title="3. éªŒè¯æ¸²æŸ“æ•ˆæœ"></a>3. éªŒè¯æ¸²æŸ“æ•ˆæœ</h5><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ <code>helm install</code> æ—¶ä½¿ç”¨ <code>--dry-run</code> å‚æ•°æ¥åªæ¸²æŸ“æ¨¡ç‰ˆï¼Œè€Œä¸è¿›è¡Œç›´æ¥éƒ¨ç½²ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éªŒè¯æ•ˆæœäº†ã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run demo test_chart/<br></code></pre></td></tr></table></figure><p>æ¸²æŸ“åçš„ manifest å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">imagePullSecrets:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harborsecret</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;nginx:stable&quot;</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br>              <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br></code></pre></td></tr></table></figure><h4 id="4ï¼‰-set-æŒ‡å®šå‚æ•°æ¸²æŸ“"><a href="#4ï¼‰-set-æŒ‡å®šå‚æ•°æ¸²æŸ“" class="headerlink" title="4ï¼‰--set æŒ‡å®šå‚æ•°æ¸²æŸ“"></a>4ï¼‰<code>--set</code> æŒ‡å®šå‚æ•°æ¸²æŸ“</h4><p>å½“æˆ‘ä»¬åœ¨æ‰§è¡Œ <code>helm install</code> æˆ–è€… <code>helm upgrade</code> æ—¶ï¼Œé™¤äº†ç›´æ¥é€šè¿‡ <em>values.yaml</em> æ¸²æŸ“å¤–ï¼Œä¹Ÿæ”¯æŒç›´æ¥åœ¨å‘½ä»¤è¡Œé€šè¿‡ <code>--set</code> å‚æ•°ä¼ å‚ï¼Œ<strong>ä¼ å…¥çš„å‚æ•°ä¼šè¦†ç›– <em>values.yaml</em> ä¸­çš„é¢„è®¾å€¼</strong>ã€‚</p><h5 id="ç¤ºä¾‹ï¼šé€šè¿‡-set-ä¿®æ”¹-é•œåƒç‰ˆæœ¬-å’Œ-ç«¯å£"><a href="#ç¤ºä¾‹ï¼šé€šè¿‡-set-ä¿®æ”¹-é•œåƒç‰ˆæœ¬-å’Œ-ç«¯å£" class="headerlink" title="ç¤ºä¾‹ï¼šé€šè¿‡ --set ä¿®æ”¹ é•œåƒç‰ˆæœ¬ å’Œ ç«¯å£"></a>ç¤ºä¾‹ï¼šé€šè¿‡ <code>--set</code> ä¿®æ”¹ <code>é•œåƒç‰ˆæœ¬</code> å’Œ <code>ç«¯å£</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --set image.tag=&quot;1.16.0&quot; --set service.port=9999 --dry-run demo test_chart/<br></code></pre></td></tr></table></figure><p>æ¸²æŸ“åçš„ manifest å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">imagePullSecrets:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harborsecret</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;nginx:1.16.0&quot;</span><span class="hljs-comment"># é•œåƒç‰ˆæœ¬ç”±åŸæ¥çš„ stable æ›´æ”¹ä¸º 1.16.0</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9999</span><span class="hljs-comment"># ç«¯å£ç”±åŸæ¥çš„ 80 æ›´æ”¹ä¸º 9999</span><br>              <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br></code></pre></td></tr></table></figure><h4 id="5ï¼‰é€šè¿‡-f-æŒ‡å®š-Values-æ–‡ä»¶"><a href="#5ï¼‰é€šè¿‡-f-æŒ‡å®š-Values-æ–‡ä»¶" class="headerlink" title="5ï¼‰é€šè¿‡ -f æŒ‡å®š Values æ–‡ä»¶"></a>5ï¼‰é€šè¿‡ <code>-f</code> æŒ‡å®š Values æ–‡ä»¶</h4><p>chart é»˜è®¤çš„ Values æ–‡ä»¶å‘½åä¸º <code>values.yaml</code>ï¼Œå½“ä½ åœ¨æ‰§è¡Œ <code>helm install</code> æˆ– <code>helm upgrade</code> æ—¶ï¼Œå¦‚æœåç§°ä¸æ˜¯ <code>values.yaml</code>ï¼Œæ‰§è¡Œå°±ä¼šå‡ºé”™ã€‚<strong>é€šè¿‡å‘½ä»¤è¡Œ <code>-f</code> å‚æ•°ï¼Œå¯ä»¥æŒ‡å®š Values æ–‡ä»¶</strong>ï¼Œè¿™æ ·æ–‡ä»¶çš„åç§°å°±ä¸å—é™åˆ¶äº†ã€‚</p><h5 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5><p>åˆ›å»ºæ–‡ä»¶ <code>test_chart/demo.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell">replicaCount: 1<br><br>image:<br>  repository: mysql<br>  tag: &quot;8.7.0&quot;<br>  pullPolicy: IfNotPresent<br><br>service:<br>  type: ClusterIP<br>  port: 3306<br><br>resources:<br>  limits:<br>    cpu: 100m<br>    memory: 128Mi<br>  requests:<br>    cpu: 100m<br>    memory: 128Mi<br><br>autoscaling:<br>  enabled: false<br>  minReplicas: 1<br>  maxReplicas: 100<br>  targetCPUUtilizationPercentage: 80<br><span class="hljs-meta">  #</span><span class="bash"> targetMemoryUtilizationPercentage: 80</span><br><br>nodeSelector: &#123;&#125;<br><br>tolerations: []<br><br>affinity: &#123;&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè¿›è¡Œæ¸²æŸ“æµ‹è¯•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install -f test_chart/demo.yaml --dry-run demo test_chart<br></code></pre></td></tr></table></figure><p>æ¸²æŸ“åçš„ manifest å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">imagePullSecrets:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harborsecret</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;mysql:8.7.0&quot;</span><span class="hljs-comment"># é•œåƒå·²æ›´æ”¹</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3306</span><span class="hljs-comment"># ç«¯å£å·²æ›´æ”¹</span><br>              <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br><br></code></pre></td></tr></table></figure><h3 id="4ã€æ¶æ„æ–‡ä»¶-values-schema-json"><a href="#4ã€æ¶æ„æ–‡ä»¶-values-schema-json" class="headerlink" title="4ã€æ¶æ„æ–‡ä»¶ values.schema.json"></a>4ã€æ¶æ„æ–‡ä»¶ <code>values.schema.json</code></h3><p>æ˜¯å¦è¿˜è®°å¾—ï¼Œåœ¨ç¬¬1ç« ä¸­æˆ‘ä»¬ä»‹ç»è¿‡ Helm3 çš„æ–°åŠŸèƒ½ä¸­å¢åŠ äº† <code>ä½¿ç”¨JSON Schema</code> æ¥éªŒè¯ Chart çš„ Values çš„æœºåˆ¶ï¼Ÿäº‹å®ä¸Šï¼Œå®ƒåœ¨ Chart çš„è¡¨ç°å°±æ˜¯ <code>values.schema.json</code> æ–‡ä»¶ã€‚åœ¨å…¶ä¸­<code>required</code> å¯ä»¥ç”¨äºå®šä¹‰å“ªäº›å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œ<code>type</code> å¯ç”¨ç”¨äºå®šä¹‰å“ªäº›å­—æ®µéœ€è¦æ˜¯ä»€ä¹ˆå­—æ®µç±»å‹ç­‰ã€‚</p><blockquote><p>ğŸš© <strong>å½“æˆ‘ä»¬åœ¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ—¶ï¼ŒHelm å°†ä¼šä»¥è¯¥ Json å®šä¹‰çš„æ¶æ„æ ¼å¼å»éªŒè¯ .Values å¯¹è±¡æ˜¯å¦ç¬¦åˆè§„æ ¼ï¼Œåªæœ‰å½“éªŒè¯é€šè¿‡åï¼Œæ‰èƒ½æ­£å¸¸å‘é€ç»™ K8s æ‰§è¡Œã€‚</strong></p><ul><li>helm install</li><li>helm upgrade</li><li>helm lint</li><li>helm template</li></ul></blockquote><h4 id="1ï¼‰æ ¼å¼ç¤ºä¾‹"><a href="#1ï¼‰æ ¼å¼ç¤ºä¾‹" class="headerlink" title="1ï¼‰æ ¼å¼ç¤ºä¾‹"></a>1ï¼‰æ ¼å¼ç¤ºä¾‹</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;https://json-schema.org/draft-07/schema#&quot;</span>,<br>  <span class="hljs-attr">&quot;properties&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;image&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;Container Image&quot;</span>,<br>      <span class="hljs-attr">&quot;properties&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;repo&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span><br>        &#125;,<br>        <span class="hljs-attr">&quot;tag&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span><br>        &#125;<br>      &#125;,<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;name&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;Service name&quot;</span>,<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;port&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;Port&quot;</span>,<br>      <span class="hljs-attr">&quot;minimum&quot;</span>: <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;integer&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;protocol&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">&quot;required&quot;</span>: [<br>    <span class="hljs-string">&quot;protocol&quot;</span>,<br>    <span class="hljs-string">&quot;port&quot;</span><br>  ],<br>  <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;Values&quot;</span>,<br>  <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç¤ºä¾‹è¯´æ˜"><a href="#2ï¼‰ç¤ºä¾‹è¯´æ˜" class="headerlink" title="2ï¼‰ç¤ºä¾‹è¯´æ˜"></a>2ï¼‰ç¤ºä¾‹è¯´æ˜</h4><p><code>required</code> å­—æ®µå®šä¹‰äº† Values ä¸­å¿…è¦çš„å­—æ®µï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œå³ <code>protocol</code> å’Œ <code>port</code> ã€‚å¦å¤–ï¼Œ<code>name</code> é»˜ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œå› ä¸º <code>service name</code> æ˜¯ä¸€ä¸ª <code>Release</code> çš„å¿…è¦å…ƒç´ ï¼Œå› æ­¤ï¼Œä¸€ä¸ªç¬¦åˆè¯¥æ¶æ„è¦æ±‚çš„æœ€ç²¾ç®€ <em>values.yaml</em> åº”è¯¥å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">protocol:</span> <span class="hljs-string">http</span><br><span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>ä¸Šé¢æœ‰æåˆ°è¿‡ï¼Œæ¶æ„æ–‡ä»¶éªŒè¯çš„å¯¹è±¡æ˜¯ <code>.Values å¯¹è±¡</code>ï¼Œè€Œä¸æ˜¯ <em>values.yaml</em> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ <code>--set</code> æŒ‡å®šçš„å‚æ•°ä¹Ÿå±äºå…¶æ£€æµ‹çš„èŒƒç•´ï¼Œå› æ­¤ï¼Œå¦‚ä¸‹è¿™ç§æƒ…å†µä¹Ÿæ˜¯å¯ä»¥çš„é€šè¿‡æ£€æŸ¥çš„ï¼š</p><p><strong>values.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">fronend</span><br><span class="hljs-attr">protocol:</span> <span class="hljs-string">https</span><br></code></pre></td></tr></table></figure><p><strong>å‘½ä»¤è¡ŒæŒ‡å®š port</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --set port=443<br></code></pre></td></tr></table></figure></blockquote><h3 id="5ã€ç”¨æˆ·è‡ªå®šä¹‰èµ„æº-â€”â€”-CRD"><a href="#5ã€ç”¨æˆ·è‡ªå®šä¹‰èµ„æº-â€”â€”-CRD" class="headerlink" title="5ã€ç”¨æˆ·è‡ªå®šä¹‰èµ„æº â€”â€” CRD"></a>5ã€ç”¨æˆ·è‡ªå®šä¹‰èµ„æº â€”â€” CRD</h3><p><strong>CRD</strong>ï¼ˆ<code>Custom Resource Definition</code>ï¼‰æ˜¯ K8s æä¾›çš„ä¸€ç§è‡ªå®šä¹‰èµ„æºå¯¹è±¡çš„æœºåˆ¶ã€‚åœ¨ Helm3 ä¸­ï¼Œä½¿ç”¨ <code>crds/</code> ç›®å½•æ¥å¯¹å…¶è¿›è¡Œç®¡ç†ï¼ŒHelm3 ä¼šåœ¨å®‰è£… <em>chart</em> ä¹‹å‰æ£€æŸ¥è¯¥ç›®å½•æ˜¯å¦å­˜åœ¨ CRD çš„ yaml æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆåŠ è½½è¯¥ç›®å½•ä¸‹çš„ <strong>æ‰€æœ‰yamlæ–‡ä»¶</strong>è‡³ K8sï¼Œç„¶åå†è¿›è¡Œ <em>chart</em> çš„å‘å¸ƒã€‚</p><blockquote><p>âš ï¸ <strong>æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</strong></p><ul><li>å¤šä¸ª CRD çš„è¡¨è¾¾å¼å¯ä»¥å†™åœ¨ä¸€ä¸ª yaml æ–‡ä»¶ä¸­ï¼Œä½†éœ€è¦ä»¥ <strong>å¼€å§‹ç»“æŸç¬¦ â€œ <code>---</code> â€œ</strong> è¿›è¡Œåˆ†å‰²</li><li>CRDæ–‡ä»¶<strong>æ— æ³•å¥—ç”¨ Helm æ¨¡ç‰ˆ</strong>ï¼Œå¿…é¡»æ˜¯æ™®é€šçš„ yaml æ ¼å¼æ–‡ä»¶</li><li>å®‰è£… chart æ—¶ï¼Œä¼šå…ˆä¸Šä¼  CRDï¼ˆå¦‚æœ‰ï¼‰ï¼Œå¹¶åŒæ—¶æš‚åœå®‰è£…ï¼Œç›´åˆ° CRD è¢« api server è°ƒç”¨ï¼Œæ‰ä¼šå¼€å§‹åç»­ chart æ¸²æŸ“æ­¥éª¤ã€‚</li></ul></blockquote><h4 id="1ï¼‰ä½¿ç”¨ç¤ºä¾‹"><a href="#1ï¼‰ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="1ï¼‰ä½¿ç”¨ç¤ºä¾‹"></a>1ï¼‰ä½¿ç”¨ç¤ºä¾‹</h4><p>å¦‚æœè¦åˆ›å»ºä¸€ä¸ªé’ˆå¯¹ <code>crontab</code> çš„ CRDï¼Œéœ€è¦éµå¾ªä»¥ä¸‹ç›®å½•ç»“æ„å’Œè¯­æ³•è§„åˆ™ï¼š</p><h5 id="1-ç›®å½•ç»“æ„"><a href="#1-ç›®å½•ç»“æ„" class="headerlink" title="1. ç›®å½•ç»“æ„"></a>1. ç›®å½•ç»“æ„</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">test_chart/<br>  Chart.yaml<br>  crds/<br>    crontab.yaml<br>  templates/<br>    mycrontab.yaml<br></code></pre></td></tr></table></figure><h5 id="2-crontab-yaml-çš„å†™æ³•"><a href="#2-crontab-yaml-çš„å†™æ³•" class="headerlink" title="2. crontab.yaml çš„å†™æ³•"></a>2. crontab.yaml çš„å†™æ³•</h5><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong> CRD ä¸æ”¯æŒ Helm æ¨¡ç‰ˆæŒ‡ä»¤ï¼Œæ‰€ä»¥ crontab.yaml åªèƒ½ä½¿ç”¨ K8s ç»å…¸å£°æ˜è¡¨è¾¾å¼ã€‚</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">crontabs.stable.example.com</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">stable.example.com</span><br>  <span class="hljs-attr">versions:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>      <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Namespaced</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">crontabs</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">crontab</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">CronTab</span><br></code></pre></td></tr></table></figure><h5 id="3-mycrontab-yaml-æ¨¡ç‰ˆæ–‡ä»¶"><a href="#3-mycrontab-yaml-æ¨¡ç‰ˆæ–‡ä»¶" class="headerlink" title="3. mycrontab.yaml æ¨¡ç‰ˆæ–‡ä»¶"></a>3. mycrontab.yaml æ¨¡ç‰ˆæ–‡ä»¶</h5><p>CRD çš„ä¿¡æ¯åœ¨è¢«åŠ è½½è‡³ K8s åï¼Œå°±ä¼šåœ¨ Helm æ¨¡ç‰ˆçš„ <code>.Capabilities</code> ä¸­ç”Ÿæ•ˆï¼ŒæŒ‡å®š <code>apiVersion</code> å°±å¯ä»¥å¼•ç”¨ã€‚å’Œå…¶ä»–èµ„æºå¯¹è±¡ä¸€æ ·ï¼Œä½ éœ€è¦é€šè¿‡åˆ›å»ºæ¨¡ç‰ˆï¼Œå¹¶é€šè¿‡ Values æ¸²æŸ“æ¥åˆ›å»ºå®ä¾‹ã€‚CRD çš„æ¨¡ç‰ˆæ–‡ä»¶åŒå…¶ä»– template æ–‡ä»¶ä¸€æ ·ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">stable.example.com</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CronTab</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.name</span> &#125;&#125;<br><span class="hljs-attr">spec:</span><br>   <span class="hljs-comment"># ...</span><br></code></pre></td></tr></table></figure><h4 id="2ï¼‰CRD-çš„é™åˆ¶"><a href="#2ï¼‰CRD-çš„é™åˆ¶" class="headerlink" title="2ï¼‰CRD çš„é™åˆ¶"></a>2ï¼‰CRD çš„é™åˆ¶</h4><p>å’Œå¤§éƒ¨åˆ†çš„ K8s èµ„æºå¯¹è±¡ä¸åŒï¼ŒCRD æ˜¯å…¨å±€æ€§çš„ï¼Œæ•… Helm å¯¹å…¶çš„ç®¡ç†è¾ƒä¸ºæ…é‡ï¼Œå¹¶å¯¹å…¶è®¾ç½®äº†ä¸€ä¸‹é™åˆ¶ï¼š</p><blockquote><ul><li><p><strong>ä¸ä¼šé‡å¤å®‰è£…</strong></p><p>å¦‚æœ <code>crds/</code> ç›®å½•ä¸‹çš„ CRDå·²å­˜åœ¨ï¼Œæ— è®ºæ˜¯å¦æœ‰ç‰ˆæœ¬åŒºåˆ«ï¼Œéƒ½ä¸ä¼šé‡æ–°å®‰è£…è¦†ç›–ï¼Œä¸ä¼šè‡ªåŠ¨å‡çº§</p></li><li><p><strong>ä¸ä¼šåœ¨å‡çº§ã€å›æ»šæ—¶å®‰è£…</strong></p><p>åªæœ‰åœ¨ç¬¬ä¸€æ¬¡ <code>helm install</code> æ—¶æ‰ä¼šè¢«å®‰è£…</p></li><li><p><strong>ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤</strong></p><p>è‡ªåŠ¨åˆ é™¤ CRD ä¼šåˆ é™¤æ‰€æœ‰ <code>namespace</code> ä¸­çš„æ‰€æœ‰ <code>CRD</code> ï¼Œæ•…ä¸èƒ½é€šè¿‡ Helm åˆ é™¤</p><p>å¸Œæœ›å‡çº§æˆ–åˆ é™¤ CRDï¼Œéœ€è¦è¿›è¡Œæ‰‹åŠ¨æ“ä½œï¼Œæ“ä½œéœ€è°¨æ…</p></li></ul></blockquote>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬2ç« ã€Helm3 å®‰è£…éƒ¨ç½²</title>
    <link href="/2021/07/24/%E7%AC%AC2%E7%AB%A0%E3%80%81Helm3-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"/>
    <url>/2021/07/24/%E7%AC%AC2%E7%AB%A0%E3%80%81Helm3-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2ç« ã€Helm3-å®‰è£…éƒ¨ç½²"><a href="#ç¬¬2ç« ã€Helm3-å®‰è£…éƒ¨ç½²" class="headerlink" title="ç¬¬2ç« ã€Helm3 å®‰è£…éƒ¨ç½²"></a>ç¬¬2ç« ã€Helm3 å®‰è£…éƒ¨ç½²</h1><span id="more"></span><h2 id="ä¸€ã€å„ç¯å¢ƒå®‰è£…éƒ¨ç½²"><a href="#ä¸€ã€å„ç¯å¢ƒå®‰è£…éƒ¨ç½²" class="headerlink" title="ä¸€ã€å„ç¯å¢ƒå®‰è£…éƒ¨ç½²"></a>ä¸€ã€å„ç¯å¢ƒå®‰è£…éƒ¨ç½²</h2><h3 id="1ã€Linux"><a href="#1ã€Linux" class="headerlink" title="1ã€Linux"></a>1ã€Linux</h3><h4 id="1ï¼‰äºŒè¿›åˆ¶åŒ…å®‰è£…"><a href="#1ï¼‰äºŒè¿›åˆ¶åŒ…å®‰è£…" class="headerlink" title="1ï¼‰äºŒè¿›åˆ¶åŒ…å®‰è£…"></a>1ï¼‰äºŒè¿›åˆ¶åŒ…å®‰è£…</h4><h5 id="1âƒ£ï¸-ä¸‹è½½äºŒè¿›åˆ¶åŒ…"><a href="#1âƒ£ï¸-ä¸‹è½½äºŒè¿›åˆ¶åŒ…" class="headerlink" title="1âƒ£ï¸ ä¸‹è½½äºŒè¿›åˆ¶åŒ…"></a>1âƒ£ï¸ ä¸‹è½½äºŒè¿›åˆ¶åŒ…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget -c https://get.helm.sh/helm-v3.5.4-linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h5 id="2âƒ£ï¸-ä¸‹è½½æ ¡éªŒæ–‡ä»¶"><a href="#2âƒ£ï¸-ä¸‹è½½æ ¡éªŒæ–‡ä»¶" class="headerlink" title="2âƒ£ï¸ ä¸‹è½½æ ¡éªŒæ–‡ä»¶"></a>2âƒ£ï¸ ä¸‹è½½æ ¡éªŒæ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget -c https://github.com/helm/helm/releases#:~:text=Linux%20amd64%20(-,checksum,-/%20a8ddb4e30435b5fd45308ecce5eaad676d64a5de9c89660b56face3fe990b318)<br></code></pre></td></tr></table></figure><h5 id="3âƒ£ï¸-md5æ ¡éªŒ"><a href="#3âƒ£ï¸-md5æ ¡éªŒ" class="headerlink" title="3âƒ£ï¸ md5æ ¡éªŒ"></a>3âƒ£ï¸ md5æ ¡éªŒ</h5><blockquote><p>å¦‚æœæ²¡æœ‰<code>shasum</code>å‘½ä»¤ï¼Œéœ€å…ˆè¡Œå®‰è£…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y perl-Digest-SHA <br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œè¿›è¡Œæ ¡éªŒ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">shasum -a 256 -c helm-v3.5.4-linux-amd64.tar.gz.sha256sum <br></code></pre></td></tr></table></figure><p>å¦‚æœéªŒè¯é€šè¿‡ï¼Œè¿”å›ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm-v3.5.4-linux-amd64.tar.gz: OK<br></code></pre></td></tr></table></figure><p>å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¿”å›ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm-v3.5.4-linux-amd64.tar.gz: FAILED<br>shasum: WARNING: 1 computed checksum did NOT match<br></code></pre></td></tr></table></figure><h5 id="4âƒ£ï¸-è§£å‹å®‰è£…"><a href="#4âƒ£ï¸-è§£å‹å®‰è£…" class="headerlink" title="4âƒ£ï¸ è§£å‹å®‰è£…"></a>4âƒ£ï¸ è§£å‹å®‰è£…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xf helm-v3.5.4-linux-amd64.tar.gz &amp;&amp; \<br>cd linux-amd64 &amp;&amp; \<br>install -o root -g root -m 0755 helm /usr/local/bin/helm<br></code></pre></td></tr></table></figure><h5 id="5âƒ£ï¸-éªŒè¯ç‰ˆæœ¬"><a href="#5âƒ£ï¸-éªŒè¯ç‰ˆæœ¬" class="headerlink" title="5âƒ£ï¸ éªŒè¯ç‰ˆæœ¬"></a>5âƒ£ï¸ éªŒè¯ç‰ˆæœ¬</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm version<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">version.BuildInfo&#123;Version:&quot;v3.5.4&quot;, GitCommit:&quot;1b5edb69df3d3a08df77c9902dc17af864ff05d1&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.15.11&quot;&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰Apt-å®‰è£…ï¼ˆDebian-Ubuntuï¼‰"><a href="#2ï¼‰Apt-å®‰è£…ï¼ˆDebian-Ubuntuï¼‰" class="headerlink" title="2ï¼‰Apt å®‰è£…ï¼ˆDebian/Ubuntuï¼‰"></a>2ï¼‰Apt å®‰è£…ï¼ˆDebian/Ubuntuï¼‰</h4><blockquote><p>å®˜æ–¹æä¾›äº†é’ˆå¯¹Aptçš„ä¸€ä¸ª <code>HelmåŒ…</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>Aptå‘½ä»¤</code> è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ helmã€‚</p></blockquote><h5 id="1âƒ£ï¸-æ·»åŠ é•œåƒæº"><a href="#1âƒ£ï¸-æ·»åŠ é•œåƒæº" class="headerlink" title="1âƒ£ï¸ æ·»åŠ é•œåƒæº"></a>1âƒ£ï¸ æ·»åŠ é•œåƒæº</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl https://baltocdn.com/helm/signing.asc | sudo apt-key add -<br>sudo apt-get install apt-transport-https --yes<br>echo &quot;deb https://baltocdn.com/helm/stable/debian/ all main&quot; | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list<br></code></pre></td></tr></table></figure><h5 id="2âƒ£ï¸-æ›´æ–°ç¼“å­˜"><a href="#2âƒ£ï¸-æ›´æ–°ç¼“å­˜" class="headerlink" title="2âƒ£ï¸ æ›´æ–°ç¼“å­˜"></a>2âƒ£ï¸ æ›´æ–°ç¼“å­˜</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br></code></pre></td></tr></table></figure><h5 id="3âƒ£ï¸-å®‰è£…"><a href="#3âƒ£ï¸-å®‰è£…" class="headerlink" title="3âƒ£ï¸ å®‰è£…"></a>3âƒ£ï¸ å®‰è£…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install helm<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰è‡ªåŠ¨è„šæœ¬å®‰è£…"><a href="#3ï¼‰è‡ªåŠ¨è„šæœ¬å®‰è£…" class="headerlink" title="3ï¼‰è‡ªåŠ¨è„šæœ¬å®‰è£…"></a>3ï¼‰è‡ªåŠ¨è„šæœ¬å®‰è£…</h4><blockquote><p>å®˜æ–¹æä¾›äº†ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨åœ¨æœ¬åœ°å®‰è£…æœ€æ–°ç‰ˆæœ¬ Helm çš„è„šæœ¬ï¼Œåœ¨ç‰ˆæœ¬åº“çš„ <code>helm/scripts</code> ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210628144033780.png" alt="image-20210628144033780"></p><p>ğŸš© <strong>è¯¥è„šæœ¬ä¼šè‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿç¯å¢ƒï¼Œè¿›è¡Œä¸‹è½½å®‰è£…ï¼Œå…¶ä»–ç³»ç»Ÿç¯å¢ƒä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</strong></p></blockquote><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç›´æ¥è‡ªåŠ¨å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰æ·»åŠ å‘½ä»¤è¡¥å…¨"><a href="#4ï¼‰æ·»åŠ å‘½ä»¤è¡¥å…¨" class="headerlink" title="4ï¼‰æ·»åŠ å‘½ä»¤è¡¥å…¨"></a>4ï¼‰æ·»åŠ å‘½ä»¤è¡¥å…¨</h4><p>å®‰è£…å‘½ä»¤è¡¥å…¨åŠŸèƒ½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y bash-completion<br></code></pre></td></tr></table></figure><p>æ–°å¢æ–‡ä»¶ <code>/etc/profile.d/helm.sh</code>ï¼Œç¼–è¾‘ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source &lt;(helm completion bash)<br></code></pre></td></tr></table></figure><p>ç”Ÿæ•ˆç¯å¢ƒå˜é‡é…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source /etc/profile.d/helm.sh<br></code></pre></td></tr></table></figure><h3 id="2ã€macOS"><a href="#2ã€macOS" class="headerlink" title="2ã€macOS"></a>2ã€macOS</h3><h4 id="ä½¿ç”¨-Homebrew-å®‰è£…"><a href="#ä½¿ç”¨-Homebrew-å®‰è£…" class="headerlink" title="ä½¿ç”¨ Homebrew å®‰è£…"></a>ä½¿ç”¨ Homebrew å®‰è£…</h4><blockquote><p>å®˜æ–¹æä¾›äº†é’ˆå¯¹ <code>Homebrew</code> æ„å»º Helm çš„æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ <code>brewå‘½ä»¤</code> è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ helmã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">brew install helm<br></code></pre></td></tr></table></figure><h3 id="3ã€Windows"><a href="#3ã€Windows" class="headerlink" title="3ã€Windows"></a>3ã€Windows</h3><h4 id="ä½¿ç”¨-Chocolatey-å®‰è£…"><a href="#ä½¿ç”¨-Chocolatey-å®‰è£…" class="headerlink" title="ä½¿ç”¨ Chocolatey å®‰è£…"></a>ä½¿ç”¨ Chocolatey å®‰è£…</h4><blockquote><p>å®˜æ–¹æä¾›äº†é’ˆå¯¹ <code>Chocolatey</code> çš„ä¸€ä¸ª <code>HelmåŒ…</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>chocoå‘½ä»¤</code> è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ helmã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">choco install kubernetes-helm<br></code></pre></td></tr></table></figure><hr><h2 id="äºŒã€æ·»åŠ å…¬å…±ä»“åº“"><a href="#äºŒã€æ·»åŠ å…¬å…±ä»“åº“" class="headerlink" title="äºŒã€æ·»åŠ å…¬å…±ä»“åº“"></a>äºŒã€æ·»åŠ å…¬å…±ä»“åº“</h2><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>é¦–æ¬¡å®‰è£… Helm3 æ˜¯æ²¡æœ‰æŒ‡å®šé»˜è®¤ä»“åº“çš„ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ä»“åº“æ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p></blockquote><h3 id="1ã€æ·»åŠ å¸¸ç”¨ä»“åº“"><a href="#1ã€æ·»åŠ å¸¸ç”¨ä»“åº“" class="headerlink" title="1ã€æ·»åŠ å¸¸ç”¨ä»“åº“"></a>1ã€æ·»åŠ å¸¸ç”¨ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> helm repo add stable https://charts.helm.sh/stable<span class="hljs-comment"># Helm å®˜æ–¹æº</span></span><br>helm repo add stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts# é˜¿é‡Œäº‘å›½å†…æº(ç”¨äºåŠ é€Ÿ)<br>helm repo add bitnami https://charts.bitnami.com/bitnami# Helm å®˜æ–¹æºï¼ˆHelm3é»˜è®¤ä½¿ç”¨ï¼‰<br>helm repo add incubator https://charts.helm.sh/incubator<br>helm repo add jetstack https://charts.jetstack.io<br></code></pre></td></tr></table></figure><blockquote><p>å¾®è½¯ä¹Ÿæä¾›äº† stable çš„é•œåƒä»“åº“ï¼Œåœ°å€ä¸º <code>http://mirror.azure.cn/kubernetes/charts/</code></p></blockquote><h3 id="2ã€åˆ é™¤ä»“åº“"><a href="#2ã€åˆ é™¤ä»“åº“" class="headerlink" title="2ã€åˆ é™¤ä»“åº“"></a>2ã€åˆ é™¤ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo remove stable<br></code></pre></td></tr></table></figure><h3 id="3ã€æ›´æ–°ä»“åº“"><a href="#3ã€æ›´æ–°ä»“åº“" class="headerlink" title="3ã€æ›´æ–°ä»“åº“"></a>3ã€æ›´æ–°ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo update<br></code></pre></td></tr></table></figure><h3 id="4ã€æŸ¥çœ‹ä»“åº“"><a href="#4ã€æŸ¥çœ‹ä»“åº“" class="headerlink" title="4ã€æŸ¥çœ‹ä»“åº“"></a>4ã€æŸ¥çœ‹ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo list<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210630154956853.png" alt="image-20210630154956853"></p>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬1ç« ã€Helm ç®€ä»‹</title>
    <link href="/2021/07/24/%E7%AC%AC1%E7%AB%A0%E3%80%81Helm-%E7%AE%80%E4%BB%8B/"/>
    <url>/2021/07/24/%E7%AC%AC1%E7%AB%A0%E3%80%81Helm-%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€Helm-ç®€ä»‹"><a href="#ç¬¬1ç« ã€Helm-ç®€ä»‹" class="headerlink" title="ç¬¬1ç« ã€Helm ç®€ä»‹"></a>ç¬¬1ç« ã€Helm ç®€ä»‹</h1><span id="more"></span><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/helm3.jpg" alt="helm logo"></p><p><a href="https://helm.sh/">Helm å®˜ç½‘</a></p><p><a href="https://github.com/helm/helm">Helm å®˜æ–¹GitHub</a></p><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯-Helmï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯-Helmï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ Helmï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ Helmï¼Ÿ</h2><p>å°±åƒ Java ä½¿ç”¨ mavenï¼›node ä½¿ç”¨ npmï¼›python ä½¿ç”¨ pipï¼›Linux ä½¿ç”¨ yum æˆ– Apt ä¸€æ ·ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ ·çš„å·¥ä½œï¼ŒæŠ€æœ¯äººå‘˜éƒ½ä¼šå¸Œæœ›æœ‰ä¸€ç§èµ„æºç®¡ç†å™¨/åŒ…ç®¡ç†å™¨ï¼Œä»¥æ­¤æ¥æ–¹ä¾¿å¾—æŸ¥æ‰¾ã€ä¸‹è½½ã€å®‰è£…ã€ä½¿ç”¨å’Œåˆ†å‘è½¯ä»¶åŒ…ã€‚</p><p>æ‰€ä»¥ Helm å³å¯ä»¥è¯´æ˜¯ <code>K8Sçš„åŒ…ç®¡ç†å™¨</code>ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬å¯¹äº K8S çš„æ“ä½œä¸å†éœ€è¦ç»†åŒ–åˆ°èµ„æºå¯¹è±¡ï¼Œè€Œæ˜¯å¯ä»¥ä½œä¸ºä¸€ä¸ªå®ä¾‹è¿›è¡Œç®¡ç†ã€‚ä¸å†éœ€è¦å»å†™ <code>deployment</code> ã€<code>service</code> ã€<code>ingress</code> çš„ yamlï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥é€šè¿‡ <code>install</code> å‘½ä»¤å®ç°æœåŠ¡å®ä¾‹çš„å®‰è£…ã€‚</p><h3 id="Helm-çš„ä¸»è¦åŠŸèƒ½æ€»ç»“ï¼š"><a href="#Helm-çš„ä¸»è¦åŠŸèƒ½æ€»ç»“ï¼š" class="headerlink" title="Helm çš„ä¸»è¦åŠŸèƒ½æ€»ç»“ï¼š"></a>Helm çš„ä¸»è¦åŠŸèƒ½æ€»ç»“ï¼š</h3><blockquote><ul><li>æŸ¥æ‰¾è¦å®‰è£…å’Œä½¿ç”¨çš„é¢„æ‰“åŒ…è½¯ä»¶</li><li>è½»æ¾åˆ›å»ºå’Œæ‰˜ç®¡è‡ªå·±çš„è½¯ä»¶åŒ…</li><li>å°†è½¯ä»¶åŒ…å®‰è£…åˆ°ä»»ä½• K8S é›†ç¾¤ä¸­</li><li>æŸ¥è¯¢é›†ç¾¤ä»¥æŸ¥çœ‹å·²å®‰è£…å’Œæ­£åœ¨è¿è¡Œçš„ç¨‹åºåŒ…</li><li>æ›´æ–°ã€åˆ é™¤ã€å›æ»šæˆ–æŸ¥çœ‹å·²å®‰è£…è½¯ä»¶åŒ…çš„å†å²è®°å½•</li></ul></blockquote><hr><h2 id="äºŒã€Helm-ä¸­çš„åŸºæœ¬æ¦‚å¿µ"><a href="#äºŒã€Helm-ä¸­çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="äºŒã€Helm ä¸­çš„åŸºæœ¬æ¦‚å¿µ"></a>äºŒã€Helm ä¸­çš„åŸºæœ¬æ¦‚å¿µ</h2><h3 id="1ã€Chart"><a href="#1ã€Chart" class="headerlink" title="1ã€Chart"></a>1ã€<em>Chart</em></h3><p>Helm ä½¿ç”¨çš„åŒ…æ ¼å¼ç§°ä¸º <code>chart</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæè¿° Kubernetes ç›¸å…³èµ„æºå¯¹è±¡çš„æ–‡ä»¶é›†åˆã€‚å®ƒçš„æŠ€æœ¯ç‰¹ç‚¹ç±»ä¼¼ jinjaæ¨¡ç‰ˆï¼Œä»¥æ¸²æŸ“æ¨¡ç‰ˆçš„æ–¹å¼ï¼Œç”Ÿæˆè¿è¡Œä¸€ä¸ªæœåŠ¡å®ä¾‹æ‰€éœ€çš„ä¸€ç³»åˆ—èµ„æºå¯¹è±¡æ–‡ä»¶ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒæœåŠ¡çš„å‘å¸ƒã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ååˆ†ç®€å•çš„åˆ¶ä½œè‡ªå®šä¹‰çš„ chartã€‚</p><p>Chart æœ‰è‡ªå·²ç‰¹å®šçš„ç›®å½•å¸ƒå±€ï¼Œæˆ‘ä»¬ä»¥å®˜æ–¹æä¾›çš„ <code>wordpress</code>ä¸ºä¾‹è¯´æ˜ï¼Œchart çš„æ–‡ä»¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">wordpress/<br>  Chart.yaml          # åŒ…å«äº†chartä¿¡æ¯çš„YAMLæ–‡ä»¶<br>  LICENSE             # å¯é€‰: åŒ…å«chartè®¸å¯è¯çš„çº¯æ–‡æœ¬æ–‡ä»¶<br>  README.md           # å¯é€‰: å¯è¯»çš„READMEæ–‡ä»¶<br>  values.yaml         # chart é»˜è®¤çš„é…ç½®å€¼<br>  values.schema.json  # å¯é€‰: ä¸€ä¸ªä½¿ç”¨JSONç»“æ„çš„values.yamlæ–‡ä»¶<br>  charts/             # åŒ…å«chartä¾èµ–çš„å…¶ä»–chart<br>  crds/               # è‡ªå®šä¹‰èµ„æºçš„å®šä¹‰<br>  templates/          # æ¨¡æ¿ç›®å½•ï¼Œ å½“å’Œvalues ç»“åˆæ—¶ï¼Œå¯ç”Ÿæˆæœ‰æ•ˆçš„Kubernetes manifestæ–‡ä»¶<br>  templates/NOTES.txt # å¯é€‰: åŒ…å«ç®€è¦ä½¿ç”¨è¯´æ˜çš„çº¯æ–‡æœ¬æ–‡ä»¶<br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>Helm Chart åŸºæœ¬å…ƒç´ ä¸º <code>charts/</code>ã€<code>Chart.yaml </code>ã€<code>templates/</code>ã€<code>values.yaml</code>ï¼Œå¹¶ä¿ç•™ <code>crds/</code> ï¼Œè¦æ­£ç¡®çš„ä½¿ç”¨ chart è¿›è¡Œå‘å¸ƒï¼Œè¯¥å…ƒç´ æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p></blockquote><h3 id="2ã€Repos"><a href="#2ã€Repos" class="headerlink" title="2ã€Repos"></a>2ã€<em>Repos</em></h3><p>Helm chart å¯ä»¥è¢«å­˜å‚¨åœ¨ä¸“ç”¨çš„ HTTP æœåŠ¡å™¨ä¸Šï¼Œç§°ä¸º <code>chart ä»“åº“ï¼ˆrepositories)</code>ï¼Œå’Œ <code>yum repository</code>ç±»ä¼¼ï¼Œchart ä»“åº“æä¾›äº†ä¸€ä¸ª <code>index.yaml</code> æ¥æè¿°ä¸€æ‰¹ chartï¼Œå¹¶ä¸”æä¾›äº†æ¯ä¸ª chart çš„ä¸‹è½½åœ°å€ä¿¡æ¯ã€‚</p><p>Helm å®¢æˆ·ç«¯å¯ä»¥æŒ‡å‘å¤šä¸ª chart ä»“åº“ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰é…ç½®ä»“åº“çš„ï¼Œéœ€è¦ä½¿ç”¨ <code>helm repo add</code> æ¥è¿›è¡Œæ·»åŠ ã€‚helm3 ä¸­å¯¹äºä¸€äº›å¸¸ç”¨æœåŠ¡çš„ä¸‹è½½å®‰è£…ï¼Œç”¨ <code>bitnami ä»“åº“</code>  å–ä»£äº†åŸæ¥çš„<code>stable ä»“åº“</code>ï¼Œä½†æ˜¯ä»ä¿ç•™äº† <code>stable ä»“åº“</code>çš„ä½¿ç”¨ã€‚</p><h3 id="3ã€Release"><a href="#3ã€Release" class="headerlink" title="3ã€Release"></a>3ã€<em>Release</em></h3><p>å½“ chart è¢«å‘å¸ƒåï¼ŒHelm åº“ä¼šåˆ›å»ºä¸€ä¸ª <code>release</code> æ¥è·Ÿè¸ªè¿™ä¸ªå‘å¸ƒçš„å¯¹è±¡ï¼Œå®ƒçš„å®è´¨æ˜¯åœ¨ Kubernetes ä¸­è¿è¡Œçš„å„ç§èµ„æºï¼Œ<code>service</code>ã€<code>deployment</code>ã€<code>configmap</code>ã€<code>secret</code> ç­‰ï¼Œåœ¨ K8S é›†ç¾¤ä¸­çš„ç›´æ¥çš„è¡¨ç°å°±æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª podã€‚</p><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong>  </p><p>Helm çš„ release æ˜¯å…è®¸å¯åŠ¨å¤šä¸ªä¸åŒæœåŠ¡çš„ï¼Œä¸”æ¯ä¸ªæœåŠ¡ä¹‹é—´éµå¾ªä¾èµ–å…³ç³»ï¼Œè¿™ç‚¹å°±æ¯”è¾ƒç±»ä¼¼ docker composeã€‚</p></blockquote><hr><h2 id="ä¸‰ã€ä»-Helm2-åˆ°-Helm3-çš„å˜åŒ–"><a href="#ä¸‰ã€ä»-Helm2-åˆ°-Helm3-çš„å˜åŒ–" class="headerlink" title="ä¸‰ã€ä» Helm2 åˆ° Helm3 çš„å˜åŒ–"></a>ä¸‰ã€ä» Helm2 åˆ° Helm3 çš„å˜åŒ–</h2><h3 id="1ã€Helm3-æ–°å¢çš„åŠŸèƒ½"><a href="#1ã€Helm3-æ–°å¢çš„åŠŸèƒ½" class="headerlink" title="1ã€Helm3 æ–°å¢çš„åŠŸèƒ½"></a>1ã€Helm3 æ–°å¢çš„åŠŸèƒ½</h3><p>Helm3 æœ‰å¾ˆå¤šæ–°çš„åŠŸèƒ½ï¼Œæœ‰ä¸ªé‡è¦åŠŸèƒ½éœ€è¦ç‰¹åˆ«æŒ‡å‡ºï¼š</p><blockquote><ul><li>release çš„ä¿¡æ¯ä»¥æ–°çš„å½¢å¼å­˜å‚¨</li><li>ç§»é™¤äº† Tiller ç»„ä»¶</li><li>Helm3 åŒ…å«äº†å¯¹æ–°ç‰ˆæœ¬ Helm charts ï¼ˆCharts v2ï¼‰çš„æ”¯æŒ</li><li>Helm3 æ”¯æŒ <code>library charts</code> â€”â€” ä¸€ç§ä½œä¸ºå…¶ä»– charts å…ƒç´ çš„ charts</li><li>å°† Chart æ¨é€ä¿å­˜åˆ° OCI æ³¨å†Œä¸­å¿ƒï¼ˆç±»ä¼¼ DockerRegistry ï¼‰ï¼Œä»¥è¿›è¡Œå¤ç”¨</li><li>å‡çº§Kubernetesèµ„æºæ—¶å°†åº”ç”¨3å‘æˆ˜ç•¥åˆå¹¶è¡¥ä¸</li><li>æ”¯æŒä½¿ç”¨ JSON Schema å¯¹ charts çš„ values è¿›è¡Œæ ¡éªŒ</li><li>ä¸ºäº†ä½¿Helmæ›´å®‰å…¨ï¼Œå¯ç”¨å’Œå¥å£®ï¼Œå·²è¿›è¡Œäº†è®¸å¤šå°çš„æ”¹è¿›ã€‚</li></ul></blockquote><h3 id="2ã€é‡è¦å˜åŒ–æ¦‚è¿°"><a href="#2ã€é‡è¦å˜åŒ–æ¦‚è¿°" class="headerlink" title="2ã€é‡è¦å˜åŒ–æ¦‚è¿°"></a>2ã€é‡è¦å˜åŒ–æ¦‚è¿°</h3><h4 id="1ï¼‰ç§»é™¤-Tiller"><a href="#1ï¼‰ç§»é™¤-Tiller" class="headerlink" title="1ï¼‰ç§»é™¤ Tiller"></a>1ï¼‰ç§»é™¤ Tiller</h4><p><code>Tiller</code> åœ¨ Helm2 ä¸­æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚Helm2 ä½¿ç”¨å®ƒå’Œ <code>GRPC</code> æ¥å¤„ç† <code>Helm chart</code> çš„å®‰è£…å’Œç®¡ç†ï¼Œå‘ˆç° <code>chart</code> å¹¶å°†å…¶æ¨é€åˆ° Kubernetes API Serverã€‚<code>Tiller</code> å…è®¸å›¢é˜Ÿå…±äº«ä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Œå¤šä¸ª operator å¯ä»¥ä½¿ç”¨åŒä¸€ç»„å‘è¡Œç‰ˆï¼Œå›¢é˜Ÿæˆå‘˜é€šè¿‡å®ƒå°±å¯ä»¥åœ¨ä¸€ä¸ªå…±äº«çš„ Kubernetes é›†ç¾¤ä¸­ç®¡ç†å¤æ‚çš„åº”ç”¨å‘å¸ƒã€‚</p><p>ä½†æ˜¯ä» Kubernetes 1.6 å¼€å§‹ï¼Œè€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œé›†ç¾¤é»˜è®¤ä¼šå¼€å¯è§’è‰²è®¿é—®æ§åˆ¶ï¼ˆ<code>RBAC</code>ï¼‰ï¼Œè¿™ä½¿å¾—ç®¡ç†å’Œé…ç½®Tillerä¼šå˜å¾—éå¸¸å¤æ‚ï¼Œå› ä¸ºå¯èƒ½çš„å®‰å…¨ç­–ç•¥æ•°é‡å¤ªå¤šäº†ã€‚ä¸ºäº†ç®€åŒ–å®‰å…¨æ¨¡å‹å®ç°æ–¹å¼ï¼Œå¹¶ä½¿ç®¡ç†å‘˜/SREä¸éœ€è¦å»æ·±å…¥ç ”ç©¶ Kubernetes çš„å®‰å…¨ç»„ä»¶ï¼Œhelm æä¾›äº†ä¸€ä¸ªä¸éœ€è¦å¤ªè¿‡å…³æ³¨å®‰å…¨è§„åˆ™çš„é»˜è®¤é…ç½®ï¼Œä½†æ˜¯è¿™åˆä¼šä½¿å¾—æˆæƒå˜å¾—å®½æ¾ï¼Œè¿™åè€Œä¼šå¯¼è‡´å®‰å…¨éšæ‚£ã€‚</p><p>å› æ­¤åœ¨ Helm3 ä¸­å¹²è„†ç§»é™¤äº† Tillerï¼Œè€Œæ˜¯é€‰æ‹©ä» Kubernetes API Server ä¸­è·å–ä¿¡æ¯æ¥æ¸²æŸ“ Charts å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨ Kubernetes ä¸­å­˜åœ¨å®‰è£…è®°å½•ï¼Œè¿™äº›è¿‡ç¨‹æ—¢æ˜¯æ²¡æœ‰ Tiller ä¹Ÿå¯ä»¥å®ç°ã€‚</p><p>Helm3 å¯ä»¥æ”¯æŒæ‰€æœ‰çš„ Kubernetes è®¤è¯åŠé‰´æƒç­‰å…¨éƒ¨å®‰å…¨ç‰¹æ€§ã€‚Helmå’Œæœ¬åœ°çš„ kubeconfig flie ä¸­çš„é…ç½®ä½¿ç”¨ä¸€è‡´çš„æƒé™ã€‚ç®¡ç†å‘˜å¯ä»¥æŒ‰ç…§è‡ªå·±è®¤ä¸ºåˆé€‚çš„ç²’åº¦æ¥ç®¡ç†ç”¨æˆ·æƒé™ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/helm3%E5%8F%98%E5%8C%96.png" alt="helm3å˜åŒ–"></p><h4 id="2ï¼‰Chart-ä»“åº“å‡çº§"><a href="#2ï¼‰Chart-ä»“åº“å‡çº§" class="headerlink" title="2ï¼‰Chart ä»“åº“å‡çº§"></a>2ï¼‰Chart ä»“åº“å‡çº§</h4><p>åœ¨ Helm3 ä¸­ï¼Œ<code>helm search</code> é™¤äº†æ”¯æŒæœ¬åœ° repository æœç´¢å¤–ï¼Œè¿˜æ”¯æŒ <code>helm search hub</code> æœç´¢ Artifact Hub ä¸­æ‰€æœ‰å…¬å¼€çš„ chartsã€‚</p><h4 id="3ï¼‰æ”¹è¿›å‡çº§ç­–ç•¥ï¼šä½¿ç”¨ä¸‰è·¯ç­–ç•¥åˆå¹¶è¡¥ä¸"><a href="#3ï¼‰æ”¹è¿›å‡çº§ç­–ç•¥ï¼šä½¿ç”¨ä¸‰è·¯ç­–ç•¥åˆå¹¶è¡¥ä¸" class="headerlink" title="3ï¼‰æ”¹è¿›å‡çº§ç­–ç•¥ï¼šä½¿ç”¨ä¸‰è·¯ç­–ç•¥åˆå¹¶è¡¥ä¸"></a>3ï¼‰æ”¹è¿›å‡çº§ç­–ç•¥ï¼šä½¿ç”¨ä¸‰è·¯ç­–ç•¥åˆå¹¶è¡¥ä¸</h4><p>åœ¨ Helm2 ä¸­ï¼Œä½¿ç”¨äº†åŒè·¯ç­–ç•¥åˆå¹¶è¡¥ä¸ï¼Œç®€å•æ¥è¯´å°±æ˜¯åœ¨ä½¿ç”¨ <code>helm upgrade</code> æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œä¼šæ¯”å¯¹æœ¬æ¬¡å‘å¸ƒçš„ chart manifest å’Œ æœ€è¿‘ä¸€æ¬¡å‘å¸ƒçš„ chart manifest  çš„å·®å¼‚ï¼Œä»¥æ­¤æ¥å†³å®šå“ªäº›æ›´æ”¹è¢«åº”ç”¨åˆ° Kubernetes çš„èµ„æºä¸­å»ã€‚å¹¶ä¸”ï¼ŒHelm åªä¼šå°†æœ€åä¸€æ¬¡åº”ç”¨çš„ chart manifest ä½œä¸º release çš„å½“å‰çŠ¶æ€ï¼Œå¦‚æœ chart çŠ¶æ€æ²¡æœ‰æ›´æ”¹ï¼Œèµ„æºçš„æ´»åŠ¨çŠ¶æ€å°±ä¸ä¼šæ›´æ”¹ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨è¯¸å¦‚ <code>kubectl edit</code> ã€<code>kubectl scale</code> è¿™ç§å¤–éƒ¨æ–¹å¼è¿›è¡Œçš„ä¿®æ”¹ä¸ä¼šè¢« Helm è¯†åˆ«çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚æœå‘ç”Ÿå›æ»šæ“ä½œï¼ŒHelm ä¼šç”±äº chart å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–è€Œå¯¼è‡´å›æ»šå¤±è´¥ã€‚</p><p>è€Œåœ¨ Helm3 ä¸­ï¼Œè¿™ç§ç­–ç•¥è¢«å‡çº§æˆäº†ä¸‰è·¯ç­–ç•¥åˆå¹¶ï¼ŒHelm åœ¨ç”Ÿæˆä¸€ä¸ªè¡¥ä¸æ—¶ï¼Œä¹Ÿä¼šè€ƒè™‘ä¹‹å‰è€çš„ manifest çš„æ´»åŠ¨çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä½¿ç”¨è€çš„ chart manifest ç”Ÿæˆæ–°çš„è¡¥ä¸æ—¶ï¼ŒHelm è¿˜ä¼šè€ƒè™‘å½“å‰çš„æ´»åŠ¨çŠ¶æ€ï¼Œå¹¶å°†å…¶ä¸ä¹‹å‰è€çš„ manifest è¿›è¡Œæ¯”å¯¹ï¼Œå¹¶å†æ¯”å¯¹æ–°çš„ manifest æ˜¯å¦æœ‰æ”¹åŠ¨ï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨è¡¥å…¨ï¼Œä»¥æ­¤æ¥ç”Ÿæˆæœ€ç»ˆçš„æ›´æ–°è¡¥ä¸ã€‚</p><h6 id="ç¤ºä¾‹è¯´æ˜ï¼š"><a href="#ç¤ºä¾‹è¯´æ˜ï¼š" class="headerlink" title="ç¤ºä¾‹è¯´æ˜ï¼š"></a>ç¤ºä¾‹è¯´æ˜ï¼š</h6><p>ç”¨ Chart æ¸²æŸ“ç”Ÿæˆçš„ manifest å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">containers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">server</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">my_app:2.0.0</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡é Helm çš„æ–¹å¼å°†åº”ç”¨çš„æ´»åŠ¨çŠ¶æ€ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">containers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">server</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">my_app:2.0.0</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sidecar</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">dump_handler:1.0.0</span><br></code></pre></td></tr></table></figure><p>è€Œç°åœ¨æˆ‘ä»¬æƒ³è¦å°†åº”ç”¨çš„é•œåƒå‡çº§åˆ° <code>2.1.0</code>ï¼Œé€šè¿‡ chart è¿›è¡Œå‡çº§æ“ä½œã€‚</p><p>åœ¨ Helm2 ä¸­ï¼Œç”±äºä¸ä¼šè€ƒè™‘ chart ä¹‹å¤–çš„ä¿®æ”¹ï¼Œè€Œæ˜¯æ£€æµ‹ chart ç”Ÿæˆçš„ manifest ä¹‹é—´çš„åŒºåˆ«ï¼Œå› æ­¤ä¿®æ”¹åçš„çŠ¶æ€å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">containers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">server</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">my_app:2.1.0</span><br></code></pre></td></tr></table></figure><p>è€Œåœ¨ Helm3 ä¸­ï¼Œé€šè¿‡ä¸‰è·¯åˆå¹¶ç­–ç•¥ï¼Œä¼šæ£€æŸ¥åˆ°é™¤äº† chart çš„ä¿®æ”¹å¤–ï¼Œè¿˜å¤šäº†ä¸€ä¸ª sidecar å®¹å™¨ï¼Œå› æ­¤ä¼šè¿›è¡Œè¡¥å…¨ï¼Œæœ€ç»ˆä¿®æ”¹çŠ¶æ€å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">containers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">server</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">my_app:2.1.0</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sidecar</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">dump_handler:1.0.0</span><br></code></pre></td></tr></table></figure><h4 id="4ï¼‰release-åç§°å­˜å‚¨ä½ç½®æ”¹å˜"><a href="#4ï¼‰release-åç§°å­˜å‚¨ä½ç½®æ”¹å˜" class="headerlink" title="4ï¼‰release åç§°å­˜å‚¨ä½ç½®æ”¹å˜"></a>4ï¼‰release åç§°å­˜å‚¨ä½ç½®æ”¹å˜</h4><p>åœ¨ Helm2 ä¸­ï¼Œrelease çš„ç›¸å…³ä¿¡æ¯éƒ½è¢«ä¿å­˜åœ¨ Tiller çš„ namespaceä¸‹ï¼Œæ‰€ä»¥ release çš„åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼›è€Œéšç€ Tiller ç»„ä»¶çš„ç§»é™¤ï¼Œ Helm3 ä¸­release ç›¸å…³çš„ä¿¡æ¯éƒ½è¢«ä¿å­˜åœ¨äº†åº”ç”¨è‡ªå·±ç›¸å¯¹åº”çš„ namespace ä¸‹ï¼Œå› æ­¤æ ¹æ® namespace çš„éš”ç¦»æ€§è´¨ï¼Œåœ¨ä¸åŒçš„ ns ä¸‹ï¼Œrelease çš„åç§°å¯ä»¥é‡å¤ã€‚</p><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>Helm3 ä¸­ï¼Œåœ¨æ‰§è¡Œ <code>helm list</code> æ—¶éœ€è¦æ·»åŠ  <code>--all-namespaces</code> å‚æ•°æ‰èƒ½è·å–åˆ° Helm2 ä¸­åŒæ ·çš„ç»“æœ</p></blockquote><h4 id="5ï¼‰é»˜è®¤å­˜å‚¨é©±åŠ¨ç¨‹åºæ›´æ”¹ä¸º-Secrets"><a href="#5ï¼‰é»˜è®¤å­˜å‚¨é©±åŠ¨ç¨‹åºæ›´æ”¹ä¸º-Secrets" class="headerlink" title="5ï¼‰é»˜è®¤å­˜å‚¨é©±åŠ¨ç¨‹åºæ›´æ”¹ä¸º Secrets"></a>5ï¼‰é»˜è®¤å­˜å‚¨é©±åŠ¨ç¨‹åºæ›´æ”¹ä¸º Secrets</h4><p>Helm 2 é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ ConfigMaps å­˜å‚¨å‘è¡Œä¿¡æ¯ï¼Œç›´åˆ° Helm 2.7.0 ä¸­ï¼Œæ‰ä½¿ç”¨ Secrets ç”¨ä½œå­˜å‚¨é©±åŠ¨ç¨‹åºã€‚è€Œåœ¨ Helm 3 ä¸­é»˜è®¤å°±ä½¿ç”¨ Secretsã€‚</p><p><a href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/">é™æ€åŠ å¯†å¯†é’¥</a> åœ¨Kubernetes 1.7ä¸­ä½œä¸ºalphaç‰¹æ€§å¯ä»¥ä½¿ç”¨äº†ï¼Œåœ¨Kubernetes 1.13ä¸­å˜æˆäº†ç¨³å®šç‰¹æ€§ã€‚ è¿™å…è®¸ç”¨æˆ·é™æ€åŠ å¯†Helmçš„å‘å¸ƒå…ƒæ•°æ®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼Vaultçš„ä»¥åå¯æ‰©å±•çš„è‰¯å¥½èµ·ç‚¹ã€‚</p><h4 id="6ï¼‰Go-å¯¼å…¥è·¯å¾„æ›´æ”¹"><a href="#6ï¼‰Go-å¯¼å…¥è·¯å¾„æ›´æ”¹" class="headerlink" title="6ï¼‰Go å¯¼å…¥è·¯å¾„æ›´æ”¹"></a>6ï¼‰Go å¯¼å…¥è·¯å¾„æ›´æ”¹</h4><p>åœ¨ Helm3 ä¸­ï¼ŒGo å¯¼å…¥è·¯å¾„ä»<code>k8s.io/helm</code> åˆ‡æ¢ä¸º <code>helm.sh/helm/v3</code>ã€‚ å¦‚æœæ‰“ç®—å‡çº§åˆ°Helm 3 Goå®¢æˆ·ç«¯åº“ï¼Œè¯·ç¡®ä¿æ›´æ”¹å¯¼å…¥è·¯å¾„ã€‚</p><h4 id="7ï¼‰ä½¿ç”¨-JSONSchema-éªŒè¯-Chart-çš„-values"><a href="#7ï¼‰ä½¿ç”¨-JSONSchema-éªŒè¯-Chart-çš„-values" class="headerlink" title="7ï¼‰ä½¿ç”¨ JSONSchema éªŒè¯ Chart çš„ values"></a>7ï¼‰ä½¿ç”¨ JSONSchema éªŒè¯ Chart çš„ values</h4><p>Helm3 æ”¯æŒç”¨<code> JSONSchema</code>  æ¥æ ¡éªŒ Chart çš„ valuesï¼Œå®ƒä¼šè‡ªåŠ¨æ£€æŸ¥æ‰€æœ‰è¾“å…¥çš„å˜é‡æ ¼å¼ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ç”¨æˆ·æä¾›çš„å€¼éµå¾ª Chart ç»´æŠ¤è€…è®¾è®¡çš„æ¶æ„ï¼Œå½“ç”¨æˆ·ä¸º Chart æä¾›ä¸€ç»„é”™è¯¯å€¼æ—¶ï¼Œä¹Ÿèƒ½æä¾›æ›´å¥½çš„é”™è¯¯æŠ¥å‘Šã€‚</p><p>å½“è°ƒç”¨ä¸€ä¸‹å‘½ä»¤æ—¶ä¼šè¿›è¡Œ JSON æ ¼å¼éªŒè¯ï¼š</p><blockquote><ul><li>helm install</li><li>helm upgrade</li><li>helm template</li><li>helm lint</li></ul></blockquote><h4 id="8ï¼‰requirements-yamlåˆå¹¶å…¥-Chart-yaml"><a href="#8ï¼‰requirements-yamlåˆå¹¶å…¥-Chart-yaml" class="headerlink" title="8ï¼‰requirements.yamlåˆå¹¶å…¥ Chart.yaml"></a>8ï¼‰requirements.yamlåˆå¹¶å…¥ Chart.yaml</h4><p>åŠ¨æ€ä¾èµ–å…³ç³»çš„chart ä¾èµ–ä» <code>requirements.yaml</code> å’Œ <code>requirements.lock</code> ç§»è‡³ <code>Chart.yaml</code> å’Œ <code>Chart.lock</code>ã€‚ æ¨èåœ¨ Helm3 çš„æ–° chart ä¸­ä½¿ç”¨ Chart API v2 çš„æ–°æ ¼å¼ï¼Œä½†æ˜¯ Helm3 ä¸­ä¾ç„¶å¯ä»¥è¯†åˆ« v1 ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨åŠ è½½å·²æœ‰çš„ <code>requirements.yaml</code> æ–‡ä»¶ã€‚</p><p>åœ¨ Helm2 ä¸­ï¼Œ<code>requirements.yaml</code> çš„è¡¨è¾¾å¼ç±»ä¼¼å¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mariadb</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">5.</span><span class="hljs-string">x.x</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">https://charts.helm.sh/stable</span><br>  <span class="hljs-attr">condition:</span> <span class="hljs-string">mariadb.enabled</span><br>  <span class="hljs-attr">tags:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">database</span><br></code></pre></td></tr></table></figure><p>è€Œåœ¨ Helm3 ä¸­ï¼Œè¡¨è¾¾å¼çš„å½¢å¼å¹¶æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯ç°åœ¨éœ€è¦å†™åœ¨ <code>Chart.yaml</code> ä¸­ã€‚Chart ä¾ç„¶ä¼šä¸‹è½½å’Œæ”¾ç½®åœ¨ <code>charts/</code> ç›®å½•ï¼Œæ‰€ä»¥ <code>charts/</code> ç›®å½•ä¸­çš„å­ chart ä¸éœ€è¦åšä»»ä½•ä¿®æ”¹ï¼Œå¯ä»¥æ²¿ç”¨ Helm2 çš„ã€‚</p><h4 id="9ï¼‰æŒ‡å®šåç§°å’Œå‘½åç©ºé—´"><a href="#9ï¼‰æŒ‡å®šåç§°å’Œå‘½åç©ºé—´" class="headerlink" title="9ï¼‰æŒ‡å®šåç§°å’Œå‘½åç©ºé—´"></a>9ï¼‰æŒ‡å®šåç§°å’Œå‘½åç©ºé—´</h4><h5 id="1âƒ£ï¸-å‘å¸ƒæ—¶å¿…é¡»æŒ‡å®š-release-åç§°"><a href="#1âƒ£ï¸-å‘å¸ƒæ—¶å¿…é¡»æŒ‡å®š-release-åç§°" class="headerlink" title="1âƒ£ï¸ å‘å¸ƒæ—¶å¿…é¡»æŒ‡å®š release åç§°"></a>1âƒ£ï¸ å‘å¸ƒæ—¶å¿…é¡»æŒ‡å®š release åç§°</h5><p>åœ¨ Helm2 ä¸­ï¼Œåœ¨å‘å¸ƒæ—¶å¦‚æœæœªæä¾› release çš„åç§°ï¼ŒHelm ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªï¼Œä½†æ˜¯åœ¨ Helm3 ä¸­ï¼Œå¦‚æœæœªæŒ‡å®š release åç§°ï¼Œå®‰è£…å°±ä¼šæŠ¥é”™ï¼Œå¦‚æœä»ç„¶å¸Œæœ› Helm èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆ release åç§°ï¼Œå¯ä»¥ä½¿ç”¨ <code>--generate-name</code> å‚æ•°ã€‚</p><h5 id="2âƒ£ï¸-ä¸å†è‡ªåŠ¨åˆ›å»º-namespace"><a href="#2âƒ£ï¸-ä¸å†è‡ªåŠ¨åˆ›å»º-namespace" class="headerlink" title="2âƒ£ï¸ ä¸å†è‡ªåŠ¨åˆ›å»º namespace"></a>2âƒ£ï¸ ä¸å†è‡ªåŠ¨åˆ›å»º namespace</h5><p>åœ¨ Helm2 ä¸­ï¼Œå¦‚æœåœ¨åˆ›å»ºç‰ˆæœ¬æ—¶ï¼Œå‘½åç©ºé—´ä¸å­˜åœ¨ï¼ŒHelm2 ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œä½†æ˜¯åœ¨ Helm3 ä¸­ï¼Œå¦‚æœå‘½åç©ºé—´ä¸å­˜åœ¨å°±ä¼šæŠ¥é”™ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®š <code>--create-namespace</code> å‚æ•°ï¼ŒHelm3 æ‰ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´ã€‚</p><h4 id="10ï¼‰å°†-Chart-æ¨é€åˆ°-OCI-æ³¨å†Œä¸­å¿ƒ"><a href="#10ï¼‰å°†-Chart-æ¨é€åˆ°-OCI-æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="10ï¼‰å°† Chart æ¨é€åˆ° OCI æ³¨å†Œä¸­å¿ƒ"></a>10ï¼‰å°† Chart æ¨é€åˆ° OCI æ³¨å†Œä¸­å¿ƒ</h4><p>è¿™æ˜¯ä¸€ä¸ª Helm3 ä¸­çš„è¯•éªŒæ€§ç‰¹æ€§ï¼Œä½¿ç”¨æ—¶éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ <code>HELM_EXPERIMENTAL_OCI=1</code>ã€‚</p><p>æŸ¥çœ‹ <code>helm help chart</code> å’Œ <code>helm help registry</code> äº†è§£å¦‚ä½•æ‰“åŒ…chartå¹¶æ¨é€åˆ°Dockeræ³¨å†Œä¸­å¿ƒçš„æ›´å¤šä¿¡æ¯ã€‚</p><h4 id="11ï¼‰ç§»é™¤-helm-serve"><a href="#11ï¼‰ç§»é™¤-helm-serve" class="headerlink" title="11ï¼‰ç§»é™¤ helm serve"></a>11ï¼‰ç§»é™¤ <code>helm serve</code></h4><p>åœ¨ Helm2 ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>helm serve</code> å‘½ä»¤åœ¨æœ¬åœ°ä¸´æ—¶æ­å»º <code>Chart Repository </code>ï¼Œä½†æ˜¯ç”±äºå¹¶æ²¡æœ‰è¢«å¼€å‘å·¥å…·æ¥å—ï¼Œä¸”åœ¨è®¾è®¡æ–¹é¢å­˜åœ¨è¾ƒå¤šé—®é¢˜ï¼Œæ•…åœ¨ Helm3 ä¸­è¢«åˆ é™¤äº†ã€‚</p><h4 id="12ï¼‰æ”¯æŒ-library-chart"><a href="#12ï¼‰æ”¯æŒ-library-chart" class="headerlink" title="12ï¼‰æ”¯æŒ library chart"></a>12ï¼‰æ”¯æŒ library chart</h4><p>Helm3 æ”¯æŒä¸€ç±»ç§°ä¸º <code>library chart</code> çš„ chartï¼Œå…¶æœ¬çœä¸ä¼šåˆ›å»ºä»»ä½•åº”ç”¨ï¼Œåªæ˜¯ä½œä¸ºå…¶ä»– chart çš„å…±äº«ä¾èµ–ã€‚library chart åªèƒ½ç”¨äºå£°æ˜å®šä¹‰å…ƒç´ ï¼Œå…¨å±€èŒƒå›´å†…çš„éå®šä¹‰å†…å®¹å°†è¢«å¿½ç•¥ã€‚è¿™ä½¿ç”¨æˆ·å¯ä»¥é‡å¤ä½¿ç”¨å’Œå…±äº«å¯åœ¨è®¸å¤šchartä¸­é‡å¤ä½¿ç”¨çš„ä»£ç æ®µï¼Œä»è€Œé¿å…äº†å†—ä½™å¹¶ä½¿ chart ä¿æŒç®€æ´ã€‚</p><p>Library chart åœ¨ Chart.yaml çš„ä¾èµ–æŒ‡ä»¤ä¸­å£°æ˜ï¼Œå®‰è£…å’Œç®¡ç†ä¸å…¶ä»–chartä¸€è‡´ï¼Œå…¶è¡¨è¾¾å¼ç±»ä¼¼å¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mylib</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">1.</span><span class="hljs-string">x.x</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io</span><br></code></pre></td></tr></table></figure><h4 id="13ï¼‰Chart-yaml-çš„-apiVersion-å‡çº§"><a href="#13ï¼‰Chart-yaml-çš„-apiVersion-å‡çº§" class="headerlink" title="13ï¼‰Chart.yaml çš„ apiVersion å‡çº§"></a>13ï¼‰Chart.yaml çš„ apiVersion å‡çº§</h4><h5 id="1âƒ£ï¸-apiVersion-v1-å‡çº§è‡³-v2"><a href="#1âƒ£ï¸-apiVersion-v1-å‡çº§è‡³-v2" class="headerlink" title="1âƒ£ï¸ apiVersion v1 å‡çº§è‡³ v2"></a>1âƒ£ï¸ apiVersion v1 å‡çº§è‡³ v2</h5><p>ç”±äº Helm3 ä¸­æ–°å¢äº†è®¸å¤šæ–°çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æ”¯æŒ <code>library chart</code> ã€<code>requirements.yaml</code> åˆå¹¶è¿› <code>Chart.yaml</code>ã€‚è€Œå®¢æˆ·ç«¯è™½ç„¶å¯ä»¥æ˜¯åˆ« Helm2 çš„åŒ…æ ¼å¼ï¼Œå´ä¸èƒ½ç†è§£è¿™äº›æ–°çš„ç‰¹æ€§ï¼Œå› æ­¤ Helm3 ä¸­çš„ Chart.yaml çš„ apiVersion ä¹Ÿä» v1 å‡çº§åˆ°å¯ v2ã€‚</p><p>ä½¿ç”¨ Helm3 çš„ <code>helm create</code> åˆ›å»ºçš„ chart å°†ä½¿ç”¨æ–°æ ¼å¼ï¼Œé»˜è®¤çš„ apiVersion ä¹Ÿå°†ä½¿ç”¨ v2ã€‚</p><h5 id="2âƒ£ï¸-ApiVersion-æ”¹ä¸º-APIVersion"><a href="#2âƒ£ï¸-ApiVersion-æ”¹ä¸º-APIVersion" class="headerlink" title="2âƒ£ï¸ ApiVersion æ”¹ä¸º APIVersion"></a>2âƒ£ï¸ ApiVersion æ”¹ä¸º APIVersion</h5><p>Helm3 å¯¹äºé©¼å³°çš„å‘½ä»¤è§„èŒƒè¿›è¡Œäº†ä¿®æ”¹ï¼Œéµå¾ªé©¼å³°å‘½åçš„å…¸å‹æƒ¯ä¾‹ï¼Œå› æ­¤å°† <code>.Chart.ApiVersion</code> æ›´æ­£ä¸ºäº† <code>.Chart.APIVersion</code>ï¼Œå…¶ä»–è¯¸å¦‚ <code>.Capabilities.APIVersions.Has</code> éƒ½è¿›è¡Œäº†æ›´æ­£å¤„ç†ã€‚</p><h4 id="14ï¼‰XDG-åŸºæœ¬ç›®å½•æ”¯æŒ"><a href="#14ï¼‰XDG-åŸºæœ¬ç›®å½•æ”¯æŒ" class="headerlink" title="14ï¼‰XDG åŸºæœ¬ç›®å½•æ”¯æŒ"></a>14ï¼‰XDG åŸºæœ¬ç›®å½•æ”¯æŒ</h4><p><a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG åŸºæœ¬ç›®å½•è§„èŒƒ</a> æ˜¯ä¸€ä¸ªå®šä¹‰äº†é…ç½®ã€æ•°æ®å’Œç¼“å­˜æ–‡ä»¶åº”è¯¥å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä»€ä¹ˆä½ç½®çš„å¯ç§»æ¤æ ‡å‡†ã€‚</p><p>åœ¨ Helm2 ä¸­ï¼ŒHelm ç›¸å…³çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ <code>~/.helm/</code> ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ <code>$HELM_HOME</code> æˆ–è€… <code>--home</code> å‚æ•°æŒ‡å®šã€‚è€Œåœ¨ Helm3 ä¸­ï¼Œç›¸å…³çš„ç¯å¢ƒå˜é‡åˆ™å˜æ›´ä¸ºäº†ä»¥ä¸‹è§„èŒƒå½¢å¼ï¼š</p><blockquote><ul><li>$XDG_CACHE_HOME        # ç”¨äºå­˜æ”¾ç¼“å­˜æ–‡ä»¶</li><li>$XDG_CONFIG_HOME      # ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶</li><li>$XDG_DATA_HOME          # ç”¨äºå­˜æ”¾æ•°æ®æ–‡ä»¶</li></ul></blockquote><p>ä½†æ˜¯åœ¨ Helm3 ä¸­ä»ä¿ç•™äº† <code>$HELM_HOME</code> ä½œä¸º <code>$XDG_DATA_HOME</code> çš„åˆ«åï¼Œä»¥æ­¤æ¥ä¿è¯è¿‡æ¸¡é˜¶æ®µçš„å…¼å®¹æ€§ã€‚</p><p>Helm æ’ä»¶å¦‚è¿‡è¦æ”¯æŒ Helm3ï¼Œä¹Ÿå¯ä»¥ç”¨ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼Œæ¥é€‚åº”è¿™ç§å˜åŒ–ï¼š</p><blockquote><ul><li>$HELM_PATH_CACHE       # ç”¨äºå­˜æ”¾ç¼“å­˜æ–‡ä»¶</li><li>$HELM_PATH_CONFIG     # ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶</li><li>$HELM_PATH_DATA          # ç”¨äºå­˜æ”¾æ•°æ®æ–‡ä»¶</li></ul></blockquote><h5 id="å„ç¯å¢ƒé»˜è®¤æ–‡ä»¶å­˜æ”¾ä½ç½®"><a href="#å„ç¯å¢ƒé»˜è®¤æ–‡ä»¶å­˜æ”¾ä½ç½®" class="headerlink" title="å„ç¯å¢ƒé»˜è®¤æ–‡ä»¶å­˜æ”¾ä½ç½®"></a>å„ç¯å¢ƒé»˜è®¤æ–‡ä»¶å­˜æ”¾ä½ç½®</h5><blockquote><p>ğŸš© å¯ä»¥é€šè¿‡ <code>helm env</code> æŸ¥çœ‹</p></blockquote><table><thead><tr><th><strong>Operating System</strong></th><th><strong>Cache Path</strong></th><th><strong>Configuration Path</strong></th><th><strong>Data Path</strong></th></tr></thead><tbody><tr><td><strong>Linux</strong></td><td>$HOME/.cache/helm</td><td>$HOME/.config/helm</td><td>$HOME/.local/share/helm</td></tr><tr><td><strong>macOS</strong></td><td>$HOME/Library/Caches/helm</td><td>$HOME/Library/Preferences/helm</td><td>$HOME/Library/helm</td></tr><tr><td><strong>Windows</strong></td><td>%TEMP%\helm</td><td>%APPDATA%\helm</td><td>%APPDATA%\helm</td></tr></tbody></table><h4 id="15ï¼‰CLI-å‘½ä»¤é‡å‘½å"><a href="#15ï¼‰CLI-å‘½ä»¤é‡å‘½å" class="headerlink" title="15ï¼‰CLI å‘½ä»¤é‡å‘½å"></a>15ï¼‰CLI å‘½ä»¤é‡å‘½å</h4><h5 id="1âƒ£ï¸-helm-delete-æ›´æ”¹ä¸º-helm-uninstall"><a href="#1âƒ£ï¸-helm-delete-æ›´æ”¹ä¸º-helm-uninstall" class="headerlink" title="1âƒ£ï¸ helm delete æ›´æ”¹ä¸º helm uninstall"></a>1âƒ£ï¸ <code>helm delete</code> æ›´æ”¹ä¸º <code>helm uninstall</code></h5><p>åœ¨ Helm2 ä¸­ï¼Œå¦‚æœè¦æ¸…æ¥š release çš„å„ç§èµ„æºï¼Œå¿…é¡»è¦ä½¿ç”¨ <code>--purge</code> å‚æ•°ï¼ŒHelm3 ä¸­é»˜è®¤å°±ä¼šå¯ç”¨æ¬¡åŠŸã€‚</p><p>å¦‚æœè¦ä¿ç•™å†å²è¡Œä¸ºæ•°æ®ï¼Œéœ€æ‰§è¡Œ <code>helm uninstall --keep-history</code></p><h5 id="2âƒ£ï¸-helm-inspect-æ›´æ”¹ä¸º-helm-show"><a href="#2âƒ£ï¸-helm-inspect-æ›´æ”¹ä¸º-helm-show" class="headerlink" title="2âƒ£ï¸ helm inspect æ›´æ”¹ä¸º helm show"></a>2âƒ£ï¸ <code>helm inspect</code> æ›´æ”¹ä¸º <code>helm show</code></h5><h5 id="3âƒ£ï¸-helm-fetch-æ›´æ”¹ä¸º-helm-pull"><a href="#3âƒ£ï¸-helm-fetch-æ›´æ”¹ä¸º-helm-pull" class="headerlink" title="3âƒ£ï¸ helm fetch æ›´æ”¹ä¸º helm pull"></a>3âƒ£ï¸ <code>helm fetch</code> æ›´æ”¹ä¸º <code>helm pull</code></h5><blockquote><p>ğŸš© <strong>è¿™äº›å‘½ä»¤è¿˜ä¿ç•™äº†å®ƒä»¬è¾ƒæ—§çš„å‘½ä»¤ä½œä¸ºåˆ«åï¼Œå› æ­¤æ‚¨å¯ä»¥ç»§ç»­ä»¥ä»»ä½•ä¸€ç§å½¢å¼ä½¿ç”¨å®ƒä»¬ã€‚</strong></p></blockquote><h4 id="16ï¼‰ç®€åŒ–æ¨¡æ¿å¯¹è±¡-Capabilities"><a href="#16ï¼‰ç®€åŒ–æ¨¡æ¿å¯¹è±¡-Capabilities" class="headerlink" title="16ï¼‰ç®€åŒ–æ¨¡æ¿å¯¹è±¡ .Capabilities"></a>16ï¼‰ç®€åŒ–æ¨¡æ¿å¯¹è±¡ .Capabilities</h4><p><code>Capabilities</code> æ˜¯ Helm æ¨¡ç‰ˆå¯ä»¥è®¿é—®çš„å†…ç½®å¯¹è±¡ä¹‹ä¸€ï¼Œå…¶æä¾›äº†å…³äº Kubernetes é›†ç¾¤æ”¯æŒçš„åŠŸèƒ½çš„ä¿¡æ¯ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><table><thead><tr><th>å¯¹è±¡åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>Capabilities.APIVersions</td><td>é›†ç¾¤çš„ç‰ˆæœ¬ä¿¡æ¯</td></tr><tr><td>Capabilities.APIVersions.Has $version</td><td>è¯´æ˜é›†ç¾¤ä¸­çš„ç‰ˆæœ¬ (ä¾‹å¦‚, <code>batch/v1</code>) æˆ–æ˜¯èµ„æº (ä¾‹å¦‚, <code>apps/v1/Deployment</code>) æ˜¯å¦å¯ç”¨</td></tr><tr><td>Capabilities.KubeVersion</td><td>æä¾›äº†æŸ¥æ‰¾ Kubernetes ç‰ˆæœ¬çš„æ–¹æ³•ã€‚å¯ä»¥è·å–åˆ° <code>Major</code>ï¼Œ<code>Minor</code>ï¼Œ<code>GitVersion</code>ï¼Œ<code>GitCommit</code>ï¼Œ<code>GitTreeState</code>ï¼Œ<code>BuildDate</code>ï¼Œ<code>GoVersion</code>ï¼Œ<code>Compiler</code>å’Œ<code>Platform</code>ã€‚</td></tr><tr><td>Capabilities.TillerVersion</td><td>æä¾›äº†æŸ¥æ‰¾Tillerç‰ˆæœ¬çš„æ–¹æ³•ã€‚å¯ä»¥è·å–åˆ°<code>SemVer</code>, <code>GitCommit</code>, and <code>GitTreeState</code>.</td></tr></tbody></table><hr><h2 id="å››ã€Helmç‰ˆæœ¬æ”¯æŒç­–ç•¥"><a href="#å››ã€Helmç‰ˆæœ¬æ”¯æŒç­–ç•¥" class="headerlink" title="å››ã€Helmç‰ˆæœ¬æ”¯æŒç­–ç•¥"></a>å››ã€Helmç‰ˆæœ¬æ”¯æŒç­–ç•¥</h2><h3 id="1ã€-ç‰ˆæœ¬å½¢å¼"><a href="#1ã€-ç‰ˆæœ¬å½¢å¼" class="headerlink" title="1ã€ ç‰ˆæœ¬å½¢å¼"></a>1ã€ ç‰ˆæœ¬å½¢å¼</h3><blockquote><p>Helm çš„ç‰ˆæœ¬ç”¨ <code>x.y.z</code> çš„å½¢å¼æè¿°ï¼Œ<code>x</code> æ˜¯ä¸»ç‰ˆæœ¬ï¼Œ<code>y</code> æ˜¯æ¬¡ç‰ˆæœ¬ï¼Œ<code>z</code> æ˜¯è¡¥ä¸ç‰ˆæœ¬ã€‚å½“ä¸€ä¸ª Helm çš„æ–°ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œéƒ½æ˜¯é’ˆå¯¹ Kubernetes çš„ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬ç¼–è¯‘çš„ï¼Œæ¯”å¦‚ <code>3.0.0</code> åŸºäº Kubernetes çš„ <code>1.16.2</code> çš„å®¢æˆ·ç«¯APIç‰ˆæœ¬æ„å»ºï¼Œåˆ™å¯ä»¥å…¼å®¹ Kubernetes 1.16ã€‚</p></blockquote><h3 id="2ã€å¯æ”¯æŒçš„ç‰ˆæœ¬åå·®"><a href="#2ã€å¯æ”¯æŒçš„ç‰ˆæœ¬åå·®" class="headerlink" title="2ã€å¯æ”¯æŒçš„ç‰ˆæœ¬åå·®"></a>2ã€å¯æ”¯æŒçš„ç‰ˆæœ¬åå·®</h3><blockquote><p>ç›¸è¾ƒäº Helm2 å¯¹äº Kubernetes æ¬¡ç‰ˆæœ¬å˜æ›´æ”¯æŒçš„ä¸¥æ ¼ï¼ˆ<code>n-1</code>ï¼‰ï¼ŒHelm3 å¯ä»¥å‘ä¸‹å…¼å®¹ <code>n-3</code> çš„æ¬¡ç‰ˆæœ¬ï¼Œæ¯”å¦‚ä½ ä½¿ç”¨ä¸€ä¸ªé’ˆå¯¹ Kubernetes 1.18 å®¢æˆ·ç«¯ API ç‰ˆæœ¬ç¼–è¯‘çš„ Helm3 ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬ä¸º 1.18ã€1.17ã€1.16ã€1.15 ï¼›</p><p>å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªé’ˆå¯¹ Kubernetes 1.15 å®¢æˆ·ç«¯ API ç‰ˆæœ¬ç¼–è¯‘çš„ Helm2 ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬ä¸º 1.15ã€1.14ã€‚</p><p>âš ï¸ <strong>æ³¨æ„ï¼š</strong> Helm æ²¡æœ‰å‘ä¸Šå…¼å®¹æœºåˆ¶ï¼Œæ•…æ¨èå®‰è£…ä¸‹è¡¨è¿›è¡Œç‰ˆæœ¬é€‰æ‹©ã€‚</p></blockquote><table><thead><tr><th>Helm ç‰ˆæœ¬</th><th>æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>3.6.x</td><td>1.21.x - 1.18.x</td></tr><tr><td>3.5.x</td><td>1.20.x - 1.17.x</td></tr><tr><td>3.4.x</td><td>1.19.x - 1.16.x</td></tr><tr><td>3.3.x</td><td>1.18.x - 1.15.x</td></tr><tr><td>3.2.x</td><td>1.18.x - 1.15.x</td></tr><tr><td>3.1.x</td><td>1.17.x - 1.14.x</td></tr><tr><td>3.0.x</td><td>1.16.x - 1.13.x</td></tr><tr><td>2.16.x</td><td>1.16.x - 1.15.x</td></tr><tr><td>2.15.x</td><td>1.15.x - 1.14.x</td></tr><tr><td>2.14.x</td><td>1.14.x - 1.13.x</td></tr><tr><td>2.13.x</td><td>1.13.x - 1.12.x</td></tr><tr><td>2.12.x</td><td>1.12.x - 1.11.x</td></tr><tr><td>2.11.x</td><td>1.11.x - 1.10.x</td></tr><tr><td>2.10.x</td><td>1.10.x - 1.9.x</td></tr><tr><td>2.9.x</td><td>1.10.x - 1.9.x</td></tr><tr><td>2.8.x</td><td>1.9.x - 1.8.x</td></tr><tr><td>2.7.x</td><td>1.8.x - 1.7.x</td></tr><tr><td>2.6.x</td><td>1.7.x - 1.6.x</td></tr><tr><td>2.5.x</td><td>1.6.x - 1.5.x</td></tr><tr><td>2.4.x</td><td>1.6.x - 1.5.x</td></tr><tr><td>2.3.x</td><td>1.5.x - 1.4.x</td></tr><tr><td>2.2.x</td><td>1.5.x - 1.4.x</td></tr><tr><td>2.1.x</td><td>1.5.x - 1.4.x</td></tr><tr><td>2.0.x</td><td>1.4.x - 1.3.x</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
