<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ç¬¬4ç« ã€Chart æ¨¡ç‰ˆè¯¦è§£</title>
    <link href="/2021/07/24/%E7%AC%AC4%E7%AB%A0%E3%80%81Chart-%E6%A8%A1%E7%89%88%E8%AF%A6%E8%A7%A3/"/>
    <url>/2021/07/24/%E7%AC%AC4%E7%AB%A0%E3%80%81Chart-%E6%A8%A1%E7%89%88%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬4ç« ã€Chart-æ¨¡ç‰ˆè¯¦è§£"><a href="#ç¬¬4ç« ã€Chart-æ¨¡ç‰ˆè¯¦è§£" class="headerlink" title="ç¬¬4ç« ã€Chart æ¨¡ç‰ˆè¯¦è§£"></a>ç¬¬4ç« ã€Chart æ¨¡ç‰ˆè¯¦è§£</h1><span id="more"></span><h2 id="ä¸€ã€ç¼–å†™ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆ"><a href="#ä¸€ã€ç¼–å†™ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆ" class="headerlink" title="ä¸€ã€ç¼–å†™ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆ"></a>ä¸€ã€ç¼–å†™ç¬¬ä¸€ä¸ªæ¨¡ç‰ˆ</h2><h3 id="1ã€å‰æœŸå‡†å¤‡"><a href="#1ã€å‰æœŸå‡†å¤‡" class="headerlink" title="1ã€å‰æœŸå‡†å¤‡"></a>1ã€å‰æœŸå‡†å¤‡</h3><blockquote><p>ğŸš© <strong>å†™åœ¨å¼€å§‹ä¹‹å‰</strong></p><p>ä¸Šä¸€ç« ä¸­æˆ‘ä»¬è¯´åˆ°è¿‡ï¼ŒHelm å‡ºæ¥å¯ä»¥å®‰è£…å®˜æ–¹æˆ–è€…ä¸‰æ–¹æä¾›çš„ <em>chart</em> åŒ…å¤–ï¼Œæ›´é‡è¦çš„æ˜¯æ”¯æŒåˆ›å»ºè‡ªå·±çš„ <code>chart</code>ï¼Œå°±è¡Œ <em>docker image</em> å’Œ <em>dockerfile</em>ï¼Œé€šè¿‡è‡ªå®šä¹‰ç¼–æ’ï¼Œæ–¹èƒ½å®ç°é€šè¿‡ Helm æ¥ç®¡ç†æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ã€‚</p><p>ä»ä¹‹å‰çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾å¾—å‡º <code>chart</code> çš„æ ¸å¿ƒæ˜¯èµ„æºæ¨¡ç‰ˆ <code>templates</code> å’Œæ¸²æŸ“ <code>.Values</code>ï¼Œè€Œå…¶ä¸­çš„å…³é”®ï¼Œåˆ™æ˜¯å¦‚ä½•å†™èµ„æºæ¨¡ç‰ˆï¼Œè™½ç„¶å…¶æ•´ä½“å£°æ˜å¼å’Œ K8s çš„ <em>yaml</em> è¡¨è¾¾å¼æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ—¢ç„¶æ¨¡ç‰ˆï¼Œè‡ªç„¶å°±è¦ä¸ºéœ€è¦æ¸²æŸ“çš„åœ°æ–¹ä¿ç•™å˜é‡ï¼Œå¹¶é€šè¿‡è¯­æ³•å»è·å–å¯¹åº”çš„å€¼ï¼Œæœ€ç»ˆæ‰èƒ½å‘ç”Ÿæ¸²æŸ“çš„æ•ˆæœã€‚è¿™ä¸ªç« èŠ‚æˆ‘ä»¬å°±æ¥å­¦ä¹ å¦‚ä½•é€šè¿‡ <code>Chart æ¨¡ç‰ˆ</code> çš„è¯­æ³•æ¥å†™æˆ‘ä»¬è‡ªå·±çš„æ¨¡ç‰ˆã€‚</p></blockquote><h4 id="1ï¼‰åˆ›å»ºä¸€ä¸ªç©ºçš„-chart"><a href="#1ï¼‰åˆ›å»ºä¸€ä¸ªç©ºçš„-chart" class="headerlink" title="1ï¼‰åˆ›å»ºä¸€ä¸ªç©ºçš„ chart"></a>1ï¼‰åˆ›å»ºä¸€ä¸ªç©ºçš„ chart</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm create mychart<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åˆ é™¤æ‰€æœ‰é»˜è®¤ç”Ÿæˆçš„æ¨¡ç‰ˆ"><a href="#2ï¼‰åˆ é™¤æ‰€æœ‰é»˜è®¤ç”Ÿæˆçš„æ¨¡ç‰ˆ" class="headerlink" title="2ï¼‰åˆ é™¤æ‰€æœ‰é»˜è®¤ç”Ÿæˆçš„æ¨¡ç‰ˆ"></a>2ï¼‰åˆ é™¤æ‰€æœ‰é»˜è®¤ç”Ÿæˆçš„æ¨¡ç‰ˆ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">\rm -rf mychart/templates/*<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è¿™ä¸€ç« çš„å­¦ä¹ ä¹‹æ—…äº†ï¼ï¼</p><h3 id="2ã€åˆ›å»º-ConfigMap-æ¨¡ç‰ˆ"><a href="#2ã€åˆ›å»º-ConfigMap-æ¨¡ç‰ˆ" class="headerlink" title="2ã€åˆ›å»º ConfigMap æ¨¡ç‰ˆ"></a>2ã€åˆ›å»º ConfigMap æ¨¡ç‰ˆ</h3><h4 id="1ï¼‰åˆ›å»ºæ–‡ä»¶"><a href="#1ï¼‰åˆ›å»ºæ–‡ä»¶" class="headerlink" title="1ï¼‰åˆ›å»ºæ–‡ä»¶"></a>1ï¼‰åˆ›å»ºæ–‡ä»¶</h4><p>æ–‡ä»¶è·¯å¾„: <code>mychart/templates/configmap.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">myvalue:</span> <span class="hljs-string">&quot;Hello World&quot;</span><br></code></pre></td></tr></table></figure><h5 id="è¡¨è¾¾å¼è¯´æ˜"><a href="#è¡¨è¾¾å¼è¯´æ˜" class="headerlink" title="è¡¨è¾¾å¼è¯´æ˜"></a>è¡¨è¾¾å¼è¯´æ˜</h5><p>1âƒ£ï¸ <code>&#123;&#123; &#125;&#125;</code> å’Œ <code>.</code> æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ç›¸è¾ƒäºç»å…¸çš„ yaml å£°æ˜å¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæœ€å¤§çš„å˜åŒ–åœ¨äº <code>&#123;&#123; .Release.Name &#125;&#125;</code>ã€‚<code>&#123;&#123; &#125;&#125;</code> å°±æ˜¯æ¨¡ç‰ˆè°ƒç”¨çš„æ–¹æ³•ï¼Œå…¶ä¸­åŠ ä¸Šè¦å¼•ç”¨çš„å…ƒç´ ï¼Œæ¨¡ç‰ˆå‘½ä»¤å°±ä¼šå°†å…¶å¯¹ç”¨çš„å€¼ä½œä¸ºä¸€ä¸ªå¯¹è±¡æ³¨å…¥æ¨¡ç‰ˆä¹‹ä¸­ï¼Œå…¶ä¸­ <code>.</code> ç”¨äºåˆ†å‰²æ¯ä¸ªå‘½ä»¤ç©ºé—´å†…éœ€è¦æœç´¢å…ƒç´ ï¼Œæœ€å‰é¢çš„ <code>.</code>è¡¨ç¤ºä»ä½œç”¨åŸŸçš„æœ€é¡¶å±‚æœç´¢å¯¹è±¡ã€‚æ¨¡ç‰ˆä¼šä»æœ€é¡¶å±‚çš„å‘½ä»¤ç©ºé—´å¼€å§‹æœç´¢ <code>.</code> æŒ‡å®šçš„å¯¹è±¡ã€‚</p><p>ç”±æ­¤ï¼Œ<code>&#123;&#123; .Release.Name &#125;&#125;</code> å°±åº”å½“è§£è¯»ä¸º â€œ<strong>ä»æœ€é¡¶å±‚çš„å‘½åç©ºé—´å¼€å§‹æœç´¢ <code>Release</code> å¯¹è±¡ï¼Œç„¶ååœ¨å…¶ä¸­æœç´¢ <code>Name</code> å¯¹è±¡</strong>â€œã€‚<code>Relase</code> æ˜¯ Helm çš„å†…ç½®å¯¹è±¡ï¼Œè¡¨ç¤ºå‘å¸ƒæœ¬èº«ã€‚</p><p>2âƒ£ï¸ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå¤„ç†ï¼Ÿ</p><p>æ¨¡ç‰ˆçš„æ„ä¹‰åœ¨äºå¤ç”¨ã€‚é€šè¿‡ä¼ å…¥ä¸åŒçš„å€¼æ¥æ¸²æŸ“å‡ºä¸åŒçš„ç»“æœï¼Œæ‰æ˜¯æ¨¡ç‰ˆå­˜åœ¨çš„æ„ä¹‰ï¼Œå› æ­¤é’ˆå¯¹æ¨¡ç‰ˆæˆ‘ä»¬åº”å½“åšæŒ â€œ<strong>å¯å˜é‡åŒ–</strong>â€œçš„åŸåˆ™ï¼Œå°†éé€šç”¨æ€§çš„å­—æ®µè¿›è¡Œå˜é‡åŒ–å¤„ç†ï¼Œè¿™æ ·æ‰èƒ½ä½¿å¾—æˆ‘ä»¬çš„æ¨¡ç‰ˆæ›´å…·å¤‡æ³›ç”¨æ€§ï¼Œå¢åŠ å¤ç”¨çš„å¯èƒ½ã€‚</p><blockquote><p>âš ï¸ <strong>æ³¨æ„: Release åç§°çš„é•¿åº¦é™åˆ¶</strong>  </p><p>DNS ç³»ç»Ÿé™åˆ¶ <code>name</code> å­—æ®µçš„é•¿åº¦ä¸èƒ½è¶…è¿‡ <strong>63</strong> ä¸ªå­—ç¬¦ï¼Œå› æ­¤ Helm å¯¹ <code>Release</code> çš„åç§°æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼Œ<strong>Helm3 å¯¹äºå…¶é•¿åº¦é™åˆ¶ä¸º 53 ä¸ªå­—ç¬¦</strong>ã€‚</p></blockquote><h4 id="2ï¼‰å‘å¸ƒ-chart"><a href="#2ï¼‰å‘å¸ƒ-chart" class="headerlink" title="2ï¼‰å‘å¸ƒ chart"></a>2ï¼‰å‘å¸ƒ chart</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install test-chart ./mychart<br></code></pre></td></tr></table></figure><p>è¿”å›å€¼å¦‚ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705160256966.png" alt="image-20210705160256966"></p><p>æŸ¥çœ‹å‘å¸ƒ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm list<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705161041080.png" alt="image-20210705161041080"></p><h4 id="3ï¼‰æŸ¥çœ‹-manifest"><a href="#3ï¼‰æŸ¥çœ‹-manifest" class="headerlink" title="3ï¼‰æŸ¥çœ‹ manifest"></a>3ï¼‰æŸ¥çœ‹ manifest</h4><blockquote><p>æ‰§è¡Œ <code>helm get manifest</code> å¯ä»¥æ‰“å°å‡º <code>release</code> å·²ç»ä¸Šä¼ åˆ° <code>api server</code> çš„èµ„æºã€‚æ¯ä¸ªæ–‡ä»¶éƒ½ä¼šä»¥ <code>---</code> `å¼€å¤´ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆæ³¨é‡Šã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥å‘ç°æ¨¡ç‰ˆä¸­çš„ <code>&#123;&#123; .Release.Name &#125;&#125;</code> è°ƒç”¨å·²ç»æ¸²æŸ“æˆäº† Release çš„åç§°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm get manifest &lt;release_name&gt;</span><br>helm get manifest test-chart<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705160402893.png" alt="image-20210705160402893"></p><h4 id="4ï¼‰æŸ¥çœ‹æ¸²æŸ“æ•ˆæœï¼ˆä¸å‘å¸ƒï¼‰"><a href="#4ï¼‰æŸ¥çœ‹æ¸²æŸ“æ•ˆæœï¼ˆä¸å‘å¸ƒï¼‰" class="headerlink" title="4ï¼‰æŸ¥çœ‹æ¸²æŸ“æ•ˆæœï¼ˆä¸å‘å¸ƒï¼‰"></a>4ï¼‰æŸ¥çœ‹æ¸²æŸ“æ•ˆæœï¼ˆä¸å‘å¸ƒï¼‰</h4><h5 id="1-å¸è½½åº”ç”¨"><a href="#1-å¸è½½åº”ç”¨" class="headerlink" title="1. å¸è½½åº”ç”¨"></a>1. å¸è½½åº”ç”¨</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm uninstall test-chart<br></code></pre></td></tr></table></figure><h5 id="2-æ¸²æŸ“æµ‹è¯•"><a href="#2-æ¸²æŸ“æµ‹è¯•" class="headerlink" title="2. æ¸²æŸ“æµ‹è¯•"></a>2. æ¸²æŸ“æµ‹è¯•</h5><h6 id="1âƒ£ï¸-dry-run"><a href="#1âƒ£ï¸-dry-run" class="headerlink" title="1âƒ£ï¸ --dry-run"></a>1âƒ£ï¸ <code>--dry-run</code></h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run test-chart ./mychart<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705162015141.png" alt="image-20210705162015141"></p><h6 id="2âƒ£ï¸-debug"><a href="#2âƒ£ï¸-debug" class="headerlink" title="2âƒ£ï¸ --debug"></a>2âƒ£ï¸ <code>--debug</code></h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run --debug test-chart ./mychart<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705161728732.png" alt="image-20210705161728732"></p><h3 id="3ã€Values-çš„ä½¿ç”¨"><a href="#3ã€Values-çš„ä½¿ç”¨" class="headerlink" title="3ã€Values çš„ä½¿ç”¨"></a>3ã€Values çš„ä½¿ç”¨</h3><p>ç¡®åˆ‡çš„è¯´ï¼Œ<code>Values</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæä¾›äº†å¯¹äºä¼ é€’åˆ° chart æ¨¡ç‰ˆçš„å€¼çš„è®¿é—®æ–¹æ³•ã€‚å…¶å†…å®¹çš„ä¸»è¦æ¥æºå¦‚ä¸‹:</p><blockquote><ul><li>chart ä¸­é»˜è®¤çš„ <code>values.yaml</code> æ–‡ä»¶</li><li>å¦‚æœæ˜¯<em>å­ chart</em>ï¼Œåˆ™ä¸º<em>çˆ¶ chart</em> çš„ <code>values.yaml</code> æ–‡ä»¶</li><li>å‘½ä»¤è¡Œä½¿ç”¨ <code>-f</code> æŒ‡å®šçš„ values æ–‡ä»¶</li><li>å‘½ä»¤è¡Œä½¿ç”¨ <code>--set</code> ä¼ å…¥çš„å•ä¸ªå‚æ•°</li></ul><p>ğŸš©å…¶ä¼˜å…ˆçº§é¡ºåºæŒ‰ç…§ä¸Šè¿°åˆ—è¡¨è‡ªä¸‹è€Œä¸Šï¼Œä¾æ¬¡å‡å¼±ã€‚</p></blockquote><h4 id="1ï¼‰åˆ é™¤é»˜è®¤çš„-values-yaml"><a href="#1ï¼‰åˆ é™¤é»˜è®¤çš„-values-yaml" class="headerlink" title="1ï¼‰åˆ é™¤é»˜è®¤çš„ values.yaml"></a>1ï¼‰åˆ é™¤é»˜è®¤çš„ values.yaml</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rm -f mychart/values.yaml <br></code></pre></td></tr></table></figure><h4 id="2ï¼‰åŸºæœ¬ä½¿ç”¨"><a href="#2ï¼‰åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2ï¼‰åŸºæœ¬ä½¿ç”¨"></a>2ï¼‰åŸºæœ¬ä½¿ç”¨</h4><h5 id="1-åˆ›å»º-values-yaml"><a href="#1-åˆ›å»º-values-yaml" class="headerlink" title="1. åˆ›å»º values.yaml"></a>1. åˆ›å»º values.yaml</h5><p>æ–‡ä»¶è·¯å¾„: <code>mychart/values.yaml</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">aaa:</span> <span class="hljs-string">bbb</span><br></code></pre></td></tr></table></figure><h5 id="2-åœ¨-ConfigMap-æ¨¡ç‰ˆä¸­å¼•ç”¨"><a href="#2-åœ¨-ConfigMap-æ¨¡ç‰ˆä¸­å¼•ç”¨" class="headerlink" title="2. åœ¨ ConfigMap æ¨¡ç‰ˆä¸­å¼•ç”¨"></a>2. åœ¨ <code>ConfigMap</code> æ¨¡ç‰ˆä¸­å¼•ç”¨</h5><p>æ–‡ä»¶è·¯å¾„: <code>mychart/templates/configmap.yaml </code>ï¼Œå†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">myvalue:</span> <span class="hljs-string">&quot;Hello World&quot;</span><br>  <span class="hljs-attr">aaa:</span> &#123;&#123; <span class="hljs-string">.Values.aaa</span> &#125;&#125;<span class="hljs-comment"># è¿½åŠ å†…å®¹</span><br></code></pre></td></tr></table></figure><h5 id="3-æ¸²æŸ“æ¨¡ç‰ˆ"><a href="#3-æ¸²æŸ“æ¨¡ç‰ˆ" class="headerlink" title="3. æ¸²æŸ“æ¨¡ç‰ˆ"></a>3. æ¸²æŸ“æ¨¡ç‰ˆ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run test-chart ./mychart<br></code></pre></td></tr></table></figure><p><strong>æ¸²æŸ“ç»“æœå¦‚ä¸‹ï¼š</strong></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707143605000.png" alt="image-20210707143605000"></p><h4 id="3ï¼‰å¤šç»“æ„åŒ–è¡¨è¾¾å¼"><a href="#3ï¼‰å¤šç»“æ„åŒ–è¡¨è¾¾å¼" class="headerlink" title="3ï¼‰å¤šç»“æ„åŒ–è¡¨è¾¾å¼"></a>3ï¼‰å¤šç»“æ„åŒ–è¡¨è¾¾å¼</h4><h5 id="1-åˆ›å»º-values-yaml-1"><a href="#1-åˆ›å»º-values-yaml-1" class="headerlink" title="1. åˆ›å»º values.yaml"></a>1. åˆ›å»º values.yaml</h5><p>æ–‡ä»¶è·¯å¾„ï¼š<code>mychart/other_values.yaml</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">person:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">Tareya</span><br>  <span class="hljs-attr">gender:</span> <span class="hljs-string">male</span><br>  <span class="hljs-attr">age:</span> <span class="hljs-number">18</span><br></code></pre></td></tr></table></figure><h5 id="2-åœ¨æ¨¡ç‰ˆä¸­å¼•ç”¨"><a href="#2-åœ¨æ¨¡ç‰ˆä¸­å¼•ç”¨" class="headerlink" title="2. åœ¨æ¨¡ç‰ˆä¸­å¼•ç”¨"></a>2. åœ¨æ¨¡ç‰ˆä¸­å¼•ç”¨</h5><p>æ–‡ä»¶è·¯å¾„ï¼š<code>mychart/templates/configmap.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">myvalue:</span> <span class="hljs-string">&quot;Hello World&quot;</span><br>  <span class="hljs-attr">aaa:</span> &#123;&#123; <span class="hljs-string">.Values.aaa</span> &#125;&#125;<br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.person.name</span> &#125;&#125;<span class="hljs-comment"># è¿½åŠ å†…å®¹</span><br>  <span class="hljs-attr">gender:</span> &#123;&#123; <span class="hljs-string">.Values.person.gender</span> &#125;&#125;<br>  <span class="hljs-attr">age:</span> &#123;&#123; <span class="hljs-string">.Values.person.age</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="3-æ¸²æŸ“æ¨¡ç‰ˆ-1"><a href="#3-æ¸²æŸ“æ¨¡ç‰ˆ-1" class="headerlink" title="3. æ¸²æŸ“æ¨¡ç‰ˆ"></a>3. æ¸²æŸ“æ¨¡ç‰ˆ</h5><p>ä½ å¯ä»¥å‘ç°æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶åå¹¶éé»˜è®¤çš„ <code>values.yaml</code>ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œå¯ä»¥é€šè¿‡ <code>-f</code> çš„æ–¹å¼æŒ‡å®š <code>Values</code> çš„é…ç½®æ–‡ä»¶å—ï¼Ÿè¿™è¾¹æˆ‘ä»¬æ¥è¯•éªŒä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install -f mychart/other_values.yaml --dry-run test-chart ./mychart<br></code></pre></td></tr></table></figure><p><strong>æ¸²æŸ“ç»“æœå¦‚ä¸‹ï¼š</strong></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707145708150.png" alt="image-20210707145708150"></p><p>å¯ä»¥å‘ç°ï¼Œæ¸²æŸ“ç»“æœä¸ä½†è¯»å–äº†é»˜è®¤çš„ <code>values.yaml</code> ï¼Œè¿˜è¯»å–äº†æˆ‘ä»¬æŒ‡å®šçš„ <code>other_values.yaml</code>ã€‚</p><h4 id="4ï¼‰ä½¿ç”¨-set-æŒ‡å®šé…ç½®å‚æ•°"><a href="#4ï¼‰ä½¿ç”¨-set-æŒ‡å®šé…ç½®å‚æ•°" class="headerlink" title="4ï¼‰ä½¿ç”¨ --set æŒ‡å®šé…ç½®å‚æ•°"></a>4ï¼‰ä½¿ç”¨ <code>--set</code> æŒ‡å®šé…ç½®å‚æ•°</h4><p>è¿˜è®°å¾—æˆ‘ä»¬ä¸Šé¢è¯´çš„ Values çš„ä¼˜å…ˆçº§å—ï¼Ÿæˆ‘ä»¬åœ¨è¿™è¾¹åšä¸ªç®€å•çš„éªŒè¯ï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»åœ¨ <code>values.yaml</code> ä¸­è®¾ç½®äº† <code>aaa</code> çš„å€¼ä¸º <code>bbb</code>ï¼Œæ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --set aaa=abcdefg --dry-run test-chart ./mychart<br></code></pre></td></tr></table></figure><p>æ¸²æŸ“ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707144128673.png" alt="image-20210707144128673"></p><p>å¯ä»¥å‘ç°ï¼ŒåŸæœ¬ <code>values.yaml</code> ä¸­çš„é»˜è®¤é…ç½®è¢«æˆ‘ä»¬å‘½ä»¤è¡ŒæŒ‡å®šçš„é…ç½®è¦†ç›–äº†ã€‚</p><h4 id="5ï¼‰é€šè¿‡è®¾ç½®-null-åˆ é™¤é»˜è®¤é…ç½®"><a href="#5ï¼‰é€šè¿‡è®¾ç½®-null-åˆ é™¤é»˜è®¤é…ç½®" class="headerlink" title="5ï¼‰é€šè¿‡è®¾ç½® null åˆ é™¤é»˜è®¤é…ç½®"></a>5ï¼‰é€šè¿‡è®¾ç½® <code>null</code> åˆ é™¤é»˜è®¤é…ç½®</h4><p>æˆ‘ä»¬çŸ¥é“ <code>Values</code> çš„é…ç½®å…¶å®å°±æ˜¯ä¸€ä¸ª Key:Vaule å¯¹ï¼Œæ‰€ä»¥å¦‚æœè¦ä»é»˜è®¤çš„ <code>Values</code> ä¸­åˆ é™¤é…ç½®ï¼Œå…¶å®åªè¦å°† Key è®¾ç½®ä¸º <code>null</code>ï¼ŒHelm åœ¨è¿›è¡Œæ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œå°±ä¼šåˆå¹¶å¹¶åˆ é™¤å¯¹åº”çš„ Keyã€‚</p><h5 id="ç¤ºä¾‹è¯´æ˜"><a href="#ç¤ºä¾‹è¯´æ˜" class="headerlink" title="ç¤ºä¾‹è¯´æ˜"></a>ç¤ºä¾‹è¯´æ˜</h5><p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜ã€‚æ¯”å¦‚ï¼Œç¨³å®šçš„ <code>Drupal</code> chart å…è®¸åœ¨é…ç½®è‡ªå®šä¹‰é•œåƒæ—¶é…ç½®åŠ¨æ€æ¢é’ˆï¼Œé»˜è®¤å€¼å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">livenessProbe:</span><br>  <span class="hljs-attr">httpGet:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/user/login</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>  <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">120</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³ç”¨ <code>exec</code> æ¥ä»£æ›¿ <code>httpGet</code> é‡å†™åŠ¨æ€æ¢é’ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>--set livenessProbe.exec.command=[cat,docroot/CHANGELOG.txt]</code> ï¼Œåœ¨è¿›è¡Œæœ€ç»ˆæ¸²æŸ“åˆå¹¶åï¼Œç”Ÿäº§çš„ manifest å†…å®¹ä¼šå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">livenessProbe:</span><br>  <span class="hljs-attr">httpGet:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/user/login</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>  <span class="hljs-attr">exec:</span><br>    <span class="hljs-attr">command:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">cat</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">docroot/CHANGELOG.txt</span><br>  <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">120</span><br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œç”±äºåŒæ—¶å­˜åœ¨2ä¸ªåŠ¨æ€æ¢é’ˆå¥æŸ„ï¼Œæ‰€ä»¥ K8s åœ¨éƒ¨ç½²æ—¶ä¼šæŠ¥é”™ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install stable/drupal --set image=my-registry/drupal:0.1.0 --set livenessProbe.exec.command=[cat,docroot/CHANGELOG.txt] --set livenessProbe.httpGet=null<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€ç»ˆç”Ÿæˆçš„ manifest å¦‚ä¸‹ï¼Œ<code>httpGet</code> å¥æŸ„ä¼šè¢«åˆ é™¤ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">livenessProbe:</span><br>  <span class="hljs-attr">exec:</span><br>    <span class="hljs-attr">command:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">cat</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">docroot/CHANGELOG.txt</span><br>  <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">120</span><br></code></pre></td></tr></table></figure><p>å¦‚æ­¤ï¼ŒK8s æ‰èƒ½å¤Ÿæ­£å¸¸å®‰è£…ã€‚</p><hr><h2 id="äºŒã€Helm-çš„å†…ç½®å¯¹è±¡åˆ—è¡¨"><a href="#äºŒã€Helm-çš„å†…ç½®å¯¹è±¡åˆ—è¡¨" class="headerlink" title="äºŒã€Helm çš„å†…ç½®å¯¹è±¡åˆ—è¡¨"></a>äºŒã€Helm çš„å†…ç½®å¯¹è±¡åˆ—è¡¨</h2><h3 id="1ã€Release"><a href="#1ã€Release" class="headerlink" title="1ã€Release"></a>1ã€Release</h3><p>è¯¥å¯¹è±¡æè¿°äº†ç‰ˆæœ¬å‘å¸ƒæœ¬èº«ï¼Œå†…éƒ¨å…ƒç´ å¯¹è±¡å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å¯¹è±¡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>.Release.Name</strong></td><td>release çš„åç§°</td></tr><tr><td><strong>.Release.Namespace</strong></td><td>å½“æ¬¡ç‰ˆåŒ…å«çš„å‘½åç©ºé—´</td></tr><tr><td><strong>.Release.IsInstall</strong></td><td>å¦‚æœå½“å‰æ“ä½œä¸ºå®‰è£…ï¼Œåˆ™è¯¥å€¼ä¼šè®¾ç½®ä¸º <code>true</code></td></tr><tr><td><strong>.Release.IsUpgrade</strong></td><td>å¦‚æœå½“å‰æ“ä½œä¸ºå‡çº§æˆ–è€…å›æ»šï¼Œåˆ™è¯¥å€¼ä¼šè®¾ç½®ä¸º <code>true</code></td></tr><tr><td><strong>.Release.Revision</strong></td><td>æ­¤æ¬¡ä¿®è®¢çš„ç‰ˆæœ¬å·ï¼Œåˆæ¬¡å®‰è£…æ—¶ä¸º1ï¼Œæ¯æ¬¡å‡çº§æˆ–å›æ»šæ“ä½œéƒ½ä¼šè‡ªå¢1</td></tr><tr><td><strong>.Release.Service</strong></td><td>ç”¨äºæ¸²æŸ“å½“å‰æ¨¡ç‰ˆçš„ serviceï¼ŒHelm ä¸­ä¸€èˆ¬ä¸º <code>helm</code></td></tr></tbody></table><h3 id="2ã€Files"><a href="#2ã€Files" class="headerlink" title="2ã€Files"></a>2ã€Files</h3><p>è¯¥å¯¹è±¡å…¶å®æ˜¯ä¸€ç»„æ–¹æ³•ï¼Œé€šè¿‡å…¶å¯ä»¥è®¿é—® <em>chart</em> ä¸­æ–‡ä»¶ï¼ˆå¦‚ï¼Œ<code>.helmignore</code>ï¼‰ï¼Œå†…éƒ¨æ–¹æ³•å¯¹è±¡å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å¯¹è±¡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>.Files.Get</strong></td><td>é€šè¿‡æ–‡ä»¶åè·å–æ–‡ä»¶å†…å®¹çš„æ–¹æ³•ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ <code>.Files.Getconfig.ini</code>ï¼Œ<em>config.ini</em> ä¸ºæ–‡ä»¶å</td></tr><tr><td><strong>.Files.GetBytes</strong></td><td>ç”¨å­—èŠ‚æ•°ç»„ä»£æ›¿å­—ç¬¦ä¸²è·å–æ–‡ä»¶å†…å®¹çš„æ–¹æ³•ã€‚ å¯¹å›¾ç‰‡ä¹‹ç±»çš„æ–‡ä»¶å¾ˆæœ‰ç”¨</td></tr><tr><td><strong>.Files.Glob</strong></td><td>ç”¨ç»™å®šçš„ shell glob æ¨¡å¼åŒ¹é…æ–‡ä»¶åï¼Œå¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨</td></tr><tr><td><strong>.Files.Lines</strong></td><td>é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹çš„æ–¹æ³•ã€‚è¿­ä»£æ–‡ä»¶ä¸­æ¯ä¸€è¡Œæ—¶å¾ˆæœ‰ç”¨</td></tr><tr><td><strong>.Files.AsSecrets</strong></td><td>ä½¿ç”¨Base 64ç¼–ç å­—ç¬¦ä¸²è¿”å›æ–‡ä»¶ä½“çš„æ–¹æ³•</td></tr><tr><td><strong>.Files.AsConfig</strong></td><td>ä½¿ç”¨YAMLæ ¼å¼è¿”å›æ–‡ä»¶ä½“çš„æ–¹æ³•</td></tr></tbody></table><h3 id="3ã€Capabilities"><a href="#3ã€Capabilities" class="headerlink" title="3ã€Capabilities"></a>3ã€Capabilities</h3><p>è¯¥å¯¹è±¡æä¾›äº†å…³äº Kubernetes é›†ç¾¤æ”¯æŒåŠŸèƒ½çš„ä¿¡æ¯ï¼Œå†…éƒ¨å…ƒç´ å¯¹è±¡å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å¯¹è±¡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>.Capabilities.APIVersions</strong></td><td>Kubernetes å†…éƒ¨ä½¿ç”¨çš„ç‰ˆæœ¬é›†åˆ</td></tr><tr><td><strong>.Capabilities.APIVersions.Has $version</strong></td><td>è¯´æ˜é›†ç¾¤ä¸­çš„ç‰ˆæœ¬ (å¦‚, <code>batch/v1</code>) æˆ–æ˜¯èµ„æº (å¦‚, <code>apps/v1/Deployment</code>) æ˜¯å¦å¯ç”¨</td></tr><tr><td><strong>.Capabilities.KubeVersion</strong></td><td>Kubernetesçš„ç‰ˆæœ¬å·</td></tr><tr><td><strong>.Capabilities.KubeVersion.Version</strong></td><td>Kubernetesçš„ç‰ˆæœ¬å·</td></tr><tr><td><strong>.Capabilities.KubeVersion.Major</strong></td><td>Kubernetesçš„ä¸»ç‰ˆæœ¬</td></tr><tr><td><strong>.Capabilities.KubeVersion.Minor</strong></td><td>Kubernetesçš„æ¬¡ç‰ˆæœ¬</td></tr></tbody></table><h3 id="4ã€Template"><a href="#4ã€Template" class="headerlink" title="4ã€Template"></a>4ã€Template</h3><p>è¯¥å¯¹è±¡åŒ…å«äº†å·²ç»è¢«æ‰§è¡Œçš„å½“å‰æ¨¡ç‰ˆçš„ä¿¡æ¯ï¼Œå†…éƒ¨å…ƒç´ å¯¹è±¡å¦‚ä¸‹:</p><table><thead><tr><th>å¯¹è±¡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>.Template.Name</strong></td><td>å½“å‰æ¨¡æ¿çš„å‘½åç©ºé—´æ–‡ä»¶è·¯å¾„ (å¦‚ï¼Œ <code>mychart/templates/configmap.yaml</code>)</td></tr><tr><td><strong>.Template.BasePath</strong></td><td>å½“å‰chartæ¨¡æ¿ç›®å½•çš„è·¯å¾„ (å¦‚ï¼Œ<code>mychart/templates</code>)</td></tr></tbody></table><h3 id="5ã€Values"><a href="#5ã€Values" class="headerlink" title="5ã€Values"></a>5ã€Values</h3><p>è¯¥å¯¹è±¡æ˜¯ä» <code>values.yaml</code> æ–‡ä»¶ï¼Œç”¨æˆ·é€šè¿‡ <code>-f</code> å‚æ•°æŒ‡å®šçš„æ–‡ä»¶ä»¥åŠå‘½ä»¤è¡Œ <code>--set</code> å‚æ•°ä¼ å…¥çš„æ–¹å¼æ³¨å…¥æ¨¡ç‰ˆçš„ã€‚<code>Values</code> é»˜è®¤ä¸ºç©ºã€‚</p><h3 id="6ã€Chart"><a href="#6ã€Chart" class="headerlink" title="6ã€Chart"></a>6ã€Chart</h3><p>è¯¥å¯¹è±¡è¡¨ç¤ºçš„æ˜¯ <code>Chart.yaml</code> æ–‡ä»¶çš„å†…å®¹ã€‚å…¶ä¸­ä»»æ„çš„æœ‰æ•ˆæ•°æ®éƒ½å¯ä»¥ä»¥è¯¸è¯¸å¦‚ <code>&#123;&#123; .Chart.Nmae &#125;&#125;-&#123;&#123; .Chart.Version&#125;&#125;</code> è¿™æ ·çš„æ–¹å¼è®¿é—®ã€‚</p><hr><h2 id="ä¸‰ã€å¸¸ç”¨æ¨¡ç‰ˆå‡½æ•°"><a href="#ä¸‰ã€å¸¸ç”¨æ¨¡ç‰ˆå‡½æ•°" class="headerlink" title="ä¸‰ã€å¸¸ç”¨æ¨¡ç‰ˆå‡½æ•°"></a>ä¸‰ã€å¸¸ç”¨æ¨¡ç‰ˆå‡½æ•°</h2><h3 id="1ã€quote-å‡½æ•°å’Œ-squote-å‡½æ•°"><a href="#1ã€quote-å‡½æ•°å’Œ-squote-å‡½æ•°" class="headerlink" title="1ã€quote å‡½æ•°å’Œ squote å‡½æ•°"></a>1ã€quote å‡½æ•°å’Œ squote å‡½æ•°</h3><p><code>quote</code> å‡½æ•°æ˜¯ <code>Sprig</code> æ¨¡ç‰ˆåº“æä¾›çš„ä¸€ç§å­—ç¬¦ä¸²å‡½æ•°ï¼Œå®ƒçš„ç”¨é€”å®é™…ä¸Šå°±æ˜¯ç”¨åŒå¼•å·å°†å­—ç¬¦ä¸²æ‰©èµ·æ¥ï¼ˆè½¬å­—ç¬¦ä¸²ï¼‰ï¼Œå¦‚æœéœ€è¦ <code>&quot;</code> ï¼Œåˆ™éœ€è¦æ·»åŠ  <code>\</code> æ¥è¿›è¡Œè½¬è¯‘ã€‚</p><p><code>squote</code> å‡½æ•°çš„ç”¨é€”æ˜¯ç”¨å•å¼•å·å°†å­—ç¬¦ä¸²æ‰©èµ·æ¥ï¼Œå®ƒå’Œ <code>quote</code> å‡½æ•°å”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼Œ<code>squote</code> å‡½æ•°ä¸ä¼šå¯¹å†…å®¹è¿›è¡Œè½¬è¯‘ã€‚</p><h4 id="ç¤ºä¾‹è¯´æ˜ï¼š"><a href="#ç¤ºä¾‹è¯´æ˜ï¼š" class="headerlink" title="ç¤ºä¾‹è¯´æ˜ï¼š"></a>ç¤ºä¾‹è¯´æ˜ï¼š</h4><h5 id="1-æ¨¡ç‰ˆæ–‡ä»¶"><a href="#1-æ¨¡ç‰ˆæ–‡ä»¶" class="headerlink" title="1. æ¨¡ç‰ˆæ–‡ä»¶"></a>1. æ¨¡ç‰ˆæ–‡ä»¶</h5><p>è·¯å¾„: <code>mychart/templates/configmap.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">aaa:</span> &#123;&#123; <span class="hljs-string">.Values.aaa</span> &#125;&#125;<br>  <span class="hljs-attr">bbb:</span> &#123;&#123; <span class="hljs-string">quote</span> <span class="hljs-string">.Values.bbb</span> &#125;&#125;<br>  <span class="hljs-attr">ccc:</span> &#123;&#123; <span class="hljs-string">squote</span> <span class="hljs-string">.Values.ccc</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="2-values-æ–‡ä»¶"><a href="#2-values-æ–‡ä»¶" class="headerlink" title="2. values æ–‡ä»¶"></a>2. values æ–‡ä»¶</h5><p>è·¯å¾„: <code>mychart/values.yaml </code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">aaa:</span> <span class="hljs-string">bbb</span><br><span class="hljs-attr">bbb:</span> <span class="hljs-string">ccc</span><br><span class="hljs-attr">ccc:</span> <span class="hljs-string">ddd</span><br></code></pre></td></tr></table></figure><h5 id="3-æ¸²æŸ“æ¨¡ç‰ˆ-2"><a href="#3-æ¸²æŸ“æ¨¡ç‰ˆ-2" class="headerlink" title="3. æ¸²æŸ“æ¨¡ç‰ˆ"></a>3. æ¸²æŸ“æ¨¡ç‰ˆ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run test_chart ./mychart<br></code></pre></td></tr></table></figure><p><strong>æ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š</strong></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707180036706.png" alt="image-20210707180036706"></p><h3 id="2ã€upper-å‡½æ•°-å’Œ-title-å‡½æ•°"><a href="#2ã€upper-å‡½æ•°-å’Œ-title-å‡½æ•°" class="headerlink" title="2ã€upper å‡½æ•° å’Œ title å‡½æ•°"></a>2ã€upper å‡½æ•° å’Œ title å‡½æ•°</h3><p><code>upper</code> å‡½æ•°ä¹Ÿæ˜¯ <code>Sprig</code> æ¨¡ç‰ˆåº“æä¾›çš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†æ‰€æœ‰å°å†™å­—æ¯è½¬æˆå¤§å†™ï¼›<code>title</code> å‡½æ•°ä¸å…¶ç±»ä¼¼ï¼Œä½†æ˜¯åªå°†é¦–å­—æ¯è½¬å¤§å†™ã€‚</p><h4 id="ç¤ºä¾‹è¯´æ˜ï¼š-1"><a href="#ç¤ºä¾‹è¯´æ˜ï¼š-1" class="headerlink" title="ç¤ºä¾‹è¯´æ˜ï¼š"></a>ç¤ºä¾‹è¯´æ˜ï¼š</h4><h5 id="1-æ¨¡ç‰ˆæ–‡ä»¶-1"><a href="#1-æ¨¡ç‰ˆæ–‡ä»¶-1" class="headerlink" title="1. æ¨¡ç‰ˆæ–‡ä»¶"></a>1. æ¨¡ç‰ˆæ–‡ä»¶</h5><p>è·¯å¾„: <code>mychart/templates/configmap.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">aaa:</span> &#123;&#123; <span class="hljs-string">.Values.aaa</span> &#125;&#125;<br>  <span class="hljs-attr">bbb:</span> &#123;&#123; <span class="hljs-string">upper</span> <span class="hljs-string">.Values.bbb</span> &#125;&#125;<br>  <span class="hljs-attr">ccc:</span> &#123;&#123; <span class="hljs-string">title</span> <span class="hljs-string">.Values.ccc</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="2-values-æ–‡ä»¶-1"><a href="#2-values-æ–‡ä»¶-1" class="headerlink" title="2. values æ–‡ä»¶"></a>2. values æ–‡ä»¶</h5><p>è·¯å¾„: <code>mychart/values.yaml </code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">aaa:</span> <span class="hljs-string">bbb</span><br><span class="hljs-attr">bbb:</span> <span class="hljs-string">ccc</span><br><span class="hljs-attr">ccc:</span> <span class="hljs-string">ddd</span><br></code></pre></td></tr></table></figure><h5 id="3-æ¸²æŸ“æ¨¡ç‰ˆ-3"><a href="#3-æ¸²æŸ“æ¨¡ç‰ˆ-3" class="headerlink" title="3. æ¸²æŸ“æ¨¡ç‰ˆ"></a>3. æ¸²æŸ“æ¨¡ç‰ˆ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run test_chart ./mychart<br></code></pre></td></tr></table></figure><p><strong>æ¸²æŸ“æ•ˆæœå¦‚ä¸‹:</strong></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707181049656.png" alt="image-20210707181049656"></p><h3 id="3ã€default-å‡½æ•°"><a href="#3ã€default-å‡½æ•°" class="headerlink" title="3ã€default å‡½æ•°"></a>3ã€default å‡½æ•°</h3><p>å®é™…ä¸Šï¼Œåœ¨æ¨¡ç‰ˆå‡½æ•°ä¸­æœ€è¢«å¸¸ç”¨çš„å‡½æ•°å°±æ˜¯ <code>default</code> å‡½æ•°ï¼Œå®ƒå…è®¸æ¨¡ç‰ˆçš„ç¼–å†™è€…åœ¨æ¨¡ç‰ˆä¸­æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ï¼Œä»¥é˜²æ²¡æœ‰åœ¨ Values ä¸­é¢„è®¾è€Œå¯¼è‡´å‚æ•°è¢«å¿½ç•¥ã€‚</p><h4 id="ç¤ºä¾‹è¯´æ˜ï¼š-2"><a href="#ç¤ºä¾‹è¯´æ˜ï¼š-2" class="headerlink" title="ç¤ºä¾‹è¯´æ˜ï¼š"></a>ç¤ºä¾‹è¯´æ˜ï¼š</h4><h5 id="1-æ¨¡ç‰ˆæ–‡ä»¶-2"><a href="#1-æ¨¡ç‰ˆæ–‡ä»¶-2" class="headerlink" title="1. æ¨¡ç‰ˆæ–‡ä»¶"></a>1. æ¨¡ç‰ˆæ–‡ä»¶</h5><p>è·¯å¾„: <code>mychart/templates/configmap.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">service:</span> &#123;&#123; <span class="hljs-string">quote</span> <span class="hljs-string">.Values.service.name</span> &#125;&#125;<br>  <span class="hljs-attr">protocol:</span> &#123;&#123; <span class="hljs-string">.Values.service.protocol</span> <span class="hljs-string">|</span> <span class="hljs-string">default</span> <span class="hljs-string">&quot;http&quot;</span> <span class="hljs-string">|</span> <span class="hljs-string">quote</span> &#125;&#125;<br>  <span class="hljs-attr">port:</span> &#123;&#123; <span class="hljs-string">.Values.service.port</span> <span class="hljs-string">|</span> <span class="hljs-string">default</span> <span class="hljs-number">80</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h5 id="2-values-æ–‡ä»¶-2"><a href="#2-values-æ–‡ä»¶-2" class="headerlink" title="2. values æ–‡ä»¶"></a>2. values æ–‡ä»¶</h5><p>è·¯å¾„: <code>mychart/values.yaml </code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">service:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">protocol:</span> <span class="hljs-string">https</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">443</span><br></code></pre></td></tr></table></figure><h5 id="3-æ¸²æŸ“æ¨¡ç‰ˆ-4"><a href="#3-æ¸²æŸ“æ¨¡ç‰ˆ-4" class="headerlink" title="3. æ¸²æŸ“æ¨¡ç‰ˆ"></a>3. æ¸²æŸ“æ¨¡ç‰ˆ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run test_chart ./mychart<br></code></pre></td></tr></table></figure><p><strong>æ¸²æŸ“æ•ˆæœå¦‚ä¸‹:</strong></p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707182537495.png" alt="image-20210707182537495"></p><h5 id="4-ä¿®æ”¹-values-æ–‡ä»¶"><a href="#4-ä¿®æ”¹-values-æ–‡ä»¶" class="headerlink" title="4. ä¿®æ”¹ values æ–‡ä»¶"></a>4. ä¿®æ”¹ values æ–‡ä»¶</h5><p>è·¯å¾„: <code>mychart/values.yaml </code>ï¼Œå»æ‰éƒ¨åˆ†å†…å®¹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">service:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br></code></pre></td></tr></table></figure><p>å†æ¬¡æ¸²æŸ“ï¼Œæ¸²æŸ“æ•ˆæœå¦‚ä¸‹:</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210707182811994.png" alt="image-20210707182811994"></p><p>å¯ä»¥å‘ç°ï¼Œåœ¨ Values ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åšé¢„è®¾ï¼Œè€Œæ¸²æŸ“ç»“æœå–äº†é»˜è®¤å€¼ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•å¯ä»¥æ¯”è¾ƒæœ‰æ•ˆçš„å‡å°‘ç”±äºç¼ºå°‘å‚æ•°å¯¼è‡´çš„å‘å¸ƒå¤±è´¥ã€‚</p><h3 id="4ã€ç®¡é“"><a href="#4ã€ç®¡é“" class="headerlink" title="4ã€ç®¡é“"></a>4ã€ç®¡é“</h3><p>æœ‰æ²¡æœ‰å‘ç°ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢çš„æ¨¡ç‰ˆæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªç±»ä¼¼ UNIX shell çš„åŠŸèƒ½ â€”â€” <code>|</code>ï¼Ÿæ˜¯çš„ï¼Œå®ƒçš„åŠŸèƒ½å°±ç±»ä¼¼ UNIX çš„ <code>ç®¡é“</code>ã€‚è¿˜è®°å¾— <code>ç®¡é“</code>  çš„ä½œç”¨å—ï¼Ÿ<code>å°†ç®¡é“å‰æ‰§è¡Œçš„ç»“æœäº¤ç”±ç®¡é“åçš„å‘½ä»¤æ‰§è¡Œ</code>ï¼Œè¿™é‡Œçš„æ•ˆæœä¹Ÿç±»ä¼¼ã€‚ä¸‹é¢æˆ‘ä»¬å†ç”¨ç¤ºä¾‹è¯´æ˜ä¸‹ã€‚</p><h4 id="ç¤ºä¾‹è¯´æ˜ï¼š-3"><a href="#ç¤ºä¾‹è¯´æ˜ï¼š-3" class="headerlink" title="ç¤ºä¾‹è¯´æ˜ï¼š"></a>ç¤ºä¾‹è¯´æ˜ï¼š</h4><h5 id="1-æ¨¡ç‰ˆæ–‡ä»¶-3"><a href="#1-æ¨¡ç‰ˆæ–‡ä»¶-3" class="headerlink" title="1. æ¨¡ç‰ˆæ–‡ä»¶"></a>1. æ¨¡ç‰ˆæ–‡ä»¶</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Release.Name</span> &#125;&#125;<span class="hljs-string">-configmap</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">service:</span> &#123;&#123; <span class="hljs-string">.Values.service.name</span> <span class="hljs-string">|</span> <span class="hljs-string">title</span> <span class="hljs-string">|</span> <span class="hljs-string">quote</span> &#125;&#125;<br>  <span class="hljs-attr">protocol:</span> &#123;&#123; <span class="hljs-string">.Values.service.protocol</span> <span class="hljs-string">|</span> <span class="hljs-string">default</span> <span class="hljs-string">&quot;http&quot;</span> <span class="hljs-string">|</span> <span class="hljs-string">upper</span>  &#125;&#125;<br>  <span class="hljs-attr">port:</span> &#123;&#123; <span class="hljs-string">.Values.service.port</span> <span class="hljs-string">|</span> <span class="hljs-string">default</span> <span class="hljs-number">80</span> &#125;&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å¦‚ä¸Šï¼Œæˆ‘ä»¬æ‰§è¡Œäº†å‡ ä¸ªç®¡é“æ“ä½œï¼Œå…¶æ‰§è¡Œçš„å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><p><code>&#123;&#123; .Values.service.name | title | quote &#125;&#125;</code></p><p>å°†æœç´¢ <code>.Values.service.name</code> çš„ç»“æœé¦–å­—æ¯è½¬å¤§å†™ï¼Œå¹¶ç”¨åŒå¼•å·å¼•èµ·æ¥</p></li><li><p><code>&#123;&#123; .Values.service.protocol | default "http" | upper  &#125;&#125;</code></p><p>å°†æœç´¢ <code>.Values.service.protocol</code> çš„ç»“æœï¼ˆå¦‚æœæ²¡æœ‰åˆ™é»˜è®¤å€¼ä¸º httpï¼‰æ‰€æœ‰å­—æ¯è½¬å¤§å†™</p></li></ul></blockquote><h5 id="2-values-æ–‡ä»¶-3"><a href="#2-values-æ–‡ä»¶-3" class="headerlink" title="2. values æ–‡ä»¶"></a>2. values æ–‡ä»¶</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">service:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">protocol:</span> <span class="hljs-string">tcp</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><h5 id="3-æ¸²æŸ“æ¨¡ç‰ˆ-5"><a href="#3-æ¸²æŸ“æ¨¡ç‰ˆ-5" class="headerlink" title="3. æ¸²æŸ“æ¨¡ç‰ˆ"></a>3. æ¸²æŸ“æ¨¡ç‰ˆ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run mychart ./mychart/<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210708150257165.png" alt="image-20210708150257165"></p><blockquote><p>ğŸš© <strong>åœ¨é»˜è®¤çš„è¯­æ³•è§„åˆ™ä¸­ï¼Œè™½ç„¶ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬è¾ƒå¸¸ä½¿ç”¨çš„æ–¹æ³•ä¸º <code>.val | quote </code> è€Œéä½¿ç”¨ <code>quote .val</code></strong></p></blockquote><h3 id="5ã€include-å‡½æ•°-å’Œ-template-å‡½æ•°"><a href="#5ã€include-å‡½æ•°-å’Œ-template-å‡½æ•°" class="headerlink" title="5ã€include å‡½æ•° å’Œ template å‡½æ•°"></a>5ã€include å‡½æ•° å’Œ template å‡½æ•°</h3><h3 id="6ã€indent-å‡½æ•°-å’Œ-nindent-å‡½æ•°-å’Œ-plural-å‡½æ•°"><a href="#6ã€indent-å‡½æ•°-å’Œ-nindent-å‡½æ•°-å’Œ-plural-å‡½æ•°" class="headerlink" title="6ã€indent å‡½æ•° å’Œ nindent å‡½æ•° å’Œ plural å‡½æ•°"></a>6ã€indent å‡½æ•° å’Œ nindent å‡½æ•° å’Œ plural å‡½æ•°</h3><h3 id="7ã€lookup-å‡½æ•°"><a href="#7ã€lookup-å‡½æ•°" class="headerlink" title="7ã€lookup å‡½æ•°"></a>7ã€lookup å‡½æ•°</h3><hr><h2 id="å››ã€æµç¨‹æ§åˆ¶"><a href="#å››ã€æµç¨‹æ§åˆ¶" class="headerlink" title="å››ã€æµç¨‹æ§åˆ¶"></a>å››ã€æµç¨‹æ§åˆ¶</h2>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬3ç« ã€åˆè¯† Chart</title>
    <link href="/2021/07/24/%E7%AC%AC3%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Chart%20/"/>
    <url>/2021/07/24/%E7%AC%AC3%E7%AB%A0%E3%80%81%E5%88%9D%E8%AF%86-Chart%20/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬3ç« ã€åˆè¯†-Chart"><a href="#ç¬¬3ç« ã€åˆè¯†-Chart" class="headerlink" title="ç¬¬3ç« ã€åˆè¯† Chart"></a>ç¬¬3ç« ã€åˆè¯† Chart</h1><span id="more"></span><h2 id="ä¸€ã€Chart-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€Chart-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€Chart æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€Chart æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« èŠ‚æ—¶ä»‹ç» Helm çš„ä¸‰å¤§æ¦‚å¿µæ—¶æ˜¯å¦‚ä½•ä»‹ç» <code>chart</code> è¿™ä¸ªæ¦‚å¿µçš„å—ï¼Ÿæ˜¯çš„ï¼Œ<code>chart</code> å°±åƒè®¸å¤šè¯­è¨€å°è£…çš„æºç åŒ…ä¸€æ ·ï¼Œå®ƒæ˜¯ Helm ä½¿ç”¨çš„å°è£…åŒ…çš„æ€»ç§°ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼ŒKubernetes å°†å…¶ç®¡ç†çš„å¯¹è±¡ç§°ä¸ºèµ„æºï¼Œä¾‹å¦‚ deploymentã€serviceã€ingress ç­‰ã€‚è€Œ Helm ä½œä¸º K8s çš„åŒ…ç®¡ç†å™¨ï¼Œå…¶æœ€å¤§çš„ä½œç”¨å°±æ˜¯é€šè¿‡ chart çš„æ–¹å¼æ•´åˆéœ€è¦ç®¡ç†çš„ K8s ä¸­çš„èµ„æºï¼Œå†é€šè¿‡ Helm å®¢æˆ·ç«¯ <strong>ç»Ÿä¸€äº¤ç”±</strong> K8s api server å»æ‰§è¡Œã€‚</p><hr><h2 id="äºŒã€Chart-åŸºç¡€ä½¿ç”¨"><a href="#äºŒã€Chart-åŸºç¡€ä½¿ç”¨" class="headerlink" title="äºŒã€Chart åŸºç¡€ä½¿ç”¨"></a>äºŒã€Chart åŸºç¡€ä½¿ç”¨</h2><h3 id="1ã€æŸ¥æ‰¾-Chart"><a href="#1ã€æŸ¥æ‰¾-Chart" class="headerlink" title="1ã€æŸ¥æ‰¾ Chart"></a>1ã€æŸ¥æ‰¾ Chart</h3><blockquote><p>Helm æä¾›äº†2ç§æœç´¢å‘½ä»¤ï¼Œå¯ç”¨ç”¨æ¥ä»ä¸¤ç§æ¥æºä¸­è¿›è¡Œæœç´¢ï¼š</p><ul><li><code>helm search hub</code>ï¼šä» <a href="https://artifacthub.io/">Artifact Hub</a> ä¸­æŸ¥æ‰¾å¹¶åˆ—å‡º helm chartsã€‚ Artifact Hubä¸­å­˜æ”¾äº†å¤§é‡ä¸åŒçš„ä»“åº“ã€‚</li><li><code>helm search repo</code>ï¼šä»ä½ æ·»åŠ ï¼ˆä½¿ç”¨ <code>helm repo add</code>ï¼‰åˆ°æœ¬åœ° helm å®¢æˆ·ç«¯ä¸­çš„ä»“åº“ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚è¯¥å‘½ä»¤åŸºäºæœ¬åœ°æ•°æ®è¿›è¡Œæœç´¢ï¼Œæ— éœ€è¿æ¥äº’è”ç½‘ã€‚</li></ul></blockquote><h4 id="1ï¼‰æœç´¢æ‰€æœ‰å…¬å¼€å¯ç”¨çš„-charts"><a href="#1ï¼‰æœç´¢æ‰€æœ‰å…¬å¼€å¯ç”¨çš„-charts" class="headerlink" title="1ï¼‰æœç´¢æ‰€æœ‰å…¬å¼€å¯ç”¨çš„ charts"></a>1ï¼‰æœç´¢æ‰€æœ‰å…¬å¼€å¯ç”¨çš„ <code>charts</code></h4><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä» <code>Artifact Hub</code> ä¸­æœç´¢æ‰€æœ‰çš„ <code>wordpress</code> chartsï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm search hub &lt;chart_name&gt;</span> <br>helm search hub wordpress<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210629102731888.png" alt="image-20210629102731888"></p><h4 id="2ï¼‰æœç´¢æœ¬åœ°-stable-æºä¸­å¯ç”¨çš„-charts"><a href="#2ï¼‰æœç´¢æœ¬åœ°-stable-æºä¸­å¯ç”¨çš„-charts" class="headerlink" title="2ï¼‰æœç´¢æœ¬åœ° stable æºä¸­å¯ç”¨çš„ charts"></a>2ï¼‰æœç´¢æœ¬åœ° <code>stable</code> æºä¸­å¯ç”¨çš„ <code>charts</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm search repo &lt;repo_name&gt;</span><br>helm search repo stable<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210628152107519.png" alt="image-20210628152107519"></p><h4 id="3ï¼‰æ¨¡ç³ŠåŒ¹é…æœç´¢"><a href="#3ï¼‰æ¨¡ç³ŠåŒ¹é…æœç´¢" class="headerlink" title="3ï¼‰æ¨¡ç³ŠåŒ¹é…æœç´¢"></a>3ï¼‰æ¨¡ç³ŠåŒ¹é…æœç´¢</h4><p>Helm çš„æœç´ ä½¿ç”¨æ¨¡ç³Šå­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œåªéœ€è¦è¾“å…¥åå­—çš„ä¸€éƒ¨åˆ†å°±å¯ä»¥ä»æœ¬åœ°ä»“åº“è®°å½•ä¸­è¿›è¡Œæœç´¢ï¼Œå¦‚ä¸‹æœç´¢ <code>word</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm search repo &lt;string&gt;</span><br>helm search repo word<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210629103454469.png" alt="image-20210629103454469"></p><h3 id="2ã€å®‰è£…-Chart"><a href="#2ã€å®‰è£…-Chart" class="headerlink" title="2ã€å®‰è£… Chart"></a>2ã€å®‰è£… Chart</h3><blockquote><p>ä½¿ç”¨ <code>helm search</code> æ‰¾åˆ°ä½ æƒ³è¦å®‰è£…çš„ helmåŒ…åï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>helm install</code> æ¥è¿›è¡Œå®‰è£…ã€‚æœ€ç®€å•ä½¿ç”¨æ–¹æ¡ˆåªéœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š<code>releaseçš„åå­—</code> å’Œ <code>chartçš„åç§°</code>ã€‚</p></blockquote><h4 id="1ï¼‰å®‰è£…helmåŒ…"><a href="#1ï¼‰å®‰è£…helmåŒ…" class="headerlink" title="1ï¼‰å®‰è£…helmåŒ…"></a>1ï¼‰å®‰è£…helmåŒ…</h4><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå³åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <code>release</code> å¯¹è±¡ï¼Œå‘½åä¸º <code>happy-panda</code> ï¼Œå¦‚æœæƒ³è¦è‡ªåŠ¨ç”Ÿæˆä¸€ååç§°ï¼Œå¯ä»¥ä½¿ç”¨<code>--generate-name</code> å‚æ•°:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm install &lt;release_name&gt; &lt;chart_name&gt; ï¼ˆchartåç§°é¡»å…·ä½“ï¼Œå¦‚ bitnami/wordpressã€‚ä¸èƒ½åªæ˜¯å…³é”®å­—ï¼‰</span><br>helm install happy-panda bitnami/wordpress<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210629104631960.png" alt="image-20210629104631960"></p><h4 id="2ï¼‰æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"><a href="#2ï¼‰æŸ¥çœ‹è¿è¡ŒçŠ¶æ€" class="headerlink" title="2ï¼‰æŸ¥çœ‹è¿è¡ŒçŠ¶æ€"></a>2ï¼‰æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm list<br></code></pre></td></tr></table></figure><p>è¿”å›å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">NAME     NAMESPACEREVISIONUPDATED                                STATUS  CHART            APP VERSION<br>happy-pandadefault  1       2021-06-29 10:51:13.437131205 +0800 CSTdeployedwordpress-11.0.165.7.2  <br></code></pre></td></tr></table></figure><h4 id="3ï¼‰æŸ¥çœ‹å‘å¸ƒçŠ¶æ€"><a href="#3ï¼‰æŸ¥çœ‹å‘å¸ƒçŠ¶æ€" class="headerlink" title="3ï¼‰æŸ¥çœ‹å‘å¸ƒçŠ¶æ€"></a>3ï¼‰æŸ¥çœ‹å‘å¸ƒçŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm status &lt;release_name&gt;</span><br>helm status happy-panda<br></code></pre></td></tr></table></figure><p>è¿”å›å€¼å’Œå®‰è£…æ—¶çš„è¿”å›ä¸€æ ·ã€‚</p><h4 id="4ï¼‰å¸è½½helmåŒ…"><a href="#4ï¼‰å¸è½½helmåŒ…" class="headerlink" title="4ï¼‰å¸è½½helmåŒ…"></a>4ï¼‰å¸è½½helmåŒ…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm uninstall &lt;release_name&gt;</span><br>helm uninstall happy-panda<br></code></pre></td></tr></table></figure><h3 id="3ã€ä¸‹è½½-Chart"><a href="#3ã€ä¸‹è½½-Chart" class="headerlink" title="3ã€ä¸‹è½½ Chart"></a>3ã€ä¸‹è½½ Chart</h3><blockquote><p>Helm çš„ chart åŒæ—¶ä¹Ÿæ”¯æŒä¸‹è½½ï¼Œä¸‹è½½ä¸‹æ¥çš„æ˜¯ä¸€ä¸ªtaråŒ…ï¼Œè§£å‹åå³å¯è·å¾—å®˜æ–¹çš„ chart ç›®å½•ï¼ŒåŸºäºç›®å½•ä¸­æä¾›çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶ä¸­çš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œè¿›è¡Œè‡ªå®šä¹‰çš„å‘å¸ƒï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å­¦ä¹ å…¶è¯­æ³•ã€‚</p></blockquote><h4 id="1ï¼‰ä¸‹è½½"><a href="#1ï¼‰ä¸‹è½½" class="headerlink" title="1ï¼‰ä¸‹è½½"></a>1ï¼‰ä¸‹è½½</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm pull &lt;chart_name&gt; ï¼ˆchartåç§°é¡»å…·ä½“ï¼Œå¦‚ bitnami/kongã€‚ä¸èƒ½åªæ˜¯å…³é”®å­—ï¼‰</span><br>helm pull bitnami/kong<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701103804465.png" alt="image-20210701103804465"></p><h4 id="2ï¼‰è§£å‹"><a href="#2ï¼‰è§£å‹" class="headerlink" title="2ï¼‰è§£å‹"></a>2ï¼‰è§£å‹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xf kong-3.7.5.tgz <br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701103958115.png" alt="image-20210701103958115"></p><h4 id="3ï¼‰ç›®å½•ç»“æ„"><a href="#3ï¼‰ç›®å½•ç»“æ„" class="headerlink" title="3ï¼‰ç›®å½•ç»“æ„"></a>3ï¼‰ç›®å½•ç»“æ„</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell">kong<br>â”œâ”€â”€ Chart.lock<br>â”œâ”€â”€ charts# kong çš„ chart ä¾èµ–çš„å…¶ä»– chartï¼Œæ•°æ®åº“<br>â”‚Â Â  â”œâ”€â”€ cassandra<br>â”‚Â Â  â”œâ”€â”€ common<br>â”‚Â Â  â””â”€â”€ postgresql<br>â”œâ”€â”€ Chart.yaml# åŒ…å«äº†chartä¿¡æ¯çš„YAMLæ–‡ä»¶<br>â”œâ”€â”€ ci<br>â”‚Â Â  â”œâ”€â”€ values-editing-containers.yaml<br>â”‚Â Â  â”œâ”€â”€ values-external-cassandra.yaml<br>â”‚Â Â  â”œâ”€â”€ values-external-postgresql.yaml<br>â”‚Â Â  â”œâ”€â”€ values-ingress.yaml<br>â”‚Â Â  â””â”€â”€ values-metrics-hpa-pdb.yaml<br>â”œâ”€â”€ crds# è‡ªå®šä¹‰èµ„æº<br>â”‚Â Â  â””â”€â”€ custom-resource-definitions.yaml<br>â”œâ”€â”€ README.md<br>â”œâ”€â”€ templates# èµ„æºæ¨¡ç‰ˆï¼Œé…ç½® values è¿›è¡Œæ¸²æŸ“ï¼Œç”Ÿäº§æœ‰æ•ˆçš„ K8s manifest<br>â”‚Â Â  â”œâ”€â”€ dep-ds.yaml<br>â”‚Â Â  â”œâ”€â”€ external-database-secret.yaml<br>â”‚Â Â  â”œâ”€â”€ extra-list.yaml<br>â”‚Â Â  â”œâ”€â”€ _helpers.tpl<br>â”‚Â Â  â”œâ”€â”€ hpa.yaml<br>â”‚Â Â  â”œâ”€â”€ ingress-controller-rbac.yaml<br>â”‚Â Â  â”œâ”€â”€ ingress.yaml<br>â”‚Â Â  â”œâ”€â”€ kong-prometheus-rolebinding.yaml<br>â”‚Â Â  â”œâ”€â”€ kong-prometheus-role.yaml<br>â”‚Â Â  â”œâ”€â”€ kong-script-configmap.yaml<br>â”‚Â Â  â”œâ”€â”€ metrics-exporter-configmap.yaml<br>â”‚Â Â  â”œâ”€â”€ metrics-script-configmap.yaml<br>â”‚Â Â  â”œâ”€â”€ metrics-service.yaml<br>â”‚Â Â  â”œâ”€â”€ migrate-job.yaml<br>â”‚Â Â  â”œâ”€â”€ NOTES.txt<br>â”‚Â Â  â”œâ”€â”€ pdb.yaml<br>â”‚Â Â  â”œâ”€â”€ servicemonitor.yaml<br>â”‚Â Â  â”œâ”€â”€ service.yaml<br>â”‚Â Â  â””â”€â”€ tls-secrets.yaml<br>â””â”€â”€ values.yaml# chart é»˜è®¤çš„é…ç½®å€¼<br><br></code></pre></td></tr></table></figure><h3 id="4ã€è‡ªå»º-Chart"><a href="#4ã€è‡ªå»º-Chart" class="headerlink" title="4ã€è‡ªå»º Chart"></a>4ã€è‡ªå»º Chart</h3><blockquote><p>é™¤äº†ä»è¿œç¨‹ helm ä»“åº“ä¸­è·å–å®˜æ–¹æˆ–ä¸‰æ–¹çš„ chart å¤–ï¼ŒHelm æ›´åŠ é‡è¦çš„åŠŸèƒ½åœ¨äºè‡ªå»º chartï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª chart éœ€è¦çš„æœ€å°åŒ–ç›®å½•ç»“æ„ä»¥åŠå„å¿…è¦æ–‡ä»¶çš„æ¨¡ç‰ˆã€‚chart çš„æ•´ä½“æ„é€ æ¯”è¾ƒç±»ä¼¼ ansible çš„ rolesã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm create &lt;chart_name&gt;</span><br>helm create test_chart<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701180328092.png" alt="image-20210701180328092"></p><h3 id="5ã€æ£€æŸ¥-Chart"><a href="#5ã€æ£€æŸ¥-Chart" class="headerlink" title="5ã€æ£€æŸ¥ Chart"></a>5ã€æ£€æŸ¥ Chart</h3><blockquote><p>Helm è‡ªåŠ¨äº†è¯­æ³•æ£€æŸ¥å·¥å…·ï¼Œå…¶ä½œç”¨ç±»ä¼¼ <code>nginx -t</code>ï¼Œä¼šå¯¹ chart çš„æ ¼å¼æˆ–è€…ä¸€äº›ä¿¡æ¯è¿›è¡Œè‡ªæ£€ï¼Œå¹¶è¿”å›æ£€æŸ¥ç»“æœï¼Œåœ¨å‘å¸ƒå‰ï¼Œè¿›è¡Œè¯­æ³•æ£€æŸ¥æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm lint &lt;chart_name&gt;</span><br>helm lint test_chart<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210705142216832.png" alt="image-20210705142216832"></p><h3 id="6ã€ä¸Šä¼ -Chart"><a href="#6ã€ä¸Šä¼ -Chart" class="headerlink" title="6ã€ä¸Šä¼  Chart"></a>6ã€ä¸Šä¼  Chart</h3><h4 id="1ï¼‰æ‰“åŒ…-Chart"><a href="#1ï¼‰æ‰“åŒ…-Chart" class="headerlink" title="1ï¼‰æ‰“åŒ… Chart"></a>1ï¼‰æ‰“åŒ… Chart</h4><blockquote><p>åœ¨ä¸Šé¢çš„ä¸€ç³»åˆ—æ“ä½œä¸­æˆ‘ä»¬çŸ¥é“ï¼ŒHelm ä»“åº“ä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ªä¸ªçš„ tar åŒ…ï¼Œè€Œä¸æ˜¯ç›®å½•ï¼Œå› æ­¤å¦‚æœä½ æƒ³ä¸Šä¼ è‡ªå»ºçš„ chartï¼Œå°±éœ€è¦å°†å…¶å…ˆè¡Œæ‰“åŒ…ã€‚Helm æä¾›äº†è¿™æ ·ä¸€ä¸ªå‘½åæ¥å°†ä½ è‡ªå»ºçš„ chart æ‰“åŒ…å‡º Helm å¯è¯†åˆ«çš„æ ¼å¼ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å‘½ä»¤: helm package &lt;chart_name&gt;</span><br>helm package test_chart<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701111357599.png" alt="image-20210701111357599"></p><blockquote><p>ğŸš© <strong>ä¸ºä»€ä¹ˆç‰ˆæœ¬æ˜¯ 0.1.0ï¼Ÿ</strong></p><p>è¿™æ˜¯ç”± Chart.yaml ä¸­çš„ <code>version</code> å­—æ®µå†³å®šçš„ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210701111524833.png" alt="image-20210701111524833"></p></blockquote><h4 id="2ï¼‰ä¸Šä¼ è‡³ç§æœ‰ä»“åº“"><a href="#2ï¼‰ä¸Šä¼ è‡³ç§æœ‰ä»“åº“" class="headerlink" title="2ï¼‰ä¸Šä¼ è‡³ç§æœ‰ä»“åº“"></a>2ï¼‰ä¸Šä¼ è‡³ç§æœ‰ä»“åº“</h4><blockquote><p><strong>å››ä¸ªæ­¥éª¤ï¼š</strong></p><p>1ï¼‰è‡ªå»ºç§æœ‰ä»“åº“</p><p>2ï¼‰ç”Ÿæˆã€æ›´æ–° chart ç´¢å¼•æ–‡ä»¶</p><p>3ï¼‰ä¸Šä¼  chart å’Œç´¢å¼•æ–‡ä»¶</p><p>4ï¼‰æ›´æ–°æœ¬åœ° chart ä»“åº“</p></blockquote><h4 id="3ï¼‰ä¸Šä¼ è‡³-Helm-Hub"><a href="#3ï¼‰ä¸Šä¼ è‡³-Helm-Hub" class="headerlink" title="3ï¼‰ä¸Šä¼ è‡³ Helm Hub"></a>3ï¼‰ä¸Šä¼ è‡³ Helm Hub</h4><blockquote><p>ğŸš© <strong>å‚è€ƒæ–‡æ¡£:</strong></p><p><a href="https://blog.csdn.net/jeffzhesi/article/details/106565173">https://blog.csdn.net/jeffzhesi/article/details/106565173</a></p></blockquote><hr><h2 id="ä¸‰ã€Chart-è¯­æ³•é‡Šä¹‰"><a href="#ä¸‰ã€Chart-è¯­æ³•é‡Šä¹‰" class="headerlink" title="ä¸‰ã€Chart è¯­æ³•é‡Šä¹‰"></a>ä¸‰ã€Chart è¯­æ³•é‡Šä¹‰</h2><h3 id="1ã€chart-åŸºæœ¬å…ƒç´ é‡Šä¹‰ï¼š"><a href="#1ã€chart-åŸºæœ¬å…ƒç´ é‡Šä¹‰ï¼š" class="headerlink" title="1ã€chart åŸºæœ¬å…ƒç´ é‡Šä¹‰ï¼š"></a>1ã€chart åŸºæœ¬å…ƒç´ é‡Šä¹‰ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">test_chart<br>â”œâ”€â”€ charts# å¯é€‰: æœ¬ chart ä¾èµ–çš„å…¶ä»– chart<br>â”œâ”€â”€ Chart.yaml# å¿…éœ€: ç”¨äºæè¿° chart ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ã€æè¿°ä¿¡æ¯ã€apiç‰ˆæœ¬ç­‰<br>â”œâ”€â”€ templates# å¿…éœ€: åšç”¨äº K8s èµ„æºçš„ yaml æ¨¡ç‰ˆ<br>â”‚Â Â  â”œâ”€â”€ deployment.yaml# ç”¨äºç”Ÿæˆ K8s deployment èµ„æºçš„ yaml æ¨¡ç‰ˆï¼Œå‘å¸ƒåº”ç”¨çš„åŸºæœ¬å…ƒç´ <br>â”‚Â Â  â”œâ”€â”€ _helpers.tpl# ç”¨äºå®šä¹‰ä¸€äº›å¯é‡ç”¨çš„æ¨¡æ¿ç‰‡æ–­ï¼Œåœ¨æ­¤æ–‡ä»¶ä¸­çš„å®šä¹‰åœ¨ä»»ä½•èµ„æºå®šä¹‰æ¨¡æ¿ä¸­éƒ½å¯ç”¨<br>â”‚Â Â  â”œâ”€â”€ hpa.yaml# ç”¨äºç”Ÿæˆ K8s hpa çš„ yaml æ¨¡ç‰ˆï¼Œå¦‚æœåŠ¡éœ€è¦å¼¹æ€§ä¼¸ç¼©ç­–ç•¥ï¼Œåˆ™åœ¨è¯¥æ¨¡ç‰ˆä¸­å®šä¹‰<br>â”‚Â Â  â”œâ”€â”€ ingress.yaml# ç”¨äºç”Ÿæˆ K8s ingress çš„ yaml æ¨¡ç‰ˆï¼Œå¦‚æœæœåŠ¡éœ€è¦å¯¹å¤–æ”¾å‡ºï¼Œåˆ™åœ¨è¯¥æ¨¡ç‰ˆä¸­å®šä¹‰ ingress<br>â”‚Â Â  â”œâ”€â”€ NOTES.txt# å¿…éœ€: ç”¨äºä»‹ç» chart éƒ¨ç½²åçš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å¦‚ä½•ä½¿ç”¨è¿™ä¸ª chartã€åˆ—å‡ºç¼ºçœè®¾ç½®ç­‰<br>â”‚Â Â  â”œâ”€â”€ serviceaccount.yaml# ç”¨äºç”Ÿæˆ K8s serviceaccount èµ„æºçš„ yaml æ¨¡ç‰ˆï¼Œå¦‚éœ€è¦åˆ›å»ºç‰¹å®šè®¤è¯å¯¹è±¡ï¼Œåˆ™åœ¨è¯¥æ¨¡ç‰ˆä¸­å®šä¹‰<br>â”‚Â Â  â”œâ”€â”€ service.yaml# ç”¨äºç”Ÿæˆ K8s service èµ„æºçš„ yaml æ¨¡ç‰ˆï¼Œå‘å¸ƒåº”ç”¨çš„åŸºæœ¬å…ƒç´ <br>â”‚Â Â  â””â”€â”€ tests# helm çš„æµ‹è¯•é’©å­<br>â”‚Â Â      â””â”€â”€ test-connection.yaml<br>â””â”€â”€ values.yaml# å¿…éœ€: ç”¨äºå­˜å‚¨è¦æ¸²æŸ“è‡³ templates/ ä¸‹æ¨¡ç‰ˆæ–‡ä»¶ä¸­çš„å€¼<br></code></pre></td></tr></table></figure><h3 id="2ã€Chart-yaml"><a href="#2ã€Chart-yaml" class="headerlink" title="2ã€Chart.yaml"></a>2ã€Chart.yaml</h3><p>ä¸€ä¸ªæ ‡å‡†çš„ Chart.yaml åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-comment"># å¿…éœ€: chart API ç‰ˆæœ¬, v2 ç‰ˆæœ¬ä¸º helm3 è¯­æ³•ï¼Œv1 ç‰ˆæœ¬ä»ç„¶ä¿ç•™ä½¿ç”¨</span><br><span class="hljs-attr">name:</span> <span class="hljs-comment"># å¿…éœ€: chartåç§°</span><br><span class="hljs-attr">version:</span> <span class="hljs-comment"># å¿…éœ€: chart çš„ç‰ˆæœ¬æ§åˆ¶æ ‡è¯†</span><br><span class="hljs-attr">kubeVersion:</span> <span class="hljs-comment"># å¯é€‰: å…¼å®¹Kubernetesç‰ˆæœ¬çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ï¼Œå½¢å¼å¦‚ &gt;= 1.13.0 &lt; 1.15.0</span><br><span class="hljs-attr">description:</span> <span class="hljs-comment"># å¯é€‰: å¯¹äºè¿™ä¸ª chart çš„æè¿°ä¿¡æ¯</span><br><span class="hljs-attr">type:</span> <span class="hljs-comment"># å¯é€‰: chartç±»å‹, æ”¯æŒ2ç§ç±»å‹ï¼Œapplication å’Œ libraryï¼Œé»˜è®¤ä½¿ç”¨ application</span><br><span class="hljs-attr">keywords:</span><span class="hljs-comment"># å¯é€‰: å…³äºé¡¹ç›®çš„ä¸€ç»„å…³é”®å­—</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br><span class="hljs-attr">home:</span> <span class="hljs-comment"># å¯é€‰: é¡¹ç›®homeé¡µé¢çš„URL</span><br><span class="hljs-attr">sources:</span><span class="hljs-comment"># å¯é€‰: é¡¹ç›®æºç çš„URLåˆ—è¡¨</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br><span class="hljs-attr">dependencies:</span> <span class="hljs-comment"># å¯é€‰: chart çš„ä¾èµ–é¡¹ï¼Œæ‰§è¡Œ `helm dep up &lt;chart_name&gt;` æ›´æ–°ä¾èµ–ï¼Œä¾èµ–çš„ chartåŒ… ä¼šä¸‹è½½è‡³ charts/ </span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-comment"># chartåç§°, å¦‚ nginx</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-comment"># chartç‰ˆæœ¬, å¦‚ &quot;1.2.3&quot;</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-comment"># å¯é€‰: ä»“åº“çš„å®Œæ•´URL (&quot;https://example.com/charts&quot;) æˆ–åˆ«å (&quot;@repo-name&quot;)</span><br>    <span class="hljs-attr">condition:</span> <span class="hljs-comment"># å¯é€‰: è§£æä¸ºå¸ƒå°”å€¼çš„yamlè·¯å¾„ï¼Œç”¨äºå¯ç”¨/ç¦ç”¨chart (e.g. subchart1.enabled )</span><br>    <span class="hljs-attr">tags:</span> <span class="hljs-comment"># å¯é€‰: ç”¨äºä¸€æ¬¡å¯ç”¨/ç¦ç”¨ ä¸€ç»„chartçš„tag</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">xxx</span><br>    <span class="hljs-attr">import-values:</span>  <span class="hljs-comment"># å¯é€‰: ä¿å­˜æºå€¼åˆ°å¯¼å…¥çˆ¶é”®çš„æ˜ å°„ã€‚æ¯é¡¹å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…ä¸€å¯¹å­/çˆ¶åˆ—è¡¨é¡¹</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ImportValue</span>  <br>    <span class="hljs-attr">alias:</span> <span class="hljs-comment"># å¯é€‰: ä¾èµ– chart çš„åˆ«åã€‚å½“ä½ è¦å¤šæ¬¡æ·»åŠ ç›¸åŒçš„chartæ—¶ä¼šå¾ˆæœ‰ç”¨</span><br><span class="hljs-attr">maintainers:</span> <span class="hljs-comment"># å¯é€‰: ç»´æŠ¤è€…ä¿¡æ¯</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-comment"># ç»´æŠ¤è€…åå­— ï¼ˆæ¯ä¸ªç»´æŠ¤è€…éƒ½éœ€è¦ï¼‰</span><br>    <span class="hljs-attr">email:</span> <span class="hljs-comment"># ç»´æŠ¤è€…é‚®ç®± ï¼ˆæ¯ä¸ªç»´æŠ¤è€…å¯é€‰ï¼‰</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-comment"># ç»´æŠ¤è€…URL ï¼ˆæ¯ä¸ªç»´æŠ¤è€…å¯é€‰ï¼‰</span><br><span class="hljs-attr">icon:</span> <span class="hljs-comment"># å¯é€‰: ç”¨åšiconçš„SVGæˆ–PNGå›¾ç‰‡URL</span><br><span class="hljs-attr">appVersion:</span> <span class="hljs-comment"># å¯é€‰: ä¸ç‰ˆæœ¬æ§åˆ¶çš„ version æ— å…³ï¼Œç”¨äºæŒ‡å®šåº”ç”¨çš„ç‰ˆæœ¬</span><br><span class="hljs-attr">deprecated:</span> <span class="hljs-comment"># å¯é€‰: æ ‡è®°è¯¥ chart å·²åºŸå¼ƒï¼Œä½¿ç”¨æ–¹æ³•ä¸ºå¸ƒå°”å€¼</span><br><span class="hljs-attr">annotations:</span><br>  <span class="hljs-attr">example:</span> <span class="hljs-comment"># å¯é€‰: æŒ‰åç§°è¾“å…¥çš„æ‰¹æ³¨åˆ—è¡¨</span><br></code></pre></td></tr></table></figure><h4 id="1ï¼‰ä½¿ç”¨-dependencies-è¡¨è¾¾å¼ç®¡ç†ä¾èµ–"><a href="#1ï¼‰ä½¿ç”¨-dependencies-è¡¨è¾¾å¼ç®¡ç†ä¾èµ–" class="headerlink" title="1ï¼‰ä½¿ç”¨ dependencies è¡¨è¾¾å¼ç®¡ç†ä¾èµ–"></a>1ï¼‰ä½¿ç”¨ dependencies è¡¨è¾¾å¼ç®¡ç†ä¾èµ–</h4><h5 id="1-åŸºæœ¬åŸåˆ™"><a href="#1-åŸºæœ¬åŸåˆ™" class="headerlink" title="1. åŸºæœ¬åŸåˆ™"></a>1. åŸºæœ¬åŸåˆ™</h5><p>Helm3 ä¸­ï¼Œå¼ƒç”¨äº† <code>requeirements.yaml</code> ï¼Œ<code>dependencies</code> å­—æ®µè¢«åˆå¹¶è‡³äº† <code>Chart.yaml</code> ä¸­ï¼Œä½†æ˜¯å°±è¯­æ³•è¡¨è¾¾å¼æ¥è¯´ï¼Œå’Œä¹‹å‰æ²¡æœ‰å¤ªå¤§çš„å˜åŒ–ã€‚ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç±»ä¼¼ ansible çš„ playbook æˆ– docker composeï¼Œå…¶è¡¨è¾¾å¼å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">2.0</span><span class="hljs-number">.1</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">https://example.com/charts</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">3.2</span><span class="hljs-number">.1</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">https://another.example.com/charts</span><br></code></pre></td></tr></table></figure><blockquote><ul><li><p><code>name</code> å­—æ®µï¼šæ‰€éœ€ä¾èµ– chart çš„åç§°</p></li><li><p><code>version</code> å­—æ®µï¼šæ‰€éœ€ä¾èµ– chart çš„ç‰ˆæœ¬</p></li><li><p><code>repository</code> å­—æ®µï¼šchart ä»“åº“çš„å®Œæ•´ URL æˆ–è€… ä»“åº“çš„åç§°</p><p>ä½¿ç”¨ URL ï¼š<code>https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</code></p><p>ä½¿ç”¨ ä»“åº“åç§°ï¼š<code>@stable</code></p></li></ul><p>ğŸš©  ä»“åº“å¿…é¡»äº‹å…ˆä½¿ç”¨ <code>helm repo add</code> æ·»åŠ ï¼Œæ‰§è¡Œç±»ä¼¼å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo add stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts<br></code></pre></td></tr></table></figure></blockquote><h5 id="2-ç¤ºä¾‹è¯´æ˜"><a href="#2-ç¤ºä¾‹è¯´æ˜" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜"></a>2. ç¤ºä¾‹è¯´æ˜</h5><h6 id="1âƒ£ï¸-æ·»åŠ ä»“åº“"><a href="#1âƒ£ï¸-æ·»åŠ ä»“åº“" class="headerlink" title="1âƒ£ï¸ æ·»åŠ ä»“åº“"></a>1âƒ£ï¸ æ·»åŠ ä»“åº“</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo add bitnami https://charts.bitnami.com/bitnami  <br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-å†™ä¾èµ–è¡¨è¾¾å¼"><a href="#2âƒ£ï¸-å†™ä¾èµ–è¡¨è¾¾å¼" class="headerlink" title="2âƒ£ï¸ å†™ä¾èµ–è¡¨è¾¾å¼"></a>2âƒ£ï¸ å†™ä¾èµ–è¡¨è¾¾å¼</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">9.3</span><span class="hljs-number">.3</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">&quot;@bitnami&quot;</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mariadb</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">2.1</span><span class="hljs-number">.6</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">&quot;@bitnami&quot;</span><br></code></pre></td></tr></table></figure><h6 id="3âƒ£ï¸-æ›´æ–°ä¾èµ–"><a href="#3âƒ£ï¸-æ›´æ–°ä¾èµ–" class="headerlink" title="3âƒ£ï¸ æ›´æ–°ä¾èµ–"></a>3âƒ£ï¸ æ›´æ–°ä¾èµ–</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm dependency update<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210702105136710.png" alt="image-20210702105136710"></p><p>ä¾èµ–çš„ chart åŒ… ä¼šè¢«ä¸‹è½½åˆ° <code>charts/</code> ç›®å½•ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210702105157112.png" alt="image-20210702105157112"></p><h4 id="2ï¼‰é€šè¿‡-charts-ç›®å½•æ‰‹åŠ¨ç®¡ç†ä¾èµ–"><a href="#2ï¼‰é€šè¿‡-charts-ç›®å½•æ‰‹åŠ¨ç®¡ç†ä¾èµ–" class="headerlink" title="2ï¼‰é€šè¿‡ charts/ ç›®å½•æ‰‹åŠ¨ç®¡ç†ä¾èµ–"></a>2ï¼‰é€šè¿‡ charts/ ç›®å½•æ‰‹åŠ¨ç®¡ç†ä¾èµ–</h4><p>Helm æä¾›äº†ä¸¤ç§ç®¡ç†ä¾èµ–çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯å¦‚ä¸Šæ‰€è¿°çš„ <code>dependencies</code> è¡¨è¾¾å¼ï¼Œå®ƒä¼šéµå¾ªè¯­æ³•åŸåˆ™ï¼Œè‡ªåŠ¨çš„ç®¡ç†ä¾èµ–ï¼Œä¾èµ–åŒ…ä¼šè¢«ä¸‹è½½åˆ° <code>charts/</code> ä¸­ï¼›å¦ä¸€ç§æ–¹å¼å°±æ˜¯é€šè¿‡ <code>charts/</code> ç›®å½•æ¥æ‰‹åŠ¨ç®¡ç†ä¾èµ–ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å¯¹ä¾èµ–çš„ chart åšæ›´å¤šçš„è‡ªå®šä¹‰è®¾ç½®ã€‚</p><h5 id="1-åŸºæœ¬åŸåˆ™-1"><a href="#1-åŸºæœ¬åŸåˆ™-1" class="headerlink" title="1. åŸºæœ¬åŸåˆ™"></a>1. åŸºæœ¬åŸåˆ™</h5><blockquote><ul><li><code>charts/</code> ä¸‹ç®¡ç†çš„ä¾èµ–å¿…é¡»æ˜¯ä¸€ä¸ª <strong>chart åŒ…</strong> ï¼ˆ<code>xxx-1.0.1.tgz</code>ï¼‰æˆ–æ˜¯ä¸€ä¸ªè§£å‹çš„ <strong>chart ç›®å½•</strong></li><li><strong>ä¾èµ–çš„åç§°ä¸èƒ½ä»¥ <code>_</code> æˆ– <code>.</code> å¼€å¤´</strong>ï¼Œå¦åˆ™ä¼šè¢« chart åŠ è½½å™¨å¿½ç•¥</li><li>å¯ä»¥ä½¿ç”¨ <code>helm pull</code> å°†ä¾èµ–ä¸‹è½½åˆ° <code>charts/</code>ä¸‹</li></ul></blockquote><h5 id="2-ç¤ºä¾‹è¯´æ˜-1"><a href="#2-ç¤ºä¾‹è¯´æ˜-1" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜"></a>2. ç¤ºä¾‹è¯´æ˜</h5><p>æ¯”å¦‚ WordPress çš„ chart ä¾èµ– Apache å’Œ mariadbï¼Œå…¶ç›®å½•å½¢å¼åº”è¯¥å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">wordpress:<br>  Chart.yaml<br><span class="hljs-meta">  #</span><span class="bash"> ...</span><br>  charts/<br>    apache/<br>      Chart.yaml<br>      # ...<br>    mariadb/<br>      Chart.yaml<br>      # ...<br>    memcached/<br>    Chart.yaml<br>      # ...<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰dependencies-ä¸­-condition-å’Œ-tags-ä½¿ç”¨é‡Šä¹‰"><a href="#3ï¼‰dependencies-ä¸­-condition-å’Œ-tags-ä½¿ç”¨é‡Šä¹‰" class="headerlink" title="3ï¼‰dependencies ä¸­ condition å’Œ tags ä½¿ç”¨é‡Šä¹‰"></a>3ï¼‰dependencies ä¸­ condition å’Œ tags ä½¿ç”¨é‡Šä¹‰</h4><h5 id="1-åŸºæœ¬åŸåˆ™ï¼š"><a href="#1-åŸºæœ¬åŸåˆ™ï¼š" class="headerlink" title="1. åŸºæœ¬åŸåˆ™ï¼š"></a>1. åŸºæœ¬åŸåˆ™ï¼š</h5><blockquote><ul><li><p>æ¡ä»¶ï¼ˆconditionï¼‰ä¼˜å…ˆ</p><p>å½“è®¾ç½® value æ—¶ï¼Œå¦‚æœåŒæ—¶å­˜åœ¨ <code>condition</code> å’Œ <code>tags</code> çš„å€¼ï¼Œé‚£ä¹ˆ <code>condition</code> çš„æ•ˆæœä¼šè¦†ç›– <code>tags</code> çš„æ•ˆæœã€‚</p></li><li><p>æ ‡ç­¾ï¼ˆtagsï¼‰æœ€å°åŒ–å…ƒç´ </p><p>å½“ <code>tags</code> ä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ çš„å€¼è¢«è®¾ç½®ä¸º <code>true</code> æ—¶ï¼Œå¸¦æœ‰è¯¥ <code>tags</code> çš„ chart å°±ä¼šè¢«å¯ç”¨ã€‚</p></li><li><p><code>condition</code> å’Œ <code>tags</code> åœ¨ values.yaml ä¸­å¿…éœ€åœ¨ç¼©è¿›çš„æœ€é¡¶å±‚</p></li><li><p><code>tags</code> åœ¨ values.yaml ä¸­éœ€ä»¥ä»¥ä¸‹å½¢å¼:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tags:</span><br>  <span class="hljs-string">xxx</span><br>  <span class="hljs-string">xxx</span><br></code></pre></td></tr></table></figure></li></ul></blockquote><h5 id="2-ç¤ºä¾‹è¯´æ˜ï¼š"><a href="#2-ç¤ºä¾‹è¯´æ˜ï¼š" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜ï¼š"></a>2. ç¤ºä¾‹è¯´æ˜ï¼š</h5><p>æ–‡ä»¶: <code>test_chart/Chart.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart1</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">condition:</span> <span class="hljs-string">subchart1.enabled,</span> <span class="hljs-string">global.subchart1.enabled</span><br>    <span class="hljs-attr">tags:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">front-end</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">subchart1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart2</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">condition:</span> <span class="hljs-string">subchart2.enabled,global.subchart2.enabled</span><br>    <span class="hljs-attr">tags:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">back-end</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">subchart2</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶: <code>test_chart/values.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">subchart1:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¡¨è¾¾å¼è¡¨ç¤ºï¼Œ<code>condition</code> ä¸­å¸¦æœ‰ <code>subchart1</code> çš„ chart ä¼šè¢«å¯åŠ¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">tags:</span><br>  <span class="hljs-attr">front-end:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">back-end:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¡¨è¾¾å¼è¡¨ç¤ºï¼Œ<code>tags</code> ä¸­å¸¦æœ‰ <code>back-end</code> çš„ chart ä¼šè¢«å¯åŠ¨ï¼Œè€Œå¸¦æœ‰ <code>front-end</code> çš„åˆ™ä¸ä¼šè¢«å¯åŠ¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">subchart1:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">tags:</span><br>  <span class="hljs-attr">front-end:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">back-end:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¡¨è¾¾å¼ï¼Œå½“ <code>condition</code> å’Œ <code>tags</code> ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæ˜¯ä¼šå‘ç”Ÿæ•ˆæœè¦†ç›–çš„ï¼Œæ¯”å¦‚ï¼Œè™½ç„¶ <code>front-end</code> è®¾ç½®ä¸ºäº† <code>false</code>ï¼Œä½†æ˜¯ç”±äº <code>subchart1.enabled</code> è®¾ç½®ä¸º <code>true</code>ï¼Œæ¡ä»¶å‘ç”Ÿè¦†ç›–ï¼Œæ‰€ä»¥ chart <code>subchart1</code> è¿˜æ˜¯ä¼šè¢«å¯ç”¨ã€‚</p><p>è€Œå½“ <code>back-end</code> è®¾ç½®ä¸º <code>true</code> çš„æ—¶å€™ï¼Œæ¡ä»¶è¯»å–çš„å°±æ˜¯ <code>back-end: true</code> ï¼Œå› æ­¤ï¼Œå³ä½¿æ²¡æœ‰è®¾ç½® <code>subchart2.enabled</code> ä¸º <code>true</code>ï¼Œchart <code>subchart2</code> ä¹Ÿä¼šè¢«å¯ç”¨ã€‚</p><h4 id="4ï¼‰dependencies-ä¸­çš„-alias-ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰"><a href="#4ï¼‰dependencies-ä¸­çš„-alias-ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰" class="headerlink" title="4ï¼‰dependencies  ä¸­çš„ alias ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰"></a>4ï¼‰dependencies  ä¸­çš„ alias ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰</h4><h5 id="1-åŸºæœ¬åŸåˆ™-2"><a href="#1-åŸºæœ¬åŸåˆ™-2" class="headerlink" title="1. åŸºæœ¬åŸåˆ™"></a>1. åŸºæœ¬åŸåˆ™</h5><p>åœ¨ <code>dependencies</code> çš„è¡¨è¾¾å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>alias</code> å¯¹éœ€æ±‚é¡¹æ·»åŠ åˆ«åï¼Œå½“å­˜åœ¨ä¾èµ–å¤šæ¬¡å¤ç”¨çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡åˆ«åçš„æ–¹å¼æ¥è®¿é—®è¯¥éœ€æ±‚é¡¹ï¼Œä»¥æ­¤åŠ ä»¥åŒºåˆ†ã€‚ï¼ˆæ¯”å¦‚ æ•°æ®åº“çš„ä¸»ä»ã€é›†ç¾¤ç­‰ä½¿ç”¨åœºæ™¯ï¼‰</p><h5 id="2-ç¤ºä¾‹è¯´æ˜-2"><a href="#2-ç¤ºä¾‹è¯´æ˜-2" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜"></a>2. ç¤ºä¾‹è¯´æ˜</h5><p>æ–‡ä»¶: <code>parent_chart/Chart.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">alias:</span> <span class="hljs-string">new-subchart-1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">alias:</span> <span class="hljs-string">new-subchart-2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">subchart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šæƒ…å†µï¼Œ<code>parent_chart</code> ä¸­ç›¸å½“äºæœ‰ 3 ä¸ªä¾èµ–é¡¹ï¼Œ<code>subchart</code>ã€<code>new-subchart-1</code> ã€<code>new-subchart-2</code> ï¼Œè™½ç„¶ä»–ä»¬æ˜¯åŸºäºåŒä¸€ä¸ª chart çš„ï¼Œä½†æ˜¯å¯ä»¥è¢«åŒºåˆ«å¯¹å¾…ã€‚</p><h4 id="5ï¼‰dependencies-ä¸­çš„-import-values-ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰"><a href="#5ï¼‰dependencies-ä¸­çš„-import-values-ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰" class="headerlink" title="5ï¼‰dependencies  ä¸­çš„ import-values ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰"></a>5ï¼‰dependencies  ä¸­çš„ import-values ä½¿ç”¨é‡Šä¹‰ï¼ˆäº†è§£ï¼‰</h4><p>ä»ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ <code>charts/</code> ç›®å½•ä¸‹é¢ç®¡ç†çš„å…¶å®ä¹Ÿæ˜¯ chartï¼Œé‚£ä¹ˆå®ƒå°±ä¼šéµå¾ª chart çš„åŸåˆ™ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œç›®å½•ç»“æ„å°±æ˜¯ä¸€ç§  <code>çˆ¶-å­</code> çš„å…³ç³»ã€‚åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦è¯»å– <em>å­ char</em> çš„å€¼ï¼ŒHelm åˆ™æä¾›äº† <code>import-values</code> è¿™æ ·ä¸€ç§å®ç°æ–¹å¼ã€‚</p><h5 id="1-åŸºæœ¬åŸåˆ™-3"><a href="#1-åŸºæœ¬åŸåˆ™-3" class="headerlink" title="1. åŸºæœ¬åŸåˆ™"></a>1. åŸºæœ¬åŸåˆ™</h5><blockquote><ul><li><p>ç›®å½•ç»“æ„å’Œæ–‡ä»¶å…³ç³»å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">parent_chart:# çˆ¶ chart<br>  Chart.yaml# dependencies - child_chart - import-values - Key<br><span class="hljs-meta">  #</span><span class="bash"> ...</span><br>  charts/<br>    child_chart/# å­ chart<br>      Chart.yaml<br>      values.yaml# exports - Key - value<br>      # ...<br></code></pre></td></tr></table></figure></li><li><p>åŠ è½½å™¨ä¼šæ ¹æ® <code>dependencies - name</code> æ‰¾ <em>å­ chart</em>ï¼Œæ ¹æ® <code>dependencies - import-values</code> çš„ key è§£æ <em>å­ chart</em> ä¸­å¯¹åº”çš„å€¼</p></li><li><p>åŠ è½½å™¨é»˜è®¤è¯†åˆ« <code>exports</code></p></li><li><p>æ²¡æœ‰ <code>exports</code> ï¼Œéœ€è¦ä»¥ <code>parent-child</code> æ–¹å¼æ˜ç¡®æŒ‡æ˜è¦æ³¨å…¥çš„ <em>å­ chart</em> çš„å€¼çš„ Key å’Œ è¦è¢«æ³¨å…¥çš„ <em>çˆ¶ chart</em> çš„å€¼çš„åç§°</p></li><li><p>import <em>å­ chart</em> æ‰€å¾—çš„å€¼æœ€ç»ˆä¼šè¢«åˆå¹¶å…¥ <em>çˆ¶ chart</em> çš„ values ä¸­ï¼Œå¹¶ä¼šè¦†ç›–åŸæœ‰é”®å€¼</p></li></ul></blockquote><h5 id="2-ç¤ºä¾‹è¯´æ˜-3"><a href="#2-ç¤ºä¾‹è¯´æ˜-3" class="headerlink" title="2. ç¤ºä¾‹è¯´æ˜"></a>2. ç¤ºä¾‹è¯´æ˜</h5><h6 id="1âƒ£ï¸-ä½¿ç”¨-exports-çš„æ–¹å¼"><a href="#1âƒ£ï¸-ä½¿ç”¨-exports-çš„æ–¹å¼" class="headerlink" title="1âƒ£ï¸ ä½¿ç”¨ exports çš„æ–¹å¼"></a>1âƒ£ï¸ ä½¿ç”¨ <code>exports</code> çš„æ–¹å¼</h6><p>æ–‡ä»¶:  <code>parent_chart/Chart.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">child_chart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">import-values:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">data</span><span class="hljs-comment"># å¼•ç”¨å­ chart çš„å˜é‡ - data</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶: <code>parent_chart/charts/child_chart/values.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">exports:</span><span class="hljs-comment"># å£°æ˜å˜é‡ data</span><br><span class="hljs-attr">data:</span><br><span class="hljs-attr">port:</span> <span class="hljs-number">3306</span><br></code></pre></td></tr></table></figure><p>Helm ä¼šåœ¨ <code>import-values</code> çš„åˆ—è¡¨åˆ°å…¥å†…å®¹æ—¶ï¼Œå°†å…¶ä¸­çš„å…ƒç´ ä½œä¸º Keyï¼Œå¹¶ä»¥æ­¤åˆ° <em>å­ chart</em> çš„ <code>exports</code> å­—æ®µæŸ¥æ‰¾å¯¹åº”çš„ Keyï¼Œå¹¶å°†å¯¹åº”çš„ value æ³¨å…¥ <em>çˆ¶ chart</em>  çš„ values ä¸­ï¼Œæ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬å¯ä»¥åœ¨ <em>çˆ¶ chart</em> ä¸­å¯è·å–åˆ°çš„å€¼ä¸ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">port:</span> <span class="hljs-number">3306</span><br></code></pre></td></tr></table></figure><h6 id="2âƒ£ï¸-ä½¿ç”¨-parent-â€”-child-çš„æ–¹å¼"><a href="#2âƒ£ï¸-ä½¿ç”¨-parent-â€”-child-çš„æ–¹å¼" class="headerlink" title="2âƒ£ï¸ ä½¿ç”¨ parent â€” child çš„æ–¹å¼"></a>2âƒ£ï¸ ä½¿ç”¨ <code>parent â€” child</code> çš„æ–¹å¼</h6><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>å¦‚æœåœ¨ <em>å­ chart</em> çš„ values.yaml ä¸­æ²¡æœ‰ä½¿ç”¨ <code>exports</code> ï¼Œå°±å¿…é¡»æŒ‡å®šè¦æ³¨å…¥çš„ <em>å­ chart</em> å€¼çš„ æºKey ä»¥åŠ è¢«æ³¨å…¥çš„ <em>çˆ¶ chart</em> çš„å€¼çš„åç§°ã€‚</p></blockquote><p>æ–‡ä»¶: <code>parent_chart/Chart.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">child_chart</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">http://localhost:10191</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br>    <span class="hljs-string">...</span><br>    <span class="hljs-attr">import-values:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">child:</span> <span class="hljs-string">default.data</span><br>        <span class="hljs-attr">parent:</span> <span class="hljs-string">myimports</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶: <code>parent_chart/charts/child_chart/values.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">default:</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">myint:</span> <span class="hljs-number">999</span><br>    <span class="hljs-attr">mybool:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>æ–‡ä»¶: <code>parent_chart/values.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">myimports:</span><br>  <span class="hljs-attr">myint:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">mybool:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">mystring:</span> <span class="hljs-string">&quot;helm tests!&quot;</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šè¿°ç¤ºä¾‹ï¼Œ<code>import-values</code> çš„åŠ è½½å™¨ï¼Œæ ¹æ® <code>child</code> å» child_chart çš„ values.yaml ä¸­æ‰¾ <code>default - data</code> ï¼Œå¹¶è§£æå‡ºå…¶å€¼ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ° <em>çˆ¶ chart</em> ä¸­ï¼Œå¹¶ä¼šè¦†ç›–åŸæœ‰çš„é”®å€¼ï¼Œç”±æ­¤ <em>çˆ¶ chart</em> æœ€ç»ˆçš„ values ä¼šåˆå¹¶å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">myimports:</span><br>  <span class="hljs-attr">myint:</span> <span class="hljs-number">999</span><br>  <span class="hljs-attr">mybool:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">mystring:</span> <span class="hljs-string">&quot;helm tests!&quot;</span><br></code></pre></td></tr></table></figure><h3 id="3ã€templates-å’Œ-values-yaml"><a href="#3ã€templates-å’Œ-values-yaml" class="headerlink" title="3ã€templates/ å’Œ values.yaml"></a>3ã€templates/ å’Œ values.yaml</h3><h4 id="1ï¼‰Values-çš„ç”Ÿæ•ˆæœºåˆ¶"><a href="#1ï¼‰Values-çš„ç”Ÿæ•ˆæœºåˆ¶" class="headerlink" title="1ï¼‰Values çš„ç”Ÿæ•ˆæœºåˆ¶"></a>1ï¼‰Values çš„ç”Ÿæ•ˆæœºåˆ¶</h4><p>Values é€šè¿‡æ¨¡æ¿ä¸­<code>.Values</code>å¯¹è±¡å¯è®¿é—®çš„<code>values.yaml</code>æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>.Chart</code> å¯¹è±¡å¯è®¿é—®çš„ <code>Chart.yaml</code> ï¼Œä»¥æ­¤ç±»æ¨ã€‚å¦å¤– ï¼ŒHelm ä¸­æœ‰ä¸€äº›é¢„å®šä¹‰çš„ valuesï¼Œå¯ä»¥å°†å…¶è§†ä¸ºç¯å¢ƒå˜é‡ï¼Œå…·ä½“å¦‚ä¸‹:</p><blockquote><ul><li><p><strong>Release</strong></p><p>è¯¥å¯¹è±¡æè¿°äº†ç‰ˆæœ¬å‘å¸ƒæœ¬èº«ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ<code>&#123;&#123; .Release.Name &#125;&#125;</code> (è·å– release çš„åç§°)</p></li><li><p><strong>.Values</strong></p><p>è®¿é—® <code>values.yaml</code> çš„å†…å®¹ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ<code>&#123;&#123; .Values.image.repository &#125;&#125;</code> (è·å– values.yaml ä¸­ <code>image - repository</code> çš„å€¼)</p></li><li><p><strong>.Chart</strong></p><p>è®¿é—® <code>Chart.yaml</code> çš„å†…å®¹ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ <code>&#123;&#123; .Chart.Version &#125;&#125;</code> (è·å¾— chart çš„ç‰ˆæœ¬)ã€<code>&#123;&#123; .Chart.Maintainers &#125;&#125;</code> (è·å– chart çš„ç»´æŠ¤è€…) </p><p>è¯­æ³•é£æ ¼éµå¾ª go æ¨¡ç‰ˆè§„åˆ™ï¼Œç±»ä¼¼ jinja2ã€‚æ˜¯ä¸€ç§å±‚çº§æ£€ç´¢çš„æ–¹å¼ï¼Œ<code>.</code> è¡¨ç¤ºå±‚çº§ï¼Œæœ€é¡¶å±‚çš„ <code>.</code> å³ <code>æ ¹</code> ã€‚</p></li><li><p><strong>.Files</strong></p><p>è®¿é—® chart ä¸­å­˜åœ¨çš„æ–‡ä»¶çš„å†…å®¹ (<code>.helmignore</code> é™¤å¤–)ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ<code>&#123;&#123; index .Files "file.name" &#125;&#125;</code> (è·å–è¯¥æ–‡ä»¶ä¸­ <code>name</code>çš„å€¼)ï¼Œå®ƒç­‰æ•ˆäº <code>&#123;&#123; .Files.Get name &#125;&#125;</code> æ–¹æ³•ã€‚</p><p><code>&#123;&#123; .Files.GetBytes &#125;&#125;</code> æ–¹æ³•ç­‰æ•ˆäºè®¿é—®æ–‡ä»¶ä¸­çš„ <code>[]byte</code> å¯¹è±¡</p></li><li><p><strong>.Capabilities</strong></p><p>è®¿é—® K8s çš„ <code>Capabilities</code> å¯¹è±¡ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å¦‚ï¼Œ<code>&#123;&#123; .Capabilities.KubeVersion &#125;&#125;</code> (è·å– K8s ç‰ˆæœ¬)ã€<code>&#123;&#123; .Capabilities.APIVersions.Has "batch/v1" &#125;&#125;</code>(è·å–æ”¯æŒçš„ K8s API ç‰ˆæœ¬)</p></li></ul></blockquote><h4 id="2ï¼‰templates-ä¸­çš„æ¨¡ç‰ˆ"><a href="#2ï¼‰templates-ä¸­çš„æ¨¡ç‰ˆ" class="headerlink" title="2ï¼‰templates/ ä¸­çš„æ¨¡ç‰ˆ"></a>2ï¼‰templates/ ä¸­çš„æ¨¡ç‰ˆ</h4><p>æ¨¡æ¿æ–‡ä»¶éµå®ˆä¹¦å†™Goæ¨¡æ¿çš„æ ‡å‡†æƒ¯ä¾‹ï¼ˆæŸ¥çœ‹ <a href="https://golang.org/pkg/text/template/">æ–‡æœ¬/æ¨¡æ¿ Go åŒ…æ–‡æ¡£</a>äº†è§£æ›´å¤šï¼‰ã€‚ä»¥å‘å¸ƒä¸€ä¸ª nginx çš„ <code>templates/deployment.yaml</code> çš„ç¤ºä¾‹æ¨¡ç‰ˆä¸ºä¾‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span>  &#125;&#125;<br><span class="hljs-attr">spec:</span><br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">if</span> <span class="hljs-string">not</span> <span class="hljs-string">.Values.autoscaling.enabled</span> &#125;&#125;<br>  <span class="hljs-attr">replicas:</span> &#123;&#123; <span class="hljs-string">.Values.replicaCount</span> &#125;&#125;<br>  &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span> &#125;&#125;<br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span> &#125;&#125;<br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">imagePullSecrets:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harborsecret</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Chart.Name</span> &#125;&#125;<br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;<span class="hljs-template-variable">&#123;&#123; .Values.image.repository &#125;&#125;</span>:<span class="hljs-template-variable">&#123;&#123; .Values.image.tag &#125;&#125;</span>&quot;</span><br>          <span class="hljs-attr">imagePullPolicy:</span> &#123;&#123; <span class="hljs-string">.Values.image.pullPolicy</span> &#125;&#125;<br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> &#123;&#123; <span class="hljs-string">.Values.service.port</span> &#125;&#125;<br>              <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">resources:</span><br>            &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.Values.resources</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">12</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.nodeSelector</span> &#125;&#125;<br>      <span class="hljs-attr">nodeSelector:</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">8</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.affinity</span> &#125;&#125;<br>      <span class="hljs-attr">affinity:</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">8</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">with</span> <span class="hljs-string">.Values.tolerations</span> &#125;&#125;<br>      <span class="hljs-attr">tolerations:</span><br>        &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">toYaml</span> <span class="hljs-string">.</span> <span class="hljs-string">|</span> <span class="hljs-string">nindent</span> <span class="hljs-number">8</span> &#125;&#125;<br>      &#123;&#123;<span class="hljs-bullet">-</span> <span class="hljs-string">end</span> &#125;&#125;<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰å–å€¼-values-yaml-æ¸²æŸ“æ¨¡ç‰ˆ"><a href="#3ï¼‰å–å€¼-values-yaml-æ¸²æŸ“æ¨¡ç‰ˆ" class="headerlink" title="3ï¼‰å–å€¼ values.yaml æ¸²æŸ“æ¨¡ç‰ˆ"></a>3ï¼‰å–å€¼ values.yaml æ¸²æŸ“æ¨¡ç‰ˆ</h4><p>æ ¹æ®å¦‚ä¸Šæ¨¡ç‰ˆçš„å˜é‡å…³ç³»ï¼Œè¿›è¡Œå¯¹åº”æ–‡ä»¶ value çš„é…ç½®ï¼Œæ¶‰åŠåˆ° <code>Chart.yaml</code> å’Œ <code>values.yaml</code> ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><h5 id="1-Chart-yaml-çš„å¿…è¦å€¼"><a href="#1-Chart-yaml-çš„å¿…è¦å€¼" class="headerlink" title="1. Chart.yaml çš„å¿…è¦å€¼"></a>1. <code>Chart.yaml</code> çš„å¿…è¦å€¼</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v2</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">A</span> <span class="hljs-string">Helm</span> <span class="hljs-string">chart</span> <span class="hljs-string">for</span> <span class="hljs-string">Kubernetes</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">application</span><br><span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span><br><span class="hljs-attr">appVersion:</span> <span class="hljs-string">&quot;1.16.0&quot;</span><br></code></pre></td></tr></table></figure><h5 id="2-values-yaml-çš„å¿…è¦å€¼"><a href="#2-values-yaml-çš„å¿…è¦å€¼" class="headerlink" title="2. values.yaml çš„å¿…è¦å€¼"></a>2. <code>values.yaml</code> çš„å¿…è¦å€¼</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">replicaCount:</span> <span class="hljs-number">1</span><br><br><span class="hljs-attr">image:</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">tag:</span> <span class="hljs-string">&quot;stable&quot;</span><br>  <span class="hljs-attr">pullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br><br><span class="hljs-attr">service:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br><br><span class="hljs-attr">resources:</span><br>  <span class="hljs-attr">limits:</span><br>    <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>    <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br>  <span class="hljs-attr">requests:</span><br>    <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>    <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br><br><span class="hljs-attr">autoscaling:</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">minReplicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">maxReplicas:</span> <span class="hljs-number">100</span><br>  <span class="hljs-attr">targetCPUUtilizationPercentage:</span> <span class="hljs-number">80</span><br>  <span class="hljs-comment"># targetMemoryUtilizationPercentage: 80</span><br><br><span class="hljs-attr">nodeSelector:</span> &#123;&#125;<br><br><span class="hljs-attr">tolerations:</span> []<br><br><span class="hljs-attr">affinity:</span> &#123;&#125;<br></code></pre></td></tr></table></figure><h5 id="3-éªŒè¯æ¸²æŸ“æ•ˆæœ"><a href="#3-éªŒè¯æ¸²æŸ“æ•ˆæœ" class="headerlink" title="3. éªŒè¯æ¸²æŸ“æ•ˆæœ"></a>3. éªŒè¯æ¸²æŸ“æ•ˆæœ</h5><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ <code>helm install</code> æ—¶ä½¿ç”¨ <code>--dry-run</code> å‚æ•°æ¥åªæ¸²æŸ“æ¨¡ç‰ˆï¼Œè€Œè¿›è¡Œç›´æ¥éƒ¨ç½²ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éªŒè¯æ•ˆæœäº†ã€‚æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --dry-run demo test_chart/<br></code></pre></td></tr></table></figure><p>æ¸²æŸ“åçš„ manifest å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">imagePullSecrets:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harborsecret</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;nginx:stable&quot;</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br>              <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br></code></pre></td></tr></table></figure><h4 id="4ï¼‰-set-æŒ‡å®šå‚æ•°æ¸²æŸ“"><a href="#4ï¼‰-set-æŒ‡å®šå‚æ•°æ¸²æŸ“" class="headerlink" title="4ï¼‰--set æŒ‡å®šå‚æ•°æ¸²æŸ“"></a>4ï¼‰<code>--set</code> æŒ‡å®šå‚æ•°æ¸²æŸ“</h4><p>å½“æˆ‘ä»¬åœ¨æ‰§è¡Œ <code>helm install</code> æˆ–è€… <code>helm upgrade</code> æ—¶ï¼Œé™¤äº†ç›´æ¥é€šè¿‡ <em>values.yaml</em> æ¸²æŸ“å¤–ï¼Œä¹Ÿæ”¯æŒç›´æ¥åœ¨å‘½ä»¤è¡Œé€šè¿‡ <code>--set</code> å‚æ•°ä¼ å‚ï¼Œ<strong>ä¼ å…¥çš„å‚æ•°ä¼šè¦†ç›– <em>values.yaml</em> ä¸­çš„é¢„è®¾å€¼</strong>ã€‚</p><h5 id="ç¤ºä¾‹ï¼šé€šè¿‡-set-ä¿®æ”¹-é•œåƒç‰ˆæœ¬-å’Œ-ç«¯å£"><a href="#ç¤ºä¾‹ï¼šé€šè¿‡-set-ä¿®æ”¹-é•œåƒç‰ˆæœ¬-å’Œ-ç«¯å£" class="headerlink" title="ç¤ºä¾‹ï¼šé€šè¿‡ --set ä¿®æ”¹ é•œåƒç‰ˆæœ¬ å’Œ ç«¯å£"></a>ç¤ºä¾‹ï¼šé€šè¿‡ <code>--set</code> ä¿®æ”¹ <code>é•œåƒç‰ˆæœ¬</code> å’Œ <code>ç«¯å£</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --set image.tag=&quot;1.16.0&quot; --set service.port=9999 --dry-run demo test_chart/<br></code></pre></td></tr></table></figure><p>æ¸²æŸ“åçš„ manifest å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">imagePullSecrets:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harborsecret</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;nginx:1.16.0&quot;</span><span class="hljs-comment"># é•œåƒç‰ˆæœ¬ç”±åŸæ¥çš„ stable æ›´æ”¹ä¸º 1.16.0</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9999</span><span class="hljs-comment"># ç«¯å£ç”±åŸæ¥çš„ 80 æ›´æ”¹ä¸º 9999</span><br>              <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br></code></pre></td></tr></table></figure><h4 id="5ï¼‰é€šè¿‡-f-æŒ‡å®š-Values-æ–‡ä»¶"><a href="#5ï¼‰é€šè¿‡-f-æŒ‡å®š-Values-æ–‡ä»¶" class="headerlink" title="5ï¼‰é€šè¿‡ -f æŒ‡å®š Values æ–‡ä»¶"></a>5ï¼‰é€šè¿‡ <code>-f</code> æŒ‡å®š Values æ–‡ä»¶</h4><p>chart é»˜è®¤çš„ Values æ–‡ä»¶å‘½åä¸º <code>values.yaml</code>ï¼Œå½“ä½ åœ¨æ‰§è¡Œ <code>helm install</code> æˆ– <code>helm upgrade</code> æ—¶ï¼Œå¦‚æœåç§°ä¸æ˜¯ <code>values.yaml</code>ï¼Œæ‰§è¡Œå°±ä¼šå‡ºé”™ã€‚<strong>é€šè¿‡å‘½ä»¤è¡Œ <code>-f</code> å‚æ•°ï¼Œå¯ä»¥æŒ‡å®š Values æ–‡ä»¶</strong>ï¼Œè¿™æ ·æ–‡ä»¶çš„åç§°å°±ä¸å—é™åˆ¶äº†ã€‚</p><h5 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h5><p>åˆ›å»ºæ–‡ä»¶ <code>test_chart/demo.yaml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell">replicaCount: 1<br><br>image:<br>  repository: mysql<br>  tag: &quot;8.7.0&quot;<br>  pullPolicy: IfNotPresent<br><br>service:<br>  type: ClusterIP<br>  port: 3306<br><br>resources:<br>  limits:<br>    cpu: 100m<br>    memory: 128Mi<br>  requests:<br>    cpu: 100m<br>    memory: 128Mi<br><br>autoscaling:<br>  enabled: false<br>  minReplicas: 1<br>  maxReplicas: 100<br>  targetCPUUtilizationPercentage: 80<br><span class="hljs-meta">  #</span><span class="bash"> targetMemoryUtilizationPercentage: 80</span><br><br>nodeSelector: &#123;&#125;<br><br>tolerations: []<br><br>affinity: &#123;&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè¿›è¡Œæ¸²æŸ“æµ‹è¯•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install -f test_chart/demo.yaml --dry-run demo test_chart<br></code></pre></td></tr></table></figure><p>æ¸²æŸ“åçš„ manifest å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">test_chart</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">imagePullSecrets:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">harborsecret</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">test_chart</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;mysql:8.7.0&quot;</span><span class="hljs-comment"># é•œåƒå·²æ›´æ”¹</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">http</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3306</span><span class="hljs-comment"># ç«¯å£å·²æ›´æ”¹</span><br>              <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-string">http</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">100m</span><br>              <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span><br><br></code></pre></td></tr></table></figure><h3 id="4ã€æ¶æ„æ–‡ä»¶-values-schema-json"><a href="#4ã€æ¶æ„æ–‡ä»¶-values-schema-json" class="headerlink" title="4ã€æ¶æ„æ–‡ä»¶ values.schema.json"></a>4ã€æ¶æ„æ–‡ä»¶ <code>values.schema.json</code></h3><p>æ˜¯å¦è¿˜è®°å¾—ï¼Œåœ¨ç¬¬1ç« ä¸­æˆ‘ä»¬ä»‹ç»è¿‡ Helm3 çš„æ–°åŠŸèƒ½ä¸­å¢åŠ äº† <code>ä½¿ç”¨JSON Schema</code> æ¥éªŒè¯ Chart çš„ Values çš„æœºåˆ¶ï¼Ÿäº‹å®ä¸Šï¼Œå®ƒåœ¨ Chart çš„è¡¨ç°å°±æ˜¯ <code>values.schema.json</code> æ–‡ä»¶ã€‚åœ¨å…¶ä¸­<code>required</code> å¯ä»¥ç”¨äºå®šä¹‰å“ªäº›å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œ<code>type</code> å¯ç”¨ç”¨äºå®šä¹‰å“ªäº›å­—æ®µéœ€è¦æ˜¯ä»€ä¹ˆå­—æ®µç±»å‹ç­‰ã€‚</p><blockquote><p>ğŸš© <strong>å½“æˆ‘ä»¬åœ¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ—¶ï¼ŒHelm å°†ä¼šä»¥è¯¥ Json å®šä¹‰çš„æ¶æ„æ ¼å¼å»éªŒè¯ .Values å¯¹è±¡æ˜¯å¦ç¬¦åˆè§„æ ¼ï¼Œåªæœ‰å½“éªŒè¯é€šè¿‡åï¼Œæ‰èƒ½æ­£å¸¸å‘é€ç»™ K8s æ‰§è¡Œã€‚</strong></p><ul><li>helm install</li><li>helm upgrade</li><li>helm lint</li><li>helm template</li></ul></blockquote><h4 id="1ï¼‰æ ¼å¼ç¤ºä¾‹"><a href="#1ï¼‰æ ¼å¼ç¤ºä¾‹" class="headerlink" title="1ï¼‰æ ¼å¼ç¤ºä¾‹"></a>1ï¼‰æ ¼å¼ç¤ºä¾‹</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;$schema&quot;</span>: <span class="hljs-string">&quot;https://json-schema.org/draft-07/schema#&quot;</span>,<br>  <span class="hljs-attr">&quot;properties&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;image&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;Container Image&quot;</span>,<br>      <span class="hljs-attr">&quot;properties&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;repo&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span><br>        &#125;,<br>        <span class="hljs-attr">&quot;tag&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span><br>        &#125;<br>      &#125;,<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;name&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;Service name&quot;</span>,<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;port&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;Port&quot;</span>,<br>      <span class="hljs-attr">&quot;minimum&quot;</span>: <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;integer&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;protocol&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">&quot;required&quot;</span>: [<br>    <span class="hljs-string">&quot;protocol&quot;</span>,<br>    <span class="hljs-string">&quot;port&quot;</span><br>  ],<br>  <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;Values&quot;</span>,<br>  <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ç¤ºä¾‹è¯´æ˜"><a href="#2ï¼‰ç¤ºä¾‹è¯´æ˜" class="headerlink" title="2ï¼‰ç¤ºä¾‹è¯´æ˜"></a>2ï¼‰ç¤ºä¾‹è¯´æ˜</h4><p><code>required</code> å­—æ®µå®šä¹‰äº† Values ä¸­å¿…è¦çš„å­—æ®µï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œå³ <code>protocol</code> å’Œ <code>port</code> ã€‚å¦å¤–ï¼Œ<code>name</code> é»˜ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œå› ä¸º <code>service name</code> æ˜¯ä¸€ä¸ª <code>Release</code> çš„å¿…è¦å…ƒç´ ï¼Œå› æ­¤ï¼Œä¸€ä¸ªç¬¦åˆè¯¥æ¶æ„è¦æ±‚çš„æœ€ç²¾ç®€ <em>values.yaml</em> åº”è¯¥å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attr">protocol:</span> <span class="hljs-string">http</span><br><span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>ä¸Šé¢æœ‰æåˆ°è¿‡ï¼Œæ¶æ„æ–‡ä»¶éªŒè¯çš„å¯¹è±¡æ˜¯ <code>.Values å¯¹è±¡</code>ï¼Œè€Œä¸æ˜¯ <em>values.yaml</em> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ <code>--set</code> æŒ‡å®šçš„å‚æ•°ä¹Ÿå±äºå…¶æ£€æµ‹çš„èŒƒç•´ï¼Œå› æ­¤ï¼Œå¦‚ä¸‹è¿™ç§æƒ…å†µä¹Ÿæ˜¯å¯ä»¥çš„é€šè¿‡æ£€æŸ¥çš„ï¼š</p><p><strong>values.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">fronend</span><br><span class="hljs-attr">protocol:</span> <span class="hljs-string">https</span><br></code></pre></td></tr></table></figure><p><strong>å‘½ä»¤è¡ŒæŒ‡å®š port</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm install --set port=443<br></code></pre></td></tr></table></figure></blockquote><h3 id="5ã€ç”¨æˆ·è‡ªå®šä¹‰èµ„æº-â€”â€”-CRD"><a href="#5ã€ç”¨æˆ·è‡ªå®šä¹‰èµ„æº-â€”â€”-CRD" class="headerlink" title="5ã€ç”¨æˆ·è‡ªå®šä¹‰èµ„æº â€”â€” CRD"></a>5ã€ç”¨æˆ·è‡ªå®šä¹‰èµ„æº â€”â€” CRD</h3><p><strong>CRD</strong>ï¼ˆ<code>Custom Resource Definition</code>ï¼‰æ˜¯ K8s æä¾›çš„ä¸€ç§è‡ªå®šä¹‰èµ„æºå¯¹è±¡çš„æœºåˆ¶ã€‚åœ¨ Helm3 ä¸­ï¼Œä½¿ç”¨ <code>crds/</code> ç›®å½•æ¥å¯¹å…¶è¿›è¡Œç®¡ç†ï¼ŒHelm3 ä¼šåœ¨å®‰è£… <em>chart</em> ä¹‹å‰æ£€æŸ¥è¯¥ç›®å½•æ˜¯å¦å­˜åœ¨ CRD çš„ yaml æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆåŠ è½½è¯¥ç›®å½•ä¸‹çš„ <strong>æ‰€æœ‰yamlæ–‡ä»¶</strong>è‡³ K8sï¼Œç„¶åå†è¿›è¡Œ <em>chart</em> çš„å‘å¸ƒã€‚</p><blockquote><p>âš ï¸ <strong>æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</strong></p><ul><li>å¤šä¸ª CRD çš„è¡¨è¾¾å¼å¯ä»¥å†™åœ¨ä¸€ä¸ª yaml æ–‡ä»¶ä¸­ï¼Œä½†éœ€è¦ä»¥ <strong>å¼€å§‹ç»“æŸç¬¦ â€œ <code>---</code> â€œ</strong> è¿›è¡Œåˆ†å‰²</li><li>CRDæ–‡ä»¶<strong>æ— æ³•å¥—ç”¨ Helm æ¨¡ç‰ˆ</strong>ï¼Œå¿…é¡»æ˜¯æ™®é€šçš„ yaml æ ¼å¼æ–‡ä»¶</li><li>å®‰è£… chart æ—¶ï¼Œä¼šå…ˆä¸Šä¼  CRDï¼ˆå¦‚æœ‰ï¼‰ï¼Œå¹¶åŒæ—¶æš‚åœå®‰è£…ï¼Œç›´åˆ° CRD è¢« api server è°ƒç”¨ï¼Œæ‰ä¼šå¼€å§‹åç»­ chart æ¸²æŸ“æ­¥éª¤ã€‚</li></ul></blockquote><h4 id="1ï¼‰ä½¿ç”¨ç¤ºä¾‹"><a href="#1ï¼‰ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="1ï¼‰ä½¿ç”¨ç¤ºä¾‹"></a>1ï¼‰ä½¿ç”¨ç¤ºä¾‹</h4><p>å¦‚æœè¦åˆ›å»ºä¸€ä¸ªé’ˆå¯¹ <code>crontab</code> çš„ CRDï¼Œéœ€è¦éµå¾ªä»¥ä¸‹ç›®å½•ç»“æ„å’Œè¯­æ³•è§„åˆ™ï¼š</p><h5 id="1-ç›®å½•ç»“æ„"><a href="#1-ç›®å½•ç»“æ„" class="headerlink" title="1. ç›®å½•ç»“æ„"></a>1. ç›®å½•ç»“æ„</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">test_chart/<br>  Chart.yaml<br>  crds/<br>    crontab.yaml<br>  templates/<br>    mycrontab.yaml<br></code></pre></td></tr></table></figure><h5 id="2-crontab-yaml-çš„å†™æ³•"><a href="#2-crontab-yaml-çš„å†™æ³•" class="headerlink" title="2. crontab.yaml çš„å†™æ³•"></a>2. crontab.yaml çš„å†™æ³•</h5><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong> CRD ä¸æ”¯æŒ Helm æ¨¡ç‰ˆæŒ‡ä»¤ï¼Œæ‰€ä»¥ crontab.yaml åªèƒ½ä½¿ç”¨ K8s ç»å…¸å£°æ˜è¡¨è¾¾å¼ã€‚</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">crontabs.stable.example.com</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">stable.example.com</span><br>  <span class="hljs-attr">versions:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>      <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Namespaced</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">crontabs</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">crontab</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">CronTab</span><br></code></pre></td></tr></table></figure><h5 id="3-mycrontab-yaml-æ¨¡ç‰ˆæ–‡ä»¶"><a href="#3-mycrontab-yaml-æ¨¡ç‰ˆæ–‡ä»¶" class="headerlink" title="3. mycrontab.yaml æ¨¡ç‰ˆæ–‡ä»¶"></a>3. mycrontab.yaml æ¨¡ç‰ˆæ–‡ä»¶</h5><p>CRD çš„ä¿¡æ¯åœ¨è¢«åŠ è½½è‡³ K8s åï¼Œå°±ä¼šåœ¨ Helm æ¨¡ç‰ˆçš„ <code>.Capabilities</code> ä¸­ç”Ÿæ•ˆï¼ŒæŒ‡å®š <code>apiVersion</code> å°±å¯ä»¥å¼•ç”¨ã€‚å’Œå…¶ä»–èµ„æºå¯¹è±¡ä¸€æ ·ï¼Œä½ éœ€è¦é€šè¿‡åˆ›å»ºæ¨¡ç‰ˆï¼Œå¹¶é€šè¿‡ Values æ¸²æŸ“æ¥åˆ›å»ºå®ä¾‹ã€‚CRD çš„æ¨¡ç‰ˆæ–‡ä»¶åŒå…¶ä»– template æ–‡ä»¶ä¸€æ ·ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">stable.example.com</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CronTab</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> &#123;&#123; <span class="hljs-string">.Values.name</span> &#125;&#125;<br><span class="hljs-attr">spec:</span><br>   <span class="hljs-comment"># ...</span><br></code></pre></td></tr></table></figure><h4 id="2ï¼‰CRD-çš„é™åˆ¶"><a href="#2ï¼‰CRD-çš„é™åˆ¶" class="headerlink" title="2ï¼‰CRD çš„é™åˆ¶"></a>2ï¼‰CRD çš„é™åˆ¶</h4><p>å’Œå¤§éƒ¨åˆ†çš„ K8s èµ„æºå¯¹è±¡ä¸åŒï¼ŒCRD æ˜¯å…¨å±€æ€§çš„ï¼Œæ•… Helm å¯¹å…¶çš„ç®¡ç†è¾ƒä¸ºæ…é‡ï¼Œå¹¶å¯¹å…¶è®¾ç½®äº†ä¸€ä¸‹é™åˆ¶ï¼š</p><blockquote><ul><li><p><strong>ä¸ä¼šé‡å¤å®‰è£…</strong></p><p>å¦‚æœ <code>crds/</code> ç›®å½•ä¸‹çš„ CRDå·²å­˜åœ¨ï¼Œæ— è®ºæ˜¯å¦æœ‰ç‰ˆæœ¬åŒºåˆ«ï¼Œéƒ½ä¸ä¼šé‡æ–°å®‰è£…è¦†ç›–ï¼Œä¸ä¼šè‡ªåŠ¨å‡çº§</p></li><li><p><strong>ä¸ä¼šåœ¨å‡çº§ã€å›æ»šæ—¶å®‰è£…</strong></p><p>åªæœ‰åœ¨ç¬¬ä¸€æ¬¡ <code>helm install</code> æ—¶æ‰ä¼šè¢«å®‰è£…</p></li><li><p><strong>ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤</strong></p><p>è‡ªåŠ¨åˆ é™¤ CRD ä¼šåˆ é™¤æ‰€æœ‰ <code>namespace</code> ä¸­çš„æ‰€æœ‰ <code>CRD</code> ï¼Œæ•…ä¸èƒ½é€šè¿‡ Helm åˆ é™¤</p><p>å¸Œæœ›å‡çº§æˆ–åˆ é™¤ CRDï¼Œéœ€è¦è¿›è¡Œæ‰‹åŠ¨æ“ä½œï¼Œæ“ä½œéœ€è°¨æ…</p></li></ul></blockquote>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬2ç« ã€Helm3 å®‰è£…éƒ¨ç½²</title>
    <link href="/2021/07/24/%E7%AC%AC2%E7%AB%A0%E3%80%81Helm3-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/"/>
    <url>/2021/07/24/%E7%AC%AC2%E7%AB%A0%E3%80%81Helm3-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2ç« ã€Helm3-å®‰è£…éƒ¨ç½²"><a href="#ç¬¬2ç« ã€Helm3-å®‰è£…éƒ¨ç½²" class="headerlink" title="ç¬¬2ç« ã€Helm3 å®‰è£…éƒ¨ç½²"></a>ç¬¬2ç« ã€Helm3 å®‰è£…éƒ¨ç½²</h1><span id="more"></span><h2 id="ä¸€ã€å„ç¯å¢ƒå®‰è£…éƒ¨ç½²"><a href="#ä¸€ã€å„ç¯å¢ƒå®‰è£…éƒ¨ç½²" class="headerlink" title="ä¸€ã€å„ç¯å¢ƒå®‰è£…éƒ¨ç½²"></a>ä¸€ã€å„ç¯å¢ƒå®‰è£…éƒ¨ç½²</h2><h3 id="1ã€Linux"><a href="#1ã€Linux" class="headerlink" title="1ã€Linux"></a>1ã€Linux</h3><h4 id="1ï¼‰äºŒè¿›åˆ¶åŒ…å®‰è£…"><a href="#1ï¼‰äºŒè¿›åˆ¶åŒ…å®‰è£…" class="headerlink" title="1ï¼‰äºŒè¿›åˆ¶åŒ…å®‰è£…"></a>1ï¼‰äºŒè¿›åˆ¶åŒ…å®‰è£…</h4><h5 id="1âƒ£ï¸-ä¸‹è½½äºŒè¿›åˆ¶åŒ…"><a href="#1âƒ£ï¸-ä¸‹è½½äºŒè¿›åˆ¶åŒ…" class="headerlink" title="1âƒ£ï¸ ä¸‹è½½äºŒè¿›åˆ¶åŒ…"></a>1âƒ£ï¸ ä¸‹è½½äºŒè¿›åˆ¶åŒ…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget -c https://get.helm.sh/helm-v3.5.4-linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h5 id="2âƒ£ï¸-ä¸‹è½½æ ¡éªŒæ–‡ä»¶"><a href="#2âƒ£ï¸-ä¸‹è½½æ ¡éªŒæ–‡ä»¶" class="headerlink" title="2âƒ£ï¸ ä¸‹è½½æ ¡éªŒæ–‡ä»¶"></a>2âƒ£ï¸ ä¸‹è½½æ ¡éªŒæ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget -c https://github.com/helm/helm/releases#:~:text=Linux%20amd64%20(-,checksum,-/%20a8ddb4e30435b5fd45308ecce5eaad676d64a5de9c89660b56face3fe990b318)<br></code></pre></td></tr></table></figure><h5 id="3âƒ£ï¸-md5æ ¡éªŒ"><a href="#3âƒ£ï¸-md5æ ¡éªŒ" class="headerlink" title="3âƒ£ï¸ md5æ ¡éªŒ"></a>3âƒ£ï¸ md5æ ¡éªŒ</h5><blockquote><p>å¦‚æœæ²¡æœ‰<code>shasum</code>å‘½ä»¤ï¼Œéœ€å…ˆè¡Œå®‰è£…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y perl-Digest-SHA <br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œè¿›è¡Œæ ¡éªŒ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">shasum -a 256 -c helm-v3.5.4-linux-amd64.tar.gz.sha256sum <br></code></pre></td></tr></table></figure><p>å¦‚æœéªŒè¯é€šè¿‡ï¼Œè¿”å›ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm-v3.5.4-linux-amd64.tar.gz: OK<br></code></pre></td></tr></table></figure><p>å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¿”å›ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm-v3.5.4-linux-amd64.tar.gz: FAILED<br>shasum: WARNING: 1 computed checksum did NOT match<br></code></pre></td></tr></table></figure><h5 id="4âƒ£ï¸-è§£å‹å®‰è£…"><a href="#4âƒ£ï¸-è§£å‹å®‰è£…" class="headerlink" title="4âƒ£ï¸ è§£å‹å®‰è£…"></a>4âƒ£ï¸ è§£å‹å®‰è£…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar xf helm-v3.5.4-linux-amd64.tar.gz &amp;&amp; \<br>cd linux-amd64 &amp;&amp; \<br>install -o root -g root -m 0755 helm /usr/local/bin/helm<br></code></pre></td></tr></table></figure><h5 id="5âƒ£ï¸-éªŒè¯ç‰ˆæœ¬"><a href="#5âƒ£ï¸-éªŒè¯ç‰ˆæœ¬" class="headerlink" title="5âƒ£ï¸ éªŒè¯ç‰ˆæœ¬"></a>5âƒ£ï¸ éªŒè¯ç‰ˆæœ¬</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm version<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿”å›å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">version.BuildInfo&#123;Version:&quot;v3.5.4&quot;, GitCommit:&quot;1b5edb69df3d3a08df77c9902dc17af864ff05d1&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.15.11&quot;&#125;<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰Apt-å®‰è£…ï¼ˆDebian-Ubuntuï¼‰"><a href="#2ï¼‰Apt-å®‰è£…ï¼ˆDebian-Ubuntuï¼‰" class="headerlink" title="2ï¼‰Apt å®‰è£…ï¼ˆDebian/Ubuntuï¼‰"></a>2ï¼‰Apt å®‰è£…ï¼ˆDebian/Ubuntuï¼‰</h4><blockquote><p>å®˜æ–¹æä¾›äº†é’ˆå¯¹Aptçš„ä¸€ä¸ª <code>HelmåŒ…</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>Aptå‘½ä»¤</code> è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ helmã€‚</p></blockquote><h5 id="1âƒ£ï¸-æ·»åŠ é•œåƒæº"><a href="#1âƒ£ï¸-æ·»åŠ é•œåƒæº" class="headerlink" title="1âƒ£ï¸ æ·»åŠ é•œåƒæº"></a>1âƒ£ï¸ æ·»åŠ é•œåƒæº</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl https://baltocdn.com/helm/signing.asc | sudo apt-key add -<br>sudo apt-get install apt-transport-https --yes<br>echo &quot;deb https://baltocdn.com/helm/stable/debian/ all main&quot; | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list<br></code></pre></td></tr></table></figure><h5 id="2âƒ£ï¸-æ›´æ–°ç¼“å­˜"><a href="#2âƒ£ï¸-æ›´æ–°ç¼“å­˜" class="headerlink" title="2âƒ£ï¸ æ›´æ–°ç¼“å­˜"></a>2âƒ£ï¸ æ›´æ–°ç¼“å­˜</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br></code></pre></td></tr></table></figure><h5 id="3âƒ£ï¸-å®‰è£…"><a href="#3âƒ£ï¸-å®‰è£…" class="headerlink" title="3âƒ£ï¸ å®‰è£…"></a>3âƒ£ï¸ å®‰è£…</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install helm<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰è‡ªåŠ¨è„šæœ¬å®‰è£…"><a href="#3ï¼‰è‡ªåŠ¨è„šæœ¬å®‰è£…" class="headerlink" title="3ï¼‰è‡ªåŠ¨è„šæœ¬å®‰è£…"></a>3ï¼‰è‡ªåŠ¨è„šæœ¬å®‰è£…</h4><blockquote><p>å®˜æ–¹æä¾›äº†ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨åœ¨æœ¬åœ°å®‰è£…æœ€æ–°ç‰ˆæœ¬ Helm çš„è„šæœ¬ï¼Œåœ¨ç‰ˆæœ¬åº“çš„ <code>helm/scripts</code> ä¸‹ï¼š</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210628144033780.png" alt="image-20210628144033780"></p><p>ğŸš© <strong>è¯¥è„šæœ¬ä¼šè‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿç¯å¢ƒï¼Œè¿›è¡Œä¸‹è½½å®‰è£…ï¼Œå…¶ä»–ç³»ç»Ÿç¯å¢ƒä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚</strong></p></blockquote><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç›´æ¥è‡ªåŠ¨å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash<br></code></pre></td></tr></table></figure><h4 id="4ï¼‰æ·»åŠ å‘½ä»¤è¡¥å…¨"><a href="#4ï¼‰æ·»åŠ å‘½ä»¤è¡¥å…¨" class="headerlink" title="4ï¼‰æ·»åŠ å‘½ä»¤è¡¥å…¨"></a>4ï¼‰æ·»åŠ å‘½ä»¤è¡¥å…¨</h4><p>å®‰è£…å‘½ä»¤è¡¥å…¨åŠŸèƒ½</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y bash-completion<br></code></pre></td></tr></table></figure><p>æ–°å¢æ–‡ä»¶ <code>/etc/profile.d/helm.sh</code>ï¼Œç¼–è¾‘ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source &lt;(helm completion bash)<br></code></pre></td></tr></table></figure><p>ç”Ÿæ•ˆç¯å¢ƒå˜é‡é…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source /etc/profile.d/helm.sh<br></code></pre></td></tr></table></figure><h3 id="2ã€macOS"><a href="#2ã€macOS" class="headerlink" title="2ã€macOS"></a>2ã€macOS</h3><h4 id="ä½¿ç”¨-Homebrew-å®‰è£…"><a href="#ä½¿ç”¨-Homebrew-å®‰è£…" class="headerlink" title="ä½¿ç”¨ Homebrew å®‰è£…"></a>ä½¿ç”¨ Homebrew å®‰è£…</h4><blockquote><p>å®˜æ–¹æä¾›äº†é’ˆå¯¹ <code>Homebrew</code> æ„å»º Helm çš„æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ <code>brewå‘½ä»¤</code> è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ helmã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">brew install helm<br></code></pre></td></tr></table></figure><h3 id="3ã€Windows"><a href="#3ã€Windows" class="headerlink" title="3ã€Windows"></a>3ã€Windows</h3><h4 id="ä½¿ç”¨-Chocolatey-å®‰è£…"><a href="#ä½¿ç”¨-Chocolatey-å®‰è£…" class="headerlink" title="ä½¿ç”¨ Chocolatey å®‰è£…"></a>ä½¿ç”¨ Chocolatey å®‰è£…</h4><blockquote><p>å®˜æ–¹æä¾›äº†é’ˆå¯¹ <code>Chocolatey</code> çš„ä¸€ä¸ª <code>HelmåŒ…</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>chocoå‘½ä»¤</code> è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ helmã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">choco install kubernetes-helm<br></code></pre></td></tr></table></figure><hr><h2 id="äºŒã€æ·»åŠ å…¬å…±ä»“åº“"><a href="#äºŒã€æ·»åŠ å…¬å…±ä»“åº“" class="headerlink" title="äºŒã€æ·»åŠ å…¬å…±ä»“åº“"></a>äºŒã€æ·»åŠ å…¬å…±ä»“åº“</h2><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>é¦–æ¬¡å®‰è£… Helm3 æ˜¯æ²¡æœ‰æŒ‡å®šé»˜è®¤ä»“åº“çš„ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ä»“åº“æ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p></blockquote><h3 id="1ã€æ·»åŠ å¸¸ç”¨ä»“åº“"><a href="#1ã€æ·»åŠ å¸¸ç”¨ä»“åº“" class="headerlink" title="1ã€æ·»åŠ å¸¸ç”¨ä»“åº“"></a>1ã€æ·»åŠ å¸¸ç”¨ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> helm repo add stable https://charts.helm.sh/stable<span class="hljs-comment"># Helm å®˜æ–¹æº</span></span><br>helm repo add stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts# é˜¿é‡Œäº‘å›½å†…æº(ç”¨äºåŠ é€Ÿ)<br>helm repo add bitnami https://charts.bitnami.com/bitnami# Helm å®˜æ–¹æºï¼ˆHelm3é»˜è®¤ä½¿ç”¨ï¼‰<br>helm repo add incubator https://charts.helm.sh/incubator<br>helm repo add jetstack https://charts.jetstack.io<br></code></pre></td></tr></table></figure><blockquote><p>å¾®è½¯ä¹Ÿæä¾›äº† stable çš„é•œåƒä»“åº“ï¼Œåœ°å€ä¸º <code>http://mirror.azure.cn/kubernetes/charts/</code></p></blockquote><h3 id="2ã€åˆ é™¤ä»“åº“"><a href="#2ã€åˆ é™¤ä»“åº“" class="headerlink" title="2ã€åˆ é™¤ä»“åº“"></a>2ã€åˆ é™¤ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo remove stable<br></code></pre></td></tr></table></figure><h3 id="3ã€æ›´æ–°ä»“åº“"><a href="#3ã€æ›´æ–°ä»“åº“" class="headerlink" title="3ã€æ›´æ–°ä»“åº“"></a>3ã€æ›´æ–°ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo update<br></code></pre></td></tr></table></figure><h3 id="4ã€æŸ¥çœ‹ä»“åº“"><a href="#4ã€æŸ¥çœ‹ä»“åº“" class="headerlink" title="4ã€æŸ¥çœ‹ä»“åº“"></a>4ã€æŸ¥çœ‹ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">helm repo list<br></code></pre></td></tr></table></figure><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/image-20210630154956853.png" alt="image-20210630154956853"></p>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬1ç« ã€Helm ç®€ä»‹</title>
    <link href="/2021/07/24/%E7%AC%AC1%E7%AB%A0%E3%80%81Helm-%E7%AE%80%E4%BB%8B/"/>
    <url>/2021/07/24/%E7%AC%AC1%E7%AB%A0%E3%80%81Helm-%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« ã€Helm-ç®€ä»‹"><a href="#ç¬¬1ç« ã€Helm-ç®€ä»‹" class="headerlink" title="ç¬¬1ç« ã€Helm ç®€ä»‹"></a>ç¬¬1ç« ã€Helm ç®€ä»‹</h1><span id="more"></span><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/helm3.jpg" alt="helm logo"></p><p><a href="https://helm.sh/">Helm å®˜ç½‘</a></p><p><a href="https://github.com/helm/helm">Helm å®˜æ–¹GitHub</a></p><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯-Helmï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯-Helmï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ Helmï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ Helmï¼Ÿ</h2><p>å°±åƒ Java ä½¿ç”¨ mavenï¼›node ä½¿ç”¨ npmï¼›python ä½¿ç”¨ pipï¼›Linux ä½¿ç”¨ yum æˆ– Apt ä¸€æ ·ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆæ ·çš„å·¥ä½œï¼ŒæŠ€æœ¯äººå‘˜éƒ½ä¼šå¸Œæœ›æœ‰ä¸€ç§èµ„æºç®¡ç†å™¨/åŒ…ç®¡ç†å™¨ï¼Œä»¥æ­¤æ¥æ–¹ä¾¿å¾—æŸ¥æ‰¾ã€ä¸‹è½½ã€å®‰è£…ã€ä½¿ç”¨å’Œåˆ†å‘è½¯ä»¶åŒ…ã€‚</p><p>æ‰€ä»¥ Helm å³å¯ä»¥è¯´æ˜¯ <code>K8Sçš„åŒ…ç®¡ç†å™¨</code>ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬å¯¹äº K8S çš„æ“ä½œä¸å†éœ€è¦ç»†åŒ–åˆ°èµ„æºå¯¹è±¡ï¼Œè€Œæ˜¯å¯ä»¥ä½œä¸ºä¸€ä¸ªå®ä¾‹è¿›è¡Œç®¡ç†ã€‚ä¸å†éœ€è¦å»å†™ <code>deployment</code> ã€<code>service</code> ã€<code>ingress</code> çš„ yamlï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥é€šè¿‡ <code>install</code> å‘½ä»¤å®ç°æœåŠ¡å®ä¾‹çš„å®‰è£…ã€‚</p><h3 id="Helm-çš„ä¸»è¦åŠŸèƒ½æ€»ç»“ï¼š"><a href="#Helm-çš„ä¸»è¦åŠŸèƒ½æ€»ç»“ï¼š" class="headerlink" title="Helm çš„ä¸»è¦åŠŸèƒ½æ€»ç»“ï¼š"></a>Helm çš„ä¸»è¦åŠŸèƒ½æ€»ç»“ï¼š</h3><blockquote><ul><li>æŸ¥æ‰¾è¦å®‰è£…å’Œä½¿ç”¨çš„é¢„æ‰“åŒ…è½¯ä»¶</li><li>è½»æ¾åˆ›å»ºå’Œæ‰˜ç®¡è‡ªå·±çš„è½¯ä»¶åŒ…</li><li>å°†è½¯ä»¶åŒ…å®‰è£…åˆ°ä»»ä½• K8S é›†ç¾¤ä¸­</li><li>æŸ¥è¯¢é›†ç¾¤ä»¥æŸ¥çœ‹å·²å®‰è£…å’Œæ­£åœ¨è¿è¡Œçš„ç¨‹åºåŒ…</li><li>æ›´æ–°ã€åˆ é™¤ã€å›æ»šæˆ–æŸ¥çœ‹å·²å®‰è£…è½¯ä»¶åŒ…çš„å†å²è®°å½•</li></ul></blockquote><hr><h2 id="äºŒã€Helm-ä¸­çš„åŸºæœ¬æ¦‚å¿µ"><a href="#äºŒã€Helm-ä¸­çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="äºŒã€Helm ä¸­çš„åŸºæœ¬æ¦‚å¿µ"></a>äºŒã€Helm ä¸­çš„åŸºæœ¬æ¦‚å¿µ</h2><h3 id="1ã€Chart"><a href="#1ã€Chart" class="headerlink" title="1ã€Chart"></a>1ã€<em>Chart</em></h3><p>Helm ä½¿ç”¨çš„åŒ…æ ¼å¼ç§°ä¸º <code>chart</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæè¿° Kubernetes ç›¸å…³èµ„æºå¯¹è±¡çš„æ–‡ä»¶é›†åˆã€‚å®ƒçš„æŠ€æœ¯ç‰¹ç‚¹ç±»ä¼¼ jinjaæ¨¡ç‰ˆï¼Œä»¥æ¸²æŸ“æ¨¡ç‰ˆçš„æ–¹å¼ï¼Œç”Ÿæˆè¿è¡Œä¸€ä¸ªæœåŠ¡å®ä¾‹æ‰€éœ€çš„ä¸€ç³»åˆ—èµ„æºå¯¹è±¡æ–‡ä»¶ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒæœåŠ¡çš„å‘å¸ƒã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ååˆ†ç®€å•çš„åˆ¶ä½œè‡ªå®šä¹‰çš„ chartã€‚</p><p>Chart æœ‰è‡ªå·²ç‰¹å®šçš„ç›®å½•å¸ƒå±€ï¼Œæˆ‘ä»¬ä»¥å®˜æ–¹æä¾›çš„ <code>wordpress</code>ä¸ºä¾‹è¯´æ˜ï¼Œchart çš„æ–‡ä»¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">wordpress/<br>  Chart.yaml          # åŒ…å«äº†chartä¿¡æ¯çš„YAMLæ–‡ä»¶<br>  LICENSE             # å¯é€‰: åŒ…å«chartè®¸å¯è¯çš„çº¯æ–‡æœ¬æ–‡ä»¶<br>  README.md           # å¯é€‰: å¯è¯»çš„READMEæ–‡ä»¶<br>  values.yaml         # chart é»˜è®¤çš„é…ç½®å€¼<br>  values.schema.json  # å¯é€‰: ä¸€ä¸ªä½¿ç”¨JSONç»“æ„çš„values.yamlæ–‡ä»¶<br>  charts/             # åŒ…å«chartä¾èµ–çš„å…¶ä»–chart<br>  crds/               # è‡ªå®šä¹‰èµ„æºçš„å®šä¹‰<br>  templates/          # æ¨¡æ¿ç›®å½•ï¼Œ å½“å’Œvalues ç»“åˆæ—¶ï¼Œå¯ç”Ÿæˆæœ‰æ•ˆçš„Kubernetes manifestæ–‡ä»¶<br>  templates/NOTES.txt # å¯é€‰: åŒ…å«ç®€è¦ä½¿ç”¨è¯´æ˜çš„çº¯æ–‡æœ¬æ–‡ä»¶<br></code></pre></td></tr></table></figure><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>Helm Chart åŸºæœ¬å…ƒç´ ä¸º <code>charts/</code>ã€<code>Chart.yaml </code>ã€<code>templates/</code>ã€<code>values.yaml</code>ï¼Œå¹¶ä¿ç•™ <code>crds/</code> ï¼Œè¦æ­£ç¡®çš„ä½¿ç”¨ chart è¿›è¡Œå‘å¸ƒï¼Œè¯¥å…ƒç´ æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p></blockquote><h3 id="2ã€Repos"><a href="#2ã€Repos" class="headerlink" title="2ã€Repos"></a>2ã€<em>Repos</em></h3><p>Helm chart å¯ä»¥è¢«å­˜å‚¨åœ¨ä¸“ç”¨çš„ HTTP æœåŠ¡å™¨ä¸Šï¼Œç§°ä¸º <code>chart ä»“åº“ï¼ˆrepositories)</code>ï¼Œå’Œ <code>yum repository</code>ç±»ä¼¼ï¼Œchart ä»“åº“æä¾›äº†ä¸€ä¸ª <code>index.yaml</code> æ¥æè¿°ä¸€æ‰¹ chartï¼Œå¹¶ä¸”æä¾›äº†æ¯ä¸ª chart çš„ä¸‹è½½åœ°å€ä¿¡æ¯ã€‚</p><p>Helm å®¢æˆ·ç«¯å¯ä»¥æŒ‡å‘å¤šä¸ª chart ä»“åº“ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰é…ç½®ä»“åº“çš„ï¼Œéœ€è¦ä½¿ç”¨ <code>helm repo add</code> æ¥è¿›è¡Œæ·»åŠ ã€‚helm3 ä¸­å¯¹äºä¸€äº›å¸¸ç”¨æœåŠ¡çš„ä¸‹è½½å®‰è£…ï¼Œç”¨ <code>bitnami ä»“åº“</code>  å–ä»£äº†åŸæ¥çš„<code>stable ä»“åº“</code>ï¼Œä½†æ˜¯ä»ä¿ç•™äº† <code>stable ä»“åº“</code>çš„ä½¿ç”¨ã€‚</p><h3 id="3ã€Release"><a href="#3ã€Release" class="headerlink" title="3ã€Release"></a>3ã€<em>Release</em></h3><p>å½“ chart è¢«å‘å¸ƒåï¼ŒHelm åº“ä¼šåˆ›å»ºä¸€ä¸ª <code>release</code> æ¥è·Ÿè¸ªè¿™ä¸ªå‘å¸ƒçš„å¯¹è±¡ï¼Œå®ƒçš„å®è´¨æ˜¯åœ¨ Kubernetes ä¸­è¿è¡Œçš„å„ç§èµ„æºï¼Œ<code>service</code>ã€<code>deployment</code>ã€<code>configmap</code>ã€<code>secret</code> ç­‰ï¼Œåœ¨ K8S é›†ç¾¤ä¸­çš„ç›´æ¥çš„è¡¨ç°å°±æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª podã€‚</p><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong>  </p><p>Helm çš„ release æ˜¯å…è®¸å¯åŠ¨å¤šä¸ªä¸åŒæœåŠ¡çš„ï¼Œä¸”æ¯ä¸ªæœåŠ¡ä¹‹é—´éµå¾ªä¾èµ–å…³ç³»ï¼Œè¿™ç‚¹å°±æ¯”è¾ƒç±»ä¼¼ docker composeã€‚</p></blockquote><hr><h2 id="ä¸‰ã€ä»-Helm2-åˆ°-Helm3-çš„å˜åŒ–"><a href="#ä¸‰ã€ä»-Helm2-åˆ°-Helm3-çš„å˜åŒ–" class="headerlink" title="ä¸‰ã€ä» Helm2 åˆ° Helm3 çš„å˜åŒ–"></a>ä¸‰ã€ä» Helm2 åˆ° Helm3 çš„å˜åŒ–</h2><h3 id="1ã€Helm3-æ–°å¢çš„åŠŸèƒ½"><a href="#1ã€Helm3-æ–°å¢çš„åŠŸèƒ½" class="headerlink" title="1ã€Helm3 æ–°å¢çš„åŠŸèƒ½"></a>1ã€Helm3 æ–°å¢çš„åŠŸèƒ½</h3><p>Helm3 æœ‰å¾ˆå¤šæ–°çš„åŠŸèƒ½ï¼Œæœ‰ä¸ªé‡è¦åŠŸèƒ½éœ€è¦ç‰¹åˆ«æŒ‡å‡ºï¼š</p><blockquote><ul><li>release çš„ä¿¡æ¯ä»¥æ–°çš„å½¢å¼å­˜å‚¨</li><li>ç§»é™¤äº† Tiller ç»„ä»¶</li><li>Helm3 åŒ…å«äº†å¯¹æ–°ç‰ˆæœ¬ Helm charts ï¼ˆCharts v2ï¼‰çš„æ”¯æŒ</li><li>Helm3 æ”¯æŒ <code>library charts</code> â€”â€” ä¸€ç§ä½œä¸ºå…¶ä»– charts å…ƒç´ çš„ charts</li><li>å°† Chart æ¨é€ä¿å­˜åˆ° OCI æ³¨å†Œä¸­å¿ƒï¼ˆç±»ä¼¼ DockerRegistry ï¼‰ï¼Œä»¥è¿›è¡Œå¤ç”¨</li><li>å‡çº§Kubernetesèµ„æºæ—¶å°†åº”ç”¨3å‘æˆ˜ç•¥åˆå¹¶è¡¥ä¸</li><li>æ”¯æŒä½¿ç”¨ JSON Schema å¯¹ charts çš„ values è¿›è¡Œæ ¡éªŒ</li><li>ä¸ºäº†ä½¿Helmæ›´å®‰å…¨ï¼Œå¯ç”¨å’Œå¥å£®ï¼Œå·²è¿›è¡Œäº†è®¸å¤šå°çš„æ”¹è¿›ã€‚</li></ul></blockquote><h3 id="2ã€é‡è¦å˜åŒ–æ¦‚è¿°"><a href="#2ã€é‡è¦å˜åŒ–æ¦‚è¿°" class="headerlink" title="2ã€é‡è¦å˜åŒ–æ¦‚è¿°"></a>2ã€é‡è¦å˜åŒ–æ¦‚è¿°</h3><h4 id="1ï¼‰ç§»é™¤-Tiller"><a href="#1ï¼‰ç§»é™¤-Tiller" class="headerlink" title="1ï¼‰ç§»é™¤ Tiller"></a>1ï¼‰ç§»é™¤ Tiller</h4><p><code>Tiller</code> åœ¨ Helm2 ä¸­æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚Helm2 ä½¿ç”¨å®ƒå’Œ <code>GRPC</code> æ¥å¤„ç† <code>Helm chart</code> çš„å®‰è£…å’Œç®¡ç†ï¼Œå‘ˆç° <code>chart</code> å¹¶å°†å…¶æ¨é€åˆ° Kubernetes API Serverã€‚<code>Tiller</code> å…è®¸å›¢é˜Ÿå…±äº«ä¸€ä¸ª Kubernetes é›†ç¾¤ï¼Œå¤šä¸ª operator å¯ä»¥ä½¿ç”¨åŒä¸€ç»„å‘è¡Œç‰ˆï¼Œå›¢é˜Ÿæˆå‘˜é€šè¿‡å®ƒå°±å¯ä»¥åœ¨ä¸€ä¸ªå…±äº«çš„ Kubernetes é›†ç¾¤ä¸­ç®¡ç†å¤æ‚çš„åº”ç”¨å‘å¸ƒã€‚</p><p>ä½†æ˜¯ä» Kubernetes 1.6 å¼€å§‹ï¼Œè€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œé›†ç¾¤é»˜è®¤ä¼šå¼€å¯è§’è‰²è®¿é—®æ§åˆ¶ï¼ˆ<code>RBAC</code>ï¼‰ï¼Œè¿™ä½¿å¾—ç®¡ç†å’Œé…ç½®Tillerä¼šå˜å¾—éå¸¸å¤æ‚ï¼Œå› ä¸ºå¯èƒ½çš„å®‰å…¨ç­–ç•¥æ•°é‡å¤ªå¤šäº†ã€‚ä¸ºäº†ç®€åŒ–å®‰å…¨æ¨¡å‹å®ç°æ–¹å¼ï¼Œå¹¶ä½¿ç®¡ç†å‘˜/SREä¸éœ€è¦å»æ·±å…¥ç ”ç©¶ Kubernetes çš„å®‰å…¨ç»„ä»¶ï¼Œhelm æä¾›äº†ä¸€ä¸ªä¸éœ€è¦å¤ªè¿‡å…³æ³¨å®‰å…¨è§„åˆ™çš„é»˜è®¤é…ç½®ï¼Œä½†æ˜¯è¿™åˆä¼šä½¿å¾—æˆæƒå˜å¾—å®½æ¾ï¼Œè¿™åè€Œä¼šå¯¼è‡´å®‰å…¨éšæ‚£ã€‚</p><p>å› æ­¤åœ¨ Helm3 ä¸­å¹²è„†ç§»é™¤äº† Tillerï¼Œè€Œæ˜¯é€‰æ‹©ä» Kubernetes API Server ä¸­è·å–ä¿¡æ¯æ¥æ¸²æŸ“ Charts å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨ Kubernetes ä¸­å­˜åœ¨å®‰è£…è®°å½•ï¼Œè¿™äº›è¿‡ç¨‹æ—¢æ˜¯æ²¡æœ‰ Tiller ä¹Ÿå¯ä»¥å®ç°ã€‚</p><p>Helm3 å¯ä»¥æ”¯æŒæ‰€æœ‰çš„ Kubernetes è®¤è¯åŠé‰´æƒç­‰å…¨éƒ¨å®‰å…¨ç‰¹æ€§ã€‚Helmå’Œæœ¬åœ°çš„ kubeconfig flie ä¸­çš„é…ç½®ä½¿ç”¨ä¸€è‡´çš„æƒé™ã€‚ç®¡ç†å‘˜å¯ä»¥æŒ‰ç…§è‡ªå·±è®¤ä¸ºåˆé€‚çš„ç²’åº¦æ¥ç®¡ç†ç”¨æˆ·æƒé™ã€‚</p><p><img src="http://uniondrug-devops.oss-cn-hangzhou.aliyuncs.com/blog_images/helm3%E5%8F%98%E5%8C%96.png" alt="helm3å˜åŒ–"></p><h4 id="2ï¼‰Chart-ä»“åº“å‡çº§"><a href="#2ï¼‰Chart-ä»“åº“å‡çº§" class="headerlink" title="2ï¼‰Chart ä»“åº“å‡çº§"></a>2ï¼‰Chart ä»“åº“å‡çº§</h4><p>åœ¨ Helm3 ä¸­ï¼Œ<code>helm search</code> é™¤äº†æ”¯æŒæœ¬åœ° repository æœç´¢å¤–ï¼Œè¿˜æ”¯æŒ <code>helm search hub</code> æœç´¢ Artifact Hub ä¸­æ‰€æœ‰å…¬å¼€çš„ chartsã€‚</p><h4 id="3ï¼‰æ”¹è¿›å‡çº§ç­–ç•¥ï¼šä½¿ç”¨ä¸‰è·¯ç­–ç•¥åˆå¹¶è¡¥ä¸"><a href="#3ï¼‰æ”¹è¿›å‡çº§ç­–ç•¥ï¼šä½¿ç”¨ä¸‰è·¯ç­–ç•¥åˆå¹¶è¡¥ä¸" class="headerlink" title="3ï¼‰æ”¹è¿›å‡çº§ç­–ç•¥ï¼šä½¿ç”¨ä¸‰è·¯ç­–ç•¥åˆå¹¶è¡¥ä¸"></a>3ï¼‰æ”¹è¿›å‡çº§ç­–ç•¥ï¼šä½¿ç”¨ä¸‰è·¯ç­–ç•¥åˆå¹¶è¡¥ä¸</h4><p>åœ¨ Helm2 ä¸­ï¼Œä½¿ç”¨äº†åŒè·¯ç­–ç•¥åˆå¹¶è¡¥ä¸ï¼Œç®€å•æ¥è¯´å°±æ˜¯åœ¨ä½¿ç”¨ <code>helm upgrade</code> æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œä¼šæ¯”å¯¹æœ¬æ¬¡å‘å¸ƒçš„ chart manifest å’Œ æœ€è¿‘ä¸€æ¬¡å‘å¸ƒçš„ chart manifest  çš„å·®å¼‚ï¼Œä»¥æ­¤æ¥å†³å®šå“ªäº›æ›´æ”¹è¢«åº”ç”¨åˆ° Kubernetes çš„èµ„æºä¸­å»ã€‚å¹¶ä¸”ï¼ŒHelm åªä¼šå°†æœ€åä¸€æ¬¡åº”ç”¨çš„ chart manifest ä½œä¸º release çš„å½“å‰çŠ¶æ€ï¼Œå¦‚æœ chart çŠ¶æ€æ²¡æœ‰æ›´æ”¹ï¼Œèµ„æºçš„æ´»åŠ¨çŠ¶æ€å°±ä¸ä¼šæ›´æ”¹ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨è¯¸å¦‚ <code>kubectl edit</code> ã€<code>kubectl scale</code> è¿™ç§å¤–éƒ¨æ–¹å¼è¿›è¡Œçš„ä¿®æ”¹ä¸ä¼šè¢« Helm è¯†åˆ«çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚æœå‘ç”Ÿå›æ»šæ“ä½œï¼ŒHelm ä¼šç”±äº chart å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–è€Œå¯¼è‡´å›æ»šå¤±è´¥ã€‚</p><p>è€Œåœ¨ Helm3 ä¸­ï¼Œè¿™ç§ç­–ç•¥è¢«å‡çº§æˆäº†ä¸‰è·¯ç­–ç•¥åˆå¹¶ï¼ŒHelm åœ¨ç”Ÿæˆä¸€ä¸ªè¡¥ä¸æ—¶ï¼Œä¹Ÿä¼šè€ƒè™‘ä¹‹å‰è€çš„ manifest çš„æ´»åŠ¨çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä½¿ç”¨è€çš„ chart manifest ç”Ÿæˆæ–°çš„è¡¥ä¸æ—¶ï¼ŒHelm è¿˜ä¼šè€ƒè™‘å½“å‰çš„æ´»åŠ¨çŠ¶æ€ï¼Œå¹¶å°†å…¶ä¸ä¹‹å‰è€çš„ manifest è¿›è¡Œæ¯”å¯¹ï¼Œå¹¶å†æ¯”å¯¹æ–°çš„ manifest æ˜¯å¦æœ‰æ”¹åŠ¨ï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨è¡¥å…¨ï¼Œä»¥æ­¤æ¥ç”Ÿæˆæœ€ç»ˆçš„æ›´æ–°è¡¥ä¸ã€‚</p><h6 id="ç¤ºä¾‹è¯´æ˜ï¼š"><a href="#ç¤ºä¾‹è¯´æ˜ï¼š" class="headerlink" title="ç¤ºä¾‹è¯´æ˜ï¼š"></a>ç¤ºä¾‹è¯´æ˜ï¼š</h6><p>ç”¨ Chart æ¸²æŸ“ç”Ÿæˆçš„ manifest å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">containers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">server</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">my_app:2.0.0</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡é Helm çš„æ–¹å¼å°†åº”ç”¨çš„æ´»åŠ¨çŠ¶æ€ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">containers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">server</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">my_app:2.0.0</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sidecar</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">dump_handler:1.0.0</span><br></code></pre></td></tr></table></figure><p>è€Œç°åœ¨æˆ‘ä»¬æƒ³è¦å°†åº”ç”¨çš„é•œåƒå‡çº§åˆ° <code>2.1.0</code>ï¼Œé€šè¿‡ chart è¿›è¡Œå‡çº§æ“ä½œã€‚</p><p>åœ¨ Helm2 ä¸­ï¼Œç”±äºä¸ä¼šè€ƒè™‘ chart ä¹‹å¤–çš„ä¿®æ”¹ï¼Œè€Œæ˜¯æ£€æµ‹ chart ç”Ÿæˆçš„ manifest ä¹‹é—´çš„åŒºåˆ«ï¼Œå› æ­¤ä¿®æ”¹åçš„çŠ¶æ€å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">containers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">server</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">my_app:2.1.0</span><br></code></pre></td></tr></table></figure><p>è€Œåœ¨ Helm3 ä¸­ï¼Œé€šè¿‡ä¸‰è·¯åˆå¹¶ç­–ç•¥ï¼Œä¼šæ£€æŸ¥åˆ°é™¤äº† chart çš„ä¿®æ”¹å¤–ï¼Œè¿˜å¤šäº†ä¸€ä¸ª sidecar å®¹å™¨ï¼Œå› æ­¤ä¼šè¿›è¡Œè¡¥å…¨ï¼Œæœ€ç»ˆä¿®æ”¹çŠ¶æ€å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">containers:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">server</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">my_app:2.1.0</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sidecar</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">dump_handler:1.0.0</span><br></code></pre></td></tr></table></figure><h4 id="4ï¼‰release-åç§°å­˜å‚¨ä½ç½®æ”¹å˜"><a href="#4ï¼‰release-åç§°å­˜å‚¨ä½ç½®æ”¹å˜" class="headerlink" title="4ï¼‰release åç§°å­˜å‚¨ä½ç½®æ”¹å˜"></a>4ï¼‰release åç§°å­˜å‚¨ä½ç½®æ”¹å˜</h4><p>åœ¨ Helm2 ä¸­ï¼Œrelease çš„ç›¸å…³ä¿¡æ¯éƒ½è¢«ä¿å­˜åœ¨ Tiller çš„ namespaceä¸‹ï¼Œæ‰€ä»¥ release çš„åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼›è€Œéšç€ Tiller ç»„ä»¶çš„ç§»é™¤ï¼Œ Helm3 ä¸­release ç›¸å…³çš„ä¿¡æ¯éƒ½è¢«ä¿å­˜åœ¨äº†åº”ç”¨è‡ªå·±ç›¸å¯¹åº”çš„ namespace ä¸‹ï¼Œå› æ­¤æ ¹æ® namespace çš„éš”ç¦»æ€§è´¨ï¼Œåœ¨ä¸åŒçš„ ns ä¸‹ï¼Œrelease çš„åç§°å¯ä»¥é‡å¤ã€‚</p><blockquote><p>âš ï¸ <strong>æ³¨æ„:</strong></p><p>Helm3 ä¸­ï¼Œåœ¨æ‰§è¡Œ <code>helm list</code> æ—¶éœ€è¦æ·»åŠ  <code>--all-namespaces</code> å‚æ•°æ‰èƒ½è·å–åˆ° Helm2 ä¸­åŒæ ·çš„ç»“æœ</p></blockquote><h4 id="5ï¼‰é»˜è®¤å­˜å‚¨é©±åŠ¨ç¨‹åºæ›´æ”¹ä¸º-Secrets"><a href="#5ï¼‰é»˜è®¤å­˜å‚¨é©±åŠ¨ç¨‹åºæ›´æ”¹ä¸º-Secrets" class="headerlink" title="5ï¼‰é»˜è®¤å­˜å‚¨é©±åŠ¨ç¨‹åºæ›´æ”¹ä¸º Secrets"></a>5ï¼‰é»˜è®¤å­˜å‚¨é©±åŠ¨ç¨‹åºæ›´æ”¹ä¸º Secrets</h4><p>Helm 2 é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ ConfigMaps å­˜å‚¨å‘è¡Œä¿¡æ¯ï¼Œç›´åˆ° Helm 2.7.0 ä¸­ï¼Œæ‰ä½¿ç”¨ Secrets ç”¨ä½œå­˜å‚¨é©±åŠ¨ç¨‹åºã€‚è€Œåœ¨ Helm 3 ä¸­é»˜è®¤å°±ä½¿ç”¨ Secretsã€‚</p><p><a href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/">é™æ€åŠ å¯†å¯†é’¥</a> åœ¨Kubernetes 1.7ä¸­ä½œä¸ºalphaç‰¹æ€§å¯ä»¥ä½¿ç”¨äº†ï¼Œåœ¨Kubernetes 1.13ä¸­å˜æˆäº†ç¨³å®šç‰¹æ€§ã€‚ è¿™å…è®¸ç”¨æˆ·é™æ€åŠ å¯†Helmçš„å‘å¸ƒå…ƒæ•°æ®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼Vaultçš„ä»¥åå¯æ‰©å±•çš„è‰¯å¥½èµ·ç‚¹ã€‚</p><h4 id="6ï¼‰Go-å¯¼å…¥è·¯å¾„æ›´æ”¹"><a href="#6ï¼‰Go-å¯¼å…¥è·¯å¾„æ›´æ”¹" class="headerlink" title="6ï¼‰Go å¯¼å…¥è·¯å¾„æ›´æ”¹"></a>6ï¼‰Go å¯¼å…¥è·¯å¾„æ›´æ”¹</h4><p>åœ¨ Helm3 ä¸­ï¼ŒGo å¯¼å…¥è·¯å¾„ä»<code>k8s.io/helm</code> åˆ‡æ¢ä¸º <code>helm.sh/helm/v3</code>ã€‚ å¦‚æœæ‰“ç®—å‡çº§åˆ°Helm 3 Goå®¢æˆ·ç«¯åº“ï¼Œè¯·ç¡®ä¿æ›´æ”¹å¯¼å…¥è·¯å¾„ã€‚</p><h4 id="7ï¼‰ä½¿ç”¨-JSONSchema-éªŒè¯-Chart-çš„-values"><a href="#7ï¼‰ä½¿ç”¨-JSONSchema-éªŒè¯-Chart-çš„-values" class="headerlink" title="7ï¼‰ä½¿ç”¨ JSONSchema éªŒè¯ Chart çš„ values"></a>7ï¼‰ä½¿ç”¨ JSONSchema éªŒè¯ Chart çš„ values</h4><p>Helm3 æ”¯æŒç”¨<code> JSONSchema</code>  æ¥æ ¡éªŒ Chart çš„ valuesï¼Œå®ƒä¼šè‡ªåŠ¨æ£€æŸ¥æ‰€æœ‰è¾“å…¥çš„å˜é‡æ ¼å¼ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ç”¨æˆ·æä¾›çš„å€¼éµå¾ª Chart ç»´æŠ¤è€…è®¾è®¡çš„æ¶æ„ï¼Œå½“ç”¨æˆ·ä¸º Chart æä¾›ä¸€ç»„é”™è¯¯å€¼æ—¶ï¼Œä¹Ÿèƒ½æä¾›æ›´å¥½çš„é”™è¯¯æŠ¥å‘Šã€‚</p><p>å½“è°ƒç”¨ä¸€ä¸‹å‘½ä»¤æ—¶ä¼šè¿›è¡Œ JSON æ ¼å¼éªŒè¯ï¼š</p><blockquote><ul><li>helm install</li><li>helm upgrade</li><li>helm template</li><li>helm lint</li></ul></blockquote><h4 id="8ï¼‰requirements-yamlåˆå¹¶å…¥-Chart-yaml"><a href="#8ï¼‰requirements-yamlåˆå¹¶å…¥-Chart-yaml" class="headerlink" title="8ï¼‰requirements.yamlåˆå¹¶å…¥ Chart.yaml"></a>8ï¼‰requirements.yamlåˆå¹¶å…¥ Chart.yaml</h4><p>åŠ¨æ€ä¾èµ–å…³ç³»çš„chart ä¾èµ–ä» <code>requirements.yaml</code> å’Œ <code>requirements.lock</code> ç§»è‡³ <code>Chart.yaml</code> å’Œ <code>Chart.lock</code>ã€‚ æ¨èåœ¨ Helm3 çš„æ–° chart ä¸­ä½¿ç”¨ Chart API v2 çš„æ–°æ ¼å¼ï¼Œä½†æ˜¯ Helm3 ä¸­ä¾ç„¶å¯ä»¥è¯†åˆ« v1 ç‰ˆæœ¬ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨åŠ è½½å·²æœ‰çš„ <code>requirements.yaml</code> æ–‡ä»¶ã€‚</p><p>åœ¨ Helm2 ä¸­ï¼Œ<code>requirements.yaml</code> çš„è¡¨è¾¾å¼ç±»ä¼¼å¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mariadb</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-number">5.</span><span class="hljs-string">x.x</span><br>  <span class="hljs-attr">repository:</span> <span class="hljs-string">https://charts.helm.sh/stable</span><br>  <span class="hljs-attr">condition:</span> <span class="hljs-string">mariadb.enabled</span><br>  <span class="hljs-attr">tags:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">database</span><br></code></pre></td></tr></table></figure><p>è€Œåœ¨ Helm3 ä¸­ï¼Œè¡¨è¾¾å¼çš„å½¢å¼å¹¶æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯ç°åœ¨éœ€è¦å†™åœ¨ <code>Chart.yaml</code> ä¸­ã€‚Chart ä¾ç„¶ä¼šä¸‹è½½å’Œæ”¾ç½®åœ¨ <code>charts/</code> ç›®å½•ï¼Œæ‰€ä»¥ <code>charts/</code> ç›®å½•ä¸­çš„å­ chart ä¸éœ€è¦åšä»»ä½•ä¿®æ”¹ï¼Œå¯ä»¥æ²¿ç”¨ Helm2 çš„ã€‚</p><h4 id="9ï¼‰æŒ‡å®šåç§°å’Œå‘½åç©ºé—´"><a href="#9ï¼‰æŒ‡å®šåç§°å’Œå‘½åç©ºé—´" class="headerlink" title="9ï¼‰æŒ‡å®šåç§°å’Œå‘½åç©ºé—´"></a>9ï¼‰æŒ‡å®šåç§°å’Œå‘½åç©ºé—´</h4><h5 id="1âƒ£ï¸-å‘å¸ƒæ—¶å¿…é¡»æŒ‡å®š-release-åç§°"><a href="#1âƒ£ï¸-å‘å¸ƒæ—¶å¿…é¡»æŒ‡å®š-release-åç§°" class="headerlink" title="1âƒ£ï¸ å‘å¸ƒæ—¶å¿…é¡»æŒ‡å®š release åç§°"></a>1âƒ£ï¸ å‘å¸ƒæ—¶å¿…é¡»æŒ‡å®š release åç§°</h5><p>åœ¨ Helm2 ä¸­ï¼Œåœ¨å‘å¸ƒæ—¶å¦‚æœæœªæä¾› release çš„åç§°ï¼ŒHelm ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªï¼Œä½†æ˜¯åœ¨ Helm3 ä¸­ï¼Œå¦‚æœæœªæŒ‡å®š release åç§°ï¼Œå®‰è£…å°±ä¼šæŠ¥é”™ï¼Œå¦‚æœä»ç„¶å¸Œæœ› Helm èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆ release åç§°ï¼Œå¯ä»¥ä½¿ç”¨ <code>--generate-name</code> å‚æ•°ã€‚</p><h5 id="2âƒ£ï¸-ä¸å†è‡ªåŠ¨åˆ›å»º-namespace"><a href="#2âƒ£ï¸-ä¸å†è‡ªåŠ¨åˆ›å»º-namespace" class="headerlink" title="2âƒ£ï¸ ä¸å†è‡ªåŠ¨åˆ›å»º namespace"></a>2âƒ£ï¸ ä¸å†è‡ªåŠ¨åˆ›å»º namespace</h5><p>åœ¨ Helm2 ä¸­ï¼Œå¦‚æœåœ¨åˆ›å»ºç‰ˆæœ¬æ—¶ï¼Œå‘½åç©ºé—´ä¸å­˜åœ¨ï¼ŒHelm2 ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œä½†æ˜¯åœ¨ Helm3 ä¸­ï¼Œå¦‚æœå‘½åç©ºé—´ä¸å­˜åœ¨å°±ä¼šæŠ¥é”™ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®š <code>--create-namespace</code> å‚æ•°ï¼ŒHelm3 æ‰ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´ã€‚</p><h4 id="10ï¼‰å°†-Chart-æ¨é€åˆ°-OCI-æ³¨å†Œä¸­å¿ƒ"><a href="#10ï¼‰å°†-Chart-æ¨é€åˆ°-OCI-æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="10ï¼‰å°† Chart æ¨é€åˆ° OCI æ³¨å†Œä¸­å¿ƒ"></a>10ï¼‰å°† Chart æ¨é€åˆ° OCI æ³¨å†Œä¸­å¿ƒ</h4><p>è¿™æ˜¯ä¸€ä¸ª Helm3 ä¸­çš„è¯•éªŒæ€§ç‰¹æ€§ï¼Œä½¿ç”¨æ—¶éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ <code>HELM_EXPERIMENTAL_OCI=1</code>ã€‚</p><p>æŸ¥çœ‹ <code>helm help chart</code> å’Œ <code>helm help registry</code> äº†è§£å¦‚ä½•æ‰“åŒ…chartå¹¶æ¨é€åˆ°Dockeræ³¨å†Œä¸­å¿ƒçš„æ›´å¤šä¿¡æ¯ã€‚</p><h4 id="11ï¼‰ç§»é™¤-helm-serve"><a href="#11ï¼‰ç§»é™¤-helm-serve" class="headerlink" title="11ï¼‰ç§»é™¤ helm serve"></a>11ï¼‰ç§»é™¤ <code>helm serve</code></h4><p>åœ¨ Helm2 ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>helm serve</code> å‘½ä»¤åœ¨æœ¬åœ°ä¸´æ—¶æ­å»º <code>Chart Repository </code>ï¼Œä½†æ˜¯ç”±äºå¹¶æ²¡æœ‰è¢«å¼€å‘å·¥å…·æ¥å—ï¼Œä¸”åœ¨è®¾è®¡æ–¹é¢å­˜åœ¨è¾ƒå¤šé—®é¢˜ï¼Œæ•…åœ¨ Helm3 ä¸­è¢«åˆ é™¤äº†ã€‚</p><h4 id="12ï¼‰æ”¯æŒ-library-chart"><a href="#12ï¼‰æ”¯æŒ-library-chart" class="headerlink" title="12ï¼‰æ”¯æŒ library chart"></a>12ï¼‰æ”¯æŒ library chart</h4><p>Helm3 æ”¯æŒä¸€ç±»ç§°ä¸º <code>library chart</code> çš„ chartï¼Œå…¶æœ¬çœä¸ä¼šåˆ›å»ºä»»ä½•åº”ç”¨ï¼Œåªæ˜¯ä½œä¸ºå…¶ä»– chart çš„å…±äº«ä¾èµ–ã€‚library chart åªèƒ½ç”¨äºå£°æ˜å®šä¹‰å…ƒç´ ï¼Œå…¨å±€èŒƒå›´å†…çš„éå®šä¹‰å†…å®¹å°†è¢«å¿½ç•¥ã€‚è¿™ä½¿ç”¨æˆ·å¯ä»¥é‡å¤ä½¿ç”¨å’Œå…±äº«å¯åœ¨è®¸å¤šchartä¸­é‡å¤ä½¿ç”¨çš„ä»£ç æ®µï¼Œä»è€Œé¿å…äº†å†—ä½™å¹¶ä½¿ chart ä¿æŒç®€æ´ã€‚</p><p>Library chart åœ¨ Chart.yaml çš„ä¾èµ–æŒ‡ä»¤ä¸­å£°æ˜ï¼Œå®‰è£…å’Œç®¡ç†ä¸å…¶ä»–chartä¸€è‡´ï¼Œå…¶è¡¨è¾¾å¼ç±»ä¼¼å¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mylib</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-number">1.</span><span class="hljs-string">x.x</span><br>    <span class="hljs-attr">repository:</span> <span class="hljs-string">quay.io</span><br></code></pre></td></tr></table></figure><h4 id="13ï¼‰Chart-yaml-çš„-apiVersion-å‡çº§"><a href="#13ï¼‰Chart-yaml-çš„-apiVersion-å‡çº§" class="headerlink" title="13ï¼‰Chart.yaml çš„ apiVersion å‡çº§"></a>13ï¼‰Chart.yaml çš„ apiVersion å‡çº§</h4><h5 id="1âƒ£ï¸-apiVersion-v1-å‡çº§è‡³-v2"><a href="#1âƒ£ï¸-apiVersion-v1-å‡çº§è‡³-v2" class="headerlink" title="1âƒ£ï¸ apiVersion v1 å‡çº§è‡³ v2"></a>1âƒ£ï¸ apiVersion v1 å‡çº§è‡³ v2</h5><p>ç”±äº Helm3 ä¸­æ–°å¢äº†è®¸å¤šæ–°çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æ”¯æŒ <code>library chart</code> ã€<code>requirements.yaml</code> åˆå¹¶è¿› <code>Chart.yaml</code>ã€‚è€Œå®¢æˆ·ç«¯è™½ç„¶å¯ä»¥æ˜¯åˆ« Helm2 çš„åŒ…æ ¼å¼ï¼Œå´ä¸èƒ½ç†è§£è¿™äº›æ–°çš„ç‰¹æ€§ï¼Œå› æ­¤ Helm3 ä¸­çš„ Chart.yaml çš„ apiVersion ä¹Ÿä» v1 å‡çº§åˆ°å¯ v2ã€‚</p><p>ä½¿ç”¨ Helm3 çš„ <code>helm create</code> åˆ›å»ºçš„ chart å°†ä½¿ç”¨æ–°æ ¼å¼ï¼Œé»˜è®¤çš„ apiVersion ä¹Ÿå°†ä½¿ç”¨ v2ã€‚</p><h5 id="2âƒ£ï¸-ApiVersion-æ”¹ä¸º-APIVersion"><a href="#2âƒ£ï¸-ApiVersion-æ”¹ä¸º-APIVersion" class="headerlink" title="2âƒ£ï¸ ApiVersion æ”¹ä¸º APIVersion"></a>2âƒ£ï¸ ApiVersion æ”¹ä¸º APIVersion</h5><p>Helm3 å¯¹äºé©¼å³°çš„å‘½ä»¤è§„èŒƒè¿›è¡Œäº†ä¿®æ”¹ï¼Œéµå¾ªé©¼å³°å‘½åçš„å…¸å‹æƒ¯ä¾‹ï¼Œå› æ­¤å°† <code>.Chart.ApiVersion</code> æ›´æ­£ä¸ºäº† <code>.Chart.APIVersion</code>ï¼Œå…¶ä»–è¯¸å¦‚ <code>.Capabilities.APIVersions.Has</code> éƒ½è¿›è¡Œäº†æ›´æ­£å¤„ç†ã€‚</p><h4 id="14ï¼‰XDG-åŸºæœ¬ç›®å½•æ”¯æŒ"><a href="#14ï¼‰XDG-åŸºæœ¬ç›®å½•æ”¯æŒ" class="headerlink" title="14ï¼‰XDG åŸºæœ¬ç›®å½•æ”¯æŒ"></a>14ï¼‰XDG åŸºæœ¬ç›®å½•æ”¯æŒ</h4><p><a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG åŸºæœ¬ç›®å½•è§„èŒƒ</a> æ˜¯ä¸€ä¸ªå®šä¹‰äº†é…ç½®ã€æ•°æ®å’Œç¼“å­˜æ–‡ä»¶åº”è¯¥å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä»€ä¹ˆä½ç½®çš„å¯ç§»æ¤æ ‡å‡†ã€‚</p><p>åœ¨ Helm2 ä¸­ï¼ŒHelm ç›¸å…³çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ <code>~/.helm/</code> ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ <code>$HELM_HOME</code> æˆ–è€… <code>--home</code> å‚æ•°æŒ‡å®šã€‚è€Œåœ¨ Helm3 ä¸­ï¼Œç›¸å…³çš„ç¯å¢ƒå˜é‡åˆ™å˜æ›´ä¸ºäº†ä»¥ä¸‹è§„èŒƒå½¢å¼ï¼š</p><blockquote><ul><li>$XDG_CACHE_HOME        # ç”¨äºå­˜æ”¾ç¼“å­˜æ–‡ä»¶</li><li>$XDG_CONFIG_HOME      # ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶</li><li>$XDG_DATA_HOME          # ç”¨äºå­˜æ”¾æ•°æ®æ–‡ä»¶</li></ul></blockquote><p>ä½†æ˜¯åœ¨ Helm3 ä¸­ä»ä¿ç•™äº† <code>$HELM_HOME</code> ä½œä¸º <code>$XDG_DATA_HOME</code> çš„åˆ«åï¼Œä»¥æ­¤æ¥ä¿è¯è¿‡æ¸¡é˜¶æ®µçš„å…¼å®¹æ€§ã€‚</p><p>Helm æ’ä»¶å¦‚è¿‡è¦æ”¯æŒ Helm3ï¼Œä¹Ÿå¯ä»¥ç”¨ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼Œæ¥é€‚åº”è¿™ç§å˜åŒ–ï¼š</p><blockquote><ul><li>$HELM_PATH_CACHE       # ç”¨äºå­˜æ”¾ç¼“å­˜æ–‡ä»¶</li><li>$HELM_PATH_CONFIG     # ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶</li><li>$HELM_PATH_DATA          # ç”¨äºå­˜æ”¾æ•°æ®æ–‡ä»¶</li></ul></blockquote><h5 id="å„ç¯å¢ƒé»˜è®¤æ–‡ä»¶å­˜æ”¾ä½ç½®"><a href="#å„ç¯å¢ƒé»˜è®¤æ–‡ä»¶å­˜æ”¾ä½ç½®" class="headerlink" title="å„ç¯å¢ƒé»˜è®¤æ–‡ä»¶å­˜æ”¾ä½ç½®"></a>å„ç¯å¢ƒé»˜è®¤æ–‡ä»¶å­˜æ”¾ä½ç½®</h5><blockquote><p>ğŸš© å¯ä»¥é€šè¿‡ <code>helm env</code> æŸ¥çœ‹</p></blockquote><table><thead><tr><th><strong>Operating System</strong></th><th><strong>Cache Path</strong></th><th><strong>Configuration Path</strong></th><th><strong>Data Path</strong></th></tr></thead><tbody><tr><td><strong>Linux</strong></td><td>$HOME/.cache/helm</td><td>$HOME/.config/helm</td><td>$HOME/.local/share/helm</td></tr><tr><td><strong>macOS</strong></td><td>$HOME/Library/Caches/helm</td><td>$HOME/Library/Preferences/helm</td><td>$HOME/Library/helm</td></tr><tr><td><strong>Windows</strong></td><td>%TEMP%\helm</td><td>%APPDATA%\helm</td><td>%APPDATA%\helm</td></tr></tbody></table><h4 id="15ï¼‰CLI-å‘½ä»¤é‡å‘½å"><a href="#15ï¼‰CLI-å‘½ä»¤é‡å‘½å" class="headerlink" title="15ï¼‰CLI å‘½ä»¤é‡å‘½å"></a>15ï¼‰CLI å‘½ä»¤é‡å‘½å</h4><h5 id="1âƒ£ï¸-helm-delete-æ›´æ”¹ä¸º-helm-uninstall"><a href="#1âƒ£ï¸-helm-delete-æ›´æ”¹ä¸º-helm-uninstall" class="headerlink" title="1âƒ£ï¸ helm delete æ›´æ”¹ä¸º helm uninstall"></a>1âƒ£ï¸ <code>helm delete</code> æ›´æ”¹ä¸º <code>helm uninstall</code></h5><p>åœ¨ Helm2 ä¸­ï¼Œå¦‚æœè¦æ¸…æ¥š release çš„å„ç§èµ„æºï¼Œå¿…é¡»è¦ä½¿ç”¨ <code>--purge</code> å‚æ•°ï¼ŒHelm3 ä¸­é»˜è®¤å°±ä¼šå¯ç”¨æ¬¡åŠŸã€‚</p><p>å¦‚æœè¦ä¿ç•™å†å²è¡Œä¸ºæ•°æ®ï¼Œéœ€æ‰§è¡Œ <code>helm uninstall --keep-history</code></p><h5 id="2âƒ£ï¸-helm-inspect-æ›´æ”¹ä¸º-helm-show"><a href="#2âƒ£ï¸-helm-inspect-æ›´æ”¹ä¸º-helm-show" class="headerlink" title="2âƒ£ï¸ helm inspect æ›´æ”¹ä¸º helm show"></a>2âƒ£ï¸ <code>helm inspect</code> æ›´æ”¹ä¸º <code>helm show</code></h5><h5 id="3âƒ£ï¸-helm-fetch-æ›´æ”¹ä¸º-helm-pull"><a href="#3âƒ£ï¸-helm-fetch-æ›´æ”¹ä¸º-helm-pull" class="headerlink" title="3âƒ£ï¸ helm fetch æ›´æ”¹ä¸º helm pull"></a>3âƒ£ï¸ <code>helm fetch</code> æ›´æ”¹ä¸º <code>helm pull</code></h5><blockquote><p>ğŸš© <strong>è¿™äº›å‘½ä»¤è¿˜ä¿ç•™äº†å®ƒä»¬è¾ƒæ—§çš„å‘½ä»¤ä½œä¸ºåˆ«åï¼Œå› æ­¤æ‚¨å¯ä»¥ç»§ç»­ä»¥ä»»ä½•ä¸€ç§å½¢å¼ä½¿ç”¨å®ƒä»¬ã€‚</strong></p></blockquote><h4 id="16ï¼‰ç®€åŒ–æ¨¡æ¿å¯¹è±¡-Capabilities"><a href="#16ï¼‰ç®€åŒ–æ¨¡æ¿å¯¹è±¡-Capabilities" class="headerlink" title="16ï¼‰ç®€åŒ–æ¨¡æ¿å¯¹è±¡ .Capabilities"></a>16ï¼‰ç®€åŒ–æ¨¡æ¿å¯¹è±¡ .Capabilities</h4><p><code>Capabilities</code> æ˜¯ Helm æ¨¡ç‰ˆå¯ä»¥è®¿é—®çš„å†…ç½®å¯¹è±¡ä¹‹ä¸€ï¼Œå…¶æä¾›äº†å…³äº Kubernetes é›†ç¾¤æ”¯æŒçš„åŠŸèƒ½çš„ä¿¡æ¯ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><table><thead><tr><th>å¯¹è±¡åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>Capabilities.APIVersions</td><td>é›†ç¾¤çš„ç‰ˆæœ¬ä¿¡æ¯</td></tr><tr><td>Capabilities.APIVersions.Has $version</td><td>è¯´æ˜é›†ç¾¤ä¸­çš„ç‰ˆæœ¬ (ä¾‹å¦‚, <code>batch/v1</code>) æˆ–æ˜¯èµ„æº (ä¾‹å¦‚, <code>apps/v1/Deployment</code>) æ˜¯å¦å¯ç”¨</td></tr><tr><td>Capabilities.KubeVersion</td><td>æä¾›äº†æŸ¥æ‰¾ Kubernetes ç‰ˆæœ¬çš„æ–¹æ³•ã€‚å¯ä»¥è·å–åˆ° <code>Major</code>ï¼Œ<code>Minor</code>ï¼Œ<code>GitVersion</code>ï¼Œ<code>GitCommit</code>ï¼Œ<code>GitTreeState</code>ï¼Œ<code>BuildDate</code>ï¼Œ<code>GoVersion</code>ï¼Œ<code>Compiler</code>å’Œ<code>Platform</code>ã€‚</td></tr><tr><td>Capabilities.TillerVersion</td><td>æä¾›äº†æŸ¥æ‰¾Tillerç‰ˆæœ¬çš„æ–¹æ³•ã€‚å¯ä»¥è·å–åˆ°<code>SemVer</code>, <code>GitCommit</code>, and <code>GitTreeState</code>.</td></tr></tbody></table><hr><h2 id="å››ã€Helmç‰ˆæœ¬æ”¯æŒç­–ç•¥"><a href="#å››ã€Helmç‰ˆæœ¬æ”¯æŒç­–ç•¥" class="headerlink" title="å››ã€Helmç‰ˆæœ¬æ”¯æŒç­–ç•¥"></a>å››ã€Helmç‰ˆæœ¬æ”¯æŒç­–ç•¥</h2><h3 id="1ã€-ç‰ˆæœ¬å½¢å¼"><a href="#1ã€-ç‰ˆæœ¬å½¢å¼" class="headerlink" title="1ã€ ç‰ˆæœ¬å½¢å¼"></a>1ã€ ç‰ˆæœ¬å½¢å¼</h3><blockquote><p>Helm çš„ç‰ˆæœ¬ç”¨ <code>x.y.z</code> çš„å½¢å¼æè¿°ï¼Œ<code>x</code> æ˜¯ä¸»ç‰ˆæœ¬ï¼Œ<code>y</code> æ˜¯æ¬¡ç‰ˆæœ¬ï¼Œ<code>z</code> æ˜¯è¡¥ä¸ç‰ˆæœ¬ã€‚å½“ä¸€ä¸ª Helm çš„æ–°ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œéƒ½æ˜¯é’ˆå¯¹ Kubernetes çš„ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬ç¼–è¯‘çš„ï¼Œæ¯”å¦‚ <code>3.0.0</code> åŸºäº Kubernetes çš„ <code>1.16.2</code> çš„å®¢æˆ·ç«¯APIç‰ˆæœ¬æ„å»ºï¼Œåˆ™å¯ä»¥å…¼å®¹ Kubernetes 1.16ã€‚</p></blockquote><h3 id="2ã€å¯æ”¯æŒçš„ç‰ˆæœ¬åå·®"><a href="#2ã€å¯æ”¯æŒçš„ç‰ˆæœ¬åå·®" class="headerlink" title="2ã€å¯æ”¯æŒçš„ç‰ˆæœ¬åå·®"></a>2ã€å¯æ”¯æŒçš„ç‰ˆæœ¬åå·®</h3><blockquote><p>ç›¸è¾ƒäº Helm2 å¯¹äº Kubernetes æ¬¡ç‰ˆæœ¬å˜æ›´æ”¯æŒçš„ä¸¥æ ¼ï¼ˆ<code>n-1</code>ï¼‰ï¼ŒHelm3 å¯ä»¥å‘ä¸‹å…¼å®¹ <code>n-3</code> çš„æ¬¡ç‰ˆæœ¬ï¼Œæ¯”å¦‚ä½ ä½¿ç”¨ä¸€ä¸ªé’ˆå¯¹ Kubernetes 1.18 å®¢æˆ·ç«¯ API ç‰ˆæœ¬ç¼–è¯‘çš„ Helm3 ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬ä¸º 1.18ã€1.17ã€1.16ã€1.15 ï¼›</p><p>å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªé’ˆå¯¹ Kubernetes 1.15 å®¢æˆ·ç«¯ API ç‰ˆæœ¬ç¼–è¯‘çš„ Helm2 ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬ä¸º 1.15ã€1.14ã€‚</p><p>âš ï¸ <strong>æ³¨æ„ï¼š</strong> Helm æ²¡æœ‰å‘ä¸Šå…¼å®¹æœºåˆ¶ï¼Œæ•…æ¨èå®‰è£…ä¸‹è¡¨è¿›è¡Œç‰ˆæœ¬é€‰æ‹©ã€‚</p></blockquote><table><thead><tr><th>Helm ç‰ˆæœ¬</th><th>æ”¯æŒçš„ Kubernetes ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>3.6.x</td><td>1.21.x - 1.18.x</td></tr><tr><td>3.5.x</td><td>1.20.x - 1.17.x</td></tr><tr><td>3.4.x</td><td>1.19.x - 1.16.x</td></tr><tr><td>3.3.x</td><td>1.18.x - 1.15.x</td></tr><tr><td>3.2.x</td><td>1.18.x - 1.15.x</td></tr><tr><td>3.1.x</td><td>1.17.x - 1.14.x</td></tr><tr><td>3.0.x</td><td>1.16.x - 1.13.x</td></tr><tr><td>2.16.x</td><td>1.16.x - 1.15.x</td></tr><tr><td>2.15.x</td><td>1.15.x - 1.14.x</td></tr><tr><td>2.14.x</td><td>1.14.x - 1.13.x</td></tr><tr><td>2.13.x</td><td>1.13.x - 1.12.x</td></tr><tr><td>2.12.x</td><td>1.12.x - 1.11.x</td></tr><tr><td>2.11.x</td><td>1.11.x - 1.10.x</td></tr><tr><td>2.10.x</td><td>1.10.x - 1.9.x</td></tr><tr><td>2.9.x</td><td>1.10.x - 1.9.x</td></tr><tr><td>2.8.x</td><td>1.9.x - 1.8.x</td></tr><tr><td>2.7.x</td><td>1.8.x - 1.7.x</td></tr><tr><td>2.6.x</td><td>1.7.x - 1.6.x</td></tr><tr><td>2.5.x</td><td>1.6.x - 1.5.x</td></tr><tr><td>2.4.x</td><td>1.6.x - 1.5.x</td></tr><tr><td>2.3.x</td><td>1.5.x - 1.4.x</td></tr><tr><td>2.2.x</td><td>1.5.x - 1.4.x</td></tr><tr><td>2.1.x</td><td>1.5.x - 1.4.x</td></tr><tr><td>2.0.x</td><td>1.4.x - 1.3.x</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>Kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Helm3 å¿«é€Ÿå…¥é—¨æ‰‹å†Œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
